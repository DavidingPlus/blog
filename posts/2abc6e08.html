<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="renderer" content="webkit"><meta name="force-rendering" content="webkit"><script>window.MSInputMethodContext&&document.documentMode&&(window.location.href="https://support.dmeng.net/upgrade-your-browser.html")</script><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/assets/favicon-16x16.webp?v=2.8.6" type="image/png" sizes="16x16"><link rel="icon" href="/assets/favicon-32x32.webp?v=2.8.6" type="image/png" sizes="32x32"><link rel="apple-touch-icon" href="/assets/apple-touch-icon.webp?v=2.8.6" sizes="180x180"><meta name="description" content="é¢å‘å¯¹è±¡é«˜çº§å¼€å‘                             Headerå¤´æ–‡ä»¶çš„é˜²å«å¼å£°æ˜        12345678910&#x2F;&#x2F;complex.h#ifndef __COMPLEX__#define __COMPLEX__&#x2F;&#x2F;å«ä¹‰:å¦‚æœç¨‹åºæ²¡æœ‰å®šä¹‰è¿‡ï¼Œé‚£ä¹ˆå®šä¹‰å‡ºæ¥ï¼Œèµ°ä¸»ä½“å†…å®¹ï¼›å¦‚æœç¨‹åºå®šä¹‰è¿‡ï¼Œç¬¬äºŒæ¬¡includeæ—¶ï¼Œé‚£ä¹ˆå°±ä¸èµ°ï¼Œç›´æ¥è¿”å›"><meta property="og:type" content="article"><meta property="og:title" content="ä¾¯æ·è€å¸ˆ C++ è¯¾ç¨‹"><meta property="og:url" content="https://blog.davidingplus.cn/posts/2abc6e08.html"><meta property="og:site_name" content="DavidingPlus&#39;s Blog"><meta property="og:description" content="é¢å‘å¯¹è±¡é«˜çº§å¼€å‘                             Headerå¤´æ–‡ä»¶çš„é˜²å«å¼å£°æ˜        12345678910&#x2F;&#x2F;complex.h#ifndef __COMPLEX__#define __COMPLEX__&#x2F;&#x2F;å«ä¹‰:å¦‚æœç¨‹åºæ²¡æœ‰å®šä¹‰è¿‡ï¼Œé‚£ä¹ˆå®šä¹‰å‡ºæ¥ï¼Œèµ°ä¸»ä½“å†…å®¹ï¼›å¦‚æœç¨‹åºå®šä¹‰è¿‡ï¼Œç¬¬äºŒæ¬¡includeæ—¶ï¼Œé‚£ä¹ˆå°±ä¸èµ°ï¼Œç›´æ¥è¿”å›"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230412174017480.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230412174017480.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230412185656797.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230412202635207.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230412203303042.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230412204435460.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230412210437066.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230412212341135.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230413163206633.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230413211543101.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230414100854356.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230414114802698.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230414161555294.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230414171828137.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230415143355398.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230415143409298.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230415145105415.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230415145711652.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230415150557574.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230415150706680.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230415154938692.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230415154949602.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230415160759007.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230415165550803.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416094923459.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416095052581.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416095559995.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416095953933.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416101021861.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416101451151.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416102010067.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416102442772.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416105043344.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416105348361.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416110401962.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416154815162.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416160403390.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416163304200.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416171855901.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416174305071.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230419170456164.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230419170815213.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230419190233258.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230419192921703.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230419195537174.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230419195610102.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230419201320469.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230420164335846.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230420170120084.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230420170739434.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230420170150250.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230420172205138.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230420172617688.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230420173341877.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230420173832550.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230420174307662.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230420193008988.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230420193316669.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230420193754702.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230421103130501.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230421104600566.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230421104609426.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230421104723249.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230421105352734.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230421175541816.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230421182526116.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230421182650170.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230421192116968.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230421194843419.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230422140640649.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230422143136762.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230422144338234.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230422145128498.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230422154019414.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230422154054412.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230422155807393.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230422162235208.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230422162614061.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230422163446874.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230422171334117.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230422183037284.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230423113446373.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230423171745364.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230423175336384.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230423202430305.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230423203719337.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230423210411376.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230424161751257.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230424162149742.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230424162843434.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230424163242826.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230424170726596.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230424172134280.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230425185823723.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230425191652925.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230425194548756.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230425194051698.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230425200558918.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230425203641882.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230425205345712.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230426151146418.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230427111200767.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230427112849536.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230427170952730.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230427171431489.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230430111248498.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230504191205113.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230504191639232.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230504201206953.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230504202940442.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230504213412890.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230504213510643.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230505102818021.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230505152557462.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230505195009665.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230505190504411.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230505195056962.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230505213553781.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230514163001551.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230514170850534.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230514171027632.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230516105734995.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230516114646497.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230516165803938.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230516203937375.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230516205607537.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230516212207244.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230516221129783.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230516221225536.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230516221737119.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230517141545661.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230518140540645.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230518140911306.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230518143501227.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230518150122803.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230518154018869.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230518160118276.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230518161942376.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230518163205880.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230518164140667.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230518170044346.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230518171104774.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528130010432.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528141445828.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528144912141.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528145254800.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528150844128.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528151704324.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528152603160.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528153147163.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528153255732.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528160530816.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528155257804.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528160553832.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528171600254.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230529203344173.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230529204213232.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230529205010426.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230529210322971.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230529210616933.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230529211045422.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230529211059007.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230529211708274.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530104526960.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530112053633.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530124448776.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530124835651.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530130901615.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530132204861.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530133728815.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530134659332.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530135356839.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530135902882.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530192809660.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530193556966.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530194432937.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530200004843.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530200614422.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530200925564.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530215144034.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530220728994.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230531095651457.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230531095545741.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230531105901120.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230531110714412.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230531113514416.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230531112717690.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230531133126758.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230531134700621.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230531143041896.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230609153221116.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230609155142232.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230609160227418.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230609161327736.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711103421403.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711103208976.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711110249938.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711111102518.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711111833403.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711142511891.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711142536025.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711142846401.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711143546194.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711144447440.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711144615462.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711145211456.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711145521073.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711150915653.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711154726911.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711155355589.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711155536393.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711155719096.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711161106242.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711161901208.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711162120179.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230712145001503.png"><meta property="article:published_time" content="2023-09-20T01:00:00.000Z"><meta property="article:modified_time" content="2023-09-20T01:00:00.000Z"><meta property="article:author" content="DavidingPlus"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.davidingplus.cn/images/2025/01/30/image-20230412174017480.png"><title>ä¾¯æ·è€å¸ˆ C++ è¯¾ç¨‹ | DavidingPlus's Blog</title><link ref="canonical" href="https://blog.davidingplus.cn/posts/2abc6e08.html"><link rel="dns-prefetch" href="https://cdn.davidingplus.cn"><link rel="stylesheet" href="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/css/fontawesome.css" type="text/css"><link rel="stylesheet" href="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/css/fancybox.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.8.6"><script>var Stun=window.Stun||{},CONFIG={root:"/",algolia:void 0,assistSearch:["bing","baidu"],fontIcon:{prompt:{success:"fas fa-check-circle",info:"fas fa-arrow-circle-right",warning:"fas fa-exclamation-circle",error:"fas fa-times-circle"},copyBtn:"fas fa-copy"},sidebar:{offsetTop:"55px",tocMaxDepth:6},header:{enable:!0,showOnPost:!0,scrollDownIcon:!0},postWidget:{endText:!0},nightMode:{enable:!0},back2top:{enable:!0},back2bottom:{enable:!0},codeblock:{style:"default",highlight:"light",wordWrap:!0},reward:!0,fancybox:!0,zoomImage:{gapAside:"20px"},galleryWaterfall:{colWidth:"255px",gapX:"65px"},lazyload:!0,pjax:{avoidBanner:!0},externalLink:{icon:{enable:!0,name:"fas fa-external-link-alt"}},shortcuts:void 0,prompt:{copyButton:"å¤åˆ¶",copySuccess:"æ­å–œäº²äº²ï¼Œå¤åˆ¶æˆåŠŸå’§",copyError:"å“å‘€ï¼Œå¤åˆ¶å¤±è´¥äº†"},sourcePath:{js:"js",css:"css",images:"images"},utterancesTheme:{light:"github-light",dark:"photon-dark"}};window.CONFIG=CONFIG</script><meta name="generator" content="Hexo 7.2.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">é¦–é¡µ</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">å½’æ¡£</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">åˆ†ç±»</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="javascript:;" onclick="return!1"><span class="header-nav-menu-item__icon"><i class="fas fa-bars"></i></span><span class="header-nav-menu-item__text">å…¶ä»–</span></a><div class="header-nav-submenu"><div class="header-nav-submenu-item"><a class="header-nav-submenu-item__link" href="/friends/"><span class="header-nav-submenu-item__icon"><i class="fas fa-users"></i></span><span class="header-nav-submenu-item__text">å‹é“¾</span></a></div><div class="header-nav-submenu-item"><a class="header-nav-submenu-item__link" href="/gallery/"><span class="header-nav-submenu-item__icon"><i class="fas fa-images"></i></span><span class="header-nav-submenu-item__text">ç›¸å†Œ</span></a></div></div></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/about/"><span class="header-nav-menu-item__icon"><i class="fas fa-user"></i></span><span class="header-nav-menu-item__text">å…³äº</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" target="_blank" rel="noopener" href="https://davidingplus.cn/"><span class="header-nav-menu-item__icon"><i class="fas fa-pager"></i></span><span class="header-nav-menu-item__text">ç«™ç‚¹ä¸»é¡µ</span></a></div></div><div class="header-nav-search"><span class="header-nav-search__icon"><i class="fas fa-search"></i></span><span class="header-nav-search__text">æœç´¢</span></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">DavidingPlus's Blog</div><div class="header-banner-info__subtitle">ğŸ•Šï¸ world peace</div></div><div class="header-banner-arrow"><div class="header-banner-arrow__icon"><i class="fas fa-angle-down"></i></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">ä¾¯æ·è€å¸ˆ C++ è¯¾ç¨‹</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">å‘è¡¨äº</span><span class="post-meta-item__value">2023-09-20</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">æ›´æ–°äº</span><span class="post-meta-item__value">2023-09-20</span></span><span class="post-meta-item post-meta-item--wordcount"><span class="post-meta-item__icon"><i class="far fa-file-word"></i></span><span class="post-meta-item__info">å­—æ•°ç»Ÿè®¡</span><span class="post-meta-item__value">47.6k</span></span><span class="post-meta-item post-meta-item--readtime"><span class="post-meta-item__icon"><i class="far fa-clock"></i></span><span class="post-meta-item__info">é˜…è¯»æ—¶é•¿</span><span class="post-meta-item__value">385åˆ†</span></span><span class="post-meta-item post-meta-item--visitors"><span class="post-meta-item__icon"><i class="fas fa-eye"></i></span><span class="post-meta-item__info">é˜…è¯»æ¬¡æ•°</span><span class="post-meta-item__value" id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body"><meta name="referrer" content="no-referrer"><h1 id="é¢å‘å¯¹è±¡é«˜çº§å¼€å‘"><a href="#é¢å‘å¯¹è±¡é«˜çº§å¼€å‘" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#é¢å‘å¯¹è±¡é«˜çº§å¼€å‘"></a> é¢å‘å¯¹è±¡é«˜çº§å¼€å‘</h1><h2 id="headerå¤´æ–‡ä»¶çš„é˜²å«å¼å£°æ˜"><a href="#headerå¤´æ–‡ä»¶çš„é˜²å«å¼å£°æ˜" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#headerå¤´æ–‡ä»¶çš„é˜²å«å¼å£°æ˜"></a> Headerå¤´æ–‡ä»¶çš„é˜²å«å¼å£°æ˜</h2><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//complex.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __COMPLEX__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __COMPLEX__</span></span><br><span class="line"><span class="comment">//å«ä¹‰:å¦‚æœç¨‹åºæ²¡æœ‰å®šä¹‰è¿‡ï¼Œé‚£ä¹ˆå®šä¹‰å‡ºæ¥ï¼Œèµ°ä¸»ä½“å†…å®¹ï¼›å¦‚æœç¨‹åºå®šä¹‰è¿‡ï¼Œç¬¬äºŒæ¬¡includeæ—¶ï¼Œé‚£ä¹ˆå°±ä¸èµ°ï¼Œç›´æ¥è¿”å›ï¼Œä¸ä¼šæœ‰é‡å¤includeçš„åŠ¨ä½œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ä¸»ä½“å†…å®¹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></div></figure><span id="more"></span><h2 id="inline-å‡½æ•°"><a href="#inline-å‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#inline-å‡½æ•°"></a> inline å‡½æ•°</h2><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">complex</span>&#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">complex</span>();</span><br><span class="line">    </span><br><span class="line">   	<span class="function"><span class="type">double</span> <span class="title">real</span><span class="params">()</span> <span class="type">const</span> </span>&#123;<span class="keyword">return</span> re; &#125;<span class="comment">//å¦‚æœå‡½æ•°åœ¨ç±»å†…å£°æ˜å¹¶ä¸”å®šä¹‰å®Œæˆï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±æ˜¯ä¸ªinlineå‡½æ•°</span></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> re,im;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">double</span></span></span><br><span class="line"><span class="function"><span class="title">real</span><span class="params">(<span class="type">const</span> complex&amp; x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x.<span class="built_in">real</span>();</span><br><span class="line">&#125;<span class="comment">//inlineçš„æ‰§è¡Œé€Ÿåº¦ä¼šå¿«ä¸€ç‚¹!</span></span><br></pre></td></tr></table></div></figure><p>ä¸ºäº†å‡å°‘æ—¶é—´å¼€é”€ï¼Œå¦‚æœåœ¨ç±»ä½“ä¸­å®šä¹‰çš„æˆå‘˜å‡½æ•°ä¸­ä¸åŒ…æ‹¬å¾ªç¯ç­‰æ§åˆ¶ç»“æ„ï¼ŒC++ç³»ç»Ÿä¼šè‡ªåŠ¨å°†å®ƒä»¬ä½œä¸ºå†…ç½®(inline)å‡½æ•°æ¥å¤„ç†ã€‚</p><p>C++è¦æ±‚å¯¹ä¸€èˆ¬çš„å†…ç½®å‡½æ•°è¦ç”¨å…³é”®å­—inlineå£°æ˜ï¼Œä½†å¯¹ç±»å†…å®šä¹‰çš„æˆå‘˜å‡½æ•°ï¼Œå¯ä»¥çœç•¥inlineï¼Œå› ä¸ºè¿™äº›æˆå‘˜å‡½æ•°å·²è¢«éšå«åœ°æŒ‡å®šä¸ºå†…ç½®å‡½æ•°ã€‚</p><p>å¦‚æœæˆå‘˜å‡½æ•°ä¸åœ¨ç±»ä½“å†…å®šä¹‰ï¼Œè€Œåœ¨ç±»ä½“å¤–å®šä¹‰ï¼Œç³»ç»Ÿå¹¶ä¸æŠŠå®ƒé»˜è®¤ä¸ºå†…ç½®(inline)å‡½æ•°ï¼Œè°ƒç”¨è¿™äº›æˆå‘˜å‡½æ•°çš„è¿‡ç¨‹å’Œè°ƒç”¨ä¸€èˆ¬å‡½æ•°çš„è¿‡ç¨‹æ˜¯ç›¸åŒçš„ã€‚å¦‚æœæƒ³å°†è¿™äº›æˆå‘˜å‡½æ•°æŒ‡å®šä¸ºå†…ç½®å‡½æ•°ï¼Œåº”å½“ç”¨inlineä½œæ˜¾å¼å£°æ˜ã€‚</p><p>å¦‚æœå‡½æ•°å¤ªå¤æ‚ï¼Œç¼–è¯‘å™¨æ²¡æœ‰åŠæ³•æŠŠä»–çœ‹æˆ inline å‡½æ•°!! æ‰€ä»¥æˆ‘ä»¬åœ¨ç±»å†…å®ç°åªæ˜¯ä¸ºäº†å»ºè®®ç¼–è¯‘å™¨å°†å…¶çœ‹æˆ inline å‡½æ•°æ¥æé«˜æ•ˆç‡ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯ä¸æ˜¯ inline å‡½æ•°è¦çœ‹ç¼–è¯‘å™¨ï¼Œæˆ‘ä»¬ä¹Ÿä¸çŸ¥é“ï¼</p><h2 id="å•ä¾‹è®¾è®¡æ¨¡å¼æ„é€ å‡½æ•°åœ¨privateéƒ¨åˆ†"><a href="#å•ä¾‹è®¾è®¡æ¨¡å¼æ„é€ å‡½æ•°åœ¨privateéƒ¨åˆ†" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å•ä¾‹è®¾è®¡æ¨¡å¼æ„é€ å‡½æ•°åœ¨privateéƒ¨åˆ†"></a> å•ä¾‹è®¾è®¡æ¨¡å¼(æ„é€ å‡½æ•°åœ¨privateéƒ¨åˆ†)</h2><p>ä¾‹å­ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¤´æ–‡ä»¶ Stu.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __STU__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __STU__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Stu</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> Stu &amp;<span class="title">getInstance</span><span class="params">()</span></span>;<span class="comment">//å•ä¾‹è®¾è®¡æ¨¡å¼ åœ¨ä¸»ç¨‹åºå½“ä¸­åªèƒ½ä½¿ç”¨ä¸€ä»½è¿™ä¸ªç±»çš„æ•°æ® æ‰€æœ‰å…±äº« æ‰€ä»¥é™æ€å˜é‡æ”¾åœ¨å †åŒº</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">Stu</span>();</span><br><span class="line">    <span class="built_in">Stu</span>(<span class="type">int</span> id, string name);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> _ID;</span><br><span class="line">    string _name;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">Stu &amp;<span class="title">Stu::getInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> Stu stu;</span><br><span class="line">    <span class="keyword">return</span> stu;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></div></figure><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸»ç¨‹åº main.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Stu.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å•ä¾‹è®¾è®¡æ¨¡å¼</span></span><br><span class="line">    <span class="comment">// æ„é€ å‡½æ•°åœ¨privateé‡Œé¢ æ•´ä¸ªç±»æ˜¯æ”¾åœ¨staticå †åŒºçš„ æ‰€æœ‰ç”¨æˆ·åªç”¨ä¸€ä»½è¿™ä¸ªç±»çš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">auto</span> stu = Stu::<span class="built_in">getInstance</span>(); <span class="comment">// è¿™æ ·å°±åˆ›é€ å‡ºæ¥äº†ä¸€ä¸ªç±» å¹¶ä¸”æ˜¯é™æ€å˜é‡!!!ç¨‹åºå…±äº«è¿™ä¸€ä»½</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h2 id="const-å¸¸é‡æˆå‘˜å‡½æ•°"><a href="#const-å¸¸é‡æˆå‘˜å‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#const-å¸¸é‡æˆå‘˜å‡½æ•°"></a> const å¸¸é‡æˆå‘˜å‡½æ•°</h2><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//complexç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">complex</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">complex</span>(<span class="type">double</span> r = <span class="number">0</span>, <span class="type">double</span> i = <span class="number">0</span>) : <span class="built_in">re</span>(r), <span class="built_in">im</span>(i) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">  <span class="function"><span class="type">double</span> <span class="title">real</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> re; &#125;</span><br><span class="line">  <span class="function"><span class="type">double</span> <span class="title">imag</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> im; &#125;<span class="comment">//æˆå‘˜å‡½æ•° ä¸æ”¹å˜ç±»æˆå‘˜å±æ€§çš„å€¼ å»ºè®®åŠ ä¸Šconstä¿®é¥°ï¼Œæ¢å¥è¯è¯´å°±æ˜¯æ‹¿æ•°æ®</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="type">double</span> re, im;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><p>æˆå‘˜å‡½æ•°ä¸æ”¹å˜ç±»æˆå‘˜å±æ€§çš„å€¼å»ºè®®åŠ ä¸Šconstä¿®é¥°ï¼Œæ¢å¥è¯è¯´å°±æ˜¯æ‹¿æ•°æ®.ä¾‹å¦‚ä¸Šé¢çš„real()å’Œimag()éƒ½ä¸æ”¹å˜æˆå‘˜å±æ€§çš„å€¼ï¼Œæ‰€ä»¥åŠ ä¸Šäº†constä¿®é¥°ã€‚</p><p>åœ¨ä¸Šé¢çš„ä¾‹å­å½“ä¸­ï¼Œå¦‚æœé‚£ä¸¤ä¸ªæˆå‘˜å‡½æ•°ä¸åŠ ä¸Šconstï¼Œä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸»å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">const</span> complex <span class="title">c</span><span class="params">(<span class="number">1</span>,<span class="number">2</span>)</span></span>;<span class="comment">//ä½¿ç”¨è€…å®šä¹‰è¿™ä¸ªç±»æ˜¯ä¸å¯ä»¥æ”¹å˜çš„</span></span><br><span class="line">std::cout&lt;&lt;c.<span class="built_in">real</span>();<span class="comment">//æ‰“å°real()</span></span><br></pre></td></tr></table></div></figure><p>è¿™æ˜¯æœªåŠ constçš„æˆå‘˜å‡½æ•°</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">double</span> <span class="title">real</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> re; &#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">imag</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> im; &#125;</span><br></pre></td></tr></table></div></figure><p>æ‰“å°real()ä¼šå‡ºé—®é¢˜ï¼Œå› ä¸ºä½¿ç”¨è€…ä¸æƒ³è¦æ”¹å˜cé‡Œé¢å…ƒç´ çš„å€¼ï¼Œä½†æ˜¯è¿™ä¸ªæˆå‘˜å‡½æ•°åœ¨è®¿é—®çš„æ—¶å€™ä¸åŠ constï¼Œç¼–è¯‘å™¨è®¤ä¸ºæœ‰å¯èƒ½ä¼šæ”¹å˜æˆå‘˜å‡½æ•°çš„å€¼ï¼Œè¿™ä¸¤è€…æ˜¯ç›¸äº’çŸ›ç›¾çš„ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Šconstæ¥ä¿è¯æ˜¯ä¸ä¼šæ”¹å˜å€¼çš„ã€‚</p><h2 id="å¼•ç”¨æŒ‡é’ˆå¸¸é‡-æŒ‡é’ˆæŒ‡å‘ä¸å¯ä¿®æ”¹"><a href="#å¼•ç”¨æŒ‡é’ˆå¸¸é‡-æŒ‡é’ˆæŒ‡å‘ä¸å¯ä¿®æ”¹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å¼•ç”¨æŒ‡é’ˆå¸¸é‡-æŒ‡é’ˆæŒ‡å‘ä¸å¯ä¿®æ”¹"></a> å¼•ç”¨(æŒ‡é’ˆå¸¸é‡ æŒ‡é’ˆæŒ‡å‘ä¸å¯ä¿®æ”¹)</h2><p>å¼•ç”¨çš„æœ¬è´¨: æ˜¯ä¸€ä¸ªæŒ‡é’ˆå¸¸é‡</p><p>ä¸ºä»€ä¹ˆé€‰æ‹©å¼•ç”¨: ä¼ é€’éå¸¸å¿«ï¼Œå¹¶ä¸”å¯ä»¥è§£å†³å½¢å‚ä¿®æ”¹ä¸æ”¹å˜å®å‚çš„é—®é¢˜</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a=<span class="number">10</span>;</span><br><span class="line"><span class="comment">//è‡ªåŠ¨è½¬æ¢ä¸º int* const ref = &amp;a; æŒ‡é’ˆå¸¸é‡æ˜¯æŒ‡é’ˆæŒ‡å‘ä¸å¯æ”¹ï¼Œä¹Ÿè¯´æ˜ä¸ºä»€ä¹ˆå¼•ç”¨ä¸å¯æ›´æ”¹</span></span><br><span class="line"><span class="type">int</span>&amp; ref = a; </span><br><span class="line">ref = <span class="number">20</span>; <span class="comment">//å†…éƒ¨å‘ç°refæ˜¯å¼•ç”¨ï¼Œè‡ªåŠ¨å¸®æˆ‘ä»¬è½¬æ¢ä¸º: *ref = 20;</span></span><br></pre></td></tr></table></div></figure><p>å¼•ç”¨æ˜¯ä¸å¯ä¿®æ”¹çš„ï¼Œå› ä¸ºå¼•ç”¨æœ¬è´¨æ˜¯æŒ‡é’ˆå¸¸é‡ï¼Œè¯¥æŒ‡é’ˆçš„å€¼æ˜¯ä¸å¯ä¿®æ”¹çš„ï¼Œä¹Ÿå°±æ˜¯æŒ‡å‘çš„åœ°å€åŒºåŸŸ(a)æ˜¯ä¸å¯ä»¥å˜åŠ¨çš„ï¼Œä½†æ˜¯è§£å¼•ç”¨ä¿®æ”¹æŒ‡å‘åŒºåŸŸçš„å€¼æ˜¯å®Œå…¨æ²¡æœ‰é—®é¢˜çš„ã€‚</p><p>æ‰€ä»¥è€ƒè™‘åˆ°è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œåœ¨å®é™…æ“ä½œè¿‡ç¨‹ä¸­å°½é‡ä¼ å…¥å¼•ç”¨ã€‚</p><h2 id="friend-å‹å…ƒ"><a href="#friend-å‹å…ƒ" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#friend-å‹å…ƒ"></a> friend å‹å…ƒ</h2><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//complexç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">complex</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">complex</span>(<span class="type">double</span> r = <span class="number">0</span>, <span class="type">double</span> i = <span class="number">0</span>) : <span class="built_in">re</span>(r), <span class="built_in">im</span>(i) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">  <span class="function"><span class="type">double</span> <span class="title">real</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> re; &#125;</span><br><span class="line">  <span class="function"><span class="type">double</span> <span class="title">imag</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> im; &#125;<span class="comment">//æˆå‘˜å‡½æ•° ä¸æ”¹å˜ç±»æˆå‘˜å±æ€§çš„å€¼ å»ºè®®åŠ ä¸Šconstä¿®é¥°ï¼Œæ¢å¥è¯è¯´å°±æ˜¯æ‹¿æ•°æ®</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="type">double</span> re, im;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">friend</span> complex &amp;__doapl(complex*, <span class="type">const</span> complex&amp; );<span class="comment">//ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥å¦ä¸€ä¸ªç±»å¯¹è±¡çš„å¼•ç”¨</span></span><br><span class="line">  <span class="comment">//friendå‹å…ƒè¡¨ç¤ºå¦ä¸€ä¸ªç±»å¯¹è±¡å¯ä»¥è®¿é—®æœ¬ç±»å½“ä¸­çš„ç§æœ‰æˆå‘˜å±æ€§</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> complex &amp;</span><br><span class="line">__doapl(complex *ths, <span class="type">const</span> complex &amp;r)</span><br><span class="line">&#123;</span><br><span class="line">  ths-&gt;re += r.re;<span class="comment">//è¿™é‡Œå°±å¯ä»¥ç›´æ¥è®¿é—®æœ¬ç±»çš„ç§æœ‰æˆå‘˜å±æ€§</span></span><br><span class="line">  ths-&gt;im += r.im;</span><br><span class="line">  <span class="keyword">return</span> *ths;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="é‡ç‚¹"><a href="#é‡ç‚¹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#é‡ç‚¹"></a> é‡ç‚¹ï¼š</h3><p>ç›¸åŒclassçš„å„ä¸ªobjectsäº’ä¸ºfriends å‹å…ƒ</p><p>è¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç±»å†…</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">func</span><span class="params">(<span class="type">const</span> complex&amp; param)</span></span>&#123; <span class="keyword">return</span> param.re + param.im;&#125;</span><br><span class="line"><span class="comment">//è¿™é‡Œä¸ºä»€ä¹ˆå¯ä»¥ç›´æ¥è®¿é—®ç§æœ‰æˆå‘˜å±æ€§</span></span><br><span class="line"><span class="comment">//ä¸»å‡½æ•°</span></span><br><span class="line">c<span class="number">2.f</span>unc(c1);</span><br></pre></td></tr></table></div></figure><p>ä¸¤ç§ç†è§£:</p><p>1.ç›¸åŒclassçš„å„ä¸ªobjectsäº’ä¸ºå‹å…ƒï¼Œæ‰€ä»¥å¯ä»¥è®¿é—®ç§æœ‰å±æ€§</p><p>2.ç§æœ‰æˆå‘˜å±æ€§å¯ä»¥ç±»å†…è®¿é—®ï¼Œç±»å¤–ä¸å¯ä»¥è®¿é—®ï¼Œéœ€è¦è®¿é—®éœ€è¦æˆå‘˜å‡½æ•°æ¥å£</p><h2 id="return-by"><a href="#return-by" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#return-by"></a> return by *</h2><h3 id="return-by-reference"><a href="#return-by-reference" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#return-by-reference"></a> return by reference</h3><p>ä¼ é€ç€æ— éœ€çŸ¥é“æ¥æ”¶è€…æ˜¯ä»¥referenceæ¥å—</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> complex&amp;</span><br><span class="line">complex::<span class="keyword">operator</span> += (<span class="type">const</span> complex &amp;r)&#123;</span><br><span class="line">    <span class="keyword">return</span> __doapl(<span class="keyword">this</span>,r);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>å®ç° += å·çš„é‡è½½(å¤æ•°)</p><p>ä¸ºä»€ä¹ˆè¦è¿”å› &amp; ï¼šå› ä¸ºä¸èƒ½åˆ›å»ºæ–°å¯¹è±¡ï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯ä¿®æ”¹åŸå¯¹è±¡ï¼ï¼ï¼</p><p>è¿™æ ·åšå¯ä»¥å®ç°è¿åŠ æ“ä½œ c1 += c2 + =c3</p><p>å…³äºè¿ç®—ç¬¦é‡è½½è¿”å›referenceè¿˜æœ‰ä¸€ä¸ªä¾‹å­</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Stu</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// ç±»å†…çš„å‡½æ•°ä¼šé»˜è®¤ä¸ºå†…ç½®inlineå‡½æ•°</span></span><br><span class="line">    <span class="built_in">Stu</span>();</span><br><span class="line">    <span class="built_in">Stu</span>(<span class="type">int</span> id, string name) : _ID(id), _name(name) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getID</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>-&gt;_ID; &#125;</span><br><span class="line">    <span class="function">string <span class="title">getName</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>-&gt;_name; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> _ID;</span><br><span class="line">    string _name;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿™ç§ç‰¹æ®Šçš„æ“ä½œç¬¦é‡è½½åªèƒ½å†™åœ¨å…¨å±€ï¼Œå› ä¸ºå†™åœ¨ç±»é‡Œé¢æ— æ³•è¾¾åˆ° cout&lt;&lt;p çš„æ•ˆæœ</span></span><br><span class="line"><span class="keyword">inline</span> ostream &amp; <span class="comment">//è¿”å›ostreamæ ‡å‡†æµçš„å¼•ç”¨</span></span><br><span class="line"><span class="comment">//å…³äºè¿”å›å€¼ éœ€è¦è€ƒè™‘è¿ä¼ çš„è¯éœ€è¦è¿”å›å¼•ç”¨!!!</span></span><br><span class="line"><span class="keyword">operator</span>&lt;&lt;(ostream &amp;os, Stu &amp;s)</span><br><span class="line">&#123;</span><br><span class="line">    os &lt;&lt; s.<span class="built_in">getID</span>() &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; s.<span class="built_in">getName</span>() &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> cout;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">Stu <span class="title">s</span><span class="params">(<span class="number">1</span>, <span class="string">&quot;å¼ ä¸‰&quot;</span>)</span></span>;</span><br><span class="line">    cout &lt;&lt; s;<span class="comment">//è¿™æ ·å¯ä»¥å®ç°è¿ &lt;&lt;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="return-by-value"><a href="#return-by-value" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#return-by-value"></a> return by value:</h3><p>ä»€ä¹ˆæ—¶å€™åªèƒ½return by value?æˆ‘ä»¬åº”è¯¥ä¼˜å…ˆè€ƒè™‘return by referenceï¼Œä½†æ˜¯åœ¨è¿™ä¸ªå‡½æ•°è¿”å›å€¼çš„æ—¶å€™éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡çš„æ—¶å€™åªèƒ½return by value</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> complex</span><br><span class="line"><span class="keyword">operator</span>+(<span class="type">const</span> complex &amp;x,<span class="type">const</span> complex &amp;y)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">complex</span>(<span class="built_in">real</span>(x)+<span class="built_in">real</span>(y),<span class="built_in">imag</span>(x)+<span class="built_in">imag</span>(y));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c2=c1+c2;<span class="comment">//è¿™è¡Œä»£ç çš„æ„æ€æ˜¯c1+c2åˆ›å»ºå‡ºæ¥ä¸€ä¸ªæ–°çš„å¯¹è±¡èµ‹å€¼ç»™c2!!!</span></span><br></pre></td></tr></table></div></figure><h2 id="class-with-pointer-members-å¸¦æœ‰æŒ‡é’ˆçš„ç±»"><a href="#class-with-pointer-members-å¸¦æœ‰æŒ‡é’ˆçš„ç±»" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#class-with-pointer-members-å¸¦æœ‰æŒ‡é’ˆçš„ç±»"></a> class with pointer members å¸¦æœ‰æŒ‡é’ˆçš„ç±»</h2><p>æ¯”è¾ƒç»å…¸çš„ç±»å°±æ˜¯stringå­—ç¬¦ä¸²ç±»,å¿…é¡»æœ‰æ‹·è´æ„é€  copy ctorå’Œæ‹·è´èµ‹å€¼ copy op=</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">String</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">String</span>(<span class="type">const</span> <span class="type">char</span> *cstr = <span class="number">0</span>);</span><br><span class="line">    <span class="comment">// åªè¦ç±»å¸¦æŒ‡é’ˆï¼Œä¸€å®šè¦é‡å†™ä»¥ä¸‹ä¸¤ä¸ªå‡½æ•°!!!</span></span><br><span class="line">    <span class="comment">// ä¸é‡å†™çš„è¯ç¼–è¯‘å™¨é»˜è®¤çš„æ„é€ å‡½æ•°æ˜¯æµ…æ‹·è´ ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘åŒä¸€å—å†…å­˜å¯¹è±¡!!!</span></span><br><span class="line">    <span class="comment">// å½“ç„¶è¿™é‡Œçš„æ‹·è´æŒ‡çš„æ˜¯æ·±æ‹·è´</span></span><br><span class="line">    <span class="built_in">String</span>(<span class="type">const</span> String &amp;str);            <span class="comment">// æ‹·è´æ„é€ </span></span><br><span class="line">    String &amp;<span class="keyword">operator</span>=(<span class="type">const</span> String &amp;str); <span class="comment">// æ‹·è´èµ‹å€¼</span></span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">String</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">char</span> *<span class="title">get_c_str</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>-&gt;_data; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">char</span> *_data;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><p>å½“ç„¶è¿™é‡Œçš„æ‹·è´æŒ‡çš„æ˜¯æ·±æ‹·è´!!!</p><p>Big Three:æ‹·è´æ„é€ ï¼Œæ‹·è´èµ‹å€¼ï¼Œææ„å‡½æ•°!!!</p><h3 id="æ‹·è´èµ‹å€¼æ£€æµ‹è‡ªæˆ‘èµ‹å€¼"><a href="#æ‹·è´èµ‹å€¼æ£€æµ‹è‡ªæˆ‘èµ‹å€¼" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ‹·è´èµ‹å€¼æ£€æµ‹è‡ªæˆ‘èµ‹å€¼"></a> æ‹·è´èµ‹å€¼:æ£€æµ‹è‡ªæˆ‘èµ‹å€¼</h3><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> String &amp;String::<span class="keyword">operator</span>=(<span class="type">const</span> String &amp;str)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// æ·±æ‹·è´èµ‹å€¼ å…ˆæŠŠè‡ªèº«æ€æ‰ ç„¶åé‡æ–°åˆ›å»º</span></span><br><span class="line">    <span class="comment">// æ£€æµ‹è‡ªæˆ‘èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;str)</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span>[] <span class="keyword">this</span>-&gt;_data;</span><br><span class="line">    <span class="comment">// æ·±æ‹·è´</span></span><br><span class="line">    <span class="keyword">this</span>-&gt;_data = <span class="keyword">new</span> <span class="type">char</span>[<span class="built_in">strlen</span>(str) + <span class="number">1</span>];</span><br><span class="line">    <span class="built_in">strcpy</span>(<span class="keyword">this</span>-&gt;_data, str._data);</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è¿™é‡Œä¸ºä»€ä¹ˆè¦æ£€æµ‹è‡ªæˆ‘èµ‹å€¼ï¼šå› ä¸ºä¸æ£€æµ‹è‡ªæˆ‘èµ‹å€¼çš„è¯ï¼Œå¦‚æœä½¿ç”¨è€…è°ƒç”¨è‡ªæˆ‘èµ‹å€¼çš„æ—¶å€™ï¼Œç¬¬ä¸€æ­¥å°±ä¼šæŠŠå”¯ä¸€çš„è‡ªèº«è¿™ä¸ª_dataæ€æ‰ï¼Œåç»­å°±æ²¡æœ‰åŠæ³•è¿›è¡Œäº†ï¼Œä¼šå‡ºç°å®‰å…¨éšæ‚£!!!è¿™ä¹Ÿæ˜¯ä¸ºäº†å®‰å…¨å’Œä¸¥è°¨æ€§è€ƒè™‘çš„</p><h2 id="ä¸€äº›å¯¹è±¡çš„ç”Ÿå‘½æœŸ"><a href="#ä¸€äº›å¯¹è±¡çš„ç”Ÿå‘½æœŸ" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä¸€äº›å¯¹è±¡çš„ç”Ÿå‘½æœŸ"></a> ä¸€äº›å¯¹è±¡çš„ç”Ÿå‘½æœŸ</h2><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">complex</span>&#123; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">complex <span class="title">c3</span><span class="params">(<span class="number">1</span>,<span class="number">2</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">complex <span class="title">c1</span><span class="params">(<span class="number">1</span>,<span class="number">2</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> complex <span class="title">c2</span><span class="params">(<span class="number">1</span>,<span class="number">2</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    complex *c4=<span class="keyword">new</span> <span class="built_in">complex</span>(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">delete</span> c4;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>C++ç¨‹åºåœ¨æ‰§è¡Œæ—¶ï¼Œå°†å†…å­˜å¤§æ–¹å‘åˆ’åˆ†ä¸º4ä¸ªåŒºåŸŸ<br>ä»£ç åŒºï¼šå­˜æ”¾å‡½æ•°ä½“çš„äºŒè¿›åˆ¶ä»£ç ï¼Œç”±æ“ä½œç³»ç»Ÿè¿›è¡Œç®¡ç†ã€‚<br>å…¨å±€åŒºï¼šå­˜æ”¾å…¨å±€å˜é‡å’Œé™æ€å˜é‡ä»¥åŠå¸¸é‡ã€‚<br>æ ˆåŒºï¼šç”±ç¼–è¯‘å™¨è‡ªåŠ¨åˆ†é…é‡Šæ”¾ï¼Œå­˜æ”¾å‡½æ•°çš„å‚æ•°å€¼ï¼Œå±€éƒ¨å˜é‡ç­‰ã€‚<br>å †åŒºï¼šç”±ç¨‹åºå‘˜åˆ†é…å’Œé‡Šæ”¾ï¼Œè‹¥ç¨‹åºå‘˜ä¸é‡Šæ”¾ï¼Œç¨‹åºç»“æŸæ—¶ç”±æ“ä½œç³»ç»Ÿå›æ”¶ã€‚</p><p>c1 :å­˜æ”¾åœ¨æ ˆå½“ä¸­ï¼Œå½“ä½œç”¨åŸŸ(è¿™é‡Œæ˜¯mainå‡½æ•°)ç»“æŸçš„æ—¶å€™å°±ä¼šè¢«è‡ªåŠ¨æ¸…ç†</p><p>c2 :é™æ€å˜é‡ï¼Œå­˜æ”¾äºå…¨å±€é™æ€åŒºï¼Œå½“æ•´ä¸ªç¨‹åºç»“æŸä¹‹åæ‰ä¼šè¢«é‡Šæ”¾</p><p>c3: å…¨å±€å˜é‡ï¼Œå­˜æ”¾äºå…¨å±€åŒºï¼Œå½“æ•´ä¸ªç¨‹åºç»“æŸä¹‹åæ‰ä¼šè¢«é‡Šæ”¾</p><p>c4: newå‡ºæ¥çš„ï¼ŒåŠ¨æ€åˆ†é…å†…å­˜ï¼Œå­˜æ”¾äºå †åŒºï¼Œæ³¨æ„newäº†ä¹‹åè®°å¾—åœ¨ä½œç”¨åŸŸç»“æŸä¹‹å‰å°†å…¶deleteæ‰</p><p>â€‹ å¦åˆ™ä¼šå‡ºç°å†…å­˜æ³„éœ²çš„é—®é¢˜ï¼Œå½“ä½œç”¨åŸŸç»“æŸä¹‹åc4æŒ‡é’ˆä¼šè¢«é‡Šæ”¾æ‰ï¼Œä½†æ˜¯ä»–æ‰€æŒ‡å‘çš„å†…å­˜æ²¡æœ‰è¢«é‡Šæ”¾!!!ä¸€èˆ¬å†™ææ„å‡½æ•°è§£å†³è¿™ä¸ªé—®é¢˜</p><h2 id="newå’Œdelete"><a href="#newå’Œdelete" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#newå’Œdelete"></a> newå’Œdelete</h2><h3 id="new-å…ˆåˆ†é…å†…å­˜ç©ºé—´å†è°ƒç”¨æ„é€ å‡½æ•°"><a href="#new-å…ˆåˆ†é…å†…å­˜ç©ºé—´å†è°ƒç”¨æ„é€ å‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#new-å…ˆåˆ†é…å†…å­˜ç©ºé—´å†è°ƒç”¨æ„é€ å‡½æ•°"></a> new: å…ˆåˆ†é…å†…å­˜ç©ºé—´ï¼Œå†è°ƒç”¨æ„é€ å‡½æ•°</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230412174017480.png" alt="image-20230412174017480"></p><h3 id="delete-å…ˆè°ƒç”¨ææ„å‡½æ•°å†é‡Šæ”¾å†…å­˜ç©ºé—´"><a href="#delete-å…ˆè°ƒç”¨ææ„å‡½æ•°å†é‡Šæ”¾å†…å­˜ç©ºé—´" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#delete-å…ˆè°ƒç”¨ææ„å‡½æ•°å†é‡Šæ”¾å†…å­˜ç©ºé—´"></a> delete: å…ˆè°ƒç”¨ææ„å‡½æ•°ï¼Œå†é‡Šæ”¾å†…å­˜ç©ºé—´</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230412174017480.png" alt="image-20230412174017480"></p><h3 id="array-new-ä¸€å®šè¦æ­é…-array-delete"><a href="#array-new-ä¸€å®šè¦æ­é…-array-delete" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#array-new-ä¸€å®šè¦æ­é…-array-delete"></a> array new ä¸€å®šè¦æ­é… array delete!!!</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230412185656797.png" alt="image-20230412185656797"></p><p>å†™äº† [] çš„è¯ç¼–è¯‘å™¨æ‰ä¼šçŸ¥é“ä½ ä¸ä»…è¦åˆ é™¤pè¿™ä¸ªç±»å¯¹è±¡æŒ‡é’ˆ,è¿˜è¦æŠŠè¿™ä¸ªpå¯¹è±¡æŒ‡é’ˆæŒ‡å‘çš„æ•°ç»„å…ƒç´ ç»™å…¨éƒ¨åˆ é™¤æ‰ï¼Œå› ä¸º String* pæ—¢å¯ä»¥è¡¨ç¤ºå•ä¸ªçš„ç±»å¯¹è±¡æŒ‡é’ˆä¹Ÿå¯ä»¥è¡¨ç¤ºç±»å¯¹è±¡æ•°ç»„çš„é¦–å…ƒç´ åœ°å€æŒ‡é’ˆ!!! æ‰€ä»¥å¿…é¡»è¦è¦å†™ [] ,å¦åˆ™åªä¼šåˆ é™¤æ‰p[0]æ‰€å¯¹åº”çš„å…ƒç´ !!!</p><h2 id="static-é™æ€"><a href="#static-é™æ€" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#static-é™æ€"></a> static é™æ€</h2><p>é™æ€å˜é‡å’Œé™æ€å‡½æ•°å¾ˆç‰¹æ®Šï¼Œå…·ä½“çœ‹ä¸‹é¢ä»£ç :</p><p>é™æ€å‡½æ•°ç”±äºæ²¡æœ‰thisæŒ‡é’ˆï¼Œæ‰€ä»¥åªèƒ½å¤„ç†é™æ€å˜é‡!!!</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Account</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">static</span> <span class="type">double</span> _rate;                      <span class="comment">// é™æ€æˆå‘˜å˜é‡ä¸€ä¸ªç¨‹åºåªæœ‰ä¸€ä»½ï¼Œç±»å†…å£°æ˜ï¼Œç±»å¤–åˆå§‹åŒ–</span></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">set_rate</span><span class="params">(<span class="type">const</span> <span class="type">double</span> &amp;rate)</span></span>; <span class="comment">// é™æ€æˆå‘˜å‡½æ•°ï¼Œè°ƒç”¨æ—¶å¯ä»¥å£°æ˜ç±»å¯¹è±¡ï¼Œå¯ä»¥è°ƒç”¨ä½œç”¨åŸŸç›´æ¥è®¿é—®ï¼Œç±»å¤–å®ç°ï¼Œç±»å¤–å®ç°çš„æ—¶å€™ä¸ç”¨åŠ å…³é”®å­—static,ä½†æ˜¯è¦åŠ ä½œç”¨åŸŸ</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">double</span> Account::_rate = <span class="number">8.0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Account::set_rate</span><span class="params">(<span class="type">const</span> <span class="type">double</span> &amp;rate)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Account::_rate = rate;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; Account::_rate &lt;&lt; endl;</span><br><span class="line">    Account::<span class="built_in">set_rate</span>(<span class="number">7.0</span>);</span><br><span class="line">    cout &lt;&lt; Account::_rate &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="è¿›ä¸€æ­¥è¡¥å……æŠŠæ„é€ å‡½æ•°æ”¾åœ¨-private-é‡Œé¢å•ä¾‹è®¾è®¡æ¨¡å¼"><a href="#è¿›ä¸€æ­¥è¡¥å……æŠŠæ„é€ å‡½æ•°æ”¾åœ¨-private-é‡Œé¢å•ä¾‹è®¾è®¡æ¨¡å¼" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è¿›ä¸€æ­¥è¡¥å……æŠŠæ„é€ å‡½æ•°æ”¾åœ¨-private-é‡Œé¢å•ä¾‹è®¾è®¡æ¨¡å¼"></a> è¿›ä¸€æ­¥è¡¥å……ï¼šæŠŠæ„é€ å‡½æ•°æ”¾åœ¨ private é‡Œé¢ï¼Œå•ä¾‹è®¾è®¡æ¨¡å¼</h3><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Stu</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> Stu &amp;<span class="title">getInstance</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> s; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setup</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ; <span class="comment">// ä¸€ç³»åˆ—çš„æ¥å£æ“ä½œ</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">Stu</span>();</span><br><span class="line">    <span class="built_in">Stu</span>(<span class="type">int</span> id, string name);</span><br><span class="line">    <span class="type">int</span> _ID;</span><br><span class="line">    string _name;</span><br><span class="line"></span><br><span class="line">    <span class="type">static</span> Stu s;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><p>è¿™é‡Œçš„å°±æ˜¯æŠŠæ„é€ å‡½æ•°æ”¾åœ¨ private å½“ä¸­ï¼Œå¯¹å¤–ç•Œçš„æ¥å£å°±æ˜¯è¿™ä¸ª getInstance()ï¼Œè¿™ä¸ªå‡½æ•°è¿”å›é™æ€å˜é‡ s ï¼Œåªæœ‰ä¸€ä»½ï¼Œé€šè¿‡ setup() æ¥å£è¿›è¡Œå¯¹è¿™ä¸ªç±»å†…æˆå‘˜çš„è®¿é—®å’Œä¿®æ”¹!!!</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stu::<span class="built_in">getInstance</span>().<span class="built_in">setup</span>();</span><br></pre></td></tr></table></div></figure><p>ä¼˜åŒ–çš„å†™æ³•ï¼š</p><p>ç”±äºè¿™é‡Œåœ¨æ„å»ºç±»çš„æ—¶å€™å°±å¼•å…¥äº†é™æ€æˆå‘˜å˜é‡ï¼Œåœ¨æ²¡æœ‰è°ƒç”¨çš„æ—¶å€™å¯èƒ½ä¼šå¯¼è‡´èµ„æºæµªè´¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†è¿™ä¸ªé™æ€æˆå‘˜å˜é‡åœ¨é™æ€å‡½æ•°ä¸­åˆ›å»ºå°±å¥½äº†ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™åˆ›å»ºï¼Œç„¶åç”Ÿå‘½å‘¨æœŸä¸€ç›´æŒç»­åˆ°ç¨‹åºç»“æŸ</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> Stu&amp; <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">static</span> Stu s;</span><br><span class="line">	<span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h2 id="æ¨¡æ¿"><a href="#æ¨¡æ¿" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ¨¡æ¿"></a> æ¨¡æ¿</h2><h3 id="ç±»æ¨¡æ¿"><a href="#ç±»æ¨¡æ¿" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç±»æ¨¡æ¿"></a> ç±»æ¨¡æ¿:</h3><p>ç”¨çš„æ—¶å€™å¿…é¡»è¦æ˜ç¡®æŒ‡å‡ºé‡Œé¢å‚æ•°çš„ç±»å‹</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">complex</span>&#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">complex</span>();</span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    T real;</span><br><span class="line">    T imag;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    complex&lt;<span class="type">int</span>&gt;<span class="built_in">c1</span>();</span><br><span class="line">    complex&lt;<span class="type">double</span>&gt;<span class="built_in">c2</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="å‡½æ•°æ¨¡æ¿"><a href="#å‡½æ•°æ¨¡æ¿" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å‡½æ•°æ¨¡æ¿"></a> å‡½æ•°æ¨¡æ¿:</h3><p>ç”¨çš„æ—¶å€™ä¸éœ€è¦æŒ‡æ˜å‡½æ•°å‚æ•°çš„ç±»å‹,å› ä¸ºç¼–è¯‘å™¨ä¼šè¿›è¡Œå®å‚çš„æ¨å¯¼</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">stone</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">stone</span>();</span><br><span class="line">    <span class="built_in">stone</span>(<span class="type">int</span> w, <span class="type">int</span> h, <span class="type">int</span> weight) : _w(w), _h(h), _weight(weight) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;=(<span class="type">const</span> stone &amp;sto) &#123; <span class="keyword">return</span> <span class="keyword">this</span>-&gt;_weight &lt;= sto._weight; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> _w, _h, _weight;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¨å±€å‡½æ•° æ¯”å¤§å°</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> T &amp;</span></span><br><span class="line"><span class="function"><span class="title">min</span><span class="params">(T &amp;a, T &amp;b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a &lt;= b ? a : b ?</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="built_in">main</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">1</span>, b = <span class="number">2</span>, c;</span><br><span class="line">    <span class="function">stone <span class="title">a1</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span>, <span class="title">a2</span><span class="params">(<span class="number">4</span>, <span class="number">5</span>, <span class="number">2</span>)</span>, a3</span>;</span><br><span class="line">    c = <span class="built_in">min</span>(a, b);</span><br><span class="line">    a3 = <span class="built_in">min</span>(a1, a2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h2 id="å‘½åç©ºé—´-namespace"><a href="#å‘½åç©ºé—´-namespace" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å‘½åç©ºé—´-namespace"></a> å‘½åç©ºé—´ namespace</h2><p>å°†è‡ªå·±å†™çš„ä¸œè¥¿å°è£…åœ¨ä¸€ä¸ªå‘½åç©ºé—´å½“ä¸­ï¼Œå¯ä»¥é˜²æ­¢ä¸å…¶ä»–äººåç§°ä¸€æ ·åŠŸèƒ½ä¸åŒçš„é—®é¢˜</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> std&#123;</span><br><span class="line">	;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h2 id="å¤åˆ-composition"><a href="#å¤åˆ-composition" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å¤åˆ-composition"></a> å¤åˆ composition</h2><p>ç®€å•æ¥ç†è§£å°±æ˜¯ ä¸€ä¸ªç±»åŒ…å«å¦ä¸€ä¸ªç±»å¯¹è±¡,æœ¬ç±»å¯ä»¥è°ƒç”¨å¦ä¸€ä¸ªç±»çš„åº•å±‚å‡½æ•°</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Adapter</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">queue</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	deque&lt;T&gt; c; <span class="comment">//åº•å±‚å®¹å™¨</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//ä»¥ä¸‹çš„æ“ä½œå…¨éƒ½æ˜¯ç”±cçš„åº•å±‚å‡½æ•°æ‰§è¡Œ</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">empty</span><span class="params">()</span><span class="type">const</span></span>&#123;<span class="keyword">return</span> c.<span class="built_in">empty</span>();&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><p>è¿™é‡Œå…¶å®åŒ…å«å¦ä¸€ç§è®¾è®¡æ¨¡å¼: Adapter</p><p>dequeæ˜¯åŒç«¯é˜Ÿåˆ—ï¼Œqueueæ˜¯å•ç«¯é˜Ÿåˆ—ï¼Œæ˜¾ç„¶dequeçš„åŠŸèƒ½è¦æ¯”queueåŠŸèƒ½å¼ºå¤§ï¼Œä»–å®Œå…¨å¯ä»¥é€‚é…(Adapter)queueçš„åŠŸèƒ½ï¼Œæ‰€ä»¥å¯ä»¥é‡‡ç”¨å¤åˆçš„æ–¹å¼ï¼Œqueueçš„æˆå‘˜å‡½æ•°è°ƒç”¨dequeä¸­çš„éƒ¨åˆ†æˆå‘˜å‡½æ•°æ¥å®ç°è‡ªå·±çš„åŠŸèƒ½!!!</p><p>ç”¨å›¾å¯ä»¥è¿™æ ·è¡¨ç¤º:</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230412202635207.png" alt="image-20230412202635207"></p><h3 id="å¤åˆä¸‹çš„æ„é€ å’Œææ„"><a href="#å¤åˆä¸‹çš„æ„é€ å’Œææ„" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å¤åˆä¸‹çš„æ„é€ å’Œææ„"></a> å¤åˆä¸‹çš„æ„é€ å’Œææ„</h3><p>æ„é€ : æ„é€ ç”±å†…è€Œå¤– æ³¨æ„å…ˆè°ƒç”¨çš„æ˜¯å†…éƒ¨çš„<strong>é»˜è®¤</strong>æ„é€ ï¼Œç¼–è¯‘å™¨æŒ‡å®šçš„ï¼Œä¹Ÿç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸï¼</p><p>ææ„: ææ„ç”±å¤–è€Œå†…</p><p>è¿™äº›æ˜¯ç¼–è¯‘å™¨å¸®æˆ‘å®‰æ’å¥½çš„ï¼Œä¸Šé¢æ˜¯æˆ‘ä»¬å¸Œæœ›çš„è®¾è®¡</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230412203303042.png" alt="image-20230412203303042"></p><h2 id="å§”æ‰˜-delefgation-composition-by-reference"><a href="#å§”æ‰˜-delefgation-composition-by-reference" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å§”æ‰˜-delefgation-composition-by-reference"></a> å§”æ‰˜ Delefgation â€“ Composition by reference</h2><p>æŠŠå¤åˆä¸‹é¢ä¼ å…¥çš„å‚æ•°ç±»å‹æ”¹ä¸ºæŒ‡é’ˆ!!!</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230412204435460.png" alt="image-20230412204435460"></p><h3 id="handlebody-pimpl"><a href="#handlebody-pimpl" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#handlebody-pimpl"></a> Handle/Body (pimpl)</h3><p>å›¾ç¤ºçš„è¿™ç§å†™æ³•å¾ˆæœ‰åï¼Œå·¦è¾¹æ˜¯ç”¨æˆ·çœ‹åˆ°çš„ç±»ï¼Œé‡Œé¢æœ‰è°ƒç”¨çš„æ¥å£è¿™äº›ï¼Œå³è¾¹æ˜¯çœŸæ­£å­—ç¬¦ä¸²çš„ç±»ï¼Œç”¨æ¥å°è£…å­—ç¬¦ä¸²çš„ç±»å‹è¿™äº›ã€‚</p><p>reference counting: è¿™ç§å†™æ³•åœ¨è¿™ä¸ªç‰¹æ®Šä¾‹å­å½“ä¸­å¯ä»¥å®ç°ï¼Œç”¨æˆ·åˆ›å»ºäº†ä¸‰ä¸ªStringå¯¹è±¡ï¼Œä½†æ˜¯æ¯ä¸ªå¯¹è±¡ä¸‹é¢å¯¹åº”çš„ rep æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡å…¶å®æ˜¯ä¸€å—å†…å­˜ï¼Œå› ä¸ºä»–ä»¬çš„å­—ç¬¦ä¸²æ˜¯ä¸€æ ·çš„ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘å†…å­˜çš„å¼€é”€ã€‚</p><h2 id="ç»§æ‰¿-inheritance"><a href="#ç»§æ‰¿-inheritance" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç»§æ‰¿-inheritance"></a> ç»§æ‰¿ inheritance</h2><p>æ„é€ :ç”±å†…è€Œå¤– è°ƒç”¨çˆ¶ç±»çš„<strong>é»˜è®¤</strong>æ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨æŒ‡å®šçš„ï¼Œä¹Ÿç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸï¼</p><p>ææ„:ç”±å¤–è€Œå†…</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230412210437066.png" alt="image-20230412210437066"></p><h3 id="è™šå‡½æ•°"><a href="#è™šå‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è™šå‡½æ•°"></a> è™šå‡½æ•°:</h3><p>override è¦†å†™ï¼šæ³¨æ„åªèƒ½ç”¨åœ¨è™šå‡½æ•°è¿™é‡Œ</p><p>non-virtual å‡½æ•°: çˆ¶ç±»ä¸å¸Œæœ›å­ç±»é‡å†™(override)å®ƒ</p><p>virtual å‡½æ•°ï¼šçˆ¶ç±»å¸Œæœ›å­ç±»é‡å†™(override)å®ƒï¼Œçˆ¶ç±»å¯¹å®ƒä¸€èˆ¬å·²ç»æœ‰é»˜è®¤å®šä¹‰</p><p>pure virtual å‡½æ•°(çº¯è™šå‡½æ•°)ï¼šçˆ¶ç±»å¸Œæœ›å­ç±»ä¸€å®šè¦é‡å†™(override)å®ƒï¼Œçˆ¶ç±»å¯¹å®ƒæ²¡æœ‰é»˜è®¤å®šä¹‰ï¼Œä¾‹å­ï¼šçˆ¶ç±»æ˜¯ä¸ªæŠ½è±¡ç±»</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230412212341135.png" alt="image-20230412212341135"></p><p>æ³¨æ„:å­ç±»è°ƒç”¨çˆ¶ç±»çš„å‡½æ•°ï¼Œå¦‚æœå­ç±»å½“ä¸­å¯¹çˆ¶ç±»çš„å‡½æ•°è¿›è¡Œäº†overrideï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨åˆ°è¿™ä¸ªè™šå‡½æ•°çš„æ—¶å€™å°±ä¼šè°ƒç”¨å­å‡½æ•°è¦†å†™çš„ç‰ˆæœ¬ï¼Œä»è€Œå®ç°æˆ‘ä»¬çš„éœ€æ±‚ï¼ï¼ï¼</p><p>ä¸‹é¢è¿˜æœ‰ä¸ªä¾‹å­:</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">speak</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> : <span class="keyword">public</span> Animal</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">speak</span><span class="params">()</span> </span>&#123; cout &lt;&lt; <span class="string">&quot;å–µå–µå–µ&quot;</span> &lt;&lt; endl; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> : <span class="keyword">public</span> Animal</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">speak</span><span class="params">()</span> </span>&#123; cout &lt;&lt; <span class="string">&quot;æ±ªæ±ªæ±ª&quot;</span> &lt;&lt; endl; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//ç”¨çˆ¶ç±»å¯¹è±¡æŒ‡é’ˆæ¥æ¥å—å­ç±»å¯¹è±¡ æ¥è¾¾åˆ°å­ç±»è°ƒç”¨çˆ¶ç±»å¯¹è±¡æˆå‘˜å‡½æ•°çš„ç›®çš„</span></span><br><span class="line">    Animal *cat = <span class="keyword">new</span> <span class="built_in">Cat</span>();</span><br><span class="line">    cat-&gt;<span class="built_in">speak</span>(); <span class="comment">// å–µå–µå–µ</span></span><br><span class="line"></span><br><span class="line">    Animal *dog = <span class="keyword">new</span> <span class="built_in">Dog</span>();</span><br><span class="line">    dog-&gt;<span class="built_in">speak</span>(); <span class="comment">// æ±ªæ±ªæ±ª</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>ç”¨çˆ¶ç±»å¯¹è±¡æŒ‡é’ˆæ¥æ¥å—å­ç±»å¯¹è±¡ æ¥è¾¾åˆ°å­ç±»è°ƒç”¨çˆ¶ç±»å¯¹è±¡æˆå‘˜å‡½æ•°çš„ç›®çš„ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥å®ç°å¤šæ€.</p><h2 id="è½¬æ¢å‡½æ•°-conversion-function"><a href="#è½¬æ¢å‡½æ•°-conversion-function" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è½¬æ¢å‡½æ•°-conversion-function"></a> è½¬æ¢å‡½æ•° conversion function</h2><p>ä½œç”¨ï¼šå¯ä»¥ç”¨äºç±»å‹çš„è½¬æ¢</p><p>é‡è½½ () è¿ç®—ç¬¦ åœ¨æ‹¬å·çš„å‰é¢åŠ ä¸Šè¿”å›çš„ç±»å‹ï¼Œæ‹¬å·å†…ä¸ä¼ å‚æ•°ï¼Œè¿”å›å€¼ç”±äºåœ¨æ‹¬å·å‰é¢å·²ç»æŒ‡å®šäº†ï¼Œæ‰€ä»¥çœç•¥ä¸å†™ï¼Œç¼–è¯‘å™¨æŒ‡å®šçš„</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">operator</span> <span class="title">double</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">double</span>)<span class="keyword">this</span>-&gt;_numerator / (<span class="type">double</span>)<span class="keyword">this</span>-&gt;_denominator;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ•´ä½“çš„ä¾‹å­:</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Fraction</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Fraction</span>(<span class="type">int</span> num, <span class="type">int</span> den = <span class="number">1</span>) : _numerator(num), _denominator(den) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è½¬æ¢å‡½æ•°</span></span><br><span class="line">    <span class="comment">// æ²¡æœ‰è¿”å›å€¼ï¼Œè½¬åŒ–çš„ç±»å‹åœ¨æ‹¬å·å‰é¢å·²ç»æŒ‡å®š</span></span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">double</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">double</span>)<span class="keyword">this</span>-&gt;_numerator / (<span class="type">double</span>)<span class="keyword">this</span>-&gt;_denominator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> _numerator;</span><br><span class="line">    <span class="type">int</span> _denominator;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">Fraction <span class="title">f</span><span class="params">(<span class="number">3</span>, <span class="number">5</span>)</span></span>;<span class="comment">//è¿™é‡Œé¦–å…ˆåˆ›å»ºäº†få¯¹è±¡ï¼Œè°ƒç”¨äº†æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="type">double</span> d = <span class="number">4</span> + f;</span><br><span class="line">    <span class="comment">//fæ˜¯ä¸ªç±»å¯¹è±¡ï¼Œä»–æ€ä¹ˆèƒ½ç›´æ¥å’Œdoubleç±»å‹ç›¸åŠ å‘¢ï¼Ÿ</span></span><br><span class="line">    <span class="comment">//å¦‚æœå†™äº† + å·è¿ç®—ç¬¦é‡è½½é‚£ä¹ˆå°±ç›´æ¥è°ƒç”¨å³å¯ï¼Œä½†æ˜¯è¿™é‡Œæ²¡å†™å•Šï¼Ÿ</span></span><br><span class="line">    <span class="comment">//æ‰€ä»¥è¿™é‡Œç¼–è¯‘å™¨å°±å»æ‰¾ä»€ä¹ˆä¸œè¥¿å¯ä»¥æŠŠfé‡Œé¢çš„å‚æ•°å˜ä¸ºdouble å°±æ‰¾åˆ°äº†è½¬æ¢å‡½æ•° è¿™é‡Œçš„fç»è¿‡ç¼–è¯‘ä¹‹åå°±è¿”å›åˆ†æ•°çš„å€¼ ä¹Ÿå°±æ˜¯0.6</span></span><br><span class="line">    cout &lt;&lt; d &lt;&lt; endl;<span class="comment">//4.6</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ³¨æ„mainå‡½æ•°é‡Œé¢çš„ç»†èŠ‚!!!</p><h2 id="å‡½æ•°å¯¹è±¡ä»¿å‡½æ•°-è°“è¯"><a href="#å‡½æ•°å¯¹è±¡ä»¿å‡½æ•°-è°“è¯" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å‡½æ•°å¯¹è±¡ä»¿å‡½æ•°-è°“è¯"></a> å‡½æ•°å¯¹è±¡(ä»¿å‡½æ•°) -&gt; è°“è¯</h2><p>è°“è¯:</p><p>1.å‡½æ•°æŒ‡é’ˆä½œè°“è¯</p><p>2.å‡½æ•°å¯¹è±¡(ä»¿å‡½æ•°)ä½œè°“è¯</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°æŒ‡é’ˆä½œè°“è¯</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Cmp</span><span class="params">(<span class="type">int</span> val1, <span class="type">int</span> val2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> val1 &lt;= val2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°å¯¹è±¡(ä»¿å‡½æ•°)ä½œè°“è¯</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Fuck</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> val1, <span class="type">int</span> val2)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> val1 &lt;= val2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; nums&#123;<span class="number">5</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>&#125;;</span><br><span class="line">    <span class="comment">// sort(nums.begin(), nums.end(), Cmp);</span></span><br><span class="line">    <span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>(), <span class="built_in">Fuck</span>());</span><br><span class="line">    for_each(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>(), [&amp;](<span class="type">int</span> val)</span><br><span class="line">             &#123; cout &lt;&lt; val &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;);</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>ä»¿å‡½æ•°(å‡½æ•°å¯¹è±¡): function like classes</p><p>åœ¨ç±»é‡Œé¢é‡è½½ () è¿ç®—ç¬¦</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">identity</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">const</span> T&amp; <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> T&amp; x)</span></span>&#123;<span class="keyword">return</span> x;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è°ƒç”¨çš„æ—¶å€™ identity() è¿™æ ·å°±æ˜¯ä¸€ä¸ªå‡½æ•°å¯¹è±¡</p><p>æ ‡å‡†åº“é‡Œé¢æœ‰å¾ˆå¤šä»¿å‡½æ•°ï¼Œè¿™äº›ä»¿å‡½æ•°éƒ½ç»§æ‰¿äº†ä¸€äº›æ ‡å‡†åº“é‡Œé¢çš„çˆ¶ç±»ï¼Œè¿™äº›çˆ¶ç±»å¤§å°ä¸º0ï¼Œæ²¡æœ‰æˆå‘˜å‡½æ•°ã€‚(æ ‡å‡†åº“)</p><h2 id="æ¨¡æ¿è¡¥å……-æˆå‘˜æ¨¡æ¿-member-template"><a href="#æ¨¡æ¿è¡¥å……-æˆå‘˜æ¨¡æ¿-member-template" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ¨¡æ¿è¡¥å……-æˆå‘˜æ¨¡æ¿-member-template"></a> æ¨¡æ¿è¡¥å……: æˆå‘˜æ¨¡æ¿ member template</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸‰ç§æ¨¡æ¿: ç±»æ¨¡æ¿ å‡½æ•°æ¨¡æ¿ æˆå‘˜æ¨¡æ¿</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230413163206633.png" alt="image-20230413163206633"></p><p>æ³¨æ„çœ‹æ³¨é‡Šè¿›è¡Œç†è§£!!!</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Base1 é±¼ç±» Derived1 é²«é±¼</span></span><br><span class="line"><span class="comment">// Base2 é¸Ÿç±» Derived2 éº»é›€</span></span><br><span class="line"><span class="comment">// ç›¸åº”çš„æœ‰ç»§æ‰¿å…³ç³»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Base1</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived1</span> : <span class="keyword">public</span> Base1</span><br><span class="line">&#123;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Base2</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived2</span> : <span class="keyword">public</span> Base2</span><br><span class="line">&#123;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç°åœ¨å®šä¹‰ä¸€ä¸ªpairç±»</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T1</span>, <span class="keyword">class</span> <span class="title class_">T2</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Pair</span></span><br><span class="line">&#123;</span><br><span class="line">    T1 _first;</span><br><span class="line">    T2 _second;</span><br><span class="line">    <span class="built_in">Pair</span>();</span><br><span class="line">    <span class="built_in">Pair</span>(<span class="type">const</span> T1 &amp;a, <span class="type">const</span> T2 &amp;b) : _first(a), _second(b) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ³¨æ„è¿™é‡Œæœ‰ä¸€ä¸ªPairçš„æ‹·è´èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">U1</span>, <span class="keyword">class</span> <span class="title class_">U2</span>&gt;</span><br><span class="line">    <span class="built_in">Pair</span>(<span class="type">const</span> Pair&lt;U1, U2&gt; &amp;p) : _first(p._first), _second(p._second) &#123;&#125;</span><br><span class="line">    <span class="comment">// è¿™é‡Œæ€ä¹ˆç†è§£</span></span><br><span class="line">    <span class="comment">// å¦‚æœä¼ å…¥çš„ç±»å‹æ˜¯ T1 é±¼ç±» T2 é¸Ÿç±»</span></span><br><span class="line">    <span class="comment">// ç„¶ååœ¨è°ƒç”¨æ‹·è´èµ‹å€¼çš„æ—¶å€™ä¼ å…¥çš„ç±»å‹æ˜¯ U1 é²«é±¼ U2 éº»é›€</span></span><br><span class="line">    <span class="comment">// æ˜¾ç„¶ é²«é±¼æ˜¯é±¼ç±» éº»é›€æ˜¯é¸Ÿç±» æ‰€ä»¥æ˜¯å¯ä»¥ä¼ å…¥çš„</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªæˆå‘˜æ¨¡æ¿éœ€è¦æ»¡è¶³çš„æ¡ä»¶å°±æ˜¯ p._firstè¿™é‡Œæ˜¯å¯ä»¥ç»™è‡ªèº«çš„æˆå‘˜å±æ€§ _first è¿›è¡Œèµ‹å€¼çš„,åœ¨è¿™é‡Œæ»¡è¶³çš„æ˜¯ç»§æ‰¿çš„å…³ç³»</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="number">0</span>; &#125;</span><br></pre></td></tr></table></div></figure><p>è¿™é‡Œå…¶å®å°±æœ‰è€ƒè™‘æŒ‡é’ˆæŒ‡å‘çš„é—®é¢˜</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Derived1</span> : <span class="keyword">public</span> Base1 &#123; &#125;;</span><br><span class="line">Base1 *ptr=<span class="keyword">new</span> Derived1;<span class="comment">//è¿™ä¹ˆå†™æ˜¯å®Œå…¨okçš„</span></span><br></pre></td></tr></table></div></figure><p>è¿˜æ˜¯è€ƒè™‘ Base1 æ˜¯é±¼ç±»ï¼ŒDerived1 æ˜¯ é²«é±¼ï¼Œç„¶åæˆ‘ä»¬ç”¨é±¼ç±»çš„æŒ‡é’ˆå»æŒ‡å‘é²«é±¼å¯¹è±¡ï¼Œè¿™æ˜¾ç„¶æ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºé²«é±¼å¾ˆæ˜æ˜¾æ˜¯é±¼ï¼Œæ‰€ä»¥è¿™ä¹ˆå†™æ˜¯å®Œå…¨okçš„ã€‚</p><p>å¹¶ä¸”æ°å¥½è¿™ä¹ˆå†™å¯ä»¥ä½¿å¾—å­ç±»è°ƒç”¨çˆ¶ç±»çš„è™šå‡½æ•°æ¥å®ç°ä¸åŒçš„è™šå‡½æ•°åŠŸèƒ½ã€‚</p><h2 id="å‘½åç©ºé—´"><a href="#å‘½åç©ºé—´" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å‘½åç©ºé—´"></a> å‘½åç©ºé—´</h2><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> my1</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;I am in namespace my1&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> my2</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;I am in namespace my2&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    my1::<span class="built_in">test</span>();</span><br><span class="line">    my2::<span class="built_in">test</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>ä¸¤ä¸ªå‘½åç©ºé—´ï¼Œå³ä½¿é‡Œé¢çš„å‡½æ•°åç§°ä¸€æ ·ï¼Œä¼ å…¥å‚æ•°ç­‰ç­‰æ–¹é¢å®Œå…¨ä¸€æ ·ï¼Œç”šè‡³è¿˜æ˜¯é™æ€çš„ï¼Œè™½ç„¶é™æ€çš„å­˜æ”¾äºå…¨å±€é™æ€åŒºåªæœ‰ä¸€ä»½ï¼Œä½†æ˜¯è¿™é‡Œç”¨äº†ä¸¤ä¸ªä¸åŒçš„å‘½åç©ºé—´å°†ä»–ä»¬åˆ†å‰²å¼€æ¥ï¼Œè¿™æ ·å°±å¯¼è‡´ä¸¤ä¸ªå‡½æ•°æœ¬è´¨ä¸Šæ˜¯ä¸åŒçš„ï¼Œä»ä¸‹é¢çš„ä½¿ç”¨å°±å¯ä»¥çœ‹å‡ºæ¥äº†ã€‚</p><h2 id="explicit"><a href="#explicit" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#explicit"></a> explicit</h2><p>non-explicit-one-argument ctor(æ„é€ å‡½æ•°)</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Fraction</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// non-explicit-one-argument ctor</span></span><br><span class="line">    <span class="built_in">Fraction</span>(<span class="type">int</span> num, <span class="type">int</span> den = <span class="number">1</span>) : _numerator(num), _denominator(den) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿™æ˜¯ä¸Šé¢æåˆ°çš„è½¬æ¢å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">double</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">double</span>)<span class="keyword">this</span>-&gt;_numerator / (<span class="type">double</span>)<span class="keyword">this</span>-&gt;_denominator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> _numerator;</span><br><span class="line">    <span class="type">int</span> _denominator;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><p>æˆ‘ä»¬å…ˆå°†è½¬æ¢å‡½æ•°å»æ‰ï¼Œé‡è½½åŠ å·è¿ç®—ç¬¦</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Fraction</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// non-explicit-one-argument ctor</span></span><br><span class="line">    <span class="built_in">Fraction</span>(<span class="type">int</span> num, <span class="type">int</span> den = <span class="number">1</span>) : _numerator(num), _denominator(den) &#123;&#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//é‡è½½åŠ å·è¿ç®—ç¬¦</span></span><br><span class="line">    Fraction <span class="keyword">operator</span>+(<span class="type">const</span> Fraction&amp; f)&#123; ; &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> _numerator;</span><br><span class="line">    <span class="type">int</span> _denominator;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">Fraction <span class="title">f</span><span class="params">(<span class="number">3</span>,<span class="number">5</span>)</span></span>;</span><br><span class="line">    Fraction d=f<span class="number">+4</span>;</span><br><span class="line">    <span class="comment">//åˆ°è¿™é‡Œçš„æ—¶å€™ç¼–è¯‘å™¨å‘ç°få’Œ4æ²¡åŠæ³•ç›´æ¥ç›¸åŠ  å³ä½¿å†™äº†é‡è½½ å› ä¸ºéœ€è¦ä¼ å…¥Fractionç±»å‹</span></span><br><span class="line">    <span class="comment">//ä½†æ˜¯ç¼–è¯‘å™¨çœ‹æ„é€ å‡½æ•° é»˜è®¤å€¼den=1 æ„æ€æ˜¯å¯ä»¥ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œè¿™å°±å’Œç°åœ¨çš„4å¾ˆè´´åˆ‡äº†</span></span><br><span class="line">    <span class="comment">//æ‰€ä»¥ç¼–è¯‘å™¨ä¼šå°†4è½¬åŒ–ä¸ºFractionç±»å¯¹è±¡å’Œfè¿›è¡Œç›¸åŠ å¾—åˆ°å¯¹è±¡d</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>å¦‚æœä¸¤ä¸ªåŒæ—¶å­˜åœ¨</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Fraction</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// non-explicit-one-argument ctor</span></span><br><span class="line">    <span class="built_in">Fraction</span>(<span class="type">int</span> num, <span class="type">int</span> den = <span class="number">1</span>) : _numerator(num), _denominator(den) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//conversion function</span></span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">double</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">double</span>)<span class="keyword">this</span>-&gt;_numerator / (<span class="type">double</span>)<span class="keyword">this</span>-&gt;_denominator;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//é‡è½½åŠ å·è¿ç®—ç¬¦</span></span><br><span class="line">    Fraction <span class="keyword">operator</span>+(<span class="type">const</span> Fraction&amp; f)&#123; ; &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> _numerator;</span><br><span class="line">    <span class="type">int</span> _denominator;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">Fraction <span class="title">f</span><span class="params">(<span class="number">3</span>,<span class="number">5</span>)</span></span>;</span><br><span class="line">    Fraction d=f<span class="number">+4</span>;</span><br><span class="line">    <span class="comment">//æŒ‰ç…§ä¸Šé¢çš„æ€è·¯æ˜¯ä¸€ç§èµ°æ³•</span></span><br><span class="line">    <span class="comment">//ä½†æ˜¯æœ‰äº†è½¬æ¢å‡½æ•°ä¹‹åç¼–è¯‘å™¨å‘ç°,få¯ä»¥å…ˆè½¬åŒ–ä¸ºdoubleæ•°å­—å†å’Œ4æ±‚å’Œï¼Œæ±‚å®Œå’Œä¹‹åå†è½¬åŒ–ä¸ºFractionå¯¹è±¡ï¼Œè¿™å°±æ˜¯å¦ä¸€ç§æ€è·¯äº†</span></span><br><span class="line">    <span class="comment">//æ‰€ä»¥ äºŒä¹‰æ€§ æŠ¥é”™</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>ç°åœ¨å¦‚æœåŠ ä¸Šå…³é”®å­— explicit å‘¢ï¼Ÿ</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Fraction</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// explicit-one-argument ctor</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Fraction</span><span class="params">(<span class="type">int</span> num, <span class="type">int</span> den = <span class="number">1</span>)</span> : _numerator(num), _denominator(den) &#123;</span>&#125;</span><br><span class="line">    <span class="comment">//explictå…³é”®å­—çš„å«ä¹‰ é˜²æ­¢ç±»æ„é€ å‡½æ•°çš„éšå¼è‡ªåŠ¨è½¬æ¢</span></span><br><span class="line">    <span class="comment">//å°±æ˜¯è¯´è¿™é‡Œç”±äºåªéœ€è¦ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨å¾ˆå¯èƒ½ä¼šæŠŠæ•°å­—éšå¼è½¬åŒ–ä¸ºFractionå¯¹è±¡</span></span><br><span class="line">    <span class="comment">//ä½†æ˜¯åŠ ä¸Šäº†explictä¹‹å,æ˜ç¡®æŒ‡å‡ºä¸è¦è®©ç¼–è¯‘å™¨è¿™ä¹ˆå¹²ï¼Œè¦ç”ŸæˆFractionå¯¹è±¡åªèƒ½æ˜¾å¼è°ƒç”¨æ„é€ å‡½æ•°!!!!</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//conversion function</span></span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">double</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">double</span>)<span class="keyword">this</span>-&gt;_numerator / (<span class="type">double</span>)<span class="keyword">this</span>-&gt;_denominator;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//é‡è½½åŠ å·è¿ç®—ç¬¦</span></span><br><span class="line">    Fraction <span class="keyword">operator</span>+(<span class="type">const</span> Fraction&amp; f)&#123; ; &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> _numerator;</span><br><span class="line">    <span class="type">int</span> _denominator;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">Fraction <span class="title">f</span><span class="params">(<span class="number">3</span>,<span class="number">5</span>)</span></span>;</span><br><span class="line">    Fraction d=f<span class="number">+4</span>;<span class="comment">//è¿™é‡Œä»ç„¶ä¼šé”™ï¼Œå› ä¸º4ä¸ä¼šè¢«è½¬åŒ–ä¸ºFractionäº†ï¼Œä¹Ÿå°±æ²¡æœ‰åŠæ³•ç›´æ¥ç›¸åŠ </span></span><br><span class="line">    <span class="type">double</span> e=f<span class="number">+4</span>;<span class="comment">//è¿™é‡Œæ˜¾ç„¶å°±å¯ä»¥äº†ï¼Œå› ä¸ºå­˜åœ¨è½¬æ¢å‡½æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è¿™ä¸ªå…³é”®å­— explicit ç»å¤§éƒ¨åˆ†éƒ½æ˜¯ç”¨åœ¨æ„é€ å‡½æ•°å‰é¢æ¥é˜²æ­¢å…¶ä»–ç±»å‹çš„éšå¼è½¬æ¢!!!</p><h2 id="pointer-like-classes-å…³äºæ™ºèƒ½æŒ‡é’ˆå’Œè¿­ä»£å™¨"><a href="#pointer-like-classes-å…³äºæ™ºèƒ½æŒ‡é’ˆå’Œè¿­ä»£å™¨" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#pointer-like-classes-å…³äºæ™ºèƒ½æŒ‡é’ˆå’Œè¿­ä»£å™¨"></a> pointer-like classes å…³äºæ™ºèƒ½æŒ‡é’ˆå’Œè¿­ä»£å™¨</h2><h3 id="æ™ºèƒ½æŒ‡é’ˆ-ç”¨ä¸€ä¸ªç±»æ¥æ¨¡æ‹Ÿä¸€èˆ¬æŒ‡é’ˆçš„ä½œç”¨"><a href="#æ™ºèƒ½æŒ‡é’ˆ-ç”¨ä¸€ä¸ªç±»æ¥æ¨¡æ‹Ÿä¸€èˆ¬æŒ‡é’ˆçš„ä½œç”¨" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ™ºèƒ½æŒ‡é’ˆ-ç”¨ä¸€ä¸ªç±»æ¥æ¨¡æ‹Ÿä¸€èˆ¬æŒ‡é’ˆçš„ä½œç”¨"></a> æ™ºèƒ½æŒ‡é’ˆ: ç”¨ä¸€ä¸ªç±»æ¥æ¨¡æ‹Ÿä¸€èˆ¬æŒ‡é’ˆçš„ä½œç”¨</h3><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Foo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">method</span><span class="params">(<span class="type">void</span>)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">shared_ptr</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">shared_ptr</span>(T *p) : _px(p) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ™ºèƒ½æŒ‡é’ˆå¿…ç„¶éœ€è¦é‡è½½è¿™ä¸¤ä¸ªè¿ç®—ç¬¦</span></span><br><span class="line">    T &amp;<span class="keyword">operator</span>*() <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> *(<span class="keyword">this</span>-&gt;_px);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    T *<span class="keyword">operator</span>-&gt;() <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>-&gt;_px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T *_px;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">shared_ptr&lt;Foo&gt; <span class="title">sp</span><span class="params">(<span class="keyword">new</span> Foo)</span></span>;</span><br><span class="line">    <span class="function">Foo <span class="title">f</span><span class="params">(*sp)</span></span>;</span><br><span class="line">    sp-&gt;<span class="built_in">method</span>();<span class="comment">//è¿™ä¸ªå°±ç›¸å½“äº _px-&gt;method();</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="è¿­ä»£å™¨-iterator-å…¶æœ¬è´¨ä¹Ÿæ˜¯ä¸€ç§æ™ºèƒ½æŒ‡é’ˆ"><a href="#è¿­ä»£å™¨-iterator-å…¶æœ¬è´¨ä¹Ÿæ˜¯ä¸€ç§æ™ºèƒ½æŒ‡é’ˆ" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è¿­ä»£å™¨-iterator-å…¶æœ¬è´¨ä¹Ÿæ˜¯ä¸€ç§æ™ºèƒ½æŒ‡é’ˆ"></a> è¿­ä»£å™¨: iterator å…¶æœ¬è´¨ä¹Ÿæ˜¯ä¸€ç§æ™ºèƒ½æŒ‡é’ˆ</h3><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    list&lt;<span class="type">int</span>&gt; l&#123;<span class="number">5</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>&#125;;</span><br><span class="line">    <span class="comment">//æ–¹æ³•ä¸€</span></span><br><span class="line">    <span class="comment">//æ³¨æ„è¿™ä¸ªè¿­ä»£å™¨ç±»å‹æ€ä¹ˆå†™çš„</span></span><br><span class="line">    <span class="keyword">for</span> (list&lt;<span class="type">int</span>&gt;::iterator iter = l.<span class="built_in">begin</span>(); iter != l.<span class="built_in">end</span>(); ++iter)</span><br><span class="line">        cout &lt;&lt; *iter &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–¹æ³•2</span></span><br><span class="line">    for_each(l.<span class="built_in">begin</span>(), l.<span class="built_in">end</span>(), [&amp;](<span class="type">int</span> val)</span><br><span class="line">             &#123; cout &lt;&lt; val &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;);</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">test</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h2 id="specialization-æ¨¡æ¿ç‰¹åŒ–"><a href="#specialization-æ¨¡æ¿ç‰¹åŒ–" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#specialization-æ¨¡æ¿ç‰¹åŒ–"></a> specialization æ¨¡æ¿ç‰¹åŒ–</h2><p>å¯¹äºä¸€ä¸ªæ³›å‹æ¨¡æ¿ï¼Œæˆ‘ä»¬è°ƒç”¨çš„æ—¶å€™é‡Œé¢çš„æ¥å£éƒ½æ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬å‘ç°æœ‰çš„ç‰¹æ®Šçš„ç±»å‹åœ¨æŸä¸ªå‡½æ•°ä¸‹æœ‰æ›´åŠ å¥½çš„å®ç°æ–¹æ³•ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç”¨æ¨¡æ¿ç‰¹åŒ–æ¥æ“ä½œäº†ã€‚å¯ä»¥ç±»æ¯”å­ç±»ç»§æ‰¿çˆ¶ç±»(æŠ½è±¡ç±»)çš„è™šå‡½æ•°ï¼Œç‰¹æ®ŠåŒ–å®ç°ï¼Œæœ¬è´¨æ˜¯ä¸€æ ·çš„ã€‚</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230413211543101.png" alt="image-20230413211543101"></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Type</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Fuck</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ¿ç‰¹åŒ–</span></span><br><span class="line"><span class="keyword">template</span> &lt;&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Fuck</span>&lt;<span class="type">int</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> val)</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> val; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ³¨æ„æ¨¡æ¿ç‰¹åŒ–çš„è¯­æ³•</span></span><br><span class="line"><span class="keyword">template</span> &lt;&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Fuck</span>&lt;string&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">string <span class="title">operator</span><span class="params">()</span><span class="params">(string ch)</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> ch; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Fuck</span>&lt;<span class="type">double</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">double</span> val)</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> val; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// åŒ¿åå¯¹è±¡</span></span><br><span class="line">    cout &lt;&lt; <span class="built_in">Fuck</span>&lt;<span class="type">int</span>&gt;()(<span class="number">1</span>) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">Fuck</span>&lt;string&gt;()(<span class="string">&quot;fuck&quot;</span>) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">Fuck</span>&lt;<span class="type">double</span>&gt;()(<span class="number">3.14</span>) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ¨¡æ¿ç‰¹åŒ–è¯­æ³•ç¬¬ä¸€è¡Œè¦åŠ ä¸Šï¼Œç¬¬äºŒè¡Œå°±æ˜¯å…·ä½“ç±»å‹ç±»çš„å…·ä½“æ“ä½œ</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Fuck</span>&lt;type&gt;&#123;</span><br><span class="line">  	;  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><h2 id="partial-specialization-æ¨¡æ¿åç‰¹åŒ–"><a href="#partial-specialization-æ¨¡æ¿åç‰¹åŒ–" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#partial-specialization-æ¨¡æ¿åç‰¹åŒ–"></a> partial specialization æ¨¡æ¿åç‰¹åŒ–</h2><p>ä¸ªæ•°çš„å</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T,<span class="keyword">typename</span> Alloc= ...&gt;</span><br><span class="line"><span class="keyword">class</span> Vector&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¨¡æ¿åç‰¹åŒ– å°±åªç‰¹å®šå…¶ä¸­çš„æŸä¸ªæˆ–è€…æŸå‡ ä¸ªå…ƒç´  å…¶å®è¿˜æ˜¯ä¸€ä¸ªæ¨¡æ¿</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Alloc= ...&gt;</span><br><span class="line"><span class="keyword">class</span> Vector&lt;<span class="type">bool</span>,Alloc&gt;&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><p>èŒƒå›´çš„å</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TC</span> <span class="comment">// æ³›åŒ–çš„TCç±»æ¨¡æ¿</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">functest</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;æ³›åŒ–ç‰ˆæœ¬&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// åç‰¹åŒ–ï¼šæ¨¡æ¿å‚æ•°èŒƒå›´ä¸Šçš„ç‰¹åŒ–ç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TC</span>&lt;<span class="type">const</span> T&gt; <span class="comment">// constçš„ç‰¹åŒ–ç‰ˆæœ¬</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// å¯¹ç‰¹åŒ–ç‰ˆæœ¬åšå•ç‹¬å¤„ç†</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">functest</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;åç‰¹åŒ–constç‰ˆæœ¬&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TC</span>&lt;T *&gt; <span class="comment">// T* çš„ç‰¹åŒ–ç‰ˆæœ¬</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">functest</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;const T*ç‰¹åŒ–ç‰ˆæœ¬&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TC</span>&lt;T &amp;&gt; <span class="comment">// T&amp; çš„ç‰¹åŒ–ç‰ˆæœ¬</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">functest</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;T &amp;å·¦å€¼å¼•ç”¨ç‰¹åŒ–ç‰ˆæœ¬&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TC</span>&lt;T &amp;&amp;&gt; <span class="comment">// T&amp;&amp; çš„ç‰¹åŒ–ç‰ˆæœ¬</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">functest</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;T &amp;&amp;å³å€¼å¼•ç”¨ç‰¹åŒ–ç‰ˆæœ¬&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    TC&lt;<span class="type">double</span>&gt; td;</span><br><span class="line">    td.<span class="built_in">functest</span>();</span><br><span class="line"></span><br><span class="line">    TC&lt;<span class="type">const</span> <span class="type">double</span>&gt; td2;</span><br><span class="line">    td<span class="number">2.f</span>unctest();</span><br><span class="line"></span><br><span class="line">    TC&lt;<span class="type">double</span> *&gt; tpd;</span><br><span class="line">    tpd.<span class="built_in">functest</span>();</span><br><span class="line"></span><br><span class="line">    TC&lt;<span class="type">const</span> <span class="type">double</span> *&gt; tpd2;</span><br><span class="line">    tpd<span class="number">2.f</span>unctest();</span><br><span class="line"></span><br><span class="line">    TC&lt;<span class="type">int</span> &amp;&gt; tcyi;</span><br><span class="line">    tcyi.<span class="built_in">functest</span>();</span><br><span class="line"></span><br><span class="line">    TC&lt;<span class="type">int</span> &amp;&amp;&gt; tcyi2;</span><br><span class="line">    tcyi<span class="number">2.f</span>unctest();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">test</span>();</span><br><span class="line">    <span class="comment">//æ³›åŒ–ç‰ˆæœ¬</span></span><br><span class="line">	<span class="comment">//åç‰¹åŒ–constç‰ˆæœ¬</span></span><br><span class="line">	<span class="comment">//const T*ç‰¹åŒ–ç‰ˆæœ¬</span></span><br><span class="line">	<span class="comment">//const T*ç‰¹åŒ–ç‰ˆæœ¬</span></span><br><span class="line">	<span class="comment">//T &amp;å·¦å€¼å¼•ç”¨ç‰¹åŒ–ç‰ˆæœ¬</span></span><br><span class="line">	<span class="comment">//T &amp;&amp;å³å€¼å¼•ç”¨ç‰¹åŒ–ç‰ˆæœ¬</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h1 id="cæ ‡å‡†åº“-ä½“ç³»ç»“æ„ä¸å†…å­˜åˆ†æ"><a href="#cæ ‡å‡†åº“-ä½“ç³»ç»“æ„ä¸å†…å­˜åˆ†æ" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#cæ ‡å‡†åº“-ä½“ç³»ç»“æ„ä¸å†…å­˜åˆ†æ"></a> C++æ ‡å‡†åº“ ä½“ç³»ç»“æ„ä¸å†…å­˜åˆ†æ</h1><h2 id="ç¬¬ä¸€è®²stlæ ‡å‡†åº“å’Œæ³›å‹ç¼–ç¨‹"><a href="#ç¬¬ä¸€è®²stlæ ‡å‡†åº“å’Œæ³›å‹ç¼–ç¨‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¬¬ä¸€è®²stlæ ‡å‡†åº“å’Œæ³›å‹ç¼–ç¨‹"></a> ç¬¬ä¸€è®²ï¼šSTLæ ‡å‡†åº“å’Œæ³›å‹ç¼–ç¨‹</h2><h3 id="stl-ä½“ç³»ç»“æ„"><a href="#stl-ä½“ç³»ç»“æ„" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#stl-ä½“ç³»ç»“æ„"></a> STL ä½“ç³»ç»“æ„</h3><p>å…­å¤§éƒ¨ä»¶: å®¹å™¨ åˆ†é…å™¨ ç®—æ³• è¿­ä»£å™¨ é€‚é…å™¨ ä»¿å‡½æ•°</p><p>å®¹å™¨ï¼šå„ç§æ•°æ®ç»“æ„</p><p>ç®—æ³•ï¼šalgorithm</p><p>è¿­ä»£å™¨ï¼šæ³›å‹æŒ‡é’ˆï¼Œé‡è½½äº† * -&gt; ++ --æ“ä½œçš„ç±»</p><p>ä»¿å‡½æ•°ï¼šä»å®ç°çš„è§’åº¦çœ‹æ˜¯é‡è½½äº† operator() çš„ç±»</p><p>é€‚é…å™¨ï¼šä¸€ç§ä¿®é¥°å®¹å™¨ï¼Œä»¿å‡½æ•°æˆ–è€…è¿­ä»£å™¨æ¥å£çš„ä¸œè¥¿</p><p>åˆ†é…å™¨ï¼šè´Ÿè´£ç©ºé—´çš„é…ç½®å’Œç®¡ç†</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230414100854356.png" alt="image-20230414100854356"></p><p>ä»¥ä¸‹æœ‰ä¸€ä¸ªç¨‹åºçš„ä¾‹å­å‡ ä¹åŒ…å«äº†æ‰€æœ‰çš„å…ƒç´ ï¼š</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230414114802698.png" alt="image-20230414114802698" style="zoom:67%"><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ia[<span class="number">6</span>] = &#123;<span class="number">27</span>, <span class="number">210</span>, <span class="number">12</span>, <span class="number">47</span>, <span class="number">109</span>, <span class="number">83</span>&#125;;</span><br><span class="line">    vector&lt;<span class="type">int</span>, allocator&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">vi</span>(ia, ia + <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="built_in">count_if</span>(vi.<span class="built_in">begin</span>(), vi.<span class="built_in">end</span>(), <span class="built_in">not1</span>(<span class="built_in">bind2nd</span>(<span class="built_in">less</span>&lt;<span class="type">int</span>&gt;(), <span class="number">40</span>))) &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>ä¸‹é¢æ¥è§£é‡Šè¿™é‡Œé¢æ‰€ç”¨åˆ°çš„ä¸œè¥¿:</p><ol><li><p>vectoræ˜¯å®¹å™¨ï¼Œè¿™é‡Œçš„ç”¨æ³•å’Œä¸€èˆ¬çš„ä½¿ç”¨æ–¹æ³•ä¸åŒï¼Œè¿™é‡Œç»™å‡ºäº†åˆ†é…å™¨æ¨¡æ¿çš„æŒ‡å®šå‚æ•°</p></li><li><p>count_ifç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œæœ¬æ„æ˜¯æƒ³æ¯”è¾ƒè¿­ä»£å™¨ * iter å’Œ40 çš„å¤§å°ï¼Œç„¶åä½¿ç”¨çš„ä»¿å‡½æ•°ï¼Œä½†æ˜¯less<int>()è¿™ä¸ªç³»ç»Ÿè‡ªå¸¦çš„ä»¿å‡½æ•°çš„å®ç°æ˜¯è¿™æ ·çš„</int></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> _Tp&gt;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">less</span> : <span class="keyword">public</span> binary_function&lt;_Tp, _Tp, <span class="type">bool</span>&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    _GLIBCXX14_CONSTEXPR</span><br><span class="line">    <span class="type">bool</span></span><br><span class="line">    <span class="comment">//ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºä»–éœ€è¦ä¸¤ä¸ªå‚æ•°</span></span><br><span class="line">    <span class="built_in">operator</span>()(<span class="type">const</span> _Tp&amp; __x, <span class="type">const</span> _Tp&amp; __y) <span class="type">const</span></span><br><span class="line">    &#123; <span class="keyword">return</span> __x &lt; __y; &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></div></figure><p>ä¸€èˆ¬ä»¿å‡½æ•°çš„ç”¨æ³•:</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt;v&#123;<span class="number">5</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>&#125;;</span><br><span class="line"><span class="built_in">sort</span>(v.<span class="built_in">begin</span>(),v.<span class="built_in">end</span>(),<span class="built_in">less</span>&lt;<span class="type">int</span>&gt;());<span class="comment">//ä»¿å‡½æ•°ä½œè°“è¯</span></span><br></pre></td></tr></table></div></figure><p>æ‰€ä»¥è¿™é‡Œç”¨ <strong>bind2nd</strong> å°†è¿­ä»£å™¨å’Œ40ç»‘å®šåœ¨ä¸€èµ·ï¼Œä¹Ÿå« function adapter(binder)ã€‚</p><p>ç„¶åæœ€å¤–é¢ <strong>not1</strong> ä¸€æ ·çš„ï¼Œå°†æ¡ä»¶å–åï¼Œæ‰€ä»¥æ±‚çš„å°±æ˜¯å¤§äºç­‰äº40çš„å…ƒç´ ä¸ªæ•°äº†,function adapter(negator)</p></li></ol><h3 id="åŸºäºèŒƒå›´çš„-for-è¯­å¥"><a href="#åŸºäºèŒƒå›´çš„-for-è¯­å¥" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#åŸºäºèŒƒå›´çš„-for-è¯­å¥"></a> åŸºäºèŒƒå›´çš„ for è¯­å¥</h3><p>ä¸ªäººæ„Ÿè§‰æœ‰ç‚¹åƒpythoné‡Œé¢çš„ for i in range()</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†vectorå®¹å™¨</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Type&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(vector&lt;Type&gt; container)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> elem : container)</span><br><span class="line">        cout &lt;&lt; elem &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">print</span>(vector&lt;<span class="type">int</span>&gt;&#123;<span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">10</span>&#125;);</span><br><span class="line"></span><br><span class="line">    vector&lt;<span class="type">double</span>&gt; nums&#123;<span class="number">1.1</span>, <span class="number">2.5</span>, <span class="number">6.33</span>, <span class="number">15.66</span>, <span class="number">1.44</span>, <span class="number">2.52</span>&#125;;</span><br><span class="line">    <span class="built_in">print</span>(nums);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¨å¾®ä¿®æ”¹ä¸€ä¸‹</span></span><br><span class="line">    <span class="comment">// æ³¨æ„ä¼ å…¥å¼•ç”¨æ‰èƒ½ä¿®æ”¹å®å‚!!!!!</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;elem : nums)</span><br><span class="line">        elem -= <span class="number">1</span>; <span class="comment">// å‡ä¸€</span></span><br><span class="line">    <span class="built_in">print</span>(nums);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="å®¹å™¨çš„ç»“æ„å’Œåˆ†ç±»"><a href="#å®¹å™¨çš„ç»“æ„å’Œåˆ†ç±»" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å®¹å™¨çš„ç»“æ„å’Œåˆ†ç±»"></a> å®¹å™¨çš„ç»“æ„å’Œåˆ†ç±»</h3><p>æ€»ä½“æ¥è®²åˆ†ä¸ºä¸¤ç±»:</p><p>åºåˆ—å®¹å™¨ Sequence Containers</p><p>å…³è”å¼å®¹å™¨ Associate Containers å…³è”å¼å®¹å™¨é‡‡ç”¨é”®å€¼å¯¹çš„æ–¹å¼å­˜å‚¨æ•°æ®ï¼Œå› æ­¤è¿™ä¸€ç§å®¹å™¨æŸ¥æ‰¾å…ƒç´ çš„æ•ˆç‡æœ€é«˜ï¼Œæœ€æ–¹ä¾¿</p><p>æ— åºå®¹å™¨ Unordered Containers æ˜¯å…³è”å¼å®¹å™¨çš„ä¸€ç§ï¼Œc++11æ–°å‡ºçš„</p><p>ç›¸æ¯”äºå…³è”å¼å®¹å™¨çš„ç‰¹ç‚¹ï¼š</p><ul><li>æ— åºå®¹å™¨å†…éƒ¨å­˜å‚¨çš„<strong>é”®å€¼å¯¹æ˜¯æ— åº</strong>çš„ï¼Œå„é”®å€¼å¯¹çš„å­˜å‚¨ä½ç½®å–å†³äºè¯¥é”®å€¼å¯¹ä¸­çš„é”®</li><li>å’Œå…³è”å¼å®¹å™¨ç›¸æ¯”ï¼Œæ— åºå®¹å™¨æ“…é•¿<strong>é€šè¿‡æŒ‡å®šé”®æŸ¥æ‰¾å¯¹åº”çš„å€¼</strong>ï¼ˆå¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼‰ï¼›</li><li>ä½†å¯¹äºä½¿ç”¨è¿­ä»£å™¨éå†å®¹å™¨ä¸­å­˜å‚¨çš„å…ƒç´ ï¼Œæ— åºå®¹å™¨çš„æ‰§è¡Œæ•ˆç‡åˆ™ä¸å¦‚å…³è”å¼å®¹å™¨ã€‚</li></ul><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230414161555294.png" alt="image-20230414161555294"></p><h3 id="hashtable-separate-chaining"><a href="#hashtable-separate-chaining" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#hashtable-separate-chaining"></a> HashTable Separate Chaining</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230414171828137.png" alt="image-20230414171828137"></p><h3 id="sequence-containers-åºåˆ—å®¹å™¨"><a href="#sequence-containers-åºåˆ—å®¹å™¨" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#sequence-containers-åºåˆ—å®¹å™¨"></a> Sequence Containers åºåˆ—å®¹å™¨</h3><h4 id="arrayc11"><a href="#arrayc11" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#arrayc11"></a> array(c++11)</h4><p>arrayæ˜¯STLè‡ªå¸¦çš„æ•°ç»„ç±»ï¼Œå…¶æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„æ•°ç»„ï¼Œé‡Œé¢å­˜æ”¾çš„å…ƒç´ ç±»å‹ç”±ç”¨æˆ·æŒ‡å®š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">srand</span>(<span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">const</span> <span class="type">size_t</span> _size = <span class="number">100</span>;</span><br><span class="line">        array&lt;<span class="type">int</span>, _size&gt; arr;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; _size; ++i)</span><br><span class="line">            <span class="comment">// éšæœºæ•° 0-100</span></span><br><span class="line">            arr[i] = <span class="built_in">rand</span>() % <span class="number">101</span>;</span><br><span class="line">        <span class="comment">// æ‰“å°ä¸€äº›ä¿¡æ¯</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;arr.size()= &quot;</span> &lt;&lt; arr.<span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;arr.front()= &quot;</span> &lt;&lt; arr.<span class="built_in">front</span>() &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;arr.back()= &quot;</span> &lt;&lt; arr.<span class="built_in">back</span>() &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;arr.data()= &quot;</span> &lt;&lt; arr.<span class="built_in">data</span>() &lt;&lt; endl;</span><br><span class="line">    	cout&lt;&lt; <span class="string">&quot; &amp;arr[0]= &quot;</span> &lt;&lt; &amp;arr[<span class="number">0</span>] &lt;&lt; endl;<span class="comment">//ç¬¬å››è¡Œå’Œç¬¬äº”è¡Œå¾—åˆ°çš„ç»“æœæ˜¯ä¸€æ ·çš„</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure><p>arrayå°è£…äº†å›ºå®šé•¿åº¦æ•°ç»„çš„ä¸€äº›å‡½æ•°æ¥å£ï¼Œå…¶ä¸­data()å‡½æ•°æ˜¯å¾—åˆ°è¿™ä¸ªæ•°ç»„çš„é¦–å…ƒç´ åœ°å€ï¼Œä¹Ÿå°±æ˜¯ç¬¬äº”è¡Œï¼Œæ‰€ä»¥å››äº”è¡Œç»“æœç›¸åŒ</p><h4 id="vector"><a href="#vector" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#vector"></a> vector</h4><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">(<span class="type">int</span> length)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">srand</span>(<span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line"></span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; v;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; length; ++i)</span><br><span class="line">            v.<span class="built_in">push_back</span>(<span class="built_in">rand</span>() % <span class="number">101</span>);</span><br><span class="line">        <span class="comment">// æ‰“å°</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;v.size()= &quot;</span> &lt;&lt; v.<span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">    	cout &lt;&lt; <span class="string">&quot;v.max_size()= &quot;</span> &lt;&lt; v.<span class="built_in">max_size</span>() &lt;&lt; endl;<span class="comment">//è¿™é‡Œçš„max_size()æ˜¯æŒ‡vectorå®¹å™¨èƒ½è£…ä¸‹çš„æœ€å¤§çš„å¤§å°</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;v.front()= &quot;</span> &lt;&lt; v.<span class="built_in">front</span>() &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;v.back()= &quot;</span> &lt;&lt; v.<span class="built_in">back</span>() &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;v.data()= &quot;</span> &lt;&lt; v.<span class="built_in">data</span>() &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;&amp;v[0]=&quot;</span> &lt;&lt; &amp;v[<span class="number">0</span>] &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;v.capacity()= &quot;</span> &lt;&lt; v.<span class="built_in">capacity</span>() &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure><p>è¿™é‡Œå¾—åˆ°æˆ‘æŒ‡å®šsizeæ˜¯10000çš„æ—¶å€™ï¼Œcapacityæ˜¯16384ï¼Œæ°å¥½æ˜¯2çš„14æ¬¡æ–¹ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆæ˜¯è¿™æ ·å‘¢ï¼Ÿ</p><p>vectorå½“ç©ºé—´ä¸å¤Ÿçš„æ—¶å€™å¦‚ä½•å¼€è¾Ÿç©ºé—´ï¼š<strong>2å€å¼€è¾Ÿ</strong>!!!</p><p>æ¯”å¦‚ç°åœ¨æœ‰2ä¸ªå…ƒç´ ï¼Œæƒ³è¦æ”¾å…¥ç¬¬ä¸‰ä¸ªï¼Œç©ºé—´ä¸å¤Ÿä¼šæ–°å¼€è¾Ÿï¼Œé‚£ä¹ˆæ–°å¼€è¾Ÿä¹‹åvectorçš„ç©ºé—´å¤§å°æ˜¯4</p><p>å³:</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// v.size() == 3</span></span><br><span class="line"><span class="comment">// v.capacity() == 4</span></span><br></pre></td></tr></table></div></figure><p>æ‰€ä»¥å½“ size==10000çš„æ—¶å€™ï¼Œcapacityä¸º16384ä¹Ÿä¸å¥‡æ€ªäº†</p><p>å¹¶ä¸”<strong>å†…å­˜å¼€è¾Ÿæˆé•¿æœºåˆ¶</strong>ï¼š</p><p>å½“ç©ºé—´ä¸å¤Ÿçš„æ—¶å€™ï¼Œvectorå®¹å™¨ä¼šå»å†…å­˜ä¸­æ‰¾å¦ä¸€å—ç©ºé—´æ˜¯ç°åœ¨2å€çš„ç©ºé—´ï¼Œé‡æ–°å¼€è¾Ÿå†…å­˜ï¼Œå¹¶ä¸”æŠŠç°åœ¨çš„å†…å­˜é‡Šæ”¾æ‰ï¼ŒæŠŠç°åœ¨çš„æ•°æ®è¿ç§»åˆ°æ–°çš„2å€å†…å­˜å½“ä¸­å»!!!</p><h4 id="list"><a href="#list" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#list"></a> list</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230415143355398.png" alt="image-20230415143355398"></p><p>listæ˜¯ä¸ªåŒç«¯å¾ªç¯é“¾è¡¨ï¼Œæ³¨æ„ä¸ä»…æ˜¯åŒå‘é“¾è¡¨ï¼Œè¿˜æ˜¯å¾ªç¯çš„!!!</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">(<span class="type">int</span> length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">srand</span>(<span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line"></span><br><span class="line">    list&lt;<span class="type">int</span>&gt; l;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; length; ++i)</span><br><span class="line">        l.<span class="built_in">push_back</span>(<span class="built_in">rand</span>() % <span class="number">101</span>);<span class="comment">//list æä¾›äº†backå’Œfrontä¸¤ç§æ’å…¥æ–¹æ³•,å› ä¸ºæœ‰begin()å’Œend()è¿­ä»£å™¨</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;l.size()= &quot;</span> &lt;&lt; l.<span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;l.max_size()= &quot;</span> &lt;&lt; l.<span class="built_in">max_size</span>() &lt;&lt; endl;</span><br><span class="line">    <span class="comment">//æ³¨æ„ frontå’Œbackçš„ä¸‰ç§å¾—åˆ°æ–¹å¼</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;l.front()= &quot;</span> &lt;&lt; l.<span class="built_in">front</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;l.front()= &quot;</span> &lt;&lt; *l.<span class="built_in">begin</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;l.front()= &quot;</span> &lt;&lt; *(++l.<span class="built_in">end</span>()) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;l.back()= &quot;</span> &lt;&lt; l.<span class="built_in">back</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;l.back()= &quot;</span> &lt;&lt; *(--l.<span class="built_in">end</span>()) &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">auto</span> iter = --l.<span class="built_in">begin</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;l.back()= &quot;</span> &lt;&lt; *(--iter) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>å¾—åˆ°é¦–éƒ¨å’Œå°¾éƒ¨çš„æ–¹å¼:</p><p>1.å†…ç½®å‡½æ•° front()å’Œback()</p><p>2.ä½¿ç”¨è¿­ä»£å™¨ begin() å’Œ end()</p><p>æ³¨æ„è¿™é‡Œçš„è¿­ä»£å™¨æ˜¯é¦–é—­å°¾å¼€çš„å½¢å¼,å°±æ˜¯begin() æŒ‡å‘çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œend() æŒ‡å‘çš„æœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªæ²¡æœ‰å€¼çš„å†…å­˜ç©ºé—´,æ‰€ä»¥ä¸Šä¸€ä¸ªåŒºåŸŸå°±æ˜¯æœ€åä¸€ä¸ªå…ƒç´ çš„å€¼ --end()</p><p>ç”±äºè¿™ä¸ªåŒç«¯é“¾è¡¨åœ¨å†…å­˜ä¸­æœ€åä¸€ä¸ªå…ƒç´ çš„æœ«å°¾è¿˜å¤šäº†ä¸€å—æœªåˆ†é…å€¼çš„ç©ºé—´ï¼Œè€ƒè™‘åˆ°æ˜¯å¾ªç¯çš„ï¼Œæ‰€ä»¥++end()å°±ä»£è¡¨ç¬¬ä¸€å—å…ƒç´ çš„ç©ºé—´</p><p>ä½†æ˜¯ï¼Œç”±äº<strong>å¤§éƒ¨åˆ†çš„è¿­ä»£å™¨æ²¡æœ‰é‡è½½ + å’Œ - è¿ç®—ç¬¦(vectorå®¹å™¨æœ‰)</strong>ï¼Œé‚£ä¹ˆåœ¨æ±‚çš„æ—¶å€™ä¸èƒ½ç›´æ¥ç”¨è¿™ä¸¤ä¸ªç¬¦å·ï¼Œè€Œå¾—ä½¿ç”¨é‡è½½çš„++ å’Œ â€“ è¿ç®—ç¬¦!!!</p><h4 id="forward_listc11"><a href="#forward_listc11" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#forward_listc11"></a> forward_list(c++11)</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230415143409298.png" alt="image-20230415143409298"></p><p>æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå•å‘é“¾è¡¨ï¼Œéå¾ªç¯é“¾è¡¨</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">(<span class="type">int</span> length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">srand</span>(<span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line"></span><br><span class="line">    forward_list&lt;<span class="type">int</span>&gt; fl;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; length; ++i)</span><br><span class="line">        fl.<span class="built_in">push_front</span>(<span class="built_in">rand</span>() % <span class="number">101</span>); <span class="comment">// åªæä¾›å¤´æ’æ³•,å› ä¸ºå°¾æ’æ³•å¤ªæ…¢äº†</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;fl.max_size()= &quot;</span> &lt;&lt; fl.<span class="built_in">max_size</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;fl.front()= &quot;</span> &lt;&lt; fl.<span class="built_in">front</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;fl.front()= &quot;</span> &lt;&lt; *(fl.<span class="built_in">begin</span>()) &lt;&lt; endl;</span><br><span class="line">    <span class="comment">// cout &lt;&lt; &quot;fl.back()= &quot; &lt;&lt; *(--fl.end()) &lt;&lt; endl; // error æ²¡æœ‰é‡è½½ -- è¿ç®—ç¬¦ åªé‡è½½++è¿ç®—ç¬¦</span></span><br><span class="line">    <span class="comment">// ä¸å­˜åœ¨ fl.back() æ¥å£</span></span><br><span class="line">    <span class="comment">// ä¹Ÿä¸å­˜åœ¨fl.size()æ¥å£</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ³¨æ„è¿™ä¸ªå•å‘é“¾è¡¨åªæœ‰å¤´æ’æ³•ï¼ŒåŸå› æ˜¯å°¾æ’æ³•æ¯æ¬¡éƒ½è¦éå†åˆ°æœ€åï¼Œå¤ªæ…¢äº†ï¼Œå¤´æ’æ³•æ•ˆç‡æ›´é«˜,æ‰€ä»¥è¿™ä¸ªå®¹å™¨ä¹Ÿ<strong>ä¸å­˜åœ¨back()å‡½æ•°æ¥å£</strong></p><p>è¿™ä¸ªå•å‘é“¾è¡¨begin()å’Œend()è¿­ä»£å™¨éƒ½å­˜åœ¨ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†çš„æ—¶å€™éå†æ˜¯ä½¿ç”¨begin()è¿­ä»£å™¨ï¼Œå› ä¸º<strong>åªé‡è½½äº† ++ è¿ç®—ç¬¦ï¼Œæœªé‡è½½ â€“ è¿ç®—ç¬¦!!!</strong></p><p>è¿˜æœ‰ä¸€ç‚¹ä¸listä¸åŒ,è¿™ä¸ªå®¹å™¨<strong>æ²¡æœ‰ size() æ¥å£</strong>!!!æˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œæ ‡å‡†åº“æ²¡æœ‰æä¾›è¿™ä¸ªæ¥å£</p><h4 id="slist"><a href="#slist" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#slist"></a> slist</h4><p>è¿™ä¸ªå®¹å™¨çš„å®ç°å’Œ forward_list ç›¸åŒï¼Œåªä¸è¿‡è¿™ä¸ªå®¹å™¨æ˜¯c<ins>ä¹‹å‰å°±æœ‰äº†ï¼Œè€Œ forward_list æ˜¯c</ins>11æ–°æå‡ºçš„</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¤´æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ext\slist&gt;</span></span></span><br></pre></td></tr></table></div></figure><h4 id="deque"><a href="#deque" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#deque"></a> deque</h4><p>åŒç«¯å¼€å£é˜Ÿåˆ—</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230415145105415.png" alt="image-20230415145105415"></p><p>ä½†æ˜¯åœ¨å®ç°çš„æ—¶å€™é‡‡ç”¨çš„æ˜¯<strong>åˆ†æ®µè¿ç»­</strong>çš„æœºåˆ¶ï¼š</p><p>å®ƒçœŸå®çš„ç»“æ„å¦‚ä¸‹ï¼š</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230415145711652.png" alt="image-20230415145711652" style="zoom:67%"><p>åˆ°99çš„æ—¶å€™ï¼Œè¿­ä»£å™¨è¿›è¡Œ<ins>çš„æ“ä½œï¼Œéœ€è¦è¿›è¡Œåˆ¤æ–­èµ°åˆ°äº†è¿™ä¸€å—å†…å­˜çš„æœ«å°¾ï¼Œéœ€è¦ç§»æ­¥åˆ°ä¸‹ä¸€ä¸ªbufferçš„èµ·å§‹ä½ç½®ï¼Œä¹Ÿå°±æ˜¯0ï¼Œè¿™å°±éœ€è¦å¯¹</ins>å’Œâ€“æ“ä½œç¬¦è¿›è¡Œé‡è½½!!!</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">(<span class="type">int</span> length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">srand</span>(<span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line">    deque&lt;<span class="type">int</span>&gt; d;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; length; ++i)</span><br><span class="line">        d.<span class="built_in">push_back</span>(<span class="built_in">rand</span>() % <span class="number">101</span>);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d.size()= &quot;</span> &lt;&lt; d.<span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d.max_size()= &quot;</span> &lt;&lt; d.<span class="built_in">max_size</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d.front()= &quot;</span> &lt;&lt; d.<span class="built_in">front</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;d.back()= &quot;</span> &lt;&lt; d.<span class="built_in">back</span>() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>å’Œå‰é¢çš„ä½¿ç”¨æ²¡æœ‰å¤§åŒºåˆ«,åªæ˜¯<strong>dequeä¸æ˜¯å¾ªç¯çš„ï¼Œè€Œæ˜¯ä¸¤ç«¯å»¶å‡çš„</strong></p><h4 id="stack"><a href="#stack" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#stack"></a> stack</h4><p>dequeçš„åŠŸèƒ½å¯ä»¥å®ç°stackçš„æ‰€æœ‰åŠŸèƒ½ï¼Œå¯ä»¥ç”¨å¤åˆcompositionçš„æ–¹å¼æ¥å®ç°stackç±»</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230415150557574.png" alt="image-20230415150557574" style="zoom:67%"><h4 id="queue"><a href="#queue" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#queue"></a> queue</h4><p>åŒstackï¼Œç•¥</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230415150706680.png" alt="image-20230415150706680" style="zoom:67%"><h3 id="associate-containers-å…³è”å¼å®¹å™¨"><a href="#associate-containers-å…³è”å¼å®¹å™¨" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#associate-containers-å…³è”å¼å®¹å™¨"></a> Associate Containers å…³è”å¼å®¹å™¨</h3><p>å…³è”å¼å®¹å™¨æ¯ä¸ªå…ƒç´ éƒ½å­˜åœ¨ key å’Œ valueï¼Œè¿™æ ·æ‰èƒ½ä½¿å¾—æŸ¥è¯¢æ•ˆç‡å¤§å¤§æé«˜</p><h4 id="çº¢é»‘æ ‘"><a href="#çº¢é»‘æ ‘" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#çº¢é»‘æ ‘"></a> çº¢é»‘æ ‘</h4><h4 id="multiset-å’Œ-set"><a href="#multiset-å’Œ-set" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#multiset-å’Œ-set"></a> Multiset å’Œ set</h4><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230415154938692.png" alt="image-20230415154938692" style="zoom:67%"><p>è¿™ç§å®¹å™¨çš„ <strong>key å’Œ value å€¼ç›¸åŒ!</strong>!!!</p><p>è¿™ä¸¤ä¸ªå®¹å™¨çš„åº•å±‚éƒ½æ˜¯ç”¨<strong>äºŒå‰æ ‘</strong>(çº¢é»‘æ ‘)å®ç°çš„ï¼Œå…ƒç´ åœ¨æ’å…¥çš„æ—¶å€™éƒ½ä¼šè¢«<strong>è¿›è¡Œè‡ªåŠ¨æ’åº(ä»å°åˆ°å¤§)</strong>ï¼Œå”¯ä¸€çš„ä¸åŒç‚¹æ˜¯ï¼ŒMultisetå…è®¸æ’å…¥é‡å¤çš„å…ƒç´ ï¼Œè€Œsetä¸å…è®¸å‡ºç°é‡å¤çš„å…ƒç´ </p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">(<span class="type">int</span> length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">srand</span>(<span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line">    set&lt;<span class="type">int</span>&gt; s;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; length; ++i)</span><br><span class="line">        s.<span class="built_in">insert</span>(<span class="built_in">rand</span>());<span class="comment">//æ³¨æ„æ’å…¥çš„æ¥å£æ˜¯insert()</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;s.size()= &quot;</span> &lt;&lt; s.<span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;s.max_size()= &quot;</span> &lt;&lt; s.<span class="built_in">max_size</span>() &lt;&lt; endl;</span><br><span class="line">    <span class="comment">// s.begin() s.end() å­˜åœ¨æ¥å£</span></span><br><span class="line">    <span class="comment">// è¿­ä»£å™¨å­˜åœ¨ï¼Œå› ä¸ºåº•å±‚æ˜¯ç”¨äºŒå‰æ ‘å®ç°çš„ï¼Œå¹¶ä¸”è¿›è¡Œäº†è‡ªåŠ¨æ’åºï¼Œæ‰€ä»¥è‚¯å®šå¯ä»¥éå†ï¼Œè¿™ä¸ªå°±æ˜¯å­¦åº•å±‚çš„æ—¶å€™è¯¥è€ƒè™‘çš„é—®é¢˜</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p><strong>æ³¨æ„ï¼šMultiset å’Œ set ä¸èƒ½ä½¿ç”¨ [ ] æ¥åšä¸‹æ ‡è®¿é—®!!!</strong></p><p>ç¬¬ä¸€ï¼Œåº•å±‚æ˜¯çº¢é»‘æ ‘ï¼Œç¬¬äºŒï¼Œæ ‡å‡†åº“æœªé‡è½½ [ ] ç¬¦å·!!!</p><h4 id="multimap-å’Œ-map"><a href="#multimap-å’Œ-map" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#multimap-å’Œ-map"></a> Multimap å’Œ map</h4><p>è¿™ç§å®¹å™¨å°±æœ‰åˆ†åˆ«çš„ <strong>key å’Œ value</strong> äº†ï¼Œä¸¤è€…ä¸ä¸€å®šç›¸åŒï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯æœ‰ä¸¤ä¸ªå…ƒç´ !!!åº•å±‚æ˜¯ç”¨<strong>çº¢é»‘æ ‘</strong>å®ç°çš„!!!</p><p>æ’å…¥å…ƒç´ çš„æ—¶å€™ä¼š<strong>æŒ‰ç…§keyè¿›è¡Œæ’åº(ä»å°åˆ°å¤§)</strong></p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230415154949602.png" alt="image-20230415154949602" style="zoom:67%"><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">(<span class="type">int</span> length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">srand</span>(<span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line">    map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; m;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; length; ++i)</span><br><span class="line">        m.<span class="built_in">insert</span>(<span class="built_in">pair</span>&lt;<span class="type">int</span>, <span class="type">int</span>&gt;(i, <span class="built_in">rand</span>()));</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;m.size()= &quot;</span> &lt;&lt; m.<span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;m.max_size()= &quot;</span> &lt;&lt; m.<span class="built_in">max_size</span>() &lt;&lt; endl;</span><br><span class="line">    <span class="comment">// m.begin() m.end() å­˜åœ¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>åŒsetä¸€æ ·ï¼Œç”±äºåº•å±‚æ˜¯ç”¨çº¢é»‘æ ‘å®ç°çš„ï¼Œæ‰€ä»¥æŸ¥è¯¢çš„æ—¶å€™ä¹Ÿæœ‰è¿­ä»£å™¨æ¥å£ï¼Œå¹¶ä¸”æ•ˆç‡å¾ˆé«˜</p><p>mapä¸èƒ½æœ‰é‡å¤çš„ï¼Œè¿™é‡Œçš„<strong>é‡å¤åˆ¤æ–­æ˜¯çœ‹ key</strong> !!! ä¸¤ä¸ªvalueç›¸åŒä½†æ˜¯keyä¸åŒæ˜¯åˆæ³•çš„!!! Multimap å°±å¯ä»¥æœ‰ç›¸åŒçš„key!!!</p><p><strong>æ³¨æ„ï¼šMultimapä¸èƒ½ä½¿ç”¨ [ ] æ¥åšä¸‹æ ‡è®¿é—®!!! Mapå¯ä»¥ï¼Œç±»ä¼¼äºpythonå­—å…¸çš„ç”¨æ³•!!!</strong></p><p>åŸå› ç±»ä¼¼è§ä¸Š</p><h4 id="å“ˆå¸Œè¡¨å…¶å®åŸæœ¬åå­—å‰ç¼€æ˜¯hashç°åœ¨æ”¹åå«unordered"><a href="#å“ˆå¸Œè¡¨å…¶å®åŸæœ¬åå­—å‰ç¼€æ˜¯hashç°åœ¨æ”¹åå«unordered" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å“ˆå¸Œè¡¨å…¶å®åŸæœ¬åå­—å‰ç¼€æ˜¯hashç°åœ¨æ”¹åå«unordered"></a> å“ˆå¸Œè¡¨(å…¶å®åŸæœ¬åå­—å‰ç¼€æ˜¯hash,ç°åœ¨æ”¹åå«unordered)</h4><h4 id="unordered_multiset-å’Œ-unorder_set"><a href="#unordered_multiset-å’Œ-unorder_set" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#unordered_multiset-å’Œ-unorder_set"></a> unordered_multiset å’Œ unorder_set</h4><p><strong>keyå’Œvalueå€¼ç›¸åŒ</strong>ï¼Œä¸ä¸Šé¢ä¸åŒçš„æ˜¯è¿™ä¸ªæœ¬è´¨æ˜¯ç”¨<strong>å“ˆå¸Œè¡¨</strong>å®ç°çš„!</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230415160759007.png" alt="image-20230415160759007" style="zoom:67%"><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">(<span class="type">int</span> length)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">srand</span>(<span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line">        unordered_set&lt;<span class="type">int</span>&gt; us;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; length; ++i)</span><br><span class="line">            us.<span class="built_in">insert</span>(<span class="built_in">rand</span>());</span><br><span class="line"></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;us.size()= &quot;</span> &lt;&lt; us.<span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;us.max_size()= &quot;</span> &lt;&lt; us.<span class="built_in">max_size</span>() &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;us.bucket_count()= &quot;</span> &lt;&lt; us.<span class="built_in">bucket_count</span>() &lt;&lt; endl;<span class="comment">//ç¯®å­çš„å¤§å°</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;us.load_factor()= &quot;</span> &lt;&lt; us.<span class="built_in">load_factor</span>() &lt;&lt; endl;<span class="comment">//è£…è½½å› å­=å…ƒç´ ä¸ªæ•°/ç¯®å­ä¸ªæ•°</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;us.max_load_factor()= &quot;</span> &lt;&lt; us.<span class="built_in">max_load_factor</span>() &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;us.max_bucket_count()= &quot;</span> &lt;&lt; us.<span class="built_in">max_bucket_count</span>() &lt;&lt; endl;<span class="comment">//æœ€å¤§çš„ç¯®å­ä¸ªæ•°,å’Œæœ€å¤§å…ƒç´ ä¸ªæ•°ç›¸åŒ</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure><p>unordered_set é€šè¿‡ä¸€ä¸ª<strong>å“ˆå¸Œå‡½æ•°</strong>ï¼Œå°†å¯¹è±¡çš„å€¼æ˜ å°„åˆ°ä¸€ä¸ªæ•°ç»„ä¸‹æ ‡ï¼Œè¿™ä¸ªæ•°ç»„ä¸‹æ ‡å¯¹åº”çš„æ˜¯unordered_setä¸­çš„ä¸€ä¸ªâ€œæ¡¶â€ï¼Œè¡¨ç¤ºæ‰€æœ‰å¯ä»¥æ˜ å°„åˆ°è¿™ä¸ªä¸‹æ ‡çš„å…ƒç´ çš„é›†åˆï¼Œé€šå¸¸ç”¨é“¾è¡¨è¡¨ç¤ºã€‚</p><p>è¿™ä¸ªvectoræ•°ç»„æˆ‘ä¸€èˆ¬å½¢è±¡çš„ç§°å…¶ä¸º<strong>ç¯®å­</strong>ã€‚</p><p>ç¯®å­æ‰©å……æœºåˆ¶ï¼š<strong>å½“å…ƒç´ ä¸ªæ•°size()ä¸æ–­å¢åŠ ï¼Œè¾¾åˆ°ç¯®å­ä¸ªæ•°bucket_count()çš„æ—¶å€™ï¼Œvectorå®¹å™¨è¿›è¡Œè¿‘ä¼¼2å€çš„æ‰©å……</strong>ï¼Œå…·ä½“ç•¥</p><p>æ‰€ä»¥ï¼Œ<strong>ç¯®å­ä¸ªæ•°ä¸€å®šå¤§äºå…ƒç´ ä¸ªæ•°</strong>!!!</p><h4 id="unordered_multimap-å’Œ-unordered_map"><a href="#unordered_multimap-å’Œ-unordered_map" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#unordered_multimap-å’Œ-unordered_map"></a> unordered_multimap å’Œ unordered_map</h4><p>ä¸ä¸Šé¢çš„å¤§æ¦‚ç›¸åŒï¼Œä¸åŒçš„æ˜¯ï¼Œä¼ å…¥çš„æ•°æ®ç±»å‹æ˜¯ä¸€ä¸ª<strong>é”®å€¼å¯¹ pair&lt;keyType,valueType&gt;</strong></p><p>å…¶ä»–ç•¥ï¼Œå…·ä½“å®ç°åé¢å†è°ˆ</p><h3 id="ä½¿ç”¨åˆ†é…å™¨-allocator"><a href="#ä½¿ç”¨åˆ†é…å™¨-allocator" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä½¿ç”¨åˆ†é…å™¨-allocator"></a> ä½¿ç”¨åˆ†é…å™¨ allocator</h3><p>è¿™éƒ¨åˆ†å…ˆäº†è§£æ€ä¹ˆä½¿ç”¨åˆ†é…å™¨ï¼Œåé¢ä¼šæœ‰ä¸“é¢˜æ¥è®²è§£åˆ†é…å™¨çš„åŸç†</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230415165550803.png" alt="image-20230415165550803"></p><p><strong>è™½ç„¶åˆ†é…å™¨æœ‰ç”³è¯·å†…å­˜ç©ºé—´å¹¶ä¸”å½’è¿˜å†…å­˜ç©ºé—´çš„æ¥å£ï¼Œä½†æ˜¯ä¸å»ºè®®ç›´æ¥ä½¿ç”¨åˆ†é…å™¨ï¼Œå› ä¸ºè¿™æ ·åˆ†é…å™¨çš„è´Ÿæ‹…å¤ªé‡äº†ã€‚è€Œåº”è¯¥å»ä½¿ç”¨å®¹å™¨ï¼Œè®©åˆ†é…å™¨ç»™å®¹å™¨åˆ†é…ç©ºé—´ï¼Œè¿™æ ·çš„æ•ˆç‡ä¼šé«˜å¾ˆå¤š!!!</strong></p><h2 id="ç¬¬äºŒè®²åˆ†é…å™¨-è¿­ä»£å™¨"><a href="#ç¬¬äºŒè®²åˆ†é…å™¨-è¿­ä»£å™¨" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¬¬äºŒè®²åˆ†é…å™¨-è¿­ä»£å™¨"></a> ç¬¬äºŒè®²ï¼šåˆ†é…å™¨ è¿­ä»£å™¨</h2><h3 id="oopé¢å‘å¯¹è±¡ç¼–ç¨‹å’Œgpæ³›å‹ç¼–ç¨‹"><a href="#oopé¢å‘å¯¹è±¡ç¼–ç¨‹å’Œgpæ³›å‹ç¼–ç¨‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#oopé¢å‘å¯¹è±¡ç¼–ç¨‹å’Œgpæ³›å‹ç¼–ç¨‹"></a> OOP(é¢å‘å¯¹è±¡ç¼–ç¨‹)å’ŒGP(æ³›å‹ç¼–ç¨‹)</h3><p>OOPå°† data å’Œ methods ç»“åˆåœ¨ä¸€èµ·,GPå´å°†ä»–ä»¬ä¸¤ä¸ªåˆ†å¼€æ¥</p><p>é‡‡ç”¨GP:</p><p>1.å®¹å™¨Containerså’Œç®—æ³•Algorithmså¯ä»¥å„è‡ªé—­é—¨é€ è½¦ï¼Œé€šè¿‡è¿­ä»£å™¨Iteratorè¿æ¥èµ·æ¥å³å¯</p><p>2.ç®—æ³•ALgorithmsé€šè¿‡è¿­ä»£å™¨Iteratorç¡®å®šæ“ä½œèŒƒå›´ï¼Œå¹¶é€šè¿‡Iteratorå–ç”¨Containerå…ƒç´ </p><h3 id="éšæœºè®¿é—®è¿­ä»£å™¨"><a href="#éšæœºè®¿é—®è¿­ä»£å™¨" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#éšæœºè®¿é—®è¿­ä»£å™¨"></a> éšæœºè®¿é—®è¿­ä»£å™¨</h3><p>éšæœºè®¿é—®è¿­ä»£å™¨ RandomAccessIteratorï¼šèƒ½å¤Ÿéšæœºè®¿é—®å®¹å™¨ä¸­çš„ä»»ä¸€å…ƒç´ ï¼Œä¾‹å¦‚vectorå•ç«¯æ•°ç»„</p><p>è¿™æ ·çš„è¿­ä»£å™¨å¯ä»¥è¿›è¡Œ+ -å·çš„è¿ç®—ï¼Œä¾‹å¦‚:</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> mid=(v.<span class="built_in">begin</span>()+v.<span class="built_in">end</span>())/<span class="number">2</span> <span class="comment">//éšè®¿è®¿é—®è¿­ä»£å™¨æ‰å¯ä»¥è¿™ä¹ˆæ“ä½œ</span></span><br></pre></td></tr></table></div></figure><p>æåˆ°è¿™é‡Œï¼Œå°±ä¸å¾—ä¸æä¸€ä¸‹ç®—æ³•åº“é‡Œçš„å…¨å±€å‡½æ•° sort() äº†</p><p><strong>sort()å‡½æ•°å†…éƒ¨å®ç°çš„æœºåˆ¶è°ƒç”¨äº†éšæœºè®¿é—®è¿­ä»£å™¨ï¼Œè¿›è¡Œäº†Â±çš„è¿ç®—ï¼Œæ‰€ä»¥èƒ½è°ƒç”¨çš„å‰æåªèƒ½æ˜¯éšæœºè®¿é—®è¿­ä»£å™¨ï¼Œæ¯”å¦‚vector,deque</strong></p><p><strong>æ‰€ä»¥ç”±äºlistä¸æ»¡è¶³è¿™ä¸ªè¿­ä»£å™¨ï¼Œæ‰€ä»¥ä»–ä¸èƒ½è°ƒç”¨å…¨å±€sortå‡½æ•°ï¼Œåªèƒ½ç”¨è‡ªå·±ç±»å®ç°çš„sortå‡½æ•°ï¼Œå³ l.sort()</strong></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Type&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(list&lt;Type&gt; &amp;l)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    for_each(l.<span class="built_in">begin</span>(), l.<span class="built_in">end</span>(), [&amp;](<span class="keyword">auto</span> val)</span><br><span class="line">             &#123; cout &lt;&lt; val &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;);</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    list&lt;<span class="type">int</span>&gt; l;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i)</span><br><span class="line">        l.<span class="built_in">push_back</span>(<span class="number">9</span> - i);</span><br><span class="line">    <span class="built_in">print</span>(l);</span><br><span class="line">    <span class="comment">// sort(l.begin(), l.end(), less_equal&lt;int&gt;());//ç”¨ä¸äº† å› ä¸ºä»–ä¸æ˜¯RandomAccessIterator Error!!!</span></span><br><span class="line">    l.<span class="built_in">sort</span>(<span class="built_in">less_equal</span>&lt;<span class="type">int</span>&gt;());</span><br><span class="line">    <span class="built_in">print</span>(l);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="gp-æ³›å‹ç¼–ç¨‹ä¸¾ä¸€ä¸ªä¾‹å­"><a href="#gp-æ³›å‹ç¼–ç¨‹ä¸¾ä¸€ä¸ªä¾‹å­" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#gp-æ³›å‹ç¼–ç¨‹ä¸¾ä¸€ä¸ªä¾‹å­"></a> GP æ³›å‹ç¼–ç¨‹ä¸¾ä¸€ä¸ªä¾‹å­</h3><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> fuck</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Type&gt;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">const</span> Type &amp;<span class="title">max</span><span class="params">(<span class="type">const</span> Type &amp;a, <span class="type">const</span> Type &amp;b)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a &lt; b ? b : a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Type, <span class="keyword">class</span> <span class="title class_">functor</span>&gt;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">const</span> Type &amp;<span class="title">max</span><span class="params">(<span class="type">const</span> Type &amp;a, <span class="type">const</span> Type &amp;b, functor &amp;cmp)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">cmp</span>(a, b) ? b : a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">strCmp</span><span class="params">(<span class="type">const</span> string &amp;s1, <span class="type">const</span> string &amp;s2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s<span class="number">1.</span><span class="built_in">size</span>() &lt; s<span class="number">2.</span><span class="built_in">size</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;max of zoo and hello: &quot;</span> &lt;&lt; fuck::<span class="built_in">max</span>(<span class="built_in">string</span>(<span class="string">&quot;zoo&quot;</span>), <span class="built_in">string</span>(<span class="string">&quot;hello&quot;</span>)) &lt;&lt; endl;         <span class="comment">// zoo</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;max of zoo and hello: &quot;</span> &lt;&lt; fuck::<span class="built_in">max</span>(<span class="built_in">string</span>(<span class="string">&quot;zoo&quot;</span>), <span class="built_in">string</span>(<span class="string">&quot;hello&quot;</span>), strCmp) &lt;&lt; endl; <span class="comment">// hello</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">test</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è¿™ä¸ªä¾‹å­å¾ˆç®€å•ï¼Œå°±ä¸å¤šåšè§£é‡Šäº†</p><h3 id="é‡è½½newè¿ç®—ç¬¦-operator-new"><a href="#é‡è½½newè¿ç®—ç¬¦-operator-new" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#é‡è½½newè¿ç®—ç¬¦-operator-new"></a> é‡è½½newè¿ç®—ç¬¦ operator new</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416094923459.png" alt="image-20230416094923459"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨c++å½“ä¸­ï¼Œnewå…³é”®å­—åœ¨è°ƒç”¨ä¹‹åéƒ½ä¼šèµ°åˆ°cè¯­è¨€çš„mallocå‡½æ•°æ¥åˆ†é…å†…å­˜ï¼Œç„¶åmallocå‡½æ•°åˆ†é…å†…å­˜çš„æœºåˆ¶å°±æ˜¯ä¸Šé¢é‚£ä¸ªå†…å­˜å—æ‰€ç¤º</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416095052581.png" alt="image-20230416095052581" style="zoom:67%"><p>sizeæ‰€åŒ…å«çš„å†…å®¹æ‰æ˜¯æˆ‘æƒ³è¦çš„å­˜æ”¾æ•°æ®çš„å†…å®¹éƒ¨åˆ†ï¼Œä½†æ˜¯mallocä¼šç»™æˆ‘ä»¬å¼€è¾Ÿæ¯”sizeæ›´å¤§çš„ç©ºé—´ï¼Œè¿™äº›åœ¨å¦ä¸€é—¨è¯¾é‡Œé¢ä¼šå…·ä½“è°ˆåˆ°ã€‚</p><h3 id="åˆ†é…å™¨-allocators"><a href="#åˆ†é…å™¨-allocators" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#åˆ†é…å™¨-allocators"></a> åˆ†é…å™¨ allocators</h3><h4 id="vc6-allocator"><a href="#vc6-allocator" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#vc6-allocator"></a> VC6 allocator</h4><p>VC6é‡Œé¢çš„åˆ†é…å™¨å…·ä½“å®ç°å¦‚ä¸‹å›¾ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416095559995.png" alt="image-20230416095559995"></p><p>åˆ†é…å™¨å½“ä¸­æœ€é‡è¦çš„å°±æ˜¯ <strong>allocate å‡½æ•° å’Œ deallocate å‡½æ•°</strong></p><p>ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼ŒVCæä¾›çš„åˆ†é…å™¨åœ¨åˆ†é…çš„æ—¶å€™ï¼Œallocateå‡½æ•°åœ¨è°ƒç”¨çš„æ—¶å€™ä¼šè°ƒç”¨ new å…³é”®å­—ï¼Œä¹Ÿå°±æ˜¯ä¼šè°ƒç”¨ malloc å‡½æ•°</p><p>åœ¨é‡Šæ”¾å†…å­˜çš„æ—¶å€™è°ƒç”¨deallocate å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨deleteå…³é”®å­—ï¼Œæœ€ç»ˆå°±æ˜¯è°ƒç”¨free å‡½æ•°</p><p>ç»“è®ºï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416095953933.png" alt="image-20230416095953933"></p><p>å¯¹äºè¿™ä¸ªallocatorï¼Œå¦‚æœç¡¬è¦ç”¨çš„è¯å¯ä»¥è¿™ä¹ˆä½¿ç”¨</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å»ºç«‹åˆ†é…å™¨</span></span><br><span class="line"><span class="type">int</span> *p = <span class="built_in">allocator</span>&lt;<span class="type">int</span>&gt;().<span class="built_in">allocate</span>(<span class="number">512</span>, (<span class="type">int</span> *)<span class="number">0</span>);</span><br><span class="line"><span class="comment">// å½’è¿˜</span></span><br><span class="line"><span class="built_in">allocator</span>&lt;<span class="type">int</span>&gt;().<span class="built_in">deallocate</span>(p, <span class="number">512</span>);<span class="comment">//åœ¨å½’è¿˜çš„æ—¶å€™è¿˜éœ€è¦ä¹‹å‰çš„å¤§å°ï¼Œæ‰€ä»¥éå¸¸ä¸å¥½ç”¨!!!</span></span><br></pre></td></tr></table></div></figure><h4 id="bc-allocator"><a href="#bc-allocator" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#bc-allocator"></a> BC++ allocator</h4><p>BC5 STLä¸­å¯¹åˆ†é…å™¨çš„è®¾è®¡å’ŒVC6ä¸€æ ·ï¼Œæ²¡æœ‰ç‰¹æ®Šè®¾è®¡</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416101021861.png" alt="image-20230416101021861"></p><p>æ“ä½œç•¥</p><h4 id="gcc29-allocator"><a href="#gcc29-allocator" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#gcc29-allocator"></a> GCC2.9 allocator</h4><p>å’Œå‰é¢ä¸¤ä¸ªä¸€æ ·ï¼Œä¹Ÿæ²¡æœ‰ç‰¹æ®Šè®¾è®¡ï¼Œå°±æ˜¯ç®€å•çš„è°ƒç”¨malloc å’Œ freeåˆ†é…å’Œé‡Šæ”¾å†…å­˜</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416101451151.png" alt="image-20230416101451151"></p><p>å³è¾¹è¿™ä¸€æ®µæ³¨é‡Šçš„æ„æ€å°±æ˜¯è™½ç„¶è¿™é‡Œå®ç°äº†ç¬¦åˆæ ‡å‡†çš„allocatorï¼Œä½†æ˜¯ä»–è‡ªå·±çš„å®¹å™¨ä»æ¥ä¸å»ç”¨è¿™äº›åˆ†é…å™¨ï¼Œè¿™äº›åˆ†é…å™¨éƒ½æœ‰ä¸€ä¸ªè‡´å‘½çš„ç¼ºç‚¹ï¼Œå°±æ˜¯å› ä¸ºæœ¬è´¨æ˜¯åœ¨è°ƒç”¨malllocå’Œfreeå‡½æ•°ï¼Œæ ¹æ®å‰é¢çš„å†…å­˜åˆ†é…æœºåˆ¶å¾ˆå®¹æ˜“çœ‹å‡ºä¼šäº§ç”Ÿå¾ˆå¤šçš„å…¶ä»–ç©ºé—´ï¼Œä»è€Œè¢«æµªè´¹ï¼Œæ‰€ä»¥å¼€é”€ç›¸å¯¹æ¯”è¾ƒå¤§ï¼Œä¸€èˆ¬ä¸ç”¨</p><h4 id="gcc29-è‡ªå·±ä½¿ç”¨çš„åˆ†é…å™¨allocä¸æ˜¯allocator"><a href="#gcc29-è‡ªå·±ä½¿ç”¨çš„åˆ†é…å™¨allocä¸æ˜¯allocator" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#gcc29-è‡ªå·±ä½¿ç”¨çš„åˆ†é…å™¨allocä¸æ˜¯allocator"></a> GCC2.9 è‡ªå·±ä½¿ç”¨çš„åˆ†é…å™¨ï¼šalloc(ä¸æ˜¯allocator!!!)</h4><p>è¿™ä¸ªåˆ†é…å™¨æƒ³å¿…æ¯”allocatorè¦å¥½ç”¨çš„å¤š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416102010067.png" alt="image-20230416102010067"></p><p>å…¶å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416102442772.png" alt="image-20230416102442772"></p><p><strong>æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿè®¾è®¡äº†16ä¸ªé“¾è¡¨ï¼Œæ¯ä¸ªé“¾è¡¨ç®¡ç†ç‰¹å®šå¤§å°çš„åŒºå—ï¼Œ#0ç®¡ç†8ä¸ªå­—èŠ‚ï¼Œ#1ç®¡ç†16ï¼Œä»¥æ­¤ç±»æ¨ï¼Œæœ€å#15ç®¡ç†168ä¸ªå­—èŠ‚ã€‚æ‰€æœ‰ä½¿ç”¨è¿™ä¸ªåˆ†é…å™¨çš„å…ƒç´ çš„å¤§å°ä¼šè¢«è°ƒæ•´åˆ°8çš„å€æ•°ï¼Œæ¯”å¦‚50çš„å¤§å°ä¼šè¢«è°ƒæ•´åˆ°56ã€‚å¦‚æœè¯¥é“¾è¡¨ä¸‹é¢æ²¡æœ‰æŒ‚å†…å­˜å—ï¼Œé‚£ä¹ˆä¼šå‘æ“ä½œç³»ç»Ÿç”¨mallocå‡½æ•°ç”³è¯·ä¸€å¤§å—å†…å­˜å—ï¼Œç„¶ååšåˆ‡å‰²ï¼Œä¹‹ååˆ†å‡ºä¸€å—ç»™è¯¥å®¹å™¨ï¼Œç”¨å•é¡¹é“¾è¡¨å­˜å‚¨ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯é¿å…äº†cookieçš„é¢å¤–å¼€é”€ï¼Œå‡å°‘äº†å†…å­˜æµªè´¹ã€‚</strong></p><p>è¿™ä¸ªä¸œè¥¿çš„ç¼ºé™·åˆ°å†…å­˜ç®¡ç†é‡Œé¢å»è®²ã€‚</p><h4 id="gcc49-ä½¿ç”¨çš„åˆ†é…å™¨allocatorä¸æ˜¯alloc"><a href="#gcc49-ä½¿ç”¨çš„åˆ†é…å™¨allocatorä¸æ˜¯alloc" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#gcc49-ä½¿ç”¨çš„åˆ†é…å™¨allocatorä¸æ˜¯alloc"></a> GCC4.9 ä½¿ç”¨çš„åˆ†é…å™¨ï¼šallocator(ä¸æ˜¯alloc!!!)</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416105043344.png" alt="image-20230416105043344"></p><p>å‘ç° allocator æ˜¯ç»§æ‰¿çš„çˆ¶ç±» new_allocator</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416105348361.png" alt="image-20230416105348361"></p><p><strong>å‘ç°GCC4.9ä½¿ç”¨çš„åˆ†é…å™¨å’Œä¹‹å‰çš„åˆ†é…å™¨æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œæ²¡æœ‰ç‰¹æ®Šè®¾è®¡ï¼Œå°±æ˜¯è°ƒç”¨çš„mallocå‡½æ•°å’Œfreeå‡½æ•°ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆ(è¿™ä¸ªå›¢é˜Ÿæ²¡è§£é‡Š)</strong></p><p><strong>ä½†æ˜¯ä½†æ˜¯ï¼GCC4.9é‡Œé¢çš„__pool_allocå°±æ˜¯GCC2.9é‡Œé¢çš„alloc,éå¸¸å¥½ç”¨çš„é‚£ä¸ª</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416110401962.png" alt="image-20230416110401962"></p><h3 id="å®¹å™¨ä¹‹é—´çš„å…³ç³»"><a href="#å®¹å™¨ä¹‹é—´çš„å…³ç³»" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å®¹å™¨ä¹‹é—´çš„å…³ç³»"></a> å®¹å™¨ä¹‹é—´çš„å…³ç³»</h3><p>å®¹å™¨ä¸å®¹å™¨ä¹‹é—´çš„å…³ç³»åŸºæœ¬ä¸Šéƒ½æ˜¯å¤åˆçš„å…³ç³»ï¼Œæ¯”å¦‚set/multisetå’Œmap/multimapåº•å±‚éƒ½æ˜¯ç”±rbtreeçº¢é»‘æ ‘å®ç°çš„ç­‰ç­‰ï¼Œå…·ä½“è§ä¸‹å›¾</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416154815162.png" alt="image-20230416154815162"></p><h3 id="åŒºåˆ«sizeå’Œsizeof"><a href="#åŒºåˆ«sizeå’Œsizeof" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#åŒºåˆ«sizeå’Œsizeof"></a> åŒºåˆ«size()å’Œsizeof()</h3><p>ä»¥å®¹å™¨listä¸ºä¾‹ï¼Œlist.size()å’Œsizeof(list)æ˜¯æ²¡æœ‰ç›´æ¥çš„å¤§å°è”ç³»çš„ï¼ˆå•é¡¹é“¾è¡¨forward_listä¸å­˜åœ¨size()æ–¹æ³•ï¼‰</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åœ¨vscode+linux g++ç¼–è¯‘å™¨ä¸­</span></span><br><span class="line">    list&lt;<span class="type">char</span>&gt; l;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; ++i)</span><br><span class="line">        l.<span class="built_in">push_back</span>(<span class="string">&#x27;a&#x27;</span> + i);</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; l.<span class="built_in">size</span>() &lt;&lt; endl;  <span class="comment">// 26</span></span><br><span class="line">    cout &lt;&lt; <span class="built_in">sizeof</span>(l) &lt;&lt; endl; <span class="comment">// 24</span></span><br></pre></td></tr></table></div></figure><p>l.size()æŒ‡çš„æ˜¯å®¹å™¨ä¸­å­˜æ”¾çš„å…ƒç´ ä¸ªæ•°ï¼›sizeof(l)æŒ‡çš„æ˜¯éœ€è¦å½¢æˆlistè¿™ä¸ªå®¹å™¨éœ€è¦è¿™ä¸ªç±»æ‰€å çš„å†…å­˜æœ‰å¤šå¤§ï¼Œlistç±»é‡Œé¢ä¸ä»…å­˜æ”¾äº†é“¾è¡¨çš„æŒ‡é’ˆï¼Œè¿˜æœ‰å…¶ä»–çš„æˆå‘˜å±æ€§æ¥é…åˆæ§åˆ¶è¿™ä¸ªå®¹å™¨çš„è¿è¡Œ.æ‰€ä»¥sizeof(l)å’Œè¿™ä¸ªå…ƒç´ çš„ä¸ªæ•°ä¸€èˆ¬æ²¡æœ‰å…³ç³»ã€‚</p><h3 id="æ·±å…¥æ¢ç´¢-list"><a href="#æ·±å…¥æ¢ç´¢-list" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ·±å…¥æ¢ç´¢-list"></a> æ·±å…¥æ¢ç´¢ list</h3><p>GCC2.9æ˜¯è¿™æ ·å†™çš„</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416160403390.png" alt="image-20230416160403390"></p><p>å¯ä»¥çœ‹å‡ºï¼Œlisté‡Œé¢éå¸¸é‡è¦çš„ä¸€ç‚¹è®¾è®¡å°±æ˜¯<strong>å§”æ‰˜</strong>è®¾è®¡ï¼Œ<strong>å³listæœ¬èº«çš„ç±»å¹¶ä¸æ˜¯å®é™…çš„åŒå‘é“¾è¡¨ï¼Œç”¨æˆ·æ‰€èƒ½æ“ä½œçš„è¿™ä¸ªç±»å…¶å®å¯ä»¥çœ‹ä½œåŒå‘é“¾è¡¨çš„ç®¡ç†ç±»ï¼Œé‡Œé¢æœ‰æˆå‘˜å‡½æ•°ï¼Œè¿­ä»£å™¨ï¼Œè¿˜æœ‰ä¸€æ ¹æŒ‡å‘åŒå‘é“¾è¡¨çš„æŒ‡é’ˆï¼Œå®é™…çš„åŒå‘é“¾è¡¨ç»“æ„å°±å¦‚ä¸Šé¢æ‰€ç¤º,__list_nodeï¼Œè¿™ä¸ªæ‰æ˜¯çœŸæ­£çš„å­˜å‚¨ç»“æ„</strong>ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆsizeof()å’Œsize()æ˜¯ä¸ä¸€æ ·çš„ï¼Œå› ä¸ºè®¾è®¡è€…å¾ˆå¥½çš„æŠŠäºŒè€…åˆ†å¼€äº†ï¼Œä½¿å¾—ç”¨æˆ·å’Œå†™ä»£ç çš„äººéƒ½èƒ½å¾ˆå¥½çš„ç®¡ç†è‡ªå·±çš„éƒ¨åˆ†ã€‚</p><p>ç”±äºlistçš„å­˜å‚¨æ˜¯ä¸è¿ç»­çš„ï¼Œæ‰€ä»¥ç›¸åº”çš„ä»–çš„è¿­ä»£å™¨ä¹Ÿéœ€è¦æ˜¯æ™ºèƒ½æŒ‡é’ˆï¼Œéœ€è¦é‡è½½++å’Œâ€“è¿ç®—ç¬¦ï¼Œ(æ³¨æ„listçš„è¿­ä»£å™¨ä¸æ˜¯éšæœºè®¿é—®è¿­ä»£å™¨ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨+ -å·è¿ç®—ç¬¦ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨ç®—æ³•åº“çš„å‡½æ•°sort()ï¼Œè€Œéœ€è¦ä½¿ç”¨è‡ªå¸¦çš„å‡½æ•°sort() )é‚£ä¹ˆå°±åº”è¯¥æ˜¯ä¸€ä¸ªç±»äº†ã€‚<strong>è¿›è€Œæ¨å¾—æ‰€æœ‰çš„å®¹å™¨(é™¤äº†vectorå’Œarray)çš„è¿­ä»£å™¨ï¼Œæœ€å¥½éƒ½å†™æˆä¸€ä¸ªç±»æ¥å®ç°ã€‚</strong></p><h4 id="listçš„è¿­ä»£å™¨"><a href="#listçš„è¿­ä»£å™¨" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#listçš„è¿­ä»£å™¨"></a> listçš„è¿­ä»£å™¨</h4><p>è¿™ä¸ªè¿­ä»£å™¨æœ€é‡è¦çš„å°±æ˜¯é‡è½½ ++ è¿ç®—ç¬¦ï¼Œä¹Ÿå°±æ˜¯å‰ç½®<ins>å’Œåç½®</ins></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416163304200.png" alt="image-20230416163304200"></p><p>å‰ç½®<ins>å’Œåç½®</ins>çš„åŒºåˆ«å°±æ˜¯åç½®<ins>çš„å‚æ•°åˆ—è¡¨é‡Œé¢ä¼šæœ‰ä¸€ä¸ªå ä½ç¬¦intæ¥è¡¨ç¤ºä»–æ˜¯åç½®</ins></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‰ç½®++</span></span><br><span class="line">self&amp; <span class="keyword">operator</span>++()&#123;</span><br><span class="line">    node=(link_type)((*node).next);</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¿™é‡Œçš„selfæ˜¯æŒ‡è¿­ä»£å™¨è¿™ä¸ªç±»ï¼Œæ˜¯ä¸ªåˆ«åã€‚è¿™ä¸ªå®ç°è¿˜æ˜¯æ¯”è¾ƒå®¹å™¨ç†è§£çš„</span></span><br><span class="line"><span class="comment">//æ³¨æ„è¿”å›çš„æ˜¯è¿­ä»£å™¨æ–°çš„ä½ç½®æ‰€ä»¥å¯ä»¥è¿”å›å¼•ç”¨ç±»å‹</span></span><br></pre></td></tr></table></div></figure><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‹·è´æ„é€ </span></span><br><span class="line">__list_iterator(<span class="type">const</span> iterator&amp; x):<span class="built_in">node</span>(x.node)&#123;&#125;</span><br></pre></td></tr></table></div></figure><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é‡è½½*</span></span><br><span class="line">reference <span class="keyword">operator</span>*()<span class="type">const</span>&#123;<span class="keyword">return</span> (*node).data;&#125;</span><br></pre></td></tr></table></div></figure><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åç½®++</span></span><br><span class="line">self <span class="keyword">operator</span>++(<span class="type">int</span>)&#123;</span><br><span class="line">	self tmp=*<span class="keyword">this</span>;</span><br><span class="line">    <span class="comment">//è¿™ä¸€æ­¥ä»”ç»†çœ‹çœ‹ï¼Œå¯èƒ½ä¼šè°ƒç”¨æ‹·è´æ„é€ (=)ï¼Œå¯èƒ½ä¹Ÿä¼šè°ƒç”¨*é‡è½½ï¼Œä½†æ˜¯*é‡è½½æ˜æ˜¾ä¸ç¬¦åˆè¦æ±‚</span></span><br><span class="line">    <span class="comment">//å†åŠ ä¸Š = åœ¨å‰é¢ï¼Œæ‰€ä»¥è°ƒç”¨çš„æ˜¯æ‹·è´æ„é€ ï¼Œ*thiså·²ç»è¢«çœ‹ä½œæ‹·è´æ„é€ çš„å‚æ•°ï¼Œæ‹·è´å‡ºæ¥äº†ä¸€ä¸ªæ–°çš„åŸä½ç½®è¿­ä»£å™¨!!!!</span></span><br><span class="line">	++*<span class="keyword">this</span>;</span><br><span class="line">    <span class="comment">//å‰ç½®++</span></span><br><span class="line">	<span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ³¨æ„ç”±äºéœ€è¦è¿”å›åŸä½ç½®çš„è¿­ä»£å™¨ï¼Œè€Œç°åœ¨çš„è¿­ä»£å™¨å·²ç»æ”¹å˜äº†ï¼Œæ‰€ä»¥æœ€å¥½æ–°åˆ›å»ºä¸€ä¸ªï¼Œreturn by value</span></span><br></pre></td></tr></table></div></figure><h4 id="å…³äºä¸ºä»€ä¹ˆåç½®ä¸èƒ½è¿”å›å¼•ç”¨æ¯”è¾ƒæœ‰è¯´æœåŠ›çš„è¿˜æœ‰å¦‚ä¸‹çš„åŸå› "><a href="#å…³äºä¸ºä»€ä¹ˆåç½®ä¸èƒ½è¿”å›å¼•ç”¨æ¯”è¾ƒæœ‰è¯´æœåŠ›çš„è¿˜æœ‰å¦‚ä¸‹çš„åŸå› " class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å…³äºä¸ºä»€ä¹ˆåç½®ä¸èƒ½è¿”å›å¼•ç”¨æ¯”è¾ƒæœ‰è¯´æœåŠ›çš„è¿˜æœ‰å¦‚ä¸‹çš„åŸå› "></a> å…³äºä¸ºä»€ä¹ˆåç½®++ä¸èƒ½è¿”å›å¼•ç”¨ï¼Œæ¯”è¾ƒæœ‰è¯´æœåŠ›çš„è¿˜æœ‰å¦‚ä¸‹çš„åŸå› ï¼š</h4><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> i=<span class="number">2</span>,j=<span class="number">2</span>;</span><br><span class="line">cout&lt;&lt; ++++i &lt;&lt; j++++ &lt;&lt; endl;</span><br></pre></td></tr></table></div></figure><p><strong>æˆ‘ä»¬å°è¯•å°†iå’Œjåˆ†åˆ«è¿›è¡Œå‰ç½®å’Œåç½®<ins>åˆ†åˆ«åŠ ä¸¤æ¬¡ï¼Œc</ins>çš„ç¼–è¯‘å™¨å…è®¸å‰ç½®<ins>è¿ç»­åŠ ï¼Œä½†æ˜¯ä¸å…è®¸åç½®</ins>è¿ç»­åŠ ï¼Œæˆ‘ä»¬çŸ¥é“æƒ³è¦è¿ç»­åŠ çš„æ¡ä»¶å°±æ˜¯è¦è¿”å›å¼•ç”¨ç»§ç»­ä¿®æ”¹åŸæœ¬çš„å€¼ï¼Œæ‰€ä»¥æ—¢ç„¶ä¸å…è®¸è¿ç»­åç½®++ï¼Œé‚£ä¹ˆå°±return by valueï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡</strong></p><p>ç„¶åç±»åœ¨é‡è½½è¿™ä¸¤ä¸ªè¿ç®—ç¬¦çš„æ—¶å€™ä¹Ÿä¼šå‘ç¼–è¯‘å™¨è‡ªå¸¦çš„è§„åˆ™çœ‹èµ·ï¼Œä¹Ÿä¸å…è®¸åç½®++è¿ç»­åŠ ï¼Œæ‰€ä»¥å°±åªèƒ½return by value</p><h4 id="å…³äº-å’Œ-è¿ç®—ç¬¦çš„é‡è½½"><a href="#å…³äº-å’Œ-è¿ç®—ç¬¦çš„é‡è½½" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å…³äº-å’Œ-è¿ç®—ç¬¦çš„é‡è½½"></a> å…³äº * å’Œ &amp; è¿ç®—ç¬¦çš„é‡è½½</h4><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;list&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">fuck</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123; cout &lt;&lt; <span class="string">&quot;hello&quot;</span> &lt;&lt; endl; &#125;</span><br><span class="line">    <span class="built_in">fuck</span>(<span class="type">int</span> data = <span class="number">0</span>) : _data(data) &#123;&#125;<span class="comment">//æ„é€ å‡½æ•°ï¼Œå¯ä»¥å°†intç±»å‹è½¬åŒ–ä¸ºç±»å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getData</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>-&gt;_data; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> _data;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    list&lt;fuck&gt; l&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">9</span>&#125;;</span><br><span class="line">    <span class="keyword">auto</span> iter = l.<span class="built_in">begin</span>();<span class="comment">//å–å¾—é¦–ä¸ªå…ƒç´ è¿­ä»£å™¨</span></span><br><span class="line">    <span class="comment">//*iterå–å¾—çš„æ˜¯ fuck å¯¹è±¡,iter-&gt;å–å¾—çš„æ˜¯ fuckå¯¹è±¡æŒ‡é’ˆ</span></span><br><span class="line">    <span class="comment">//å¯¹äºç®€å•çš„ç±»å‹ iter-&gt;æ²¡ä»€ä¹ˆä½œç”¨ï¼Œæ¯”å¦‚intï¼Œè¿™æ—¶å€™*iterå°±ä»£è¡¨äº†valueï¼Œä½†æ˜¯å¯¹äºç±»å¯¹è±¡é‚£å°±ä¸ä¸€æ ·äº†</span></span><br><span class="line">    cout &lt;&lt; (*iter).<span class="built_in">getData</span>() &lt;&lt; endl;</span><br><span class="line">    iter-&gt;<span class="built_in">print</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>*å’Œ-&gt;çš„å…·ä½“å®ç°,Typeæ˜¯ç±»çš„ç±»å‹</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> Type&amp; reference;</span><br><span class="line"><span class="keyword">typedef</span> Type* pointer;</span><br><span class="line"><span class="comment">//* è¿”å›çš„æ˜¯ç±»å¯¹è±¡</span></span><br><span class="line">reference <span class="keyword">operator</span>*()&#123;</span><br><span class="line">    <span class="keyword">return</span> *(<span class="keyword">this</span>-&gt;node);<span class="comment">//nodeæ˜¯è¿­ä»£å™¨å½“ä¸­å­˜æ”¾çš„é“¾è¡¨æŒ‡é’ˆå¯¹è±¡</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//-&gt; è¿”å›çš„æ˜¯ç±»å¯¹è±¡æŒ‡é’ˆ</span></span><br><span class="line">pointer <span class="keyword">operator</span>-&gt;()&#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;(<span class="keyword">operator</span>*());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h4 id="g49-å’Œ-g29çš„åŒºåˆ«"><a href="#g49-å’Œ-g29çš„åŒºåˆ«" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#g49-å’Œ-g29çš„åŒºåˆ«"></a> G4.9 å’Œ G2.9çš„åŒºåˆ«</h4><p>å…·ä½“åŒºåˆ«å°±å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416171855901.png" alt="image-20230416171855901"></p><p>åœ¨4.9ç‰ˆæœ¬å½“ä¸­</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230416174305071.png" alt="image-20230416174305071"></p><p><strong>åˆ»æ„åœ¨listå°¾ç«¯åŠ ä¸Šä¸€æ®µç©ºç™½çš„åŒºåŸŸæ¥å¤åˆSTLè¿­ä»£å™¨å‰é—­åå¼€çš„ç‰¹å¾!!!ä½†æ˜¯ç›¸åº”çš„è¿™ä¸ªè®¾è®¡çš„å¤æ‚åº¦åˆå¤§å¤§å¢åŠ äº†ã€‚</strong></p><h3 id="è¿­ä»£å™¨çš„è®¾è®¡åŸåˆ™"><a href="#è¿­ä»£å™¨çš„è®¾è®¡åŸåˆ™" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è¿­ä»£å™¨çš„è®¾è®¡åŸåˆ™"></a> è¿­ä»£å™¨çš„è®¾è®¡åŸåˆ™</h3><p>Iteratoréœ€è¦éµå¾ªçš„åŸåˆ™ï¼šåœ¨è°ƒç”¨ç®—æ³•çš„æ—¶å€™ï¼Œiteratorä½œä¸ºä¸­é—´æ¡¥æ¢è¿æ¥å®¹å™¨å’Œç®—æ³•ï¼Œæ‰€ä»¥ç®—æ³•éœ€è¦çŸ¥é“Iteratorçš„å¾ˆå¤šä¸œè¥¿</p><p><strong>ç®—æ³•éœ€è¦çŸ¥é“è¿­ä»£å™¨çš„å¿…è¦ä¿¡æ¯ï¼Œè¿›è€Œå†³å®šé‡‡å–æœ€ä¼˜åŒ–çš„åŠ¨ä½œ</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230419170456164.png" alt="image-20230419170456164"></p><p>åœ¨C++æ ‡å‡†åº“å½“ä¸­è®¾è®¡å‡ºäº”ç§æ ‡å‡†ç±»å‹:</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">iterator_category;</span><br><span class="line"><span class="comment">//è¿­ä»£å™¨çš„åˆ†ç±»ï¼šåªè¯»ï¼Œåªå†™ï¼Œå…è®¸å†™å…¥å‹ç®—æ³•åœ¨è¿­ä»£å™¨åŒºé—´ä¸Šè¿›è¡Œè¯»å†™æ“ä½œ(Forward Iterator)ï¼Œå¯åŒå‘ç§»åŠ¨ï¼ŒRandom Access Iterator</span></span><br><span class="line">difference_type;<span class="comment">//ç”¨æ¥è¡¨ç¤ºè¿­ä»£å™¨ä¹‹é—´çš„è·ç¦»ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªå®¹å™¨çš„æœ€å¤§å®¹é‡</span></span><br><span class="line">value_type;<span class="comment">//è¿­ä»£å™¨æ‰€æŒ‡å¯¹è±¡çš„ç±»å‹</span></span><br><span class="line"></span><br><span class="line">reference;</span><br><span class="line">pointer;<span class="comment">//æœ€åä¸¤ä¸ªåŸºæœ¬æ²¡ç”¨åˆ°</span></span><br></pre></td></tr></table></div></figure><p>è¿™äº”ç§ç±»å‹è¢«ç§°ä½œ <strong>associated type ç›¸å…³ç±»å‹</strong>ï¼›è¿­ä»£å™¨æœ¬èº«å¿…é¡»å®šä¹‰å‡ºæ¥ï¼Œä»¥ä¾¿å›ç­”ç®—æ³•</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230419170815213.png" alt="image-20230419170815213"></p><p>æ¯”å¦‚æˆ‘è‡ªå·±å†™ä¸€ä¸‹é“¾è¡¨listçš„äº”ä¸ªç›¸å…³ç±»å‹</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//GCC4.9ç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Type</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">List_Iterator</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">typedef</span> std::bidirectional_iterator_tag _iterator_category;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">ptrdiff_t</span> _difference_type;</span><br><span class="line">    <span class="keyword">typedef</span> _Type _value_type;</span><br><span class="line">    <span class="keyword">typedef</span> _Type&amp; _reference;</span><br><span class="line">    <span class="keyword">typedef</span> _Type* _pointer;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><p><strong>å¼•å‡ºé—®é¢˜ï¼šç®—æ³•è°ƒç”¨çš„æ—¶å€™ä¼ è¿›å»çš„å¯èƒ½ä¸æ˜¯ä¸ªè¿­ä»£å™¨ï¼Œå¯èƒ½æ˜¯ä¸ªæŒ‡é’ˆï¼Œè¿™ä¸ªæ—¶å€™è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</strong></p><p>å½“ç„¶ï¼ŒæŒ‡é’ˆæ˜¯ä¸ª<strong>é€€åŒ–</strong>çš„è¿­ä»£å™¨!!!</p><h3 id="traits-èƒå–æœº"><a href="#traits-èƒå–æœº" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#traits-èƒå–æœº"></a> Traits èƒå–æœº</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230419190233258.png" alt="image-20230419190233258"></p><p><strong>Iterator Traitsç”¨äºåŒºåˆ†æ˜¯ class Iterators (ä¹Ÿå°±æ˜¯ä¸€èˆ¬çš„è¿­ä»£å™¨)è¿˜æ˜¯ non-class Iterators(å³ native pointer)ï¼›ä¸¤ç§æƒ…å†µå¯¹åº”ä¸åŒçš„çš„å¤„ç†!!</strong></p><p>åœ¨ç®—æ³•å’Œè¿­ä»£å™¨ä¹‹é—´åŠ ä¸€å±‚ä¸­é—´å±‚Iterator traitsæ¥è¿›è¡Œåˆ¤æ–­ï¼Œå¥½é’ˆå¯¹æ€§çš„è¿›è¡Œè®¾è®¡!!!</p><p>å…·ä½“æ€ä¹ˆåšå‘¢ï¼Ÿ</p><p>è¿™æ—¶å€™ç®—æ³•é‡Œé¢å°±ä¸èƒ½ç›´æ¥é—®è¿­ä»£å™¨çš„äº”ä¸ªç±»å‹äº†ï¼Œå› ä¸º native pointer é‡Œé¢æ²¡æœ‰è¿™äº”ä¸ªå‚æ•°,æ‰€ä»¥éœ€è¦é—´æ¥é€šè¿‡Traitså»é—®!!!</p><p>ä¸‹é¢çš„ä¾‹å­å…ˆå›ç­”äº†ä¸€ä¸ªé—®é¢˜ value_type</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> I,...&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">algorithm</span><span class="params">(...)</span></span>&#123;</span><br><span class="line">    <span class="keyword">typename</span> iterator_traits&lt;I&gt;::value_type v1;<span class="comment">//é€šè¿‡traitså»é—®</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¦‚æœæ˜¯class Iteratoråœ¨è¿™é‡Œ</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">I</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">iterator_traits</span>&#123;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">typename</span> I::value_type value_type;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸¤ä¸ªæ¨¡æ¿åç‰¹åŒ– pointer to T</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">iterator_traits</span>&lt;T*&gt;&#123;</span><br><span class="line">    <span class="keyword">typedef</span> T value_type;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//pointer to const T</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">iterator_traits</span>&lt;<span class="type">const</span> T*&gt;&#123;</span><br><span class="line">    <span class="keyword">typedef</span> T value_type; <span class="comment">//æ³¨æ„æ˜¯Tè€Œä¸æ˜¯const T</span></span><br><span class="line">    <span class="comment">//ä¸ºä»€ä¹ˆæ˜¯ T è€Œä¸æ˜¯ const Tï¼Ÿå› ä¸º value_typeä¸»è¦ç›®çš„æ˜¯å»å£°æ˜å˜é‡ï¼Œconst Tæ²¡åŠæ³•å£°æ˜å˜é‡!!!</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>ä¸‹é¢æŠŠæŒ‡é’ˆçš„å…¨å›ç­”å®Œæ¯•</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//pointer to T</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">iterator_traits</span>&lt;T*&gt;&#123;</span><br><span class="line">    <span class="keyword">typedef</span> random_access_iterator_tag iterator_category;</span><br><span class="line">    <span class="keyword">typedef</span> T value_type;</span><br><span class="line">    <span class="keyword">typedef</span> T* pointer;</span><br><span class="line">    <span class="keyword">typedef</span> T&amp; reference;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">ptrdiff_t</span> difference_type;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//pointer to const T</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">iterator_traits</span>&lt;<span class="type">const</span> T*&gt;&#123;</span><br><span class="line">    <span class="keyword">typedef</span> random_access_iterator_tag iterator_category;</span><br><span class="line">    <span class="keyword">typedef</span> T value_type;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">const</span> T* pointer;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">const</span> T&amp; reference;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">ptrdiff_t</span> difference_type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h2 id="ç¬¬ä¸‰è®²å®¹å™¨"><a href="#ç¬¬ä¸‰è®²å®¹å™¨" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¬¬ä¸‰è®²å®¹å™¨"></a> ç¬¬ä¸‰è®²ï¼šå®¹å™¨</h2><h3 id="æ·±å…¥æ¢ç´¢vector"><a href="#æ·±å…¥æ¢ç´¢vector" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ·±å…¥æ¢ç´¢vector"></a> æ·±å…¥æ¢ç´¢vector</h3><p>å…¶å®è‡ªå·±éƒ½å¯ä»¥å°è£…ä¸€ä¸ªvectorï¼Œå½“ç„¶æ‰€æœ‰çš„åŠŸèƒ½æ˜¯ä¸ç°å®çš„ï¼Œä½†æ˜¯åŸºæœ¬çš„åŠŸèƒ½è¿˜æ˜¯å¯ä»¥</p><h4 id="gcc29çš„è®¾è®¡"><a href="#gcc29çš„è®¾è®¡" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#gcc29çš„è®¾è®¡"></a> GCC2.9çš„è®¾è®¡</h4><p>ç›´è§‚æ„Ÿå—å°±æ˜¯ç®€æ´æ˜äº†</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230419192921703.png" alt="image-20230419192921703"></p><p>è¿™é‡Œé¢æœ‰ä¸‰æ ¹æ³›å‹æŒ‡é’ˆï¼Œstartï¼Œfinishå’Œend_of_storage</p><p><strong>ä¸‹é¢å°±æ˜¯æ¯”è¾ƒé‡è¦çš„push_back()æŸ¥æ•°æ®ï¼Œå¼•å‡ºåé¢çš„äºŒå€æ‰©å±•ç©ºé—´!!!</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230419195537174.png" alt="image-20230419195537174"></p><p><strong>elseè¿™é‡Œï¼Œè°ƒç”¨insert_auxä¹‹åä¸ºä»€ä¹ˆè¿˜è¦è¿›è¡Œä¸€æ¬¡åˆ¤æ–­å‘¢ï¼Ÿ</strong></p><p><strong>è¿™æ˜¯å› ä¸ºç”±äºinsert_auxæ˜¯ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œé‚£ä¹ˆåœ¨å®é™…æ“ä½œè¿‡ç¨‹ä¸­å¯èƒ½ä¼šè¢«å…¶ä»–ç±»å‡½æ•°è°ƒç”¨ï¼Œæ¯”å¦‚insertï¼Œåœ¨è¿™äº›å‡½æ•°çš„å®ç°é€»è¾‘å½“ä¸­æ˜¯éœ€è¦è¿›è¡Œåˆ¤æ–­çš„ã€‚</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230419195610102.png" alt="image-20230419195610102"></p><p><strong>è¿™æ®µæºç çš„å¤§è‡´æ„æ€å°±æ˜¯ï¼šcapacityä¸å¤Ÿäº†å°±åœ¨å†…å­˜ä¸­æ‰¾å¦ä¸€å—2å€å¤§å°çš„å†…å­˜ç”¨äºå­˜æ”¾æ–°çš„vectorï¼ŒæŠŠåŸæ¥çš„å…ƒç´ æ‹·è´è¿‡å»ç„¶åæŠŠåŸæ¥çš„vectoræ€æ‰ï¼Œå„ç§å€¼è¿ç§»åˆ°æ–°å†…å­˜è¿™è¾¹å»!!!</strong></p><p><strong>è‡³äºæ‹·è´å®‰æ’ç‚¹åçš„åŸå†…å®¹æ˜¯å› ä¸ºè¿™é‡Œå¯èƒ½ä¼šè¢«insertå‡½æ•°ç»™è°ƒç”¨ï¼Œè¿™ä¸ªéƒ¨åˆ†æ˜¯insertå‡½æ•°çš„é€»è¾‘!!!</strong></p><p><strong>Vectorå®¹å™¨çš„è¿­ä»£å™¨</strong></p><p>æ—¢ç„¶vectoræ˜¯ä¸€ä¸ªè¿ç»­ç©ºé—´ï¼Œé‚£ä¹ˆiteratorå°±ä¸å¿…è¦è®¾ç½®æˆä¸ºclassäº†ï¼Œåªéœ€è¦è®¾ç½®ä¸ºpointerå°±å¯ä»¥</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‰€ä»¥å¦‚ä¸Šæ‰€ç¤ºï¼Œvectorçš„è¿­ä»£å™¨æ˜¯ä¸€æ ¹æŒ‡é’ˆ</span></span><br><span class="line"><span class="keyword">typedef</span> value_type* iterator; <span class="comment">// T*</span></span><br></pre></td></tr></table></div></figure><h4 id="gcc49çš„è®¾è®¡"><a href="#gcc49çš„è®¾è®¡" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#gcc49çš„è®¾è®¡"></a> GCC4.9çš„è®¾è®¡</h4><p>å¤æ‚ï¼Œä¾æ‰˜ç­”è¾©</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230419201320469.png" alt="image-20230419201320469"></p><h3 id="æ·±å…¥æ¢ç´¢-deque-å’Œ-queue-stack"><a href="#æ·±å…¥æ¢ç´¢-deque-å’Œ-queue-stack" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ·±å…¥æ¢ç´¢-deque-å’Œ-queue-stack"></a> æ·±å…¥æ¢ç´¢ deque å’Œ queue , stack</h3><h4 id="deque-2"><a href="#deque-2" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#deque-2"></a> deque</h4><p>deque åŒç«¯é˜Ÿåˆ—çš„å®ç°ç»“æ„ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230420164335846.png" alt="image-20230420164335846"></p><p><strong>å…·ä½“å®ç°ï¼šå°†dequeçš„å­˜å‚¨åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªç­‰å¤§çš„åŒºåŸŸï¼Œæ¯ä¸ªåŒºåŸŸçš„é¦–å…ƒç´ ç”¨ä¸€ä¸ªæŒ‡é’ˆå­˜æ”¾åœ¨ä¸€ä¸ªvectorå®¹å™¨ä¸­(å°±æ˜¯å›¾ä¸­çš„mapæ•°ç»„)ï¼Œå½“ç¼“å†²åŒºbufferçš„å·¦ç«¯æˆ–è€…å³ç«¯ä¸å¤Ÿçš„æ—¶å€™ï¼Œå°±æ–°å¼€ä¸€ä¸ªç¼“å†²åŒºæ”¾åœ¨å·¦è¾¹å’Œå³è¾¹ï¼Œå­˜å…¥å…ƒç´ ï¼Œå¹¶ä¸”æŠŠè¯¥bufferçš„é¦–æŒ‡é’ˆå­˜å…¥mapæ•°ç»„çš„å·¦è¾¹æˆ–è€…å³è¾¹ã€‚å› æ­¤dequeçš„è¿­ä»£å™¨çš„å°±åˆ†ä¸ºï¼š</strong></p><p><strong>first è¯¥ç¼“å†²åŒºçš„é¦–åœ°å€ï¼›last è¯¥ç¼“å†²åŒºçš„æœ«å°¾(é¦–é—­å°¾å¼€)ï¼›cur å…ƒç´ çš„ä½ç½®ï¼›node å­˜å…¥mapæ•°ç»„çš„æŒ‡é’ˆ!!!</strong></p><p>ä¸‹é¢çœ‹ä¸€ä¸‹dequeçš„å…·ä½“æºä»£ç è®¾è®¡ï¼š</p><p><strong>GCC2.9:</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230420170120084.png" alt="image-20230420170120084"></p><p>å…¶ä¸­ç¬¬ä¸‰ä¸ªå‚æ•° Bufsiz æ˜¯å¯ä»¥äººä¸ºæŒ‡å®šç¼“å†²åŒºçš„å¤§å°</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230420170739434.png" alt="image-20230420170739434"></p><p>ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œä¸Šé¢è°ƒç”¨äº†ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœ BufSiz ä¸ä¸º0ï¼Œé‚£ä¹ˆå°±è®¾ç½®å¤§å°ä¸ºäººä¸ºæŒ‡å®šï¼›å¦‚æœä¸º0ï¼Œåˆ™è¡¨ç¤ºè®¾ç½®ä¸ºé¢„è®¾çš„å€¼ï¼Œéœ€è¦æŸ¥çœ‹è¦å­˜æ”¾çš„ç±»å‹çš„å¤§å°ï¼Œå¤§äº512å°±æŒ‡å®šä¸€ä¸ªç¼“å†²åŒºåªæ”¾è¿™ä¸€ä¸ªå…ƒç´ ï¼Œä¸ªæ•°è®¾ç½®ä¸º1ï¼›å°äºçš„è¯å°±è®¡ç®—å‡ºä¸ªæ•°ï¼Œè®¡ç®—å‡ºä¸ªæ•°ä¹‹åå°±å¯ä»¥çŸ¥é“ç¼“å†²åŒºçš„å¤§å°äº†</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230420170150250.png" alt="image-20230420170150250"></p><p>è¿™ä¸ªè¿­ä»£å™¨é‡Œé¢ä¹ŸåŒ…å«äº†äº”ä¸ªå¿…è¦ç±»å‹ï¼Œå†™çš„éå¸¸ä¸¥è°¨ï¼Œä¹Ÿæœ‰äº†å››ä¸ªéœ€è¦çš„å‚æ•°!!!</p><p><strong>Insertå‡½æ•°:</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230420172205138.png" alt="image-20230420172205138"></p><p>å¦‚æœæ˜¯åœ¨å¤´éƒ¨å’Œå°¾éƒ¨æ’å…¥ï¼Œé‚£ä¹ˆå’Œpush_front()å’Œpush_back()æ²¡æœ‰åŒºåˆ«</p><p>å¦‚æœåœ¨ä¸­é—´æ’å…¥å°±è°ƒç”¨èµ‹å€¼å‡½æ•° insert_aux()</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230420172617688.png" alt="image-20230420172617688"></p><p>ç”±äºåœ¨ä¸­é—´æ’å…¥å¿…ç„¶ä¼šå¯¼è‡´å…ƒç´ çš„æ‹·è´è¿‡ç¨‹ï¼Œä¸ºäº†å‡å°‘å¼€é”€ï¼Œæé«˜æ•ˆç‡ï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­å…ƒç´ åœ¨dequeé è¿‘startå’Œfinishå“ªä¸€ç«¯çš„ä½ç½®ï¼Œè¿™æ ·å¯ä»¥æ›´å¥½çš„å»é€‰æ‹©æ“ä½œçš„æ–¹å‘</p><p><strong>dequeå¦‚ä½•æ¨¡æ‹Ÿè¿ç»­ç©ºé—´æ“ä½œï¼Ÿ(æ“ä½œç¬¦é‡è½½)</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230420173341877.png" alt="image-20230420173341877"></p><p><strong>deque çš„ - å·æ“ä½œç¬¦é‡è½½</strong></p><p>ç”±äº deque å­˜å‚¨çš„ç¼“å†²åŒºbufferæœºåˆ¶ï¼Œæˆ‘ä»¬å¿…é¡»åˆ¤æ–­ä¸¤ä¸ªè¿­ä»£å™¨ä¹‹é—´æœ‰å¤šå°‘ä¸ªç¼“å†²åŒºbufferï¼Œç„¶åå†æ ¹æ®è®¡ç®—å…¬å¼æ¥è¿›è¡Œè®¡ç®—å¾—å‡ºä¸¤ä¸ªè¿­ä»£å™¨ä¹‹é—´å…ƒç´ çš„ä¸ªæ•°</p><p>å…·ä½“å°±æ˜¯è¿™æ ·!</p><p><strong>æ ¹æ®ä¸¤ä¸ªè¿­ä»£å™¨çš„nodeæŒ‡é’ˆæ‰¾åˆ°mapæ•°ç»„é‡Œé¢ä¸¤ä¸ªæŒ‡é’ˆè·ç¦»çš„ä½ç½®å°±å¯ä»¥çŸ¥é“ä¸¤ä¸ªä¸­é—´å·®äº†å¤šå°‘ä¸ªç¼“å†²åŒºbufferäº†ï¼Œå†åŠ ä¸Šæœ¬ç¼“å†²åŒºå†…çš„è·ç¦»å°±æ˜¯ä¸¤ä¸ªè¿­ä»£å™¨ä¹‹é—´çš„å…ƒç´ ä¸ªæ•°!!!</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230420173832550.png" alt="image-20230420173832550"></p><p><strong>++ å’Œ â€“ æ“ä½œç¬¦é‡è½½</strong></p><p>æ³¨æ„éœ€è¦åˆ¤æ–­è¿­ä»£å™¨ç§»åŠ¨è¿‡ç¨‹ä¸­æ˜¯å¦è¶…è¶Šäº†æœ¬ç¼“å†²åŒºçš„ç•Œé™ç§»å…¥å¦ä¸€ä¸ªç¼“å†²åŒº!!!</p><p>ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ç¼–ç ä¹ æƒ¯å°±æ˜¯å<ins>è°ƒç”¨å‰</ins>ï¼›åâ€“è°ƒç”¨å‰â€“</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230420174307662.png" alt="image-20230420174307662"></p><p><strong>+= + å·æ“ä½œç¬¦é‡è½½</strong></p><p>åœ¨ += è¿ç®—ç¬¦é‡è½½ä¸­ï¼Œéœ€è¦æ³¨æ„åˆ¤æ–­è¿­ä»£å™¨ä½ç½®ç§»åŠ¨ä¹‹åæœ‰æ²¡æœ‰è¶…è¶Šè¾¹ç•Œï¼Œå¦‚æœè¶…è¶Šäº†è¾¹ç•Œï¼Œéœ€è¦è¿›è¡Œç›¸åº”çš„è¾¹ç•Œä¿®æ”¹</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230420193008988.png" alt="image-20230420193008988"></p><p>+= å¦‚æœæ²¡æœ‰æ­£ç¡®çš„ç¼“å†²åŒºéœ€è¦åˆ‡æ¢åˆ°æ­£ç¡®çš„ç¼“å†²åŒºï¼›å¦‚æœæ˜¯æ­£ç¡®çš„ç¼“å†²åŒºé‚£å°±å¾ˆç®€å•äº†</p><p><strong>-= - å·è¿ç®—ç¬¦é‡è½½</strong></p><p>ç”¨çš„æ˜¯+=å’Œ+å·çš„é‡è½½</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230420193316669.png" alt="image-20230420193316669"></p><p><strong>GCC 4.9:</strong> ä¾æ‰˜ç­”è¾©</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230420193754702.png" alt="image-20230420193754702"></p><h4 id="queue-2"><a href="#queue-2" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#queue-2"></a> queue</h4><p><strong>å†…éƒ¨å­˜äº†ä¸€ä¸ª deque å®¹å™¨ï¼ŒäºŒè€…å½¢æˆäº†å¤åˆ composition å…³ç³»</strong></p><p>queueå†…éƒ¨çš„å‡½æ•°ï¼Œdequeèƒ½å®Œå…¨æ»¡è¶³å®ƒï¼Œæ‰€ä»¥è°ƒç”¨ deque çš„æˆå‘˜å‡½æ•°å°±å¯ä»¥äº†!!!</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230421103130501.png" alt="image-20230421103130501"></p><p><strong>queueå’Œstackï¼Œå…³äºå…¶iteratorå’Œåº•å±‚å®¹å™¨</strong></p><p><strong>stackå’Œqueueä¸å…è®¸éå†ï¼Œä¹Ÿä¸æä¾›iterator!!!</strong></p><p>å› ä¸ºä»–ä»¬çš„æ¨¡å¼æ˜¯å…ˆè¿›åå‡ºå’Œå…ˆè¿›å…ˆå‡ºï¼Œè¿™æ ·çš„æ¨¡å¼ä¸å…è®¸èƒ½è®¿é—®åˆ°ä»»æ„ä½ç½®çš„å…ƒç´ </p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230421104600566.png" alt="image-20230421104600566"></p><p><strong>å…³äºstackå’Œqueueçš„å†…éƒ¨æ”¯æ’‘å®¹å™¨ï¼Œä¸Šé¢è®²çš„æ˜¯dequeï¼Œå…¶å®ä¹Ÿå¯ä»¥ç”¨list</strong></p><p>é»˜è®¤æä¾›çš„æ˜¯dequeï¼Œè¿™ä¸ªæ•ˆç‡æ¯”è¾ƒå¿«ä¸€ç‚¹</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230421104609426.png" alt="image-20230421104609426"></p><p><strong>stackå¯ä»¥ç”¨vectoråšåº•éƒ¨æ”¯æ’‘ï¼›queueä¸å¯ä»¥ç”¨vector!!!</strong></p><p>å› ä¸ºvectoræ²¡æœ‰ pop_front() å‡½æ•°!!!</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230421104723249.png" alt="image-20230421104723249"></p><p><strong>å…³äºå…¶ä»–çš„åº•éƒ¨å®¹å™¨æ”¯æ’‘ï¼Œstackå’Œqueueéƒ½ä¸å¯ä»¥é€‰ç”¨setæˆ–è€…mapåšåº•éƒ¨å®¹å™¨æ”¯æ’‘ï¼Œå› ä¸ºä»–ä»¬ä¸¤ä¸ªä¹Ÿæ²¡æœ‰ç›¸åº”çš„å‡½æ•°æä¾›!!!</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230421105352734.png" alt="image-20230421105352734"></p><p>å…³äºè¿™äº›åº•éƒ¨å®¹å™¨æ”¯æ’‘ï¼Œå¦‚æœä½ æ²¡æœ‰è°ƒç”¨å®ƒä¸å­˜åœ¨çš„å‡½æ•°ï¼Œé‚£å…¶å®è°ƒç”¨è¿˜æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯æ€»ä½“æ¥çœ‹æ˜¯ä¸è¡Œçš„!!!</p><h3 id="è‡ªå·±æ‰‹å†™äº†ä¸€ä¸ªç®€å•çš„äºŒå‰æ ‘åˆ›å»ºäºŒå‰æ ‘å‡½æ•°ä¸ä¼š"><a href="#è‡ªå·±æ‰‹å†™äº†ä¸€ä¸ªç®€å•çš„äºŒå‰æ ‘åˆ›å»ºäºŒå‰æ ‘å‡½æ•°ä¸ä¼š" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è‡ªå·±æ‰‹å†™äº†ä¸€ä¸ªç®€å•çš„äºŒå‰æ ‘åˆ›å»ºäºŒå‰æ ‘å‡½æ•°ä¸ä¼š"></a> è‡ªå·±æ‰‹å†™äº†ä¸€ä¸ªç®€å•çš„äºŒå‰æ ‘(åˆ›å»ºäºŒå‰æ ‘å‡½æ•°ä¸ä¼š)</h3><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//TreeNode.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __TREENODE__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __TREENODE__</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Left_Right</span></span><br><span class="line">&#123;</span><br><span class="line">    Left,</span><br><span class="line">    Right</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ç»“ç‚¹ç±»</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Type</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TreeNode</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">typedef</span> Type __ValueType;</span><br><span class="line">    <span class="keyword">typedef</span> TreeNode&lt;__ValueType&gt; __NodeType;</span><br><span class="line">    <span class="keyword">typedef</span> __NodeType *__pointer;</span><br><span class="line"></span><br><span class="line">    __ValueType val;</span><br><span class="line">    __pointer left;</span><br><span class="line">    __pointer right;</span><br><span class="line"></span><br><span class="line">    <span class="type">void</span> __init__();</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(__ValueType val, <span class="type">bool</span> is_left = Left)</span></span>; <span class="comment">// 1ä¸ºå·¦ 0ä¸ºå³ é»˜è®¤ä¸ºåšå·¦</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">PreOrder</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">InOrder</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">PostOrder</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">visit</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è™½ç„¶ä¸ç»™èŠ‚ç‚¹å†™æ„é€ å‡½æ•°ä½†æ˜¯å†™ä¸€ä¸ªåˆå§‹åŒ–æ²¡é—®é¢˜çš„</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Type</span>&gt;</span><br><span class="line"><span class="keyword">inline</span> <span class="type">void</span> TreeNode&lt;Type&gt;::__init__()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;left = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">this</span>-&gt;right = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ’å…¥å­æ ‘</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Type</span>&gt;</span><br><span class="line"><span class="keyword">inline</span> <span class="type">void</span> TreeNode&lt;Type&gt;::<span class="built_in">insert</span>(__ValueType val, <span class="type">bool</span> is_left)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (is_left == Left)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;left)</span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;leftnode has already be used.&quot;</span> &lt;&lt; endl;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        __pointer newNode = <span class="keyword">new</span> TreeNode&lt;__ValueType&gt;;</span><br><span class="line">        newNode-&gt;__init__();</span><br><span class="line">        newNode-&gt;val = val;</span><br><span class="line">        <span class="keyword">this</span>-&gt;left = newNode;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;right)</span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;rightnode has already be used.&quot;</span> &lt;&lt; endl;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        __pointer newNode = <span class="keyword">new</span> TreeNode&lt;__ValueType&gt;;</span><br><span class="line">        newNode-&gt;__init__();</span><br><span class="line">        newNode-&gt;val = val;</span><br><span class="line">        <span class="keyword">this</span>-&gt;right = newNode;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// visit</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Type</span>&gt;</span><br><span class="line"><span class="keyword">inline</span> <span class="type">void</span> TreeNode&lt;Type&gt;::<span class="built_in">visit</span>()</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; <span class="keyword">this</span>-&gt;val &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Type</span>&gt;</span><br><span class="line"><span class="keyword">inline</span> <span class="type">void</span> TreeNode&lt;Type&gt;::<span class="built_in">PreOrder</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">visit</span>();</span><br><span class="line">    left-&gt;<span class="built_in">PreOrder</span>();</span><br><span class="line">    right-&gt;<span class="built_in">PreOrder</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Type</span>&gt;</span><br><span class="line"><span class="keyword">inline</span> <span class="type">void</span> TreeNode&lt;Type&gt;::<span class="built_in">InOrder</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    left-&gt;<span class="built_in">InOrder</span>();</span><br><span class="line">    <span class="built_in">visit</span>();</span><br><span class="line">    right-&gt;<span class="built_in">InOrder</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Type</span>&gt;</span><br><span class="line"><span class="keyword">inline</span> <span class="type">void</span> TreeNode&lt;Type&gt;::<span class="built_in">PostOrder</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    left-&gt;<span class="built_in">PostOrder</span>();</span><br><span class="line">    right-&gt;<span class="built_in">PostOrder</span>();</span><br><span class="line">    <span class="built_in">visit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></div></figure><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//BinaryTree.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __BINARTTREE__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __BINARTTREE__</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;TreeNode.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Order</span></span><br><span class="line">&#123;</span><br><span class="line">    pre,</span><br><span class="line">    in,</span><br><span class="line">    post</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†™ä¸€ä¸ªå…¨å±€å‡½æ•°æ¥åˆ é™¤äºŒå‰æ ‘</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Type&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">deleteNodes</span><span class="params">(TreeNode&lt;Type&gt; *node)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (node-&gt;left)</span><br><span class="line">        <span class="built_in">deleteNodes</span>(node-&gt;left);</span><br><span class="line">    <span class="keyword">if</span> (node-&gt;right)</span><br><span class="line">        <span class="built_in">deleteNodes</span>(node-&gt;right);</span><br><span class="line">    <span class="keyword">delete</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰æ•´é¢—äºŒå‰æ ‘ç±»</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Type</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BinaryTree</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">typedef</span> Type __ValueType;</span><br><span class="line">    <span class="keyword">typedef</span> TreeNode&lt;__ValueType&gt; __NodeType;</span><br><span class="line">    <span class="keyword">typedef</span> __NodeType &amp;__reference;</span><br><span class="line">    <span class="keyword">typedef</span> __NodeType *__pointer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// BinaryTree();</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">BinaryTree</span><span class="params">(__ValueType val = <span class="literal">NULL</span>)</span></span>; <span class="comment">// ä¸ç»™é»˜è®¤å€¼å°±æ˜¯NULL</span></span><br><span class="line">    ~<span class="built_in">BinaryTree</span>() &#123; <span class="built_in">deleteTree</span>(); &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">deleteTree</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">printTree</span><span class="params">(Order ord)</span></span>;</span><br><span class="line">    <span class="function">__reference <span class="title">getroot</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> *root; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    __pointer root;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Type</span>&gt;</span><br><span class="line"><span class="keyword">inline</span> BinaryTree&lt;Type&gt;::<span class="built_in">BinaryTree</span>(__ValueType val)</span><br><span class="line">&#123;</span><br><span class="line">    root = <span class="keyword">new</span> TreeNode&lt;Type&gt;;</span><br><span class="line">    root-&gt;val = val;</span><br><span class="line">    root-&gt;left = <span class="literal">nullptr</span>;</span><br><span class="line">    root-&gt;right = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•´æ£µæ ‘çš„ææ„å‡½æ•°</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Type</span>&gt;</span><br><span class="line"><span class="keyword">inline</span> <span class="type">void</span> BinaryTree&lt;Type&gt;::<span class="built_in">deleteTree</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">deleteNodes</span>(root);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‰åºéå†</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Type</span>&gt;</span><br><span class="line"><span class="keyword">inline</span> <span class="type">void</span> BinaryTree&lt;Type&gt;::<span class="built_in">printTree</span>(Order ord)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">switch</span> (ord)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> pre:</span><br><span class="line">        root-&gt;<span class="built_in">PreOrder</span>();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> in:</span><br><span class="line">        root-&gt;<span class="built_in">InOrder</span>();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> post:</span><br><span class="line">        root-&gt;<span class="built_in">PostOrder</span>();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></div></figure><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;BinaryTree.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">       1</span></span><br><span class="line"><span class="comment">   3         2</span></span><br><span class="line"><span class="comment">4    6    8</span></span><br><span class="line"><span class="comment">    7        0</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">namespace</span> test</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">BinaryTree&lt;<span class="type">int</span>&gt; <span class="title">sample</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="function">BinaryTree&lt;<span class="type">int</span>&gt; <span class="title">tree</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">        tree.<span class="built_in">getroot</span>().<span class="built_in">insert</span>(<span class="number">3</span>, Left);</span><br><span class="line">        <span class="comment">// left</span></span><br><span class="line">        <span class="keyword">auto</span> leftNode = tree.<span class="built_in">getroot</span>().left;</span><br><span class="line">        leftNode-&gt;<span class="built_in">insert</span>(<span class="number">4</span>, Left);</span><br><span class="line">        leftNode-&gt;<span class="built_in">insert</span>(<span class="number">6</span>, Right);</span><br><span class="line">        <span class="keyword">auto</span> leftNode2 = leftNode-&gt;right;</span><br><span class="line">        leftNode2-&gt;<span class="built_in">insert</span>(<span class="number">7</span>, Left);</span><br><span class="line">        <span class="comment">// right</span></span><br><span class="line">        tree.<span class="built_in">getroot</span>().<span class="built_in">insert</span>(<span class="number">2</span>, Right);</span><br><span class="line">        <span class="keyword">auto</span> rightNode = tree.<span class="built_in">getroot</span>().right;</span><br><span class="line">        rightNode-&gt;<span class="built_in">insert</span>(<span class="number">8</span>, Left);</span><br><span class="line">        <span class="keyword">auto</span> rightNode2 = rightNode-&gt;left;</span><br><span class="line">        rightNode2-&gt;<span class="built_in">insert</span>(<span class="number">0</span>, Right);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> tree;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> tree = test::<span class="built_in">sample</span>();</span><br><span class="line"></span><br><span class="line">    tree.<span class="built_in">printTree</span>(pre); <span class="comment">// 1 3 4 6 7 2 8 0</span></span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">    tree.<span class="built_in">printTree</span>(in); <span class="comment">// 4 3 7 6 1 8 0 2</span></span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">    tree.<span class="built_in">printTree</span>(post); <span class="comment">// 4 7 6 3 0 8 2 1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="rb_tree-çº¢é»‘æ ‘"><a href="#rb_tree-çº¢é»‘æ ‘" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#rb_tree-çº¢é»‘æ ‘"></a> rb_Tree çº¢é»‘æ ‘</h3><p>çº¢é»‘æ ‘æ˜¯ä¸€ç§é«˜åº¦å¹³è¡¡çš„äºŒå‰æœå¯»æ ‘ï¼›ç”±äºå®ƒä¿æŒå°½é‡çš„å¹³è¡¡ï¼Œéå¸¸æœ‰åˆ©äºsearchå’Œinsertçš„æ“ä½œï¼Œå¹¶ä¸”åœ¨æ”¹å˜äº†å…ƒç´ çš„æ“ä½œä¹‹åä¼šç»§ç»­ä¿æŒæ ‘çŠ¶æ€çš„å¹³è¡¡</p><h4 id="çº¢é»‘æ ‘-rb_tree-ä¸äºŒå‰å¹³è¡¡æ ‘-avl-çš„å¯¹æ¯”"><a href="#çº¢é»‘æ ‘-rb_tree-ä¸äºŒå‰å¹³è¡¡æ ‘-avl-çš„å¯¹æ¯”" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#çº¢é»‘æ ‘-rb_tree-ä¸äºŒå‰å¹³è¡¡æ ‘-avl-çš„å¯¹æ¯”"></a> çº¢é»‘æ ‘ rb_Tree ä¸äºŒå‰å¹³è¡¡æ ‘ AVL çš„å¯¹æ¯”ï¼š</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230421175541816.png" alt="image-20230421175541816"></p><p><strong>ä¸ºä»€ä¹ˆè¦æœ‰çº¢é»‘æ ‘ï¼Ÿ</strong></p><p>å¤§å¤šæ•°äºŒå‰æ’åºæ ‘ BST çš„æ“ä½œï¼ˆæŸ¥æ‰¾ã€æœ€å¤§å€¼ã€æœ€å°å€¼ã€æ’å…¥ã€åˆ é™¤ç­‰ç­‰ï¼‰éƒ½æ˜¯ O(h)O(h)O(h) çš„æ—¶é—´å¤æ‚åº¦ï¼Œh ä¸ºæ ‘çš„é«˜åº¦ã€‚ä½†æ˜¯å¯¹äºæ–œæ ‘è€Œè¨€ï¼ˆBSTæç«¯æƒ…å†µä¸‹å‡ºç°ï¼‰ï¼ŒBSTçš„è¿™äº›æ“ä½œçš„æ—¶é—´å¤æ‚åº¦å°†è¾¾åˆ° O(n) ã€‚ä¸ºäº†ä¿è¯BSTçš„æ‰€æœ‰æ“ä½œçš„æ—¶é—´å¤æ‚åº¦çš„ä¸Šé™ä¸º O(logn)ï¼Œå°±è¦æƒ³åŠæ³•æŠŠä¸€é¢—<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=BST%E6%A0%91&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A1246106121%7D">BSTæ ‘</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>çš„é«˜åº¦ä¸€ç›´ç»´æŒåœ¨lognï¼Œè€Œçº¢é»‘æ ‘å°±åšåˆ°äº†è¿™ä¸€ç‚¹ï¼Œçº¢é»‘æ ‘çš„é«˜åº¦å§‹ç»ˆéƒ½ç»´æŒåœ¨lognï¼Œn ä¸ºæ ‘ä¸­çš„é¡¶ç‚¹æ•°ç›®ã€‚</p><p>rb_Treeå’ŒAVLç›¸æ¯”ï¼Œè™½ç„¶AVLæ›´åŠ å¹³è¡¡ï¼Œä½†æ˜¯æ¡ä»¶æ›´åŠ è‹›åˆ»ï¼Œ<strong>çº¢é»‘æ ‘è¿½æ±‚çš„æ˜¯å¤§è‡´å¹³è¡¡ã€‚</strong> AVL æ ‘æ¯”çº¢é»‘æ ‘æ›´åŠ å¹³è¡¡ï¼Œä½†AVLæ ‘åœ¨æ’å…¥å’Œåˆ é™¤çš„æ—¶å€™ä¹Ÿä¼šå­˜åœ¨å¤§é‡çš„æ—‹è½¬æ“ä½œã€‚<strong>æ‰€ä»¥æ¶‰åŠåˆ°é¢‘ç¹çš„æ’å…¥å’Œåˆ é™¤æ“ä½œï¼Œåˆ‡è®°æ”¾å¼ƒAVLæ ‘ï¼Œé€‰æ‹©æ€§èƒ½æ›´å¥½çš„çº¢é»‘æ ‘ï¼›å½“ç„¶ï¼Œå¦‚æœä½ çš„åº”ç”¨ä¸­æ¶‰åŠçš„æ’å…¥å’Œåˆ é™¤æ“ä½œå¹¶ä¸é¢‘ç¹ï¼Œè€Œæ˜¯æŸ¥æ‰¾æ“ä½œç›¸å¯¹æ›´é¢‘ç¹ï¼Œé‚£ä¹ˆå°±ä¼˜å…ˆé€‰æ‹© AVL æ ‘è¿›è¡Œå®ç°</strong></p><p>çº¢é»‘æ ‘<strong>æä¾›éå†æ“ä½œä»¥åŠè¿­ä»£å™¨iterator</strong>ï¼Œä½†æ˜¯è¿™ä¸ªè¿­ä»£å™¨æ˜¯<strong>åªè¯»è¿­ä»£å™¨</strong>ï¼Œå› ä¸º<strong>ä¸èƒ½ä¿®æ”¹èŠ‚ç‚¹ä¸Šå…ƒç´ çš„å€¼</strong>ï¼Œå¦‚æœä¿®æ”¹äº†å…ƒç´ çš„å€¼ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´å¤§å°å…³ç³»å‘ç”Ÿå˜åŒ–ï¼Œæ•´ä¸ªçº¢é»‘æ ‘çš„å¹³è¡¡æ€§å°±å‘ç”Ÿå˜åŒ–äº†</p><p>å›¾ä¸­ç¬¬ä¸‰æ®µï¼ŒæŒ‰ç†æ¥è¯´çº¢é»‘æ ‘çš„å…ƒç´ æ˜¯ä¸èƒ½é€šè¿‡è¿­ä»£å™¨ä¿®æ”¹å…ƒç´ å€¼çš„ï¼Œä½†æ˜¯è¿™ä¸ªçº¢é»‘æ ‘åé¢æ˜¯ç”¨äºsetå’Œmapå®¹å™¨çš„ï¼Œsetçš„keyå’Œvalueç›¸ç­‰ä¸èƒ½ä¿®æ”¹ï¼›ä½†æ˜¯mapçš„keyå’Œvalueæ²¡æœ‰å¿…ç„¶è”ç³»ï¼Œæ’åºå’ŒæŸ¥æ‰¾éƒ½æ˜¯åŸºäºkeyæ¥è¿›è¡Œçš„ï¼Œvalueå¯ä»¥ä»»æ„ä¿®æ”¹ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡è¿­ä»£å™¨ä¿®æ”¹valueï¼Œè¿™ä¹ˆåšåšæ˜¯æ­£ç¡®çš„</p><p>çº¢é»‘æ ‘çš„è®¾è®¡å½“ä¸­å­˜åœ¨ä¸¤ç§è®¾è®¡ <strong>insert_unique() å’Œ insert_equal()</strong> ï¼Œè¡¨ç¤ºkeyå¯ä»¥é‡å¤æˆ–è€…ä¸é‡å¤ï¼Œè¿™æ ·å°±å¯ä»¥å¼•ç”³å‡º setå’Œ multisetï¼Œmalå’Œ multimap</p><h4 id="æ ‡å‡†åº“å¯¹çº¢é»‘æ ‘çš„å®ç°"><a href="#æ ‡å‡†åº“å¯¹çº¢é»‘æ ‘çš„å®ç°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ ‡å‡†åº“å¯¹çº¢é»‘æ ‘çš„å®ç°"></a> æ ‡å‡†åº“å¯¹çº¢é»‘æ ‘çš„å®ç°:</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230421182526116.png" alt="image-20230421182526116"></p><p><strong>è¿™é‡Œæ ‡å‡†åº“é‡Œé¢çš„valueä¸æ˜¯æŒ‡æˆ‘ä»¬ç†è§£çš„valueå€¼ï¼Œè¿™é‡Œçš„valueæ˜¯keyå’Œdataåˆèµ·æ¥å«åšvalueï¼Œä¹Ÿå°±æ˜¯ä¸€æ•´ä¸ªèŠ‚ç‚¹çš„ç±»å‹ï¼›ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è¯´æˆ‘ä»¬æ€ä¹ˆæ ·ä»è¿™ä¸ªèŠ‚ç‚¹valueå½“ä¸­æŠŠé‡è¦çš„keyæ‹¿å‡ºæ¥!!!ç¬¬å››ä¸ªå‚æ•°æ˜¯è¯´å¦‚ä½•æ ¹æ®keyæ¥è¿›è¡Œæ¯”è¾ƒï¼Œå› ä¸ºåç»­è¦è¿›è¡Œæ’åºæ“ä½œ!!!</strong></p><p>åœ¨rb_treeç±»å½“ä¸­ï¼Œå®ƒçš„è®¾è®¡å’Œæˆ‘çš„è®¾è®¡å·®ä¸å¤šï¼Œéƒ½æ˜¯æŠŠæ ‘å’ŒèŠ‚ç‚¹åˆ†å¼€çš„æ¥è®¾è®¡ï¼Œæ‰€ä»¥åœ¨æ ‘rb_treeå½“ä¸­åªç”¨äº†ä¸‰ä¸ªå‚æ•°æ¥å‘å¤–è¡¨ç°</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">size_type node_count;<span class="comment">//èŠ‚ç‚¹çš„æ•°é‡</span></span><br><span class="line">link_type header;<span class="comment">//å¤´èŠ‚ç‚¹(ç±»å‹æ˜¯æŒ‡é’ˆ)</span></span><br><span class="line">Compare key_compare;<span class="comment">//æ¯”è¾ƒkeyçš„å‡½æ•°æŒ‡é’ˆæˆ–è€…ä»¿å‡½æ•°</span></span><br></pre></td></tr></table></div></figure><p><strong>åœ¨çº¢é»‘æ ‘çš„ç»“æ„é‡Œæœ‰ä¸€ä¸ª header èŠ‚ç‚¹ï¼Œä»–çš„å…ƒç´ å€¼ä¸ºç©ºï¼Œè·Ÿlistçš„è®¾è®¡ä¸€æ ·ï¼Œå‰é—­åå¼€çš„åŒºé—´!!!</strong></p><p>è¿™æ ·çš„è®¾è®¡ä¼šä½¿åé¢çš„å®ç°æ–¹ä¾¿å¾ˆå¤š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230421182650170.png" alt="image-20230421182650170"></p><p>è™½ç„¶çº¢é»‘æ ‘ä¸æ¨èç›´æ¥ä½¿ç”¨ï¼Œå› ä¸ºæ›´å¥½çš„åšæ³•æ˜¯ä½¿ç”¨ä¸Šå±‚å®¹å™¨ï¼›ä½†æ˜¯å¯ä»¥ç®€å•çš„ä½¿ç”¨ä¸€ä¸‹æ¥æµ‹è¯•æˆ‘ä»¬å¯¹å…¶çš„ç†è§£</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rb_tree&lt;<span class="type">int</span>,<span class="type">int</span>,identity&lt;<span class="type">int</span>&gt;,less&lt;<span class="type">int</span>&gt;,alloc&gt;;</span><br><span class="line"><span class="comment">//keyå’Œvalueç±»å‹ç›¸åŒï¼Œè¯´æ˜keyå’Œdataæ˜¯ä¸€ä¸ªä¸œè¥¿(å¦åˆ™è¿”å›çš„valueä¸å¯ èƒ½æ˜¯intç±»å‹è€Œåº”è¯¥æ˜¯ä¸ªç±»)ï¼Œè¿™æ ·çš„è¯ä»valueä¸­å–å‡ºkeyå°±å¯ä»¥ä½¿ç”¨å†™å¥½çš„identityå‡½æ•°å¯¹è±¡ï¼Œå³ä½ ä¼ ä»€ä¹ˆç»™æˆ‘æˆ‘å°±ç»™ä½ è¿”å›ä»€ä¹ˆ</span></span><br></pre></td></tr></table></div></figure><p>ä½¿ç”¨çº¢é»‘æ ‘çš„æµ‹è¯•ç¨‹åº:(æ–°ç‰ˆæœ¬çš„åç§°æœ‰äº›å˜åŒ–)</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stl_tree.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    _Rb_tree&lt;<span class="type">int</span>, <span class="type">int</span>, _Identity&lt;<span class="type">int</span>&gt;, less&lt;<span class="type">int</span>&gt;, allocator&lt;<span class="type">int</span>&gt;&gt; rbtree;</span><br><span class="line">    cout &lt;&lt; rbtree.<span class="built_in">size</span>() &lt;&lt; endl;  <span class="comment">// 0</span></span><br><span class="line">    cout &lt;&lt; <span class="built_in">sizeof</span>(rbtree) &lt;&lt; endl; <span class="comment">// 48 è·Ÿæ’ä¸æ’å…ƒç´ æ²¡å…³ç³»ï¼Œå› ä¸ºé‡Œé¢å­˜çš„æ˜¯èŠ‚ç‚¹æŒ‡é’ˆd</span></span><br><span class="line">    cout &lt;&lt; rbtree.<span class="built_in">empty</span>() &lt;&lt; endl; <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">    rbtree._M_insert_unique(<span class="number">3</span>);</span><br><span class="line">    rbtree._M_insert_unique(<span class="number">8</span>);</span><br><span class="line">    rbtree._M_insert_unique(<span class="number">5</span>);</span><br><span class="line">    rbtree._M_insert_unique(<span class="number">9</span>);</span><br><span class="line">    rbtree._M_insert_unique(<span class="number">13</span>);</span><br><span class="line">    rbtree._M_insert_unique(<span class="number">3</span>);      <span class="comment">// unique æ‰€ä»¥3æ’ä¸è¿›å»</span></span><br><span class="line">    cout &lt;&lt; rbtree.<span class="built_in">size</span>() &lt;&lt; endl;   <span class="comment">// 5</span></span><br><span class="line">    cout &lt;&lt; rbtree.<span class="built_in">empty</span>() &lt;&lt; endl;  <span class="comment">// 0</span></span><br><span class="line">    cout &lt;&lt; rbtree.<span class="built_in">count</span>(<span class="number">3</span>) &lt;&lt; endl; <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">    rbtree._M_insert_equal(<span class="number">3</span>); <span class="comment">// equal æ‰€ä»¥3èƒ½æ’è¿›å»</span></span><br><span class="line">    rbtree._M_insert_equal(<span class="number">3</span>);</span><br><span class="line">    cout &lt;&lt; rbtree.<span class="built_in">size</span>() &lt;&lt; endl;   <span class="comment">// 7</span></span><br><span class="line">    cout &lt;&lt; rbtree.<span class="built_in">empty</span>() &lt;&lt; endl;  <span class="comment">// 0</span></span><br><span class="line">    cout &lt;&lt; rbtree.<span class="built_in">count</span>(<span class="number">3</span>) &lt;&lt; endl; <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="åŸºäºçº¢é»‘æ ‘çš„setå’Œmap"><a href="#åŸºäºçº¢é»‘æ ‘çš„setå’Œmap" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#åŸºäºçº¢é»‘æ ‘çš„setå’Œmap"></a> åŸºäºçº¢é»‘æ ‘çš„setå’Œmap</h3><h4 id="setmultiset"><a href="#setmultiset" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#setmultiset"></a> set/multiset</h4><p>ç”±äºset/multisetçš„keyå’Œvalueç›¸åŒï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•é€šè¿‡è¿­ä»£å™¨ä¿®æ”¹å…ƒç´ çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ä¿®æ”¹keyï¼Œerror</p><p>setæ’å…¥å…ƒç´ ä½¿ç”¨ insert_unique()ï¼›multisetå¯ä»¥é‡å¤ï¼Œä½¿ç”¨ insert_equal()</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230421192116968.png" alt="image-20230421192116968"></p><p>æ³¨æ„ä¸èƒ½ä¿®æ”¹è¿­ä»£å™¨çš„å€¼ï¼Œconst_iteratorï¼Œä»¥ä¸‹æ˜¯ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; v&#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">9</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> &amp;val : v)</span><br><span class="line">        ++val;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> &amp;val : v)</span><br><span class="line">        cout &lt;&lt; val &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¼šè‡ªåŠ¨æ’åº</span></span><br><span class="line">    set&lt;<span class="type">int</span>, less&lt;<span class="type">int</span>&gt;&gt; s&#123;<span class="number">3</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">9</span>&#125;;</span><br><span class="line">    <span class="comment">// for (int &amp;val : s) // è¿™é‡Œå°±ä¼šæŠ¥é”™,å› ä¸ºè¿™ä¸ªçš„è¿­ä»£å™¨æ˜¯ä¸å¯ä»¥æ›´æ”¹å€¼çš„</span></span><br><span class="line">    <span class="comment">//     ++val;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> val : s)</span><br><span class="line">        cout &lt;&lt; val &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h4 id="mapmultimap"><a href="#mapmultimap" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#mapmultimap"></a> map/multimap</h4><p><strong>mapæ²¡æœ‰åŠæ³•é€šè¿‡è¿­ä»£å™¨ä¿®æ”¹keyçš„å€¼ï¼Œä½†æ˜¯å¯ä»¥ç”¨è¿‡è¿­ä»£å™¨ä¿®æ”¹valueçš„å€¼!!!</strong></p><p>mapæ’å…¥å…ƒç´ ä½¿ç”¨ insert_unique()ï¼›multimap å¯ä»¥é‡å¤ï¼Œä½¿ç”¨ insert_equal()</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230421194843419.png" alt="image-20230421194843419"></p><p><strong>key_typeå’Œdata_typeè¢«åŒ…è£…æˆä¸ºä¸€ä¸ªpair&lt;const Key,T&gt;ï¼›æ³¨æ„è¿™é‡Œconstä¿®é¥°ä»£è¡¨keyæ— æ³•ä¿®æ”¹ï¼Œç„¶åvalue_typeæ˜¯çœŸæ­£çš„å­˜æ”¾ç±»å‹ï¼Œç„¶åselect1stä»£è¡¨æ‹¿å–pairé‡Œé¢çš„ç¬¬ä¸€ä¸ªå…ƒç´ !!!</strong></p><p>ä½¿ç”¨çº¢é»‘æ ‘æµ‹è¯•mapï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stl_tree.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æºä»£ç è¿™ä¹ˆå†™çš„ï¼Œæˆ‘æ²¡çœ‹æ‡‚</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SelectFirst</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Pair</span>&gt;</span><br><span class="line">    <span class="function"><span class="keyword">typename</span> Pair::first_type &amp;</span></span><br><span class="line"><span class="function">    <span class="title">operator</span><span class="params">()</span><span class="params">(Pair &amp;x)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x.first;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// typename T::first_type &amp;</span></span><br><span class="line">    <span class="comment">// operator()(T &amp;x) const</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//     return x.first;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">int</span> Key_Type;</span><br><span class="line">    <span class="keyword">typedef</span> pair&lt;<span class="type">const</span> <span class="type">int</span>, <span class="type">char</span>&gt; Value_Type;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// _Rb_tree&lt;Key_Type, Value_Type, _Select1st&lt;Value_Type&gt;, less&lt;int&gt;&gt; rbtree;</span></span><br><span class="line">    _Rb_tree&lt;Key_Type, Value_Type, SelectFirst&lt;Value_Type&gt;, less&lt;<span class="type">int</span>&gt;&gt; rbtree; <span class="comment">// error</span></span><br><span class="line">    <span class="comment">// select1stæ€ä¹ˆå†™ä¸çŸ¥é“</span></span><br><span class="line">    cout &lt;&lt; rbtree.<span class="built_in">size</span>() &lt;&lt; endl;  <span class="comment">// 0</span></span><br><span class="line">    cout &lt;&lt; <span class="built_in">sizeof</span>(rbtree) &lt;&lt; endl; <span class="comment">// 48 è·Ÿæ’ä¸æ’å…ƒç´ æ²¡å…³ç³»ï¼Œå› ä¸ºé‡Œé¢å­˜çš„æ˜¯èŠ‚ç‚¹æŒ‡é’ˆd</span></span><br><span class="line">    cout &lt;&lt; rbtree.<span class="built_in">empty</span>() &lt;&lt; endl; <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">    rbtree._M_insert_unique(<span class="built_in">make_pair</span>(<span class="number">3</span>, <span class="string">&#x27;a&#x27;</span>));</span><br><span class="line">    rbtree._M_insert_unique(<span class="built_in">make_pair</span>(<span class="number">8</span>, <span class="string">&#x27;b&#x27;</span>));</span><br><span class="line">    rbtree._M_insert_unique(<span class="built_in">make_pair</span>(<span class="number">5</span>, <span class="string">&#x27;c&#x27;</span>));</span><br><span class="line">    rbtree._M_insert_unique(<span class="built_in">make_pair</span>(<span class="number">9</span>, <span class="string">&#x27;d&#x27;</span>));</span><br><span class="line">    rbtree._M_insert_unique(<span class="built_in">make_pair</span>(<span class="number">13</span>, <span class="string">&#x27;e&#x27;</span>));</span><br><span class="line">    rbtree._M_insert_unique(<span class="built_in">make_pair</span>(<span class="number">3</span>, <span class="string">&#x27;f&#x27;</span>)); <span class="comment">// unique æ‰€ä»¥3æ’ä¸è¿›å»</span></span><br><span class="line">    cout &lt;&lt; rbtree.<span class="built_in">size</span>() &lt;&lt; endl;              <span class="comment">// 5</span></span><br><span class="line">    cout &lt;&lt; rbtree.<span class="built_in">empty</span>() &lt;&lt; endl;             <span class="comment">// 0</span></span><br><span class="line">    cout &lt;&lt; rbtree.<span class="built_in">count</span>(<span class="number">3</span>) &lt;&lt; endl;            <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">    rbtree._M_insert_equal(<span class="built_in">make_pair</span>(<span class="number">3</span>, <span class="string">&#x27;a&#x27;</span>)); <span class="comment">// equal æ‰€ä»¥3èƒ½æ’è¿›å»</span></span><br><span class="line">    rbtree._M_insert_equal(<span class="built_in">make_pair</span>(<span class="number">3</span>, <span class="string">&#x27;a&#x27;</span>));</span><br><span class="line">    cout &lt;&lt; rbtree.<span class="built_in">size</span>() &lt;&lt; endl;   <span class="comment">// 7</span></span><br><span class="line">    cout &lt;&lt; rbtree.<span class="built_in">empty</span>() &lt;&lt; endl;  <span class="comment">// 0</span></span><br><span class="line">    cout &lt;&lt; rbtree.<span class="built_in">count</span>(<span class="number">3</span>) &lt;&lt; endl; <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>å…¶ä»–éƒ½æ²¡ä»€ä¹ˆï¼Œå…¶ä¸­ç¬¬ä¸‰ä¸ªæ¨¡æ¿å‚æ•°SelectFirst&lt;&gt;(æˆ‘è‡ªå·±å†™çš„)ä¸æ˜¯å¾ˆç†è§£ä¸ºä»€ä¹ˆè¿™ä¹ˆå†™</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;<span class="comment">//ä¸æ˜ç™½è¿™é‡Œä¸ºä»€ä¹ˆè¦ç”¨ä¸¤æ¬¡æ¨¡æ¿å¹¶ä¸”ç¬¬ä¸€æ¬¡çš„æ¨¡æ¿å‚æ•°æ²¡å•¥ç”¨</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SelectFirst</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Pair</span>&gt;</span><br><span class="line">    <span class="function"><span class="keyword">typename</span> Pair::first_type &amp;</span></span><br><span class="line"><span class="function">    <span class="title">operator</span><span class="params">()</span><span class="params">(Pair &amp;x)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x.first;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><p>ä½¿ç”¨mapçš„ç¤ºä¾‹ä»£ç :</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯key(ä¸å¯ä¿®æ”¹,æ‰€ä»¥è¿›å»åçº¢é»‘æ ‘ä¼šè‡ªåŠ¨è½¬ä¸ºconstç±»å‹),ç¬¬äºŒä¸ªå‚æ•°æ˜¯data</span></span><br><span class="line">    <span class="comment">//å…ƒç´ ä¼šæŒ‰ç…§keyè‡ªåŠ¨æ’åº!!!</span></span><br><span class="line">    map&lt;<span class="type">int</span>, <span class="type">char</span>, less&lt;<span class="type">int</span>&gt;&gt; m&#123;<span class="built_in">make_pair</span>(<span class="number">9</span>, <span class="string">&#x27;a&#x27;</span>),</span><br><span class="line">                                <span class="built_in">make_pair</span>(<span class="number">5</span>, <span class="string">&#x27;b&#x27;</span>),</span><br><span class="line">                                <span class="built_in">make_pair</span>(<span class="number">6</span>, <span class="string">&#x27;c&#x27;</span>),</span><br><span class="line">                                <span class="built_in">make_pair</span>(<span class="number">4</span>, <span class="string">&#x27;d&#x27;</span>),</span><br><span class="line">                                <span class="built_in">make_pair</span>(<span class="number">8</span>, <span class="string">&#x27;c&#x27;</span>),</span><br><span class="line">                                <span class="built_in">make_pair</span>(<span class="number">9</span>, <span class="string">&#x27;b&#x27;</span>),</span><br><span class="line">                                <span class="built_in">make_pair</span>(<span class="number">6</span>, <span class="string">&#x27;d&#x27;</span>),</span><br><span class="line">                                <span class="built_in">make_pair</span>(<span class="number">1</span>, <span class="string">&#x27;a&#x27;</span>)&#125;;</span><br><span class="line">    m[<span class="number">0</span>] = <span class="string">&#x27;f&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;val : m)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//keyä¸å¯ä¿®æ”¹ï¼Œä½†æ˜¯dataå¯ä»¥ä¿®æ”¹</span></span><br><span class="line">        cout &lt;&lt; val.first &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; m[val.first] &lt;&lt; endl;<span class="comment">//ç±»ä¼¼äºpyçš„å­—å…¸</span></span><br><span class="line">        val.second++;</span><br><span class="line">        cout &lt;&lt; val.first &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; val.second &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="mapç‹¬ç‰¹çš„-operator"><a href="#mapç‹¬ç‰¹çš„-operator" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#mapç‹¬ç‰¹çš„-operator"></a> mapç‹¬ç‰¹çš„ operator [ ]!!!</h3><p><strong>ä½œç”¨ï¼šæ ¹æ®keyä¼ å›dataã€‚æ³¨æ„åªæœ‰mapæœ‰ï¼Œå› ä¸ºkeyä¸ä¸ºdataå¹¶ä¸”keyæ˜¯ç‹¬ä¸€æ— äºŒçš„!!!</strong></p><p><strong>å¦‚æœkeyä¸å­˜åœ¨çš„è¯ï¼Œå°±ä¼šåˆ›å»ºè¿™ä¸ªkeyå¹¶ä¸”dataä½¿ç”¨é»˜è®¤å€¼!!!</strong>(å’Œpyçš„å­—å…¸å·®ä¸å¤š)</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230422140640649.png" alt="image-20230422140640649"></p><p>ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾åœ¨æœ‰åºçš„keyå½“ä¸­æŸ¥æ‰¾ç›®æ ‡keyï¼Œå¦‚æœæ‰¾ä¸åˆ°çš„è¯å°±è¿›è¡Œinsertæ“ä½œåˆ›å»ºä¸€ä¸ªæ–°çš„keyï¼ï¼ï¼</p><h3 id="hashtable-æ•£åˆ—è¡¨"><a href="#hashtable-æ•£åˆ—è¡¨" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#hashtable-æ•£åˆ—è¡¨"></a> hashtable æ•£åˆ—è¡¨</h3><p>å“ˆå¸Œè¡¨çš„è®¾è®¡</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230422143136762.png" alt="image-20230422143136762"></p><p><strong>åœ¨æœ‰é™çš„ç©ºé—´ä¹‹ä¸‹æ ¹æ®å“ˆå¸Œå‡½æ•°å°†å…ƒç´ (åˆ†ä¸ºkeyå’Œdata)çš„keyæ˜ å°„æˆä¸ºhashcodeæ”¾åˆ°å¯¹åº”çš„ä½ç½®ä¸‹é¢ï¼Œkeyä¸‹é¢ç”¨ä¸€ä¸ªé“¾è¡¨å°†keyå’Œdataä¸²èµ·æ¥!!!</strong></p><p><strong>ç”±äºbucketæ•°ç»„å­˜çš„æ˜¯é“¾è¡¨æŒ‡é’ˆï¼Œè¿™ä¸ªé“¾è¡¨å¦‚æœä¸²çš„å…ƒç´ å¤ªå¤šäº†ä¹‹åé‚£ä¹ˆæœç´¢æ•ˆç‡ä¼šå¤§å¤§é™ä½ï¼Œè¿™ä¸ªçŠ¶æ€å°±æ˜¯éå®‰å…¨çŠ¶æ€ã€‚ç¨‹åºå‘˜çš„ç»éªŒå‘Šè¯‰æˆ‘ä»¬å½“æ‰€æœ‰çš„é“¾è¡¨ä¸‹é¢ä¸²çš„å…ƒç´ ä¸ªæ•°å¤§äºbucketsæ•°ç»„çš„å¤§å°çš„æ—¶å€™å°±æ¯”è¾ƒå±é™©äº†ã€‚</strong></p><p><strong>è¿™ä¸ªæ—¶å€™éœ€è¦æ‰“æ•£hashtableï¼Œå¢å¤§bucketsæ•°ç»„çš„sizeï¼Œä¸€èˆ¬æ˜¯ä¸¤å€å·¦å³ï¼Œå¹¶ä¸”æ•°ç»„çš„sizeæœ€å¥½æ˜¯è´¨æ•°ï¼Œå¹¶ä¸”å°†å…ƒç´ æŒ‰ç…§æ–°çš„hashè§„åˆ™é‡æ–°æ’å…¥é“¾è¡¨ä¸­!!!</strong></p><p>æ€»ç»“å°±æ˜¯ï¼šä¸èƒ½è®©hashtableä¸‹é¢ä¸²çš„é“¾è¡¨å¤ªé•¿ï¼Œå¤ªé•¿äº†éœ€è¦å¢åŠ bucketsçš„sizeæ¥æ‰“æ•£å“ˆå¸Œè¡¨é‡æ–°å›åˆ°å®‰å…¨çŠ¶æ€ã€‚</p><p>GCCä¸‹é¢çš„bucketsæ•°ç»„çš„sizeæ˜¯è¿™ä¹ˆç¡®å®šçš„ï¼š<strong>å¤§è‡´éƒ½æ˜¯2å€é™„è¿‘çš„è´¨æ•°</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230422144338234.png" alt="image-20230422144338234"></p><p>æ¥çœ‹çœ‹hashtableçš„å®ç°ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230422145128498.png" alt="image-20230422145128498"></p><p>Valueä»£è¡¨keyå’Œdataé›†åˆï¼Œkeyå°±æ˜¯é”®å€¼ï¼ŒHashFcnä»£è¡¨å“ˆå¸Œå‡½æ•°ï¼Œå°±æ˜¯å¦‚ä½•æŠŠkeyæ˜ å°„ä¸ºç¼–å·hashcodeï¼ŒExtractKeyä»£è¡¨å¦‚ä½•ä»valueé‡Œé¢å–å‡ºkeyï¼›EqualKeyä»£è¡¨å¦‚ä½•åˆ¤æ–­ä¸¤ä¸ªkeyç›¸åŒ!!!</p><p>è‡³äºæ˜¯å•å‘é“¾è¡¨è¿˜æ˜¯åŒå‘é“¾è¡¨ï¼Œè¿™ä¸ªå°±çœ‹ä¸åŒçš„ç‰ˆæœ¬äº†ã€‚</p><p><strong>å‚æ•°æ¨¡æ¿é‡Œé¢æœ€éš¾çš„ä¸€ç‚¹å°±æ˜¯å†³å®šhashtableçš„hashå‡½æ•°ï¼Œæ€ä¹ˆæ ·å°†hashçš„keyå€¼æ˜ å°„ä¸ºhashcode!!!</strong></p><p>å‚è€ƒç³»ç»Ÿæä¾›çš„hashæ¨¡æ¿å‡½æ•°</p><p><strong>æ³¨æ„ï¼šhashå‡½æ•°(ä¸€èˆ¬æ˜¯ä¸ªä»¿å‡½æ•°)è¿”å›çš„å€¼åº”è¯¥æ˜¯ä¸€ä¸ªç¼–å·ï¼Œä¹Ÿå°±æ˜¯ size_t</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230422154019414.png" alt="image-20230422154019414"></p><p>å®šä¹‰äº†hashå‡½æ•°ï¼Œç„¶åä»€ä¹ˆä¹Ÿä¸åšï¼Œåé¢è¿›è¡Œä¸€äº›ç‰¹åŒ–çš„å¤„ç†!!!</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230422154054412.png" alt="image-20230422154054412"></p><p>æ³¨æ„è¿™é‡Œçš„hashå‡½æ•°è®¾è®¡ï¼Œæˆ‘ä»¬åœ¨å°†keyè½¬åŒ–ä¸ºhashcodeçš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä»»æ„è®¾è®¡hashå‡½æ•°ä½¿å¾—è½¬åŒ–æˆä¸ºçš„hashcode<strong>å°½é‡ä¸é‡å¤ï¼Œå°½é‡å¤Ÿä¹±!!!</strong></p><p><strong>åœ¨ç®—å‡ºhashcodeä¹‹åè¿˜è¦æ”¾å…¥ç¯®å­ï¼Œè¿™ä¸ªæ—¶å€™å°±å¾ˆç®€å•äº†ï¼Œå°±æŠŠhashcodeæ±‚ç¯®å­çš„sizeçš„ä½™æ•°å°±å¯ä»¥çŸ¥é“æ”¾åœ¨å“ªé‡Œäº†!!!</strong>(ç°åœ¨åŸºæœ¬éƒ½æ˜¯è¿™ä¹ˆåšçš„)</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230422155807393.png" alt="image-20230422155807393"></p><p>ä½¿ç”¨hashtableçš„ä¾‹å­ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;hashtable.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">eqstr</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *str1, <span class="type">const</span> <span class="type">char</span> *str2)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">strcmp</span>(str1, str2) == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœæ˜¯è‡ªå·±è®¾è®¡å°±å¯ä»¥è¿™ä¹ˆè®¾è®¡</span></span><br><span class="line"><span class="keyword">inline</span> <span class="type">size_t</span> _hash_string(<span class="type">const</span> <span class="type">char</span> *s)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">size_t</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (; *s != <span class="string">&#x27;\n&#x27;</span>; ++s)</span><br><span class="line">        ret = <span class="number">10</span> * ret + *s;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">fuck</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *s)</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> _hash_string(s); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    __gnu_cxx::hashtable&lt;<span class="type">const</span> <span class="type">char</span> *, <span class="type">const</span> <span class="type">char</span> *,</span><br><span class="line">                         hash&lt;<span class="type">const</span> <span class="type">char</span> *&gt;, <span class="comment">// æ ‡å‡†åº“æ²¡æœ‰æä¾› hash&lt;std::string&gt;!!!!</span></span><br><span class="line">                         _Identity&lt;<span class="type">const</span> <span class="type">char</span> *&gt;,</span><br><span class="line">                         eqstr&gt; </span><br><span class="line">                 <span class="comment">// ä¸èƒ½ç›´æ¥æ”¾å…¥strcmpï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦åˆ¤æ–­æ˜¯å¦ç›¸åŒï¼Œè¿”å›çš„æ˜¯trueå’Œfalse;è€Œstrcmpè¿”å›çš„æ˜¯1 0 -1ï¼Œæ¥å£ä¸å¤ªä¸€è‡´</span></span><br><span class="line">        <span class="built_in">ht</span>(<span class="number">50</span>, <span class="built_in">hash</span>&lt;<span class="type">const</span> <span class="type">char</span> *&gt;(), <span class="built_in">eqstr</span>());<span class="comment">// è¿™ä¸ªä¸œè¥¿æ²¡æœ‰é»˜è®¤ç©ºçš„æ„é€ å‡½æ•°ï¼Œéœ€è¦æä¾›ä¸€äº›ä¸œè¥¿</span></span><br><span class="line">    <span class="comment">// ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºç›´æ¥ä½¿ç”¨hashtableéå¸¸éš¾ç”¨</span></span><br><span class="line"></span><br><span class="line">    ht.<span class="built_in">insert_unique</span>(<span class="string">&quot;kiwi&quot;</span>);</span><br><span class="line">    ht.<span class="built_in">insert_unique</span>(<span class="string">&quot;plum&quot;</span>);</span><br><span class="line">    ht.<span class="built_in">insert_unique</span>(<span class="string">&quot;apple&quot;</span>);</span><br><span class="line">    for_each(ht.<span class="built_in">begin</span>(), ht.<span class="built_in">end</span>(), [&amp;](<span class="keyword">auto</span> data)</span><br><span class="line">             &#123; cout &lt;&lt; data &lt;&lt; endl; &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// cout &lt;&lt; hash&lt;int&gt;()(32) &lt;&lt; endl;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h2 id="ç¬¬å››è®²ç®—æ³•"><a href="#ç¬¬å››è®²ç®—æ³•" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¬¬å››è®²ç®—æ³•"></a> ç¬¬å››è®²ï¼šç®—æ³•</h2><h3 id="ç®—æ³•æ¦‚è¿°"><a href="#ç®—æ³•æ¦‚è¿°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç®—æ³•æ¦‚è¿°"></a> ç®—æ³•æ¦‚è¿°</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230422162235208.png" alt="image-20230422162235208"></p><p>ç®—æ³•æ²¡æœ‰åŠæ³•ç›´æ¥é¢å¯¹å®¹å™¨ï¼Œä»–éœ€è¦å€ŸåŠ©ä¸­é—´å•†è¿­ä»£å™¨æ‰å¯ä»¥ï¼Œæ¢å¥è¯è¯´ï¼Œç®—æ³•ä¸å…³ç³»å®¹å™¨æ˜¯æ€ä¹ˆæ ·çš„ï¼Œåªå…³å¿ƒå®¹å™¨æä¾›ç»™æˆ‘çš„è¿­ä»£å™¨æ˜¯æ€ä¹ˆæ ·çš„ï¼Œè€Œè¿­ä»£å™¨çš„è®¾è®¡çš„ç¬¦å·é‡è½½æ˜¯æ™®é€‚çš„ï¼Œè¿™æ ·å°±å¯ä»¥é€‚ç”¨äºå¤§å¤šæ•°å®¹å™¨äº†ã€‚</p><h3 id="è¿­ä»£å™¨çš„äº”ç§åˆ†ç±»æ³¨æ„è¿™äº”ç§éƒ½æ˜¯ç±»"><a href="#è¿­ä»£å™¨çš„äº”ç§åˆ†ç±»æ³¨æ„è¿™äº”ç§éƒ½æ˜¯ç±»" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è¿­ä»£å™¨çš„äº”ç§åˆ†ç±»æ³¨æ„è¿™äº”ç§éƒ½æ˜¯ç±»"></a> è¿­ä»£å™¨çš„äº”ç§åˆ†ç±»ï¼šæ³¨æ„è¿™äº”ç§éƒ½æ˜¯ç±»!!!</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230422162614061.png" alt="image-20230422162614061"></p><p>random_access_iterator_tag éšæœºè®¿é—®è¿­ä»£å™¨ï¼šå¯ä»¥è·³ç€è®¿é—®ï¼Œä»»æ„ä¸€ä¸ªéƒ½å¯ä»¥è®¿é—®(é‡è½½äº†+ - += -= ++ â€“ è¿ç®—ç¬¦)</p><p>bidirectional_iterator_tag åŒå‘è®¿é—®è¿­ä»£å™¨ï¼šå¯ä»¥å¾€å‰èµ°æˆ–è€…å¾€åèµ°ï¼Œä½†æ˜¯ä¸€æ¬¡åªèƒ½èµ°ä¸€æ ¼(é‡è½½äº† ++ â€“ è¿ç®—ç¬¦)</p><p>farward_iterator_tag å•å‘è®¿é—®è¿­ä»£å™¨ï¼šåªèƒ½å‘ä¸€ä¸ªæ–¹å‘èµ°ï¼Œininä¸€æ¬¡åªèƒ½èµ°ä¸€æ ¼</p><p>æ‰“å°ä¸€ä¸‹å„ç§å®¹å™¨çš„iterator_category</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230422163446874.png" alt="image-20230422163446874"></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;array&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;forward_list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;deque&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stream_iterator.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯ä»¥åªæŒ‡å®šå€¼ä¸ç»™å‚æ•°</span></span><br><span class="line"><span class="type">void</span> __display_category(random_access_iterator_tag)</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;random_access_iterator&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> __display_category(bidirectional_iterator_tag)</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;bidirectional_iterator&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> __display_category(forward_iterator_tag)</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;forward_iterator&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> __display_category(output_iterator_tag)</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;output_iterator&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> __display_category(input_iterator_tag)</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;input_iterator&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> I&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">display_category</span><span class="params">(I iter)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// åŠ ä¸Štypenameæ˜¯ä¸ºäº†æ˜¯ I å°±æ˜¯è¿­ä»£å™¨ç±»å‹(ç›®å‰è¿™ä¹ˆç†è§£)</span></span><br><span class="line">    <span class="keyword">typename</span> iterator_traits&lt;I&gt;::iterator_category cagy; <span class="comment">// å»é—®èƒå–å‰‚è¿™ä¸ªè¿­ä»£å™¨æ˜¯ä»€ä¹ˆç±»å‹</span></span><br><span class="line">    __display_category(cagy);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">display_category</span>(array&lt;<span class="type">int</span>, <span class="number">10</span>&gt;::<span class="built_in">iterator</span>());</span><br><span class="line">    <span class="built_in">display_category</span>(vector&lt;<span class="type">int</span>&gt;::<span class="built_in">iterator</span>());</span><br><span class="line">    <span class="built_in">display_category</span>(list&lt;<span class="type">int</span>&gt;::<span class="built_in">iterator</span>());</span><br><span class="line">    <span class="built_in">display_category</span>(forward_list&lt;<span class="type">int</span>&gt;::<span class="built_in">iterator</span>());</span><br><span class="line">    <span class="built_in">display_category</span>(deque&lt;<span class="type">int</span>&gt;::<span class="built_in">iterator</span>());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">display_category</span>(set&lt;<span class="type">int</span>&gt;::<span class="built_in">iterator</span>());</span><br><span class="line">    <span class="built_in">display_category</span>(map&lt;<span class="type">int</span>, <span class="type">int</span>&gt;::<span class="built_in">iterator</span>());</span><br><span class="line">    <span class="built_in">display_category</span>(multiset&lt;<span class="type">int</span>&gt;::<span class="built_in">iterator</span>());</span><br><span class="line">    <span class="built_in">display_category</span>(multimap&lt;<span class="type">int</span>, <span class="type">int</span>&gt;::<span class="built_in">iterator</span>());</span><br><span class="line">    <span class="built_in">display_category</span>(unordered_set&lt;<span class="type">int</span>&gt;::<span class="built_in">iterator</span>());</span><br><span class="line">    <span class="built_in">display_category</span>(unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt;::<span class="built_in">iterator</span>());</span><br><span class="line">    <span class="built_in">display_category</span>(unordered_multiset&lt;<span class="type">int</span>&gt;::<span class="built_in">iterator</span>());</span><br><span class="line">    <span class="built_in">display_category</span>(unordered_multimap&lt;<span class="type">int</span>, <span class="type">int</span>&gt;::<span class="built_in">iterator</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™ä¸¤ä¸ªä¸å¤ªä¸€æ ·ï¼Œæ˜¯ä»é€‚é…å™¨adapteräº§ç”Ÿçš„</span></span><br><span class="line">    <span class="built_in">display_category</span>(<span class="built_in">istream_iterator</span>&lt;<span class="type">int</span>&gt;());</span><br><span class="line">    <span class="built_in">display_category</span>(<span class="built_in">ostream_iterator</span>&lt;<span class="type">int</span>&gt;(cout, <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="iterator_categoryå¯¹ç®—æ³•çš„æ•ˆç‡å½±å“"><a href="#iterator_categoryå¯¹ç®—æ³•çš„æ•ˆç‡å½±å“" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#iterator_categoryå¯¹ç®—æ³•çš„æ•ˆç‡å½±å“"></a> iterator_categoryå¯¹ç®—æ³•çš„æ•ˆç‡å½±å“</h3><p>ä¸åŒçš„è¿­ä»£å™¨ç±»å‹ä¼šå¯¼è‡´åœ¨è®¿é—®çš„è¿‡ç¨‹ä¸­æ•ˆç‡æœ‰åŒºåˆ«</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230422171334117.png" alt="image-20230422171334117"></p><p><strong>æ³¨æ„å¯¹å³è¾¹ä»£ç çš„è§£è¯»ï¼Œè¿™ä¸ªdistanceå‡½æ•°æ˜¯æ‰¾ä¸¤ä¸ªè¿­ä»£å™¨ä¹‹é—´çš„è·ç¦»(ptrdiff_t ç±»å‹)ï¼Œç„¶åå°±é—®èƒå–æœºè¿­ä»£å™¨çš„ç±»å‹æ˜¯ä»€ä¹ˆï¼Ÿç„¶åé’ˆå¯¹å‡½æ•°è°ƒä¸åŒçš„é‡è½½å‡½æ•°å°±å¯ä»¥äº†!!!</strong></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;list&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Iterator, <span class="keyword">typename</span> Distance&gt;</span><br><span class="line"><span class="keyword">inline</span> Iterator &amp;_advance(Iterator &amp;iter, Distance n, std::random_access_iterator_tag)</span><br><span class="line">    &#123;</span><br><span class="line">        iter += n;</span><br><span class="line">        <span class="keyword">return</span> iter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Iterator, <span class="keyword">typename</span> Distance&gt;</span><br><span class="line"><span class="keyword">inline</span> Iterator &amp;_advance(Iterator &amp;iter, Distance n, std::bidirectional_iterator_tag)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (n &gt;= <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">while</span> (n--)</span><br><span class="line">                ++iter;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">while</span> (n++)</span><br><span class="line">                --iter;</span><br><span class="line">        <span class="keyword">return</span> iter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Iterator, <span class="keyword">typename</span> Distance&gt;</span><br><span class="line"><span class="keyword">inline</span> Iterator &amp;_advance(Iterator &amp;iter, Distance n, std::input_iterator_tag)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span> (n--)</span><br><span class="line">            ++iter;</span><br><span class="line">        <span class="keyword">return</span> iter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Iterator, <span class="keyword">typename</span> Distance&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> Iterator <span class="title">Advance</span><span class="params">(Iterator iter, Distance n)</span></span></span><br><span class="line"><span class="function">    <span class="comment">// è¿™é‡Œæœ€å¥½ä¸ä¼ å…¥å¼•ç”¨ç±»å‹ï¼Œå› ä¸ºç¬¬ä¸€ä¸‹é¢æ²¡æœ‰æ›´æ”¹iterçš„å€¼ï¼Œä¸ç”¨æ‹…å¿ƒå®å‚å½¢å‚çš„é—®é¢˜ï¼›</span></span></span><br><span class="line"><span class="function">    <span class="comment">// ç¬¬äºŒï¼Œå¤–éƒ¨å¯èƒ½ä¼ å…¥çš„æ˜¯begin()å’Œend()è¿™ç±»æ²¡æœ‰åŠæ³•ç›´æ¥ä¿®æ”¹çš„è¿­ä»£å™¨</span></span></span><br><span class="line"><span class="function">    <span class="comment">// æˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™éƒ½æ˜¯å£°æ˜äº†ä¸€ä¸ªè¿åŠ¨è¿­ä»£å™¨ï¼Œä»–çš„åˆå€¼æ˜¯begin(),è¿™æ ·æ¥æ“ä½œçš„</span></span></span><br><span class="line"><span class="function">    <span class="comment">// æ‰€ä»¥ä¼ å…¥å¼•ç”¨ä¼šå‡ºé—®é¢˜ï¼Œæœ€å¥½ä¼ å€¼ï¼Œä½†æ˜¯åé¢å°±å¯ä»¥ä¼ å…¥å¼•ç”¨äº†ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„è¿­ä»£å™¨å¯¹è±¡</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">typedef</span> <span class="keyword">typename</span> std::iterator_traits&lt;Iterator&gt;::iterator_category Iterator_Category;</span><br><span class="line">        <span class="keyword">return</span> _advance(iter, n, <span class="built_in">Iterator_Category</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; v&#123;<span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>&#125;;</span><br><span class="line">    cout &lt;&lt; *<span class="built_in">myadvance</span>().<span class="built_in">Advance</span>(v.<span class="built_in">begin</span>() + <span class="number">2</span>, <span class="number">-1</span>) &lt;&lt; endl; <span class="comment">// 5</span></span><br><span class="line">    list&lt;<span class="type">int</span>&gt; l&#123;<span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">12</span>&#125;;</span><br><span class="line">    cout &lt;&lt; *<span class="built_in">myadvance</span>().<span class="built_in">Advance</span>(l.<span class="built_in">begin</span>(), <span class="number">4</span>) &lt;&lt; endl; <span class="comment">// 12</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ³¨æ„æ³¨é‡Šçš„å†…å®¹ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œè¯¥ä¼ å¼•ç”¨ï¼Œè¿™é‡Œä¸è¯¥ä¼ å¼•ç”¨!!!</p><p><strong>ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œè¿­ä»£å™¨ç±»å‹çš„ä¸åŒä¼šå¯¼è‡´ç®—æ³•æ•ˆç‡çš„ä¸åŒï¼Œä½†æ˜¯æˆ‘ä»¬ä¸æ˜¯é€šè¿‡æ¨¡æ¿ç‰¹åŒ–æ¥å®ç°çš„ï¼Œæ˜¯é€šè¿‡å‡½æ•°é‡è½½æ¥å®ç°çš„!!!</strong></p><p><strong>ç®—æ³•æºç å¯¹ iterator_category çš„æš—ç¤º:</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230422183037284.png" alt="image-20230422183037284"></p><p>å› ä¸ºä¸Šé¢çš„è¿­ä»£å™¨éƒ½æ˜¯æ¨¡æ¿ï¼Œä½†æ˜¯æœ‰äº›ç®—æ³•åœ¨å®ç°çš„è¿‡ç¨‹ä¸­åªå¯¹æŸç§ç±»å‹çš„è¿­ä»£å™¨æœ‰æ•ˆï¼Œæ‰€ä»¥è®¾è®¡è€…ä¼šæš—ç¤ºè¿­ä»£å™¨çš„ç±»å‹æ¥æ–¹ä¾¿é˜…è¯»å’Œä¿®æ”¹!!!</p><h3 id="ç®—æ³•æºä»£ç å‰–æ"><a href="#ç®—æ³•æºä»£ç å‰–æ" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç®—æ³•æºä»£ç å‰–æ"></a> ç®—æ³•æºä»£ç å‰–æ</h3><p>C++ STL åº“é‡Œé¢çš„æ ‡å‡†ç®—æ³•æ ¼å¼</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Iterator&gt;</span><br><span class="line">std::<span class="built_in">Algorithm</span>(Iterator iter1,Iterator iter2)&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¸¦æ¯”è¾ƒçš„å‚æ•° ä¸€èˆ¬æ˜¯ä»¿å‡½æ•°</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Iterator,<span class="keyword">typename</span> Cmp&gt;</span><br><span class="line">std::<span class="built_in">Algorithm</span>(Iterator iter1,Iterator iter2,Cmp cmp)&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h4 id="accumulate"><a href="#accumulate" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#accumulate"></a> accumulate</h4><p>éå†æ•´ä¸ªå®¹å™¨å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œæ“ä½œ(å¯ä»¥æ˜¯ç´¯åŠ )ç„¶åè¿”å›å€¼</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230423113446373.png" alt="image-20230423113446373"></p><p>æµ‹è¯•accumulateï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">myfunc</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + <span class="number">2</span> * y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">myclass</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> x + <span class="number">3</span> * y; &#125;</span><br><span class="line">&#125; myobj;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_accumulate</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;test_accumulate()..........&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="type">int</span> init = <span class="number">100</span>;</span><br><span class="line">    <span class="type">int</span> nums[] = &#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>&#125;;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;using default accumulate: &quot;</span>;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">accumulate</span>(nums, nums + <span class="number">3</span>, init); <span class="comment">// 160</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;using functional&#x27;s minus: &quot;</span>;</span><br><span class="line">    <span class="comment">// minus å‡æ³• ä»¿å‡½æ•°</span></span><br><span class="line">    cout &lt;&lt; <span class="built_in">accumulate</span>(nums, nums + <span class="number">3</span>, init, <span class="built_in">minus</span>&lt;<span class="type">int</span>&gt;()); <span class="comment">// 40</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;using custom function: &quot;</span>;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">accumulate</span>(nums, nums + <span class="number">3</span>, init, myfunc); <span class="comment">// 220</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;using custom object: &quot;</span>;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">accumulate</span>(nums, nums + <span class="number">3</span>, init, myobj); <span class="comment">// 280</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è‡ªå·±å®ç°ä»¥ä¸‹accumulate:</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stl_numeric.h&gt;</span> <span class="comment">//accumulate</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Sum_Square</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Value_Int</span>&gt;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> Value_Int &amp;<span class="title">operator</span><span class="params">()</span><span class="params">(Value_Int &amp;val, Value_Int val_iter)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        val += val_iter * val_iter;</span><br><span class="line">        <span class="keyword">return</span> val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">String_Append</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Value_String</span>&gt;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> Value_String &amp;<span class="title">operator</span><span class="params">()</span><span class="params">(Value_String &amp;val, Value_String val_iter)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        val_iter.<span class="built_in">append</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line">        val.<span class="built_in">append</span>(val_iter);</span><br><span class="line">        <span class="keyword">return</span> val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Algorithm</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Iterator</span>, <span class="keyword">class</span> <span class="title class_">Value_Type</span>&gt;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">static</span> Value_Type <span class="title">Accumulate</span><span class="params">(Iterator begin, Iterator end, Value_Type val)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (; begin != end; ++begin)</span><br><span class="line">            val += *begin;</span><br><span class="line">        <span class="keyword">return</span> val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Iterator</span>, <span class="keyword">class</span> <span class="title class_">Value_Type</span>, <span class="keyword">class</span> <span class="title class_">Binary_Operation</span>&gt;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">static</span> Value_Type <span class="title">Accumulate</span><span class="params">(Iterator begin, Iterator end, Value_Type val, Binary_Operation binary_op)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (; begin != end; ++begin)</span><br><span class="line">            val = <span class="built_in">binary_op</span>(val, *begin);</span><br><span class="line">        <span class="keyword">return</span> val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; v&#123;<span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">10</span>&#125;;</span><br><span class="line">    cout &lt;&lt; Algorithm::<span class="built_in">Accumulate</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), <span class="number">0</span> &lt;&lt; endl; <span class="comment">// 33</span></span><br><span class="line">    cout &lt;&lt; Algorithm::<span class="built_in">Accumulate</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), <span class="number">0</span>, <span class="built_in">Sum_Square</span>()) &lt;&lt; endl; <span class="comment">// 251</span></span><br><span class="line">    list&lt;string&gt; l&#123;<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;I&quot;</span>, <span class="string">&quot;want&quot;</span>, <span class="string">&quot;to&quot;</span>, <span class="string">&quot;fuck&quot;</span>, <span class="string">&quot;you&quot;</span>, <span class="string">&quot;my&quot;</span>, <span class="string">&quot;friend.&quot;</span>&#125;;</span><br><span class="line">    cout &lt;&lt; Algorithm::<span class="built_in">Accumulate</span>(l.<span class="built_in">begin</span>(), l.<span class="built_in">end</span>(), <span class="built_in">string</span>(), <span class="built_in">String_Append</span>()) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h4 id="for_each"><a href="#for_each" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#for_each"></a> for_each</h4><p>å®¹å™¨çš„éå†ç®—æ³•</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230423171745364.png" alt="image-20230423171745364"></p><p>è‡ªå·±å®ç°ä¸€ä¸‹for_each</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Algorithm</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Iterator</span>, <span class="keyword">class</span> <span class="title class_">Function</span>&gt;</span><br><span class="line">    <span class="comment">//ä¸ºä»€ä¹ˆè¦è¿”å› Function ä»¿å‡½æ•°å‘¢?(æˆ–è€…å‡½æ•°æŒ‡é’ˆ)</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">static</span> Function <span class="title">For_each</span><span class="params">(Iterator first, Iterator last, Function f)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (; first != last; ++first)</span><br><span class="line">            <span class="built_in">f</span>(*first); <span class="comment">// æ³¨æ„æ˜¯ç›´æ¥æŠŠæ•°æ®ä¼ é€’ç»™å‡½æ•° f</span></span><br><span class="line">        <span class="keyword">return</span> f;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; v1&#123;<span class="number">2</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">9</span>&#125;;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; v2;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸ä¿®æ”¹v1çš„å€¼</span></span><br><span class="line">    Algorithm::<span class="built_in">For_each</span>(v<span class="number">1.</span><span class="built_in">begin</span>(), v<span class="number">1.</span><span class="built_in">end</span>(), [&amp;](<span class="type">int</span> val)</span><br><span class="line">                        &#123; val*=<span class="number">2</span>;v<span class="number">2.</span><span class="built_in">push_back</span>(val); &#125;);</span><br><span class="line"></span><br><span class="line">    for_each(v<span class="number">1.</span><span class="built_in">begin</span>(), v<span class="number">1.</span><span class="built_in">end</span>(), [&amp;](<span class="keyword">auto</span> val)</span><br><span class="line">             &#123; cout &lt;&lt; val &lt;&lt; <span class="string">&#x27; &#x27;</span>; &#125;);</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> val : v2)</span><br><span class="line">        cout &lt;&lt; val &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>çœ‹åˆ°for_eachçš„è¿”å›å€¼ï¼Œæˆ‘ä¸å¾—ä¸æ€è€ƒä¸ºä»€ä¹ˆè¦è¿”å›Functionä»¿å‡½æ•°å‘¢ï¼Ÿ(å¾ˆå°‘æƒ…å†µä¸‹å‡½æ•°æŒ‡é’ˆ)</p><p><strong>åŸå› æ˜¯ï¼šå¯ä»¥ç›‘è§†ä»¿å‡½æ•°å¯¹è±¡åœ¨ç»è¿‡è¿™ä¸ªfor_eachæ“ä½œä¹‹åçš„çŠ¶æ€</strong></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    for_each()å®ƒå¯ä»¥è¿”å›å…¶ä»¿å‡½æ•°(è¿”å›æ‰€ä¼ å…¥çš„å‡½æ•°å¯¹è±¡çš„æœ€ç»ˆçŠ¶æ€).</span></span><br><span class="line"><span class="comment">    è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡for_each()çš„è¿”å›å€¼æ¥è·å–ä»¿å‡½æ•°çš„çŠ¶æ€.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* ä»¿å‡½æ•° */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CSum</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">CSum</span>() &#123; m_sum = <span class="number">0</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123; m_sum += n; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">GetSum</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> m_sum; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> m_sum;</span><br><span class="line">&#125; cs;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; vi;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++)</span><br><span class="line">        vi.<span class="built_in">push_back</span>(i);</span><br><span class="line">    <span class="comment">// é€šè¿‡for_eachè¿”å›å€¼è®¿é—®å…¶æœ€ç»ˆçŠ¶æ€(è¿”å›æ‰€ä¼ å…¥çš„å‡½æ•°å¯¹è±¡çš„æœ€ç»ˆçŠ¶æ€).</span></span><br><span class="line">    cs = for_each(vi.<span class="built_in">begin</span>(), vi.<span class="built_in">end</span>(), cs); <span class="comment">// è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œæœªè¿”å›å¼•ç”¨ï¼Œä¸ä¼šä¿®æ”¹å®å‚</span></span><br><span class="line">    cout &lt;&lt; cs.<span class="built_in">GetSum</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h4 id="replacereplace_ifreplace_copyreplace_copy_if"><a href="#replacereplace_ifreplace_copyreplace_copy_if" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#replacereplace_ifreplace_copyreplace_copy_if"></a> replace,replace_if,replace_copy,replace_copy_if</h4><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Container&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(Container con)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> val : con)</span><br><span class="line">        cout &lt;&lt; val &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Algorithm</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Iterator</span>, <span class="keyword">class</span> <span class="title class_">Value_Type</span>&gt;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">static</span> <span class="type">void</span> <span class="title">Replace</span><span class="params">(Iterator first, Iterator last, <span class="type">const</span> Value_Type oldval, <span class="type">const</span> Value_Type newval)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (; first != last; ++first)</span><br><span class="line">            <span class="keyword">if</span> (*first == oldval)</span><br><span class="line">                *first = newval;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Iterator</span>, <span class="keyword">class</span> <span class="title class_">Value_Type</span>, <span class="keyword">class</span> <span class="title class_">Predicate</span>&gt;</span><br><span class="line">    <span class="comment">// ç»™ä¸€ä¸ªè°“è¯æ¥åˆ¤æ–­æ¡ä»¶æ˜¯å¦æ›´æ”¹</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">static</span> <span class="type">void</span> <span class="title">Replace_if</span><span class="params">(Iterator first, Iterator last, Predicate pred, <span class="type">const</span> Value_Type newval)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (; first != last; ++first)</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">pred</span>(*first))<span class="comment">//è¿™é‡Œè°“è¯ä¼ é€’çš„å‚æ•°åªæœ‰ä¸€ä¸ªå€¼</span></span><br><span class="line">                *first = newval;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸Šé¢çš„ç®—æ³•å½“ä¸­ä¼ å…¥çš„å‚æ•°åªæœ‰ä¸€ä¸ªå€¼ï¼Œæ²¡ä¼ å…¥å¦‚æœéœ€è¦æ¯”è¾ƒçš„åŸºå‡†å€¼</span></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Value_Type</span>&gt;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> Value_Type &amp;val)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> val &gt; <span class="number">5</span>;<span class="comment">//æˆ‘ä»¬è‚¯å®šä¸æƒ³åœ¨å†…éƒ¨æ‰‹åŠ¨æ›´æ”¹è¿™ä¸ª5ï¼Œè€Œæ˜¯æƒ³åœ¨å¤–é¢å†™ä»£ç çš„æ—¶å€™æŠŠ5å†™è¿›å»</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜éœ€è¦å¼•ç”¨ä»¿å‡½æ•°é€‚é…å™¨ functor adapter</span></span><br><span class="line">    <span class="comment">// æ ‡å‡†åº“æä¾›çš„ bind2nd() ç”¨æ³• bind2nd(greater&lt;int&gt;,val)</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; v&#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>&#125;;</span><br><span class="line">    <span class="built_in">print</span>(v);</span><br><span class="line"></span><br><span class="line">    Algorithm::<span class="built_in">Replace</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), <span class="number">1</span>, <span class="number">66</span>);</span><br><span class="line">    <span class="built_in">print</span>(v);</span><br><span class="line"></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; v2&#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>&#125;;</span><br><span class="line">    Algorithm::<span class="built_in">Replace_if</span>(v<span class="number">2.</span><span class="built_in">begin</span>(), v<span class="number">2.</span><span class="built_in">end</span>(), <span class="built_in">bind2nd</span>(<span class="built_in">greater</span>&lt;<span class="type">int</span>&gt;(), <span class="number">5</span>), <span class="number">666</span>);</span><br><span class="line">    <span class="built_in">print</span>(v2);</span><br><span class="line"></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; v3;</span><br><span class="line">    v<span class="number">3.</span><span class="built_in">resize</span>(v.<span class="built_in">size</span>()); <span class="comment">// æ³¨æ„è¿™é‡Œè¦ç»™v3é¢„åˆ†é…ç©ºé—´ï¼Œä¸ç„¶ä¼šæ®µé”™è¯¯</span></span><br><span class="line">    <span class="built_in">replace_copy</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), v<span class="number">3.</span><span class="built_in">begin</span>(), <span class="number">10</span>, <span class="number">50</span>);</span><br><span class="line">    <span class="built_in">print</span>(v3);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h4 id="countcount_if"><a href="#countcount_if" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#countcount_if"></a> count,count_if</h4><p>è¿™ä¸ªå·®ä¸å¤šå°±ä¸å†™äº†</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230423175336384.png" alt="image-20230423175336384"></p><p>ä¸ºä»€ä¹ˆè¦è¿”å›difference_typeå‘¢ï¼Ÿ</p><p>ç®—æ³•é€šè¿‡èƒå–æœºè¯¢é—®è¿­ä»£å™¨ï¼Œè¿­ä»£å™¨ä¹‹é—´çš„é—´è·ç±»å‹æ€ä¹ˆè¡¨ç¤ºï¼Œè¿™ä¸ªç±»å‹å°±æ˜¯difference_type</p><p>æ ‡å‡†åº“çš„å®šä¹‰æ˜¯ ptrdiff_tï¼Œä¹Ÿå°±æ˜¯ long longï¼Œè¿™ä¸‹å°±å¯ä»¥ç†è§£äº†</p><p>æœ‰äº›å®¹å™¨è‡ªå¸¦çš„æˆå‘˜å‡½æ•°ï¼Œæ¯”å¦‚å›¾ä¸­çš„ï¼Œè¿™äº›å‡½æ•°çš„æ‰§è¡Œæ•ˆç‡è‚¯å®šæ¯”å…¨å±€çš„æ‰§è¡Œæ•ˆç‡æ›´é«˜!!!</p><h4 id="findfind_if"><a href="#findfind_if" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#findfind_if"></a> find,find_if</h4><p>å¾ªåºå¼æŸ¥æ‰¾ï¼Œæ•ˆç‡å¹¶ä¸æ˜¯å¾ˆé«˜ï¼Œæ‰¾ä¸åˆ°è¿”å›lastè¿­ä»£å™¨</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230423202430305.png" alt="image-20230423202430305"></p><h4 id="sort"><a href="#sort" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#sort"></a> sort</h4><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;array&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Container&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(Container con)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> val : con)</span><br><span class="line">        cout &lt;&lt; val &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">myfunc</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> i &lt; j;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">myclass</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> </span>&#123; <span class="keyword">return</span> i &lt; j; &#125;</span><br><span class="line">&#125; myobj;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    array&lt;<span class="type">int</span>, 8&gt; arr = &#123;<span class="number">32</span>, <span class="number">71</span>, <span class="number">12</span>, <span class="number">45</span>, <span class="number">26</span>, <span class="number">80</span>, <span class="number">53</span>, <span class="number">33</span>&#125;;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">v</span><span class="params">(arr.begin(), arr.end())</span></span>;</span><br><span class="line">    <span class="built_in">print</span>(v);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// using default comparison (operator &lt;)</span></span><br><span class="line">    <span class="built_in">sort</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">begin</span>() + <span class="number">4</span>); <span class="comment">// æ’åºå‰å››ä¸ª 12 32 45 71 26 80 53 33</span></span><br><span class="line">    <span class="built_in">print</span>(v);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// using function as comp</span></span><br><span class="line">    <span class="built_in">sort</span>(v.<span class="built_in">begin</span>() + <span class="number">4</span>, v.<span class="built_in">end</span>(), myfunc); <span class="comment">// 12 32 45 71 26 33 53 80</span></span><br><span class="line">    <span class="built_in">print</span>(v);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// using object as comp</span></span><br><span class="line">    <span class="built_in">sort</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), myobj); <span class="comment">// 12 26 32 33 45 53 71 80</span></span><br><span class="line">    <span class="built_in">print</span>(v);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// reverse iterators</span></span><br><span class="line">    <span class="built_in">sort</span>(v.<span class="built_in">rbegin</span>(), v.<span class="built_in">rend</span>(), <span class="built_in">less</span>&lt;<span class="type">int</span>&gt;()); <span class="comment">// 80 71 53 45 33 32 26 12</span></span><br><span class="line">    <span class="built_in">print</span>(v);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230423203719337.png" alt="image-20230423203719337"></p><p><strong>æ³¨æ„ä¸€ç‚¹çš„æ˜¯stlæ ‡å‡†åº“é‡Œé¢çš„ sort å‡½æ•°è¦æ±‚çš„æ˜¯ random_access_iterator_tag!!!</strong></p><p><strong>æ‰€ä»¥listå’Œforward_listæ²¡åŠæ³•è°ƒç”¨ï¼Œåªèƒ½è°ƒç”¨ä»–ä»¬è‡ªå·±çš„ç±»å‡½æ•°sort!!!</strong></p><h4 id="binary_searché€šè¿‡äºŒåˆ†æŸ¥æ‰¾ç¡®å®šå…ƒç´ åœ¨ä¸åœ¨å®¹å™¨å½“ä¸­"><a href="#binary_searché€šè¿‡äºŒåˆ†æŸ¥æ‰¾ç¡®å®šå…ƒç´ åœ¨ä¸åœ¨å®¹å™¨å½“ä¸­" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#binary_searché€šè¿‡äºŒåˆ†æŸ¥æ‰¾ç¡®å®šå…ƒç´ åœ¨ä¸åœ¨å®¹å™¨å½“ä¸­"></a> binary_search(é€šè¿‡äºŒåˆ†æŸ¥æ‰¾ç¡®å®šå…ƒç´ åœ¨ä¸åœ¨å®¹å™¨å½“ä¸­)</h4><p><strong>äºŒåˆ†æŸ¥æ‰¾ä¸€å®šåªèƒ½é€‚ç”¨äºä¸€ä¸ªæœ‰åºåºåˆ—!!!å¹¶ä¸”åœ¨åº“å‡½æ•°å½“ä¸­åªèƒ½ç”¨äºå‡åºåºåˆ—!!!</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230423210411376.png" alt="image-20230423210411376"></p><p>ä½¿ç”¨ä¾‹å­ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Container&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Sort</span><span class="params">(Container &amp;con)</span> <span class="comment">// ä¼ å¼•ç”¨ï¼Œä¸ç„¶ä¸æ”¹å˜å®å‚</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(con.<span class="built_in">begin</span>(), con.<span class="built_in">end</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Container&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">rSort</span><span class="params">(Container &amp;con)</span> <span class="comment">// ä¼ å¼•ç”¨ï¼Œä¸ç„¶ä¸æ”¹å˜å®å‚</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(con.<span class="built_in">rbegin</span>(), con.<span class="built_in">rend</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Container&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(Container &amp;con)</span> <span class="comment">// ä¼ å¼•ç”¨ï¼Œä¸ç„¶ä¸æ”¹å˜å®å‚</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> val : con)</span><br><span class="line">        cout &lt;&lt; val &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Fuck</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Random_Iterator, <span class="keyword">typename</span> Value_Type&gt;</span><br><span class="line">    <span class="type">bool</span> __Binary_Search(Random_Iterator first, Random_Iterator last, <span class="type">const</span> Value_Type &amp;val,</span><br><span class="line">                         random_access_iterator_tag)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// å…ˆåšä¸€ä¸ªæ£€æŸ¥ valæ¯” *firstå¤§ é‚£ä¹ˆæ‰¾ä¸åˆ°</span></span><br><span class="line">        <span class="keyword">if</span> (val &lt; *first)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (first != last)</span><br><span class="line">        &#123;</span><br><span class="line">            Random_Iterator mid = first + (last - first) / <span class="number">2</span>; <span class="comment">// æ²¡æœ‰ä¸¤ä¸ªè¿­ä»£å™¨ç›¸åŠ çš„é‡è½½ç‰ˆæœ¬!!!!</span></span><br><span class="line">            <span class="keyword">if</span> (*mid &gt; val)</span><br><span class="line">                last = mid; <span class="comment">// æ³¨æ„lastè¦æ»¡è¶³å‰é—­åå¼€</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (*mid &lt; val)</span><br><span class="line">                first = ++mid;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Random_Iterator, <span class="keyword">typename</span> Value_Type&gt;</span><br><span class="line">    <span class="type">bool</span> __Binary_Search(Random_Iterator first, Random_Iterator last, <span class="type">const</span> Value_Type &amp;val,</span><br><span class="line">                         random_access_iterator_tag, <span class="type">int</span>) <span class="comment">// å¤šä¸€ä¸ªintä»£è¡¨é™åº</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// å…ˆåšä¸€ä¸ªæ£€æŸ¥ valæ¯” *firstå¤§ é‚£ä¹ˆæ‰¾ä¸åˆ°</span></span><br><span class="line">        <span class="keyword">if</span> (val &gt; *first)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (first != last)</span><br><span class="line">        &#123;</span><br><span class="line">            Random_Iterator mid = first + (last - first) / <span class="number">2</span>; <span class="comment">// æ²¡æœ‰ä¸¤ä¸ªè¿­ä»£å™¨ç›¸åŠ çš„é‡è½½ç‰ˆæœ¬!!!!</span></span><br><span class="line">            <span class="keyword">if</span> (*mid &gt; val)</span><br><span class="line">                first = ++mid;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (*mid &lt; val)</span><br><span class="line">                last = mid; <span class="comment">// æ³¨æ„lastè¦æ»¡è¶³å‰é—­åå¼€</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Iterator, <span class="keyword">typename</span> Value_Type&gt;</span><br><span class="line">    <span class="comment">// å†™äº†ä¸€ä¸ªrandom_access_iteratorçš„é‡è½½</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">Binary_Search</span><span class="params">(Iterator first, Iterator last, <span class="type">const</span> Value_Type &amp;val)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// æƒ³åŠæ³•è®©å…¶å¯ä»¥é€‚ç”¨äºé™åºåºåˆ—</span></span><br><span class="line">        <span class="keyword">typedef</span> <span class="keyword">typename</span> iterator_traits&lt;Iterator&gt;::iterator_category Iterator_Category;</span><br><span class="line">        <span class="keyword">if</span> (*first &lt; *(last - <span class="number">1</span>)) <span class="comment">// å‡åº ä¿æŒå‰é—­åå¼€çš„è§„åˆ™!!!</span></span><br><span class="line">            <span class="keyword">return</span> __Binary_Search(first, last, val, <span class="built_in">Iterator_Category</span>());</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> __Binary_Search(first, last, val, <span class="built_in">Iterator_Category</span>(), <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; v&#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Sort</span>(v); <span class="comment">// 0 1 2 3 6 7 8 9</span></span><br><span class="line">    <span class="built_in">print</span>(v);</span><br><span class="line">    cout &lt;&lt; Fuck::<span class="built_in">Binary_Search</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), <span class="number">2</span>) &lt;&lt; endl;</span><br><span class="line">    <span class="comment">// cout &lt;&lt; binary_search(v.begin(), v.end(), 5) &lt;&lt; endl;</span></span><br><span class="line">    <span class="built_in">rSort</span>(v);</span><br><span class="line">    <span class="built_in">print</span>(v);</span><br><span class="line">    cout &lt;&lt; Fuck::<span class="built_in">Binary_Search</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), <span class="number">2</span>) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h2 id="ç¬¬äº”è®²ä»¿å‡½æ•°-é€‚é…å™¨"><a href="#ç¬¬äº”è®²ä»¿å‡½æ•°-é€‚é…å™¨" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¬¬äº”è®²ä»¿å‡½æ•°-é€‚é…å™¨"></a> ç¬¬äº”è®²ï¼šä»¿å‡½æ•° é€‚é…å™¨</h2><h3 id="ä»¿å‡½æ•°-functorsæ³¨æ„è¦ç»§æ‰¿"><a href="#ä»¿å‡½æ•°-functorsæ³¨æ„è¦ç»§æ‰¿" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä»¿å‡½æ•°-functorsæ³¨æ„è¦ç»§æ‰¿"></a> ä»¿å‡½æ•° functors(æ³¨æ„è¦ç»§æ‰¿)</h3><p>æ ‡å‡†åº“æä¾›çš„ä¸‰å¤§ç±»å‹çš„ä»¿å‡½æ•°ï¼šç®—æœ¯ç±» é€»è¾‘è¿ç®—ç±» ç›¸å¯¹è¿ç®—ç±»</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230424161751257.png" alt="image-20230424161751257"></p><p>è¿˜æœ‰ä¹‹å‰æåˆ°è¿‡çš„å‡ ä¸ªä»¿å‡½æ•°ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230424162149742.png" alt="image-20230424162149742"></p><p>æ ‡å‡†åº“çš„ç¤ºèŒƒï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230424162843434.png" alt="image-20230424162843434"></p><p><strong>æ³¨æ„åˆ°ä¸€ç‚¹ï¼šæ ‡å‡†åº“æä¾›çš„functorséƒ½å­˜åœ¨ç»§æ‰¿å…³ç³»!!!åªæœ‰è¿™æ ·æ‰ç®—æ˜¯çœŸæ­£èå…¥äº†STLä½“ç³»ï¼Œè¿™æ ·æ‰èƒ½æ›´å¥½çš„è¿ä½œã€‚</strong></p><p><strong>ä»¿å‡½æ•°çš„ adaptableå¯é€‚é… æ¡ä»¶</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230424163242826.png" alt="image-20230424163242826"></p><p><strong>STLè§„å®šï¼Œæ¯ä¸ªFunctoréƒ½åº”è¯¥æŒ‘é€‰é€‚å½“çš„ç±»æ¥ç»§æ‰¿ï¼Œå› ä¸ºé€‚é…å™¨adapterä¼šæå‡ºä¸€äº›é—®é¢˜!!!</strong></p><p><strong>ä»€ä¹ˆå«adaptable?å¦‚æœä½ å¸Œæœ›è‡ªå·±çš„ä»¿å‡½æ•°æ˜¯å¯ä»¥è¢«é€‚é…å™¨è°ƒæ•´çš„è¯ï¼Œé‚£ä¹ˆå°±ç»§æ‰¿ä¸€ä¸ªé€‚å½“çš„ç±»ï¼Œè¿™æ ·å¯ä»¥å®Œæˆæ›´å¤šçš„æ“ä½œ!!!ä¸ºä»€ä¹ˆè¦ç»§æ‰¿å‘¢ï¼Ÿå› ä¸ºå¯èƒ½åœ¨è¢«adapteræ”¹é€ çš„æ—¶å€™å¯èƒ½ä¼šé—®è¿™äº›é—®é¢˜ã€‚è¿™ä¹Ÿå’Œç®—æ³•é—®è¿­ä»£å™¨çš„äº”ä¸ªé—®é¢˜ä¸€æ ·ï¼Œé‚£é‡Œæ˜¯é€šè¿‡è¿­ä»£å™¨çš„èƒå–æœº Iterator Traits (ä¹Ÿå«è¿­ä»£å™¨é€‚é…å™¨ Iterator Adapters )å»é—®çš„ï¼Œè¿™é‡ŒåŒç†é€šè¿‡ç»§æ‰¿çš„å…³ç³»å»å›ç­”adapterçš„é—®é¢˜!!!</strong></p><h3 id="é€‚é…å™¨-adapter"><a href="#é€‚é…å™¨-adapter" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#é€‚é…å™¨-adapter"></a> é€‚é…å™¨ Adapter</h3><p>å­˜åœ¨å¤šç§ Adapters ï¼Œè¿˜æ˜¯é‚£å¼ å›¾ï¼Œæ³¨æ„å…³ç³»</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230424170726596.png" alt="image-20230424170726596" style="zoom:67%"><p>Adapterçš„å…³é”®æ˜¯ï¼š</p><p><strong>è¿™ä¸ªAdapterè¦å»æ”¹é€ æŸä¸ªä¸œè¥¿(æ¯”å¦‚å›¾ä¸­çš„containerï¼Œfunctorï¼Œiterator)ï¼Œè¿™é‡Œå°±æœ‰ä¸¤ç§è§£å†³æ–¹å¼ï¼Œç¬¬ä¸€ç§æ˜¯ç»§æ‰¿çš„æ–¹å¼ï¼Œå°±æ˜¯Adapterç»§æ‰¿è¿™ä¸ªä¸œè¥¿ï¼Œæ‹¥æœ‰è¿™ä¸ªä¸œè¥¿çš„å±æ€§æ¥è¿›è¡Œæ”¹é€ ï¼›ç¬¬äºŒç§æ˜¯å†…å«çš„æ–¹å¼ï¼ŒAdapterå†…éƒ¨æœ‰è¿™ä¸ªä¸œè¥¿æ¥è¿›è¡Œæ”¹é€ !!!</strong></p><p><strong>åœ¨æ ‡å‡†åº“é‡Œé¢çš„å®ç°ç»å¤§å¤šæ•°éƒ½æ˜¯å†…å«çš„æ–¹å¼!!!</strong></p><p>ä¸€ä¸‹å°±æ˜¯ä¸€äº›é€‚é…å™¨çš„ä¾‹å­ï¼š</p><h4 id="å®¹å™¨é€‚é…å™¨stackqueue"><a href="#å®¹å™¨é€‚é…å™¨stackqueue" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å®¹å™¨é€‚é…å™¨stackqueue"></a> å®¹å™¨é€‚é…å™¨ï¼šstack,queue</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230424172134280.png" alt="image-20230424172134280"></p><p>è¿™ä¸ªä¹‹å‰ç”¨è¿‡å¾ˆå¤šæ¬¡äº†ï¼Œå°±æ˜¯æŠŠé»˜è®¤çš„å®¹å™¨æ‹¿è¿›æ¥è¿›è¡Œæ”¹é€ ï¼Œæ¯”å¦‚è¿™é‡Œç»™çš„é»˜è®¤å€¼æ˜¯ deque ï¼Œæ”¹é€ ä¹‹åèƒ½å¤Ÿä»¥ä¸€ç§å…¨æ–°çš„é¢è²Œå±•ç°ç»™ç”¨æˆ·ï¼Œèƒ½å¤Ÿæ›´åŠ å‡†ç¡®çš„é’ˆå¯¹ç”¨æˆ·çš„éœ€è¦æ¥è¿›è¡Œç›¸åº”çš„æ“ä½œã€‚</p><h4 id="å‡½æ•°é€‚é…å™¨binder2nd"><a href="#å‡½æ•°é€‚é…å™¨binder2nd" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å‡½æ•°é€‚é…å™¨binder2nd"></a> å‡½æ•°é€‚é…å™¨ï¼šbinder2nd</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230425185823723.png" alt="image-20230425185823723"></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> fuck</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// è‡ªå·±å†™ä¸€ä¸ªbind2ndå’Œbinder2nd</span></span><br><span class="line">    <span class="comment">// ä»”ç»†æ•²æ‰“ä¸€ä¸‹è¿™æ®µä»£ç </span></span><br><span class="line">    <span class="comment">// è¿™é‡Œæš—ç¤ºäº†éœ€è¦ä¼ å…¥çš„æ˜¯ä¸€ä¸ªäºŒå…ƒè¿ç®—ç¬¦ ç„¶åä¸‹é¢çš„ç±»å‹åç§°æ˜¯ç»§æ‰¿é‡Œé¢å†™å¥½çš„ç±»å‹åç§°</span></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Binary_Op</span>&gt;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">_BinderSecond</span></span><br><span class="line">    <span class="comment">// ä¸ç»§æ‰¿è¿™ä¸€è¡Œä¹Ÿå¯ä»¥è¿ä½œï¼Œä½†æ˜¯æ²¡åŠæ³•è¿›è¡Œåç»­çš„æ”¹é€ </span></span><br><span class="line">    <span class="comment">// è¿™é‡Œå°±ä¸ç»§æ‰¿äº†!!!</span></span><br><span class="line">    <span class="comment">// : public unary_function&lt;typename Binary_Op::first_argument_type, typename Binary_Op::second_argument_type&gt;</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">protected</span>:</span><br><span class="line">        Binary_Op op;</span><br><span class="line">        <span class="keyword">typename</span> Binary_Op::second_argument_type value; <span class="comment">// ç¬¬äºŒå‚æ•° éœ€è¦è®¾å®šçš„å›ºå®šå€¼</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="comment">// ctor</span></span><br><span class="line">        _BinderSecond(<span class="type">const</span> Binary_Op &amp;x, <span class="type">const</span> <span class="keyword">typename</span> Binary_Op::second_argument_type &amp;y)</span><br><span class="line">            : <span class="built_in">op</span>(x), <span class="built_in">value</span>(y) &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">typename</span> Binary_Op::result_type</span></span><br><span class="line"><span class="function">        <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> <span class="keyword">typename</span> Binary_Op::first_argument_type &amp;x)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">op</span>(x, value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Binary_Op</span>, <span class="keyword">class</span> <span class="title class_">Value_Type</span>&gt;</span><br><span class="line">    <span class="keyword">inline</span> _BinderSecond&lt;Binary_Op&gt; _BindSecond(<span class="type">const</span> Binary_Op &amp;op, <span class="type">const</span> Value_Type &amp;val)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">typedef</span> <span class="keyword">typename</span> Binary_Op::second_argument_type second_type;<span class="comment">//è¿™å¥è¯å°±æ˜¯adapteråœ¨é—®é—®é¢˜</span></span><br><span class="line">        <span class="keyword">return</span> _BinderSecond(op, <span class="built_in">second_type</span>(val));</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; v&#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">10</span>&#125;;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">count_if</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(),</span><br><span class="line">                     fuck::_BindSecond(<span class="built_in">less</span>&lt;<span class="type">int</span>&gt;(), <span class="number">5</span>)) <span class="comment">// ç»‘å®šç¬¬äºŒå‚æ•°</span></span><br><span class="line">         &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ³¨æ„å…¶ä¸­çš„ä¸€äº›ä»£ç ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typename</span> Binary_Op::second_argument_type value;</span><br></pre></td></tr></table></div></figure><p><strong>ä¸ºä»€ä¹ˆè¦åŠ ä¸Š typename ï¼Œæ˜¯ä¸ºäº†é€šè¿‡ç¼–è¯‘ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä¸çŸ¥é“Binary_Opæ˜¯ä»€ä¹ˆç±»å‹ï¼Œç„¶åå¦‚æœä»–æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œä¹Ÿå°±æ˜¯å…¶ä¸­å«æœ‰è¿™ä¸ªç±»å‹å®šä¹‰ï¼Œé‚£ä¹ˆå°±èƒ½é€šè¿‡ç¼–è¯‘ï¼Œå¦åˆ™åœ¨è¿™é‡Œå°±ä¼šæŠ¥é”™!!!</strong></p><p><strong>ä»¿å‡½æ•°functorsçš„å¯é€‚é…(adaptable)æ¡ä»¶</strong></p><p>ç»§æ‰¿(å› ä¸ºadapterä¼šé—®é—®é¢˜ï¼Œæé—®ç±»å‹)ï¼Œæ˜¯ä¸€ä¸ªfunctor</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230425191652925.png" alt="image-20230425191652925"></p><h4 id="å‡½æ•°é€‚é…å™¨not1"><a href="#å‡½æ•°é€‚é…å™¨not1" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å‡½æ•°é€‚é…å™¨not1"></a> å‡½æ•°é€‚é…å™¨ï¼šnot1</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230425194548756.png" alt="image-20230425194548756"></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> fuck</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// å¯¹è°“è¯åšå¦å®š</span></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Predicate</span>&gt;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">_unary_negate</span></span><br><span class="line">        <span class="comment">// ç»§æ‰¿ä¸ºäº†åç»­çš„æ”¹é€ </span></span><br><span class="line">        : <span class="keyword">public</span> unary_function&lt;<span class="keyword">typename</span> Predicate::argument_type, <span class="type">bool</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">protected</span>:</span><br><span class="line">        Predicate pred;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="comment">// ctor</span></span><br><span class="line">        _unary_negate(<span class="type">const</span> Predicate &amp;x) : <span class="built_in">pred</span>(x) &#123;&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="type">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> <span class="keyword">typename</span> Predicate::argument_type &amp;x)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> !<span class="built_in">pred</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Predicate</span>&gt;</span><br><span class="line">    <span class="keyword">inline</span> _unary_negate&lt;Predicate&gt; _Not1(<span class="type">const</span> Predicate &amp;pred)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> _unary_negate&lt;Predicate&gt;(pred);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; v&#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">10</span>&#125;;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">count_if</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(),</span><br><span class="line">                     fuck::_Not1(<span class="built_in">bind2nd</span>(<span class="built_in">less</span>&lt;<span class="type">int</span>&gt;(), <span class="number">5</span>))) <span class="comment">// ç»‘å®šç¬¬äºŒå‚æ•°</span></span><br><span class="line">         &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p><strong>è§‚å¯Ÿå‘ç°è¿™äº›adapterçš„å®ç°æ–¹æ³•åŸºæœ¬éƒ½æ˜¯ä¸€ä¸ªæ¨¡æ¿è¾…åŠ©å‡½æ•°ï¼Œè°ƒç”¨ä¸€ä¸ªæ¨¡æ¿ç±»ï¼Œè¿™ä¸ªç±»é‡Œé¢æœ‰æ„é€ å‡½æ•°å’Œå°æ‹¬å·é‡è½½!!!</strong></p><h4 id="æ–°å‹é€‚é…å™¨bindsince-c11"><a href="#æ–°å‹é€‚é…å™¨bindsince-c11" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ–°å‹é€‚é…å™¨bindsince-c11"></a> æ–°å‹é€‚é…å™¨ï¼šbind(since c++11)</h4><p>å³è¾¹æ˜¯è€ç‰ˆæœ¬ï¼Œå·¦è¾¹æ˜¯æ–°ç‰ˆæœ¬!!!</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230425194051698.png" alt="image-20230425194051698"></p><p>å¯è§bindçš„å®ç°æ˜¯éå¸¸å¤æ‚çš„!!!</p><p>ä¸‹é¢æ˜¯å¯¹bindçš„ä¸€äº›æµ‹è¯•ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230425200558918.png" alt="image-20230425200558918"></p><p><strong>bind å¯ä»¥ç»‘å®šï¼š</strong></p><p><strong>functionså‡½æ•°ï¼›function objects å‡½æ•°å¯¹è±¡(ä»¿å‡½æ•°)ï¼›</strong></p><p><strong>member functions æˆå‘˜å‡½æ•°ï¼›data members æˆå‘˜å±æ€§</strong></p><p>å‰ä¸¤ä¸ªæ¯”è¾ƒå¥½ç†è§£ï¼Œå…¶ä¸­ç¬¬ä¸‰ä¸ªå’Œç¬¬å››ä¸ªçš„ç»‘å®šè§„åˆ™æ˜¯ï¼š</p><p><strong>æ³¨æ„ç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥çš„æ˜¯ä¼ çš„æ˜¯åœ°å€!!!</strong></p><p><strong>member functions, _1;</strong></p><p><strong>data members,_1</strong></p><p><strong>å¿…é¡»æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°å¿…é¡»æ˜¯å¿…é¡»æ˜¯æŸä¸ªobjectçš„åœ°å€ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™è¢«å¤–ç•ŒæŒ‡å®š!!!</strong></p><p><strong>ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥ç†è§£ä¸ºè°ƒç”¨ç±»é‡Œé¢çš„ä»€ä¹ˆæ¥å£ï¼Œç¬¬äºŒä¸ªå‚æ•°å¯ä»¥ç†è§£ä¸ºè°æ¥è°ƒç”¨!!!</strong></p><p>ä½¿ç”¨ä¾‹å­ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::placeholders; <span class="comment">// ä½¿ç”¨å ä½ç¬¦ _1 _2 _3è¿™äº›</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">my_divide</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x / y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MyPair</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">double</span> a, b;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">multiply</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> a * b; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Bind_Functions</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// binding functions</span></span><br><span class="line">    <span class="keyword">auto</span> fn_five = <span class="built_in">bind</span>(my_divide, <span class="number">10</span>, <span class="number">2</span>); <span class="comment">// return 10.0/2.0</span></span><br><span class="line">    cout &lt;&lt; <span class="built_in">fn_five</span>() &lt;&lt; endl;             <span class="comment">// 5</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> fn_half = <span class="built_in">bind</span>(my_divide, _1, <span class="number">2</span>); <span class="comment">// return x/2.0</span></span><br><span class="line">    cout &lt;&lt; <span class="built_in">fn_half</span>(<span class="number">10</span>) &lt;&lt; endl;           <span class="comment">// 5</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> fn_rounding = <span class="built_in">bind</span>(my_divide, _2, _1); <span class="comment">// ç¬¬ä¸€å‚æ•°ä¸ºé™¤æ•°ï¼Œç¬¬äºŒå‚æ•°ä¸ºè¢«é™¤æ•° return y/x</span></span><br><span class="line">    cout &lt;&lt; <span class="built_in">fn_rounding</span>(<span class="number">10</span>, <span class="number">2</span>) &lt;&lt; endl;         <span class="comment">// 0.2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> fn_invert = <span class="built_in">bind</span>&lt;<span class="type">int</span>&gt;(my_divide, _1, _2); <span class="comment">// int ä»£è¡¨å¸Œæœ›è¿”å›çš„ç±»å‹ return int(x/y)</span></span><br><span class="line">    cout &lt;&lt; <span class="built_in">fn_invert</span>(<span class="number">10</span>, <span class="number">3</span>) &lt;&lt; endl;              <span class="comment">// 3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Bind_Members</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    MyPair ten_two&#123;<span class="number">10</span>, <span class="number">2</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> bound_memfn = <span class="built_in">bind</span>(&amp;MyPair::multiply, _1); <span class="comment">// return x.multiply()</span></span><br><span class="line">    cout &lt;&lt; <span class="built_in">bound_memfn</span>(ten_two) &lt;&lt; endl;           <span class="comment">// 20</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> bound_memdata = <span class="built_in">bind</span>(&amp;MyPair::a, ten_two); <span class="comment">// return tentwo.a</span></span><br><span class="line">    cout &lt;&lt; <span class="built_in">bound_memdata</span>() &lt;&lt; endl;                <span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> bound_memdata2 = <span class="built_in">bind</span>(&amp;MyPair::b, _1); <span class="comment">// return x.b</span></span><br><span class="line">    cout &lt;&lt; <span class="built_in">bound_memdata2</span>(ten_two) &lt;&lt; endl;    <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; v&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>&#125;;</span><br><span class="line">    <span class="keyword">auto</span> _fn = <span class="built_in">bind</span>(<span class="built_in">less</span>&lt;<span class="type">int</span>&gt;(), _1, <span class="number">5</span>);</span><br><span class="line">    cout &lt;&lt; <span class="built_in">count_if</span>(v.<span class="built_in">cbegin</span>(), v.<span class="built_in">cend</span>(), _fn) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">count_if</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), <span class="built_in">bind</span>(<span class="built_in">less</span>&lt;<span class="type">int</span>&gt;(), _1, <span class="number">5</span>)) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Bind_Functions</span>();</span><br><span class="line">    <span class="built_in">Bind_Members</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h4 id="è¿­ä»£å™¨é€‚é…å™¨rbeginrend"><a href="#è¿­ä»£å™¨é€‚é…å™¨rbeginrend" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è¿­ä»£å™¨é€‚é…å™¨rbeginrend"></a> è¿­ä»£å™¨é€‚é…å™¨ï¼šrbeginï¼Œrend</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230425203641882.png" alt="image-20230425203641882"></p><p>è¿™ä¸ªè¿­ä»£å™¨å°±æ˜¯åœ¨æ­£å‘è¿­ä»£å™¨çš„åŸºç¡€ä¹‹ä¸Šè¿›è¡Œæ”¹é€ çš„è¿­ä»£å™¨!!!</p><h4 id="è¿­ä»£å™¨é€‚é…å™¨inserteræ²¡å¼„æ‡‚"><a href="#è¿­ä»£å™¨é€‚é…å™¨inserteræ²¡å¼„æ‡‚" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è¿­ä»£å™¨é€‚é…å™¨inserteræ²¡å¼„æ‡‚"></a> è¿­ä»£å™¨é€‚é…å™¨ï¼šinserter(æ²¡å¼„æ‡‚)</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230425205345712.png" alt="image-20230425205345712"></p><p>æ³¨æ„copyæ˜¯å·²ç»å†™æ­»çš„å‡½æ•°ï¼Œé‚£ä¹ˆå¦‚ä½•æ‰èƒ½æ”¹å˜ä»–çš„è¡Œä¸ºå‘¢ï¼Ÿ</p><p><strong>ç­”æ¡ˆæ˜¯å€ŸåŠ©æ“ä½œç¬¦é‡è½½ï¼Œæœ¬ä¾‹å­å°±æ˜¯é‡è½½äº† = å·è¿ç®—ç¬¦å°±æ˜¯å®ç°äº†ç”±èµ‹å€¼æ“ä½œå˜ä¸ºæ’å…¥æ“ä½œäº†!!!</strong></p><h2 id="ç¬¬å…­è®²stlå‘¨å›´çš„ç»†ç¢çŸ¥è¯†ç‚¹"><a href="#ç¬¬å…­è®²stlå‘¨å›´çš„ç»†ç¢çŸ¥è¯†ç‚¹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¬¬å…­è®²stlå‘¨å›´çš„ç»†ç¢çŸ¥è¯†ç‚¹"></a> ç¬¬å…­è®²ï¼šSTLå‘¨å›´çš„ç»†ç¢çŸ¥è¯†ç‚¹</h2><h3 id="ä¸€ä¸ªä¸‡ç”¨çš„-hash-function"><a href="#ä¸€ä¸ªä¸‡ç”¨çš„-hash-function" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä¸€ä¸ªä¸‡ç”¨çš„-hash-function"></a> ä¸€ä¸ªä¸‡ç”¨çš„ hash function</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230426151146418.png" alt="image-20230426151146418"></p><p><strong>ç³»ç»Ÿæä¾›äº†ä¸€ä¸ªéå¸¸ä¸é”™çš„hashcodeç”Ÿæˆå‡½æ•° hash_val() ï¼Œæ‹¬å·é‡Œé¢æŠŠå…ƒç´ çš„æ‰€æœ‰å‚æ•°å…¨éƒ¨æ”¾è¿›å»å°±å¥½ï¼</strong></p><h4 id="hash_valå‚æ•°åŒ…"><a href="#hash_valå‚æ•°åŒ…" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#hash_valå‚æ•°åŒ…"></a> hash_val(å‚æ•°åŒ…)</h4><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Types&gt; <span class="comment">// ... çš„å«ä¹‰ æ¥å—ä»»æ„æ•°é‡çš„æ¨¡æ¿å‚æ•°</span></span><br><span class="line">   <span class="function"><span class="keyword">inline</span> <span class="type">size_t</span> <span class="title">hash_val</span><span class="params">(<span class="type">const</span> Types &amp;...args)</span></span></span><br><span class="line"><span class="function"><span class="comment">//åˆ›å»ºä¸€ä¸ªç§å­ï¼Œå°†ç§å­å’Œå‚æ•°åŒ…ç»‘å®šåœ¨ä¸€èµ·</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="type">size_t</span> seed = <span class="number">0</span>;</span><br><span class="line">       <span class="built_in">hash_val</span>(seed, args...);<span class="comment">//è°ƒç”¨2å·é‡è½½ ä¿®æ”¹seed</span></span><br><span class="line">       <span class="keyword">return</span> seed;<span class="comment">//æœ€åè¿”å›seedå°±æ˜¯æœ€ç»ˆçš„hashcode</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line">   <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Type, <span class="keyword">typename</span>... Types&gt;</span><br><span class="line">   <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">hash_val</span><span class="params">(<span class="type">size_t</span> &amp;seed, <span class="type">const</span> Type &amp;val, <span class="type">const</span> Types &amp;...args)</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="comment">//æ³¨æ„è¿™ä¸ªå‡½æ•°æ¥å—çš„å‚æ•°ï¼Œæœ‰ä¸€ä¸ªval,æœ¬æ¥ä¼ å…¥çš„æ˜¯nä¸ªå…ƒç´ çš„å‚æ•°åŒ…ï¼Œå‡ºç°valä¹‹åï¼Œå°±å°†å…¶åˆ†å¼€ï¼Œåˆ†ä¸º1å’Œn-1æ¥å¤„ç†</span></span><br><span class="line">       <span class="built_in">hash_combine</span>(seed, val);<span class="comment">//å–å‡ºä¸€ä¸ªå‚æ•°æ¥å¯¹seedè¿›è¡Œä¿®æ”¹!!!!</span></span><br><span class="line">       <span class="built_in">hash_val</span>(seed, args...);<span class="comment">//å¤„ç†å‰©ä½™ n-1 ä¸ªå‚æ•°åŒ… é€’å½’æ“ä½œ</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line">   <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Type&gt;</span><br><span class="line">   <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">hash_val</span><span class="params">(<span class="type">size_t</span> &amp;seed, <span class="type">const</span> Type &amp;val)</span></span></span><br><span class="line"><span class="function"><span class="comment">//æœ€ç»ˆå½“åªå‰©ä¸‹ä¸€ä¸ªå‚æ•°çš„æ—¶å€™å°±æœ€åæ›´æ”¹ä¸€æ¬¡å°±è¡Œäº†</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="built_in">hash_combine</span>(seed, val);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Type&gt;</span><br><span class="line">   <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">hash_combine</span><span class="params">(<span class="type">size_t</span> &amp;seed, <span class="type">const</span> Type &amp;val)</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       seed ^= std::<span class="built_in">hash</span>&lt;Type&gt;()(val) + <span class="number">0x9e3779b9</span> + (seed &lt;&lt; <span class="number">6</span>) + (seed &gt;&gt; <span class="number">2</span>);</span><br><span class="line">       <span class="comment">//å‰é¢ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è°ƒç”¨ç³»ç»Ÿæä¾›çš„å“ˆå¸Œå‡½æ•°ï¼Œåé¢è¿™äº›åŠ å’Œå·¦ç§»å³ç§»æ˜¯ä¸ºäº†è®©å…¶æ›´åŠ æ··ä¹±ï¼Œæ²¡æœ‰è§„å¾‹å¯è¨€</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></div></figure><p>ä¸Šé¢çš„ä¾‹å­ä¸æ˜¯å¾ˆå¥½ç†è§£ï¼Œè¿™é‡Œå†™ä¸€ä¸ªæ‰“å°stringçš„ä¾‹å­æ–¹ä¾¿åŠ æ·±ç†è§£ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StringPrint</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">myprint</span><span class="params">(<span class="type">const</span> string &amp;str)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        _myprint(str);</span><br><span class="line">        cout &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Types&gt;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">myprint</span><span class="params">(<span class="type">const</span> string &amp;str, <span class="type">const</span> Types &amp;...args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        _myprint(str, args...);</span><br><span class="line">        cout &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Types&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(<span class="type">const</span> Types &amp;...args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//å½“æˆ‘ä»¬æƒ³è¦çŸ¥é“åŒ…ä¸­æœ‰å¤šå°‘å…ƒç´ æ—¶ï¼Œå¯ä»¥ä½¿ç”¨sizeof...è¿ç®—ç¬¦ï¼Œè¯¥è¿ç®—ç¬¦è¿”å›ä¸€ä¸ªå¸¸é‡è¡¨è¾¾å¼ï¼Œå¹¶ä¸”ä¸ä¼šå¯¹å…¶å®å‚æ±‚å€¼</span></span><br><span class="line">        cout &lt;&lt; <span class="keyword">sizeof</span>...(Types) &lt;&lt; endl; <span class="comment">// ç±»å‹å‚æ•°æ•°ç›®</span></span><br><span class="line">        cout &lt;&lt; <span class="keyword">sizeof</span>...(args) &lt;&lt; endl;  <span class="comment">// å‡½æ•°å‚æ•°æ•°ç›®</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">inline</span> <span class="type">void</span> _myprint(<span class="type">const</span> string &amp;str)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¥å—å‚æ•°åŒ…ï¼Œå‚æ•°åŒ…æ˜¯å ä½ç¬¦çš„æ›¿æ¢</span></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Type, <span class="keyword">typename</span>... Types&gt;</span><br><span class="line">    <span class="keyword">inline</span> <span class="type">void</span> _myprint(<span class="type">const</span> string &amp;str, <span class="type">const</span> Type &amp;val, <span class="type">const</span> Types &amp;...args)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—ç¬¦çš„è¯»ï¼Œç›´åˆ°ç¢°åˆ°å ä½ç¬¦ %</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> iter = str.<span class="built_in">begin</span>(); iter != str.<span class="built_in">end</span>(); ++iter)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (*iter != <span class="string">&#x27;%&#x27;</span>)</span><br><span class="line">                cout &lt;&lt; *iter;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// æ˜¯å ä½ç¬¦</span></span><br><span class="line">                cout &lt;&lt; val;</span><br><span class="line">                string newstr = <span class="built_in">string</span>(++iter, str.<span class="built_in">end</span>());</span><br><span class="line">                _myprint(newstr, args...);<span class="comment">//åˆ›å»ºæ–°çš„å­—ç¬¦ä¸²å¹¶ä¸”ä¼ è¿›å»è¿›è¡Œé€’å½’ï¼Œæ³¨æ„ä¸è¦å¿˜äº† return é€’å½’å‡ºå£</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; myPrint;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    myPrint.<span class="built_in">myprint</span>(<span class="string">&quot;Hello , I&#x27;m % , % years old.&quot;</span>, <span class="string">&quot;David&quot;</span>, <span class="number">20</span>);</span><br><span class="line">    myPrint.<span class="built_in">foo</span>(<span class="string">&quot;Hello , I&#x27;m % , % years old.&quot;</span>, <span class="string">&quot;David&quot;</span>, <span class="number">20</span>);</span><br><span class="line">    myPrint.<span class="built_in">myprint</span>(<span class="string">&quot;fuck you!&quot;</span>);</span><br><span class="line">    myPrint.<span class="built_in">foo</span>(<span class="string">&quot;fuck you!&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h4 id="hashå‡½æ•°çš„ä¸‰ç§å½¢å¼"><a href="#hashå‡½æ•°çš„ä¸‰ç§å½¢å¼" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#hashå‡½æ•°çš„ä¸‰ç§å½¢å¼"></a> Hashå‡½æ•°çš„ä¸‰ç§å½¢å¼</h4><p>1.ä»¿å‡½æ•° functor</p><p>2.å‡½æ•°æŒ‡é’ˆ</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä»¿å‡½æ•°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomerHash</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> Customer &amp;c)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">HashFunction</span>().<span class="built_in">hash_val</span>(c.fname, c.lname, c.no);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line"><span class="function"><span class="type">size_t</span> <span class="title">customer_hash_func</span><span class="params">(<span class="type">const</span> Customer &amp;c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€ç§æ€è·¯å°±æ˜¯è¿™ä¸ªç±»é‡Œé¢ç®€å•ç±»å‹çš„hashcodeå…¨éƒ¨ç›¸åŠ </span></span><br><span class="line">    <span class="comment">// ä½†æ˜¯è¿™ä¹ˆåšçš„è¯è®¾è®¡è€…è®¤ä¸ºæ¯”è¾ƒå¤©çœŸï¼Œæ²¡åŠæ³•è¾¾åˆ°éå¸¸ä¹±çš„ç»“æ„</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">HashFunction</span>().<span class="built_in">hash_val</span>(c.fname, c.lname, c.no);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ³¨æ„åœ¨mainå‡½æ•°åˆ›å»ºçš„æ—¶å€™ä¼ å…¥å‚æ•°çš„æ—¶å€™éœ€è¦æ³¨æ„</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    unordered_set&lt;Customer, CustomerHash&gt; custset;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> function_pointer = <span class="built_in">size_t</span> (*)(<span class="type">const</span> Customer &amp;); <span class="comment">// å®šä¹‰å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">    unordered_set&lt;Customer, function_pointer&gt; custset2; <span class="comment">//ä¼ å…¥çš„æ˜¯å‡½æ•°æŒ‡é’ˆçš„å½¢å¼!!!</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>3.ç‰¹åŒ–çš„ç‰ˆæœ¬</p><p>å¯¹äº unorder_set or unorder_mapï¼Œå¦‚æœä¸ç»™hashå‡½æ•°ï¼Œé‚£ä¹ˆé»˜è®¤ä¼šä½¿ç”¨ç³»ç»Ÿçš„ hash&lt;value_type&gt;ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥é€šè¿‡è¿™ä¸ªå¯¹å…¶è¿›è¡Œç‰¹åŒ–å¤„ç†</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ”¾åœ¨stdå†…è¡¨ç¤ºåœ¨æ ‡å‡†åº“stdé‡Œé¢è¿›è¡Œæ“ä½œä¿®æ”¹</span></span><br><span class="line"><span class="keyword">namespace</span> std</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">template</span> &lt;&gt;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">hash</span>&lt;Customer&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> Customer &amp;c)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">HashFunction</span>().<span class="built_in">hash_val</span>(c.fname, c.lname, c.no);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>å¯ä»¥åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­å¯¹stdé‡Œé¢çš„ç³»ç»Ÿæä¾›çš„hashå‡½æ•°è¿›è¡Œç‰¹åŒ–ç‰ˆæœ¬çš„å¤„ç†æ¥å®ç°</p><h3 id="tuple"><a href="#tuple" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#tuple"></a> tuple</h3><p>tupleæ˜¯c++11æ–°å¼•å…¥çš„ä¸€ä¸ªå¥½ä¸œè¥¿ï¼Œä»–å¯ä»¥ä¼ å…¥ä¸€ä¸ªå‚æ•°åŒ…ï¼Œå‚æ•°åŒ…é‡Œé¢å¯ä»¥æ”¾å…¥ä»»æ„å¤§å°ï¼Œä»»æ„ç±»å‹</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230427111200767.png" alt="image-20230427111200767"></p><p>ç¤ºä¾‹ä»£ç :</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tuple&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;complex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;typeinfo&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;29_tuple_print.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;string,sizeof = &quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(string) &lt;&lt; endl;                   <span class="comment">// 32</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;double,sizeof = &quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(<span class="type">double</span>) &lt;&lt; endl;                   <span class="comment">// 8</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;float,sizeof = &quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(<span class="type">float</span>) &lt;&lt; endl;                     <span class="comment">// 4</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;int,sizeof = &quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(<span class="type">int</span>) &lt;&lt; endl;                         <span class="comment">// 4</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;complex&lt;double&gt;,sizeof = &quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(complex&lt;<span class="type">double</span>&gt;) &lt;&lt; endl; <span class="comment">// 16</span></span><br><span class="line"></span><br><span class="line">    tuple&lt;string, <span class="type">int</span>, <span class="type">int</span>, complex&lt;<span class="type">double</span>&gt;&gt; t;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;tuple&lt;string,int,int,complex&lt;double&gt;,sizeof = &quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(t) &lt;&lt; endl; <span class="comment">// 56</span></span><br><span class="line"></span><br><span class="line">    <span class="function">tuple&lt;<span class="type">int</span>, <span class="type">float</span>, string&gt; <span class="title">t1</span><span class="params">(<span class="number">41</span>, <span class="number">6.3</span>, <span class="string">&quot;nico&quot;</span>)</span></span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;tuple&lt;int,float,string&gt;,sizeof = &quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(t1) &lt;&lt; endl;              <span class="comment">// 40</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;t1: &quot;</span> &lt;&lt; <span class="built_in">get</span>&lt;<span class="number">0</span>&gt;(t1) &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; <span class="built_in">get</span>&lt;<span class="number">1</span>&gt;(t1) &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; <span class="built_in">get</span>&lt;<span class="number">2</span>&gt;(t1) &lt;&lt; endl; <span class="comment">// å–å‡ºå…¶ä¸­çš„å…ƒç´ ç”¨æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> t2 = <span class="built_in">make_tuple</span>(<span class="number">22</span>, <span class="number">44.0</span>, <span class="string">&quot;stacy&quot;</span>);</span><br><span class="line">    <span class="built_in">get</span>&lt;<span class="number">1</span>&gt;(t1) = <span class="built_in">get</span>&lt;<span class="number">1</span>&gt;(t2);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;t1: &quot;</span> &lt;&lt; <span class="built_in">get</span>&lt;<span class="number">0</span>&gt;(t1) &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; <span class="built_in">get</span>&lt;<span class="number">1</span>&gt;(t1) &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; <span class="built_in">get</span>&lt;<span class="number">2</span>&gt;(t1) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;t2: &quot;</span> &lt;&lt; <span class="built_in">get</span>&lt;<span class="number">0</span>&gt;(t2) &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; <span class="built_in">get</span>&lt;<span class="number">1</span>&gt;(t2) &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; <span class="built_in">get</span>&lt;<span class="number">2</span>&gt;(t2) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¯”è¾ƒå¤§å°</span></span><br><span class="line">    <span class="keyword">if</span> (t1 &lt; t2)</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;t1 &lt; t2&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (t1 &gt; t2)</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;t1 &gt; t2&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;t1 == t2&quot;</span> &lt;&lt; endl;</span><br><span class="line">    t1 = t2; <span class="comment">// èµ‹å€¼æ“ä½œ</span></span><br><span class="line">    cout &lt;&lt; t2 &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> tuple&lt;<span class="type">int</span>, <span class="type">float</span>, string&gt; TupleType;</span><br><span class="line">    cout &lt;&lt; tuple_size&lt;TupleType&gt;::value &lt;&lt; endl; <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> tuple_element&lt;<span class="number">1</span>, TupleType&gt;::type Type1; <span class="comment">// float</span></span><br><span class="line">    cout &lt;&lt; <span class="built_in">typeid</span>(Type1).<span class="built_in">name</span>() &lt;&lt; endl;            <span class="comment">// f</span></span><br><span class="line"></span><br><span class="line">    <span class="function">tuple&lt;<span class="type">int</span>, <span class="type">float</span>, string&gt; <span class="title">t3</span><span class="params">(<span class="number">77</span>, <span class="number">1.1</span>, <span class="string">&quot;more light&quot;</span>)</span></span>;</span><br><span class="line">    <span class="type">int</span> i1;</span><br><span class="line">    <span class="type">float</span> f1;</span><br><span class="line">    string s1;</span><br><span class="line">    <span class="built_in">tie</span>(i1, f1, s1) = t3; <span class="comment">// å°†è¿™t3çš„ä¸‰ä¸ªå±æ€§ç»‘å®šåˆ°è¿™ä¸‰ä¸ªå˜é‡ä¸Šé¢</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;i1 = &quot;</span> &lt;&lt; i1 &lt;&lt; <span class="string">&quot; f1 = &quot;</span> &lt;&lt; f1 &lt;&lt; <span class="string">&quot; s1= &quot;</span> &lt;&lt; s1 &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">test</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p><strong>è¿™é‡Œé¢å°±æœ‰å­¦é—®äº†ï¼Œé‡è½½ è¿™ä¸ªå‚æ•°åŒ…çš„ å·¦ç§»è¿ç®—ç¬¦(ä»£ç å»ºè®®é‡å¤çœ‹!!!)</strong></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __TUPLEPRINT__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __TUPLEPRINT__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// get&lt;&gt; å°–æ‹¬å·é‡Œé¢ä¸èƒ½æ”¾å…¥å˜é‡ï¼Œåªèƒ½æ”¾å…¥ä¸€ä¸ªå¸¸é‡!!!!</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Tuple, <span class="type">size_t</span> N&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">tuple_print</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">static</span> <span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">const</span> Tuple &amp;t, ostream &amp;out)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        tuple_print&lt;Tuple, N - <span class="number">1</span>&gt;::<span class="built_in">print</span>(t, out);</span><br><span class="line">        out &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; <span class="built_in">get</span>&lt;N - <span class="number">1</span>&gt;(t);</span><br><span class="line">        <span class="comment">// ä¸ºä»€ä¹ˆè¦åç€å†™ï¼Ÿ</span></span><br><span class="line">        <span class="comment">// å› ä¸ºé€’å½’å‡ºæ¥æ‰“å°çš„é¡ºåºæ˜¯ä»0 åˆ° n-1!!!!</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€’å½’å‡ºå£</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Tuple&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">tuple_print</span>&lt;Tuple, <span class="number">1</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">static</span> <span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">const</span> Tuple &amp;t, ostream &amp;out)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        out &lt;&lt; <span class="built_in">get</span>&lt;<span class="number">0</span>&gt;(t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡è½½ å·¦ç§»è¿ç®—ç¬¦</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tuple&gt;</span></span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Types&gt;</span><br><span class="line"><span class="keyword">inline</span> ostream &amp;</span><br><span class="line"><span class="keyword">operator</span>&lt;&lt;(ostream &amp;out, <span class="type">const</span> tuple&lt;Types...&gt; &amp;t)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// decltype å¯ä»¥å¾—å‡ºå˜é‡çš„ç±»å‹</span></span><br><span class="line">    <span class="comment">// æ¨¡æ¿å‚æ•°é‡Œé¢å¯ä»¥æ”¾å…¥ä¸€ä¸ªå¸¸é‡ï¼Œæ ¹æ®å¸¸é‡ä¸åŒçš„å¤§å°å¯ä»¥è°ƒç”¨ä¸åŒçš„é‡è½½æˆ–è€…ç‰¹åŒ–ç‰ˆæœ¬</span></span><br><span class="line">    tuple_print&lt;<span class="keyword">decltype</span>(t), <span class="keyword">sizeof</span>...(Types)&gt;::<span class="built_in">print</span>(t, out);</span><br><span class="line">    <span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></div></figure><p>é‚£ä¹ˆè¿™ä¸ªè¿™ä¹ˆå¥½ç”¨çš„tupleæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230427112849536.png" alt="image-20230427112849536"></p><p><strong>ä»–çš„å¤§æ¦‚æ„æ€å°±æ˜¯æ¥å—å‚æ•°åŒ…ï¼Œç„¶åå°†å‚æ•°åŒ…åˆ†ä¸º1å’Œn-1ï¼Œæœ¬ç±»ç»§æ‰¿ä¸Šä¸€çº§(n-1)çš„ç±»ï¼Œä»¥æ­¤å¾€ä¸Šç»§æ‰¿ï¼›ç”±äºæœ¬ç±»å½“ä¸­çš„æˆå‘˜æ˜¯headï¼Œå°±æ˜¯è¿™ä¸ª1å¯¹åº”çš„å…ƒç´ ï¼Œæ‰€ä»¥ç»§æ‰¿è¿‡åæœ¬ç±»ä¼šè·å¾—æ‰€æœ‰çš„å…ƒç´ ï¼Œå¯ä»¥é€šè¿‡headå’Œtailæ¥å£è¿›è¡Œè°ƒç”¨!!!</strong></p><p>æ³¨æ„å›¾ä¸­å³ä¸Šè§’çš„ç»§æ‰¿å…³ç³»!!!</p><p>tupleé‡Œé¢æœ‰ä¸¤ä¸ªheadå’Œtailå‡½æ•°ï¼Œè¿™ä¸¤ä¸ªåœ¨ç°åœ¨çš„c++é‡Œé¢ä¸å¤ªå¥½ç”¨ï¼Œå› ä¸ºæ–°åŠ äº†å¾ˆå¤šä¸œè¥¿ï¼Œæ¥å£ä¹Ÿå˜äº†ï¼Œæ‰€ä»¥å°±ä¸ç”¨äº†</p><h1 id="c-20-æ–°ç‰¹æ€§"><a href="#c-20-æ–°ç‰¹æ€§" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#c-20-æ–°ç‰¹æ€§"></a> C++ 2.0 æ–°ç‰¹æ€§</h1><h2 id="ç¬¬ä¸€è®²è¯­è¨€"><a href="#ç¬¬ä¸€è®²è¯­è¨€" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¬¬ä¸€è®²è¯­è¨€"></a> ç¬¬ä¸€è®²ï¼šè¯­è¨€</h2><h3 id="variatic-templates-å‚æ•°åŒ…"><a href="#variatic-templates-å‚æ•°åŒ…" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#variatic-templates-å‚æ•°åŒ…"></a> variatic templates å‚æ•°åŒ…</h3><p><strong>åœ¨ç±»æ¨¡æ¿ä¸­ï¼Œæ¨¡æ¿å‚æ•°åŒ…å¿…é¡»æ˜¯æœ€åä¸€ä¸ªæ¨¡æ¿å½¢å‚. è€Œåœ¨å‡½æ•°æ¨¡æ¿ä¸­åˆ™ä¸å¿…!!!</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230427170952730.png" alt="image-20230427170952730"></p><p>è¿™ä¸ªä¹‹å‰æè¿‡äº†ï¼Œå°±ä¸ç»†è°ˆäº†</p><p>ä¸‹é¢é‚£ä¸‰ä¸ªåˆ†åˆ«å¯¹åº”ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typename</span>... Types <span class="comment">//æ¨¡æ¿å‚æ•°åŒ…</span></span><br><span class="line"><span class="type">const</span> Types&amp;... args <span class="comment">//å‡½æ•°å‚æ•°ç±»å‹åŒ…</span></span><br><span class="line"><span class="built_in">print</span>(args...) <span class="comment">//å‡½æ•°å‚æ•°åŒ…</span></span><br></pre></td></tr></table></div></figure><p>åˆ©ç”¨å‚æ•°åŒ…ä¹Ÿå¯ä»¥å®ç°ä¸‡ç”¨çš„hashcodeçš„å®ç°: ä¹‹å‰å†™è¿‡å°±ä¸ç»†çœ‹äº†</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230427171431489.png" alt="image-20230427171431489"></p><h3 id="é›¶ç¢çŸ¥è¯†ç‚¹"><a href="#é›¶ç¢çŸ¥è¯†ç‚¹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#é›¶ç¢çŸ¥è¯†ç‚¹"></a> é›¶ç¢çŸ¥è¯†ç‚¹</h3><h4 id="nullptr"><a href="#nullptr" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#nullptr"></a> nullptr</h4><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">(<span class="type">int</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;call of int&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">(<span class="type">void</span> *)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;call of void*&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">f</span>(<span class="number">0</span>); <span class="comment">// calls f(int)</span></span><br><span class="line">    <span class="comment">// f(NULL);    // è¿™é‡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºNULLæ—¢å¯ä»¥æŒ‡æ˜¯int ä¹Ÿå¯ä»¥æ˜¯æŒ‡é’ˆ</span></span><br><span class="line">    <span class="built_in">f</span>(<span class="literal">nullptr</span>); <span class="comment">// calls f(void*)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h4 id="auto"><a href="#auto" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#auto"></a> auto</h4><p>æé†’ï¼šä¸è¦æœ‰äº†autoå°±ä»¥åéƒ½ä¸å†™ç±»å‹äº†ï¼Œèƒ½ä¸ç”¨å°±ä¸ç”¨ï¼Œé™¤éæ˜¯åœ¨ç±»å‹åå¤ªé•¿æˆ–è€…å¤ªå¤æ‚çš„ç±»å‹æ‰ç”¨ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¿ƒé‡Œéœ€è¦æ˜ç™½è¿™åˆ°åº•æ˜¯æ€ä¹ˆç±»å‹ï¼Œä¸è¦ç¼–è¯‘å™¨çŸ¥é“äº†æˆ‘ä»¬ä¸çŸ¥é“</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‡½æ•°çš„è¿”å›å€¼ä¹Ÿå¯ä»¥æ˜¯auto</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">Func</span><span class="params">(<span class="type">const</span> <span class="type">int</span> &amp;val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> val &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// æ³¨æ„å‡½æ•°æŒ‡é’ˆçš„å†™æ³•</span></span><br><span class="line">    <span class="keyword">auto</span> func = [](<span class="type">const</span> <span class="type">int</span> &amp;val) -&gt; <span class="type">bool</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> val &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">bool</span> (*func2)(<span class="type">const</span> <span class="type">int</span> &amp;val) = Func;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="built_in">func</span>(<span class="number">1</span>) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">func2</span>(<span class="number">-1</span>) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="initializer_list"><a href="#initializer_list" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#initializer_list"></a> initializer_list&lt;&gt;</h3><h4 id="uniform-initialization-ç»Ÿä¸€åˆå§‹åŒ–"><a href="#uniform-initialization-ç»Ÿä¸€åˆå§‹åŒ–" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#uniform-initialization-ç»Ÿä¸€åˆå§‹åŒ–"></a> uniform initialization ç»Ÿä¸€åˆå§‹åŒ–</h4><p>ä»»ä½•åˆå§‹åŒ–åŠ¨ä½œéƒ½å¯ä»¥ç”¨ä¸€ä¸ªå…±åŒè¯­æ³•ï¼š{ //å¡«å…¥å€¼ }</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> values[] &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line">vector&lt;string&gt;cities&#123;</span><br><span class="line"><span class="string">&quot;Berlin&quot;</span>,<span class="string">&quot;New York&quot;</span>,<span class="string">&quot;London&quot;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Container&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">const</span> Container &amp;con)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> val : con)</span><br><span class="line">        cout &lt;&lt; val &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; v&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">    vector&lt;string&gt; cities&#123;</span><br><span class="line">        <span class="string">&quot;Berlin&quot;</span>, <span class="string">&quot;New York&quot;</span>, <span class="string">&quot;London&quot;</span>&#125;;</span><br><span class="line">    <span class="built_in">print</span>(v);</span><br><span class="line">    <span class="built_in">print</span>(cities);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>åœ¨ç¼–è¯‘å™¨çœ‹åˆ° {} çš„æ—¶å€™ä¼šè‡ªåŠ¨åˆ›å»ºå‡ºæ¥ä¸€ä¸ª initializer_listï¼Œè¿™æ˜¯ä¸€ä¸ªç±»ï¼Œå…·ä½“ä»£ç å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_E</span>&gt;</span><br><span class="line"><span class="comment">// è¿™ä¸ªä¸œè¥¿èƒŒåæ˜¯ä¸€ä¸ª array ,ç¼–è¯‘å™¨åœ¨çœ‹è§å¤§æ‹¬å·çš„æ—¶å€™å°±ä¼šé¢„å…ˆå‡†å¤‡ä¸€ä¸ª array</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">initializer_list</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">typedef</span> _E value_type;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">const</span> _E &amp;reference;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">const</span> _E &amp;const_reference;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">size_t</span> size_type;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">const</span> _E *iterator;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">const</span> _E *const_iterator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    iterator _M_array;</span><br><span class="line">    size_type _M_len;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The compiler can call a private constructor.</span></span><br><span class="line">    <span class="comment">// ç¼–è¯‘å™¨åœ¨è¿™é‡Œèƒ½è°ƒç”¨ç§æœ‰çš„æ„é€ å‡½æ•°(ç¼–è¯‘å™¨å¯ä»¥ï¼Œæˆ‘ä»¬ä¸å¯ä»¥)</span></span><br><span class="line">    <span class="comment">// åˆ°è¿™é‡Œä¼šæŠŠarrayçš„å¤´æŒ‡é’ˆå’Œé•¿åº¦ä¼ é€’ç»™arrayå‚æ•°,æœ¬èº«å¹¶æ²¡æœ‰å†…å«array(æœ‰ç‚¹åƒå§”æ‰˜)</span></span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> <span class="title">initializer_list</span><span class="params">(const_iterator __a, size_type __l)</span></span></span><br><span class="line"><span class="function">        : _M_array(__a), _M_len(__l) &#123;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> <span class="title">initializer_list</span><span class="params">()</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function">        : _M_array(<span class="number">0</span>), _M_len(<span class="number">0</span>) &#123;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Number of elements.</span></span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> size_type</span></span><br><span class="line"><span class="function">    <span class="title">size</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> _M_len; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// First element.</span></span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> const_iterator</span></span><br><span class="line"><span class="function">    <span class="title">begin</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> _M_array; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// One past the last element.</span></span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> const_iterator</span></span><br><span class="line"><span class="function">    <span class="title">end</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">begin</span>() + <span class="built_in">size</span>(); &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><p><strong>å…³äºè¿™ä¸ªç±»çš„æ‹·è´æ„é€ ï¼Œå¯ä»¥çœ‹ç”±äºåœ¨ç±»é‡Œé¢æ²¡æœ‰å¯¹æ‹·è´æ„é€ çš„é‡å†™ï¼Œå¯¼è‡´ä¸¤ä¸ªinitializer_liståœ¨æ‹·è´çš„æ—¶å€™æ˜¯æµ…æ‹·è´ï¼Œä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘åŒä¸€å—å†…å­˜ç©ºé—´ï¼Œå¯èƒ½ä¼šå‡ºç°å±é™©ï¼Œè¿™ä¸ªéœ€è¦æ³¨æ„</strong></p><p>STLçš„å®¹å™¨æ˜¯å¦‚ä½•å¼•å…¥initializer_listçš„ï¼Ÿ</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230430111248498.png" alt="image-20230430111248498"></p><p>initializer_list&lt;&gt;é‡Œé¢å†…ç½®äº†ä¸€ä¸ªarrayæ•°ç»„çš„æŒ‡é’ˆå’Œè¿™ä¸ªæ•°ç»„çš„é•¿åº¦ï¼Œç¼–è¯‘å™¨ä¼šè¯»å–{}é‡Œé¢çš„å…ƒç´ æ¥è¿›è¡Œå®¹å™¨çš„æ’å…¥æ“ä½œä»¥å®ç°åˆå§‹åŒ–æ“ä½œ</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;initializer_list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Algorithm</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// ä¼ å…¥çš„æ˜¯ä¸€ä¸ªinitializer_list&lt;&gt;</span></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Value_Type&gt;</span><br><span class="line">    <span class="keyword">inline</span> Value_Type</span><br><span class="line">    _min(<span class="type">const</span> initializer_list&lt;Value_Type&gt; &amp;init_list)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Min</span>(init_list.<span class="built_in">begin</span>(), init_list.<span class="built_in">end</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Value_Type&gt;</span><br><span class="line">    <span class="keyword">inline</span> Value_Type</span><br><span class="line">    _max(<span class="type">const</span> initializer_list&lt;Value_Type&gt; &amp;init_list)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Max</span>(init_list.<span class="built_in">begin</span>(), init_list.<span class="built_in">end</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Input_Iterator&gt;</span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">typename</span> iterator_traits&lt;Input_Iterator&gt;::<span class="function">value_type</span></span><br><span class="line"><span class="function">    <span class="title">Min</span><span class="params">(Input_Iterator first, Input_Iterator last)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> Min = *first;</span><br><span class="line">        <span class="keyword">for</span> (; first != last; ++first)</span><br><span class="line">            Min = Min &lt;= *first ? Min : *first;</span><br><span class="line">        <span class="keyword">return</span> Min;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Input_Iterator&gt;</span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">typename</span> iterator_traits&lt;Input_Iterator&gt;::<span class="function">value_type</span></span><br><span class="line"><span class="function">    <span class="title">Max</span><span class="params">(Input_Iterator first, Input_Iterator last)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> Max = *first;</span><br><span class="line">        <span class="keyword">for</span> (; first != last; ++first)</span><br><span class="line">            Max = Max &gt;= *first ? Max : *first;</span><br><span class="line">        <span class="keyword">return</span> Max;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Container&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">const</span> Container &amp;con)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> val : con)</span><br><span class="line">        cout &lt;&lt; val &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; v1&#123;<span class="number">2</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">69</span>, <span class="number">83</span>, <span class="number">50</span>&#125;;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">v2</span><span class="params">(&#123;<span class="number">2</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">69</span>, <span class="number">83</span>, <span class="number">50</span>&#125;)</span></span>;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; v3;</span><br><span class="line">    v3 = &#123;<span class="number">2</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">69</span>, <span class="number">83</span>, <span class="number">50</span>&#125;;</span><br><span class="line">    v<span class="number">3.</span><span class="built_in">insert</span>(v<span class="number">3.</span><span class="built_in">begin</span>() + <span class="number">2</span>, &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;);</span><br><span class="line">    <span class="built_in">print</span>(v3);</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="built_in">Algorithm</span>()._max(&#123;<span class="number">54</span>, <span class="number">16</span>, <span class="number">48</span>, <span class="number">5</span>&#125;) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">Algorithm</span>()._min(&#123;<span class="built_in">string</span>(<span class="string">&quot;Ace&quot;</span>), <span class="built_in">string</span>(<span class="string">&quot;Hello&quot;</span>), <span class="built_in">string</span>(<span class="string">&quot;Fuck&quot;</span>), <span class="built_in">string</span>(<span class="string">&quot;Zion&quot;</span>)&#125;) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="explicit-2"><a href="#explicit-2" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#explicit-2"></a> explicit</h3><p><strong>explicit for ctor taking one argument</strong></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Complex</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> real, imag;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Complex</span><span class="params">(<span class="type">int</span> re, <span class="type">int</span> im = <span class="number">0</span>)</span> : real(re), imag(im) &#123;</span>&#125;</span><br><span class="line">    <span class="comment">//explictå…³é”®å­—çš„å«ä¹‰ é˜²æ­¢ç±»æ„é€ å‡½æ•°çš„éšå¼è‡ªåŠ¨è½¬æ¢</span></span><br><span class="line">    <span class="comment">//å°±æ˜¯è¯´è¿™é‡Œç”±äºåªéœ€è¦ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨å¾ˆå¯èƒ½ä¼šæŠŠæ•°å­—éšå¼è½¬åŒ–ä¸ºComplexå¯¹è±¡</span></span><br><span class="line">    <span class="comment">//ä½†æ˜¯åŠ ä¸Šäº†explictä¹‹å,æ˜ç¡®æŒ‡å‡ºä¸è¦è®©ç¼–è¯‘å™¨è¿™ä¹ˆå¹²ï¼Œè¦ç”ŸæˆComplexå¯¹è±¡åªèƒ½æ˜¾å¼è°ƒç”¨æ„é€ å‡½æ•°!!!!</span></span><br><span class="line"></span><br><span class="line">    Complex <span class="keyword">operator</span>+(<span class="type">const</span> Complex &amp;x)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Complex</span>(real + x.real, imag + x.imag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> ostream &amp;</span><br><span class="line"><span class="keyword">operator</span>&lt;&lt;(ostream &amp;os, <span class="type">const</span> Complex &amp;x)</span><br><span class="line">&#123;</span><br><span class="line">    os &lt;&lt; <span class="string">&#x27;(&#x27;</span> &lt;&lt; x.real &lt;&lt; <span class="string">&#x27;,&#x27;</span> &lt;&lt; x.imag &lt;&lt; <span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> os;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">Complex <span class="title">c1</span><span class="params">(<span class="number">12</span>, <span class="number">5</span>)</span></span>;</span><br><span class="line">    <span class="comment">// Complex c2 = c1 + 5; // åŠ äº†explicitå…³é”®å­—å°±ä¸å…è®¸ç¼–è¯‘å™¨ç›´æ¥æŠŠ5è½¬åŒ–ä¸º Complex ç±»å‹äº†</span></span><br><span class="line">    cout &lt;&lt; c1 &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è¿™æ˜¯ä¸€ä¸ªå®å‚åŠ ä¸Š explicit å…³é”®å­—çš„æƒ…å†µï¼Œå‰é¢å·²ç»æè¿‡å¾ˆå¤šäº†</p><p><strong>explicit for ctors taking more than one argument</strong></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;initializer_list&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">P</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">P</span>(<span class="type">int</span> a, <span class="type">int</span> b) &#123; cout &lt;&lt; <span class="string">&quot;P (int a , int b) &quot;</span> &lt;&lt; endl; &#125;</span><br><span class="line">    <span class="comment">// P(initializer_list&lt;int&gt;) &#123; cout &lt;&lt; &quot;P (initializer_list&lt;int&gt;) &quot; &lt;&lt; endl; &#125;</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">P</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c)</span> </span>&#123; cout &lt;&lt; <span class="string">&quot;explicit P (int a , int b , int c) &quot;</span> &lt;&lt; endl; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">P <span class="title">p1</span><span class="params">(<span class="number">77</span>, <span class="number">5</span>)</span></span>;</span><br><span class="line">    P p2&#123;<span class="number">77</span>, <span class="number">5</span>&#125;;</span><br><span class="line">    P p3 = &#123;<span class="number">77</span>, <span class="number">5</span>&#125;;</span><br><span class="line"></span><br><span class="line">    P p4&#123;<span class="number">77</span>, <span class="number">5</span>, <span class="number">42</span>&#125;;</span><br><span class="line">    <span class="comment">// è¿™ä¸ªæ˜¯å¯ä»¥çš„,å› ä¸ºå®ƒæ—¢å¯ä»¥çœ‹ä½œä¼ å…¥äº†ä¸‰ä¸ªå‚æ•°ï¼Œä¹Ÿå¯ä»¥çœ‹ä½œä¼ å…¥äº†åˆå§‹åŒ–åºåˆ—</span></span><br><span class="line">    <span class="comment">// è€Œå¦‚æœåƒä¸‹é¢ä¸€æ ·åŠ ä¸Šæ‹¬å·å¹¶ä¸”æœ‰ explicit å…³é”®å­—å°±åªèƒ½ä¼ å…¥ ä¸‰ä¸ªå‚æ•°çš„å½¢å¼</span></span><br><span class="line"></span><br><span class="line">    <span class="function">P <span class="title">p5</span><span class="params">(&#123;<span class="number">77</span>, <span class="number">5</span>, <span class="number">42</span>&#125;)</span></span>; </span><br><span class="line">    <span class="comment">// è¿™ä¸ªåœ¨æœ‰ explicit å…³é”®å­—çš„æƒ…å†µä¸‹æ²¡æœ‰åŠæ³•æŠŠ initializer_list çš„å½¢å¼è½¬åŒ–ä¸º a,b,c çš„å½¢å¼ï¼Œä¼šæŠ¥é”™</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="deletedefault"><a href="#deletedefault" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#deletedefault"></a> =delete,=default</h3><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœå·²ç»å®šä¹‰äº†ä¸€ä¸ªctorï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°±ä¸ä¼šç»™ä¸€ä¸ªé»˜è®¤çš„ctor</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Zoo</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Zoo</span>(<span class="type">int</span> i1, <span class="type">int</span> i2) : <span class="built_in">d1</span>(i1), <span class="built_in">d2</span>(i2) &#123;&#125;</span><br><span class="line">    <span class="built_in">Zoo</span>(<span class="type">const</span> Zoo &amp;) = <span class="keyword">delete</span>; <span class="comment">// deleteè¡¨ç¤ºæˆ‘ä¸è¦è¿™ä¸€ä¸ªé‡è½½</span></span><br><span class="line">    <span class="built_in">Zoo</span>(Zoo &amp;&amp;) = <span class="keyword">default</span>;     <span class="comment">// defaultè¡¨ç¤ºæˆ‘éœ€è¦è¿™ä¸€ä¸ªé‡è½½å¹¶ä¸”æ˜¯ç¼–è¯‘å™¨é»˜è®¤æä¾›ç»™æˆ‘çš„è¿™ä¸ªé‡è½½</span></span><br><span class="line">    Zoo &amp;<span class="keyword">operator</span>=(<span class="type">const</span> Zoo &amp;) = <span class="keyword">default</span>;</span><br><span class="line">    Zoo &amp;<span class="keyword">operator</span>=(<span class="type">const</span> Zoo &amp;&amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Zoo</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> d1, d2;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">Zoo <span class="title">z1</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line">    <span class="comment">// Zoo z2(z1); // æ— æ³•ä½¿ç”¨å› ä¸ºä»–æ˜¯å·²åˆ é™¤çš„å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>ä¸€èˆ¬æ˜¯åº”ç”¨åœ¨ Big 3 ä¸Šé¢ï¼Œå³ æ„é€ å‡½æ•°ï¼Œæ‹·è´æ„é€ ï¼Œæ‹·è´èµ‹å€¼å’Œææ„å‡½æ•°</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230504191205113.png" alt="image-20230504191205113"></p><p>å…¶ä¸­å‡ºç°äº†å³å€¼å¼•ç”¨ï¼Œè¿™ä¸ªç›®å‰ä¸äº†è§£</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Zoo</span>(<span class="type">const</span> Zoo&amp;)=<span class="keyword">delete</span>;<span class="comment">// copy ctor</span></span><br><span class="line"><span class="built_in">Zoo</span>(Zoo&amp;&amp;)=<span class="keyword">default</span>;<span class="comment">// move ctor</span></span><br></pre></td></tr></table></div></figure><p>ä¸€ä¸ªæ›´ç»†çš„ä¾‹å­ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230504191639232.png" alt="image-20230504191639232"></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// ctor</span></span><br><span class="line">    <span class="built_in">Foo</span>(<span class="type">int</span> i) : _i(i) &#123;&#125;</span><br><span class="line">    <span class="built_in">Foo</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// copy ctor</span></span><br><span class="line">    <span class="built_in">Foo</span>(<span class="type">const</span> Foo &amp;x) : _i(x._i) &#123;&#125;</span><br><span class="line">    <span class="comment">// Foo(const Foo &amp;) = default; // error éƒ½å·²ç»å®šä¹‰å‡ºæ¥äº†è¿˜è¦é»˜è®¤çš„ï¼Œä¸è¡Œ</span></span><br><span class="line">    <span class="comment">// Foo(const Foo &amp;) = delete;  // error éƒ½å·²ç»å®šä¹‰å‡ºæ¥åˆä¸è¦äº†ï¼Œä¸è¡Œ</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// copy assign</span></span><br><span class="line">    Foo &amp;<span class="keyword">operator</span>=(<span class="type">const</span> Foo &amp;x)</span><br><span class="line">    &#123;</span><br><span class="line">        _i = x._i;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Foo &amp;operator=(const Foo &amp;x) = default; // error éƒ½å·²ç»å®šä¹‰å‡ºæ¥äº†è¿˜è¦é»˜è®¤çš„ï¼Œä¸è¡Œ</span></span><br><span class="line">    <span class="comment">// Foo &amp;operator=(const Foo &amp;x) = delete;  // error éƒ½å·²ç»å®šä¹‰å‡ºæ¥åˆä¸è¦äº†ï¼Œä¸è¡Œ</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// void func1() = default; // error ä¸€èˆ¬çš„å‡½æ•°æ²¡æœ‰é»˜è®¤ç‰ˆæœ¬ï¼Œåªèƒ½ç”¨äº big fiveä¸Šé¢</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">func2</span><span class="params">()</span> </span>= <span class="keyword">delete</span>; <span class="comment">// deleteå¯ä»¥ç”¨åœ¨ä»»ä½•å‡½æ•°ä¸Šé¢(=0 åªèƒ½ç”¨äº virtual å‡½æ•°)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ~Foo() = delete;//error ä¸èƒ½åˆ é™¤ææ„å‡½æ•°ï¼Œè¿™ä¼šå¯¼è‡´ä½¿ç”¨Fooå¯¹è±¡é”™è¯¯!!!!</span></span><br><span class="line">    ~<span class="built_in">Foo</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> _i;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Foo f1; <span class="comment">// å¦‚æœä¸å†™ Foo() = default ç¼–è¯‘å™¨ä¸ä¼šæä¾›é»˜è®¤æ„é€ å‡½æ•°ï¼Œä¼šæŠ¥é”™</span></span><br><span class="line">    <span class="function">Foo <span class="title">f2</span><span class="params">(<span class="number">5</span>)</span></span>;</span><br><span class="line">    <span class="function">Foo <span class="title">f3</span><span class="params">(f1)</span></span>;</span><br><span class="line">    f3 = f2;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>å¯¹äºä¸€ä¸ªç©ºçš„ç±»ï¼Œç¼–è¯‘å™¨åœ¨å¤„ç†çš„æ—¶å€™ä¼šæä¾›é»˜è®¤çš„big 3ï¼Œå³ æ„é€ å‡½æ•°ï¼Œæ‹·è´æ„é€ ï¼Œæ‹·è´èµ‹å€¼ï¼Œææ„å‡½æ•°</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Empty</span>&#123; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç©ºçš„ï¼Œä½†æ˜¯ç¼–è¯‘å™¨ä¼šæä¾›</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Empty</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//ctor</span></span><br><span class="line">    <span class="built_in">Empty</span>()&#123; ... &#125;</span><br><span class="line">    <span class="comment">//copy ctor</span></span><br><span class="line">    <span class="built_in">Empty</span>(<span class="type">const</span> Empty&amp; rhs)&#123; ... &#125;</span><br><span class="line">    <span class="comment">//copy assign</span></span><br><span class="line">    Empty&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Empty&amp; rhs)&#123; ... &#125;</span><br><span class="line">    <span class="comment">//dctor</span></span><br><span class="line">    ~<span class="built_in">Empty</span>()&#123; ... &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä»£ç å¯¹äºä¸€ä¸ªç©ºç±»æ˜¯åˆæ³•çš„</span></span><br><span class="line">&#123;</span><br><span class="line">    Empty e1;</span><br><span class="line">    <span class="function">Empty <span class="title">e2</span><span class="params">(e1)</span></span>;</span><br><span class="line">    e2=e1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆç¡®è®¤æ˜¯ç”¨é»˜è®¤çš„è¿˜æ˜¯è‡ªå·±å†™çš„å‘¢ï¼Ÿ</p><p>classes with or without pointer members!!!</p><p><strong>å¸¦æœ‰æŒ‡é’ˆçš„ç±»åŸºæœ¬ä¸Šéƒ½éœ€è¦é‡å†™ big 3ï¼›ä¸å¸¦æŒ‡é’ˆçš„åŸºæœ¬éƒ½ä¸éœ€è¦å†™!!!</strong></p><h4 id="no-copy-and-private-copy"><a href="#no-copy-and-private-copy" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#no-copy-and-private-copy"></a> No-Copy and Private-Copy</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230504201206953.png" alt="image-20230504201206953"></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Nocopy</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">Nocopy</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="built_in">Nocopy</span>(<span class="type">const</span> Nocopy &amp;) = <span class="keyword">delete</span>;            <span class="comment">// no copy</span></span><br><span class="line">    Nocopy &amp;<span class="keyword">operator</span>=(<span class="type">const</span> Nocopy &amp;) = <span class="keyword">delete</span>; <span class="comment">// no assign</span></span><br><span class="line">    ~<span class="built_in">Nocopy</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">NoDtor</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NoDtor</span>() = <span class="keyword">default</span>;</span><br><span class="line">    ~<span class="built_in">NoDtor</span>() = <span class="keyword">delete</span>; <span class="comment">// éå¸¸ä¸å»ºè®®è¿™ä¹ˆå»åš</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">testNoDtor</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// NoDtor nd;//æ ˆåŒºå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸåœ¨è¿™ä¸ªå‡½æ•°ç»“æŸå°±é”€æ¯äº†ï¼Œè¿™æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨dtorï¼Œæ²¡æœ‰åˆ™æŠ¥é”™</span></span><br><span class="line">    NoDtor *p = <span class="keyword">new</span> NoDtor; <span class="comment">// åŠ¨æ€å¼€è¾Ÿæ˜¯å…è®¸çš„ï¼Œä½†æ˜¯æ— æ³•é”€æ¯</span></span><br><span class="line">    <span class="comment">// delete p;               // ä¸å…è®¸é”€æ¯</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PrivateCopy</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// è¿™ä¸ªç±»æ— æ³•è¢«ä¸€èˆ¬çš„ä»£ç è°ƒç”¨ï¼Œä½†æ˜¯å¯ä»¥è¢«friendå’Œmemberè°ƒç”¨copy</span></span><br><span class="line">    <span class="comment">// å¦‚æœè¦ç¦æ­¢ï¼Œä¸ä»…éœ€è¦æ”¾åˆ°privateé‡Œé¢ï¼Œè¿˜è¦åŠ ä¸Š = delete</span></span><br><span class="line">    <span class="built_in">PrivateCopy</span>(<span class="type">const</span> PrivateCopy &amp;);</span><br><span class="line">    PrivateCopy &amp;<span class="keyword">operator</span>=(<span class="type">const</span> PrivateCopy &amp;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">PrivateCopy</span>() = <span class="keyword">default</span>;</span><br><span class="line">    ~<span class="built_in">PrivateCopy</span>();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">testNoDtor</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="aliasåŒ–å-template-template-typedef-æ¨¡æ¿çš„åŒ–å"><a href="#aliasåŒ–å-template-template-typedef-æ¨¡æ¿çš„åŒ–å" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#aliasåŒ–å-template-template-typedef-æ¨¡æ¿çš„åŒ–å"></a> Alias(åŒ–å) Template (template typedef) æ¨¡æ¿çš„åŒ–å</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230504202940442.png" alt="image-20230504202940442"></p><p><strong>å€¼å¾—æ³¨æ„çš„æ˜¯ä¸‹é¢ä¸¤ä¸ªæ²¡åŠæ³•å®ç°æˆ‘ä»¬æƒ³è¦çš„ç»“æœ!!!</strong></p><h4 id="test_moveableå‡½æ•°æµ‹è¯•"><a href="#test_moveableå‡½æ•°æµ‹è¯•" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#test_moveableå‡½æ•°æµ‹è¯•"></a> test_moveableå‡½æ•°æµ‹è¯•</h4><p>è¿™ä¹ˆå†™å§‹ç»ˆä¼šæŠ¥é”™ï¼Œçœ‹èµ·æ¥æ˜¯æ²¡æœ‰åŠæ³•æŠŠå®¹å™¨å’Œå®¹å™¨æ¨¡æ¿çš„ç±»å‹åˆ†å¼€æ¥è¿›è¡Œä¼ å…¥çš„</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230504213412890.png" alt="image-20230504213412890"></p><p>æ‰€ä»¥å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230504213510643.png" alt="image-20230504213510643"></p><h3 id="template-template-parameter-åŒé‡æ¨¡æ¿å‚æ•°"><a href="#template-template-parameter-åŒé‡æ¨¡æ¿å‚æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#template-template-parameter-åŒé‡æ¨¡æ¿å‚æ•°"></a> template template parameter åŒé‡æ¨¡æ¿å‚æ•°</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230505102818021.png" alt="image-20230505102818021"></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SIZE 1e6</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;deque&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Type&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">output_static_data</span><span class="params">(<span class="type">const</span> Type &amp;obj)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;static_data: &quot;</span> &lt;&lt; endl; <span class="comment">// è¾“å‡ºé™æ€æˆå‘˜</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// template template paremeter åŒé‡æ¨¡æ¿å‚æ•°</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Value_Type</span>,</span><br><span class="line">          <span class="keyword">template</span> &lt;<span class="keyword">class</span>&gt; <span class="comment">// è¿™æ ·å†™è¡¨ç¤º Containeræ¨¡æ¿ä½¿ç”¨ Value_Type ç±»å‹</span></span><br><span class="line">          <span class="keyword">class</span> <span class="title class_">Container</span>&gt;</span><br><span class="line"><span class="comment">// è¿™é‡Œç”±äºä¼ å…¥çš„æ˜¯å®¹å™¨ï¼Œç»å¤§å¤šæ•°çš„å®¹å™¨éƒ½æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å…ƒç´ ç±»å‹ï¼Œç¬¬äºŒä¸ªæ˜¯åˆ†é…å™¨ï¼Œç„¶è€Œåˆ†é…å™¨åˆæ˜¯ä»¥å…ƒç´ ç±»å‹çš„æ¨¡æ¿</span></span><br><span class="line"><span class="comment">// ç¼–è¯‘å™¨æ— æ³•æ¨å¯¼ç¬¬äºŒä¸ªåˆ†é…å™¨çš„å‚æ•°ï¼Œè™½ç„¶æœ‰é»˜è®¤å€¼ï¼Œæ‰€ä»¥å°±éœ€è¦ç”¨åˆ° Alias æ¥è®¾ç½®</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">XCls</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Container&lt;Value_Type&gt; c;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">XCls</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">long</span> i = <span class="number">0</span>; i &lt; SIZE; ++i)</span><br><span class="line">            c.<span class="built_in">insert</span>(c.<span class="built_in">end</span>(), <span class="built_in">Value_Type</span>());</span><br><span class="line"></span><br><span class="line">        <span class="built_in">output_static_data</span>(<span class="built_in">Value_Type</span>());</span><br><span class="line">        <span class="function">Container&lt;Value_Type&gt; <span class="title">c1</span><span class="params">(c)</span></span>;</span><br><span class="line">        <span class="function">Container&lt;Value_Type&gt; <span class="title">c2</span><span class="params">(std::move(c))</span></span>;</span><br><span class="line">        c<span class="number">1.</span><span class="built_in">swap</span>(c2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ext/pool_allocator.h&gt;</span></span></span><br><span class="line"><span class="keyword">namespace</span> Alias</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Value_Type&gt;</span><br><span class="line">    <span class="keyword">using</span> Vec = vector&lt;Value_Type, __gnu_cxx::__pool_alloc&lt;Value_Type&gt;&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Value_Type&gt;</span><br><span class="line">    <span class="keyword">using</span> Lst = list&lt;Value_Type, __gnu_cxx::__pool_alloc&lt;Value_Type&gt;&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Value_Type&gt;</span><br><span class="line">    <span class="keyword">using</span> Deq = deque&lt;Value_Type, __gnu_cxx::__pool_alloc&lt;Value_Type&gt;&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Alias;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    XCls&lt;string, Vec&gt; c;</span><br><span class="line">    XCls&lt;string, Lst&gt; c2;</span><br><span class="line">    XCls&lt;string, Deq&gt; c3;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="type-alias-ç±»å‹åŒ–å"><a href="#type-alias-ç±»å‹åŒ–å" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#type-alias-ç±»å‹åŒ–å"></a> type alias ç±»å‹åŒ–å</h3><p>type alias å’Œ typedef æ²¡æœ‰ä»»ä½•çš„ä¸åŒ</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// type alias å’Œ typedef æ²¡æœ‰ä»»ä½•çš„ä¸åŒ</span></span><br><span class="line"><span class="keyword">namespace</span> Test</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">test01</span><span class="params">(<span class="type">int</span>, <span class="type">int</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;test01&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Container</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">using</span> Value_Type = T;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">CharT</span>&gt;</span><br><span class="line">    <span class="keyword">using</span> mystring = std::basic_string&lt;CharT, std::char_traits&lt;CharT&gt;&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Container</span>&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">fn2</span><span class="params">(<span class="type">const</span> Container &amp;con)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">using</span> Value_Type = <span class="keyword">typename</span> iterator_traits&lt;<span class="keyword">typename</span> Container::iterator&gt;::value_type;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;fn2&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Test;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// funcç°åœ¨æŒ‡å‘å‚æ•°å¦‚ä¸‹çš„å‡½æ•°</span></span><br><span class="line">    <span class="keyword">using</span> func = <span class="built_in">void</span> (*)(<span class="type">int</span>, <span class="type">int</span>);</span><br><span class="line">    func f1 = test01;</span><br><span class="line">    <span class="built_in">f1</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    mystring&lt;<span class="type">char</span>&gt; str;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">fn2</span>(<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="noexcept-ä¿è¯ä¸ä¼šæŠ›å‡ºå¼‚å¸¸"><a href="#noexcept-ä¿è¯ä¸ä¼šæŠ›å‡ºå¼‚å¸¸" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#noexcept-ä¿è¯ä¸ä¼šæŠ›å‡ºå¼‚å¸¸"></a> noexcept ä¿è¯ä¸ä¼šæŠ›å‡ºå¼‚å¸¸</h3><p><strong>æˆ‘ä»¬å¿…é¡»é€šçŸ¥C++(ç‰¹åˆ«æ˜¯ std::vector)ï¼Œmove ctor å’Œ move assignment å’Œ dtorä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå‰ä¸¤ä¸ªéƒ½æ˜¯å³å€¼å¼•ç”¨</strong></p><p><strong>ä»¥vectorä¸ºä¾‹ï¼Œvectorå®¹å™¨åœ¨æ‰©å……ç©ºé—´çš„æ—¶å€™ï¼Œæ˜¯ä»¥2å€ç©ºé—´æ‰©å……ï¼Œéœ€è¦æ–°æ‰¾ä¸€å—å†…å­˜å°†å½“å‰çš„æ•°æ®ç§»åŠ¨åˆ°æ–°æ•°æ®å—ä¸­ï¼Œè¿™å°±éœ€è¦ç”¨åˆ° move ctorï¼Œå¹¶ä¸”å¦‚æœä¸æ˜¯noexceptï¼Œvectorä¸æ•¢è°ƒç”¨å®ƒï¼Œåªæœ‰æ˜¯noexceptçš„æ—¶å€™vectoræ‰ä¼šè°ƒç”¨å®ƒ</strong></p><p>æ³¨æ„ï¼šgrowable containersåªæœ‰ä¸¤ç§ï¼švectorå’Œdeque</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230505152557462.png" alt="image-20230505152557462"></p><p>è‡³äºmove ctorå’Œmove assignmentï¼Œåˆ°åé¢å†è¯´</p><h3 id="override-è¦†å†™-ç‰¹ç”¨äºè™šå‡½æ•°é‡å†™ä¸Šé¢"><a href="#override-è¦†å†™-ç‰¹ç”¨äºè™šå‡½æ•°é‡å†™ä¸Šé¢" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#override-è¦†å†™-ç‰¹ç”¨äºè™šå‡½æ•°é‡å†™ä¸Šé¢"></a> override è¦†å†™ ç‰¹ç”¨äºè™šå‡½æ•°é‡å†™ä¸Šé¢</h3><p><strong>è¿™ä¸ªéœ€è¦ä¿è¯å­ç±»å’Œçˆ¶ç±»è¿™ä¸ªè™šå‡½æ•°çš„åç§°ï¼Œè¿”å›å€¼ï¼Œå‚æ•°ç±»å‹ï¼Œä¸ªæ•°ï¼Œä½ç½®å®Œå…¨ç›¸åŒ!!!</strong></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Base</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">float</span>)</span> </span>&#123; cout &lt;&lt; <span class="string">&quot;Base func float&quot;</span> &lt;&lt; endl; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Derived1</span> : <span class="keyword">public</span> Base</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€ä¸ªæ˜¯å®šä¹‰äº†ä¸€ä¸ªæ–°çš„è™šå‡½æ•°,ä¸æ˜¯override</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">int</span>)</span> </span>&#123; cout &lt;&lt; <span class="string">&quot;Derived1 func int&quot;</span> &lt;&lt; endl; &#125;</span><br><span class="line">    <span class="comment">// ç¬¬äºŒä¸ªæ‰æ˜¯ä¸Šé¢çˆ¶ç±»çš„override</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">float</span>)</span> <span class="keyword">override</span> </span>&#123; cout &lt;&lt; <span class="string">&quot;Derived1 func float&quot;</span> &lt;&lt; endl; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Derived1</span>().<span class="built_in">func</span>(<span class="number">1.1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="final"><a href="#final" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#final"></a> final</h3><p>ç”¨æ¥ä¿®é¥°classè¡¨ç¤ºä¸å…è®¸ç±»ç»§æ‰¿è‡ªå·±ï¼›ç”¨æ¥ä¿®é¥°è™šå‡½æ•°virtualè¡¨ç¤ºä¸å…è®¸å­ç±»overrideè¿™ä¸ªå‡½æ•°</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Base1</span> <span class="keyword">final</span> <span class="comment">// finalè¡¨ç¤ºä¸å…è®¸æœ‰ç±»ç»§æ‰¿è‡ªå·±</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  error</span></span><br><span class="line"><span class="comment">// struct Derived1 : Base1</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">// &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Base2</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">f</span><span class="params">()</span> <span class="keyword">final</span></span>; <span class="comment">// finalè¡¨ç¤ºä¸å…è®¸å­ç±»è¦†å†™è¿™ä¸ªå‡½æ•°</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Derived2</span> : Base2</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// void f(); //error</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="decltype"><a href="#decltype" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#decltype"></a> decltype</h3><p>ç”¨æ¥å¾—åˆ°ä¸€ä¸ªè¡¨è¾¾å¼çš„ç±»å‹ï¼Œæœ‰ä¸‰å¤§åº”ç”¨:</p><p>1.declare return types</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Test &#123;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Value_Type1, <span class="keyword">typename</span> Value_Type2&gt;</span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">add</span><span class="params">(<span class="type">const</span> Value_Type1&amp; x, <span class="type">const</span> Value_Type2&amp; y)</span></span></span><br><span class="line"><span class="function">    -&gt; <span class="title">decltype</span><span class="params">(x + y)</span> </span>&#123;  <span class="comment">// ä¸å†™åœ¨å‰é¢æ˜¯å› ä¸ºç¼–è¯‘å™¨å…ˆåæ¬¡åºç¼–è¯‘ä¸è®¤è¯†x,yï¼Œæ‰€ä»¥æ”¾åœ¨åé¢ç”¨ -&gt; æ¥æŒ‡æ˜autoçš„ç±»å‹</span></span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line">&#125;  <span class="comment">// namespace Test</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Test;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">add</span>(<span class="number">1</span>, <span class="number">2</span>) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">add</span>(<span class="number">1.1</span>, <span class="number">2</span>) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="http://2.in">2.in</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> metaprogramming å…ƒç¼–ç¨‹ å°±æ˜¯ç”¨åœ¨æ³›å‹é‡Œé¢</p><p>3.lambdas</p><p>ä¸€ä¸ªåº”ç”¨ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Test &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Person</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="built_in">Person</span>(string firstname, string lastname)</span><br><span class="line">        : _firstname(firstname), _lastname(lastname) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    string _firstname;</span><br><span class="line">    string _lastname;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ostream&amp;</span><br><span class="line"><span class="keyword">operator</span>&lt;&lt;(ostream&amp; os, <span class="type">const</span> Person&amp; p) &#123;</span><br><span class="line">    os &lt;&lt; <span class="string">&#x27;(&#x27;</span> &lt;&lt; p._firstname &lt;&lt; <span class="string">&#x27;,&#x27;</span> &lt;&lt; p._lastname &lt;&lt; <span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> os;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> CmpPerson = [](<span class="type">const</span> Person&amp; p1, <span class="type">const</span> Person&amp; p2) &#123;</span><br><span class="line">    <span class="built_in">return</span> (p<span class="number">1.</span>_lastname &lt; p<span class="number">2.</span>_lastname) ||</span><br><span class="line">           (p<span class="number">1.</span>_lastname == p<span class="number">2.</span>_lastname) &amp;&amp; (p<span class="number">1.</span>_firstname &lt; p<span class="number">2.</span>_firstname);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Cmp</span></span><br><span class="line">    : binary_function&lt;Person, Person, <span class="type">bool</span>&gt; &#123;</span><br><span class="line">    <span class="comment">// è¢«æ¯”è¾ƒçš„ä¸èƒ½è¢«ä¿®æ”¹ï¼Œç¼–è¯‘å™¨éå¸¸çµæ•ï¼Œéœ€è¦åŠ ä¸Šconst</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> Person&amp; p1, <span class="type">const</span> Person&amp; p2)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (p<span class="number">1.</span>_lastname &lt; p<span class="number">2.</span>_lastname) ||</span><br><span class="line">               (p<span class="number">1.</span>_lastname == p<span class="number">2.</span>_lastname) &amp;&amp; (p<span class="number">1.</span>_firstname &lt; p<span class="number">2.</span>_firstname);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; cmps;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Container&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">const</span> Container&amp; con)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> val : con)</span><br><span class="line">        cout &lt;&lt; val &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;  <span class="comment">// namespace Test</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Test;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">Person <span class="title">p1</span><span class="params">(<span class="string">&quot;John&quot;</span>, <span class="string">&quot;Wall&quot;</span>)</span></span>;</span><br><span class="line">    <span class="function">Person <span class="title">p2</span><span class="params">(<span class="string">&quot;David&quot;</span>, <span class="string">&quot;Paul&quot;</span>)</span></span>;</span><br><span class="line">    <span class="function">Person <span class="title">p3</span><span class="params">(<span class="string">&quot;Steve&quot;</span>, <span class="string">&quot;Paul&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™é‡Œéœ€è¦å¦‚æœæ‹¬å·é‡Œä¸ç»™CmpPersonå‚æ•°ï¼Œä¼šè°ƒç”¨CmpPersonçš„é»˜è®¤æ„é€ å‡½æ•°ï¼Œä¸å¹¸çš„æ˜¯æ²¡æœ‰é»˜è®¤æ„é€ ï¼Œæ‰€ä»¥éœ€è¦ç»™å‡º</span></span><br><span class="line">    <span class="function">set&lt;Person, <span class="title">decltype</span><span class="params">(CmpPerson)</span>&gt; <span class="title">s</span><span class="params">(&#123;p1, p2, p3&#125;, CmpPerson)</span></span>;</span><br><span class="line">    <span class="built_in">print</span>(s);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230505195009665.png" alt="image-20230505195009665" style="zoom:67%"><h3 id="lambdas"><a href="#lambdas" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#lambdas"></a> lambdas</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230505190504411.png" alt="image-20230505190504411"></p><p>[ ]é‡Œå¯ä»¥æŒ‡å®šæ˜¯ä»¥ value è¿˜æ˜¯ä»¥ reference çš„å½¢å¼ä¼ å…¥ï¼Œ( )åé¢é‚£ä¸‰ä¸ªä¸œè¥¿æ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯åªè¦æœ‰ä¸€ä¸ªå‡ºç°é‚£ä¹ˆ( )å°±å¿…é¡»å†™å‡ºæ¥ï¼Œæ‰€ä»¥å»ºè®®éƒ½å†™ä¸Š( )</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    []() -&gt; <span class="type">void</span> &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;hello lambda&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;();  <span class="comment">// å‰ä¸‰ä¸ªæ˜¯æ ¼å¼ æœ€åä¸€ä¸ªæ‹¬å·ä»£è¡¨è°ƒç”¨</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> I = []() -&gt; <span class="type">void</span> &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;hello lambda&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">I</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> id1 = <span class="number">0</span>, id2 = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// ä¸ºä»€ä¹ˆä¸‹é¢æ‰“å°å‡ºæ¥æ˜¯0 1 2</span></span><br><span class="line">    <span class="comment">// å› ä¸ºè¿™é‡Œçš„id1ä¼ è¿›å»æ˜¯0ï¼Œè¿˜æ²¡èµ°åˆ°ä¸‹é¢</span></span><br><span class="line">    <span class="comment">// ç”±äºæ˜¯ value ä¼ é€’ï¼Œæ‰€ä»¥æ˜¯copyæ“ä½œï¼Œå†…éƒ¨çš„idä¸ä¼šå½±å“å¤–é¢çš„id</span></span><br><span class="line">    <span class="keyword">auto</span> f = [id1, &amp;id2]() <span class="keyword">mutable</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœä¸å†™ mutable ï¼Œè¿™ä¸ªidè¿›æ¥ä¹‹ååªèƒ½read onlyï¼Œä¸èƒ½++</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;id1: &quot;</span> &lt;&lt; id1 &lt;&lt; <span class="string">&#x27;,&#x27;</span> &lt;&lt; <span class="string">&quot;id2: &quot;</span> &lt;&lt; id2 &lt;&lt; endl;</span><br><span class="line">        ++id1;</span><br><span class="line">        ++id2;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸Šé¢lambdaè¡¨è¾¾å¼çš„ç›¸å¯¹æ¥è¿‘çš„å†™æ³•(ä¸å¯¹ç­‰ï¼Œæœ‰å°åŒºåˆ«)</span></span><br><span class="line">    <span class="comment">// class Functor &#123;</span></span><br><span class="line">    <span class="comment">// private:</span></span><br><span class="line">    <span class="comment">//     int id1;  // copy of outside id1</span></span><br><span class="line">    <span class="comment">//     int id2;  // reference of outside id2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// public:</span></span><br><span class="line">    <span class="comment">//     void operator()() &#123;</span></span><br><span class="line">    <span class="comment">//         cout &lt;&lt; &quot;id1: &quot; &lt;&lt; id1 &lt;&lt; &#x27;,&#x27; &lt;&lt; &quot;id2: &quot; &lt;&lt; id2 &lt;&lt; endl;</span></span><br><span class="line">    <span class="comment">//         ++id1;</span></span><br><span class="line">    <span class="comment">//         ++id2;</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">// &#125;;</span></span><br><span class="line">    <span class="comment">// Functor f;</span></span><br><span class="line"></span><br><span class="line">    id1 = <span class="number">42</span>, id2 = <span class="number">42</span>;</span><br><span class="line">    <span class="built_in">f</span>();  <span class="comment">// 0 42</span></span><br><span class="line">    <span class="built_in">f</span>();  <span class="comment">// 1 43</span></span><br><span class="line">    <span class="built_in">f</span>();  <span class="comment">// 2 44</span></span><br><span class="line">    cout &lt;&lt; id1 &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; id2 &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>ä¸ä¸Šä¸€ä¸ªçš„ä¾‹å­è”ç³»èµ·æ¥ï¼Œä¹Ÿè®©æˆ‘ä»¬å¯¹setçš„åº•å±‚å®ç°æœ‰äº†æ›´å¤šçš„ç†è§£</p><p><strong>è¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆåœ¨ä¼ å…¥lambdaçš„æ—¶å€™éœ€è¦åœ¨æ‹¬å·é‡Œé¢æŒ‡å®šè¿™ä¸ªå‡½æ•°å˜é‡ï¼Œçœ‹ä»–çš„æ„é€ å°±è¡Œäº†</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230505195056962.png" alt="image-20230505195056962"></p><p>æ‰€ä»¥åœ¨functorå’Œlambdaä¹‹åï¼Œé€‰æ‹©functoræ˜¾ç„¶ä¼šç¨å¾®å¥½ä¸€ç‚¹</p><p>å¦ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LambdaFunctor</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">LambdaFunctor</span>(<span class="type">int</span> x, <span class="type">int</span> y)</span><br><span class="line">        : _x(x), _y(y) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> val &gt; _x &amp;&amp; val &lt; _y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> _x;</span><br><span class="line">    <span class="type">int</span> _y;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Value_Type&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">printVector</span><span class="params">(<span class="type">const</span> vector&lt;Value_Type&gt;&amp; vec)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> val : vec)</span><br><span class="line">        cout &lt;&lt; val &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> x = <span class="number">30</span>, y = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; v1&#123;<span class="number">5</span>, <span class="number">28</span>, <span class="number">50</span>, <span class="number">83</span>, <span class="number">70</span>, <span class="number">590</span>, <span class="number">245</span>, <span class="number">59</span>, <span class="number">24</span>&#125;;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; v2&#123;<span class="number">5</span>, <span class="number">28</span>, <span class="number">50</span>, <span class="number">83</span>, <span class="number">70</span>, <span class="number">590</span>, <span class="number">245</span>, <span class="number">59</span>, <span class="number">24</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ³¨æ„removeç³»åˆ—æ“ä½œæ˜¯å‡removeï¼Œéœ€è¦eraseæ‰èƒ½çœŸæ­£åˆ é™¤</span></span><br><span class="line">    <span class="keyword">auto</span> newEnd1 = <span class="built_in">remove_if</span>(v<span class="number">1.</span><span class="built_in">begin</span>(), v<span class="number">1.</span><span class="built_in">end</span>(), [x, y](<span class="type">int</span> val) &#123;</span><br><span class="line">        <span class="keyword">return</span> val &gt; x &amp;&amp; val &lt; y;</span><br><span class="line">    &#125;);</span><br><span class="line">    v<span class="number">1.</span><span class="built_in">erase</span>(newEnd1, v<span class="number">1.</span><span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">    v<span class="number">2.</span><span class="built_in">erase</span>(<span class="built_in">remove_if</span>(v<span class="number">1.</span><span class="built_in">begin</span>(), v<span class="number">1.</span><span class="built_in">end</span>(), <span class="built_in">LambdaFunctor</span>(x, y)), v<span class="number">2.</span><span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printVector</span>(v1);</span><br><span class="line">    <span class="built_in">printVector</span>(v2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="variadic-templates"><a href="#variadic-templates" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#variadic-templates"></a> variadic templates</h3><p>ä¹‹å‰å·²ç»æåˆ°è¿‡å¾ˆå¤šæ¬¡äº†ï¼Œä¸¾ä¸€äº›ä¾‹å­ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> value = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Test &#123;</span><br><span class="line"><span class="keyword">inline</span> <span class="type">void</span> _func() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Value_Type, <span class="keyword">typename</span>... Types&gt;</span><br><span class="line"><span class="keyword">inline</span> <span class="type">void</span> _func(<span class="type">const</span> Value_Type&amp; firstArg, <span class="type">const</span> Types&amp;... args) &#123;</span><br><span class="line">    ++value;</span><br><span class="line">    _func(args...);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒ…è£…</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Types&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">const</span> Types&amp;... args)</span> </span>&#123;</span><br><span class="line">    _func(args...);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;value: &quot;</span> &lt;&lt; value &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;  <span class="comment">// namespace Test</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Test;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">func</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);             <span class="comment">// 5</span></span><br><span class="line">    <span class="built_in">func</span>(<span class="string">&quot;string&quot;</span>, <span class="string">&quot;fuck&quot;</span>, <span class="number">2</span>, <span class="number">1.2</span>);  <span class="comment">// 9</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>ç¬¬äºŒä¸ªä¾‹å­ï¼šç”¨c++æ¨¡æ‹Ÿprintfå‡½æ•°(ç®€æ˜“ç‰ˆ)</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Print &#123;</span><br><span class="line"><span class="comment">// ä»£ç ä¸­æŠ›å‡ºå¼‚å¸¸çš„éƒ¨åˆ†å…ˆä¸ç®¡</span></span><br><span class="line"><span class="comment">// ç”¨å‚æ•°åŒ…é‡å†™printfå‡½æ•° ç†è§£</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">myprintf</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (*str) &#123;</span><br><span class="line">        <span class="keyword">if</span> (*str == <span class="string">&#x27;%&#x27;</span> &amp;&amp; *(++str) != <span class="string">&#x27;%&#x27;</span>)  <span class="comment">// å·²ç»æ²¡æœ‰å‚æ•°åŒ…äº†è¿˜æœ‰æ§åˆ¶ç¬¦å·ï¼Œä¸å¯¹åŠ²ï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="built_in">runtime_error</span>(<span class="string">&quot;invalid format string: missing arguments.&quot;</span>);</span><br><span class="line">        cout &lt;&lt; *str++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Value_Type, <span class="keyword">typename</span>... Types&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">myprintf</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str, <span class="type">const</span> Value_Type&amp; val, <span class="type">const</span> Types&amp;... args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (*str) &#123;</span><br><span class="line">        <span class="keyword">if</span> (*str == <span class="string">&#x27;%&#x27;</span> &amp;&amp; *(++str) != <span class="string">&#x27;%&#x27;</span>) &#123;  <span class="comment">// é‡åˆ°æ§åˆ¶ç¬¦å·äº†</span></span><br><span class="line">            cout &lt;&lt; val;</span><br><span class="line">            <span class="built_in">myprintf</span>(++str, args...);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; *str++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="built_in">logic_error</span>(<span class="string">&quot;extra arguments provided to myprintf&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;  <span class="comment">// namespace Print</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Print;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">myprintf</span>(<span class="string">&quot;hello\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span>* pi = <span class="keyword">new</span> <span class="type">int</span>;</span><br><span class="line">    <span class="comment">// ä½†æ˜¯è¿™ä¹ˆæ¨¡æ‹Ÿæœ‰ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼Œå°±æ˜¯æ§åˆ¶ç¬¦å·æˆ‘ä»¬æ²¡å»ç®¡ï¼Œä½†æ˜¯ä»‹äºåªæ˜¯ä¸€ä¸ªç®€å•çš„æ¨¡æ‹Ÿï¼Œè¿˜æ˜¯å¯ä»¥çš„</span></span><br><span class="line">    <span class="built_in">myprintf</span>(<span class="string">&quot;%d %s %p %f\n&quot;</span>, <span class="number">15</span>, <span class="string">&quot;This is Ace.&quot;</span>, pi, <span class="number">3.1415926535</span>);</span><br><span class="line">    <span class="keyword">delete</span> pi;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="æ‰“å°tupleè¿™ä¸ªä¾‹å­éå¸¸å·§å¦™"><a href="#æ‰“å°tupleè¿™ä¸ªä¾‹å­éå¸¸å·§å¦™" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ‰“å°tupleè¿™ä¸ªä¾‹å­éå¸¸å·§å¦™"></a> æ‰“å°tuple(è¿™ä¸ªä¾‹å­éå¸¸å·§å¦™)</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230505213553781.png" alt="image-20230505213553781"></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bitset&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tuple&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> PRINT &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">int</span> index, <span class="type">int</span> max, <span class="keyword">typename</span>... Args&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Tuple_Print</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">static</span> <span class="type">void</span> <span class="title">print</span><span class="params">(ostream&amp; os, <span class="type">const</span> tuple&lt;Args...&gt;&amp; t)</span> </span>&#123;</span><br><span class="line">        os &lt;&lt; <span class="built_in">get</span>&lt;index&gt;(t) &lt;&lt; (index + <span class="number">1</span> != max ? <span class="string">&quot;,&quot;</span> : <span class="string">&quot;&quot;</span>);  <span class="comment">// å¦‚æœä¸æ˜¯æœ€åä¸€ä¸ªå°±æ˜¯ , å·</span></span><br><span class="line">        Tuple_Print&lt;index + <span class="number">1</span>, max, Args...&gt;::<span class="built_in">print</span>(os, t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€’å½’ç»ˆç‚¹</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">int</span> max, <span class="keyword">typename</span>... Args&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Tuple_Print</span>&lt;max, max, Args...&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">static</span> <span class="type">void</span> <span class="title">print</span><span class="params">(ostream&amp; os, <span class="type">const</span> tuple&lt;Args...&gt;&amp; t)</span> </span>&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#125;  <span class="comment">// namespace PRINT</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Args&gt;</span><br><span class="line"><span class="keyword">inline</span> ostream&amp;</span><br><span class="line"><span class="keyword">operator</span>&lt;&lt;(ostream&amp; os, <span class="type">const</span> tuple&lt;Args...&gt;&amp; t) &#123;</span><br><span class="line">    os &lt;&lt; <span class="string">&quot;[&quot;</span>;</span><br><span class="line">    PRINT::Tuple_Print&lt;<span class="number">0</span>, <span class="keyword">sizeof</span>...(Args), Args...&gt;::<span class="built_in">print</span>(os, t);</span><br><span class="line">    <span class="keyword">return</span> os &lt;&lt; <span class="string">&quot;]&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">make_tuple</span>(<span class="number">7.5</span>, <span class="built_in">string</span>(<span class="string">&quot;hello&quot;</span>), <span class="built_in">bitset</span>&lt;<span class="number">16</span>&gt;(<span class="number">377</span>), <span class="number">42</span>) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h2 id="ç¬¬äºŒè®²æ ‡å‡†åº“"><a href="#ç¬¬äºŒè®²æ ‡å‡†åº“" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¬¬äºŒè®²æ ‡å‡†åº“"></a> ç¬¬äºŒè®²ï¼šæ ‡å‡†åº“</h2><h3 id="å³å€¼å¼•ç”¨"><a href="#å³å€¼å¼•ç”¨" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å³å€¼å¼•ç”¨"></a> å³å€¼å¼•ç”¨</h3><p>è®°ä½ï¼š</p><ul><li><strong>å·¦å€¼ != å·¦å€¼å¼•ç”¨</strong></li><li><strong>å³å€¼ != å³å€¼å¼•ç”¨</strong></li></ul><p>Lvalueï¼šåªèƒ½å‡ºç°åœ¨operator = å·¦è¾¹</p><p>Rvalueï¼šåªèƒ½å‡ºç°å†operator = å³è¾¹</p><p><strong>ä¸´æ—¶å¯¹è±¡æ˜¯ä¸€ä¸ªå³å€¼ï¼Œå³å€¼ä¸èƒ½å‡ºç°åœ¨ = å·çš„å·¦è¾¹ï¼Œä¸´æ—¶å¯¹è±¡tmpä¸€å®šè¢«å½“ä½œå³å€¼!!!</strong></p><p>æ³¨æ„copy ctorå’Œmove ctorä¹‹é—´çš„åŒºåˆ«ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230514163001551.png" alt="image-20230514163001551"></p><p><strong>move()ï¼šæ ‡å‡†åº“æä¾›çš„å¯ä»¥æŠŠå·¦å€¼å˜ä¸ºå³å€¼çš„å‡½æ•°</strong></p><p><strong>Perfect Forwarding:åœ¨é€”ä¸­æŠŠVtype(buf)(å³å€¼)äº¤ç»™Mystringçš„move ctorçš„æ—¶å€™ä¼šå…ˆç»è¿‡insertå‡½æ•°åœ¨è°ƒç”¨move ctorï¼Œè¿™å°±æœ‰ä¸€ä¸ªä¸­é—´ä¼ é€’çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥å¦‚ä½•åšåˆ°Perfect Forwardingæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„äº‹æƒ…ï¼Œç¡®ä¿è¯¥ä¼ é€’çš„ä¿¡æ¯ä¸èƒ½ä¸¢å¤±</strong></p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230514170850534.png" alt="image-20230514170850534" style="zoom:67%"><p>Unperfect Forwarding</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230514171027632.png" alt="image-20230514171027632"></p><p>Perfect Forwardingçš„å…·ä½“å®ç°ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230516105734995.png" alt="image-20230516105734995"></p><p>å†™ä¸€ä¸ª move aware class</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230516114646497.png" alt="image-20230516114646497"></p><p>åœ¨ move ctor å½“ä¸­ï¼Œä¸ºä»€ä¹ˆè¦æŠŠåŸæ¥çš„æŒ‡é’ˆè®¾ä¸ºnullptrå‘¢ï¼Ÿ(æ‰“æ–­)</p><p><strong>è¿™æ˜¯å› ä¸ºå‡å¦‚ä¼ å…¥çš„å³å€¼å¯¹è±¡æ˜¯ä¸´æ—¶å¯¹è±¡ï¼Œä¸´æ—¶å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå°±åªæœ‰è¿™ä¸€å¥ä»£ç ï¼Œæ‰§è¡Œå®Œè¿‡åå°±ä¼šè¢«é‡Šæ”¾ï¼Œå¦‚æœä¸æ‰“æ–­ï¼Œå¯¹äºè¿™é‡Œçš„stringè€Œè¨€ï¼Œå°±ä¼šè°ƒç”¨ææ„å‡½æ•°æŠŠè¿™ä¸ªä¸´æ—¶å¯¹è±¡ä»¥åŠä¸´æ—¶å¯¹è±¡æŒ‡å‘çš„åŒºåŸŸç»™é‡Šæ”¾æ‰ï¼Œå› æ­¤å°±å½±å“åˆ°äº†_dataçš„éƒ¨åˆ†ï¼Œè™½ç„¶è¿™ä¸ªä¸´æ—¶å¯¹è±¡ä»Šåä¸å†ç”¨äº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯è¦æŠŠå®ƒä¸æˆ‘ä»¬å·æ¥çš„æ•°æ®è¿›è¡Œæ‰“æ–­ï¼Œå¹¶ä¸”é…å¥—çš„åœ¨ææ„å‡½æ•°çš„éƒ¨åˆ†å°†å…¶é‡Šæ”¾ï¼Œå¦åˆ™ä¼šå‡ºç°ä¸Šé¢çš„é—®é¢˜</strong></p><p>move ctorå’Œmove asgnçš„æµ‹è¯•</p><p>MyString.h</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _MYSTRING_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _MYSTRING_H_</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="comment">// å†™ä¸€ä¸ª move aware class</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mystring</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">static</span> <span class="type">size_t</span> DCtor;  <span class="comment">// ç´¯è®¡ default-ctorå‘¼å«æ¬¡æ•°</span></span><br><span class="line">    <span class="type">static</span> <span class="type">size_t</span> Ctor;   <span class="comment">// ç´¯è®¡ ctorå‘¼å«æ¬¡æ•°</span></span><br><span class="line">    <span class="type">static</span> <span class="type">size_t</span> CCtor;  <span class="comment">// ç´¯è®¡ copy-ctorå‘¼å«æ¬¡æ•°</span></span><br><span class="line">    <span class="type">static</span> <span class="type">size_t</span> CAsgn;  <span class="comment">// ç´¯è®¡ copy-asgnå‘¼å«æ¬¡æ•°</span></span><br><span class="line">    <span class="type">static</span> <span class="type">size_t</span> MCtor;  <span class="comment">// ç´¯è®¡ move-ctorå‘¼å«æ¬¡æ•°</span></span><br><span class="line">    <span class="type">static</span> <span class="type">size_t</span> MAsgn;  <span class="comment">// ç´¯è®¡ move-asgnå‘¼å«æ¬¡æ•°</span></span><br><span class="line">    <span class="type">static</span> <span class="type">size_t</span> Dtor;   <span class="comment">// ç´¯è®¡ default-ctorå‘¼å«æ¬¡æ•°</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">char</span>* _data;</span><br><span class="line">    <span class="type">size_t</span> _len;</span><br><span class="line"></span><br><span class="line">    <span class="type">void</span> _init_data(<span class="type">const</span> <span class="type">char</span>* s) &#123;</span><br><span class="line">        _data = <span class="keyword">new</span> <span class="type">char</span>[_len + <span class="number">1</span>];</span><br><span class="line">        <span class="built_in">memcpy</span>(_data, s, _len);  <span class="comment">// è¿™æ˜¯ä¸€ä¸ªæ·±æ‹·è´</span></span><br><span class="line">        _data[_len] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// default-ctor</span></span><br><span class="line">    <span class="built_in">Mystring</span>() : _data(<span class="literal">nullptr</span>), _len(<span class="number">0</span>) &#123; ++DCtor; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ctor</span></span><br><span class="line">    <span class="built_in">Mystring</span>(<span class="type">const</span> <span class="type">char</span>* p) : _len(<span class="built_in">strlen</span>(p)) &#123;</span><br><span class="line">        ++Ctor;</span><br><span class="line">        _init_data(p);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// copy-ctor</span></span><br><span class="line">    <span class="built_in">Mystring</span>(<span class="type">const</span> Mystring&amp; str) : _len(str._len) &#123;</span><br><span class="line">        ++CCtor;</span><br><span class="line">        _init_data(str._data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// copy-asgn</span></span><br><span class="line">    Mystring&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Mystring&amp; str) &#123;</span><br><span class="line">        ++CAsgn;</span><br><span class="line">        <span class="comment">// è‡ªæˆ‘èµ‹å€¼æ£€æŸ¥</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != &amp;str) &#123;</span><br><span class="line">            _len = str._len;</span><br><span class="line">            _init_data(str._data);</span><br><span class="line">        &#125; <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="built_in">invalid_argument</span>(<span class="string">&quot;cannot assign yourself.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// move ctor, with noexcept</span></span><br><span class="line">    <span class="built_in">Mystring</span>(Mystring&amp;&amp; str) <span class="keyword">noexcept</span> : _data(str._data), _len(str._len) &#123;  <span class="comment">// æŒ‡é’ˆç›¸åŒè¡¨ç¤ºæŒ‡å‘åŒä¸€å—å†…å­˜ï¼Œå°±æ˜¯ä¸€ä¸ªå·çš„åŠ¨ä½œï¼Œæ˜¯æµ…æ‹·è´!!!</span></span><br><span class="line">        <span class="comment">// å®Œäº‹ä¹‹åå°†åŸæ¥çš„strå¤„ç†ä¸€ä¸‹ï¼Œèƒ½å¤Ÿä¼ å…¥å³å€¼å¼•ç”¨éƒ½è¡¨ç¤ºä»Šåè¿™ä¸ªä¸œè¥¿ä¸ç”¨äº†</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥ä¸ç”¨äº†ï¼Œä½†æ˜¯ä¹Ÿä¸è¦åˆ é™¤æ‰</span></span><br><span class="line">        ++MCtor;</span><br><span class="line">        str._len = <span class="number">0</span>;</span><br><span class="line">        str._data = <span class="literal">nullptr</span>;  <span class="comment">// é‡è¦!!!</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// move asgn, with noexcept</span></span><br><span class="line">    Mystring&amp; <span class="keyword">operator</span>=(Mystring&amp;&amp; str) &#123;</span><br><span class="line">        ++MAsgn;</span><br><span class="line">        <span class="comment">// è‡ªæˆ‘èµ‹å€¼æ£€æŸ¥</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != &amp;str) &#123;</span><br><span class="line">            _data = str._data;</span><br><span class="line">            _len = str._len;</span><br><span class="line"></span><br><span class="line">            str._len = <span class="number">0</span>;</span><br><span class="line">            str._data = <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// dtor</span></span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Mystring</span>() &#123;</span><br><span class="line">        ++DCtor;</span><br><span class="line">        <span class="keyword">if</span> (_data)</span><br><span class="line">            <span class="keyword">delete</span> _data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// operator &lt;</span></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Mystring&amp; rhs) <span class="type">const</span> &#123;  <span class="comment">// ä¸ºäº†set</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">string</span>(<span class="keyword">this</span>-&gt;_data) &lt; <span class="built_in">string</span>(rhs._data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// operator ==</span></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">const</span> Mystring&amp; rhs) <span class="type">const</span> &#123;  <span class="comment">// ä¸ºäº†set</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">string</span>(<span class="keyword">this</span>-&gt;_data) == <span class="built_in">string</span>(rhs._data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">char</span>* <span class="title">get</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> _data; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–é™æ€å˜é‡</span></span><br><span class="line"><span class="type">size_t</span> Mystring::DCtor = <span class="number">0</span>;  <span class="comment">// ç´¯è®¡ default-ctorå‘¼å«æ¬¡æ•°</span></span><br><span class="line"><span class="type">size_t</span> Mystring::Ctor = <span class="number">0</span>;   <span class="comment">// ç´¯è®¡ ctorå‘¼å«æ¬¡æ•°</span></span><br><span class="line"><span class="type">size_t</span> Mystring::CCtor = <span class="number">0</span>;  <span class="comment">// ç´¯è®¡ copy-ctorå‘¼å«æ¬¡æ•°</span></span><br><span class="line"><span class="type">size_t</span> Mystring::CAsgn = <span class="number">0</span>;  <span class="comment">// ç´¯è®¡ copy-asgnå‘¼å«æ¬¡æ•°</span></span><br><span class="line"><span class="type">size_t</span> Mystring::MCtor = <span class="number">0</span>;  <span class="comment">// ç´¯è®¡ move-ctorå‘¼å«æ¬¡æ•°</span></span><br><span class="line"><span class="type">size_t</span> Mystring::MAsgn = <span class="number">0</span>;  <span class="comment">// ç´¯è®¡ move-asgnå‘¼å«æ¬¡æ•°</span></span><br><span class="line"><span class="type">size_t</span> Mystring::Dtor = <span class="number">0</span>;   <span class="comment">// ç´¯è®¡ default-ctorå‘¼å«æ¬¡æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç†hashcode æ”¾åœ¨stdä¸­å’Œæ ‡å‡†åº“åˆå¹¶</span></span><br><span class="line"><span class="keyword">namespace</span> std &#123;</span><br><span class="line"><span class="keyword">template</span> &lt;&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">hash</span>&lt;Mystring&gt; &#123;</span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> Mystring&amp; s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">hash</span>&lt;string&gt;()(<span class="built_in">string</span>(s.<span class="built_in">get</span>()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;  <span class="comment">// namespace std</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></div></figure><p>MyStrNoMove.h</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _MYSTRNOMOVE_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _MYSTRNOMOVE_H_</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyStrNoMove</span> &#123;</span><br><span class="line">    <span class="comment">// æ‹¿æ‰move ctorå’Œ move asgn</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">static</span> <span class="type">size_t</span> DCtor;  <span class="comment">// ç´¯è®¡ default-ctorå‘¼å«æ¬¡æ•°</span></span><br><span class="line">    <span class="type">static</span> <span class="type">size_t</span> Ctor;   <span class="comment">// ç´¯è®¡ ctorå‘¼å«æ¬¡æ•°</span></span><br><span class="line">    <span class="type">static</span> <span class="type">size_t</span> CCtor;  <span class="comment">// ç´¯è®¡ copy-ctorå‘¼å«æ¬¡æ•°</span></span><br><span class="line">    <span class="type">static</span> <span class="type">size_t</span> CAsgn;  <span class="comment">// ç´¯è®¡ copy-asgnå‘¼å«æ¬¡æ•°</span></span><br><span class="line">    <span class="type">static</span> <span class="type">size_t</span> MCtor;  <span class="comment">// ç´¯è®¡ move-ctorå‘¼å«æ¬¡æ•°</span></span><br><span class="line">    <span class="type">static</span> <span class="type">size_t</span> MAsgn;  <span class="comment">// ç´¯è®¡ move-asgnå‘¼å«æ¬¡æ•°</span></span><br><span class="line">    <span class="type">static</span> <span class="type">size_t</span> Dtor;   <span class="comment">// ç´¯è®¡ default-ctorå‘¼å«æ¬¡æ•°</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">char</span>* _data;</span><br><span class="line">    <span class="type">size_t</span> _len;</span><br><span class="line"></span><br><span class="line">    <span class="type">void</span> _init_data(<span class="type">const</span> <span class="type">char</span>* s) &#123;</span><br><span class="line">        _data = <span class="keyword">new</span> <span class="type">char</span>[_len + <span class="number">1</span>];</span><br><span class="line">        <span class="built_in">memcpy</span>(_data, s, _len);  <span class="comment">// è¿™æ˜¯ä¸€ä¸ªæ·±æ‹·è´</span></span><br><span class="line">        _data[_len] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// default-ctor</span></span><br><span class="line">    <span class="built_in">MyStrNoMove</span>() : _data(<span class="literal">nullptr</span>), _len(<span class="number">0</span>) &#123; ++DCtor; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ctor</span></span><br><span class="line">    <span class="built_in">MyStrNoMove</span>(<span class="type">const</span> <span class="type">char</span>* p) : _len(<span class="built_in">strlen</span>(p)) &#123;</span><br><span class="line">        ++Ctor;</span><br><span class="line">        _init_data(p);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// copy-ctor</span></span><br><span class="line">    <span class="built_in">MyStrNoMove</span>(<span class="type">const</span> MyStrNoMove&amp; str) : _len(str._len) &#123;</span><br><span class="line">        ++CCtor;</span><br><span class="line">        _init_data(str._data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// copy-asgn</span></span><br><span class="line">    MyStrNoMove&amp; <span class="keyword">operator</span>=(<span class="type">const</span> MyStrNoMove&amp; str) &#123;</span><br><span class="line">        ++CAsgn;</span><br><span class="line">        <span class="comment">// è‡ªæˆ‘èµ‹å€¼æ£€æŸ¥</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != &amp;str) &#123;</span><br><span class="line">            _len = str._len;</span><br><span class="line">            _init_data(str._data);</span><br><span class="line">        &#125; <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="built_in">invalid_argument</span>(<span class="string">&quot;cannot assign yourself.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// dtor</span></span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">MyStrNoMove</span>() &#123;</span><br><span class="line">        ++DCtor;</span><br><span class="line">        <span class="keyword">if</span> (_data)</span><br><span class="line">            <span class="keyword">delete</span> _data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// operator &lt;</span></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> MyStrNoMove&amp; rhs) <span class="type">const</span> &#123;  <span class="comment">// ä¸ºäº†set</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">string</span>(<span class="keyword">this</span>-&gt;_data) &lt; <span class="built_in">string</span>(rhs._data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// operator ==</span></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">const</span> MyStrNoMove&amp; rhs) <span class="type">const</span> &#123;  <span class="comment">// ä¸ºäº†set</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">string</span>(<span class="keyword">this</span>-&gt;_data) == <span class="built_in">string</span>(rhs._data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">char</span>* <span class="title">get</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> _data; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–é™æ€å˜é‡</span></span><br><span class="line"><span class="type">size_t</span> MyStrNoMove::DCtor = <span class="number">0</span>;  <span class="comment">// ç´¯è®¡ default-ctorå‘¼å«æ¬¡æ•°</span></span><br><span class="line"><span class="type">size_t</span> MyStrNoMove::Ctor = <span class="number">0</span>;   <span class="comment">// ç´¯è®¡ ctorå‘¼å«æ¬¡æ•°</span></span><br><span class="line"><span class="type">size_t</span> MyStrNoMove::CCtor = <span class="number">0</span>;  <span class="comment">// ç´¯è®¡ copy-ctorå‘¼å«æ¬¡æ•°</span></span><br><span class="line"><span class="type">size_t</span> MyStrNoMove::CAsgn = <span class="number">0</span>;  <span class="comment">// ç´¯è®¡ copy-asgnå‘¼å«æ¬¡æ•°</span></span><br><span class="line"><span class="type">size_t</span> MyStrNoMove::MCtor = <span class="number">0</span>;  <span class="comment">// ç´¯è®¡ move-ctorå‘¼å«æ¬¡æ•°</span></span><br><span class="line"><span class="type">size_t</span> MyStrNoMove::MAsgn = <span class="number">0</span>;  <span class="comment">// ç´¯è®¡ move-asgnå‘¼å«æ¬¡æ•°</span></span><br><span class="line"><span class="type">size_t</span> MyStrNoMove::Dtor = <span class="number">0</span>;   <span class="comment">// ç´¯è®¡ default-ctorå‘¼å«æ¬¡æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç†hashcode æ”¾åœ¨stdä¸­å’Œæ ‡å‡†åº“åˆå¹¶</span></span><br><span class="line"><span class="keyword">namespace</span> std &#123;</span><br><span class="line"><span class="keyword">template</span> &lt;&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">hash</span>&lt;MyStrNoMove&gt; &#123;</span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> MyStrNoMove&amp; s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">hash</span>&lt;string&gt;()(<span class="built_in">string</span>(s.<span class="built_in">get</span>()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;  <span class="comment">// namespace std</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></div></figure><p>test.h</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _TEST_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _TEST_H_</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;deque&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;25_MyStrNoMove.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;25_Mystring.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Test &#123;</span><br><span class="line"><span class="comment">//--------------------------------------------------------</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> MyString&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">output_static_data</span><span class="params">(<span class="type">const</span> MyString &amp;str)</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">typeid</span>(str).<span class="built_in">name</span>() &lt;&lt; <span class="string">&quot;--&quot;</span> &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;CCtor= &quot;</span> &lt;&lt; MyString::CCtor</span><br><span class="line">         &lt;&lt; <span class="string">&quot; MCtor= &quot;</span> &lt;&lt; MyString::MCtor</span><br><span class="line">         &lt;&lt; <span class="string">&quot; CAsgn= &quot;</span> &lt;&lt; MyString::CAsgn</span><br><span class="line">         &lt;&lt; <span class="string">&quot; MAsgn= &quot;</span> &lt;&lt; MyString::MAsgn</span><br><span class="line">         &lt;&lt; <span class="string">&quot; Dtor= &quot;</span> &lt;&lt; MyString::Dtor</span><br><span class="line">         &lt;&lt; <span class="string">&quot; Ctor= &quot;</span> &lt;&lt; MyString::Ctor</span><br><span class="line">         &lt;&lt; <span class="string">&quot; DCtor= &quot;</span> &lt;&lt; MyString::DCtor</span><br><span class="line">         &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// test_moveable</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> M, <span class="keyword">typename</span> NM&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_moveable</span><span class="params">(M c1, NM c2, <span class="type">long</span> &amp;value)</span> </span>&#123;</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æµ‹è¯• moveable</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\ntest, with moveable elements&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">typename</span> iterator_traits&lt;<span class="keyword">typename</span> M::iterator&gt;::value_type V1type;</span><br><span class="line">    <span class="type">clock_t</span> timeStart = <span class="built_in">clock</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> i = <span class="number">0</span>; i &lt; value; ++i) &#123;</span><br><span class="line">        <span class="built_in">snprintf</span>(buf, <span class="number">10</span>, <span class="string">&quot;%d&quot;</span>, <span class="built_in">rand</span>());</span><br><span class="line">        <span class="keyword">auto</span> ite = c<span class="number">1.</span><span class="built_in">end</span>();</span><br><span class="line">        c<span class="number">1.</span><span class="built_in">insert</span>(ite, <span class="built_in">V1type</span>(buf));</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;construction, milli-seconds : &quot;</span> &lt;&lt; <span class="built_in">double</span>(<span class="built_in">clock</span>() - timeStart) / <span class="number">1000</span> &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;size()= &quot;</span> &lt;&lt; c<span class="number">1.</span><span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">output_static_data</span>(*(c<span class="number">1.</span><span class="built_in">begin</span>()));</span><br><span class="line"></span><br><span class="line">    timeStart = <span class="built_in">clock</span>();</span><br><span class="line">    <span class="function">M <span class="title">c11</span><span class="params">(c1)</span></span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;copy, milli-seconds : &quot;</span> &lt;&lt; <span class="built_in">double</span>(<span class="built_in">clock</span>() - timeStart) / <span class="number">1000</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    timeStart = <span class="built_in">clock</span>();</span><br><span class="line">    <span class="function">M <span class="title">c12</span><span class="params">(std::move(c1))</span></span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;move copy, milli-seconds : &quot;</span> &lt;&lt; <span class="built_in">double</span>(<span class="built_in">clock</span>() - timeStart) / <span class="number">1000</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    timeStart = <span class="built_in">clock</span>();</span><br><span class="line">    c<span class="number">11.</span><span class="built_in">swap</span>(c12);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;swap, milli-seconds : &quot;</span> &lt;&lt; <span class="built_in">double</span>(<span class="built_in">clock</span>() - timeStart) / <span class="number">1000</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æµ‹è¯• non-moveable</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\ntest, with non-moveable elements&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">typename</span> iterator_traits&lt;<span class="keyword">typename</span> NM::iterator&gt;::value_type V2type;</span><br><span class="line">    timeStart = <span class="built_in">clock</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> i = <span class="number">0</span>; i &lt; value; ++i) &#123;</span><br><span class="line">        <span class="built_in">snprintf</span>(buf, <span class="number">10</span>, <span class="string">&quot;%d&quot;</span>, <span class="built_in">rand</span>());</span><br><span class="line">        <span class="keyword">auto</span> ite = c<span class="number">2.</span><span class="built_in">end</span>();</span><br><span class="line">        c<span class="number">2.</span><span class="built_in">insert</span>(ite, <span class="built_in">V2type</span>(buf));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;construction, milli-seconds : &quot;</span> &lt;&lt; <span class="built_in">double</span>(<span class="built_in">clock</span>() - timeStart) / <span class="number">1000</span> &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;size()= &quot;</span> &lt;&lt; c<span class="number">2.</span><span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">output_static_data</span>(*(c<span class="number">2.</span><span class="built_in">begin</span>()));</span><br><span class="line"></span><br><span class="line">    timeStart = <span class="built_in">clock</span>();</span><br><span class="line">    <span class="function">NM <span class="title">c21</span><span class="params">(c2)</span></span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;copy, milli-seconds : &quot;</span> &lt;&lt; <span class="built_in">double</span>(<span class="built_in">clock</span>() - timeStart) / <span class="number">1000</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    timeStart = <span class="built_in">clock</span>();</span><br><span class="line">    <span class="function">NM <span class="title">c22</span><span class="params">(std::move(c2))</span></span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;move copy, milli-seconds : &quot;</span> &lt;&lt; <span class="built_in">double</span>(<span class="built_in">clock</span>() - timeStart) / <span class="number">1000</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    timeStart = <span class="built_in">clock</span>();</span><br><span class="line">    c<span class="number">21.</span><span class="built_in">swap</span>(c22);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;swap, milli-seconds : &quot;</span> &lt;&lt; <span class="built_in">double</span>(<span class="built_in">clock</span>() - timeStart) / <span class="number">1000</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//--------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†æ ‡è¯†ä½ æ¸…0</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Mystring::DCtor = <span class="number">0</span>;</span><br><span class="line">    Mystring::Ctor = <span class="number">0</span>;</span><br><span class="line">    Mystring::CCtor = <span class="number">0</span>;</span><br><span class="line">    Mystring::CAsgn = <span class="number">0</span>;</span><br><span class="line">    Mystring::MCtor = <span class="number">0</span>;</span><br><span class="line">    Mystring::MAsgn = <span class="number">0</span>;</span><br><span class="line">    Mystring::Dtor = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    MyStrNoMove::DCtor = <span class="number">0</span>;</span><br><span class="line">    MyStrNoMove::Ctor = <span class="number">0</span>;</span><br><span class="line">    MyStrNoMove::CCtor = <span class="number">0</span>;</span><br><span class="line">    MyStrNoMove::CAsgn = <span class="number">0</span>;</span><br><span class="line">    MyStrNoMove::MCtor = <span class="number">0</span>;</span><br><span class="line">    MyStrNoMove::MAsgn = <span class="number">0</span>;</span><br><span class="line">    MyStrNoMove::Dtor = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// test_vector</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_vector</span><span class="params">(<span class="type">long</span> &amp;value)</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\ntest_vector().......... \n&quot;</span>;</span><br><span class="line">    <span class="built_in">test_moveable</span>(<span class="built_in">vector</span>&lt;Mystring&gt;(), <span class="built_in">vector</span>&lt;MyStrNoMove&gt;(), value);</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// test_list</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_list</span><span class="params">(<span class="type">long</span> &amp;value)</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\ntest_list().......... \n&quot;</span>;</span><br><span class="line">    <span class="built_in">test_moveable</span>(<span class="built_in">list</span>&lt;Mystring&gt;(), <span class="built_in">list</span>&lt;MyStrNoMove&gt;(), value);</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// test_deque</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_deque</span><span class="params">(<span class="type">long</span> &amp;value)</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\ntest_deque().......... \n&quot;</span>;</span><br><span class="line">    <span class="built_in">test_moveable</span>(<span class="built_in">deque</span>&lt;Mystring&gt;(), <span class="built_in">deque</span>&lt;MyStrNoMove&gt;(), value);</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// test_multiset</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_multiset</span><span class="params">(<span class="type">long</span> &amp;value)</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\ntest_multiset().......... \n&quot;</span>;</span><br><span class="line">    <span class="built_in">test_moveable</span>(<span class="built_in">multiset</span>&lt;Mystring&gt;(), <span class="built_in">multiset</span>&lt;MyStrNoMove&gt;(), value);</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// test_unordered_multiset</span></span><br><span class="line"><span class="comment">// void test_unordered_multiset(long &amp;value) &#123;</span></span><br><span class="line"><span class="comment">//     cout &lt;&lt; &quot;\ntest_unordered_multiset().......... \n&quot;;</span></span><br><span class="line"><span class="comment">//     test_moveable(unordered_multiset&lt;Mystring&gt;(), unordered_multiset&lt;MyStrNoMove&gt;(), value);</span></span><br><span class="line"><span class="comment">//     cout &lt;&lt; endl;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line">&#125;  <span class="comment">// namespace Test</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></div></figure><p>main.cpp</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;25_MyStrNoMove.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;25_Mystring.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;25_test.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">long</span> value = <span class="number">3</span> * <span class="number">10e5</span>;</span><br><span class="line"></span><br><span class="line">    Test::<span class="built_in">test_vector</span>(value);</span><br><span class="line">    Test::<span class="built_in">clear</span>();</span><br><span class="line"></span><br><span class="line">    Test::<span class="built_in">test_list</span>(value);</span><br><span class="line">    Test::<span class="built_in">clear</span>();</span><br><span class="line"></span><br><span class="line">    Test::<span class="built_in">test_deque</span>(value);</span><br><span class="line">    Test::<span class="built_in">clear</span>();</span><br><span class="line"></span><br><span class="line">    Test::<span class="built_in">test_multiset</span>(value);</span><br><span class="line">    Test::<span class="built_in">clear</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Test::test_unordered_multiset(value);</span></span><br><span class="line">    <span class="comment">// Test::clear();</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ‰§è¡Œç»“æœï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230516165803938.png" alt="image-20230516165803938"></p><h3 id="é€‚é…å™¨-adapter-è¡¥å……"><a href="#é€‚é…å™¨-adapter-è¡¥å……" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#é€‚é…å™¨-adapter-è¡¥å……"></a> é€‚é…å™¨ Adapter è¡¥å……</h3><h4 id="xé€‚é…å™¨ostream_iterator"><a href="#xé€‚é…å™¨ostream_iterator" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#xé€‚é…å™¨ostream_iterator"></a> Xé€‚é…å™¨ï¼šostream_iterator</h4><p>å¯ä»¥ç”¨æ¥è¿æ¥ cout</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230516203937375.png" alt="image-20230516203937375"></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span>  <span class="comment">//std::copy</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span>   <span class="comment">//std::cout</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iterator&gt;</span>   <span class="comment">//std::ostream_iterator</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span>     <span class="comment">//std::vector</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; v;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) v.<span class="built_in">push_back</span>(i * <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function">std::ostream_iterator&lt;<span class="type">int</span>&gt; <span class="title">out_it</span><span class="params">(std::cout, <span class="string">&quot;,&quot;</span>)</span></span>;</span><br><span class="line">    std::<span class="built_in">copy</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), out_it);</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h4 id="istream_iterator"><a href="#istream_iterator" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#istream_iterator"></a> istream_iterator</h4><p>å¯ä»¥ç”¨æ¥è¿æ¥ cin</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230516205607537.png" alt="image-20230516205607537"></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span>  <span class="comment">//std::cin std::cout</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iterator&gt;</span>  <span class="comment">//std::istream_iterator</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">double</span> value1, value2;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Please,insert two values: &quot;</span>;</span><br><span class="line">    std::istream_iterator&lt;<span class="type">double</span>&gt; eos;             <span class="comment">// end-of-stream iterator</span></span><br><span class="line">    <span class="function">std::istream_iterator&lt;<span class="type">double</span>&gt; <span class="title">iter</span><span class="params">(std::cin)</span></span>;  <span class="comment">// stdin iterator</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (iter != eos)</span><br><span class="line">        value1 = *iter;</span><br><span class="line">    ++iter;</span><br><span class="line">    <span class="keyword">if</span> (iter != eos)</span><br><span class="line">        value2 = *iter;</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; value1 &lt;&lt; <span class="string">&quot; * &quot;</span> &lt;&lt; value2 &lt;&lt; <span class="string">&quot; == &quot;</span> &lt;&lt; value1 * value2 &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h4 id="type-traits"><a href="#type-traits" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#type-traits"></a> type traits</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230516212207244.png" alt="image-20230516212207244"></p><p>ä»¥å‰çš„ç‰ˆæœ¬ç”±äºæ ‡å‡†çš„é™åˆ¶ï¼Œæœ€å¥½å†™è‡ªå®šä¹‰ç±»çš„æ—¶å€™ä¹Ÿè¦å¸¦ä¸Šè¿™ä¸ª __type_traits&lt;&gt;</p><p>C++2.0 æ–°ç‰ˆæœ¬</p><p><strong>trivial ä¸é‡è¦çš„</strong><br><strong>POD plain old data å¹³æ·¡çš„æ—§é£æ ¼çš„ï¼ŒæŒ‡çš„å°±æ˜¯Cé£æ ¼çš„ï¼Œä¹Ÿå°±æ˜¯åªæœ‰æˆå‘˜å˜é‡æ²¡æœ‰æˆå‘˜æ–¹æ³•</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230516221129783.png" alt="image-20230516221129783"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230516221225536.png" alt="image-20230516221225536"></p><p>type traits æµ‹è¯•</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230516221737119.png" alt="image-20230516221737119" style="zoom:67%"><p>type_traits å®ç° is_void(äº†è§£)</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230517141545661.png" alt="image-20230517141545661"></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;type_traits&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// my_isVoid ç®€å•ç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Value_Type</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">my_isVoid</span> : <span class="keyword">public</span> false_type &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç‰¹åŒ–ç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">template</span> &lt;&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">my_isVoid</span>&lt;<span class="type">void</span>&gt; : <span class="keyword">public</span> true_type &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; my_isVoid&lt;<span class="type">int</span>&gt;::value &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; my_isVoid&lt;<span class="type">void</span>&gt;::value &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h1 id="å†…å­˜ç®¡ç†"><a href="#å†…å­˜ç®¡ç†" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å†…å­˜ç®¡ç†"></a> å†…å­˜ç®¡ç†</h1><h2 id="ç¬¬ä¸€è®²primitives"><a href="#ç¬¬ä¸€è®²primitives" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¬¬ä¸€è®²primitives"></a> ç¬¬ä¸€è®²ï¼šprimitives</h2><h3 id="cåº”ç”¨ç¨‹åº"><a href="#cåº”ç”¨ç¨‹åº" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#cåº”ç”¨ç¨‹åº"></a> c++åº”ç”¨ç¨‹åº</h3><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230518140540645.png" alt="image-20230518140540645" style="zoom:67%"><h4 id="cå†…å­˜çš„åŸºæœ¬å·¥å…·"><a href="#cå†…å­˜çš„åŸºæœ¬å·¥å…·" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#cå†…å­˜çš„åŸºæœ¬å·¥å…·"></a> c++å†…å­˜çš„åŸºæœ¬å·¥å…·</h4><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230518140911306.png" alt="image-20230518140911306" style="zoom:50%"><p>æµ‹è¯•ç¨‹åºï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;complex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ext/pool_allocator.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸‰ç§ä½¿ç”¨æ–¹æ³•</span></span><br><span class="line">    <span class="type">void</span>* p1 = <span class="built_in">malloc</span>(<span class="number">512</span>);  <span class="comment">// 512 bytes</span></span><br><span class="line">    cout &lt;&lt; p1 &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">free</span>(p1);</span><br><span class="line"></span><br><span class="line">    complex&lt;<span class="type">int</span>&gt;* p2 = <span class="keyword">new</span> complex&lt;<span class="type">int</span>&gt;;</span><br><span class="line">    cout &lt;&lt; p2 &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">delete</span> p2;</span><br><span class="line"></span><br><span class="line">    <span class="type">void</span>* p3 = ::<span class="keyword">operator</span> <span class="built_in">new</span>(<span class="number">512</span>);  <span class="comment">// 512 bytes</span></span><br><span class="line">    cout &lt;&lt; p3 &lt;&lt; endl;</span><br><span class="line">    ::<span class="function"><span class="keyword">operator</span> <span class="title">delete</span><span class="params">(p3)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»¥ä¸‹ä½¿ç”¨ C++ æ ‡å‡†åº“æä¾›çš„ allocatorsã€‚</span></span><br><span class="line"><span class="comment">// è™½ç„¶æ¥å£éƒ½æœ‰æ ‡å‡†è§„æ ¼ï¼Œä½†æ˜¯è°ƒç”¨æ–¹å¼ç•¥æœ‰åŒºåˆ«</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _MSC_VER</span></span><br><span class="line">    <span class="comment">// ä»¥ä¸‹å…©å‡½æ•¸éƒ½æ˜¯ non-staticï¼Œå®šè¦é€šé object èª¿ç”¨ã€‚ä»¥ä¸‹åˆ†é… 3 å€‹ ints.</span></span><br><span class="line">    <span class="type">int</span>* p4 = <span class="built_in">allocator</span>&lt;<span class="type">int</span>&gt;().<span class="built_in">allocate</span>(<span class="number">3</span>, (<span class="type">int</span>*)<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">allocator</span>&lt;<span class="type">int</span>&gt;().<span class="built_in">deallocate</span>(p4, <span class="number">3</span>);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __BORLANDC__</span></span><br><span class="line">    <span class="comment">// ä»¥ä¸‹å…©å‡½æ•¸éƒ½æ˜¯ non-staticï¼Œå®šè¦é€šé object èª¿ç”¨ã€‚ä»¥ä¸‹åˆ†é… 5 å€‹ ints.</span></span><br><span class="line">    <span class="type">int</span>* p4 = <span class="built_in">allocator</span>&lt;<span class="type">int</span>&gt;().<span class="built_in">allocate</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="built_in">allocator</span>&lt;<span class="type">int</span>&gt;().<span class="built_in">deallocate</span>(p4, <span class="number">5</span>);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è°ƒç”¨è¿™ä¸€ä¸ª</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __GNUC__</span></span><br><span class="line">    <span class="comment">// ä»¥ä¸‹å…©å‡½æ•¸éƒ½æ˜¯ staticï¼Œå¯é€šéå…¨åèª¿ç”¨ä¹‹ã€‚ä»¥ä¸‹åˆ†é… 512 bytes.</span></span><br><span class="line">    <span class="comment">// void* p4 = alloc::allocate(512);</span></span><br><span class="line">    <span class="comment">// alloc::deallocate(p4, 512);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»¥ä¸‹å…©å‡½æ•¸éƒ½æ˜¯ non-staticï¼Œå®šè¦é€šé object èª¿ç”¨ã€‚ä»¥ä¸‹åˆ†é… 7 å€‹ ints.</span></span><br><span class="line">    <span class="type">void</span>* p4 = <span class="built_in">allocator</span>&lt;<span class="type">int</span>&gt;().<span class="built_in">allocate</span>(<span class="number">7</span>);</span><br><span class="line">    cout &lt;&lt; p4 &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">allocator</span>&lt;<span class="type">int</span>&gt;().<span class="built_in">deallocate</span>((<span class="type">int</span>*)p4, <span class="number">7</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»¥ä¸‹å…©å‡½æ•¸éƒ½æ˜¯ non-staticï¼Œå®šè¦é€šé object èª¿ç”¨ã€‚ä»¥ä¸‹åˆ†é… 9 å€‹ ints.</span></span><br><span class="line">    <span class="type">void</span>* p5 = __gnu_cxx::__pool_alloc&lt;<span class="type">int</span>&gt;().<span class="built_in">allocate</span>(<span class="number">9</span>);</span><br><span class="line">    cout &lt;&lt; p5 &lt;&lt; endl;</span><br><span class="line">    __gnu_cxx::__pool_alloc&lt;<span class="type">int</span>&gt;().<span class="built_in">deallocate</span>((<span class="type">int</span>*)p5, <span class="number">9</span>);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="new-expression"><a href="#new-expression" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#new-expression"></a> new expression</h3><p>ä½¿ç”¨newå…³é”®å­—ä¹‹åç¼–è¯‘å™¨ä¼šæŠŠè¿™ä¸²ä»£ç ç¿»è¯‘ä¸ºå¦‚ä¸‹ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230518143501227.png" alt="image-20230518143501227"></p><p><strong>newå…³é”®å­—ä½¿ç”¨ä¹‹åé‡è¦çš„å°±æ‰§è¡Œäº†ä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥æ˜¯åˆ†é…å†…å­˜ï¼Œç¬¬äºŒæ­¥æ˜¯è°ƒç”¨æ„é€ å‡½æ•°</strong></p><h4 id="delete-expression"><a href="#delete-expression" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#delete-expression"></a> delete expression</h4><p>ä¸newç›¸å¯¹åº”çš„å°±æœ‰deleteå…³é”®å­—</p><p><strong>deleteå…³é”®å­—ä½¿ç”¨çš„æ—¶å€™æ‰§è¡Œäº†ä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥æ˜¯è°ƒç”¨ææ„å‡½æ•°ï¼Œç¬¬äºŒæ­¥æ˜¯é‡Šæ”¾å†…å­˜</strong></p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230518150122803.png" alt="image-20230518150122803" style="zoom:67%"><p>ä¸Šé¢ä¸¤å‰¯å›¾ç‰‡å½“ä¸­ï¼Œ<strong>é€šè¿‡æŒ‡é’ˆï¼Œæ„é€ å‡½æ•°ä¸èƒ½è¢«ç›´æ¥è°ƒç”¨ï¼Œè€Œææ„å‡½æ•°å¯ä»¥è¢«ç›´æ¥è°ƒç”¨</strong></p><p><strong>å¦‚æœéè¦è°ƒç”¨çš„è¯ï¼Œå¯ä»¥ç”¨ placement new</strong> (ç°åœ¨ä¸ç†è§£ä»€ä¹ˆæ„æ€)</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span>(p) <span class="built_in">Complex</span>(<span class="number">1</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></div></figure><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªæµ‹è¯•ç¨‹åºï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">A</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="built_in">A</span>(<span class="type">int</span> id) : _id(id) &#123; cout &lt;&lt; <span class="string">&quot;ctor. this = &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="string">&quot; id = &quot;</span> &lt;&lt; id &lt;&lt; endl; &#125;</span><br><span class="line">    ~<span class="built_in">A</span>() &#123; cout &lt;&lt; <span class="string">&quot;dtor. this = &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; endl; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> _id;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    string* pstr = <span class="keyword">new</span> string;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;str= &quot;</span> &lt;&lt; *pstr &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// pstr-&gt;string::string(&quot;hello&quot;);  // â€˜class std::__cxx11::basic_string&lt;char&gt;â€™ has no member named â€˜stringâ€™</span></span><br><span class="line">    <span class="comment">// pstr-&gt;~string();//crash</span></span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;str= &quot;</span> &lt;&lt; *pstr &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    A* pA = <span class="keyword">new</span> <span class="built_in">A</span>(<span class="number">1</span>);</span><br><span class="line">    cout &lt;&lt; pA-&gt;_id &lt;&lt; endl;  <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// pA-&gt;A::A(3);//cannot call constructor â€˜A::Aâ€™ directly</span></span><br><span class="line">    <span class="comment">// A::A(5);</span></span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; pA-&gt;_id &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> pA;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="array-newarray-delete"><a href="#array-newarray-delete" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#array-newarray-delete"></a> array new,array delete</h3><p>æ³¨æ„ï¼šarray new ä¸€å®šè¦æ­é… array deleteï¼Œå¦åˆ™å°±æå®¹æ˜“å‘ç”Ÿå†…å­˜æ³„æ¼</p><p><strong>è¿™ä¸ªå†…å­˜æ³„éœ²å¯¹äºå°¤å…¶æ˜¯class with pointersï¼Œé€šå¸¸å¸¦æœ‰å½±å“</strong></p><p>å› ä¸ºå¯¹äºæ²¡æœ‰æŒ‡é’ˆçš„ç±»ï¼Œåªéœ€è¦é‡Šæ”¾è¿™ä¸ªç±»å¯¹è±¡çš„æŒ‡é’ˆå°±å¯ä»¥äº†ï¼Œå› æ­¤è°ƒç”¨ä¸€æ¬¡å’Œä¸‰æ¬¡çš„dtoræ²¡æœ‰æ˜æ˜¾çš„åŒºåˆ«ï¼Œæ¢å¥è¯è¯´å°±æ˜¯è¿™ä¸ªç±»çš„dtoræ˜¯trivial(ä¸é‡è¦çš„)ï¼Œä½†æ˜¯å¸¦æœ‰æŒ‡é’ˆçš„ç±»å°±ä¸ä¸€æ ·äº†</p><p>æ¯”å¦‚ä¸‹é¢stringé‚£ä¸ªä¾‹å­ï¼Œåªæ¢èµ·ä¸€æ¬¡dtorï¼Œé‚£ä¹ˆä¸‰ä¸ªstringæŒ‡å‘çš„ä¸œè¥¿åªè¢«é‡Šæ”¾äº†ä¸€ä¸ªï¼Œç„¶åæ•´ä½“å°±è¢«é‡Šæ”¾äº†ï¼Œå‰©ä½™çš„ä¸¤å—å†…å­˜æ€ä¹ˆåŠå‘¢ï¼Ÿå› æ­¤ä¼šå¯¼è‡´å†…å­˜æ³„æ¼</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230518154018869.png" alt="image-20230518154018869"></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> size 3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">A</span>() : _id(<span class="number">0</span>) &#123; cout &lt;&lt; <span class="string">&quot;default ctor. this = &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="string">&quot; id = &quot;</span> &lt;&lt; _id &lt;&lt; endl; &#125;</span><br><span class="line">    <span class="built_in">A</span>(<span class="type">int</span> id) : _id(id) &#123; cout &lt;&lt; <span class="string">&quot;ctor. this = &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="string">&quot; id = &quot;</span> &lt;&lt; _id &lt;&lt; endl; &#125;</span><br><span class="line">    ~<span class="built_in">A</span>() &#123; cout &lt;&lt; <span class="string">&quot;dtor. this = &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="string">&quot; id = &quot;</span> &lt;&lt; _id &lt;&lt; endl; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> _id;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    A* buf = <span class="keyword">new</span> A[size];  <span class="comment">// Aå¿…é¡»æœ‰é»˜è®¤æ„é€ å‡½æ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™</span></span><br><span class="line">    A* tmp = buf;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;buf= &quot;</span> &lt;&lt; buf &lt;&lt; <span class="string">&quot; tmp= &quot;</span> &lt;&lt; tmp &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; size; ++i)</span><br><span class="line">        <span class="keyword">new</span> (tmp++) <span class="built_in">A</span>(i);  <span class="comment">// placement new , ctor ä¸‰æ¬¡</span></span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;buf= &quot;</span> &lt;&lt; buf &lt;&lt; <span class="string">&quot; tmp= &quot;</span> &lt;&lt; tmp &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span>[] buf;  <span class="comment">// dtor 3æ¬¡ï¼Œæ¬¡åºåè¿‡æ¥ 3 2 1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ‰§è¡Œç»“æœ</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230518160118276.png" alt="image-20230518160118276" style="zoom:67%"><h4 id="å†…å­˜åˆ†å¸ƒ"><a href="#å†…å­˜åˆ†å¸ƒ" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å†…å­˜åˆ†å¸ƒ"></a> å†…å­˜åˆ†å¸ƒ</h4><p>å†…å­˜çš„åº•å±‚å¼€è¾Ÿå’Œé‡Šæ”¾éƒ½æ˜¯è°ƒç”¨çš„mallocå’Œfreeï¼Œé‚£ä¹ˆè°ƒç”¨äº†mallocä¹‹åä¼šç»™æˆ‘ä»¬çš„å†…å­˜åˆ†å¸ƒå°±å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230518161942376.png" alt="image-20230518161942376"></p><p>å¯ä»¥æµ…è°ˆä¸€ä¸‹è¿™ä¸ªå†…å­˜æ˜¯æ€ä¹ˆåˆ†é…çš„(åé¢éƒ½ä¼šè¿›è¡Œæ·±å…¥çš„æ¢ç©¶ï¼Œä»¥åŠæ¯ä¸€å—çš„ä½œç”¨)</p><p><strong>Demoå¯¹è±¡ï¼š3ä¸ªintï¼Œå æ®12ä¸ªå­—èŠ‚ï¼Œ3ä¸ªæ€»å…±36ä¸ªå­—èŠ‚ï¼›</strong></p><p><strong>ç”±äºä»–å¸¦æœ‰æŒ‡é’ˆï¼Œæ‰€ä»¥éœ€è¦é¢å¤–è®°å½•è¿™ä¸ªæ•°ç»„å¯¹è±¡åŒ…å«Demoçš„ä¸ªæ•°ï¼Œ4ä¸ªå­—èŠ‚ï¼›</strong></p><p><strong>è¿™ä¸ªçœŸæ­£æœ‰æ•ˆçš„æ•°æ®åŒºåŸŸä¸Šä¸‹(é»„è‰²çš„éƒ¨åˆ†)ï¼Œåˆ†åˆ«å æ®32 + 4 ä¸ªå­—èŠ‚ï¼›</strong></p><p><strong>å†…å­˜å—ä¸Šä¸‹çš„ä¸¤ä¸ªcookieï¼Œå„è‡ª4ä¸ªå­—èŠ‚ï¼Œæ€»å…±8ä¸ªå­—èŠ‚ï¼›</strong></p><p><strong>ä¸Šé¢ä¸€å…±åŠ èµ·æ¥84ä¸ªå­—èŠ‚ï¼Œéœ€è¦è°ƒæ•´åˆ°16ä¸ªå­—èŠ‚çš„å€æ•°ï¼Œä¹Ÿå°±æ˜¯96ä¸ªå­—èŠ‚ï¼Œå¤šå‡ºçš„12ä¸ªå­—èŠ‚å­˜æ”¾åœ¨Padä¸­</strong></p><h3 id="placement-new"><a href="#placement-new" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#placement-new"></a> placement new</h3><p><strong>placement newå…è®¸æˆ‘ä»¬å°†å¯¹è±¡å»ºé€ åœ¨å·²ç»åˆ†é…å¥½çš„å†…å­˜å½“ä¸­ï¼ï¼</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230518163205880.png" alt="image-20230518163205880"></p><p><strong>ç¼–è¯‘å™¨ç¿»è¯‘æˆä¸ºçš„é‚£ä¸‰ä¸ªæ“ä½œï¼Œåœ¨ placement new ä¸‹é¢ï¼Œç¬¬ä¸€æ¡ç”±äºä¼ å…¥äº†ä¸€ä¸ªæŒ‡é’ˆï¼Œé‚£ä¹ˆä¼šè°ƒç”¨é‡è½½çš„ç‰ˆæœ¬ï¼Œå…¶å®å°±æ˜¯è¡¨ç¤ºä¸ç”¨æ–°å¼€å†…å­˜ï¼ŒæŠŠåŸæ¥çš„ç»™æˆ‘å°±è¡Œï¼›ç„¶åç¬¬ä¸‰æ¡ç¼–è¯‘å™¨å°±è°ƒç”¨æ„é€ å‡½æ•°åœ¨å·²æœ‰çš„å†…å­˜ä¸Šè¿›è¡Œåˆ›å»ºå¯¹è±¡åˆå§‹åŒ–!!!</strong></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Complex</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Complex</span>() : _re(<span class="number">0</span>), _im(<span class="number">0</span>) &#123;&#125;</span><br><span class="line">    <span class="built_in">Complex</span>(<span class="type">double</span> re, <span class="type">double</span> im) : _re(re), _im(im) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">double</span> _re, _im;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">char</span>* buf = <span class="keyword">new</span> <span class="type">char</span>[<span class="built_in">sizeof</span>(Complex) * <span class="number">3</span>];</span><br><span class="line">    <span class="comment">// ç°åœ¨æƒ³æŠŠä¸€ä¸ªComplexå¯¹è±¡åŠ¨æ€å¼€è¾Ÿåœ¨bufçš„ä¸€ä¸ªComplexå•å…ƒï¼Œè°ƒç”¨placement new</span></span><br><span class="line">    Complex* pc = <span class="built_in">new</span> (buf) <span class="built_in">Complex</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span>[]buf;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h4 id="é‡è½½"><a href="#é‡è½½" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#é‡è½½"></a> é‡è½½</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230518164140667.png" alt="image-20230518164140667"></p><p><strong>é‡è½½æ¯”è¾ƒå¤šçš„å°±æ˜¯åœ¨ç±»ä¸­å»é‡è½½ operator newå’Œ operator deleteï¼Œè¿™æ ·ç¼–è¯‘å™¨åœ¨è°ƒç”¨newæˆ–è€…deleteå…³é”®å­—è§£æåˆ°é‚£ä¸¤æ­¥çš„æ—¶å€™å°±ä¼šä¼˜å…ˆè°ƒç”¨æˆ‘ä»¬é‡è½½çš„ç‰ˆæœ¬ï¼Œåœ¨æˆ‘ä»¬é‡è½½çš„ç‰ˆæœ¬å½“ä¸­å¯ä»¥è®¾è®¡ä¸€äº›ä¸“ç”¨äºè¿™ä¸ªç±»çš„è®¾è®¡ï¼Œè¿™æ ·æˆ–è®¸èƒ½å¤Ÿæé«˜æ•ˆç‡å’ŒèŠ‚çœå¼€é”€</strong></p><p>åœ¨ç±»é‡Œé¢é‡è½½</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230518170044346.png" alt="image-20230518170044346"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230518171104774.png" alt="image-20230518171104774"></p><p>deleteä¸­çš„ç¬¬äºŒå‚æ•°æ˜¯optionalçš„ï¼Œå¯ä»¥å†™ä¹Ÿå¯ä»¥ä¸å†™</p><h4 id="é‡è½½ç¤ºä¾‹"><a href="#é‡è½½ç¤ºä¾‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#é‡è½½ç¤ºä¾‹"></a> é‡è½½ç¤ºä¾‹</h4><p>åœ¨ç±»å½“ä¸­è¿›è¡Œç®€å•çš„é‡è½½ï¼Œå’Œå…¨å±€çš„è¾“å‡ºåšå¯¹æ¯”</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> _id;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Foo</span>() : _id(<span class="number">0</span>) &#123; cout &lt;&lt; <span class="string">&quot;default ctor.this = &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="string">&quot; id = &quot;</span> &lt;&lt; _id &lt;&lt; endl; &#125;</span><br><span class="line">    <span class="built_in">Foo</span>(<span class="type">int</span> id) : _id(id) &#123; cout &lt;&lt; <span class="string">&quot;ctor.this = &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="string">&quot; id = &quot;</span> &lt;&lt; _id &lt;&lt; endl; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// virtual</span></span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Foo</span>() &#123; cout &lt;&lt; <span class="string">&quot;dtor.this = &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="string">&quot; id = &quot;</span> &lt;&lt; _id &lt;&lt; endl; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> *<span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="type">size_t</span> size)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="keyword">operator</span> <span class="title">delete</span><span class="params">(<span class="type">void</span> *ptr, <span class="type">size_t</span> size)</span></span>;</span><br><span class="line">    <span class="type">static</span> <span class="type">void</span> *<span class="keyword">operator</span> <span class="keyword">new</span>[](<span class="type">size_t</span> size);</span><br><span class="line">    <span class="type">static</span> <span class="type">void</span> <span class="keyword">operator</span> <span class="keyword">delete</span>[](<span class="type">void</span> *ptr, <span class="type">size_t</span> size);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> *Foo::<span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Foo *p = <span class="built_in">static_cast</span>&lt;Foo *&gt;(<span class="built_in">malloc</span>(size));</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Foo::operator new(), size = &quot;</span> &lt;&lt; size &lt;&lt; <span class="string">&quot;\treturn : &quot;</span> &lt;&lt; p &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> Foo::<span class="keyword">operator</span> <span class="title">delete</span><span class="params">(<span class="type">void</span> *ptr, <span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Foo::operator delete(), ptr = &quot;</span> &lt;&lt; ptr &lt;&lt; <span class="string">&quot;\tsize = &quot;</span> &lt;&lt; size &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">free</span>(ptr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *Foo::<span class="keyword">operator</span> <span class="keyword">new</span>[](<span class="type">size_t</span> size)</span><br><span class="line">&#123;</span><br><span class="line">    Foo *p = <span class="built_in">static_cast</span>&lt;Foo *&gt;(<span class="built_in">malloc</span>(size));</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Foo::operator new[](), size = &quot;</span> &lt;&lt; size &lt;&lt; <span class="string">&quot;\treturn : &quot;</span> &lt;&lt; p &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> Foo::<span class="keyword">operator</span> <span class="keyword">delete</span>[](<span class="type">void</span> *ptr, <span class="type">size_t</span> size)</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Foo::operator delete[](), ptr = &quot;</span> &lt;&lt; ptr &lt;&lt; <span class="string">&quot;\tsize = &quot;</span> &lt;&lt; size &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">free</span>(ptr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;sizeof(Foo) = &quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(Foo) &lt;&lt; endl</span><br><span class="line">         &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Foo------------------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    Foo *p = <span class="keyword">new</span> Foo;</span><br><span class="line">    <span class="keyword">delete</span> p;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    Foo *pArray = <span class="keyword">new</span> Foo[<span class="number">5</span>]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">    <span class="keyword">delete</span>[] pArray;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; endl</span><br><span class="line">         &lt;&lt; <span class="string">&quot;Global------------------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    Foo *p2 = ::<span class="keyword">new</span> Foo;</span><br><span class="line">    ::<span class="keyword">delete</span> p2;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    Foo *pArray2 = ::<span class="keyword">new</span> Foo[<span class="number">5</span>]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">    ::<span class="keyword">delete</span>[] pArray2;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è¾“å‡ºç»“æœï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528130010432.png" alt="image-20230528130010432"></p><p><strong>æ³¨æ„ï¼š</strong></p><p>æˆ‘ä»¬å¯ä»¥é‡è½½class member operator new()ï¼Œå¯ä»¥å†™å‡ºå¤šä¸ªç‰ˆæœ¬ï¼Œå‰ææ˜¯æ¯ä¸€ä¸ªç‰ˆæœ¬éƒ½å¿…é¡»å£°æ˜ç‹¬ç‰¹çš„å‚æ•°åˆ—ï¼Œå¹¶ä¸”ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯size_tï¼Œå…¶ä½™å‚æ•°ä»¥newæŒ‡å®šçš„placement argumentsä¸ºåˆå€¼ï¼Œå‡ºç°åœ¨new(â€¦)å½“ä¸­çš„å°±æ˜¯æ‰€è°“çš„placement arguments.</p><p>è¿™æ ·å°±å¯ä»¥å†™å‡ºå¾ˆå¤šçš„placement new.</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> * Foo::<span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="type">size_t</span> size,<span class="type">long</span> extra,<span class="type">char</span> ch)</span></span>;</span><br><span class="line"><span class="comment">//è¿™ä¹ˆç”¨</span></span><br><span class="line">Foo* pf=<span class="built_in">new</span>(<span class="number">300</span>,<span class="string">&#x27;c&#x27;</span>) Foo;</span><br></pre></td></tr></table></div></figure><p>æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bad</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Foo</span>() &#123; cout &lt;&lt; <span class="string">&quot;Foo::Foo()&quot;</span> &lt;&lt; endl; &#125;</span><br><span class="line">    <span class="built_in">Foo</span>(<span class="type">int</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Foo::Foo(int)&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">Bad</span>(); <span class="comment">// æ•…æ„åœ¨è¿™é‡ŒæŠ›å‡ºå¼‚å¸¸ï¼Œæµ‹è¯•è°ƒç”¨placement operator delete</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//(1) é€™å€‹å°±æ˜¯ä¸€èˆ¬çš„ operator new() çš„é‡è¼‰</span></span><br><span class="line">    <span class="function"><span class="type">void</span> *<span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;operator new(size_t size), size= &quot;</span> &lt;&lt; size &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">malloc</span>(size);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//(2) é€™å€‹å°±æ˜¯æ¨™æº–åº«å·²ç¶“æä¾›çš„ placement new() çš„é‡è¼‰ (å½¢å¼)</span></span><br><span class="line">    <span class="comment">//    (æ‰€ä»¥æˆ‘ä¹Ÿæ¨¡æ“¬ standard placement new çš„å‹•ä½œ, just return ptr)</span></span><br><span class="line">    <span class="function"><span class="type">void</span> *<span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="type">size_t</span> size, <span class="type">void</span> *start)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;operator new(size_t size, void* start), size= &quot;</span> &lt;&lt; size &lt;&lt; <span class="string">&quot;  start= &quot;</span> &lt;&lt; start &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> start;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//(3) é€™å€‹æ‰æ˜¯å¶„æ–°çš„ placement new</span></span><br><span class="line">    <span class="function"><span class="type">void</span> *<span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="type">size_t</span> size, <span class="type">long</span> extra)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;operator new(size_t size, long extra)  &quot;</span> &lt;&lt; size &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; extra &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">malloc</span>(size + extra);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//(4) é€™åˆæ˜¯ä¸€å€‹ placement new</span></span><br><span class="line">    <span class="function"><span class="type">void</span> *<span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="type">size_t</span> size, <span class="type">long</span> extra, <span class="type">char</span> init)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;operator new(size_t size, long extra, char init)  &quot;</span> &lt;&lt; size &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; extra &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; init &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">malloc</span>(size + extra);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//(5) é€™åˆæ˜¯ä¸€å€‹ placement new, ä½†æ•…æ„å¯«éŒ¯ç¬¬ä¸€åƒæ•¸çš„ type (å®ƒå¿…é ˆæ˜¯ size_t ä»¥æ»¿è¶³æ­£å¸¸çš„ operator new)</span></span><br><span class="line">    <span class="comment">//!  	void* operator new(long extra, char init) &#123; //[Error] &#x27;operator new&#x27; takes type &#x27;size_t&#x27; (&#x27;unsigned int&#x27;) as first parameter [-fpermissive]</span></span><br><span class="line">    <span class="comment">//!	  	cout &lt;&lt; &quot;op-new(long,char)&quot; &lt;&lt; endl;</span></span><br><span class="line">    <span class="comment">//!    	return malloc(extra);</span></span><br><span class="line">    <span class="comment">//!  	&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»¥ä¸‹æ˜¯æ­é…ä¸Šè¿° placement new çš„å„å€‹ called placement delete.</span></span><br><span class="line">    <span class="comment">// ç•¶ ctor ç™¼å‡ºç•°å¸¸ï¼Œé€™å…’å°æ‡‰çš„ operator (placement) delete å°±æœƒè¢«å–šèµ·.</span></span><br><span class="line">    <span class="comment">// æ‡‰è©²æ˜¯è¦è² è²¬é‡‹æ”¾å…¶æ­æª”å…„å¼Ÿ (placement new) åˆ†é…æ‰€å¾—çš„ memory.</span></span><br><span class="line">    <span class="comment">//(1) é€™å€‹å°±æ˜¯ä¸€èˆ¬çš„ operator delete() çš„é‡è¼‰</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="keyword">operator</span> <span class="title">delete</span><span class="params">(<span class="type">void</span> *, <span class="type">size_t</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;operator delete(void*,size_t)  &quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//(2) é€™æ˜¯å°æ‡‰ä¸Šè¿°çš„ (2)</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="keyword">operator</span> <span class="title">delete</span><span class="params">(<span class="type">void</span> *, <span class="type">void</span> *)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;operator delete(void*,void*)  &quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//(3) é€™æ˜¯å°æ‡‰ä¸Šè¿°çš„ (3)</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="keyword">operator</span> <span class="title">delete</span><span class="params">(<span class="type">void</span> *, <span class="type">long</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;operator delete(void*,long)  &quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//(4) é€™æ˜¯å°æ‡‰ä¸Šè¿°çš„ (4)</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ²’æœ‰ä¸€ä¸€å°æ‡‰, ä¹Ÿä¸æœƒæœ‰ä»»ä½•ç·¨è­¯å ±éŒ¯</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="keyword">operator</span> <span class="title">delete</span><span class="params">(<span class="type">void</span> *, <span class="type">long</span>, <span class="type">char</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;operator delete(void*,long,char)  &quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> m_i;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-------------</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_overload_placement_new</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;test_overload_placement_new()..........&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    Foo start; <span class="comment">// Foo::Foo</span></span><br><span class="line"></span><br><span class="line">    Foo *p1 = <span class="keyword">new</span> Foo;            <span class="comment">// op-new(size_t)</span></span><br><span class="line">    Foo *p2 = <span class="built_in">new</span> (&amp;start) Foo;   <span class="comment">// op-new(size_t,void*)</span></span><br><span class="line">    Foo *p3 = <span class="built_in">new</span> (<span class="number">100</span>) Foo;      <span class="comment">// op-new(size_t,long)</span></span><br><span class="line">    Foo *p4 = <span class="built_in">new</span> (<span class="number">100</span>, <span class="string">&#x27;a&#x27;</span>) Foo; <span class="comment">// op-new(size_t,long,char)</span></span><br><span class="line"></span><br><span class="line">    Foo *p5 = <span class="built_in">new</span> (<span class="number">100</span>) <span class="built_in">Foo</span>(<span class="number">1</span>);      <span class="comment">// op-new(size_t,long)  op-del(void*,long)</span></span><br><span class="line">    <span class="comment">//è¿™é‡Œæ•…æ„è°ƒç”¨intç‰ˆæœ¬çš„æ„é€ å‡½æ•°ï¼Œåœ¨æ„é€ å‡½æ•°å½“ä¸­ä¼šæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="comment">//ä¸ºä»€ä¹ˆä¼šæŠ›å‡ºå¼‚å¸¸å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬æ‹…å¿ƒè¿™ä¸ªplacement operator new æˆ‘ä»¬å·²ç»åˆ†é…å‡ºæ¥çš„ç©ºé—´ç”¨åœ¨æ„é€ å‡½æ•°ä¸Šé¢ä¸å¤Ÿ</span></span><br><span class="line">    <span class="comment">//ä¸å¤Ÿçš„æ—¶å€™æ€ä¹ˆåŠå‘¢ï¼Ÿå†…å­˜éƒ½å·²ç»åˆ†é…å‡ºæ¥äº†ï¼Œé‚£å°±åªèƒ½é‡Šæ”¾æ‰ï¼Œè°ƒç”¨ç›¸åº”çš„placement operator delete</span></span><br><span class="line">    Foo *p6 = <span class="built_in">new</span> (<span class="number">100</span>, <span class="string">&#x27;a&#x27;</span>) <span class="built_in">Foo</span>(<span class="number">1</span>); <span class="comment">//</span></span><br><span class="line">    Foo *p7 = <span class="built_in">new</span> (&amp;start) <span class="built_in">Foo</span>(<span class="number">1</span>);   <span class="comment">//</span></span><br><span class="line">    Foo *p8 = <span class="keyword">new</span> <span class="built_in">Foo</span>(<span class="number">1</span>);            <span class="comment">//</span></span><br><span class="line">                                     <span class="comment">// VC6 warning C4291: &#x27;void *__cdecl Foo::operator new(unsigned int)&#x27;</span></span><br><span class="line">                                     <span class="comment">// no matching operator delete found; memory will not be freed if</span></span><br><span class="line">                                     <span class="comment">// initialization throws an exception</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">test_overload_placement_new</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p><strong>æ³¨æ„è¿™é‡Œï¼š</strong></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Foo *p5 = <span class="built_in">new</span> (<span class="number">100</span>) <span class="built_in">Foo</span>(<span class="number">1</span>);</span><br><span class="line"><span class="comment">//è¿™é‡Œæ•…æ„è°ƒç”¨intç‰ˆæœ¬çš„æ„é€ å‡½æ•°ï¼Œåœ¨æ„é€ å‡½æ•°å½“ä¸­ä¼šæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="comment">//ä¸ºä»€ä¹ˆä¼šæŠ›å‡ºå¼‚å¸¸å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬æ‹…å¿ƒè¿™ä¸ªplacement operator new æˆ‘ä»¬å·²ç»åˆ†é…å‡ºæ¥çš„ç©ºé—´ç”¨åœ¨æ„é€ å‡½æ•°ä¸Šé¢ä¸å¤Ÿ</span></span><br><span class="line"><span class="comment">//ä¸å¤Ÿçš„æ—¶å€™æ€ä¹ˆåŠå‘¢ï¼Ÿå†…å­˜éƒ½å·²ç»åˆ†é…å‡ºæ¥äº†ï¼Œé‚£å°±åªèƒ½é‡Šæ”¾æ‰ï¼Œè°ƒç”¨ç›¸åº”çš„placement operator delete</span></span><br></pre></td></tr></table></div></figure><p><strong>åªæœ‰è¿™ç§æƒ…å†µä¸‹ï¼Œctorä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œå¯¹åº”çš„operator deleteæ‰ä¼šè¢«è°ƒç”¨èµ·æ¥ï¼›å¦‚æœä¸å†™ï¼Œé‚£å°±æ˜¯æ”¾å¿ƒè¿™ä¸ªæ„é€ å‡½æ•°å¹¶ä¸”ä¸å»å¤„ç†è¿™ä¸ªå¼‚å¸¸</strong></p><h4 id="basic_stringä½¿ç”¨newextraç”³è¯·æ‰©å……é‡"><a href="#basic_stringä½¿ç”¨newextraç”³è¯·æ‰©å……é‡" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#basic_stringä½¿ç”¨newextraç”³è¯·æ‰©å……é‡"></a> basic_stringä½¿ç”¨new(extra)ç”³è¯·æ‰©å……é‡</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528141445828.png" alt="image-20230528141445828"></p><h3 id="per-class-allocator-ç‰ˆæœ¬1-é‡ç‚¹çœ‹"><a href="#per-class-allocator-ç‰ˆæœ¬1-é‡ç‚¹çœ‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#per-class-allocator-ç‰ˆæœ¬1-é‡ç‚¹çœ‹"></a> per-class allocator ç‰ˆæœ¬1 (é‡ç‚¹çœ‹)</h3><p>è®¾è®¡ä¸€ä¸ªå°å‹çš„å†…å­˜æ± ï¼Œå°å‹çš„å†…å­˜åˆ†é…å™¨ï¼Œç›®å‰æ˜¯ç¬¬ä¸€ç‰ˆæœ¬</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528144912141.png" alt="image-20230528144912141"></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Screen</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Screen</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="built_in">Screen</span>(<span class="type">int</span> x) : _i(x)&#123;&#125;;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">get</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> _i; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> *<span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="type">size_t</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="keyword">operator</span> <span class="title">delete</span><span class="params">(<span class="type">void</span> *, <span class="type">size_t</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Screen *next; <span class="comment">// è¿™ç§è®¾è®¡ä¼šå¼•å‘ä¸€ä¸ªç–‘é—®ï¼Œå°±æ˜¯å¤šæ¶ˆè€—äº†ä¸€ä¸ªæŒ‡é’ˆçš„å†…å­˜ç©ºé—´ï¼Œä½†æ˜¯å¯ä»¥æŠ¹é™¤æ•°ç»„å…ƒç´ ä¹‹é—´çš„cookieï¼Œåªåœ¨æ•°ç»„å¤´å°¾æ”¾cookie</span></span><br><span class="line">    <span class="type">static</span> Screen *freeStore;</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> screenChunk;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> _i;</span><br><span class="line">&#125;;</span><br><span class="line">Screen *Screen::freeStore = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Screen::screenChunk = <span class="number">24</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> *Screen::<span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Screen *p;</span><br><span class="line">    <span class="keyword">if</span> (!freeStore)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// linked list æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥æ”«å–ä¸€å¤§å¡Š memory</span></span><br><span class="line">        <span class="comment">// ä»¥ä¸‹å‘¼å«çš„æ˜¯ global operator new</span></span><br><span class="line">        <span class="type">size_t</span> chunk = screenChunk * size; <span class="comment">// è¿™æ˜¯ä¹˜æ³•ï¼Œè®¡ç®—éœ€è¦çš„å­—èŠ‚æ•°</span></span><br><span class="line">        freeStore = p =</span><br><span class="line">            <span class="built_in">reinterpret_cast</span>&lt;Screen *&gt;(<span class="keyword">new</span> <span class="type">char</span>[chunk]);</span><br><span class="line">        <span class="comment">// å°‡åˆ†é…å¾—ä¾†çš„ä¸€å¤§å¡Š memory ç•¶åš linked list èˆ¬å°å¡Šå°å¡Šä¸²æ¥èµ·ä¾†</span></span><br><span class="line">        <span class="keyword">for</span> (; p != &amp;freeStore[screenChunk - <span class="number">1</span>]; ++p)</span><br><span class="line">            p-&gt;next = p + <span class="number">1</span>;</span><br><span class="line">        p-&gt;next = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    p = freeStore;</span><br><span class="line">    freeStore = freeStore-&gt;next;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//! void Screen::operator delete(void *p)		//(1)</span></span><br><span class="line"><span class="function"><span class="type">void</span> Screen::<span class="keyword">operator</span> <span class="title">delete</span><span class="params">(<span class="type">void</span> *p, <span class="type">size_t</span>)</span> <span class="comment">//(2)äºŒæ“‡ä¸€</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å°‡ deleted object æ”¶å›æ’å…¥ free list å‰ç«¯</span></span><br><span class="line">    (<span class="built_in">static_cast</span>&lt;Screen *&gt;(p))-&gt;next = freeStore;</span><br><span class="line">    freeStore = <span class="built_in">static_cast</span>&lt;Screen *&gt;(p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-------------</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_per_class_allocator_1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;test_per_class_allocator_1().......... \n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="built_in">sizeof</span>(Screen) &lt;&lt; endl; <span class="comment">// 8</span></span><br><span class="line"></span><br><span class="line">    <span class="type">size_t</span> <span class="type">const</span> N = <span class="number">100</span>;</span><br><span class="line">    Screen *p[N];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">        p[i] = <span class="keyword">new</span> <span class="built_in">Screen</span>(i);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¼¸å‡ºå‰ 10 å€‹ pointers, ç”¨ä»¥æ¯”è¼ƒå…¶é–“éš”</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i)</span><br><span class="line">        cout &lt;&lt; p[i] &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">        <span class="keyword">delete</span> p[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_global_allocator</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;test_global_allocator().......... \n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="built_in">sizeof</span>(Screen) &lt;&lt; endl; <span class="comment">// 8</span></span><br><span class="line"></span><br><span class="line">    <span class="type">size_t</span> <span class="type">const</span> N = <span class="number">100</span>;</span><br><span class="line">    Screen *p[N];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">        p[i] = ::<span class="keyword">new</span> <span class="built_in">Screen</span>(i);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¼¸å‡ºå‰ 10 å€‹ pointers, ç”¨ä»¥æ¯”è¼ƒå…¶é–“éš”</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i)</span><br><span class="line">        cout &lt;&lt; p[i] &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">        ::<span class="keyword">delete</span> p[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">test_per_class_allocator_1</span>();</span><br><span class="line">    cout &lt;&lt; endl</span><br><span class="line">         &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">test_global_allocator</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ‰§è¡Œç»“æœï¼š</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528145254800.png" alt="image-20230528145254800" style="zoom:67%"><p>å¯ä»¥çœ‹å‡ºï¼Œè®¾è®¡ä¹‹åçš„å†…å­˜ä¹‹é—´æ²¡æœ‰äº†cookieï¼ŒèŠ‚çœäº†ç©ºé—´ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬è‡ªå·±çš„ä¸€ä¸ªå°å‹å†…å­˜æ± </p><h4 id="per-class-allocator2-ç‰ˆæœ¬2"><a href="#per-class-allocator2-ç‰ˆæœ¬2" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#per-class-allocator2-ç‰ˆæœ¬2"></a> per-class allocator2 ç‰ˆæœ¬2</h4><p><strong>å’Œå‰é¢çš„æ€è·¯åŸºæœ¬ä¸€æ ·ï¼šå°±æ˜¯è¦ä¸€å¤§å—å†…å­˜ï¼Œå½“æ•°ç»„å½¢å¼è¦è¿›æ¥åˆ†é…å†…å­˜çš„æ—¶å€™ï¼Œå¦‚æœè¿™ä¸€å¤§å—å†…å­˜è¿˜æœ‰ç©ºé—´ï¼Œå°±é“¾åœ¨åé¢å°±è¡Œï¼›å¦‚æœæ²¡æœ‰äº†ï¼Œå°±è¦å†è¦ä¸€å¤§å—ç©ºé—´è¿›è¡ŒåŒæ ·çš„æ“ä½œå°±å¯ä»¥äº†ï¼Œæœ€ååœ¨å‰ååŠ ä¸Šcookieå°±å¯ä»¥äº†ã€‚è€Œè¿™ä¸€åˆ‡çš„å‘ç”Ÿéƒ½å¿…é¡»ä¾èµ–äºé™æ€å˜é‡static headOfFreeList!!!ä»–åœ¨æ•´ä¸ªç¨‹åºä¸­åªæœ‰ä¸€ä»½ï¼Œå½“ç„¶å¯ä»¥æ ‡è¯†ã€‚</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528150844128.png" alt="image-20230528150844128"></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Airplane</span> &#123;  <span class="comment">// æ”¯æ´ customized memory management</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">AirplaneRep</span> &#123;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">long</span> miles;</span><br><span class="line">        <span class="type">char</span> type;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">union</span> &#123;</span><br><span class="line">        AirplaneRep rep;  <span class="comment">// æ­¤é‡å° used object</span></span><br><span class="line">        Airplane *next;   <span class="comment">// æ­¤é‡å° free list</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">unsigned</span> <span class="type">long</span> <span class="title">getMiles</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> rep.miles; &#125;</span><br><span class="line">    <span class="function"><span class="type">char</span> <span class="title">getType</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> rep.type; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">set</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> m, <span class="type">char</span> t)</span> </span>&#123;</span><br><span class="line">        rep.miles = m;</span><br><span class="line">        rep.type = t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> *<span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="type">size_t</span> size)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="keyword">operator</span> <span class="title">delete</span><span class="params">(<span class="type">void</span> *deadObject, <span class="type">size_t</span> size)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> BLOCK_SIZE;</span><br><span class="line">    <span class="type">static</span> Airplane *headOfFreeList;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Airplane *Airplane::headOfFreeList;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Airplane::BLOCK_SIZE = <span class="number">512</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> *Airplane::<span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="type">size_t</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœå¤§å°éŒ¯èª¤ï¼Œè½‰äº¤çµ¦ ::operator new()</span></span><br><span class="line">    <span class="keyword">if</span> (size != <span class="built_in">sizeof</span>(Airplane))</span><br><span class="line">        <span class="keyword">return</span> ::<span class="keyword">operator</span> <span class="built_in">new</span>(size);</span><br><span class="line"></span><br><span class="line">    Airplane *p = headOfFreeList;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœ p æœ‰æ•ˆï¼Œå°±æŠŠlisté ­éƒ¨ç§»å¾€ä¸‹ä¸€å€‹å…ƒç´ </span></span><br><span class="line">    <span class="keyword">if</span> (p)</span><br><span class="line">        headOfFreeList = p-&gt;next;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// free list å·²ç©ºã€‚é…ç½®ä¸€å¡Šå¤ å¤§è¨˜æ†¶é«”ï¼Œ</span></span><br><span class="line">        <span class="comment">// ä»¤è¶³å¤ å®¹ç´ BLOCK_SIZE å€‹ Airplanes</span></span><br><span class="line">        Airplane *newBlock = <span class="built_in">static_cast</span>&lt;Airplane *&gt;(::<span class="keyword">operator</span> <span class="built_in">new</span>(BLOCK_SIZE * <span class="built_in">sizeof</span>(Airplane)));</span><br><span class="line">        <span class="comment">// çµ„æˆä¸€å€‹æ–°çš„ free listï¼šå°‡å°å€å¡Šä¸²åœ¨ä¸€èµ·ï¼Œä½†è·³é</span></span><br><span class="line">        <span class="comment">// #0 å…ƒç´ ï¼Œå› ç‚ºè¦å°‡å®ƒå‚³å›çµ¦å‘¼å«è€…ã€‚</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; BLOCK_SIZE - <span class="number">1</span>; ++i)</span><br><span class="line">            newBlock[i].next = &amp;newBlock[i + <span class="number">1</span>];</span><br><span class="line">        newBlock[BLOCK_SIZE - <span class="number">1</span>].next = <span class="number">0</span>;  <span class="comment">// ä»¥nullçµæŸ</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°‡ p è¨­è‡³é ­éƒ¨ï¼Œå°‡ headOfFreeList è¨­è‡³</span></span><br><span class="line">        <span class="comment">// ä¸‹ä¸€å€‹å¯è¢«é‹ç”¨çš„å°å€å¡Šã€‚</span></span><br><span class="line">        p = newBlock;</span><br><span class="line">        headOfFreeList = &amp;newBlock[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// operator delete æ¥ç²ä¸€å¡Šè¨˜æ†¶é«”ã€‚</span></span><br><span class="line"><span class="comment">// å¦‚æœå®ƒçš„å¤§å°æ­£ç¢ºï¼Œå°±æŠŠå®ƒåŠ åˆ° free list çš„å‰ç«¯</span></span><br><span class="line"><span class="function"><span class="type">void</span> Airplane::<span class="keyword">operator</span> <span class="title">delete</span><span class="params">(<span class="type">void</span> *deadObject,</span></span></span><br><span class="line"><span class="params"><span class="function">                               <span class="type">size_t</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (deadObject == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (size != <span class="built_in">sizeof</span>(Airplane)) &#123;</span><br><span class="line">        ::<span class="function"><span class="keyword">operator</span> <span class="title">delete</span><span class="params">(deadObject)</span></span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Airplane *carcass =</span><br><span class="line">        <span class="built_in">static_cast</span>&lt;Airplane *&gt;(deadObject);</span><br><span class="line"></span><br><span class="line">    carcass-&gt;next = headOfFreeList;</span><br><span class="line">    headOfFreeList = carcass;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-------------</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_per_class_allocator_2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;test_per_class_allocator_2().......... \n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="built_in">sizeof</span>(Airplane) &lt;&lt; endl;  <span class="comment">// 8</span></span><br><span class="line"></span><br><span class="line">    <span class="type">size_t</span> <span class="type">const</span> N = <span class="number">100</span>;</span><br><span class="line">    Airplane *p[N];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">        p[i] = <span class="keyword">new</span> Airplane;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éš¨æ©Ÿæ¸¬è©¦ object æ­£å¸¸å¦</span></span><br><span class="line">    p[<span class="number">1</span>]-&gt;<span class="built_in">set</span>(<span class="number">1000</span>, <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line">    p[<span class="number">5</span>]-&gt;<span class="built_in">set</span>(<span class="number">2000</span>, <span class="string">&#x27;B&#x27;</span>);</span><br><span class="line">    p[<span class="number">9</span>]-&gt;<span class="built_in">set</span>(<span class="number">500000</span>, <span class="string">&#x27;C&#x27;</span>);</span><br><span class="line">    cout &lt;&lt; p[<span class="number">1</span>] &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; p[<span class="number">1</span>]-&gt;<span class="built_in">getType</span>() &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; p[<span class="number">1</span>]-&gt;<span class="built_in">getMiles</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; p[<span class="number">5</span>] &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; p[<span class="number">5</span>]-&gt;<span class="built_in">getType</span>() &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; p[<span class="number">5</span>]-&gt;<span class="built_in">getMiles</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; p[<span class="number">9</span>] &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; p[<span class="number">9</span>]-&gt;<span class="built_in">getType</span>() &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; p[<span class="number">9</span>]-&gt;<span class="built_in">getMiles</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¼¸å‡ºå‰ 10 å€‹ pointers, ç”¨ä»¥æ¯”è¼ƒå…¶é–“éš”</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i)</span><br><span class="line">        cout &lt;&lt; p[i] &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">        <span class="keyword">delete</span> p[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_global_allocator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;test_global_allocator().......... \n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="built_in">sizeof</span>(Airplane) &lt;&lt; endl;  <span class="comment">// 8</span></span><br><span class="line"></span><br><span class="line">    <span class="type">size_t</span> <span class="type">const</span> N = <span class="number">100</span>;</span><br><span class="line">    Airplane *p[N];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">        p[i] = ::<span class="keyword">new</span> Airplane;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éš¨æ©Ÿæ¸¬è©¦ object æ­£å¸¸å¦</span></span><br><span class="line">    p[<span class="number">1</span>]-&gt;<span class="built_in">set</span>(<span class="number">1000</span>, <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line">    p[<span class="number">5</span>]-&gt;<span class="built_in">set</span>(<span class="number">2000</span>, <span class="string">&#x27;B&#x27;</span>);</span><br><span class="line">    p[<span class="number">9</span>]-&gt;<span class="built_in">set</span>(<span class="number">500000</span>, <span class="string">&#x27;C&#x27;</span>);</span><br><span class="line">    cout &lt;&lt; p[<span class="number">1</span>] &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; p[<span class="number">1</span>]-&gt;<span class="built_in">getType</span>() &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; p[<span class="number">1</span>]-&gt;<span class="built_in">getMiles</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; p[<span class="number">5</span>] &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; p[<span class="number">5</span>]-&gt;<span class="built_in">getType</span>() &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; p[<span class="number">5</span>]-&gt;<span class="built_in">getMiles</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; p[<span class="number">9</span>] &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; p[<span class="number">9</span>]-&gt;<span class="built_in">getType</span>() &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; p[<span class="number">9</span>]-&gt;<span class="built_in">getMiles</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¼¸å‡ºå‰ 10 å€‹ pointers, ç”¨ä»¥æ¯”è¼ƒå…¶é–“éš”</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i)</span><br><span class="line">        cout &lt;&lt; p[i] &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">        ::<span class="keyword">delete</span> p[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">test_per_class_allocator_2</span>();</span><br><span class="line">    cout &lt;&lt; endl</span><br><span class="line">         &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">test_global_allocator</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ‰§è¡Œç»“æœï¼š</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528151704324.png" alt="image-20230528151704324" style="zoom:67%"><p><strong>ä½†æ˜¯è¿™ä¸ªè®¾è®¡æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä½ ä¸€æ¬¡æ€§æ‹¿äº†å¾ˆå¤šçš„å†…å­˜ï¼Œå‡å¦‚å‰©ä¸‹çš„ç©ºç™½å†…å­˜è¿˜å¾ˆå¤šçš„è¯ï¼Œåœ¨é‡Šæ”¾çš„æ—¶å€™ç†åº”å°†ä»–ä»¬è¿˜ç»™å†…å­˜ï¼Œä½†æ˜¯åœ¨ä¸Šé¢çš„operator deleteå½“ä¸­å¹¶æ²¡æœ‰å°†å…¶å½’è¿˜ç»™æ“ä½œç³»ç»Ÿï¼Œè¿™æ ·ä¸èƒ½è¯´å¥½ä¹Ÿä¸èƒ½è¯´ä¸å¥½ã€‚é¦–å…ˆå°±æ˜¯å½’è¿˜è¿™ä¸ªæŠ€æœ¯æ“ä½œå¤ªéš¾äº†ï¼Œå…¶æ¬¡å°±æ˜¯è™½ç„¶æˆ‘æ²¡æœ‰å½’è¿˜ï¼Œä½†æ˜¯æˆ‘ä¹Ÿæ²¡æœ‰å‘ç”Ÿå†…å­˜æ³„æ¼å•Šï¼Œè¿™ä¸€æ®µå†…å­˜è¿˜æ˜¯åœ¨æˆ‘çš„æ‰‹ä¸Šï¼Œåªæ˜¯è¢«å½’å…¥äº†freeListå½“ä¸­è€Œå·²ã€‚</strong></p><h4 id="static-allocator-ç‰ˆæœ¬3"><a href="#static-allocator-ç‰ˆæœ¬3" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#static-allocator-ç‰ˆæœ¬3"></a> static allocator ç‰ˆæœ¬3</h4><p>ä¸Šé¢çš„å†…å­˜åˆ†é…çš„è®¾è®¡å¯¹äºæŸä¸ªæŒ‡å®šçš„ç±»æ˜¯éå¸¸æœ‰æ•ˆæœçš„ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸å¯èƒ½å¯¹äºæ¯ä¸€ä¸ªç±»éƒ½è¿™ä¹ˆå¹²å§ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªæ™®éçš„è®¾è®¡æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬æŠŠä¸Šé¢çš„æ“ä½œ(æŒ–ä¸€å¤§å—å†…å­˜â€¦)å°è£…æˆä¸ºä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»å°±å«åšallocator</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528152603160.png" alt="image-20230528152603160"></p><p>static allocatorå…·ä½“å¯ä»¥åœ¨ç±»é‡Œé¢å°±è¿™ä¹ˆç”¨ï¼Œå†…å­˜ç®¡ç†å¤æ‚çš„æ–¹é¢å°±äº¤ç»™è¿™ä¸ªç±»å»ç®¡ç†äº†ï¼Œä¸ç”¨æˆ‘ä»¬å¯¹æ¯ä¸€ä¸ªç±»éƒ½ç‰¹æ®Šå¤„ç†</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528153147163.png" alt="image-20230528153147163"></p><p><strong>æ³¨æ„ä¸€ç‚¹å°±æ˜¯ï¼Œstaticå˜é‡éœ€è¦åœ¨ç±»å¤–åˆå§‹åŒ–æˆ–è€…å®šä¹‰ï¼Œå¦‚å›¾å°±æ˜¯ç±»å¤–çš„å®šä¹‰ã€‚</strong></p><p>é‚£ä¹ˆallocatoré‡Œé¢å…·ä½“å¹²ä»€ä¹ˆå‘¢ï¼Ÿå›é¡¾ä¸€ä¸‹</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528153255732.png" alt="image-20230528153255732"></p><p>æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;complex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;__allocator.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// macro å®</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DECLARE_POOL_ALLOC()                                           \</span></span><br><span class="line"><span class="meta">public:                                                                \</span></span><br><span class="line"><span class="meta">    void *operator new(size_t size) &#123; return myAlloc.allocate(size); &#125; \</span></span><br><span class="line"><span class="meta">    void operator delete(void *p) &#123; myAlloc.deallocate(p, 0); &#125;        \</span></span><br><span class="line"><span class="meta">                                                                       \</span></span><br><span class="line"><span class="meta">protected:                                                             \</span></span><br><span class="line"><span class="meta">    static __allocator myAlloc;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IMPLEMENT_POOL_ALLOC(class_name) \</span></span><br><span class="line"><span class="meta">    __allocator class_name::myAlloc;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span> &#123;</span><br><span class="line">    <span class="built_in">DECLARE_POOL_ALLOC</span>()</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">long</span> L;</span><br><span class="line">    string str;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Foo</span>(<span class="type">long</span> l) : <span class="built_in">L</span>(l) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// in class implementation file</span></span><br><span class="line"><span class="built_in">IMPLEMENT_POOL_ALLOC</span>(Foo)</span><br><span class="line"></span><br><span class="line"><span class="comment">//  in class definition file</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Goo</span> &#123;</span><br><span class="line">    <span class="built_in">DECLARE_POOL_ALLOC</span>()</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    complex&lt;<span class="type">double</span>&gt; c;</span><br><span class="line">    string str;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Goo</span>(<span class="type">const</span> complex&lt;<span class="type">double</span>&gt; &amp;x) : <span class="built_in">c</span>(x) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// in class implementation file</span></span><br><span class="line"><span class="built_in">IMPLEMENT_POOL_ALLOC</span>(Goo)</span><br><span class="line"></span><br><span class="line"><span class="comment">//-------------</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_static_allocator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;test_static_allocator().......... \n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; endl;</span><br><span class="line">        Foo *p[<span class="number">100</span>];</span><br><span class="line"></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;sizeof(Foo)= &quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(Foo) &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">23</span>; ++i) &#123;  <span class="comment">// 23,ä»»æ„æ•¸, éš¨æ„çœ‹çœ‹çµæœ</span></span><br><span class="line">            p[i] = <span class="keyword">new</span> <span class="built_in">Foo</span>(i);</span><br><span class="line">            cout &lt;&lt; p[i] &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; p[i]-&gt;L &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Foo::myAlloc.check();</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">23</span>; ++i) &#123;</span><br><span class="line">            <span class="keyword">delete</span> p[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Foo::myAlloc.check();</span></span><br><span class="line"></span><br><span class="line">        cout &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; endl;</span><br><span class="line">        Goo *p[<span class="number">100</span>];</span><br><span class="line"></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;sizeof(Goo)= &quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(Goo) &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">17</span>; ++i) &#123;  <span class="comment">// 17,ä»»æ„æ•¸, éš¨æ„çœ‹çœ‹çµæœ</span></span><br><span class="line">            p[i] = <span class="keyword">new</span> <span class="built_in">Goo</span>(<span class="built_in">complex</span>&lt;<span class="type">double</span>&gt;(i, i));</span><br><span class="line">            cout &lt;&lt; p[i] &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; p[i]-&gt;c &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Goo::myAlloc.check();</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">17</span>; ++i) &#123;</span><br><span class="line">            <span class="keyword">delete</span> p[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Goo::myAlloc.check();</span></span><br><span class="line"></span><br><span class="line">        cout &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">test_static_allocator</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ‰§è¡Œç»“æœï¼š</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528160530816.png" alt="image-20230528160530816" style="zoom:67%"><h4 id="macro-for-static-allocator-ç‰ˆæœ¬4-å·æ‡’"><a href="#macro-for-static-allocator-ç‰ˆæœ¬4-å·æ‡’" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#macro-for-static-allocator-ç‰ˆæœ¬4-å·æ‡’"></a> macro for static allocator ç‰ˆæœ¬4 (å·æ‡’)</h4><p>å› ä¸ºä¸Šé¢çš„static allocatorçš„æ ¼å¼å†™çš„éå¸¸å›ºå®šï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æƒ³åŠæ³•ç»™ä»–ç®€åŒ–ä¸€ä¸‹ï¼Œå·å·æ‡’</p><p>ç”¨C++ä¸­çš„å®æ¥æ›¿ä»£ï¼Œå¯ä»¥å¾—å‡ºå¾ˆå¤šæœ‰è¶£çš„ä¸œè¥¿</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528155257804.png" alt="image-20230528155257804"></p><p>æ”¹è¿›åçš„ä»£ç ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// macro å®</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DECLARE_POOL_ALLOC()                                           \</span></span><br><span class="line"><span class="meta">public:                                                                \</span></span><br><span class="line"><span class="meta">    void *operator new(size_t size) &#123; return myAlloc.allocate(size); &#125; \</span></span><br><span class="line"><span class="meta">    void operator delete(void *p) &#123; myAlloc.deallocate(p, 0); &#125;        \</span></span><br><span class="line"><span class="meta">                                                                       \</span></span><br><span class="line"><span class="meta">protected:                                                             \</span></span><br><span class="line"><span class="meta">    static __allocator myAlloc;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IMPLEMENT_POOL_ALLOC(class_name) \</span></span><br><span class="line"><span class="meta">    __allocator class_name::myAlloc;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span> &#123;</span><br><span class="line">    <span class="built_in">DECLARE_POOL_ALLOC</span>()</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">long</span> L;</span><br><span class="line">    string str;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Foo</span>(<span class="type">long</span> l) : <span class="built_in">L</span>(l) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// in class implementation file</span></span><br><span class="line"><span class="built_in">IMPLEMENT_POOL_ALLOC</span>(Foo)</span><br><span class="line"></span><br><span class="line"><span class="comment">//  in class definition file</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Goo</span> &#123;</span><br><span class="line">    <span class="built_in">DECLARE_POOL_ALLOC</span>()</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    complex&lt;<span class="type">double</span>&gt; c;</span><br><span class="line">    string str;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Goo</span>(<span class="type">const</span> complex&lt;<span class="type">double</span>&gt; &amp;x) : <span class="built_in">c</span>(x) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// in class implementation file</span></span><br><span class="line"><span class="built_in">IMPLEMENT_POOL_ALLOC</span>(Goo)</span><br></pre></td></tr></table></div></figure><h3 id="global-allocator-æ ‡å‡†åº“çš„é‚£ä¸ªéå¸¸æ£’çš„alloc"><a href="#global-allocator-æ ‡å‡†åº“çš„é‚£ä¸ªéå¸¸æ£’çš„alloc" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#global-allocator-æ ‡å‡†åº“çš„é‚£ä¸ªéå¸¸æ£’çš„alloc"></a> global allocator æ ‡å‡†åº“çš„é‚£ä¸ªéå¸¸æ£’çš„alloc</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528160553832.png" alt="image-20230528160553832"></p><h3 id="new-handler"><a href="#new-handler" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#new-handler"></a> new handler</h3><p>å½“operator newæ²¡æœ‰èƒ½åŠ›ä¸ºæˆ‘ä»¬åˆ†é…æˆåŠŸæˆ‘ä»¬æ‰€ç”³è¯·çš„memoryçš„æ—¶å€™ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ std::bad_allocï¼Œæˆ‘ä»¬åº”è¯¥è¦é‡‡å–ä¸€äº›æªæ–½æ¥åº”å¯¹è¿™ä¸ª</p><p>å¦‚æœæƒ³è¦ç¼–è¯‘å™¨ä¸€å®šè¦è¿”å›0è€Œä¸æ˜¯æŠ›å‡ºå¼‚å¸¸çš„è¯å¯ä»¥è¿™ä¹ˆåš:</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span>(nothrow) Foo;</span><br></pre></td></tr></table></div></figure><p>å½“ç„¶æ ‡å‡†åº“åœ¨æŠ›å‡ºå¼‚å¸¸ä¹‹å‰ä¼šè°ƒç”¨ä¾æ¬¡å¯ä»¥ç”±ç”¨æˆ·æŒ‡å®šçš„handlerï¼Œå¦‚ä½•è®¾è®¡å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230528171600254.png" alt="image-20230528171600254"></p><p>è¿™æ ·å°±å¯ä»¥åœ¨æŠ›å‡ºå¼‚å¸¸ä¹‹å‰è‡ªå®šä¹‰ä¸€äº›å¤„ç†æ“ä½œï¼Œä¾‹å¦‚Abort()æˆ–è€…exit()ç­‰ç­‰</p><p>è®¾è®¡è‰¯å¥½çš„new handleræœ‰ä¸¤ä¸ªä½œç”¨ï¼š</p><ul><li>è®©æ›´å¤šçš„å†…å­˜å¯ç”¨</li><li>è°ƒç”¨abort()æˆ–è€…exit()</li></ul><p><strong>æ³¨æ„ï¼šnew handlerå¿…é¡»return voidï¼Œç„¶åæ²¡æœ‰å‚æ•°</strong></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// new handlerå¿…é¡»return voidï¼Œç„¶åæ²¡æœ‰å‚æ•°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">noMoreMemory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cerr &lt;&lt; <span class="string">&quot;out of memory\n&quot;</span>;</span><br><span class="line">    <span class="built_in">abort</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_set_new_handler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;test_set_new_handler().......... \n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">set_new_handler</span>(noMoreMemory);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span>* p = <span class="keyword">new</span> <span class="type">int</span>[<span class="number">100000000000000</span>];  <span class="comment">// well, so BIG!</span></span><br><span class="line">    <span class="built_in">assert</span>(p);</span><br><span class="line"></span><br><span class="line">    p = <span class="keyword">new</span> <span class="type">int</span>[<span class="number">100000000000000</span>];  <span class="comment">//[Warning] integer constant is too large for its type</span></span><br><span class="line">    <span class="built_in">assert</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">test_set_new_handler</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>åœ¨è¿™ä¸ªç¨‹åºå½“ä¸­ï¼Œå¦‚æœä¸è°ƒç”¨abort()å‡½æ•°ï¼Œé‚£ä¹ˆç¨‹åºå°±ä¼šå¡åœ¨è¿™ä¸€è¡Œï¼Œ</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>* p = <span class="keyword">new</span> <span class="type">int</span>[<span class="number">100000000000000</span>];  <span class="comment">// well, so BIG!</span></span><br></pre></td></tr></table></div></figure><p>ä¼šä¸€ç›´è¾“å‡ºè‡ªå®šä¹‰çš„é”™è¯¯ä¿¡æ¯ out of memory</p><h3 id="defaultdelete"><a href="#defaultdelete" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#defaultdelete"></a> =default,=delete</h3><p>æ³¨æ„ï¼š</p><p><strong>=default åªèƒ½ç”¨defaultåªèƒ½ç”¨åœ¨big threeä¸­ï¼Œå³default ctor(é»˜è®¤æ„é€ ),copy/move asgn(æ‹·è´/ç§»åŠ¨èµ‹å€¼),copy/move ctor(æ‹·è´/ç§»åŠ¨æ„é€ ),dtor(ææ„å‡½æ•°)å½“ä¸­ï¼Œå› ä¸ºå…¶ä»–çš„å‡½æ•°ç¼–è¯‘å™¨æ²¡æœ‰æä¾›é»˜è®¤çš„ç‰ˆæœ¬</strong></p><p>=delete åˆ™ä¸é™</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">long</span> _x;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Foo</span>(<span class="type">long</span> x = <span class="number">0</span>) : _x(x) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™ä¸¤ä¸ªä¸œè¥¿ä¸èƒ½defaultï¼Œå› ä¸ºç¼–è¯‘å™¨æ²¡æœ‰é»˜è®¤çš„ç‰ˆæœ¬ï¼Œdefaultåªèƒ½ç”¨åœ¨big threeå½“ä¸­ï¼Œå³default ctor,copy/move asgn,copy/move ctor,dtorå½“ä¸­</span></span><br><span class="line">    <span class="comment">// static void *operator new(size_t size) = default;                 //[Error] cannot be defaulted</span></span><br><span class="line">    <span class="comment">// static void operator delete(void *pdead, size_t size) = default;  //[Error] cannot be defaulted</span></span><br><span class="line">    <span class="type">static</span> <span class="type">void</span> *<span class="keyword">operator</span> <span class="keyword">new</span>[](<span class="type">size_t</span> size) = <span class="keyword">delete</span>;</span><br><span class="line">    <span class="type">static</span> <span class="type">void</span> <span class="keyword">operator</span> <span class="keyword">delete</span>[](<span class="type">void</span> *pdead, <span class="type">size_t</span> size) = <span class="keyword">delete</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Goo</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">long</span> _x;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Goo</span>(<span class="type">long</span> x = <span class="number">0</span>) : _x(x) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> *<span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="type">size_t</span> size)</span> </span>= <span class="keyword">delete</span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="keyword">operator</span> <span class="title">delete</span><span class="params">(<span class="type">void</span> *pdead, <span class="type">size_t</span> size)</span> </span>= <span class="keyword">delete</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_delete_and_default_for_new</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;test_delete_and_default_for_new().......... \n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    Foo *p1 = <span class="keyword">new</span> <span class="built_in">Foo</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">delete</span> p1;</span><br><span class="line">    <span class="comment">// Foo* pF = new Foo[10];	//[Error] use of deleted function &#x27;static void* Foo::operator new [](size_t)&#x27;</span></span><br><span class="line">    <span class="comment">// delete [] pF;			//[Error] use of deleted function &#x27;static void Foo::operator delete [](void*, size_t)&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Goo* p2 = new Goo(7);	//[Error] use of deleted function &#x27;static void* Goo::operator new(size_t)&#x27;</span></span><br><span class="line">    <span class="comment">// delete p2;				//[Error] use of deleted function &#x27;static void Goo::operator delete(void*, size_t)&#x27;</span></span><br><span class="line">    Goo *pG = <span class="keyword">new</span> Goo[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">delete</span>[] pG;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">test_delete_and_default_for_new</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h2 id="ç¬¬äºŒè®²stdallocator"><a href="#ç¬¬äºŒè®²stdallocator" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¬¬äºŒè®²stdallocator"></a> ç¬¬äºŒè®²ï¼šstd::allocator</h2><h3 id="malloc"><a href="#malloc" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#malloc"></a> malloc</h3><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230529203344173.png" alt="image-20230529203344173" style="zoom:67%"><p><strong>å½“æˆ‘ä»¬è°ƒç”¨mallocå‡½æ•°çš„æ—¶å€™ï¼Œå›¾å½“ä¸­block sizeçš„éƒ¨åˆ†æ˜¯çœŸå®çš„å­˜æ”¾æˆ‘ä»¬çš„æ•°æ®çš„åœ°æ–¹ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜ä¼šæœ‰å…¶ä»–çš„ä¸œè¥¿ï¼Œåœ¨ä¸Šä¸‹ä¼šæœ‰ä¸¤åŒ…ä¸œè¥¿åˆ†åˆ«å«debug headerå’Œdebug tail(è¿™ä¸ªæ˜¯ä»€ä¹ˆç°åœ¨ä¸å»ç®¡)ï¼Œåœ¨æ•´ä¸ªéƒ¨åˆ†çš„ä¸Šä¸‹ä¼šæœ‰å›ºå®šä¸¤ä¸ªå¤§å°çš„cookieï¼Œè®°å½•è¿™ä¸€æ®µåŒºå—çš„å¤§å°(åªæœ‰åŒºå—å¤§å°ç›¸åŒæ‰å¯ä»¥å»é™¤cookie)ï¼Œä¹Ÿå°±æ˜¯ç±»ä¼¼äºå‰é¢per-class allocatorçš„è®¾è®¡ï¼ŒVC6æ˜¯ä¸Šä¸‹å„å››ä¸ªå­—èŠ‚å…±å…«ä¸ªå­—èŠ‚ï¼›ç„¶åä»–è¦æ±‚è¿™ä¸ªå†…å­˜å—å¿…é¡»è¦æ»¡è¶³å­—èŠ‚æ•°æ˜¯16çš„å€æ•°(ä¸åŒçš„è®¾è®¡å¯èƒ½ä¸åŒ)ï¼Œéœ€è¦æœ‰ä¸€ä¸ªpadå—æ¥è¿›è¡Œè°ƒæ•´ï¼Œæ•´ä¸ªå°±æ˜¯mallocåˆ†é…ç»™æˆ‘ä»¬çš„å†…å­˜</strong></p><h3 id="ä¸åŒç‰ˆæœ¬allocatorçš„å®ç°"><a href="#ä¸åŒç‰ˆæœ¬allocatorçš„å®ç°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä¸åŒç‰ˆæœ¬allocatorçš„å®ç°"></a> ä¸åŒç‰ˆæœ¬allocatorçš„å®ç°</h3><p>ä¸åŒçš„ç¼–è¯‘å™¨å¯¹äºåˆ†é…å™¨allocatorçš„å®ç°éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸‹é¢å°†ä¸¾å‡ ä¸ªç‰ˆæœ¬çš„ä¾‹å­ï¼š</p><h4 id="vc6"><a href="#vc6" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#vc6"></a> VC6</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230529204213232.png" alt="image-20230529204213232"></p><p>VC6çš„ç‰ˆæœ¬é‡Œé¢æ²¡æœ‰åšç‰¹æ®Šè®¾è®¡ï¼Œå°±æ˜¯è°ƒç”¨operator new/deleteï¼Œè¿›è€Œè°ƒç”¨mallocï¼Œfreeï¼Œæ²¡æœ‰å¯¹å†…å­˜è¿›è¡Œç‰¹æ®Šç®¡ç†</p><h4 id="bc5"><a href="#bc5" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#bc5"></a> BC5</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230529205010426.png" alt="image-20230529205010426"></p><p>åŒæ ·BC5çš„ç‰ˆæœ¬ä¹Ÿæ²¡æœ‰åšç‰¹æ®Šè®¾è®¡</p><h4 id="gc29"><a href="#gc29" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#gc29"></a> Gc2.9</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230529210322971.png" alt="image-20230529210322971"></p><p>Gc2.9çš„åˆ†é…å™¨allocatorä¹Ÿæ²¡æœ‰åšç‰¹æ®Šè®¾è®¡</p><p>ä½†æ˜¯Gc2.9çš„å®¹å™¨ä½¿ç”¨çš„åˆ†é…å™¨å´ä¸æ˜¯è¿™ä¸ªallocatorï¼Œè€Œæ˜¯ä¸€ä¸ªè®¾è®¡çš„éå¸¸å¥½çš„alloc</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230529210616933.png" alt="image-20230529210616933"></p><p>ä¸‹é¢å°†ä¼šä»‹ç»</p><h4 id="pool-allocgc49-éå¸¸æ£’çš„ç‰ˆæœ¬"><a href="#pool-allocgc49-éå¸¸æ£’çš„ç‰ˆæœ¬" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#pool-allocgc49-éå¸¸æ£’çš„ç‰ˆæœ¬"></a> pool alloc(Gc4.9) éå¸¸æ£’çš„ç‰ˆæœ¬</h4><p>ä»¥ä¸‹æ˜¯Gc2.9å’ŒGc4.9å¯¹è¿™ä¸ªçš„å®ç°</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230529211045422.png" alt="image-20230529211045422"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230529211059007.png" alt="image-20230529211059007"></p><p>Gc4.9æœ‰å¾ˆå¤šæ‰©å……çš„alloctorsï¼Œå…¶ä¸­ __gnu_cxx::__pool_alloc&lt;&gt; å°±æ˜¯è¿™ä¸ªéå¸¸å¥½çš„åˆ†é…å™¨</p><p>è°ƒç”¨è¿™ä¸ªéå¸¸å¥½çš„åˆ†é…å™¨çš„æ—¶å€™è¿˜è¦å¼•å…¥å¤´æ–‡ä»¶</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ext/pool_allocator.h&gt;</span></span></span><br></pre></td></tr></table></div></figure><p><strong>æ³¨æ„ï¼šGc4.9å½“ä¸­æ ‡å‡†åº“ä½¿ç”¨çš„åˆ†é…å™¨å¹¶ä¸æ˜¯è¿™ä¸ªå¾ˆå¥½çš„alloc,è€Œæ˜¯ä¸Šé¢æåˆ°çš„allocator!!!</strong></p><h4 id="gc49æ ‡å‡†åˆ†é…å™¨allocatorä¸æ˜¯allocçš„å®ç°"><a href="#gc49æ ‡å‡†åˆ†é…å™¨allocatorä¸æ˜¯allocçš„å®ç°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#gc49æ ‡å‡†åˆ†é…å™¨allocatorä¸æ˜¯allocçš„å®ç°"></a> Gc4.9æ ‡å‡†åˆ†é…å™¨allocator(ä¸æ˜¯alloc)çš„å®ç°</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230529211708274.png" alt="image-20230529211708274"></p><p>è¿™ä¸ªåˆ†é…å™¨å°±æ˜¯ä¸€èˆ¬çš„è°ƒç”¨mallocå’Œfreeï¼Œä¸åšç‰¹æ®Šè®¾è®¡</p><p><strong>é‚£ä¹ˆä½¿ç”¨allocä¸é€‚ç”¨allocatorçš„å¥½å¤„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</strong></p><p><strong>ç­”æ¡ˆæ˜¯å»é™¤äº†cookieï¼Œæ¯”å¦‚æ”¾å…¥ä¸€ç™¾ä¸‡ä¸ªå…ƒç´ ï¼Œä½¿ç”¨cookieå°±èŠ‚çœäº†å…«ç™¾ä¸‡ä¸ªå­—èŠ‚çš„ç©ºé—´ï¼Œè¿™æ ·å‡å°‘äº†å†…å­˜å¼€é”€</strong></p><h3 id="gc29-stdallocå¾ˆå¥½çš„åˆ†é…å™¨çš„å®ç°"><a href="#gc29-stdallocå¾ˆå¥½çš„åˆ†é…å™¨çš„å®ç°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#gc29-stdallocå¾ˆå¥½çš„åˆ†é…å™¨çš„å®ç°"></a> Gc2.9 std::alloc(å¾ˆå¥½çš„åˆ†é…å™¨)çš„å®ç°</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530104526960.png" alt="image-20230530104526960"></p><p><strong>è¿™ä¸ªä¸œè¥¿çš„åŸºæœ¬åŸç†å’Œæˆ‘ä»¬è®¾è®¡çš„per-class allocatoræ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ç°åœ¨ä»–è®¾è®¡äº†16æ¡free_list,åˆ†åˆ«ç®¡ç†ä¸åŒå¤§å°çš„å†…å­˜ï¼Œå¤§å°ä»å°åˆ°å¤§ï¼Œ8ä¸ªå­—èŠ‚ï¼Œ16ä¸ªå­—èŠ‚ç­‰ç­‰ç­‰ï¼›å¦‚æœç”¨æˆ·éœ€è¦çš„å¤§å°ä¸æ˜¯8çš„å€æ•°ä¼šè¢«è°ƒæ•´åˆ°8çš„å€æ•°ï¼Œç„¶åè¿›å…¥å¯¹åº”çš„é“¾è¡¨ä¸­ï¼›åœ¨è¯¥é“¾è¡¨ä¸­ä¸€æ¬¡æ€§å»å–ä¸€å¤§å—çš„å†…å­˜ï¼Œåœ¨å›¾ä¸­çš„è®¾è®¡ä¸­æ˜¯20ä¸ºæ ‡å‡†é‡ï¼Œæ¯”å¦‚å¯ä»¥å–20*32å­—èŠ‚çš„å†…å­˜ï¼Œè¿™æ ·ç›¸é‚»çš„ä¹‹é—´å°±æ²¡æœ‰cookieï¼Œæ–°çš„éœ€æ±‚è¿›æ¥ä¹‹åå¦‚æœè¿˜æœ‰ç©ºé—´å°±ç§»åŠ¨æŒ‡é’ˆå­˜å‚¨å°±å¥½äº†ï¼Œæ²¡æœ‰å°±ç»§ç»­æŒ–ä¸€å¤§å—ï¼Œè¿™æ ·å°±å½¢æˆäº†å»é™¤cookieï¼Œä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸å¥½çš„å†…å­˜æ± çš„è®¾è®¡ï¼›ç°åœ¨å¦‚æœéœ€è¦çš„å†…å­˜å¤§å°è¶…è¿‡è¿™ä¸ªé“¾è¡¨å¯ä»¥ç»´æŠ¤çš„æœ€å¤§å¤§å°ï¼Œè¿™ä¸ªåˆ†é…å™¨å°±ä¸ç”¨è¿™ä¹ˆç²¾å¦™çš„è®¾è®¡å»åšäº†ï¼Œå› ä¸ºæ•°æ®å—çš„å¤§å°æ¯”cookieå¤§å¤šäº†ï¼Œæµªè´¹æ˜¯å¯ä»¥æ¥å—çš„ï¼Œè¿™ä¸ªæ—¶å€™å°±è°ƒç”¨ä¸€èˆ¬çš„mallocå°±å¯ä»¥äº†</strong></p><p>å…³äºæŒ–å†…å­˜ï¼Œè¿™ä¸ªè®¾è®¡è¿˜æœ‰ä¸€äº›ç»†èŠ‚ï¼š</p><p><strong>å½“æŒ–å†…å­˜çš„æ—¶å€™ï¼Œæ¯”å¦‚å°±32å­—èŠ‚çš„é‚£å—ï¼Œå¦‚æœè®¾è®¡è€…è®¾è®¡çš„æ˜¯20*32ï¼Œä½†æ˜¯å®é™…ä¸ŠæŒ–å‡ºæ¥çš„æ˜¯2ä¸ª20å—ï¼Œæ¯ä¸€å—32ä¸ªå­—èŠ‚ï¼›å…¶ä¸­å‰20å—å°±ç»™32å­—èŠ‚çš„åŒºå—å»ç”¨ï¼Œå20å—ä½œä¸ºå¤‡ç”¨åŒºå—(æˆ˜å¤‡æ± )ï¼Œæš‚æ—¶ä¸å¤„ç†ï¼Œå¯ä»¥ç»™è´Ÿè´£å…¶ä»–å¤§å°çš„åŒºå—å–ç”¨ä»¥æ­¤èŠ‚çœç©ºé—´ã€‚æ¯”å¦‚è¿™æ—¶å€™è¦64ä¸ªå­—èŠ‚ï¼ŒæŒ‰ç†æ¥è¯´åº”è¯¥7å·é“¾è¡¨å»æŒ–ï¼Œä½†æ˜¯ä»–è§‚å¯Ÿåˆ°3å·é“¾è¡¨çš„åå¤‡åŒºå—æœ‰ç©ºé—´ï¼Œä»–çš„æŒ‡é’ˆå°±æŒ‡å‘è¿™ä¸€å—ï¼Œæ‰€ä»¥å›¾ä¸­è¿™ä¸¤å—æ˜¯è¿ç»­çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªåå¤‡åŒºå—å¯ä»¥å­˜æ”¾10ä¸ª64å­—èŠ‚çš„ç©ºé—´</strong></p><p>æ‰€ä»¥æ¯æ¬¡è¦çš„æ—¶å€™éƒ½æ˜¯è¦ä¸¤å€çš„ç©ºé—´ï¼Œç•™ç›¸åŒå¤§å°(è¿™é‡Œæ˜¯20ä¸ª)çš„ç©ºé—´ä½œä¸ºæˆ˜å¤‡æ± (memory pool)</p><h4 id="embedded-pointers-å†…åµŒå…¥å¼æŒ‡é’ˆ"><a href="#embedded-pointers-å†…åµŒå…¥å¼æŒ‡é’ˆ" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#embedded-pointers-å†…åµŒå…¥å¼æŒ‡é’ˆ"></a> embedded pointers å†…åµŒå…¥å¼æŒ‡é’ˆ</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530112053633.png" alt="image-20230530112053633"></p><p>å…³äºfree_listçš„æŒ‡é’ˆï¼š</p><p>è¿™ä¸ªè®¾è®¡éå¸¸å·§å¦™ï¼Œç”±äºåˆ†é…çš„æ¬¡åºå’Œå½’è¿˜çš„æ¬¡åºåœ¨å®é™…æ“ä½œçš„è¿‡ç¨‹ä¸­å¯èƒ½å¹¶ä¸æ˜¯å®Œå…¨ç¬¦åˆé€†å‘ï¼Œæ‰€ä»¥å¯¹äºfree_listä»–ä»¬çš„å†…å­˜å¯èƒ½ä¸æ˜¯å®Œå…¨è¿ç»­çš„ï¼Œè¿™å¾ˆæ­£å¸¸</p><p>ä½†æ˜¯å‘¢ï¼Œfree_listä¹‹é—´æ˜¯ç”¨æŒ‡é’ˆä¼ é€’çš„ï¼Œæœ¬èº«æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œä¹Ÿå°±ä¸å­˜åœ¨è¿ç»­ä¸è¿ç»­çš„é—®é¢˜äº†</p><p><strong>å› æ­¤ï¼Œfree_listæŒ‡å‘çš„æ¯ä¸€ä¸ªåŒºå—éƒ½æ˜¯æå‰æŒ–å‡ºæ¥çš„å†…å­˜å—ï¼Œä¸ºäº†å­˜æ”¾ä¸‹ä¸€ä¸ªfreeå—çš„æŒ‡é’ˆï¼Œè¿™é‡Œå€Ÿç”¨äº†è¿™ä¸€ä¸ªåŒºå—çš„å‰4ä¸ªå­—èŠ‚(64ä½ç”µè„‘æ˜¯8ä¸ªå­—èŠ‚)ä½œä¸ºæŒ‡é’ˆï¼ŒæŒ‡å‘ä¸‹ä¸€å—freeå†…å­˜ï¼Œå½“è¿™ä¸€å—å†…å­˜è¢«åˆ†é…ç»™ç”¨æˆ·çš„æ—¶å€™ï¼Œæ•°æ®å€¼ä¼šè¦†ç›–æ‰è¿™ä¸ªæŒ‡é’ˆï¼Œä½†æ˜¯æ²¡æœ‰å…³ç³»ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘çš„free_listå·²ç»é€šè¿‡è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€å—freeå†…å­˜äº†ï¼Œè¿™ä¸€å—å†…å­˜ä¹Ÿå°±ä¸å±äºfree_listçš„èŒƒç•´äº†ï¼Œå±äºç”¨æˆ·æŒæœ‰çš„å†…å­˜äº†</strong></p><p>é‚£ä¹ˆä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡å‘¢ï¼Ÿå¦‚æœé¢å¤–æ‹¿å‡º4æˆ–è€…8ä¸ªå­—èŠ‚æ¥åˆ†é…ç»™æŒ‡é’ˆï¼Œä¸€ä¸ªcookieä¸Šä¸‹åŠ èµ·æ¥æ‰8ä¸ªå­—èŠ‚ï¼Œé‚£ä¸æ˜¯ç›¸å½“äºæ¶ˆé™¤äº†åŸæ¥çš„cookieå¢æ·»äº†æ–°çš„æŒ‡é’ˆè´Ÿæ‹…å—ï¼Ÿæ‰€ä»¥éœ€è¦ä½¿ç”¨embedded pointers</p><p>é‚£ä¹ˆè¿™é‡Œè€ƒè™‘åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœå®¢æˆ·éœ€è¦çš„ç©ºé—´æœ¬æ¥å°±å°äº4æˆ–è€…8ä¸ªå³ä¸€ä¸ªæŒ‡é’ˆçš„å¤§å°ï¼Œé‚£è¿™ä¸ªæ—¶å€™æŒ‡é’ˆæ˜¯ä¸æ˜¯å°±ä¸èƒ½å€Ÿç”¨äº†å‘¢ï¼Ÿè¿™æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯å¯¹äºå·¥ä¸šçº§åˆ«çš„ç»å¤§å¤šæ•°æƒ…å†µï¼Œå®¢æˆ·éœ€è¦çš„å¤§å°è‚¯å®šéƒ½æ˜¯å¤§äºä¸€æ ¹æŒ‡é’ˆçš„å¤§å°çš„ï¼Œæ‰€ä»¥ä¸å¤ªéœ€è¦æ‹…å¿ƒè¿™ä¸ªé—®é¢˜</p><h3 id="gc29-stdalloc-è¿è¡Œä¸€ç¥ä¸€ä¸ªéå¸¸å¥½çš„è®¾è®¡-1-13"><a href="#gc29-stdalloc-è¿è¡Œä¸€ç¥ä¸€ä¸ªéå¸¸å¥½çš„è®¾è®¡-1-13" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#gc29-stdalloc-è¿è¡Œä¸€ç¥ä¸€ä¸ªéå¸¸å¥½çš„è®¾è®¡-1-13"></a> Gc2.9 std::alloc è¿è¡Œä¸€ç¥(ä¸€ä¸ªéå¸¸å¥½çš„è®¾è®¡) 1-13</h3><p>01</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530124448776.png" alt="image-20230530124448776"></p><p>02</p><p><strong>æ³¨æ„ï¼šè¿™äº›é“¾è¡¨éƒ½æ˜¯æŒ‡å‘çš„æ˜¯free_listï¼Œè€Œä¸æ˜¯ç”¨æˆ·åˆ†é…åˆ°çš„å†…å­˜å—</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530124835651.png" alt="image-20230530124835651"></p><p>åœ¨ç”³è¯·å†…å­˜çš„æ—¶å€™ï¼Œæ¯”å¦‚ç”³è¯·32å­—èŠ‚ï¼Œfree_listä¸Šæ²¡æœ‰ï¼Œé¦–å…ˆå»æ‰¾æˆ˜å¤‡æ± æœ‰æ²¡æœ‰åˆé€‚çš„ï¼Œæ²¡æœ‰çš„è¯å°±åœ¨#3(å¯¹åº”32å­—èŠ‚)ä¸‹é¢ç”³è¯· 32 * 20 * 2 + RoundUp(0&gt;&gt;4) = 1280çš„ç©ºé—´</p><p>æ³¨æ„ï¼š</p><p>1.<strong>åœ¨å®ä½œçš„æ—¶å€™ï¼Œæ€»æ˜¯ä¼˜å…ˆå…ˆæŠŠåˆ†é…å¥½çš„å†…å­˜æ”¾åˆ°æˆ˜å¤‡æ± å½“ä¸­ï¼Œç„¶åå†åˆ†é…å‡ºå»å†…å­˜ï¼Œæ¯”å¦‚ç»™ä¸€å—ç»™ç”¨æˆ·ï¼Œå‰©ä½™19å—æŒ‚åœ¨free_list[3]ä¸Šé¢</strong>ï¼Œä¸è¿™ä¹ˆå®ç°å…¶å®é—®é¢˜ä¹Ÿä¸å¤§ï¼Œä½†æ˜¯æ ‡å‡†åº“è¿™ä¹ˆå®ç°äº†ä»£ç ä¼šæ¼‚äº®å¾ˆå¤š</p><p>2.<strong>RoundUp(0&gt;&gt;4)æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¡¨ç¤ºä¸€ä¸ªè¿½åŠ é‡</strong>ï¼Œæ˜¯å®ç°è¿™ä¸ªçš„è¿™ä¸ªå…¬å¸è®¾è®¡çš„ï¼Œå…·ä½“åŸå› ä¸æ¸…æ¥šï¼Œè¡¨ç¤ºæŠŠä¸€ä¸ªæ•°å­—è°ƒæ•´åˆ°ä¸€å®šçš„è¾¹ç•Œï¼Œåé¢å†è¯´ï¼Œä¸€å¼€å§‹(ç›®å‰)æ˜¯0</p><p>ç„¶åå¯¹äºcookieï¼Œåœ¨æˆ‘ä»¬è¿™æ ·çš„è®¾è®¡ä¹‹åï¼Œè¿™ä¸€æ•´å—æ˜¯ç”¨mallocæ‹¿åˆ°çš„ï¼Œæ‰€ä»¥è¿™ä¸€æ•´å—ä¸Šä¸‹ä¼šæœ‰ä¸¤ä¸ªcookie</p><p>03</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530130901615.png" alt="image-20230530130901615"></p><p>æ¥ä¸Šï¼Œç°åœ¨æˆ‘ç”³è¯·64å­—èŠ‚ï¼Œfree_listä¸Šæ²¡æœ‰ï¼Œè‚¯å®šæ˜¯ä¼˜å…ˆæŸ¥çœ‹æˆ˜å¤‡æ± çš„ç©ºé—´ï¼Œè¿™é‡Œå¤Ÿç”¨ï¼Œ<strong>æ‰€ä»¥æŠŠæˆ˜å¤‡æ± å½“ä¸­çš„ä¸€å—åˆ†ç»™ç”¨æˆ·ï¼Œå‰©ä½™9å—æŒ‚åœ¨free_list[7]ä¸Šé¢ï¼Œæ³¨æ„çš„æ˜¯è¿™ä¸¤å—ç©ºé—´åœ¨å†…å­˜ä¸Šæ˜¯è¿ç»­çš„!è¿™æ—¶æˆ˜å¤‡æ± ç”¨å…‰äº†</strong></p><p><strong>è§„å®šï¼šåœ¨åé¢åœ¨æˆ˜å¤‡æ± ä¸Šé¢å–å‡ºç©ºé—´å»åˆ’åˆ†çš„æ—¶å€™ï¼Œä¸€æ¬¡æ€§åˆ’åˆ†çš„ä¸ªæ•°ä¸èƒ½è¶…è¿‡20ä¸ª!!!</strong></p><p>04</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530132204861.png" alt="image-20230530132204861"></p><p>ç°åœ¨ç»§ç»­ç”³è¯·96å­—èŠ‚ï¼Œfree_listä¸Šæ²¡æœ‰ï¼Œæˆ˜å¤‡æ± ä¸ºç©ºï¼Œéœ€è¦é‡æ–°ç”³è¯·å†…å­˜ï¼Œç”³è¯·96 * 20 * 2 + RoundUp(1280&gt;&gt;4) çš„å†…å­˜å¤§å°ï¼Œå…¶ä¸­ä¸€å—ç»™ç”¨æˆ·ï¼Œ19å—æ”¾åˆ°free_list[11]ä¸Šï¼Œå‰©ä½™çš„2000å°±æ˜¯æˆ˜å¤‡æ± </p><p>æ³¨æ„ï¼šå…³äºè¿½åŠ é‡çš„è®¡ç®—</p><p><strong>RoundUp(x&gt;&gt;4)ï¼šç”¨ç›®å‰çš„ç´¯è®¡ç”³è¯·é‡(ä¾‹å¦‚ç°åœ¨æ²¡ç”³è¯·å‰æ˜¯1280)å³ç§»4ä½ï¼Œå³é™¤ä»¥16ï¼Œç„¶åè°ƒåˆ°8çš„è¾¹ç•Œ</strong></p><p>å¯ä»¥çœ‹å‡ºè¿™ä¸ªè¿½åŠ é‡ä¼šè¶Šæ¥è¶Šå¤§ï¼Œéšç€å†…å­˜çš„å¼€è¾Ÿ</p><p>05</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530133728815.png" alt="image-20230530133728815"></p><p>ç°åœ¨ç”³è¯·88å­—èŠ‚ï¼Œå³#10ï¼Œfree_listä¸Šæ²¡æœ‰ï¼Œå…ˆçœ‹æˆ˜å¤‡æ± ï¼Œæœ€å¤šå¯ä»¥åˆ’å‡º20å—ï¼Œ20 * 88 &lt; 2000 ï¼Œåˆ™åˆ’åˆ†20å—å‡ºå»ï¼Œæˆ˜å¤‡æ± å‰©ä½™2000 - 88 * 20 = 240ä¸ªå­—èŠ‚çš„å¤§å°</p><p>åˆ’åˆ†å‡ºå»çš„ç©ºé—´ä¸€å—ç»™ç”¨æˆ·ï¼Œå‰©ä½™19å—ä¼ åˆ°free_list[10]ä¸Šé¢å»</p><p>06</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530134659332.png" alt="image-20230530134659332"></p><p>è¿ç»­ç”³è¯·ä¸‰æ¬¡88å­—èŠ‚ï¼Œç”±äºfree_list[10]ä¸Šæœ‰ç©ºé—´ï¼Œç›´æ¥åˆ†é…ç»™ç”¨æˆ·å³å¯ï¼Œå°†free_list[10]æŒ‡é’ˆåç§»</p><p>07</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530135356839.png" alt="image-20230530135356839"></p><p>æ¥ç€ç”³è¯·8å­—èŠ‚ï¼Œfree_listä¸Šæ²¡æœ‰ï¼Œå…ˆçœ‹æˆ˜å¤‡æ± ï¼Œç”±äº8 * 20 &lt; 240 ï¼Œåˆ†é…å‡ºå»ï¼Œæˆ˜å¤‡æ± ç©ºé—´è¿˜å‰©80ï¼Œåˆ’åˆ†å‡ºä¸€å—ç»™ç”¨æˆ·ï¼Œå‰©ä½™çš„æŒ‚åœ¨free_list[0]ä¸Šé¢ï¼Œæˆ˜å¤‡æ± å‰©ä½™80</p><p>08</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530135902882.png" alt="image-20230530135902882"></p><p><strong>ç¢ç‰‡å¤„ç†ï¼š</strong></p><p>è¿™æ—¶å€™ç”³è¯·104å­—èŠ‚å¤§å°ï¼Œfree_listä¸Šæ²¡æœ‰ï¼Œä¸Šä¸€æ¬¡çš„æˆ˜å¤‡æ± å‰©ä½™80ï¼Œè¿ä¸€ä¸ªéƒ½æ²¡æœ‰åŠæ³•æ»¡è¶³ï¼›<strong>è¿™ä¸ªæ—¶å€™ä¼šæŠŠè¿™ä¸ª80æŒ‚è½½åˆ°#9å·çš„free_list[9]ä¸Šé¢ï¼Œè¿™ä¸ªæ—¶å€™æˆ˜å¤‡æ± å°±ä¸ºç©ºäº†ï¼Œç„¶åé‡æ–°ç”¨mallocç”³è¯·å†…å­˜</strong>ï¼Œå„é¡¹å‚æ•°å¦‚ä¸Šæ‰€ç¤º</p><p>09</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530192809660.png" alt="image-20230530192809660"></p><p>ç”³è¯·112ä¸ªå­—èŠ‚ï¼Œfree_listä¸Šæ²¡æœ‰ï¼Œå…ˆæ‰¾æˆ˜å¤‡æ± ï¼Œç”±äº112 * 20 = 2240 &lt; 2408ï¼Œæ‰€ä»¥åˆ†é…å‡ºå»ï¼Œç°åœ¨æˆ˜å¤‡æ± å‰©ä½™168</p><p>10</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530193556966.png" alt="image-20230530193556966"></p><p>ç”³è¯·48ä¸ªå­—èŠ‚ï¼Œfree_listä¸Šæ²¡æœ‰ï¼Œæ‰¾æˆ˜å¤‡æ± ï¼Œ168 / 48 = 3ï¼Œåˆ†é…3ä¸ªå‡ºå»ï¼Œä¸€ä¸ªç»™ç”¨æˆ·ï¼Œå‰©ä¸‹ä¸¤ä¸ªæŒ‚åœ¨free_list[5]ä¸Šï¼Œæˆ˜å¤‡æ± å‰©ä½™24</p><p>11</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530194432937.png" alt="image-20230530194432937"></p><p><strong>ç°åœ¨ç”³è¯·72ï¼Œfree_listä¸Šæ²¡æœ‰ï¼Œå…ˆæ‰¾æˆ˜å¤‡æ± ï¼Œ24æ»¡è¶³ä¸äº†ï¼Œé‚£ä¹ˆä¼šç”³è¯·å†…å­˜ï¼Œä½†æ˜¯ç°åœ¨ä¸ºäº†è§‚å¯Ÿç³»ç»Ÿè¾¹ç•Œï¼Œæ‰‹åŠ¨å°†ç³»ç»Ÿå †çš„å¤§å°è®¾ç½®å°ï¼Œç°åœ¨å¦‚æœåœ¨ç´¢å–å†…å­˜å°±è¶…å‡ºè¾¹ç•Œäº†ï¼Œæ˜¾ç„¶ä¸è¡Œï¼Œæ‰€ä»¥æ»¡è¶³ä¸äº†è¿™æ¬¡ç”³è¯·ï¼Œé‚£ä¹ˆå°±æ‰¾è·ç¦»72æœ€è¿‘çš„free_listï¼Œåœ¨è¿™é‡Œå°±æ˜¯80ï¼Œå³9å·ï¼Œä¸Šé¢æœ‰ä¸€ä¸ªç©ºç™½çš„åŒºå—ï¼Œå¥½ï¼ŒæŠŠä»–åˆ‡æˆ72 + 8 çš„å½¢å¼ï¼Œ72åˆ†é…ç»™ç”¨æˆ·ï¼Œ8å°±æ˜¯æˆ˜å¤‡æ± ï¼Œè¿™ä¸ªæ—¶å€™ #8 å’Œ #9 éƒ½æ²¡æœ‰free_listï¼Œä»–ä»¬çš„é“¾è¡¨éƒ½æ˜¯ç©ºçš„!!!</strong></p><p>12</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530200004843.png" alt="image-20230530200004843"></p><p>å†ç”³è¯·72ï¼Œæ²¡æœ‰free_list,ï¼Œæˆ˜å¤‡æ± ä¸å¤Ÿï¼ŒåŒæ—¶å¥½çš„åˆmallocå¤±è´¥äº†ï¼Œè¿™ä¸ªæ—¶å€™åªæœ‰å»æ‰¾ #10 çš„ç©ºç™½åŒºå—äº†ï¼Œ**å…ˆå¤„ç†åŸæ¥çš„æˆ˜å¤‡æ± ï¼Œå°†å…¶æŒ‚åˆ°#0å·free_listçš„é¦–éƒ¨ï¼Œå³å¦‚å›¾æ‰€ç¤ºï¼Œ**ç„¶åæŠŠ #10 å·çš„ç¬¬ä¸€ä¸ªç©ºç™½åŒºå—åˆ†æˆ72å’Œ16ï¼Œ72ç»™ç”¨æˆ·ï¼Œ16ä½œä¸ºæˆ˜å¤‡æ± </p><p>13 å±±ç©·æ°´å°½</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530200614422.png" alt="image-20230530200614422"></p><p>ç”³è¯·120ï¼Œ#14 æ²¡æœ‰free_listï¼Œæˆ˜å¤‡æ± ç©ºé—´ä¸å¤Ÿï¼Œmallocå¥½çš„ä¸å‡ºæ„å¤–åˆå¤±è´¥äº†ï¼Œè¿™ä¸ªæ—¶å€™å°±å»æ‰¾#15ï¼Œå“¦è±æ²¡æœ‰ï¼Œæ‰¾ä¸åˆ°ï¼Œé‚£ä¹ˆå°±gå•¦ï¼ï¼ï¼æˆ˜å¤‡æ± å½’0</p><p>é’ˆå¯¹ç›®å‰çš„è¿™ä¸ªç°çŠ¶ï¼Œå¯ä»¥åšä¸€äº›æ€è€ƒï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530200925564.png" alt="image-20230530200925564"></p><ul><li>å›¾ä¸­è¿˜æœ‰å¾ˆå¤šç©ºç™½çš„åŒºå—æœªåˆ†é…ç»™ç”¨æˆ·ï¼Œé‚£ä¹ˆå¯ä¸å¯ä»¥æŠŠç™½è‰²çš„å°åŒºå—åˆå¹¶æˆä¸ºå¤§åŒºå—ç»™ç”¨æˆ·å‘¢ï¼Ÿ(éš¾åº¦å¤ªé«˜äº†)</li><li>system heapè¿˜å‰©ä½™ 10000 - 9688 = 312ï¼Œå¯ä¸å¯ä»¥æŠŠå‰©ä¸‹çš„312ç»§ç»­ç”¨å…‰å‘¢ï¼Ÿ</li></ul><h3 id="gc29-stdallocçš„æºç å‰–æ"><a href="#gc29-stdallocçš„æºç å‰–æ" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#gc29-stdallocçš„æºç å‰–æ"></a> Gc2.9 std::allocçš„æºç å‰–æ</h3><p><strong>ç¬¬äºŒçº§åˆ†é…å™¨ï¼šç¬¬äºŒçº§åˆ†é…å™¨å°±æ˜¯ä¸Šé¢æåˆ°çš„allocï¼Œå½“è¿™ä¸ªåˆ†é…å™¨åˆ†é…ä¸å‡ºå†…å­˜çš„æ—¶å€™ï¼Œå®é™…ä¸Šä¸ä¼šç«‹å³å±±ç©·æ°´å°½ï¼Œä¼šè°ƒç”¨ç¬¬ä¸€çº§åˆ†é…å™¨è°ƒç”¨new_handleræ¥å¯¹åˆ†é…ä¸å‡ºå†…å­˜è¿›è¡Œå¤„ç†</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530215144034.png" alt="image-20230530215144034"></p><p>æ¨¡æ¿å‚æ•° bool threadså’Œint instï¼Œåœ¨æˆ‘ä»¬ç›®å‰æ‰€ç ”ç©¶çš„èŒƒå›´å½“ä¸­éƒ½æ²¡æœ‰æ´¾ä¸Šç”¨åœº</p><p>Round_Up()ï¼šè®¡ç®—è¿½åŠ é‡</p><p>embedded pointersï¼šåµŒå…¥å¼æŒ‡é’ˆ</p><p><strong>åœ¨è¿™ä¸ªç±»é‡Œé¢æœ€å…ˆå®šä¹‰è¿™ä¸ªæŒ‡é’ˆæˆå‘˜ï¼Œä¹Ÿå°±è¾¾åˆ°äº†æˆ‘ä»¬éœ€è¦çš„å€Ÿç”¨å¤´éƒ¨ä½œä¸ºæŒ‡é’ˆï¼Œåé¢å®¹å™¨è¿›æ¥ä¹‹åè¦†ç›–å¹¶ä¸”ç§»åŠ¨æŒ‡é’ˆåˆ°ä¸‹ä¸€ä¸ªä½ç½®å°±å¯ä»¥äº†</strong></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">union</span> <span class="title class_">obj</span>&#123;</span><br><span class="line">	<span class="keyword">union</span> <span class="title class_">obj</span>* free_list_link;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><p>free_list[]ï¼šé™æ€ï¼Œå…¨å±€åªæœ‰ä¸€ä»½ï¼Œä»£è¡¨é‚£16ä¸ªé“¾è¡¨</p><p>FREELIST_INDEX()ï¼šè®¡ç®—æ•°ç»„ä¸‹æ ‡ï¼Œè®¡ç®—å‡ºç”±ç¬¬å‡ å·é“¾è¡¨æä¾›æœåŠ¡</p><p>æˆ˜å¤‡æ± ç›¸å…³</p><ul><li>start_freeï¼šæŒ‡å‘poolé¦–éƒ¨</li><li>end_freeï¼šæŒ‡å‘poolå°¾éƒ¨</li></ul><p>head_sizeï¼šç»Ÿè®¡ç´¯è®¡åˆ†é…é‡</p><p>è¿˜æœ‰ä¸¤ä¸ªå‡½æ•°ç›®å‰å°šä¸æ¸…æ¥šæ€ä¹ˆå®ç°ï¼š</p><p><strong>refill()ï¼šä»å†…å­˜æ± ä¸­ç”³è¯·ç©ºé—´å¹¶æ„å»ºfree listï¼Œç„¶åä»free listä¸­åˆ†é…ç©ºé—´ç»™ç”¨æˆ·</strong></p><p><strong>chunk_alloc()ï¼šä»å†…å­˜æ± ä¸­åˆ†é…ç©ºé—´</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230530220728994.png" alt="image-20230530220728994"></p><p>ç„¶åå°±æ˜¯æœ€é‡è¦çš„allocate()å’Œdeallocate()å‡½æ•°</p><p>allocateå‡½æ•°ä¸­ï¼š<strong>å¦‚æœéœ€è¦çš„ç©ºé—´å¤ªå¤§è¶…è¿‡èŒƒå›´å°±è°ƒç”¨ç¬¬ä¸€çº§åˆ†é…å™¨ï¼›ç„¶åå»æŸ¥è¯¢free_listå½“ä¸­æ˜¯å¦å¯ä»¥åˆ†é…ï¼Œå¦‚æœå¯ä»¥åˆ†é…é‚£ä¹ˆå°±åˆ†é…å°±å¥½äº†ï¼›å¦‚æœæ²¡æœ‰å°±è°ƒç”¨refill()å‡½æ•°ï¼Œä»å†…å­˜æ± ä¸­ç”³è¯·ç©ºé—´å¹¶ä¸”æ„å»ºfree_listï¼Œç„¶ååˆ†é…ä¸€å—ç»™ç”¨æˆ·ï¼Œè‡³äºæ˜¯æˆ˜å¤‡æ± è¿˜æ˜¯æˆ˜å¤‡æ± ä¸å¤Ÿå¤„ç†ç¢ç‰‡ç„¶åmallocç”³è¯·ï¼Œæˆ–è€…æ˜¯mallocå¤±è´¥å»æ‰¾åé¢çš„ç©ºç™½åŒºå—ï¼Œè¿™å°±æ˜¯refillçš„äº‹æƒ…äº†ï¼Œç°åœ¨å°šä¸æ¸…æ¥š</strong></p><p>deallocateå‡½æ•°ä¸­ï¼š<strong>å¦‚æœç©ºé—´å¤ªå¤§ï¼Œè°ƒç”¨ç¬¬ä¸€çº§ï¼Œä¸allocateé…å¥—ï¼›å¦åˆ™æŠŠfree_list[]æŒ‡é’ˆå‰ç§»</strong></p><p><strong>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œä¸è°ƒç”¨free()é‡Šæ”¾è¿˜ç»™æ“ä½œç³»ç»Ÿå‘¢ï¼Ÿ</strong></p><p><strong>å‰é¢çŸ¥é“ï¼Œç”±äºå„ç§åŸå› ï¼Œfree_list[]çš„æŒ‡å‘å¹¶ä¸ä¸€å®šæ˜¯è¿ç»­çš„ï¼Œä½†æ˜¯ä»–ä»¬ä¹‹é—´æ˜¯ç”¨é“¾è¡¨å®ç°çš„ï¼Œç»™æˆ‘ä»¬çš„æ„Ÿå®˜æ˜¯è¿™æ ·çš„ï¼›ä¸è¿ç»­çš„è¯è´¸ç„¶å»free()å°±å¯èƒ½ä¼šå‡ºé—®é¢˜ï¼Œæ‰€ä»¥ä»–ä¸è¿˜ç»™æ“ä½œç³»ç»Ÿ</strong>ï¼ˆä¸ªäººæ„Ÿè§‰è¿™é‡Œä¸æ˜¯å¾ˆåˆç†ï¼‰</p><p><strong>å¦ä¸€ä¸ªé—®é¢˜å°±æ˜¯æ²¡æœ‰å¯¹è¿™ä¸ªpæŒ‡é’ˆè¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœä»–ä¸æ˜¯è¿™ä¸ªåˆ†é…å™¨ç»™å‡ºæ¥çš„æŒ‡é’ˆï¼Œä»–æŒ‡å‘ç©ºé—´çš„å¤§å°å¯èƒ½å°±ä¸æ˜¯8çš„å€æ•°ï¼Œè¿™æ ·å¦‚æœæ‰§è¡Œè¿™æ®µä»£ç å¯èƒ½å°±ä¼šé€ æˆä¸å¯é€†è½¬çš„ç»“æœäº†</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230531095651457.png" alt="image-20230531095651457"></p><p>refill()å‡½æ•°ï¼š</p><p>è¿™ä¸ªå‡½æ•°çš„ä½œç”¨å°±æ˜¯åœ¨free_listæ²¡æœ‰ç©ºé—´çš„æ—¶å€™ï¼Œå†…éƒ¨è°ƒç”¨chunk_alloc()ç”³è¯·å†…å­˜æ± å¹¶ä¸”åˆ†é…ç»™ç”¨æˆ·å’Œfree_listï¼Œç„¶åæŠŠç”³è¯·åˆ°çš„free_listç»™ä¸²èµ·æ¥</p><p>ç„¶åæ‹¿ä¸€å¤§å—å†…å­˜çš„äº‹æƒ…å°±äº¤ç»™chunk_alloc()å‡½æ•°å»å®ç°</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230531095545741.png" alt="image-20230531095545741"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230531105901120.png" alt="image-20230531105901120"></p><p>chunk_alloc()å‡½æ•°ï¼š</p><p>è¿™é‡Œå°±æ˜¯å»è¦ä¸€å¤§å—å†…å­˜ï¼Œå…ˆå»çœ‹æˆ˜å¤‡æ± ï¼Œä»–è¿™é‡Œæ˜¯å…ˆçœ‹èƒ½ä¸èƒ½æ»¡è¶³æœ€å¤§çš„éœ€æ±‚ï¼Œå°±æ˜¯è§„å®šçš„æˆ˜å¤‡æ± æœ€å¤šæä¾›20å—ï¼Œä¸èƒ½çš„è¯çœ‹èƒ½åˆ‡å‡ºå‡ å—ï¼Œç„¶åä¿®æ”¹æŒ‡é’ˆï¼›</p><p><strong>å¦‚æœæ— æ³•æ»¡è¶³é‚£ä¹ˆå°±ä»£è¡¨æˆ˜å¤‡æ± æ— æ³•æ»¡è¶³ï¼Œé‚£ä¹ˆå°±æŠŠè¿™ä¸ªç¢ç‰‡è¿›è¡Œå¤„ç†(ç»™ä»–æ”¾åˆ°å¯¹åº”çš„free_listçš„é¦–éƒ¨)ï¼Œç„¶åå‡†å¤‡è®¡ç®—æ¥ä¸‹æ¥éœ€è¦mallocæ‹¿åˆ°çš„ç©ºé—´ï¼Œç„¶åå°è¯•å»æ‹¿å–ï¼›mallocæ‹¿åˆ°çš„ç©ºé—´å‰é¢æåˆ°æ˜¯2 * 20 * 32 æ¯”å¦‚ï¼Œå…ˆå…¨éƒ¨æ”¾åˆ°æˆ˜å¤‡æ± å½“ä¸­ï¼Œç„¶ååˆ‡å‡ºä¸€åŠæ¥ç»™ç”¨æˆ·å’Œfree_liståˆ†é…ï¼›å¤±è´¥äº†è¯´æ˜ç³»ç»Ÿheapç©ºé—´ä¸å¤Ÿäº†ï¼Œé‚£ä¹ˆå°±å°è¯•å»è¿™ä¸ªå¤§å°çš„é“¾è¡¨åé¢å»æ‰¾å¯ç”¨çš„ç©ºé—´ï¼Œå°†å…¶ä¸€å—åˆ†ä¸ºç”¨æˆ·å’Œæˆ˜å¤‡æ± ï¼Œå¦‚æœè¿™è¿˜æ‰¾ä¸åˆ°å°±å±±ç©·æ°´å°½ï¼Œg!</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230531110714412.png" alt="image-20230531110714412"></p><p>ç„¶åå°±å‰©ä¸‹ä¸€äº›ç±»å¤–çš„åˆå§‹åŒ–å’Œtypedefçš„æ“ä½œäº†</p><p>æ•´åˆäº†ä¸€ä¸‹ä»£ç ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¬¬ä¸€çº§åˆ†é…å™¨</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _STD_ALLOC_1ST_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _STD_ALLOC_1ST_H_</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __THROW_BAD_ALLOC            \</span></span><br><span class="line"><span class="meta">    cerr &lt;&lt; <span class="string">&quot;out of memory&quot;</span> &lt;&lt; endl; \</span></span><br><span class="line"><span class="meta">    exit(1)</span></span><br><span class="line"><span class="comment">//----------------------------------------------</span></span><br><span class="line"><span class="comment">// ç¬¬1ç´šé…ç½®å™¨ã€‚</span></span><br><span class="line"><span class="comment">//----------------------------------------------</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">int</span> inst&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">__malloc_alloc_template</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> *<span class="title">oom_malloc</span><span class="params">(<span class="type">size_t</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> *<span class="title">oom_realloc</span><span class="params">(<span class="type">void</span> *, <span class="type">size_t</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="title">void</span> <span class="params">(*__malloc_alloc_oom_handler)</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> *<span class="title">allocate</span><span class="params">(<span class="type">size_t</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="type">void</span> *result = <span class="built_in">malloc</span>(n);  <span class="comment">// ç›´æ¥ä½¿ç”¨ malloc()</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> == result)</span><br><span class="line">            result = <span class="built_in">oom_malloc</span>(n);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">deallocate</span><span class="params">(<span class="type">void</span> *p, <span class="type">size_t</span> <span class="comment">/* n */</span>)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">free</span>(p);  <span class="comment">// ç›´æ¥ä½¿ç”¨ free()</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> *<span class="title">reallocate</span><span class="params">(<span class="type">void</span> *p, <span class="type">size_t</span> <span class="comment">/* old_sz */</span>, <span class="type">size_t</span> new_sz)</span> </span>&#123;</span><br><span class="line">        <span class="type">void</span> *result = <span class="built_in">realloc</span>(p, new_sz);  <span class="comment">// ç›´æ¥ä½¿ç”¨ realloc()</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> == result)</span><br><span class="line">            result = <span class="built_in">oom_realloc</span>(p, new_sz);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="title">void</span> <span class="params">(*set_malloc_handler(<span class="type">void</span> (*f)()))</span><span class="params">()</span> </span>&#123;  <span class="comment">// é¡ä¼¼ C++ çš„ set_new_handler().</span></span><br><span class="line">        <span class="built_in">void</span> (*old)() = __malloc_alloc_oom_handler;</span><br><span class="line">        __malloc_alloc_oom_handler = f;</span><br><span class="line">        <span class="keyword">return</span> (old);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//----------------------------------------------</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">int</span> inst&gt;</span><br><span class="line"><span class="built_in">void</span> (*__malloc_alloc_template&lt;inst&gt;::__malloc_alloc_oom_handler)() = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">int</span> inst&gt;</span><br><span class="line"><span class="type">void</span> *__malloc_alloc_template&lt;inst&gt;::<span class="built_in">oom_malloc</span>(<span class="type">size_t</span> n) &#123;</span><br><span class="line">    <span class="built_in">void</span> (*my_malloc_handler)();</span><br><span class="line">    <span class="type">void</span> *result;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;  <span class="comment">// ä¸æ–·å˜—è©¦é‡‹æ”¾ã€é…ç½®ã€å†é‡‹æ”¾ã€å†é…ç½®â€¦</span></span><br><span class="line">        my_malloc_handler = __malloc_alloc_oom_handler;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> == my_malloc_handler) &#123;</span><br><span class="line">            __THROW_BAD_ALLOC;</span><br><span class="line">        &#125;</span><br><span class="line">        (*my_malloc_handler)();  <span class="comment">// å‘¼å«è™•ç†å¸¸å¼ï¼Œä¼åœ–é‡‹æ”¾è¨˜æ†¶é«”</span></span><br><span class="line">        result = <span class="built_in">malloc</span>(n);      <span class="comment">// å†æ¬¡å˜—è©¦é…ç½®è¨˜æ†¶é«”</span></span><br><span class="line">        <span class="keyword">if</span> (result)</span><br><span class="line">            <span class="keyword">return</span> (result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">int</span> inst&gt;</span><br><span class="line"><span class="type">void</span> *__malloc_alloc_template&lt;inst&gt;::<span class="built_in">oom_realloc</span>(<span class="type">void</span> *p, <span class="type">size_t</span> n) &#123;</span><br><span class="line">    <span class="built_in">void</span> (*my_malloc_handler)();</span><br><span class="line">    <span class="type">void</span> *result;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;  <span class="comment">// ä¸æ–·å˜—è©¦é‡‹æ”¾ã€é…ç½®ã€å†é‡‹æ”¾ã€å†é…ç½®â€¦</span></span><br><span class="line">        my_malloc_handler = __malloc_alloc_oom_handler;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> == my_malloc_handler) &#123;</span><br><span class="line">            __THROW_BAD_ALLOC;</span><br><span class="line">        &#125;</span><br><span class="line">        (*my_malloc_handler)();  <span class="comment">// å‘¼å«è™•ç†å¸¸å¼ï¼Œä¼åœ–é‡‹æ”¾è¨˜æ†¶é«”ã€‚</span></span><br><span class="line">        result = <span class="built_in">realloc</span>(p, n);  <span class="comment">// å†æ¬¡å˜—è©¦é…ç½®è¨˜æ†¶é«”ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (result)</span><br><span class="line">            <span class="keyword">return</span> (result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//----------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> __malloc_alloc_template&lt;<span class="number">0</span>&gt; malloc_alloc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">Alloc</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">simple_alloc</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> T *<span class="title">allocate</span><span class="params">(<span class="type">size_t</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> == n ? <span class="number">0</span> : (T *)Alloc::<span class="built_in">allocate</span>(n * <span class="built_in">sizeof</span>(T));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> T *<span class="title">allocate</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (T *)Alloc::<span class="built_in">allocate</span>(<span class="built_in">sizeof</span>(T));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">deallocate</span><span class="params">(T *p, <span class="type">size_t</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> != n)</span><br><span class="line">            Alloc::<span class="built_in">deallocate</span>(p, n * <span class="built_in">sizeof</span>(T));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">deallocate</span><span class="params">(T *p)</span> </span>&#123;</span><br><span class="line">        Alloc::<span class="built_in">deallocate</span>(p, <span class="built_in">sizeof</span>(T));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></div></figure><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¬¬äºŒçº§åˆ†é…å™¨</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _STD_ALLOC_2ND_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _STD_ALLOC_2ND_H_</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_alloc_1st.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬äºŒç´šé…ç½®å™¨</span></span><br><span class="line"><span class="comment">//----------------------------------------------</span></span><br><span class="line"><span class="keyword">enum</span> &#123;</span><br><span class="line">    __ALIGN = <span class="number">8</span></span><br><span class="line">&#125;;  <span class="comment">// å°å€å¡Šçš„ä¸Šèª¿é‚Šç•Œ</span></span><br><span class="line"><span class="keyword">enum</span> &#123;</span><br><span class="line">    __MAX_BYTES = <span class="number">128</span></span><br><span class="line">&#125;;  <span class="comment">// å°å€å¡Šçš„ä¸Šé™</span></span><br><span class="line"><span class="keyword">enum</span> &#123;</span><br><span class="line">    __NFREELISTS = __MAX_BYTES / __ALIGN</span><br><span class="line">&#125;;  <span class="comment">// free-lists å€‹æ•¸</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ¬ä¾‹ä¸­å…©å€‹ template åƒæ•¸å®Œå…¨æ²’æœ‰æ´¾ä¸Šç”¨å ´</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">bool</span> threads, <span class="type">int</span> inst&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">__default_alloc_template</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// å¯¦éš›ä¸Šæ‡‰ä½¿ç”¨ static const int x = N</span></span><br><span class="line">    <span class="comment">// å–ä»£ enum &#123; x = N &#125;, ä½†ç›®å‰æ”¯æ´è©²æ€§è³ªçš„ç·¨è­¯å™¨ä¸å¤š</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">size_t</span> <span class="title">ROUND_UP</span><span class="params">(<span class="type">size_t</span> bytes)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (((bytes) + __ALIGN - <span class="number">1</span>) &amp; ~(__ALIGN - <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">union</span> <span class="title class_">obj</span> &#123;</span><br><span class="line">        <span class="keyword">union</span> <span class="title class_">obj</span> *free_list_link;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">static</span> obj *<span class="keyword">volatile</span> free_list[__NFREELISTS];</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">size_t</span> <span class="title">FREELIST_INDEX</span><span class="params">(<span class="type">size_t</span> bytes)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (((bytes) + __ALIGN - <span class="number">1</span>) / __ALIGN - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Returns an object of size n, and optionally adds to size n free list.</span></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> *<span class="title">refill</span><span class="params">(<span class="type">size_t</span> n)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Allocates a chunk for nobjs of size &quot;size&quot;.  nobjs may be reduced</span></span><br><span class="line">    <span class="comment">// if it is inconvenient to allocate the requested number.</span></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">char</span> *<span class="title">chunk_alloc</span><span class="params">(<span class="type">size_t</span> size, <span class="type">int</span> &amp;nobjs)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Chunk allocation state.</span></span><br><span class="line">    <span class="type">static</span> <span class="type">char</span> *start_free;</span><br><span class="line">    <span class="type">static</span> <span class="type">char</span> *end_free;</span><br><span class="line">    <span class="type">static</span> <span class="type">size_t</span> heap_size;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> *<span class="title">allocate</span><span class="params">(<span class="type">size_t</span> n)</span>  <span class="comment">// n must be &gt; 0</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        obj *<span class="keyword">volatile</span> *my_free_list;  <span class="comment">// obj** my_free_list;</span></span><br><span class="line">        obj *result;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (n &gt; (<span class="type">size_t</span>)__MAX_BYTES) &#123;</span><br><span class="line">            <span class="keyword">return</span> (malloc_alloc::<span class="built_in">allocate</span>(n));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        my_free_list = free_list + <span class="built_in">FREELIST_INDEX</span>(n);</span><br><span class="line">        result = *my_free_list;</span><br><span class="line">        <span class="keyword">if</span> (result == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">void</span> *r = <span class="built_in">refill</span>(<span class="built_in">ROUND_UP</span>(n));</span><br><span class="line">            <span class="keyword">return</span> r;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        *my_free_list = result-&gt;free_list_link;</span><br><span class="line">        <span class="keyword">return</span> (result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">deallocate</span><span class="params">(<span class="type">void</span> *p, <span class="type">size_t</span> n)</span>  <span class="comment">// p may not be 0</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        obj *q = (obj *)p;</span><br><span class="line">        obj *<span class="keyword">volatile</span> *my_free_list;  <span class="comment">// obj** my_free_list;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (n &gt; (<span class="type">size_t</span>)__MAX_BYTES) &#123;</span><br><span class="line">            malloc_alloc::<span class="built_in">deallocate</span>(p, n);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        my_free_list = free_list + <span class="built_in">FREELIST_INDEX</span>(n);</span><br><span class="line">        q-&gt;free_list_link = *my_free_list;</span><br><span class="line">        *my_free_list = q;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> *<span class="title">reallocate</span><span class="params">(<span class="type">void</span> *p, <span class="type">size_t</span> old_sz, <span class="type">size_t</span> new_sz)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//----------------------------------------------</span></span><br><span class="line"><span class="comment">// We allocate memory in large chunks in order to</span></span><br><span class="line"><span class="comment">// avoid fragmentingthe malloc heap too much.</span></span><br><span class="line"><span class="comment">// We assume that size is properly aligned.</span></span><br><span class="line"><span class="comment">// We hold the allocation lock.</span></span><br><span class="line"><span class="comment">//----------------------------------------------</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">bool</span> threads, <span class="type">int</span> inst&gt;</span><br><span class="line"><span class="type">char</span> *</span><br><span class="line">__default_alloc_template&lt;threads, inst&gt;::</span><br><span class="line">    <span class="built_in">chunk_alloc</span>(<span class="type">size_t</span> size, <span class="type">int</span> &amp;nobjs) &#123;</span><br><span class="line">    <span class="type">char</span> *result;</span><br><span class="line">    <span class="type">size_t</span> total_bytes = size * nobjs;</span><br><span class="line">    <span class="type">size_t</span> bytes_left = end_free - start_free;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (bytes_left &gt;= total_bytes) &#123;</span><br><span class="line">        result = start_free;</span><br><span class="line">        start_free += total_bytes;</span><br><span class="line">        <span class="keyword">return</span> (result);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (bytes_left &gt;= size) &#123;</span><br><span class="line">        nobjs = bytes_left / size;</span><br><span class="line">        total_bytes = size * nobjs;</span><br><span class="line">        result = start_free;</span><br><span class="line">        start_free += total_bytes;</span><br><span class="line">        <span class="keyword">return</span> (result);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">size_t</span> bytes_to_get =</span><br><span class="line">            <span class="number">2</span> * total_bytes + <span class="built_in">ROUND_UP</span>(heap_size &gt;&gt; <span class="number">4</span>);</span><br><span class="line">        <span class="comment">// Try to make use of the left-over piece.</span></span><br><span class="line">        <span class="keyword">if</span> (bytes_left &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            obj *<span class="keyword">volatile</span> *my_free_list =</span><br><span class="line">                free_list + <span class="built_in">FREELIST_INDEX</span>(bytes_left);</span><br><span class="line"></span><br><span class="line">            ((obj *)start_free)-&gt;free_list_link = *my_free_list;</span><br><span class="line">            *my_free_list = (obj *)start_free;</span><br><span class="line">        &#125;</span><br><span class="line">        start_free = (<span class="type">char</span> *)<span class="built_in">malloc</span>(bytes_to_get);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> == start_free) &#123;</span><br><span class="line">            <span class="type">int</span> i;</span><br><span class="line">            obj *<span class="keyword">volatile</span> *my_free_list, *p;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Try to make do with what we have. That can&#x27;t</span></span><br><span class="line">            <span class="comment">// hurt. We do not try smaller requests, since that tends</span></span><br><span class="line">            <span class="comment">// to result in disaster on multi-process machines.</span></span><br><span class="line">            <span class="keyword">for</span> (i = size; i &lt;= __MAX_BYTES; i += __ALIGN) &#123;</span><br><span class="line">                my_free_list = free_list + <span class="built_in">FREELIST_INDEX</span>(i);</span><br><span class="line">                p = *my_free_list;</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">0</span> != p) &#123;</span><br><span class="line">                    *my_free_list = p-&gt;free_list_link;</span><br><span class="line">                    start_free = (<span class="type">char</span> *)p;</span><br><span class="line">                    end_free = start_free + i;</span><br><span class="line">                    <span class="keyword">return</span> (<span class="built_in">chunk_alloc</span>(size, nobjs));</span><br><span class="line">                    <span class="comment">// Any leftover piece will eventually make it to the</span></span><br><span class="line">                    <span class="comment">// right free list.</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            end_free = <span class="number">0</span>;  <span class="comment">// In case of exception.</span></span><br><span class="line">            start_free = (<span class="type">char</span> *)malloc_alloc::<span class="built_in">allocate</span>(bytes_to_get);</span><br><span class="line">            <span class="comment">// This should either throw an exception or</span></span><br><span class="line">            <span class="comment">// remedy the situation. Thus we assume it</span></span><br><span class="line">            <span class="comment">// succeeded.</span></span><br><span class="line">        &#125;</span><br><span class="line">        heap_size += bytes_to_get;</span><br><span class="line">        end_free = start_free + bytes_to_get;</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">chunk_alloc</span>(size, nobjs));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//----------------------------------------------</span></span><br><span class="line"><span class="comment">// Returns an object of size n, and optionally adds</span></span><br><span class="line"><span class="comment">// to size n free list.We assume that n is properly aligned.</span></span><br><span class="line"><span class="comment">// We hold the allocation lock.</span></span><br><span class="line"><span class="comment">//----------------------------------------------</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">bool</span> threads, <span class="type">int</span> inst&gt;</span><br><span class="line"><span class="type">void</span> *__default_alloc_template&lt;threads, inst&gt;::</span><br><span class="line">    <span class="built_in">refill</span>(<span class="type">size_t</span> n) &#123;</span><br><span class="line">    <span class="type">int</span> nobjs = <span class="number">20</span>;</span><br><span class="line">    <span class="type">char</span> *chunk = <span class="built_in">chunk_alloc</span>(n, nobjs);</span><br><span class="line">    obj *<span class="keyword">volatile</span> *my_free_list;  <span class="comment">// obj** my_free_list;</span></span><br><span class="line">    obj *result;</span><br><span class="line">    obj *current_obj;</span><br><span class="line">    obj *next_obj;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">1</span> == nobjs)</span><br><span class="line">        <span class="keyword">return</span> (chunk);</span><br><span class="line">    my_free_list = free_list + <span class="built_in">FREELIST_INDEX</span>(n);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Build free list in chunk</span></span><br><span class="line">    result = (obj *)chunk;</span><br><span class="line">    *my_free_list = next_obj = (obj *)(chunk + n);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>;; ++i) &#123;</span><br><span class="line">        current_obj = next_obj;</span><br><span class="line">        next_obj = (obj *)((<span class="type">char</span> *)next_obj + n);</span><br><span class="line">        <span class="keyword">if</span> (nobjs - <span class="number">1</span> == i) &#123;</span><br><span class="line">            current_obj-&gt;free_list_link = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            current_obj-&gt;free_list_link = next_obj;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (result);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//----------------------------------------------</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">bool</span> threads, <span class="type">int</span> inst&gt;</span><br><span class="line"><span class="type">char</span> *__default_alloc_template&lt;threads, inst&gt;::start_free = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">bool</span> threads, <span class="type">int</span> inst&gt;</span><br><span class="line"><span class="type">char</span> *__default_alloc_template&lt;threads, inst&gt;::end_free = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">bool</span> threads, <span class="type">int</span> inst&gt;</span><br><span class="line"><span class="type">size_t</span> __default_alloc_template&lt;threads, inst&gt;::heap_size = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="type">bool</span> threads, <span class="type">int</span> inst&gt;</span><br><span class="line"><span class="keyword">typename</span> __default_alloc_template&lt;threads, inst&gt;::obj *<span class="keyword">volatile</span> __default_alloc_template&lt;threads, inst&gt;::free_list[__NFREELISTS] = &#123;</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------------------------------</span></span><br><span class="line"><span class="comment">// ä»¤ç¬¬2ç´šé…ç½®å™¨çš„åç¨±ç‚º alloc</span></span><br><span class="line"><span class="keyword">using</span> alloc = __default_alloc_template&lt;<span class="literal">false</span>, <span class="number">0</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></div></figure><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æµ‹è¯•ç¨‹åº</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_alloc_2nd.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_G29_alloc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;test_global_allocator_with_16_freelist().......... \n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">void</span> *p1 = alloc::<span class="built_in">allocate</span>(<span class="number">120</span>);</span><br><span class="line">    <span class="type">void</span> *p2 = alloc::<span class="built_in">allocate</span>(<span class="number">72</span>);</span><br><span class="line">    <span class="type">void</span> *p3 = alloc::<span class="built_in">allocate</span>(<span class="number">60</span>);  <span class="comment">// ä¸æ˜¯ 8 å€æ•¸</span></span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; p1 &lt;&lt; endl</span><br><span class="line">         &lt;&lt; p2 &lt;&lt; endl</span><br><span class="line">         &lt;&lt; p3 &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    alloc::<span class="built_in">deallocate</span>(p1, <span class="number">120</span>);</span><br><span class="line">    alloc::<span class="built_in">deallocate</span>(p2, <span class="number">72</span>);</span><br><span class="line">    alloc::<span class="built_in">deallocate</span>(p3, <span class="number">60</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»¥ä¸‹, ä¸èƒ½æ­é…å®¹å™¨ä¾†æ¸¬è©¦, å› ç‚ºæ–°ç‰ˆ G++ å°æ–¼ allocator æœ‰æ›´å¤šè¦æ±‚ (è©¢å•æ›´å¤š typedef è€Œ alloc éƒ½ç„¡æ³•å›ç­”)</span></span><br><span class="line">    <span class="comment">// å®ƒå…¶å¯¦å°±æ˜¯ G4.9 __pool_allocï¼Œæ‰€ä»¥è®“ G4.9å®¹å™¨ä½¿ç”¨ __pool_alloc ä¹Ÿå°±ç­‰åŒæ–¼é€™è£¡æ‰€è¦çš„æ¸¬è©¦</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        vector&lt;int, simple_alloc&lt;int,alloc&gt;&gt; v;</span></span><br><span class="line"><span class="comment">        for(int i=0; i&lt; 1000; ++i)</span></span><br><span class="line"><span class="comment">            v.push_back(i);</span></span><br><span class="line"><span class="comment">        for(int i=700; i&lt; 720; ++i)</span></span><br><span class="line"><span class="comment">            cout &lt;&lt; v[i] &lt;&lt; &#x27; &#x27;;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">test_G29_alloc</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ‰§è¡Œç»“æœï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230531113514416.png" alt="image-20230531113514416"></p><h3 id="gc29-stdallocè§‚å¿µå¤§æ•´ç†"><a href="#gc29-stdallocè§‚å¿µå¤§æ•´ç†" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#gc29-stdallocè§‚å¿µå¤§æ•´ç†"></a> Gc2.9 std::allocè§‚å¿µå¤§æ•´ç†</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230531112717690.png" alt="image-20230531112717690"></p><p>å‡è®¾è¿™é‡Œlist&lt;&gt;ä½¿ç”¨çš„åˆ†é…å™¨æ˜¯std::allocï¼Œlisté™¤äº†æœ¬èº«çš„Fooä¹‹å¤–ï¼Œè¿˜å¸¦æœ‰listçš„ä¸¤æ ¹æŒ‡é’ˆï¼Œå¦‚æœsizeof(Foo) + 2 * æŒ‡é’ˆå¤§å° &lt; 128ï¼Œé‚£ä¹ˆå¯ä»¥è°ƒç”¨allocåˆ†é…å™¨ï¼›</p><p>ç¬¬äºŒè¡Œlist&lt;&gt;å®¹å™¨è°ƒç”¨push_back()æ’å…¥æ“ä½œï¼ŒFoo(1)æ˜¯ä¸´æ—¶å¯¹è±¡ï¼Œæ”¾åœ¨æ ˆåŒºï¼Œç„¶åè°ƒç”¨copy ctorï¼ŒæŠŠä»–æ”¾åˆ°allocåˆ›é€ çš„ç©ºé—´å½“ä¸­ï¼Œè¿™ä¸€æ®µç©ºé—´ä¸å¸¦æœ‰cookieï¼›</p><p>ç¬¬äºŒä¸ªæ“ä½œæŠŠä¸€ä¸ªç”±mallocåŠ¨æ€å¼€è¾Ÿå‡ºæ¥å¸¦æœ‰cookieçš„ç©ºé—´copyåˆ°allocåˆ›é€ çš„ç©ºé—´å½“ä¸­ï¼ŒåŒæ ·ä¹Ÿä¸å¸¦æœ‰cookie</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230531133126758.png" alt="image-20230531133126758"></p><p>æ³¨æ„ç­‰å·åˆ¤æ–­çš„å†™æ³•ï¼Œè¿™é‡Œæ¨èæŠŠå³å€¼æ”¾åœ¨ç­‰å·å·¦è¾¹ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p><strong>è¿™æ ·çš„è¯ï¼Œå¦‚æœæˆ‘ä¸å°å¿ƒæŠŠ == å·å†™æˆäº† = å·ï¼Œé‚£ä¹ˆ 0 = start_freeæ˜¯æ²¡åŠæ³•é€šè¿‡çš„ï¼Œä¼šæŠ¥é”™ï¼Œå¦‚æœäº¤æ¢é¡ºåºåˆ™ä¼šé€šè¿‡ï¼Œé€ æˆçš„åæœæ˜¯éå¸¸ä¸¥é‡çš„ï¼Œæ‰€ä»¥å¼ºçƒˆå»ºè®®åˆ¤æ–­ == çš„æ—¶å€™æŠŠå³å€¼æ”¾åœ¨ç­‰å·å·¦è¾¹ï¼ï¼</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230531134700621.png" alt="image-20230531134700621"></p><p><strong>å½“æ²¡æœ‰å†…å­˜å¯ä»¥åˆ†é…çš„æ—¶å€™ï¼Œåˆ†é…å™¨ä¼šå»æ‰¾å·²æœ‰çš„å†…å­˜ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢å¾€åæ‰¾ä¸€å—free_listä¸‹çš„å†…å­˜å—åˆ’åˆ†ç»™ç”¨æˆ·å’Œæˆ˜å¤‡æ± ï¼Œå¦‚æœè¿™éƒ½æ²¡æœ‰çš„è¯å°±gå•¦ã€‚ä½†æ˜¯å½“æ—¶æˆ‘ä»¬æåˆ°è¿‡ï¼Œå¯ä»¥æŠŠå‰©ä½™çš„å†…å­˜(æ¯”å¦‚9688åˆ°10000è¿˜æœ‰312)ï¼Œå¯ä»¥æŠŠå‰©ä½™çš„å†…å­˜å‡åŠå†å‡åŠï¼Œç›´åˆ°å¯ä»¥è¢«åˆ†é…å‡ºæ¥ï¼Œè¿™æ ·ä¸æ˜¯å¯ä»¥æ›´å¥½çš„åˆ©ç”¨å†…å­˜å—ï¼Ÿæƒ³æ³•æ˜¯è‚¯å®šçš„ï¼Œä½†æ˜¯ä¸Šé¢è¯´åœ¨å¤šè¿›ç¨‹çš„æœºå™¨ä¸Šä¼šå¸¦æ¥å¤§ç¾éš¾ï¼Œè¿™é‡Œçš„ç†è§£ä¸ä¸€äº†ï¼Œä¸€ç§ç†è§£æ˜¯è¿™ä¸æ˜¯æ›´å¥½çš„åˆ©ç”¨å†…å­˜äº†å˜›ï¼Ÿå¦ä¸€ç§æ˜¯ä½ æŠŠå†…å­˜å°½å¯èƒ½çš„ä½¿ç”¨äº†ï¼Œå…¶ä»–äººæ€ä¹ˆåŠå‘¢ï¼ŸGc2.9é€‰æ‹©äº†åè€…ï¼Œå¦‚æœæƒ³å®ç°å‰è€…ï¼Œä¹Ÿä¸æ˜¯ä¸å¯ä»¥ï¼Œåªæ˜¯éš¾åº¦æ¯”è¾ƒå¤§</strong></p><p>å¦å¤–ä¸€ä¸ªé—®é¢˜å°±æ˜¯ä»–çš„deallocate()å‡½æ•°ä¸è¿›è¡Œå†…å­˜çš„å½’è¿˜ï¼Œè¿™ä¹Ÿæ˜¯å—é™åˆ¶äºè¿™ä¸ªè®¾è®¡å…ˆå¤©çš„ç¼ºé™·å§ï¼Œé“¾è¡¨æŒ‡æ¥æŒ‡å»ï¼Œå†…å­˜ä¸ä¸€å®šè¿ç»­ï¼Œè¿™æ ·å°±æ²¡æœ‰æŠŠæ¡freeå†…å­˜</p><p>æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ext/pool_allocator.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Value_Type&gt;</span><br><span class="line"><span class="keyword">using</span> listPool = list&lt;Value_Type, __gnu_cxx::__pool_alloc&lt;Value_Type&gt;&gt;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">long</span> <span class="type">long</span> countNew = <span class="number">0</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">long</span> <span class="type">long</span> countDel = <span class="number">0</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">long</span> <span class="type">long</span> countArrayNew = <span class="number">0</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">long</span> <span class="type">long</span> countArrayDel = <span class="number">0</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">long</span> <span class="type">long</span> timesNew = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸¤ä¸ªå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">myAlloc</span><span class="params">(<span class="type">size_t</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">malloc</span>(size);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">myFree</span><span class="params">(<span class="type">void</span>* ptr)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">free</span>(ptr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡è½½å…¨å±€operator new/delete</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span>* <span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="type">size_t</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// cout &lt;&lt; &quot;global new(), \t&quot; &lt;&lt; size &lt;&lt; &quot;\t&quot;;</span></span><br><span class="line">    countNew += size;</span><br><span class="line">    ++timesNew;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">myAlloc</span>(size);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="type">void</span>* <span class="keyword">operator</span> <span class="keyword">new</span>[](<span class="type">size_t</span> size) &#123;</span><br><span class="line">    <span class="comment">// cout &lt;&lt; &quot;global new[](), \t&quot; &lt;&lt; size &lt;&lt; &quot;\t&quot;;</span></span><br><span class="line">    countArrayNew += size;</span><br><span class="line"></span><br><span class="line">    <span class="type">void</span>* p = <span class="built_in">myAlloc</span>(size);</span><br><span class="line">    cout &lt;&lt; p &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">myAlloc</span>(size);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤©å•Š, ä»¥ä¸‹(1)(2)å¯ä»¥ä¸¦å­˜ä¸¦ç”±(2)æŠ“ä½æµç¨‹ (ä½†å®ƒå°æˆ‘é€™å…’çš„æ¸¬è©¦ç„¡ç”¨).</span></span><br><span class="line"><span class="comment">// ç•¶åªå­˜åœ¨ (1) æ™‚, æŠ“ä¸ä½æµç¨‹.</span></span><br><span class="line"><span class="comment">// åœ¨ class members ä¸­äºŒè€…åªèƒ½æ“‡ä¸€ (ä»»ä¸€å‡å¯)</span></span><br><span class="line"><span class="comment">//(1)</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="keyword">operator</span> <span class="title">delete</span><span class="params">(<span class="type">void</span>* ptr, <span class="type">size_t</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// cout &lt;&lt; &quot;global delete(ptr,size), \t&quot; &lt;&lt; ptr &lt;&lt; &quot;\t&quot; &lt;&lt; size &lt;&lt; endl;</span></span><br><span class="line">    countDel += size;</span><br><span class="line">    <span class="built_in">myFree</span>(ptr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//(2)</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="keyword">operator</span> <span class="title">delete</span><span class="params">(<span class="type">void</span>* ptr)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// cout &lt;&lt; &quot;global delete(ptr), \t&quot; &lt;&lt; ptr &lt;&lt; endl;</span></span><br><span class="line">    <span class="built_in">myFree</span>(ptr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//(1)</span></span><br><span class="line"><span class="keyword">inline</span> <span class="type">void</span> <span class="keyword">operator</span> <span class="keyword">delete</span>[](<span class="type">void</span>* ptr, <span class="type">size_t</span> size) &#123;</span><br><span class="line">    <span class="comment">// cout &lt;&lt; &quot;global delete[](ptr,size), \t&quot; &lt;&lt; ptr &lt;&lt; &quot;\t&quot; &lt;&lt; size &lt;&lt; endl;</span></span><br><span class="line">    countArrayDel += size;</span><br><span class="line">    <span class="built_in">myFree</span>(ptr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//(2)</span></span><br><span class="line"><span class="keyword">inline</span> <span class="type">void</span> <span class="keyword">operator</span> <span class="keyword">delete</span>[](<span class="type">void</span>* ptr) &#123;</span><br><span class="line">    <span class="comment">// cout &lt;&lt; &quot;global delete[](ptr), \t&quot; &lt;&lt; ptr &lt;&lt; endl;</span></span><br><span class="line">    <span class="built_in">myFree</span>(ptr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_overload_global_new</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;test_overload_global_new().......... \n&quot;</span></span><br><span class="line">         &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//***** æ¸¬è©¦æ™‚, main() ä¸­çš„å…¶ä»–æ¸¬è©¦å…¨éƒ½ remark, ç¨ç•™æœ¬æ¸¬è©¦ *****</span></span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;::countNew= &quot;</span> &lt;&lt; ::countNew &lt;&lt; endl;  <span class="comment">// 0</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;::countDel= &quot;</span> &lt;&lt; ::countDel &lt;&lt; endl;  <span class="comment">// 0</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;::timesNew= &quot;</span> &lt;&lt; ::timesNew &lt;&lt; endl;  <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line">        string* p = <span class="keyword">new</span> <span class="built_in">string</span>(<span class="string">&quot;My name is Ace&quot;</span>);  <span class="comment">// jjhou global new(), 4 	(è¨»ï¼šé€™æ˜¯ string size)</span></span><br><span class="line">                                                   <span class="comment">// jjhou global new(), 27	(è¨»ï¼šé€™æ˜¯ sizeof(Rep)+extra)</span></span><br><span class="line">        <span class="keyword">delete</span> p;                                  <span class="comment">// jjhou global delete(ptr), 0x3e3e48</span></span><br><span class="line">                                                   <span class="comment">// jjhou global delete(ptr), 0x3e3e38</span></span><br><span class="line"></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;::countNew= &quot;</span> &lt;&lt; ::countNew &lt;&lt; endl;  <span class="comment">// 31 ==&gt; 4+27</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;::timesNew= &quot;</span> &lt;&lt; ::timesNew &lt;&lt; endl;  <span class="comment">// 2</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;::countDel= &quot;</span> &lt;&lt; ::countDel &lt;&lt; endl;  <span class="comment">// 0 &lt;== æœ¬æ¸¬è©¦é¡¯ç„¶æˆ‘æ°¸é è§€å¯Ÿä¸åˆ°æˆ‘æ‰€è¦è§€å¯Ÿçš„</span></span><br><span class="line">                                                       <span class="comment">//       å› ç‚ºé€²ä¸å» operator delete(ptr,size) ç‰ˆ</span></span><br><span class="line"></span><br><span class="line">        p = <span class="keyword">new</span> string[<span class="number">3</span>];  <span class="comment">// jjhou global new[](), 16 (è¨»ï¼šå…¶ä¸­å…§å« arraySize field: 4 bytes,</span></span><br><span class="line">                            <span class="comment">// æ‰€ä»¥ 16-4 = 12 ==&gt; 4*3, ä¹Ÿå°±æ˜¯ 3 å€‹ string æ¯å€‹ä½” 4 bytes)</span></span><br><span class="line">        <span class="comment">// jjhou global new(), 13  	//Nil string</span></span><br><span class="line">        <span class="comment">// jjhou global new(), 13	//Nil string</span></span><br><span class="line">        <span class="comment">// jjhou global new(), 13	//Nil string</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">delete</span>[] p;  <span class="comment">// jjhou global delete(ptr),   0x3e3e88</span></span><br><span class="line">                     <span class="comment">// jjhou global delete(ptr),   0x3e3e70</span></span><br><span class="line">                     <span class="comment">// jjhou global delete(ptr),   0x3e39c8</span></span><br><span class="line">                     <span class="comment">// jjhou global delete[](ptr), 0x3e3978</span></span><br><span class="line"></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;::countNew= &quot;</span> &lt;&lt; ::countNew &lt;&lt; endl;            <span class="comment">// 70 ==&gt; 4+27+13+13+13</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;::timesNew= &quot;</span> &lt;&lt; ::timesNew &lt;&lt; endl;            <span class="comment">// 5</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;::countArrayNew= &quot;</span> &lt;&lt; ::countArrayNew &lt;&lt; endl;  <span class="comment">// 16 (é€™å€‹æ•¸å€¼å…¶å¯¦å°æˆ‘è€Œè¨€ç„¡æ„ç¾©)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¸¬è©¦: global operator new ä¹Ÿæœƒå¸¶å®¹å™¨å¸¶ä¾†å½±éŸ¿</span></span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">vec</span><span class="params">(<span class="number">10</span>)</span></span>;  <span class="comment">// jjhou global new(), 	40  	0x3e3ea0  (è¨»ï¼š10 ints)</span></span><br><span class="line">                              <span class="comment">// è¨»ï¼švector object æœ¬èº«ä¸æ˜¯ dynamic allocated.</span></span><br><span class="line">        vec.<span class="built_in">push_back</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// jjhou global new(), 	80		0x3e3ed0</span></span><br><span class="line">        <span class="comment">// jjhou global delete(ptr), 	0x3e3ea0</span></span><br><span class="line">        vec.<span class="built_in">push_back</span>(<span class="number">1</span>);</span><br><span class="line">        vec.<span class="built_in">push_back</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;::countNew= &quot;</span> &lt;&lt; ::countNew &lt;&lt; endl;  <span class="comment">// 190 ==&gt; 70+40+80</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;::timesNew= &quot;</span> &lt;&lt; ::timesNew &lt;&lt; endl;  <span class="comment">// 7</span></span><br><span class="line"></span><br><span class="line">        list&lt;<span class="type">int</span>&gt; lst;                                 <span class="comment">// è¨»ï¼šlist object æœ¬èº«ä¸æ˜¯ dynamic allocated.</span></span><br><span class="line">        lst.<span class="built_in">push_back</span>(<span class="number">1</span>);                              <span class="comment">// jjhou global new(), 	12	(è¨»ï¼šæ¯å€‹ nodeæ˜¯ 12 bytes)</span></span><br><span class="line">        lst.<span class="built_in">push_back</span>(<span class="number">1</span>);                              <span class="comment">// jjhou global new(), 	12</span></span><br><span class="line">        lst.<span class="built_in">push_back</span>(<span class="number">1</span>);                              <span class="comment">// jjhou global new(), 	12</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;::countNew= &quot;</span> &lt;&lt; ::countNew &lt;&lt; endl;  <span class="comment">// 226 ==&gt; 190+12+12+12</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;::timesNew= &quot;</span> &lt;&lt; ::timesNew &lt;&lt; endl;  <span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// jjhou global delete(ptr), 	0x3e3978</span></span><br><span class="line">        <span class="comment">// jjhou global delete(ptr), 	0x3e39c8</span></span><br><span class="line">        <span class="comment">// jjhou global delete(ptr), 	0x3e3e70</span></span><br><span class="line">        <span class="comment">// jjhou global delete(ptr), 	0x3e3ed0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; endl</span><br><span class="line">         &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// reset countNew</span></span><br><span class="line">        countNew = <span class="number">0</span>;</span><br><span class="line">        timesNew = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// list&lt;double, __gnu_cxx::__pool_alloc&lt;double&gt;&gt; lst;</span></span><br><span class="line">        <span class="comment">// ä¸Šä¸€è¡Œæ”¹ç”¨ C++/11 alias template ä¾†å¯« :</span></span><br><span class="line">        listPool&lt;<span class="type">double</span>&gt; lst;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000000</span>; ++i)</span><br><span class="line">            lst.<span class="built_in">push_back</span>(i);</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;::countNew= &quot;</span> &lt;&lt; ::countNew &lt;&lt; endl;  <span class="comment">// 16752832 (æ³¨æ„, node éƒ½ä¸å¸¶ cookie)</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;::timesNew= &quot;</span> &lt;&lt; ::timesNew &lt;&lt; endl;  <span class="comment">// 122</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; endl</span><br><span class="line">         &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// reset countNew</span></span><br><span class="line">        countNew = <span class="number">0</span>;</span><br><span class="line">        timesNew = <span class="number">0</span>;</span><br><span class="line">        list&lt;<span class="type">double</span>&gt; lst;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000000</span>; ++i)</span><br><span class="line">            lst.<span class="built_in">push_back</span>(i);</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;::countNew= &quot;</span> &lt;&lt; ::countNew &lt;&lt; endl;  <span class="comment">// 16000000 (æ³¨æ„, node éƒ½å¸¶ cookie)</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;::timesNew= &quot;</span> &lt;&lt; ::timesNew &lt;&lt; endl;  <span class="comment">// 1000000</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸ºäº†é˜²æ­¢åˆ·å±æˆ‘æŠŠoperator new/deleteé‡Œé¢è¾“å‡ºçš„å†…å®¹ç»™æ³¨é‡Šäº†</span></span><br><span class="line">    <span class="built_in">test_overload_global_new</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ‰§è¡Œç»“æœï¼š</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230531143041896.png" alt="image-20230531143041896" style="zoom:80%"><h2 id="ç¬¬å››è®²lokiallocator"><a href="#ç¬¬å››è®²lokiallocator" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¬¬å››è®²lokiallocator"></a> ç¬¬å››è®²ï¼šloki::allocator</h2><p>ç¬¬ä¸‰è®²å°†mallocå’Œfreeï¼Œå¤ªéš¾äº†ï¼Œè¿™éƒ¨åˆ†æš‚æ—¶æ²¡å¬.</p><h3 id="lokiallocatorè®¾è®¡"><a href="#lokiallocatorè®¾è®¡" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#lokiallocatorè®¾è®¡"></a> Loki::allocatorè®¾è®¡</h3><p><strong>Lokiåˆ†é…å™¨å’Œstd::allocåˆ†é…å™¨çš„åŒºåˆ«ï¼Œstd::allocåˆ†é…å™¨çš„è‡´å‘½ä¼¤æ˜¯ä»–è¦åˆ°ä¸€å¤§å—å†…å­˜ä¹‹åè¿›è¡Œè®¾è®¡ï¼Œç„¶ååˆ†é…ç»™ç”¨æˆ·ä¹‹åï¼Œç”¨æˆ·å‘å‡ºé‡Šæ”¾å†…å­˜çš„æ“ä½œçš„æ—¶å€™ï¼Œåˆ†é…å™¨å†…éƒ¨çš„å®ç°æ˜¯ä¸å½’è¿˜ç»™æ“ä½œç³»ç»Ÿçš„ï¼Œä»–å¾ˆéœ¸é“ï¼Œå®˜æ–¹çš„è§£é‡Šæ˜¯ä¸€æ˜¯å®ç°å¾ˆéš¾ï¼ŒäºŒæ˜¯å½’è¿˜è¿™ä¸ªæ“ä½œå¯èƒ½åœ¨å¤šä»»åŠ¡è¿›ç¨‹ä¸­ä¼šå½±å“å…¶ä»–è¿›ç¨‹çš„æ“ä½œï¼Œè€ŒLokiåˆ†é…å™¨å°±è§£å†³äº†è¿™ä¸ªé—®é¢˜</strong></p><p>å¦‚ä½•è®¾è®¡ï¼Ÿ</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230609153221116.png" alt="image-20230609153221116"></p><p>ä¸‰å±‚ç»“æ„å¦‚ä¸Šï¼š</p><p>æœ€ä¸‹å±‚Chunkï¼Œå­˜æ”¾è¿™ä¸€å—çš„æŒ‡é’ˆï¼Œè¿™ä¸€å—çš„ç´¢å¼•å’Œç›®å‰è¿˜å¯ä»¥ä¾›åº”çš„åŒºå—</p><p>ä¸­é—´å±‚FixedAllocatorï¼Œå­˜æ”¾vector&lt; Chunk &gt;å’Œä¸¤æ ¹æŒ‡å‘Chunkçš„æŒ‡é’ˆ</p><p>æœ€ä¸Šé¢çš„å±‚SmallObjAllocatorï¼Œ<strong>ä¹Ÿå°±æ˜¯ç”¨æˆ·é¢å¯¹çš„å±‚æ¬¡</strong>ï¼Œå­˜æ”¾vector&lt; FixedAllocator &gt;å’Œä¸¤æ ¹æŒ‡å‘FixedAllocatorçš„æŒ‡é’ˆ</p><p><strong>è‡³äºä¸ºä»€ä¹ˆè¦æŒ‡å‘æŸä¸¤ä¸ªï¼Œè¿™ä¸¤ä¸ªå¯èƒ½è¿˜æœ‰å…¶ä»–çš„ç‰¹æ®Šä½œç”¨ï¼Œè¿™ä¸ªåé¢å†è¯´</strong></p><h3 id="æºä»£ç "><a href="#æºä»£ç " class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æºä»£ç "></a> æºä»£ç </h3><h4 id="chunkç±»"><a href="#chunkç±»" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#chunkç±»"></a> Chunkç±»</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230609155142232.png" alt="image-20230609155142232"></p><p>è¿™äº›å‡½æ•°éƒ½æ˜¯é«˜å±‚çš„ç±»è°ƒç”¨åº•å±‚çš„ç±»çš„ï¼Œæˆ‘ä»¬ç”¨æˆ·åœ¨å®é™…æ“ä½œçš„æ—¶å€™æ²¡æœ‰å¿…è¦ç›´æ¥è°ƒç”¨è¿™ä¸ª</p><p>Init()å‡½æ•°ï¼šæŒ–å‡ºä¸€å¤§å—å†…å­˜ç”¨äºæ“ä½œï¼Œå•ä½å¤§å°å’ŒåŒºå—ä¸ªæ•°éƒ½ç»è¿‡äº†è°ƒæ•´</p><p>Reset()å‡½æ•°ï¼šå¯¹è¿™å¤§å—å†…å­˜è¿›è¡Œåˆ†é…ï¼Œå°±æ˜¯æ ‡å‡ºChunké‚£ä¸‰å—ï¼Œ å…¶ä¸­ç”¨æµæ°´çº¿çš„æ–¹å¼è¡¨ç¤ºç´¢å¼•ï¼ŒæŠŠæœ€å‰é¢ä¸€ä¸ªå­—èŠ‚çš„ç©ºé—´å æ®læ¥å½“ä½œç´¢å¼•ï¼Œæ¦‚å¿µç±»ä¼¼äºembedded pointer(åµŒå…¥å¼æŒ‡é’ˆ)ï¼Œåªä¸è¿‡è¿™é‡Œæ˜¯åµŒå…¥å¼ç´¢å¼•</p><p><strong>é‡å¤´æˆï¼šallocate()å’Œdeallocate()</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230609160227418.png" alt="image-20230609160227418"></p><p><strong>allocate()å‡½æ•°ï¼šåœ¨åˆå§‹åŒ–Init()å‡½æ•°ä¹‹åè°ƒç”¨allocate()å‡½æ•°ï¼Œè¿™ä¸ªæ—¶å€™æ¯ä¸€ä¸ªblockçš„å¤§å°éƒ½æ˜¯blocksizeï¼ŒfirstAvaliableBlockä»£è¡¨äº†è¿™ä¸ªæ—¶å€™ç¬¬ä¸€å—ç©ºç™½çš„å†…å­˜ï¼Œå­˜æ”¾çš„æ˜¯ç´¢å¼•ï¼Œå°±æ˜¯ä»0å¼€å§‹æŒ‰é¡ºåºå»æ•°ï¼Œå¹¶ä¸”ä¼˜å…ˆåº¦æœ€é«˜ï¼Œå®ƒé‡Œé¢å­˜æ”¾çš„åŒºå—ç´¢å¼•æ˜¯ä¹‹å‰è®¾è®¡å¥½çš„ï¼Œå°±æ˜¯ç¬¬äºŒé«˜çš„ä¼˜å…ˆåº¦ï¼Œç¬¬ä¸€å—å†…å­˜åˆ†é…ç»™ç”¨æˆ·ä¹‹åï¼Œç¬¬äºŒå—å°±ä¸Šæ¥äº†ï¼Œå˜æˆäº†firstAvailableBlockçš„å†…å®¹ï¼Œç„¶åblocksAvailableå‡å‡</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230609161327736.png" alt="image-20230609161327736"></p><p><strong>deallocate()å‡½æ•°ï¼šç»™ä¸€ä¸ªæŒ‡é’ˆï¼Œå½“ç„¶éœ€è¦å…ˆåˆ¤æ–­è¿™è·ŸæŒ‡é’ˆä½äºå“ªä¸ªChunkç»“æ„å½“ä¸­ï¼Œè¿™å°±ä¸€ä¸ªä¸€ä¸ªå»æŸ¥è¯¢(æŸ¥è¯¢æŒ‡é’ˆçš„ä½ç½®)å°±å¥½äº†ï¼Œæ‰¾åˆ°ä¹‹åæŠŠè¿™ä¸€å—å†…å­˜freeæ‰ï¼Œåšallocate()å‡½æ•°çš„é€†æ“ä½œï¼ŒæŠŠç›®å‰çŠ¶æ€çš„firstAvailableçš„åŒºå—ç´¢å¼•å¡«å…¥è¯¥åŒºå—ï¼Œç„¶åè¯¥åŒºå—ç´¢å¼•å–ä»£ä»–æˆä¸ºfirstAvailableBlockï¼Œç„¶åblocksAvailableåŠ åŠ ï¼Œè¿™å°±ä¿è¯äº†æ“ä½œçš„ä¸¥è°¨å’Œè‡ªæ´½</strong></p><h4 id="fixedallocatorç±»"><a href="#fixedallocatorç±»" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#fixedallocatorç±»"></a> FixedAllocatorç±»</h4><p>FixedAllocatorç±»çš„ç»“æ„ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711103421403.png" alt="image-20230711103421403"></p><p>é™¤äº†å­˜æ”¾vector&lt; Chunk &gt;ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸¤æ ¹æŒ‡é’ˆï¼Œ<strong>ç”¨æ¥æ ‡è¯†æœ€è¿‘ä¸€æ¬¡allocçš„Chunkå’Œdeallocçš„Chunkï¼Œè¿™ä¹ˆåšçš„å«ä¹‰æ˜¯ï¼Œå¯ä»¥ä»è¿™ä¸ªæœ€è¿‘çš„åŒºå—å½“ä¸­çœ‹æ˜¯å¦å¯ä»¥ç»§ç»­åˆ†é…æˆ–è€…å›æ”¶æ¥æé«˜æ•ˆç‡</strong></p><p>Allocateä»£ç ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711103208976.png" alt="image-20230711103208976"></p><p><strong>å¦‚æœæ ‡è¯†allocChunkä¸º0(ä¾‹å¦‚æœ€å¼€å§‹çš„æ—¶å€™æ²¡æœ‰åˆ†é…å†…å­˜)æˆ–è€…allocChunkæŒ‡å‘çš„blockAvailableä¸º0ä»£è¡¨æ²¡æœ‰è¯¾ä½™ç©ºé—´ï¼Œé‚£ä¹ˆè¡¨æ˜allocChunkä¸å¯ç”¨ï¼Œéœ€è¦ä»å¤´é‡æ–°å¼€å§‹æŸ¥æ‰¾</strong></p><p><strong>åœ¨æŸ¥æ‰¾è¿‡ç¨‹ä¸­å¦‚æœå‘ç°å¯ç”¨çš„ï¼Œè®°ä¸‹åœ°å€ç„¶åå»åˆ†é…ï¼Œå¦‚æœæ²¡æœ‰å¯ç”¨çš„(éƒ½ç”¨å…‰äº†)ï¼Œè¿™æ—¶å€™åŠ ä¸€ä¸ªæ–°çš„chunkè¿›å»ç”¨äºæ–°çš„åˆ†é…!!!</strong></p><p><strong>æ³¨æ„åŠ äº†æ–°çš„chunkä¹‹åè®°å¾—æ›´æ”¹allocChunkå’ŒdeallocChunkçš„å€¼ï¼ŒallocChunkå°±è®¾ç½®ä¸ºæ”¹Chunkå°±å¯ä»¥ï¼Œå› ä¸ºè¿™æ˜¯æ–°ç”Ÿæˆçš„ï¼Œå¯ä»¥è¿›è¡Œåˆ†é…ï¼›deallocChunkè®¾ç½®ä¸ºå¤´éƒ¨</strong></p><p><strong>ä½†æ˜¯ä¸ºä»€ä¹ˆè¦é‡è®¾å‘¢ï¼Ÿå› ä¸ºvectoråœ¨push_backæ“ä½œä¸­å¯èƒ½å‡ºç°2å€æ‰©å¼ å¯¼è‡´moveçš„é—®é¢˜ï¼Œè¿™ä¸ªæ—¶å€™åŸæ¥çš„æŒ‡é’ˆå°±å¤±æ•ˆäº†ï¼Œæ˜¾ç„¶éœ€è¦é‡æ–°è®¾ç½®!!!</strong></p><p>deallocateä»£ç ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711110249938.png" alt="image-20230711110249938"></p><p>æ‹¿åˆ°ä¸€ä¸ªéœ€è¦é‡Šæ”¾çš„æŒ‡é’ˆï¼Œå…ˆæ‰¾åˆ°éœ€è¦é‡Šæ”¾çš„ChunkåŒºå—ï¼Œé€šè¿‡VicinityFind()å®ç°ï¼Œç„¶åé€šè¿‡DoDeallocate()è¿›è¡Œé‡Šæ”¾</p><p>VicinityFind()å‡½æ•°ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711111102518.png" alt="image-20230711111102518"></p><p>ä»–è¿™ç§å†™æ³•å…¶å®æ²¡æœ‰ç‰¹åˆ«çš„æ•°å­¦ä¾æ®ï¼Œå¤§è‡´æ€æƒ³å°±æ˜¯ä»ä¸Šä¸€ä¸ªdeallocChunkå¼€å§‹ï¼Œå°†å…¶åˆ†ä¸ºä¸Šä¸‹ä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸Šé¢æ‰¾ä¸€ä¸ªï¼Œä¸‹é¢æ‰¾ä¸€ä¸ªï¼Œç›´åˆ°æ‰¾åˆ°å¯¹åº”çš„åŒºå—ï¼Œç„¶åè¿›è¡Œä¿®æ”¹</p><p>ä½†æ˜¯å¦‚æœç»™çš„pä¸æ˜¯Chunkåˆ†é…æ‹¿å‡ºçš„æŒ‡é’ˆï¼Œé‚£ä¹ˆæ˜¾ç„¶æ˜¯æ‰¾ä¸åˆ°çš„ï¼Œæ‰€ä»¥ä¼šæ­»å¾ªç¯</p><p>DoDeallocate()å‡½æ•°ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711111833403.png" alt="image-20230711111833403"></p><p>è¿™é‡Œè¦æ³¨æ„å¦‚æœå›æ”¶ä¹‹åè¿™ä¸€å—Chunkå˜ä¸ºå…¨ç©ºï¼Œéœ€è¦æŠŠè¿™ä¸€å—è¿›è¡Œå›æ”¶å˜›ï¼Ÿè¿™å°±ä¸æ˜¯å†…å­˜åˆ†é…çš„é‡ç‚¹äº†</p><h2 id="ç¬¬äº”è®²other-issues"><a href="#ç¬¬äº”è®²other-issues" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¬¬äº”è®²other-issues"></a> ç¬¬äº”è®²ï¼šother issues</h2><h3 id="new_allocator"><a href="#new_allocator" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#new_allocator"></a> new_allocator</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711142511891.png" alt="image-20230711142511891"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711142536025.png" alt="image-20230711142536025"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711142846401.png" alt="image-20230711142846401"></p><p>è¿™å‡ ä¸ªç‰ˆæœ¬å®ç°ä¸åŒï¼Œä½†æ˜¯å…¶å®æœ¬è´¨ä¸Šæ²¡æœ‰è¿›è¡Œé¢å¤–çš„è®¾è®¡ï¼Œå°±æ˜¯å¯¹c runtime libiraryé‡Œé¢mallocå’Œfreeçš„è°ƒç”¨</p><h3 id="array_allocator"><a href="#array_allocator" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#array_allocator"></a> array_allocator</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711143546194.png" alt="image-20230711143546194"></p><p><strong>è¿™ä¸ªåˆ†é…å™¨çš„ç›®çš„æ˜¯åˆ†å‡ºä¸€å—é™æ€å†…å­˜array(C++æ•°ç»„)ï¼Œç„¶ååˆ†é…ç»™ç”¨æˆ·ï¼Œç”±äºæ˜¯é™æ€ï¼Œæ‰€ä»¥ä¸éœ€è¦è¿›è¡Œå›æ”¶ï¼Œå› æ­¤æŒ‰é“ç†æ¥è¯´ä¸éœ€è¦deallocate()ã€‚ä½†æ˜¯åˆ†é…å™¨éƒ½éœ€è¦æä¾›è¿™äº›ç»Ÿä¸€çš„æ¥å£ï¼Œæ‰€ä»¥ä»–do nothing.</strong></p><p><strong>æ³¨æ„ç¬¬äºŒä¸ªæ¨¡æ¿å‚æ•°ä¼ å…¥çš„å‚æ•°å¿…é¡»æ˜¯array&lt;&gt;!!!</strong></p><p>ä¾‹å­ï¼š</p><p>é™æ€æ•°ç»„å……å½“åˆ†é…å•å…ƒ</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711144447440.png" alt="image-20230711144447440"></p><p>åŠ¨æ€å¼€è¾Ÿçš„ç©ºé—´å……å½“åˆ†é…å•å…ƒ</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711144615462.png" alt="image-20230711144615462"></p><h3 id="debug_allocator"><a href="#debug_allocator" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#debug_allocator"></a> debug_allocator</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711145211456.png" alt="image-20230711145211456"></p><p><strong>ç”¨é€”ï¼šåŒ…è£¹å…¶å¦ä¸€ä¸ªåˆ†é…å™¨åˆ†é…çš„ç©ºé—´ï¼Œæ·»åŠ ä¸€ä¸ªextraçš„ç©ºé—´ç”¨æ¥è®°å½•åˆ†é…çš„å¤§å°(ç±»ä¼¼äºcookieï¼Œå› ä¸ºcookieå½“ä¸­ä¹Ÿè®°å½•ç€æ•´å—çš„å¤§å°)</strong></p><p><strong>ä½†æ˜¯æ„Ÿè§‰æ²¡ä»€ä¹ˆç”¨ï¼Œè¯•æƒ³ä¸€ä¸‹æˆ‘åˆšå¥½å»é™¤äº†cookieæ„é€ äº†ä¸€ä¸ªä¸é”™çš„å†…å­˜æ± ï¼Œç„¶åç”¨è¿™ä¸ªdebug_allocatoråˆæ·»åŠ äº†ä¸€ä¸ªç±»ä¼¼äºcookieçš„debug headerï¼Œè¿™ä¸æ˜¯å¾ˆé¸¡è‚‹å˜›</strong></p><h3 id="gc29ä½¿ç”¨çš„stdalloc-__pool_alloc"><a href="#gc29ä½¿ç”¨çš„stdalloc-__pool_alloc" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#gc29ä½¿ç”¨çš„stdalloc-__pool_alloc"></a> Gc2.9ä½¿ç”¨çš„std::alloc (__pool_alloc)</h3><p>å¤ªç†Ÿæ‚‰å•¦ï¼</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711145521073.png" alt="image-20230711145521073"></p><h3 id="bitmap_allocator"><a href="#bitmap_allocator" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#bitmap_allocator"></a> bitmap_allocator</h3><p><strong>è¯¥åˆ†é…å™¨å°±allocate()å’Œdeallocate()å‡½æ•°åšäº†ä¸¤ç§ï¼›</strong></p><p><strong>å°±å®¹å™¨éœ€è¦çš„å…ƒç´ ç§ç±»ä¸ªæ•°ä¸º1å’Œä»¥ä¸Šåšäº†åŒºåˆ†ï¼Œä½†æ˜¯å®é™…ä¸Šç»å¤§å¤šæ•°æƒ…å†µä¸‹å®¹å™¨å­˜æ”¾çš„ä¸œè¥¿éƒ½æ˜¯ä¸€ç§ç±»å‹ï¼Œä¸åŒçš„ç±»å‹å¾ˆå°‘</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711150915653.png" alt="image-20230711150915653"></p><p>ä¸‹é¢ä»–çš„è®¾è®¡ç”¨å›¾ç¤ºå®ç°</p><h4 id="allocateè¿‡ç¨‹"><a href="#allocateè¿‡ç¨‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#allocateè¿‡ç¨‹"></a> allocateè¿‡ç¨‹ï¼š</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711154726911.png" alt="image-20230711154726911"></p><p><strong>è¿˜æ˜¯ä»¥å†…å­˜æ± çš„å½¢å¼ï¼ŒæŒ–å‡ºä¸€å¤§å—å†…å­˜ç„¶åè¿›è¡Œåˆ†é…ã€‚åœ¨è¿™é‡Œè¿™ä¸ªå›¢é˜Ÿè®¾è®¡çš„æ˜¯ä¸€å¼€å§‹æŒ–å‡º64ä¸ªæŒ‡å®šç±»å‹çš„åŒºå—ï¼Œç„¶åå¡«ä¸Šbitmapï¼Œuse countå’Œä¸€ä¸ªå¤´éƒ¨è®°å½•super block sizeï¼Œå› æ­¤è¿™ä¸€æ•´å—å°±å«åšsuper blockã€‚</strong></p><p><strong>æ³¨æ„bitmapæ˜¯æ€ä¹ˆç¡®å®šå¤§å°çš„ï¼Œbitmapé‡Œé¢å­˜çš„æ˜¯16è¿›åˆ¶æ•°ï¼Œæ•°ç»„çš„å½¢å¼ï¼Œä¸€ä¸ªæ•°ç»„å€¼4ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥æ”¾å›¾ä¸­çš„4 * 16 = 64 ä¸ªblockçš„çŠ¶æ€ï¼Œ1ä»£è¡¨å·²å­˜æ”¾ï¼Œ0ä»£è¡¨æœªå­˜æ”¾</strong></p><p><strong>æ•´ä¸ªsuper blockå¤§å°çš„è®¡ç®—å¦‚ä¸Š</strong></p><p><strong>å¯¹äºæ•´ä¸ªbitmap_allocatorçš„æ§åˆ¶ï¼Œä½¿ç”¨çš„æ˜¯è‡ªå·±è®¾è®¡çš„ä¸€ä¸ªå»ºè®®__mini_vectorï¼Œå› ä¸ºæ ‡å‡†åº“çš„vectoråº•å±‚è¿˜æœ‰åˆ†é…å™¨ï¼Œç”¨ä»–çš„è¯å°±ç›¸å½“äºå¥—å¨ƒäº†ï¼Œè¿™é‡Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„ç‰ˆæœ¬ï¼Œé‡Œé¢åŒæ ·æœ‰ä¸‰æ ¹æŒ‡é’ˆï¼Œç„¶ååŒæ ·æ˜¯2å€æ‰©å……ï¼Œæœºåˆ¶æ˜¯ä¸€æ ·çš„</strong></p><p>å½“å¡«å……è¿›æ•°æ®ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711155355589.png" alt="image-20230711155355589"></p><p>è®°å¾—ä¿®æ”¹use countï¼›</p><p><strong>ä¿®æ”¹bitmapæ•°ç»„çš„å€¼ï¼Œè¿™é‡Œçš„é¡ºåºæ˜¯åç€æ¥çš„ï¼Œå·²åˆ†é…è®¾ä¸º0ï¼Œæœªåˆ†é…è®¾ä¸º1ï¼Œå›¾ä¸­çš„1110ä»£è¡¨ blockçš„å‰å››ä½ ç¬¬ä¸€ä½0 åˆ†é…å‡ºå»äº†ï¼Œæ‰€ä»¥å°±æ˜¯E</strong></p><p>å½“ç¬¬ä¸€ä¸ªsuper_blockç”¨å°½ï¼Œå¯åŠ¨ç¬¬äºŒä¸ªsuper_blockï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711155536393.png" alt="image-20230711155536393"></p><p>blockçš„ä¸ªæ•°ç”±64åŠ å€ï¼Œå˜ä¸º128ï¼›ç„¶åè®°å¾—ä¿®æ”¹__mini_vectorçš„å€¼ï¼Œè®°å¾—vectoræ˜¯ä¸¤å€æˆé•¿çš„</p><p>ç»§ç»­ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711155719096.png" alt="image-20230711155719096"></p><p>å½“éœ€è¦å¯åŠ¨ç¬¬ä¸‰ä¸ªsuper_blockçš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶å€™è¿›è¡Œ2å€æ‰©å¼ ï¼Œå°±å˜æˆäº†4ä¸ªåŒºå—</p><p>è¿™ä¸ªå›¢é˜Ÿè§„å®šï¼šå¦‚æœä¸å…¨å›æ”¶ï¼Œåˆ†é…è§„æ¨¡ä¸æ–­å¢å¤§ï¼›å¦‚æœå…¨å›æ”¶äº†ä¸‹ä¸€æ¬¡è§„æ¨¡å‡åŠ</p><p><strong>è¿™ä¸ªvectorçš„value_typeå¹¶æ²¡æœ‰é™åˆ¶ï¼Œå› ä¸ºä»–çš„æ¯ä¸€ä¸ªåŒºå—éƒ½æ˜¯åœ¨è‡ªå·±çš„value_typeä¹‹ä¸‹æ„æˆçš„ï¼Œæˆ‘çš„vectoråªèµ·äº†ä¸€ä¸ªç®¡ç†çš„ä½œç”¨!!!</strong></p><p><strong>ä»å›¾ä¸­ä¹Ÿå¯ä»¥çœ‹å‡ºæˆ‘ä»¬çš„vectoré‡Œé¢å­˜æ”¾çš„åªæ˜¯ä¸¤æ ¹æŒ‡é’ˆï¼ŒæŒ‡å‘å€¼çš„ç¬¬ä¸€ä¸ªblockå’Œæœ€åä¸€ä¸ªblock!!!</strong></p><h4 id="deallocateè¿‡ç¨‹"><a href="#deallocateè¿‡ç¨‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#deallocateè¿‡ç¨‹"></a> deallocateè¿‡ç¨‹ï¼š</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711161106242.png" alt="image-20230711161106242"></p><p><strong>å¦‚æœæŠŠç¬¬ä¸€ä¸ªsuper blockå…¨å›æ”¶äº†ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªsuper blockä¼šè¢«æ”¾å…¥ä¸€ä¸ªfree_listå½“ä¸­(æœ€å¤š64ä¸ªï¼Œå¤šäº†ä¼šè¢«å½’è¿˜ç»™æ“ä½œç³»ç»Ÿ)ç”¨ä½œä¸‹ä¸€ä¸ªåˆ†é…çš„å¤‡ç”¨ç©ºé—´ï¼Œç„¶ååœ¨__mini_vectorå½“ä¸­ï¼Œä¼šæŠŠç¬¬ä¸€ä¸ªå…ƒç´ ç»™åˆ é™¤æ‰ï¼Œåšç±»ä¼¼äºerase()çš„æ“ä½œï¼Œåªä¸è¿‡erase()å‡½æ•°éœ€è¦å‡å°‘sizeçš„ï¼Œä½†æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰å‡å°‘ï¼Œåªæ˜¯çœ‹èµ·æ¥æ˜¯å°†å…ƒç´ å‘å‰æ¨äº†ï¼Œå¤šå‡ºçš„ç©ºé—´å°±æ˜¯ç©ºç™½</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711161901208.png" alt="image-20230711161901208"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230711162120179.png" alt="image-20230711162120179"></p><p>æ•´ä¸ªè¿‡ç¨‹å¤§è‡´å°±æ˜¯è¿™æ ·</p><h3 id="è°ˆè°ˆconst"><a href="#è°ˆè°ˆconst" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è°ˆè°ˆconst"></a> è°ˆè°ˆconst</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/30/image-20230712145001503.png" alt="image-20230712145001503"></p><p><strong>å½“æˆå‘˜å‡½æ•°çš„constå’Œnon-constç‰ˆæœ¬åŒæ—¶å­˜åœ¨ï¼Œconstå¯¹è±¡åªèƒ½è°ƒç”¨constç‰ˆæœ¬ï¼Œnon-constå¯¹è±¡åªèƒ½è°ƒç”¨non-constç‰ˆæœ¬</strong></p><p><strong>å› æ­¤ï¼Œconstä¹Ÿæ˜¯åŒºåˆ†å‡½æ•°æ˜¯å¦ç›¸åŒçš„æ ‡å¿—ï¼ŒåŒä¸€ä¸ªå‡½æ•°åŠ ä¸Šconstå’Œä¸åŠ å°±ç›¸å½“äºæ˜¯ä¸€ä¸ªé‡è½½çš„ç‰ˆæœ¬äº†</strong></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Fuck</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">fuck</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;const version&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">fuck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;non-const version&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">const</span> Fuck f1;</span><br><span class="line">    f<span class="number">1.f</span>uck();<span class="comment">// const version</span></span><br><span class="line"></span><br><span class="line">    Fuck f2;</span><br><span class="line">    f<span class="number">2.f</span>uck();<span class="comment">// non-const version</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">test</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure></div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ æœ¬æ–‡ç»“æŸï¼Œæ„Ÿè°¢æ‚¨çš„é˜…è¯» ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">æœ¬æ–‡ä½œè€…: </span><span class="copyright-author__value"><a href="https://blog.davidingplus.cn">DavidingPlus</a></span></div><div class="copyright-link"><span class="copyright-link__name">æœ¬æ–‡é“¾æ¥: </span><span class="copyright-link__value"><a href="https://blog.davidingplus.cn/posts/2abc6e08.html">https://blog.davidingplus.cn/posts/2abc6e08.html</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">ç‰ˆæƒå£°æ˜: </span><span class="copyright-notice__value">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</span></div></div><div class="post-reward reward"><div class="reward-button">å¤§çˆ·ï¼Œèµä¸ªé“œæ¿å‘—~~~</div><div class="reward-qrcode"><span class="reward-qrcode-alipay"><img class="reward-qrcode-alipay__img" src="/images/reward/alipay.webp"><div class="reward-qrcode-alipay__text">æ”¯ä»˜å®</div></span><span class="reward-qrcode-wechat"><img class="reward-qrcode-wechat__img" src="/images/reward/wechat-pay.webp"><div class="reward-qrcode-wechat__text">å¾®ä¿¡</div></span></div></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/posts/ff333d31.html"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">ç‰›å®¢ Linux</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/posts/fe75e45c.html"><span class="paginator-prev__text">è®¡ç®—æœºç½‘ç»œ æœŸæœ«å¤ä¹ </span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div><div class="comments" id="comments"><div id="utterances-container"></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">æ–‡ç« ç›®å½•</span><span class="sidebar-nav-ov">ç«™ç‚¹æ¦‚è§ˆ</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E7%BA%A7%E5%BC%80%E5%8F%91"><span class="toc-number">1.</span> <span class="toc-text">é¢å‘å¯¹è±¡é«˜çº§å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#header%E5%A4%B4%E6%96%87%E4%BB%B6%E7%9A%84%E9%98%B2%E5%8D%AB%E5%BC%8F%E5%A3%B0%E6%98%8E"><span class="toc-number">1.1.</span> <span class="toc-text">Headerå¤´æ–‡ä»¶çš„é˜²å«å¼å£°æ˜</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#inline-%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.</span> <span class="toc-text">inline å‡½æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E5%9C%A8private%E9%83%A8%E5%88%86"><span class="toc-number">1.3.</span> <span class="toc-text">å•ä¾‹è®¾è®¡æ¨¡å¼(æ„é€ å‡½æ•°åœ¨privateéƒ¨åˆ†)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#const-%E5%B8%B8%E9%87%8F%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0"><span class="toc-number">1.4.</span> <span class="toc-text">const å¸¸é‡æˆå‘˜å‡½æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E7%94%A8%E6%8C%87%E9%92%88%E5%B8%B8%E9%87%8F-%E6%8C%87%E9%92%88%E6%8C%87%E5%90%91%E4%B8%8D%E5%8F%AF%E4%BF%AE%E6%94%B9"><span class="toc-number">1.5.</span> <span class="toc-text">å¼•ç”¨(æŒ‡é’ˆå¸¸é‡ æŒ‡é’ˆæŒ‡å‘ä¸å¯ä¿®æ”¹)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#friend-%E5%8F%8B%E5%85%83"><span class="toc-number">1.6.</span> <span class="toc-text">friend å‹å…ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E7%82%B9"><span class="toc-number">1.6.1.</span> <span class="toc-text">é‡ç‚¹ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#return-by"><span class="toc-number">1.7.</span> <span class="toc-text">return by *</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#return-by-reference"><span class="toc-number">1.7.1.</span> <span class="toc-text">return by reference</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#return-by-value"><span class="toc-number">1.7.2.</span> <span class="toc-text">return by value:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#class-with-pointer-members-%E5%B8%A6%E6%9C%89%E6%8C%87%E9%92%88%E7%9A%84%E7%B1%BB"><span class="toc-number">1.8.</span> <span class="toc-text">class with pointer members å¸¦æœ‰æŒ‡é’ˆçš„ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%B7%E8%B4%9D%E8%B5%8B%E5%80%BC%E6%A3%80%E6%B5%8B%E8%87%AA%E6%88%91%E8%B5%8B%E5%80%BC"><span class="toc-number">1.8.1.</span> <span class="toc-text">æ‹·è´èµ‹å€¼:æ£€æµ‹è‡ªæˆ‘èµ‹å€¼</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E5%AF%B9%E8%B1%A1%E7%9A%84%E7%94%9F%E5%91%BD%E6%9C%9F"><span class="toc-number">1.9.</span> <span class="toc-text">ä¸€äº›å¯¹è±¡çš„ç”Ÿå‘½æœŸ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#new%E5%92%8Cdelete"><span class="toc-number">1.10.</span> <span class="toc-text">newå’Œdelete</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#new-%E5%85%88%E5%88%86%E9%85%8D%E5%86%85%E5%AD%98%E7%A9%BA%E9%97%B4%E5%86%8D%E8%B0%83%E7%94%A8%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-number">1.10.1.</span> <span class="toc-text">new: å…ˆåˆ†é…å†…å­˜ç©ºé—´ï¼Œå†è°ƒç”¨æ„é€ å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#delete-%E5%85%88%E8%B0%83%E7%94%A8%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0%E5%86%8D%E9%87%8A%E6%94%BE%E5%86%85%E5%AD%98%E7%A9%BA%E9%97%B4"><span class="toc-number">1.10.2.</span> <span class="toc-text">delete: å…ˆè°ƒç”¨ææ„å‡½æ•°ï¼Œå†é‡Šæ”¾å†…å­˜ç©ºé—´</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#array-new-%E4%B8%80%E5%AE%9A%E8%A6%81%E6%90%AD%E9%85%8D-array-delete"><span class="toc-number">1.10.3.</span> <span class="toc-text">array new ä¸€å®šè¦æ­é… array delete!!!</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#static-%E9%9D%99%E6%80%81"><span class="toc-number">1.11.</span> <span class="toc-text">static é™æ€</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E4%B8%80%E6%AD%A5%E8%A1%A5%E5%85%85%E6%8A%8A%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E6%94%BE%E5%9C%A8-private-%E9%87%8C%E9%9D%A2%E5%8D%95%E4%BE%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.11.1.</span> <span class="toc-text">è¿›ä¸€æ­¥è¡¥å……ï¼šæŠŠæ„é€ å‡½æ•°æ”¾åœ¨ private é‡Œé¢ï¼Œå•ä¾‹è®¾è®¡æ¨¡å¼</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF"><span class="toc-number">1.12.</span> <span class="toc-text">æ¨¡æ¿</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E6%A8%A1%E6%9D%BF"><span class="toc-number">1.12.1.</span> <span class="toc-text">ç±»æ¨¡æ¿:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E6%A8%A1%E6%9D%BF"><span class="toc-number">1.12.2.</span> <span class="toc-text">å‡½æ•°æ¨¡æ¿:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4-namespace"><span class="toc-number">1.13.</span> <span class="toc-text">å‘½åç©ºé—´ namespace</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%8D%E5%90%88-composition"><span class="toc-number">1.14.</span> <span class="toc-text">å¤åˆ composition</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E5%90%88%E4%B8%8B%E7%9A%84%E6%9E%84%E9%80%A0%E5%92%8C%E6%9E%90%E6%9E%84"><span class="toc-number">1.14.1.</span> <span class="toc-text">å¤åˆä¸‹çš„æ„é€ å’Œææ„</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A7%94%E6%89%98-delefgation-composition-by-reference"><span class="toc-number">1.15.</span> <span class="toc-text">å§”æ‰˜ Delefgation â€“ Composition by reference</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#handlebody-pimpl"><span class="toc-number">1.15.1.</span> <span class="toc-text">Handle&#x2F;Body (pimpl)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF-inheritance"><span class="toc-number">1.16.</span> <span class="toc-text">ç»§æ‰¿ inheritance</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%99%9A%E5%87%BD%E6%95%B0"><span class="toc-number">1.16.1.</span> <span class="toc-text">è™šå‡½æ•°:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BD%AC%E6%8D%A2%E5%87%BD%E6%95%B0-conversion-function"><span class="toc-number">1.17.</span> <span class="toc-text">è½¬æ¢å‡½æ•° conversion function</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%AF%B9%E8%B1%A1%E4%BB%BF%E5%87%BD%E6%95%B0-%E8%B0%93%E8%AF%8D"><span class="toc-number">1.18.</span> <span class="toc-text">å‡½æ•°å¯¹è±¡(ä»¿å‡½æ•°) -&gt; è°“è¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E8%A1%A5%E5%85%85-%E6%88%90%E5%91%98%E6%A8%A1%E6%9D%BF-member-template"><span class="toc-number">1.19.</span> <span class="toc-text">æ¨¡æ¿è¡¥å……: æˆå‘˜æ¨¡æ¿ member template</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="toc-number">1.20.</span> <span class="toc-text">å‘½åç©ºé—´</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#explicit"><span class="toc-number">1.21.</span> <span class="toc-text">explicit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pointer-like-classes-%E5%85%B3%E4%BA%8E%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88%E5%92%8C%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-number">1.22.</span> <span class="toc-text">pointer-like classes å…³äºæ™ºèƒ½æŒ‡é’ˆå’Œè¿­ä»£å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88-%E7%94%A8%E4%B8%80%E4%B8%AA%E7%B1%BB%E6%9D%A5%E6%A8%A1%E6%8B%9F%E4%B8%80%E8%88%AC%E6%8C%87%E9%92%88%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">1.22.1.</span> <span class="toc-text">æ™ºèƒ½æŒ‡é’ˆ: ç”¨ä¸€ä¸ªç±»æ¥æ¨¡æ‹Ÿä¸€èˆ¬æŒ‡é’ˆçš„ä½œç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8-iterator-%E5%85%B6%E6%9C%AC%E8%B4%A8%E4%B9%9F%E6%98%AF%E4%B8%80%E7%A7%8D%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88"><span class="toc-number">1.22.2.</span> <span class="toc-text">è¿­ä»£å™¨: iterator å…¶æœ¬è´¨ä¹Ÿæ˜¯ä¸€ç§æ™ºèƒ½æŒ‡é’ˆ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#specialization-%E6%A8%A1%E6%9D%BF%E7%89%B9%E5%8C%96"><span class="toc-number">1.23.</span> <span class="toc-text">specialization æ¨¡æ¿ç‰¹åŒ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#partial-specialization-%E6%A8%A1%E6%9D%BF%E5%81%8F%E7%89%B9%E5%8C%96"><span class="toc-number">1.24.</span> <span class="toc-text">partial specialization æ¨¡æ¿åç‰¹åŒ–</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#c%E6%A0%87%E5%87%86%E5%BA%93-%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E4%B8%8E%E5%86%85%E5%AD%98%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">C++æ ‡å‡†åº“ ä½“ç³»ç»“æ„ä¸å†…å­˜åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E8%AE%B2stl%E6%A0%87%E5%87%86%E5%BA%93%E5%92%8C%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B"><span class="toc-number">2.1.</span> <span class="toc-text">ç¬¬ä¸€è®²ï¼šSTLæ ‡å‡†åº“å’Œæ³›å‹ç¼–ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#stl-%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-number">2.1.1.</span> <span class="toc-text">STL ä½“ç³»ç»“æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E8%8C%83%E5%9B%B4%E7%9A%84-for-%E8%AF%AD%E5%8F%A5"><span class="toc-number">2.1.2.</span> <span class="toc-text">åŸºäºèŒƒå›´çš„ for è¯­å¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%88%86%E7%B1%BB"><span class="toc-number">2.1.3.</span> <span class="toc-text">å®¹å™¨çš„ç»“æ„å’Œåˆ†ç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hashtable-separate-chaining"><span class="toc-number">2.1.4.</span> <span class="toc-text">HashTable Separate Chaining</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sequence-containers-%E5%BA%8F%E5%88%97%E5%AE%B9%E5%99%A8"><span class="toc-number">2.1.5.</span> <span class="toc-text">Sequence Containers åºåˆ—å®¹å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#arrayc11"><span class="toc-number">2.1.5.1.</span> <span class="toc-text">array(c++11)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vector"><span class="toc-number">2.1.5.2.</span> <span class="toc-text">vector</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#list"><span class="toc-number">2.1.5.3.</span> <span class="toc-text">list</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#forward_listc11"><span class="toc-number">2.1.5.4.</span> <span class="toc-text">forward_list(c++11)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#slist"><span class="toc-number">2.1.5.5.</span> <span class="toc-text">slist</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#deque"><span class="toc-number">2.1.5.6.</span> <span class="toc-text">deque</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#stack"><span class="toc-number">2.1.5.7.</span> <span class="toc-text">stack</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#queue"><span class="toc-number">2.1.5.8.</span> <span class="toc-text">queue</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#associate-containers-%E5%85%B3%E8%81%94%E5%BC%8F%E5%AE%B9%E5%99%A8"><span class="toc-number">2.1.6.</span> <span class="toc-text">Associate Containers å…³è”å¼å®¹å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BA%A2%E9%BB%91%E6%A0%91"><span class="toc-number">2.1.6.1.</span> <span class="toc-text">çº¢é»‘æ ‘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#multiset-%E5%92%8C-set"><span class="toc-number">2.1.6.2.</span> <span class="toc-text">Multiset å’Œ set</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#multimap-%E5%92%8C-map"><span class="toc-number">2.1.6.3.</span> <span class="toc-text">Multimap å’Œ map</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E8%A1%A8%E5%85%B6%E5%AE%9E%E5%8E%9F%E6%9C%AC%E5%90%8D%E5%AD%97%E5%89%8D%E7%BC%80%E6%98%AFhash%E7%8E%B0%E5%9C%A8%E6%94%B9%E5%90%8D%E5%8F%ABunordered"><span class="toc-number">2.1.6.4.</span> <span class="toc-text">å“ˆå¸Œè¡¨(å…¶å®åŸæœ¬åå­—å‰ç¼€æ˜¯hash,ç°åœ¨æ”¹åå«unordered)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#unordered_multiset-%E5%92%8C-unorder_set"><span class="toc-number">2.1.6.5.</span> <span class="toc-text">unordered_multiset å’Œ unorder_set</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#unordered_multimap-%E5%92%8C-unordered_map"><span class="toc-number">2.1.6.6.</span> <span class="toc-text">unordered_multimap å’Œ unordered_map</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%88%86%E9%85%8D%E5%99%A8-allocator"><span class="toc-number">2.1.7.</span> <span class="toc-text">ä½¿ç”¨åˆ†é…å™¨ allocator</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E8%AE%B2%E5%88%86%E9%85%8D%E5%99%A8-%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-number">2.2.</span> <span class="toc-text">ç¬¬äºŒè®²ï¼šåˆ†é…å™¨ è¿­ä»£å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#oop%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B%E5%92%8Cgp%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B"><span class="toc-number">2.2.1.</span> <span class="toc-text">OOP(é¢å‘å¯¹è±¡ç¼–ç¨‹)å’ŒGP(æ³›å‹ç¼–ç¨‹)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%8F%E6%9C%BA%E8%AE%BF%E9%97%AE%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-number">2.2.2.</span> <span class="toc-text">éšæœºè®¿é—®è¿­ä»£å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gp-%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B%E4%B8%BE%E4%B8%80%E4%B8%AA%E4%BE%8B%E5%AD%90"><span class="toc-number">2.2.3.</span> <span class="toc-text">GP æ³›å‹ç¼–ç¨‹ä¸¾ä¸€ä¸ªä¾‹å­</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E8%BD%BDnew%E8%BF%90%E7%AE%97%E7%AC%A6-operator-new"><span class="toc-number">2.2.4.</span> <span class="toc-text">é‡è½½newè¿ç®—ç¬¦ operator new</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%85%8D%E5%99%A8-allocators"><span class="toc-number">2.2.5.</span> <span class="toc-text">åˆ†é…å™¨ allocators</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#vc6-allocator"><span class="toc-number">2.2.5.1.</span> <span class="toc-text">VC6 allocator</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bc-allocator"><span class="toc-number">2.2.5.2.</span> <span class="toc-text">BC++ allocator</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gcc29-allocator"><span class="toc-number">2.2.5.3.</span> <span class="toc-text">GCC2.9 allocator</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gcc29-%E8%87%AA%E5%B7%B1%E4%BD%BF%E7%94%A8%E7%9A%84%E5%88%86%E9%85%8D%E5%99%A8alloc%E4%B8%8D%E6%98%AFallocator"><span class="toc-number">2.2.5.4.</span> <span class="toc-text">GCC2.9 è‡ªå·±ä½¿ç”¨çš„åˆ†é…å™¨ï¼šalloc(ä¸æ˜¯allocator!!!)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gcc49-%E4%BD%BF%E7%94%A8%E7%9A%84%E5%88%86%E9%85%8D%E5%99%A8allocator%E4%B8%8D%E6%98%AFalloc"><span class="toc-number">2.2.5.5.</span> <span class="toc-text">GCC4.9 ä½¿ç”¨çš„åˆ†é…å™¨ï¼šallocator(ä¸æ˜¯alloc!!!)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">2.2.6.</span> <span class="toc-text">å®¹å™¨ä¹‹é—´çš„å…³ç³»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%BA%E5%88%ABsize%E5%92%8Csizeof"><span class="toc-number">2.2.7.</span> <span class="toc-text">åŒºåˆ«size()å’Œsizeof()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%B4%A2-list"><span class="toc-number">2.2.8.</span> <span class="toc-text">æ·±å…¥æ¢ç´¢ list</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#list%E7%9A%84%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-number">2.2.8.1.</span> <span class="toc-text">listçš„è¿­ä»£å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E4%B8%BA%E4%BB%80%E4%B9%88%E5%90%8E%E7%BD%AE%E4%B8%8D%E8%83%BD%E8%BF%94%E5%9B%9E%E5%BC%95%E7%94%A8%E6%AF%94%E8%BE%83%E6%9C%89%E8%AF%B4%E6%9C%8D%E5%8A%9B%E7%9A%84%E8%BF%98%E6%9C%89%E5%A6%82%E4%B8%8B%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-number">2.2.8.2.</span> <span class="toc-text">å…³äºä¸ºä»€ä¹ˆåç½®++ä¸èƒ½è¿”å›å¼•ç”¨ï¼Œæ¯”è¾ƒæœ‰è¯´æœåŠ›çš„è¿˜æœ‰å¦‚ä¸‹çš„åŸå› ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E-%E5%92%8C-%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E9%87%8D%E8%BD%BD"><span class="toc-number">2.2.8.3.</span> <span class="toc-text">å…³äº * å’Œ &amp; è¿ç®—ç¬¦çš„é‡è½½</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#g49-%E5%92%8C-g29%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">2.2.8.4.</span> <span class="toc-text">G4.9 å’Œ G2.9çš„åŒºåˆ«</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-number">2.2.9.</span> <span class="toc-text">è¿­ä»£å™¨çš„è®¾è®¡åŸåˆ™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#traits-%E8%90%83%E5%8F%96%E6%9C%BA"><span class="toc-number">2.2.10.</span> <span class="toc-text">Traits èƒå–æœº</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E8%AE%B2%E5%AE%B9%E5%99%A8"><span class="toc-number">2.3.</span> <span class="toc-text">ç¬¬ä¸‰è®²ï¼šå®¹å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%B4%A2vector"><span class="toc-number">2.3.1.</span> <span class="toc-text">æ·±å…¥æ¢ç´¢vector</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#gcc29%E7%9A%84%E8%AE%BE%E8%AE%A1"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">GCC2.9çš„è®¾è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gcc49%E7%9A%84%E8%AE%BE%E8%AE%A1"><span class="toc-number">2.3.1.2.</span> <span class="toc-text">GCC4.9çš„è®¾è®¡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%B4%A2-deque-%E5%92%8C-queue-stack"><span class="toc-number">2.3.2.</span> <span class="toc-text">æ·±å…¥æ¢ç´¢ deque å’Œ queue , stack</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#deque-2"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">deque</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#queue-2"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">queue</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%B7%B1%E6%89%8B%E5%86%99%E4%BA%86%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E4%BA%8C%E5%8F%89%E6%A0%91%E5%88%9B%E5%BB%BA%E4%BA%8C%E5%8F%89%E6%A0%91%E5%87%BD%E6%95%B0%E4%B8%8D%E4%BC%9A"><span class="toc-number">2.3.3.</span> <span class="toc-text">è‡ªå·±æ‰‹å†™äº†ä¸€ä¸ªç®€å•çš„äºŒå‰æ ‘(åˆ›å»ºäºŒå‰æ ‘å‡½æ•°ä¸ä¼š)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rb_tree-%E7%BA%A2%E9%BB%91%E6%A0%91"><span class="toc-number">2.3.4.</span> <span class="toc-text">rb_Tree çº¢é»‘æ ‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BA%A2%E9%BB%91%E6%A0%91-rb_tree-%E4%B8%8E%E4%BA%8C%E5%8F%89%E5%B9%B3%E8%A1%A1%E6%A0%91-avl-%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-number">2.3.4.1.</span> <span class="toc-text">çº¢é»‘æ ‘ rb_Tree ä¸äºŒå‰å¹³è¡¡æ ‘ AVL çš„å¯¹æ¯”ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%87%E5%87%86%E5%BA%93%E5%AF%B9%E7%BA%A2%E9%BB%91%E6%A0%91%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.3.4.2.</span> <span class="toc-text">æ ‡å‡†åº“å¯¹çº¢é»‘æ ‘çš„å®ç°:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E7%BA%A2%E9%BB%91%E6%A0%91%E7%9A%84set%E5%92%8Cmap"><span class="toc-number">2.3.5.</span> <span class="toc-text">åŸºäºçº¢é»‘æ ‘çš„setå’Œmap</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#setmultiset"><span class="toc-number">2.3.5.1.</span> <span class="toc-text">set&#x2F;multiset</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mapmultimap"><span class="toc-number">2.3.5.2.</span> <span class="toc-text">map&#x2F;multimap</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#map%E7%8B%AC%E7%89%B9%E7%9A%84-operator"><span class="toc-number">2.3.6.</span> <span class="toc-text">mapç‹¬ç‰¹çš„ operator [ ]!!!</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hashtable-%E6%95%A3%E5%88%97%E8%A1%A8"><span class="toc-number">2.3.7.</span> <span class="toc-text">hashtable æ•£åˆ—è¡¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E8%AE%B2%E7%AE%97%E6%B3%95"><span class="toc-number">2.4.</span> <span class="toc-text">ç¬¬å››è®²ï¼šç®—æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%97%E6%B3%95%E6%A6%82%E8%BF%B0"><span class="toc-number">2.4.1.</span> <span class="toc-text">ç®—æ³•æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8%E7%9A%84%E4%BA%94%E7%A7%8D%E5%88%86%E7%B1%BB%E6%B3%A8%E6%84%8F%E8%BF%99%E4%BA%94%E7%A7%8D%E9%83%BD%E6%98%AF%E7%B1%BB"><span class="toc-number">2.4.2.</span> <span class="toc-text">è¿­ä»£å™¨çš„äº”ç§åˆ†ç±»ï¼šæ³¨æ„è¿™äº”ç§éƒ½æ˜¯ç±»!!!</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#iterator_category%E5%AF%B9%E7%AE%97%E6%B3%95%E7%9A%84%E6%95%88%E7%8E%87%E5%BD%B1%E5%93%8D"><span class="toc-number">2.4.3.</span> <span class="toc-text">iterator_categoryå¯¹ç®—æ³•çš„æ•ˆç‡å½±å“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%97%E6%B3%95%E6%BA%90%E4%BB%A3%E7%A0%81%E5%89%96%E6%9E%90"><span class="toc-number">2.4.4.</span> <span class="toc-text">ç®—æ³•æºä»£ç å‰–æ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#accumulate"><span class="toc-number">2.4.4.1.</span> <span class="toc-text">accumulate</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#for_each"><span class="toc-number">2.4.4.2.</span> <span class="toc-text">for_each</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#replacereplace_ifreplace_copyreplace_copy_if"><span class="toc-number">2.4.4.3.</span> <span class="toc-text">replace,replace_if,replace_copy,replace_copy_if</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#countcount_if"><span class="toc-number">2.4.4.4.</span> <span class="toc-text">count,count_if</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#findfind_if"><span class="toc-number">2.4.4.5.</span> <span class="toc-text">find,find_if</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sort"><span class="toc-number">2.4.4.6.</span> <span class="toc-text">sort</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#binary_search%E9%80%9A%E8%BF%87%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE%E7%A1%AE%E5%AE%9A%E5%85%83%E7%B4%A0%E5%9C%A8%E4%B8%8D%E5%9C%A8%E5%AE%B9%E5%99%A8%E5%BD%93%E4%B8%AD"><span class="toc-number">2.4.4.7.</span> <span class="toc-text">binary_search(é€šè¿‡äºŒåˆ†æŸ¥æ‰¾ç¡®å®šå…ƒç´ åœ¨ä¸åœ¨å®¹å™¨å½“ä¸­)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E8%AE%B2%E4%BB%BF%E5%87%BD%E6%95%B0-%E9%80%82%E9%85%8D%E5%99%A8"><span class="toc-number">2.5.</span> <span class="toc-text">ç¬¬äº”è®²ï¼šä»¿å‡½æ•° é€‚é…å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BF%E5%87%BD%E6%95%B0-functors%E6%B3%A8%E6%84%8F%E8%A6%81%E7%BB%A7%E6%89%BF"><span class="toc-number">2.5.1.</span> <span class="toc-text">ä»¿å‡½æ•° functors(æ³¨æ„è¦ç»§æ‰¿)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%82%E9%85%8D%E5%99%A8-adapter"><span class="toc-number">2.5.2.</span> <span class="toc-text">é€‚é…å™¨ Adapter</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E9%80%82%E9%85%8D%E5%99%A8stackqueue"><span class="toc-number">2.5.2.1.</span> <span class="toc-text">å®¹å™¨é€‚é…å™¨ï¼šstack,queue</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E9%80%82%E9%85%8D%E5%99%A8binder2nd"><span class="toc-number">2.5.2.2.</span> <span class="toc-text">å‡½æ•°é€‚é…å™¨ï¼šbinder2nd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E9%80%82%E9%85%8D%E5%99%A8not1"><span class="toc-number">2.5.2.3.</span> <span class="toc-text">å‡½æ•°é€‚é…å™¨ï¼šnot1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%9E%8B%E9%80%82%E9%85%8D%E5%99%A8bindsince-c11"><span class="toc-number">2.5.2.4.</span> <span class="toc-text">æ–°å‹é€‚é…å™¨ï¼šbind(since c++11)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8%E9%80%82%E9%85%8D%E5%99%A8rbeginrend"><span class="toc-number">2.5.2.5.</span> <span class="toc-text">è¿­ä»£å™¨é€‚é…å™¨ï¼šrbeginï¼Œrend</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8%E9%80%82%E9%85%8D%E5%99%A8inserter%E6%B2%A1%E5%BC%84%E6%87%82"><span class="toc-number">2.5.2.6.</span> <span class="toc-text">è¿­ä»£å™¨é€‚é…å™¨ï¼šinserter(æ²¡å¼„æ‡‚)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E8%AE%B2stl%E5%91%A8%E5%9B%B4%E7%9A%84%E7%BB%86%E7%A2%8E%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-number">2.6.</span> <span class="toc-text">ç¬¬å…­è®²ï¼šSTLå‘¨å›´çš„ç»†ç¢çŸ¥è¯†ç‚¹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E4%B8%87%E7%94%A8%E7%9A%84-hash-function"><span class="toc-number">2.6.1.</span> <span class="toc-text">ä¸€ä¸ªä¸‡ç”¨çš„ hash function</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#hash_val%E5%8F%82%E6%95%B0%E5%8C%85"><span class="toc-number">2.6.1.1.</span> <span class="toc-text">hash_val(å‚æ•°åŒ…)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hash%E5%87%BD%E6%95%B0%E7%9A%84%E4%B8%89%E7%A7%8D%E5%BD%A2%E5%BC%8F"><span class="toc-number">2.6.1.2.</span> <span class="toc-text">Hashå‡½æ•°çš„ä¸‰ç§å½¢å¼</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tuple"><span class="toc-number">2.6.2.</span> <span class="toc-text">tuple</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#c-20-%E6%96%B0%E7%89%B9%E6%80%A7"><span class="toc-number">3.</span> <span class="toc-text">C++ 2.0 æ–°ç‰¹æ€§</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E8%AE%B2%E8%AF%AD%E8%A8%80"><span class="toc-number">3.1.</span> <span class="toc-text">ç¬¬ä¸€è®²ï¼šè¯­è¨€</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#variatic-templates-%E5%8F%82%E6%95%B0%E5%8C%85"><span class="toc-number">3.1.1.</span> <span class="toc-text">variatic templates å‚æ•°åŒ…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%B6%E7%A2%8E%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-number">3.1.2.</span> <span class="toc-text">é›¶ç¢çŸ¥è¯†ç‚¹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#nullptr"><span class="toc-number">3.1.2.1.</span> <span class="toc-text">nullptr</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#auto"><span class="toc-number">3.1.2.2.</span> <span class="toc-text">auto</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#initializer_list"><span class="toc-number">3.1.3.</span> <span class="toc-text">initializer_list&lt;&gt;</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#uniform-initialization-%E7%BB%9F%E4%B8%80%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">3.1.3.1.</span> <span class="toc-text">uniform initialization ç»Ÿä¸€åˆå§‹åŒ–</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#explicit-2"><span class="toc-number">3.1.4.</span> <span class="toc-text">explicit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#deletedefault"><span class="toc-number">3.1.5.</span> <span class="toc-text">&#x3D;delete,&#x3D;default</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#no-copy-and-private-copy"><span class="toc-number">3.1.5.1.</span> <span class="toc-text">No-Copy and Private-Copy</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#alias%E5%8C%96%E5%90%8D-template-template-typedef-%E6%A8%A1%E6%9D%BF%E7%9A%84%E5%8C%96%E5%90%8D"><span class="toc-number">3.1.6.</span> <span class="toc-text">Alias(åŒ–å) Template (template typedef) æ¨¡æ¿çš„åŒ–å</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#test_moveable%E5%87%BD%E6%95%B0%E6%B5%8B%E8%AF%95"><span class="toc-number">3.1.6.1.</span> <span class="toc-text">test_moveableå‡½æ•°æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#template-template-parameter-%E5%8F%8C%E9%87%8D%E6%A8%A1%E6%9D%BF%E5%8F%82%E6%95%B0"><span class="toc-number">3.1.7.</span> <span class="toc-text">template template parameter åŒé‡æ¨¡æ¿å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#type-alias-%E7%B1%BB%E5%9E%8B%E5%8C%96%E5%90%8D"><span class="toc-number">3.1.8.</span> <span class="toc-text">type alias ç±»å‹åŒ–å</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#noexcept-%E4%BF%9D%E8%AF%81%E4%B8%8D%E4%BC%9A%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8"><span class="toc-number">3.1.9.</span> <span class="toc-text">noexcept ä¿è¯ä¸ä¼šæŠ›å‡ºå¼‚å¸¸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#override-%E8%A6%86%E5%86%99-%E7%89%B9%E7%94%A8%E4%BA%8E%E8%99%9A%E5%87%BD%E6%95%B0%E9%87%8D%E5%86%99%E4%B8%8A%E9%9D%A2"><span class="toc-number">3.1.10.</span> <span class="toc-text">override è¦†å†™ ç‰¹ç”¨äºè™šå‡½æ•°é‡å†™ä¸Šé¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#final"><span class="toc-number">3.1.11.</span> <span class="toc-text">final</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#decltype"><span class="toc-number">3.1.12.</span> <span class="toc-text">decltype</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lambdas"><span class="toc-number">3.1.13.</span> <span class="toc-text">lambdas</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#variadic-templates"><span class="toc-number">3.1.14.</span> <span class="toc-text">variadic templates</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%8D%B0tuple%E8%BF%99%E4%B8%AA%E4%BE%8B%E5%AD%90%E9%9D%9E%E5%B8%B8%E5%B7%A7%E5%A6%99"><span class="toc-number">3.1.15.</span> <span class="toc-text">æ‰“å°tuple(è¿™ä¸ªä¾‹å­éå¸¸å·§å¦™)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E8%AE%B2%E6%A0%87%E5%87%86%E5%BA%93"><span class="toc-number">3.2.</span> <span class="toc-text">ç¬¬äºŒè®²ï¼šæ ‡å‡†åº“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%B3%E5%80%BC%E5%BC%95%E7%94%A8"><span class="toc-number">3.2.1.</span> <span class="toc-text">å³å€¼å¼•ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%82%E9%85%8D%E5%99%A8-adapter-%E8%A1%A5%E5%85%85"><span class="toc-number">3.2.2.</span> <span class="toc-text">é€‚é…å™¨ Adapter è¡¥å……</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#x%E9%80%82%E9%85%8D%E5%99%A8ostream_iterator"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">Xé€‚é…å™¨ï¼šostream_iterator</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#istream_iterator"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">istream_iterator</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#type-traits"><span class="toc-number">3.2.2.3.</span> <span class="toc-text">type traits</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="toc-number">4.</span> <span class="toc-text">å†…å­˜ç®¡ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E8%AE%B2primitives"><span class="toc-number">4.1.</span> <span class="toc-text">ç¬¬ä¸€è®²ï¼šprimitives</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#c%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="toc-number">4.1.1.</span> <span class="toc-text">c++åº”ç”¨ç¨‹åº</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#c%E5%86%85%E5%AD%98%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%B7%A5%E5%85%B7"><span class="toc-number">4.1.1.1.</span> <span class="toc-text">c++å†…å­˜çš„åŸºæœ¬å·¥å…·</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#new-expression"><span class="toc-number">4.1.2.</span> <span class="toc-text">new expression</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#delete-expression"><span class="toc-number">4.1.2.1.</span> <span class="toc-text">delete expression</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#array-newarray-delete"><span class="toc-number">4.1.3.</span> <span class="toc-text">array new,array delete</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E5%88%86%E5%B8%83"><span class="toc-number">4.1.3.1.</span> <span class="toc-text">å†…å­˜åˆ†å¸ƒ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#placement-new"><span class="toc-number">4.1.4.</span> <span class="toc-text">placement new</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E8%BD%BD"><span class="toc-number">4.1.4.1.</span> <span class="toc-text">é‡è½½</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E8%BD%BD%E7%A4%BA%E4%BE%8B"><span class="toc-number">4.1.4.2.</span> <span class="toc-text">é‡è½½ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#basic_string%E4%BD%BF%E7%94%A8newextra%E7%94%B3%E8%AF%B7%E6%89%A9%E5%85%85%E9%87%8F"><span class="toc-number">4.1.4.3.</span> <span class="toc-text">basic_stringä½¿ç”¨new(extra)ç”³è¯·æ‰©å……é‡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#per-class-allocator-%E7%89%88%E6%9C%AC1-%E9%87%8D%E7%82%B9%E7%9C%8B"><span class="toc-number">4.1.5.</span> <span class="toc-text">per-class allocator ç‰ˆæœ¬1 (é‡ç‚¹çœ‹)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#per-class-allocator2-%E7%89%88%E6%9C%AC2"><span class="toc-number">4.1.5.1.</span> <span class="toc-text">per-class allocator2 ç‰ˆæœ¬2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#static-allocator-%E7%89%88%E6%9C%AC3"><span class="toc-number">4.1.5.2.</span> <span class="toc-text">static allocator ç‰ˆæœ¬3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#macro-for-static-allocator-%E7%89%88%E6%9C%AC4-%E5%81%B7%E6%87%92"><span class="toc-number">4.1.5.3.</span> <span class="toc-text">macro for static allocator ç‰ˆæœ¬4 (å·æ‡’)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#global-allocator-%E6%A0%87%E5%87%86%E5%BA%93%E7%9A%84%E9%82%A3%E4%B8%AA%E9%9D%9E%E5%B8%B8%E6%A3%92%E7%9A%84alloc"><span class="toc-number">4.1.6.</span> <span class="toc-text">global allocator æ ‡å‡†åº“çš„é‚£ä¸ªéå¸¸æ£’çš„alloc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#new-handler"><span class="toc-number">4.1.7.</span> <span class="toc-text">new handler</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#defaultdelete"><span class="toc-number">4.1.8.</span> <span class="toc-text">&#x3D;default,&#x3D;delete</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E8%AE%B2stdallocator"><span class="toc-number">4.2.</span> <span class="toc-text">ç¬¬äºŒè®²ï¼šstd::allocator</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#malloc"><span class="toc-number">4.2.1.</span> <span class="toc-text">malloc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%90%8C%E7%89%88%E6%9C%ACallocator%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.2.2.</span> <span class="toc-text">ä¸åŒç‰ˆæœ¬allocatorçš„å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#vc6"><span class="toc-number">4.2.2.1.</span> <span class="toc-text">VC6</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bc5"><span class="toc-number">4.2.2.2.</span> <span class="toc-text">BC5</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gc29"><span class="toc-number">4.2.2.3.</span> <span class="toc-text">Gc2.9</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pool-allocgc49-%E9%9D%9E%E5%B8%B8%E6%A3%92%E7%9A%84%E7%89%88%E6%9C%AC"><span class="toc-number">4.2.2.4.</span> <span class="toc-text">pool alloc(Gc4.9) éå¸¸æ£’çš„ç‰ˆæœ¬</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gc49%E6%A0%87%E5%87%86%E5%88%86%E9%85%8D%E5%99%A8allocator%E4%B8%8D%E6%98%AFalloc%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.2.2.5.</span> <span class="toc-text">Gc4.9æ ‡å‡†åˆ†é…å™¨allocator(ä¸æ˜¯alloc)çš„å®ç°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gc29-stdalloc%E5%BE%88%E5%A5%BD%E7%9A%84%E5%88%86%E9%85%8D%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.2.3.</span> <span class="toc-text">Gc2.9 std::alloc(å¾ˆå¥½çš„åˆ†é…å™¨)çš„å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#embedded-pointers-%E5%86%85%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%8C%87%E9%92%88"><span class="toc-number">4.2.3.1.</span> <span class="toc-text">embedded pointers å†…åµŒå…¥å¼æŒ‡é’ˆ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gc29-stdalloc-%E8%BF%90%E8%A1%8C%E4%B8%80%E7%9E%A5%E4%B8%80%E4%B8%AA%E9%9D%9E%E5%B8%B8%E5%A5%BD%E7%9A%84%E8%AE%BE%E8%AE%A1-1-13"><span class="toc-number">4.2.4.</span> <span class="toc-text">Gc2.9 std::alloc è¿è¡Œä¸€ç¥(ä¸€ä¸ªéå¸¸å¥½çš„è®¾è®¡) 1-13</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gc29-stdalloc%E7%9A%84%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90"><span class="toc-number">4.2.5.</span> <span class="toc-text">Gc2.9 std::allocçš„æºç å‰–æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gc29-stdalloc%E8%A7%82%E5%BF%B5%E5%A4%A7%E6%95%B4%E7%90%86"><span class="toc-number">4.2.6.</span> <span class="toc-text">Gc2.9 std::allocè§‚å¿µå¤§æ•´ç†</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E8%AE%B2lokiallocator"><span class="toc-number">4.3.</span> <span class="toc-text">ç¬¬å››è®²ï¼šloki::allocator</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#lokiallocator%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.3.1.</span> <span class="toc-text">Loki::allocatorè®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="toc-number">4.3.2.</span> <span class="toc-text">æºä»£ç </span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#chunk%E7%B1%BB"><span class="toc-number">4.3.2.1.</span> <span class="toc-text">Chunkç±»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fixedallocator%E7%B1%BB"><span class="toc-number">4.3.2.2.</span> <span class="toc-text">FixedAllocatorç±»</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E8%AE%B2other-issues"><span class="toc-number">4.4.</span> <span class="toc-text">ç¬¬äº”è®²ï¼šother issues</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#new_allocator"><span class="toc-number">4.4.1.</span> <span class="toc-text">new_allocator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#array_allocator"><span class="toc-number">4.4.2.</span> <span class="toc-text">array_allocator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#debug_allocator"><span class="toc-number">4.4.3.</span> <span class="toc-text">debug_allocator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gc29%E4%BD%BF%E7%94%A8%E7%9A%84stdalloc-__pool_alloc"><span class="toc-number">4.4.4.</span> <span class="toc-text">Gc2.9ä½¿ç”¨çš„std::alloc (__pool_alloc)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bitmap_allocator"><span class="toc-number">4.4.5.</span> <span class="toc-text">bitmap_allocator</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#allocate%E8%BF%87%E7%A8%8B"><span class="toc-number">4.4.5.1.</span> <span class="toc-text">allocateè¿‡ç¨‹ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#deallocate%E8%BF%87%E7%A8%8B"><span class="toc-number">4.4.5.2.</span> <span class="toc-text">deallocateè¿‡ç¨‹ï¼š</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%88%E8%B0%88const"><span class="toc-number">4.4.6.</span> <span class="toc-text">è°ˆè°ˆconst</span></a></li></ol></li></ol></li></ol></section><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/assets/android-chrome-512x512.webp" alt="avatar"></div><p class="sidebar-ov-author__text">Self-discipline is key in life.</p></div><div class="sidebar-ov-social"><a class="sidebar-ov-social-item" href="https://github.com/DavidingPlus" target="_blank" rel="noopener" data-popover="GitHub" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-github"></i></span></a><a class="sidebar-ov-social-item" href="/qq/" target="_blank" rel="noopener" data-popover="QQ" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-qq"></i></span></a><a class="sidebar-ov-social-item" href="/wechat/" target="_blank" rel="noopener" data-popover="å¾®ä¿¡" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-weixin"></i></span></a><a class="sidebar-ov-social-item" href="mailto:davidingplus@qq.com" target="_blank" rel="noopener" data-popover="davidingplus@qq.com" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fas fa-envelope"></i></span></a></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">38</div><div class="sidebar-ov-state-item__name">å½’æ¡£</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">21</div><div class="sidebar-ov-state-item__name">åˆ†ç±»</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="çŸ¥è¯†å…±äº«è®¸å¯åè®®" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">æ‚¨å·²é˜…è¯»äº† </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright Â© 2023~2025</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>DavidingPlus</span><span class="footer__devider">|</span><span>èœ€ ICP å¤‡ 2024088070 å·</span></div><div><span>ç”± <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> å¼ºåŠ›é©±åŠ¨</span><span> v7.2.0</span><span class="footer__devider">|</span><span>ä¸»é¢˜ - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.8.6</span></div><div class="busuanzi"><span class="busuanzi-siteuv"><span class="busuanzi-siteuv__icon"><i class="fas fa-user"></i></span><span class="busuanzi-siteuv__info">è®¿é—®äººæ•°</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_uv"></span></span><span class="busuanzi-sitepv"><span class="busuanzi-siteuv__icon"><i class="fas fa-eye"></i></span><span class="busuanzi-siteuv__info">æµè§ˆæ€»é‡</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_pv"></span></span></div><div><span id="timeDate">è½½å…¥å¤©æ•°...</span><span id="times">è½½å…¥æ—¶åˆ†ç§’...</span><script>var now=new Date;function createtime(){var n=new Date("09/18/2023 00:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="å°ç ´ç«™å·²ç»å®‰å…¨è¿è¡Œ "+dnum+" å¤© ",document.getElementById("times").innerHTML=hnum+" å°æ—¶ "+mnum+" åˆ† "+snum+" ç§’å•¦ï¼"}setInterval("createtime()",250)</script></div><script type="text/javascript" id="maid-script" mermaidoptioins="{&quot;theme&quot;:&quot;default&quot;}" src="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/js/mermaid.min.js"></script><script>if(window.mermaid){var options=JSON.parse(document.getElementById("maid-script").getAttribute("mermaidoptioins"));mermaid.initialize(options)}</script></div></footer><div class="loading-animation" id="loading-animation"><div class="loading-animation__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-thumbs-up"></i></span></div><div class="back2bottom" id="back2bottom"><span class="back2bottom__icon"><i class="fas fa-rocket"></i></span></div></div><div class="search-mask"></div><div class="search-popup"><span class="search-close"></span><div class="search-input"><input placeholder="æœç´¢æ–‡ç« ï¼ˆæ”¯æŒå¤šå…³é”®è¯ï¼Œè¯·ç”¨ç©ºæ ¼åˆ†éš”ï¼‰"><div class="search-btns">ä½¿ç”¨æœç´¢ï¼š<span class="search-btns-item search-btns-item--bing"><i></i>å¿…åº”</span><span class="search-btns-item search-btns-item--baidu"><i></i>ç™¾åº¦</span></div></div><div class="search-results"></div></div><script src="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/js/jquery.js"></script><script src="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/js/velocity.js"></script><script src="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/js/velocity-ui.js"></script><script src="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/js/canvas-nest.js" color="255,255,255" opacity="1" count="99" zindex="-1"></script><script src="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/js/fancybox.js"></script><script src="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/js/masonry.js"></script><script src="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/js/lazyload.js"></script><script>function initSearch(){var e=!0,t="search.json";t?/json$/i.test(t)&&(e=!1):t="search.xml";var n="/"+t;$.ajax({url:n,dataType:e?"xml":"json",async:!0,success:function(t){var n=e?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,o=$(".search-input input"),i=$(".search-results"),c=100,r=1,a=function(){var e=o.val().toLowerCase().trim(),t=e.split(/[\s]+/),a=[];t.length>1&&t.push(e),e.length>0&&n.forEach(function(e){var n=!1,o=e.title&&e.title.trim()||"[ æ–‡ç« æ— æ ‡é¢˜ ]",i=o&&o.toLowerCase(),s=e.content&&e.content.replace(/<[^>]+>/g,""),l=s&&s.toLowerCase(),u=e.url&&decodeURI(e.url).replace(/\/{2,}/g,"/"),h=[],d=[];t.forEach(function(e){function t(e,t,n,o){if(!e||!t)return[];var i=0,c=-1,r=[];for(n||(e=e.toLowerCase(),t=t.toLowerCase());-1!==(c=t.indexOf(e,i));){var a=!1;h.forEach(function(t){t.index===c&&t.word.length<e.length&&(t.word=e,a=!0)}),i=c+e.length,!a&&r.push({index:c,word:e,weight:o})}return r}h=h.concat(t(e,i,!1,c)),d=d.concat(t(e,l,!1,r))});var f=h.length,p=d.length;if((f>0||p>0)&&(n=!0),n){function w(e,t,n,o){if(e&&t&&t.length){var i="",c=n,r=o;return t.forEach(function(t){if(!(t.index<c)){var n=t.index+t.word.length;i+=e.slice(c,t.index),i+="<b>"+e.slice(t.index,n)+"</b>",c=n}}),i+=e.slice(c,r)}}[h,d].forEach(function(e){e.sort(function(e,t){return e.index-t.index})});var v,g={},x=h.length*c+d.length*r,y=w(o,h,0,o.length)||o;if(d.length>0){var S=d[0].index;v=w(s,d,S>20?S-20:0,S+180)}else v=s.slice(0,200);g.title=y,g.content=v,g.url=u,g.weight=x,a.push(g)}});var s="";a.length?(a.sort(function(e,t){return t.weight-e.weight}),s+="<ul>",a.forEach(function(e){s+='<li><a class="search-results-title" href="'+e.url+'">',s+=e.title,s+='</a><div class="search-results-content">',s+=e.content,s+="</div></li>"}),s+="</ul>"):s+='<div class="search-results-none"><i class="far fa-meh"></i></div>',i.html(s)};o.on("input",a),o.on("keyup",function(e){e.keyCode===Stun.utils.codeToKeyCode("Enter")&&a()})}})}function closeSearch(){$("body").css({overflow:"auto"}),$(".search-popup").css({display:"none"}),$(".search-mask").css({display:"none"})}function safeOpenUrl(e){var t=window.open();t.opener=null,t.location=e}function extSearch(e){var t=window.location.host,n=$(".search-input input").val().toLowerCase().trim();n?safeOpenUrl({google:"https://www.google.com/search?q=",bing:"https://cn.bing.com/search?q=",baidu:"https://www.baidu.com/s?ie=UTF-8&wd="}[e]+n+" site:"+t):Stun.utils.popAlert("warning","è¯·è¾“å…¥å­—ç¬¦")}window.addEventListener("DOMContentLoaded",function(){Stun.utils.pjaxReloadLocalSearch=function(){$(".header-nav-search").on("click",function(e){e.stopPropagation(),$("body").css("overflow","hidden"),$(".search-popup").velocity("stop").velocity("transition.expandIn",{duration:300,complete:function(){$(".search-popup input").focus()}}),$(".search-mask").velocity("stop").velocity("transition.fadeIn",{duration:300}),initSearch()}),$(".search-mask, .search-close").on("click",function(){closeSearch()}),$(document).on("keydown",function(e){e.keyCode===Stun.utils.codeToKeyCode("Escape")&&closeSearch()})},Stun.utils.pjaxReloadLocalSearch()},!1);var assistSearchList=window.CONFIG.assistSearch;Array.isArray(assistSearchList)&&assistSearchList.forEach(function(e){document.querySelector(".search-btns-item--"+e).addEventListener("click",function(){extSearch(e)},!1)})</script><script src="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/js/pjax.js"></script><script>window.addEventListener("DOMContentLoaded",function(){new Pjax({selectors:["head title","#main",".pjax-reload",".header-banner"],history:!0,scrollTo:!1,scrollRestoration:!1,cacheBust:!1,debug:!1,currentUrlFullReload:!1,timeout:0});document.addEventListener("pjax:send",function(){$(".header-nav-menu").removeClass("show"),CONFIG.pjax&&CONFIG.pjax.avoidBanner&&$("html").velocity("scroll",{duration:500,offset:$("#header").height(),easing:"easeInOutCubic"}),$(".loading-animation").addClass("loading")},!1),window.addEventListener("pjax:complete",function(){if($(".loading-animation").removeClass("loading"),$("link[rel=prefetch], script[data-pjax-rm]").each(function(){$(this).remove()}),$("script[data-pjax], #pjax-reload script").each(function(){$(this).parent().append($(this).remove())}),Stun.utils.pjaxReloadBoot&&Stun.utils.pjaxReloadBoot(),Stun.utils.pjaxReloadScroll&&Stun.utils.pjaxReloadScroll(),Stun.utils.pjaxReloadSidebar&&Stun.utils.pjaxReloadSidebar(),"undefined"!=typeof mermaid){const e=Array.from(document.querySelectorAll(".mermaid")).filter(e=>!e.dataset.processed);mermaid.init(void 0,e)}},!1)},!1)</script><div id="pjax-reload"><link href="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/css/katex.min.css" rel="stylesheet" type="text/css"><link href="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/css/copy-tex.css" rel="stylesheet" type="text/css"><script src="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/js/copy-tex.min.js"></script><script src="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/js/quicklink.js"></script><script>function initQuicklink(){quicklink({timeout:"10000",priority:!0,ignores:[i=>i.includes("#"),i=>"https://blog.davidingplus.cn/posts/2abc6e08.html"===i,/\/api\/?/,i=>i.includes(".xml"),i=>i.includes(".zip"),(i,t)=>t.hasAttribute("nofollow"),(i,t)=>t.hasAttribute("noprefetch")]})}initQuicklink()</script><script src="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/js/busuanzi.js" async></script></div><script src="/js/utils.js?v=2.8.6"></script><script src="/js/stun-boot.js?v=2.8.6"></script><script src="/js/scroll.js?v=2.8.6"></script><script src="/js/header.js?v=2.8.6"></script><script src="/js/sidebar.js?v=2.8.6"></script><script type="application/json" src="/search.json"></script><script data-pjax="">function loadUtterances(){var t=document,e=t.createElement("script"),s=t.getElementById("utterances-container"),r=Stun.utils.getNightMode()?"photon-dark":"github-light";s&&(e.src="https://utteranc.es/client.js",e.setAttribute("repo","DavidingPlus/blog-comments"),e.setAttribute("issue-term","title"),e.setAttribute("label","utterances"),e.setAttribute("theme",r),e.setAttribute("crossorigin","anonymous"),e.setAttribute("async",""),e.setAttribute("data-pjax-rm",""),s.append(e))}loadUtterances()</script><script async src="/js/cursor/text.js"></script><script src="/js/activate-power-mode.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!0,document.body.addEventListener("input",POWERMODE)</script><script>var titleTime,OriginTitile=document.title;document.addEventListener("visibilitychange",function(){document.hidden?(document.title="ğŸ¤¡å¿«å›æ¥,ç²—å¤§äº‹äº†~~"+OriginTitile,clearTimeout(titleTime)):(document.title="ğŸ˜šæ¬¢è¿å›æ¥!~"+OriginTitile,titleTime=setTimeout(function(){document.title=OriginTitile},2e3))})</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/wanko.model.json"},display:{position:"left",width:160,height:290},mobile:{show:!0},log:!1})</script></body></html>