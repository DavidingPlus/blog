<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="renderer" content="webkit"><meta name="force-rendering" content="webkit"><script>window.MSInputMethodContext&&document.documentMode&&(window.location.href="https://support.dmeng.net/upgrade-your-browser.html")</script><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/assets/favicon-16x16.webp?v=2.8.6" type="image/png" sizes="16x16"><link rel="icon" href="/assets/favicon-32x32.webp?v=2.8.6" type="image/png" sizes="32x32"><link rel="apple-touch-icon" href="/assets/apple-touch-icon.webp?v=2.8.6" sizes="180x180"><meta name="description" content="å­¦ä¹ è·¯çº¿"><meta property="og:type" content="article"><meta property="og:title" content="ç‰›å®¢ Linux"><meta property="og:url" content="https://blog.davidingplus.cn/posts/ff333d31.html"><meta property="og:site_name" content="DavidingPlus&#39;s Blog"><meta property="og:description" content="å­¦ä¹ è·¯çº¿"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712153227763.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712154631108.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712162031153.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712162645602.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712162728058.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712163010950.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712163038321.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712163407827.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712163412996.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712170016696.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712170241165.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712192929996.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712193256400.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712193344515.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712194227453.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712194715642.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712200023339.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712200254526.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712200359114.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712200507667.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712200537940.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712202308744.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712202505969.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712204636658.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712204703427.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712204335700.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712205553942.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712210027653.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712212247869.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712212541900.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712212710023.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712212817883.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712213659601.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712213823973.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712213917346.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712214441428.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712214549726.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712215334405.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713095340490.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713095639181.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713100533853.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713100855560.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713101528981.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713102059928.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713103610886.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713103811609.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713104023510.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713104408213.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713105602304.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713105556164.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713113345866.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713113808672.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713132533052.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713132756923.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713133926048.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713140259470.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713140857081.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713141622040.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713143121240.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713142329930.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713143240623.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713143813271.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713144716128.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713144828842.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713150206430.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713150556682.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713150932690.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713151406288.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713151623439.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713152020106.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713152439462.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713153024581.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713153323313.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713153540431.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713154539740.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230714100055222.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230714101445015.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230714102646385.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230714105536343.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230714110840838.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230714113744182.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230714134141808.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230714134158964.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230714152755154.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230714153204023.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230714154550861.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230714154900243.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230715104004715.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230715110918357.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230715113517243.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230715125019218.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230715130311932.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230715141246853.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230715145100478.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230716113520531.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230716113908652.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230716114055627.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230716114135444.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230716114205304.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230716120419774.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230716121448756.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718093121456.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718093806701.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718094028703.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718094423758.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718095104233.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718095230919.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718095445176.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718095843259.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718100643298.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718101259447.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718101452289.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718101951634.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718104207327.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718105046657.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718142613257.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718143403658.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718145227613.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718145632605.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718151209448.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718151224879.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718152959795.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718154755731.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718154816547.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/02/01/image-20230718170703719.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718171319019.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718194621050.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718195742100.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/02/01/image-20230718195756973.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718200326121.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718202030384.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718203522772.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718203825193.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718205238264.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/02/01/image-20230718205324350.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718205637544.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/02/01/image-20230718205647171.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718210109506.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718211154805.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719094953685.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719095319683.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718220547310.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719095606504.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719095625400.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719103805234.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719103852259.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719103900180.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719104207710.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719110333954.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719112527654.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719143725384.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719144556698.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719145008340.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719111308071.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/02/01/image-20230719145051553.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719153654422.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719153922897.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721103551177.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721103558631.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721103607149.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721104349892.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721115524021.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721115546729.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721134808630.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721135603117.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721135452517.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721140511484.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721145953793.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721150130194.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721151257066.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721151329604.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721152717230.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721151935217.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721152127780.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721164727872.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721164735118.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721170443404.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722143701427.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722143806582.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722155039444.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722171544342.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722171944530.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722172651186.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722172945238.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722173136070.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722173332099.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722173427247.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722173511150.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722173544492.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722190246653.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722190333227.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722190630746.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722190751504.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722190919579.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722174710585.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722193118885.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722193131543.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722200410797.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722200801779.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722201704262.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722201732964.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230723150743944.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230723154213795.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230723165142990.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230723170027725.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230724150434261.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230724155507574.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230724160250340.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230724160542261.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230724170811186.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230724172117665.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230724173035421.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230724204226816.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725090718804.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725091618011.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725102001298.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725102008328.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725104726840.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725111929961.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725112626809.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725113205286.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725113517970.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725113838738.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725114051864.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725150200682.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725114544913.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725162229689.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725162327872.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725162413359.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725162732120.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725163508676.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725163632242.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725164029090.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725203244279.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725201723897.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230726174153972.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725212001708.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725212124179.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230727111343535.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230727114257371.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230731101134205.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230731101232100.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230731103140397.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230731143537103.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230731154000837.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230731161340736.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230801145448245.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230801145628830.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230802144136067.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230802145837448.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230802150151733.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230802150219200.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230803135330646.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230803143045431.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230803143334595.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230803151736722.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230804134719753.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230816104436489.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230816112647486.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230816150325060.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817102529078.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817104711611.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817114724983.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817154336052.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817162026337.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817164927457.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817165030403.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817165057099.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817171145866.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817171159785.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/02/01/image-20230817171216720.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817171259144.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817171313342.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817171325127.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817171331187.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817203353404.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817171342456.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817171356559.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817171401748.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817201604241.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817210404237.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230818092738767.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230818092744993.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230818115634758.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230818115654321.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230818115728450.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230818143501064.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230818175354581.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230818175513668.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230819113154633.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230819103736969.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230818175617550.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230818175628648.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230818175657616.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230819150618612.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230819170952283.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230819172037175.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230819172505207.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230819153502987.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230819153510357.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821093427390.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822153655659.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230820172341423.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230819153502987.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230820174841668.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230820175148993.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230820175507945.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230820175849220.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230820180107223.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821101046107.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821101622911.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821102216612.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821102411708.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821102813978.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821102923936.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821132937309.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821162010058.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821162714320.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821095539250.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821095539250.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821194458779.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822113418607.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822113459363.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822114219505.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822114228554.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822114407108.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822114413347.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822115230225.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822115243021.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822145319237.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822154224472.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822155038817.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822155057787.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822155443323.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822155501635.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822160604851.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822160649282.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822160933192.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823114653916.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823123131126.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823124612140.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823151111152.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823151122954.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823151222376.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823151351101.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823152331909.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823152340686.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823152830630.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823152839250.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823153112240.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823153119822.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/02/01/%E9%98%BB%E5%A1%9E%E3%80%81%E9%9D%9E%E9%98%BB%E5%A1%9E%E3%80%81%E5%90%8C%E6%AD%A5%E3%80%81%E5%BC%82%E6%AD%A5.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823155027679.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823155137394.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823155156625.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823155217650.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823155237200.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823155255891.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230825104334383.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230825104527500.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230825104549067.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230825104624298.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230825104759498.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230825114344227.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230825114619086.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230825114659772.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230825114740311.png"><meta property="og:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230825145330177.png"><meta property="article:published_time" content="2023-09-21T01:00:00.000Z"><meta property="article:modified_time" content="2023-09-21T01:00:00.000Z"><meta property="article:author" content="DavidingPlus"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712153227763.png"><title>ç‰›å®¢ Linux | DavidingPlus's Blog</title><link ref="canonical" href="https://blog.davidingplus.cn/posts/ff333d31.html"><link rel="dns-prefetch" href="https://cdn.davidingplus.cn"><link rel="stylesheet" href="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/css/fontawesome.css" type="text/css"><link rel="stylesheet" href="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/css/fancybox.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.8.6"><script>var Stun=window.Stun||{},CONFIG={root:"/",algolia:void 0,assistSearch:["bing","baidu"],fontIcon:{prompt:{success:"fas fa-check-circle",info:"fas fa-arrow-circle-right",warning:"fas fa-exclamation-circle",error:"fas fa-times-circle"},copyBtn:"fas fa-copy"},sidebar:{offsetTop:"55px",tocMaxDepth:6},header:{enable:!0,showOnPost:!0,scrollDownIcon:!0},postWidget:{endText:!0},nightMode:{enable:!0},back2top:{enable:!0},back2bottom:{enable:!0},codeblock:{style:"default",highlight:"light",wordWrap:!0},reward:!0,fancybox:!0,zoomImage:{gapAside:"20px"},galleryWaterfall:{colWidth:"255px",gapX:"65px"},lazyload:!0,pjax:{avoidBanner:!0},externalLink:{icon:{enable:!0,name:"fas fa-external-link-alt"}},shortcuts:void 0,prompt:{copyButton:"å¤åˆ¶",copySuccess:"æ­å–œäº²äº²ï¼Œå¤åˆ¶æˆåŠŸå’§",copyError:"å“å‘€ï¼Œå¤åˆ¶å¤±è´¥äº†"},sourcePath:{js:"js",css:"css",images:"images"},utterancesTheme:{light:"github-light",dark:"photon-dark"}};window.CONFIG=CONFIG</script><meta name="generator" content="Hexo 7.2.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">é¦–é¡µ</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">å½’æ¡£</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">åˆ†ç±»</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="javascript:;" onclick="return!1"><span class="header-nav-menu-item__icon"><i class="fas fa-bars"></i></span><span class="header-nav-menu-item__text">å…¶ä»–</span></a><div class="header-nav-submenu"><div class="header-nav-submenu-item"><a class="header-nav-submenu-item__link" href="/friends/"><span class="header-nav-submenu-item__icon"><i class="fas fa-users"></i></span><span class="header-nav-submenu-item__text">å‹é“¾</span></a></div><div class="header-nav-submenu-item"><a class="header-nav-submenu-item__link" href="/gallery/"><span class="header-nav-submenu-item__icon"><i class="fas fa-images"></i></span><span class="header-nav-submenu-item__text">ç›¸å†Œ</span></a></div></div></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/about/"><span class="header-nav-menu-item__icon"><i class="fas fa-user"></i></span><span class="header-nav-menu-item__text">å…³äº</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" target="_blank" rel="noopener" href="https://davidingplus.cn/"><span class="header-nav-menu-item__icon"><i class="fas fa-pager"></i></span><span class="header-nav-menu-item__text">ç«™ç‚¹ä¸»é¡µ</span></a></div></div><div class="header-nav-search"><span class="header-nav-search__icon"><i class="fas fa-search"></i></span><span class="header-nav-search__text">æœç´¢</span></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">DavidingPlus's Blog</div><div class="header-banner-info__subtitle">ğŸ•Šï¸ world peace</div></div><div class="header-banner-arrow"><div class="header-banner-arrow__icon"><i class="fas fa-angle-down"></i></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">ç‰›å®¢ Linux</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">å‘è¡¨äº</span><span class="post-meta-item__value">2023-09-21</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">æ›´æ–°äº</span><span class="post-meta-item__value">2023-09-21</span></span><span class="post-meta-item post-meta-item--wordcount"><span class="post-meta-item__icon"><i class="far fa-file-word"></i></span><span class="post-meta-item__info">å­—æ•°ç»Ÿè®¡</span><span class="post-meta-item__value">90.1k</span></span><span class="post-meta-item post-meta-item--readtime"><span class="post-meta-item__icon"><i class="far fa-clock"></i></span><span class="post-meta-item__info">é˜…è¯»æ—¶é•¿</span><span class="post-meta-item__value">616åˆ†</span></span><span class="post-meta-item post-meta-item--visitors"><span class="post-meta-item__icon"><i class="fas fa-eye"></i></span><span class="post-meta-item__info">é˜…è¯»æ¬¡æ•°</span><span class="post-meta-item__value" id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body"><meta name="referrer" content="no-referrer"><h1 id="å­¦ä¹ è·¯çº¿"><a href="#å­¦ä¹ è·¯çº¿" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å­¦ä¹ è·¯çº¿"></a> å­¦ä¹ è·¯çº¿</h1><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712153227763.png" alt="image-20230712153227763"></p><span id="more"></span><h1 id="ç¬¬ä¸€ç« -linuxç³»ç»Ÿç¼–ç¨‹å…¥é—¨"><a href="#ç¬¬ä¸€ç« -linuxç³»ç»Ÿç¼–ç¨‹å…¥é—¨" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¬¬ä¸€ç« -linuxç³»ç»Ÿç¼–ç¨‹å…¥é—¨"></a> ç¬¬ä¸€ç«  Linuxç³»ç»Ÿç¼–ç¨‹å…¥é—¨</h1><h2 id="gcc"><a href="#gcc" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#gcc"></a> GCC</h2><h3 id="ä»€ä¹ˆæ˜¯gcc"><a href="#ä»€ä¹ˆæ˜¯gcc" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯gcc"></a> ä»€ä¹ˆæ˜¯GCC</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712154631108.png" alt="image-20230712154631108"></p><h3 id="gccå·¥ä½œæµç¨‹"><a href="#gccå·¥ä½œæµç¨‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#gccå·¥ä½œæµç¨‹"></a> GCCå·¥ä½œæµç¨‹</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712162031153.png" alt="image-20230712162031153"></p><p>é¢„å¤„ç†å‘½ä»¤ <strong>-E</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712162645602.png" alt="image-20230712162645602"></p><p>å¾—åˆ°çš„ç»“æœï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712162728058.png" alt="image-20230712162728058"></p><p>å¾—åˆ°æ±‡ç¼–ä»£ç å‘½ä»¤ <strong>-S</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712163010950.png" alt="image-20230712163010950"></p><p>å¾—åˆ°çš„ç»“æœï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712163038321.png" alt="image-20230712163038321"></p><h3 id="å¸¸ç”¨å‚æ•°é€‰é¡¹"><a href="#å¸¸ç”¨å‚æ•°é€‰é¡¹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å¸¸ç”¨å‚æ•°é€‰é¡¹"></a> å¸¸ç”¨å‚æ•°é€‰é¡¹</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712163407827.png" alt="image-20230712163407827"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712163412996.png" alt="image-20230712163412996"></p><p>å…³äº-Dï¼š<strong>ç”¨äºåœ¨ç¼–è¯‘çš„æ—¶å€™æŒ‡å®šä¸€ä¸ªå®</strong></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨ -D æ¥è¡¨ç¤ºåœ¨ç¼–è¯‘çš„æ—¶å€™æŒ‡å®šä¸€ä¸ªå®ï¼Œä»è€Œå¯ä»¥è¾“å‡ºè¿™å¥è¯!!! -DDEBUG</span></span><br><span class="line">    <span class="comment">// ä¸€ä¸ªç”¨é€”æ˜¯ï¼šå¯ä»¥åœ¨ç”¨äºè°ƒè¯•çš„æ—¶å€™è¾“å‡ºä¸€äº›ä¿¡æ¯æ¥æ£€æµ‹ç¨‹åºï¼Œå¯¹ç¨‹åºæ•´ä½“çš„è¿è¡Œæ²¡æœ‰å¤ªå¤§ä½œç”¨</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> DEBUG</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;FUCK&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;you&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>å…³äº-Onï¼šè¿›è¡Œä¼˜åŒ–</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> b, c, d, e;</span><br><span class="line">    b = <span class="number">10</span>;</span><br><span class="line">    c = b;</span><br><span class="line">    d = c;</span><br><span class="line">    e = d;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ -On è¿›è¡Œä¼˜åŒ–,æ¯”å¦‚å¯ä»¥ä¼˜åŒ–æˆå¦‚ä¸‹</span></span><br><span class="line">    <span class="comment">// int b, c, d, e;</span></span><br><span class="line">    <span class="comment">// b = 10;</span></span><br><span class="line">    <span class="comment">// c = 10;</span></span><br><span class="line">    <span class="comment">// d = 10;</span></span><br><span class="line">    <span class="comment">// e = 10;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="gccå’ŒgåŒºåˆ«"><a href="#gccå’ŒgåŒºåˆ«" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#gccå’ŒgåŒºåˆ«"></a> gccå’Œg++åŒºåˆ«</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712170016696.png" alt="image-20230712170016696"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712170241165.png" alt="image-20230712170241165"></p><h2 id="é™æ€åº“"><a href="#é™æ€åº“" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#é™æ€åº“"></a> é™æ€åº“</h2><p>å…³äºåº“ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712192929996.png" alt="image-20230712192929996"></p><h3 id="å‘½åè§„åˆ™"><a href="#å‘½åè§„åˆ™" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å‘½åè§„åˆ™"></a> å‘½åè§„åˆ™</h3><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712193256400.png" alt="image-20230712193256400" style="zoom:80%"><h3 id="åˆ¶ä½œ"><a href="#åˆ¶ä½œ" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#åˆ¶ä½œ"></a> åˆ¶ä½œ</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712193344515.png" alt="image-20230712193344515"></p><p>åˆ¶ä½œç¤ºä¾‹ï¼š</p><p>ç°åœ¨æˆ‘æƒ³æŠŠå››åˆ™è¿ç®—çš„ä»£ç æ‰“æˆä¸€ä¸ªé™æ€åº“ä¾›åˆ«äººä½¿ç”¨</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712194227453.png" alt="image-20230712194227453"></p><p><strong>æŒ‰ç…§ä¸Šé¢çš„æ“ä½œï¼Œå…ˆé€šè¿‡gccç”Ÿæˆ .o æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ -c åˆ°ç¼–è¯‘æ±‡ç¼–ï¼Œä½†æ˜¯ä¸é“¾æ¥çš„çŠ¶æ€ï¼Œè¿™å°±å¾—åˆ°äº†å„ä¸ªæ–‡ä»¶çš„.o</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712194715642.png" alt="image-20230712194715642"></p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä½¿ç”¨"></a> ä½¿ç”¨</h3><p>åœ¨å®é™…çš„å¼€å‘ç¯å¢ƒä¸­ï¼Œä»£ç çš„ç»“æ„å¾€å¾€æ˜¯è¿™æ ·çš„</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712200023339.png" alt="image-20230712200023339"></p><p><strong>includeæ–‡ä»¶å¤¹åŒ…å«ç›¸åº”åº“å½“ä¸­å®ç°çš„å¤´æ–‡ä»¶ï¼Œlibå°±å­˜æ”¾å¯¹åº”çš„åº“ï¼Œsrcå­˜æ”¾æºç ï¼Œè¿™ä¸ªå¯¹ç¨‹åºçš„è¿è¡Œæ²¡æœ‰å½±å“ï¼Œå¯ä»¥ç†è§£ä¸ºå°±æ˜¯å·¥ä½œç›®å½•</strong></p><p><strong>åœ¨å®é™…ç¼–è¯‘è¿è¡Œç¨‹åºçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä»…éœ€è¦æä¾›includeä¸‹çš„å¤´æ–‡ä»¶ï¼Œä¹Ÿéœ€è¦æä¾›libä¸‹ç›¸å¯¹åº”å®ç°çš„åº“</strong></p><p>è¿™å°±éœ€è¦åœ¨g++æˆ–è€…gccç¼–è¯‘çš„è¿‡ç¨‹ä¸­åŠ å…¥å‚æ•°äº†</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712200254526.png" alt="image-20230712200254526"></p><p>ç›´æ¥ç¼–è¯‘ä¼šå¯¼è‡´æ‰¾ä¸åˆ°å¤´æ–‡ä»¶ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™head.hå’Œmain.cä¸åœ¨åŒä¸€ç›®å½•ï¼Œæ‰€ä»¥éœ€è¦ç”¨ -I æ¥åŒ…å«å¤´æ–‡ä»¶æœç´¢çš„ç›®å½•</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712200359114.png" alt="image-20230712200359114"></p><p>åœ¨åŒ…å«äº†å¤´æ–‡ä»¶ä¹‹åï¼Œå‘ç°é‡Œé¢çš„å‡½æ•°è¿›è¡Œäº†å£°æ˜ä½†æ˜¯æ²¡æœ‰å®ç°ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å¼•ç”¨åº“æ–‡ä»¶äº†</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712200507667.png" alt="image-20230712200507667"></p><p><strong>calcæ˜¯åº“çš„åç§°ï¼Œlibcalc.aæ˜¯æˆ‘ä»¬è®¤ä¸ºè¦æ±‚çš„åº“æ–‡ä»¶çš„åç§°</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712200537940.png" alt="image-20230712200537940"></p><h2 id="åŠ¨æ€åº“"><a href="#åŠ¨æ€åº“" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#åŠ¨æ€åº“"></a> åŠ¨æ€åº“</h2><h3 id="å‘½åè§„åˆ™-2"><a href="#å‘½åè§„åˆ™-2" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å‘½åè§„åˆ™-2"></a> å‘½åè§„åˆ™</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712202308744.png" alt="image-20230712202308744"></p><h3 id="åˆ¶ä½œ-2"><a href="#åˆ¶ä½œ-2" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#åˆ¶ä½œ-2"></a> åˆ¶ä½œ</h3><p><strong>å¾—åˆ°ä¸ä½ç½®æ— å…³çš„ä»£ç  -fpic/-fPIC (è¿™ä¸ª / æ˜¯æˆ–è€…çš„æ„æ€ï¼Œå°±æ˜¯ä¸¤ä¸ªä»»é€‰ä¸€ä¸ªå†™éƒ½å¯ä»¥)</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712202505969.png" alt="image-20230712202505969"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712204636658.png" alt="image-20230712204636658"></p><h3 id="ä½¿ç”¨-2"><a href="#ä½¿ç”¨-2" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä½¿ç”¨-2"></a> ä½¿ç”¨</h3><p>å’Œé™æ€åº“çš„ä½¿ç”¨æ–¹æ³•ä¸€è‡´ï¼Œä½†æ˜¯è¿™é‡Œä¼šå‡ºç°åŠ¨æ€åº“åŠ è½½å¤±è´¥çš„é—®é¢˜</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712204703427.png" alt="image-20230712204703427"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712204335700.png" alt="image-20230712204335700"></p><h3 id="åŠ è½½å¤±è´¥åŠå…¶è§£å†³"><a href="#åŠ è½½å¤±è´¥åŠå…¶è§£å†³" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#åŠ è½½å¤±è´¥åŠå…¶è§£å†³"></a> åŠ è½½å¤±è´¥åŠå…¶è§£å†³</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712205553942.png" alt="image-20230712205553942"></p><p><strong>lddå‘½ä»¤(æ‰¾åˆ°åŠ¨æ€åº“çš„ä¾èµ–å…³ç³»)</strong></p><p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="http://xn--libcalc-hc5k72udnf3q1j.so">å¯ä»¥çœ‹å‡ºlibcalc.so</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>ï¼Œæˆ‘ä»¬è‡ªå·±å†™çš„åŠ¨æ€åº“æ‰¾ä¸åˆ°ä¾èµ–ï¼Œæ˜¾ç„¶æ— æ³•æ‰§è¡Œ</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712210027653.png" alt="image-20230712210027653"></p><p><strong>/lib64/ld-linux-x86-64.so.2 è¿™ä¸ªæ˜¯ç³»ç»Ÿæä¾›çš„åŠ¨æ€è½½å…¥å™¨ï¼Œç”¨æ¥è·å–ä¾èµ–åº“çš„ç»å¯¹è·¯å¾„å¹¶ä¸”è£…å…¥åˆ°å†…å­˜å½“ä¸­ï¼Œè¿™æ ·ç¨‹åºå°±ä¸ä¼šæŠ¥é”™äº†</strong></p><h4 id="å¦‚ä½•è§£å†³"><a href="#å¦‚ä½•è§£å†³" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å¦‚ä½•è§£å†³"></a> <strong>å¦‚ä½•è§£å†³</strong></h4><h5 id="dt_rpathæ®µæ— æ³•ä¿®æ”¹"><a href="#dt_rpathæ®µæ— æ³•ä¿®æ”¹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#dt_rpathæ®µæ— æ³•ä¿®æ”¹"></a> DT_RPATHæ®µæ— æ³•ä¿®æ”¹</h5><h5 id="é€šè¿‡åœ¨ç¯å¢ƒå˜é‡-ld_library_path-ä¸­è¿›è¡Œæ·»åŠ "><a href="#é€šè¿‡åœ¨ç¯å¢ƒå˜é‡-ld_library_path-ä¸­è¿›è¡Œæ·»åŠ " class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#é€šè¿‡åœ¨ç¯å¢ƒå˜é‡-ld_library_path-ä¸­è¿›è¡Œæ·»åŠ "></a> é€šè¿‡åœ¨ç¯å¢ƒå˜é‡ LD_LIBRARY_PATH ä¸­è¿›è¡Œæ·»åŠ </h5><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH = <span class="variable">$LD_LIBRARY_PATH</span>:/mnt/d/Code/Code-C++/æ·±å…¥å­¦ä¹ /Linuxæ–¹å‘/ç‰›å®¢ç½‘è¯¾ç¨‹/ç¬¬ä¸€ç« -Linuxå¼€å‘ç¯å¢ƒæ­å»º/04/library/lib</span><br></pre></td></tr></table></div></figure><p>exportå°±æ˜¯ä¿®æ”¹ç¯å¢ƒå˜é‡çš„æ„æ€ï¼Œ$è·å–åŸå…ˆçš„ç¯å¢ƒå˜é‡ï¼Œ:è¡¨ç¤ºåœ¨åé¢æ·»åŠ æ–°çš„ç»å¯¹è·¯å¾„ï¼Œè¿™é‡ŒæŠŠæˆ‘ä»¬çš„è·¯å¾„æ·»åŠ è¿›å»å°±å¥½äº†</p><p>æ·»åŠ å®Œä¹‹åå°±å¯ä»¥æ­£å¸¸è¿è¡Œäº†</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712212247869.png" alt="image-20230712212247869"></p><p><strong>ä½†æ˜¯æ³¨æ„ï¼šè¿™ä¸ªç¯å¢ƒå˜é‡çš„é…ç½®åªæ˜¯æš‚æ—¶çš„ï¼Œå½“ç»ˆç«¯å…³é—­ç¯å¢ƒå˜é‡ä¹Ÿå°±æ¶ˆå¤±äº†ï¼Œæ¯æ¬¡éœ€è¦é‡æ–°é…ç½®</strong></p><p>æ‰€ä»¥éœ€è¦æ°¸ä¹…çº§åˆ«çš„é…ç½®</p><ul><li>ç”¨æˆ·çº§åˆ«</li></ul><p><strong>é€šè¿‡ .bashrc æ¥è¿›è¡Œé…ç½®</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712212541900.png" alt="image-20230712212541900"></p><p>vim .bashrc è¿›å…¥å¹¶ä¿®æ”¹</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712212710023.png" alt="image-20230712212710023"></p><p>åœ¨é‡Œé¢æ·»åŠ ä¸€è¡Œè¡¨ç¤ºé…ç½®å¥½äº†</p><p><strong>å®Œäº‹ä¹‹åè¿›è¡Œæ›´æ–°ï¼Œä»¥ä½¿å…¶åº”ç”¨ç”Ÿæ•ˆ</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712212817883.png" alt="image-20230712212817883"></p><p>ä¹‹åä¹Ÿèƒ½æ­£å¸¸è¿è¡Œ</p><ul><li>ç³»ç»Ÿçº§åˆ«</li></ul><p>åœ¨è¿™ä¸ªæ–‡ä»¶( /etc/profile )å½“ä¸­è¿›è¡Œæ·»åŠ ï¼Œéœ€è¦sudoæƒé™</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712213659601.png" alt="image-20230712213659601"></p><p>åŒæ ·åŠ ä¸Šè¿™å¥è¯</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712213823973.png" alt="image-20230712213823973"></p><p>ç„¶åä¿å­˜æ›´æ–°</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712213917346.png" alt="image-20230712213917346"></p><p>ç„¶ååŒæ ·èƒ½æ­£å¸¸æ‰§è¡Œ</p><h5 id="ä¿®æ”¹-etcldsocathe-æ–‡ä»¶åˆ—è¡¨"><a href="#ä¿®æ”¹-etcldsocathe-æ–‡ä»¶åˆ—è¡¨" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä¿®æ”¹-etcldsocathe-æ–‡ä»¶åˆ—è¡¨"></a> ä¿®æ”¹ /etc/ld.so.cathe æ–‡ä»¶åˆ—è¡¨</h5><p>é€šè¿‡è¿™ä¸ªæ–‡ä»¶è¿›è¡Œé…ç½® /etc/ld.so.conf</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712214441428.png" alt="image-20230712214441428"></p><p>ç„¶åæŠŠè·¯å¾„æ”¾åˆ°è¿™ä¸ªæ–‡ä»¶é‡Œé¢å°±å¥½äº†</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712214549726.png" alt="image-20230712214549726"></p><p>ç„¶åè¿›è¡Œæ›´æ–°</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230712215334405.png" alt="image-20230712215334405"></p><p>ä¹Ÿèƒ½æ­£å¸¸è¿è¡Œ</p><h5 id="å°†åŠ¨æ€åº“æ–‡ä»¶æ”¾åˆ°-lib-æˆ–è€…-usrlib-ç›®å½•ä¸‹"><a href="#å°†åŠ¨æ€åº“æ–‡ä»¶æ”¾åˆ°-lib-æˆ–è€…-usrlib-ç›®å½•ä¸‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å°†åŠ¨æ€åº“æ–‡ä»¶æ”¾åˆ°-lib-æˆ–è€…-usrlib-ç›®å½•ä¸‹"></a> å°†åŠ¨æ€åº“æ–‡ä»¶æ”¾åˆ° /lib æˆ–è€… /usr/lib ç›®å½•ä¸‹</h5><p>ä¸å»ºè®®ä½¿ç”¨ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªç›®å½•ä¸­å·²ç»æ”¾äº†å¾ˆå¤šæ–‡ä»¶ï¼Œå†æ”¾å…¥æˆ‘ä»¬è‡ªå·±çš„æ–‡ä»¶ä¸åˆ©äºç®¡ç†ï¼Œå¹¶ä¸”ç”±äºå¯èƒ½æˆ‘ä»¬è‡ªå·±çš„æ–‡ä»¶å’Œç³»ç»Ÿæ–‡ä»¶é‡åï¼Œæœ‰å¯èƒ½é€ æˆæ›¿æ¢ç„¶åé€ æˆå‡ºé”™</p><h2 id="é™æ€åº“å’ŒåŠ¨æ€åº“çš„å¯¹æ¯”"><a href="#é™æ€åº“å’ŒåŠ¨æ€åº“çš„å¯¹æ¯”" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#é™æ€åº“å’ŒåŠ¨æ€åº“çš„å¯¹æ¯”"></a> é™æ€åº“å’ŒåŠ¨æ€åº“çš„å¯¹æ¯”</h2><h3 id="ç¨‹åºç¼–è¯‘æˆå¯æ‰§è¡Œç¨‹åºçš„è¿‡ç¨‹"><a href="#ç¨‹åºç¼–è¯‘æˆå¯æ‰§è¡Œç¨‹åºçš„è¿‡ç¨‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¨‹åºç¼–è¯‘æˆå¯æ‰§è¡Œç¨‹åºçš„è¿‡ç¨‹"></a> ç¨‹åºç¼–è¯‘æˆå¯æ‰§è¡Œç¨‹åºçš„è¿‡ç¨‹</h3><p><strong>é™æ€åº“å’ŒåŠ¨æ€åº“éƒ½æ˜¯åœ¨é“¾æ¥é˜¶æ®µèµ·ä½œç”¨</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713095340490.png" alt="image-20230713095340490"></p><h3 id="é™æ€åº“åˆ¶ä½œè¿‡ç¨‹"><a href="#é™æ€åº“åˆ¶ä½œè¿‡ç¨‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#é™æ€åº“åˆ¶ä½œè¿‡ç¨‹"></a> é™æ€åº“åˆ¶ä½œè¿‡ç¨‹</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713095639181.png" alt="image-20230713095639181"></p><h3 id="åŠ¨æ€åº“åˆ¶ä½œè¿‡ç¨‹"><a href="#åŠ¨æ€åº“åˆ¶ä½œè¿‡ç¨‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#åŠ¨æ€åº“åˆ¶ä½œè¿‡ç¨‹"></a> åŠ¨æ€åº“åˆ¶ä½œè¿‡ç¨‹</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713100533853.png" alt="image-20230713100533853"></p><h3 id="é™æ€åº“çš„ä¼˜ç¼ºç‚¹"><a href="#é™æ€åº“çš„ä¼˜ç¼ºç‚¹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#é™æ€åº“çš„ä¼˜ç¼ºç‚¹"></a> é™æ€åº“çš„ä¼˜ç¼ºç‚¹</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713100855560.png" alt="image-20230713100855560"></p><h3 id="åŠ¨æ€åº“çš„ä¼˜ç¼ºç‚¹"><a href="#åŠ¨æ€åº“çš„ä¼˜ç¼ºç‚¹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#åŠ¨æ€åº“çš„ä¼˜ç¼ºç‚¹"></a> åŠ¨æ€åº“çš„ä¼˜ç¼ºç‚¹</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713101528981.png" alt="image-20230713101528981"></p><h2 id="makefile"><a href="#makefile" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#makefile"></a> makefile</h2><h3 id="ä»€ä¹ˆæ˜¯makefile"><a href="#ä»€ä¹ˆæ˜¯makefile" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯makefile"></a> ä»€ä¹ˆæ˜¯makefile</h3><p><strong>ä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿è¿›è¡Œè‡ªåŠ¨åŒ–ç¼–è¯‘ï¼Œå› ä¸ºå®é™…çš„å¼€å‘è¿‡ç¨‹ä¸­ä»£ç çš„å­˜æ”¾ä½ç½®æ˜¯æœ‰è§„å®šçš„ï¼Œä¸ä¸€å®šéƒ½åœ¨åŒä¸€ä¸ªç›®å½•ï¼Œè¿™æ ·å°±å¯¼è‡´å¯èƒ½æ–‡ä»¶ä¾èµ–å‡ºé—®é¢˜ï¼Œæ‰¾ä¸åˆ°è¿™ç§ï¼Œè¿˜æœ‰å°±æ˜¯æŸä¸ªæ–‡ä»¶ä¾èµ–äºå¦ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™å°±éœ€è¦è¦æ±‚å“ªäº›æ–‡ä»¶éœ€è¦å…ˆç¼–è¯‘ï¼Œå“ªäº›æ–‡ä»¶åç¼–è¯‘ï¼Œè¿™æ ·å°±éœ€è¦ä¸€ä¸ªmakefileæ–‡ä»¶æ¥å…¨è‡ªåŠ¨åŒ–ç¼–è¯‘</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713102059928.png" alt="image-20230713102059928"></p><h3 id="å‘½åè§„åˆ™-3"><a href="#å‘½åè§„åˆ™-3" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å‘½åè§„åˆ™-3"></a> å‘½åè§„åˆ™</h3><p>æä¾›ä¸€ä¸ªæˆ–è€…å¤šä¸ªè§„åˆ™</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713103610886.png" alt="image-20230713103610886"></p><h3 id="ç®€å•æ¡ˆä¾‹"><a href="#ç®€å•æ¡ˆä¾‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç®€å•æ¡ˆä¾‹"></a> ç®€å•æ¡ˆä¾‹</h3><p>åˆ›å»ºMakefileæ–‡ä»¶</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713103811609.png" alt="image-20230713103811609"></p><p>ç¼–å†™</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713104023510.png" alt="image-20230713104023510"></p><p><strong>ç¬¬ä¸€è¡Œappï¼šç”Ÿæˆçš„ç›®æ ‡ï¼Œ: åé¢æ˜¯ç”Ÿæˆç›®æ ‡æ‰€éœ€è¦çš„ä¾èµ–æ–‡ä»¶</strong></p><p><strong>ç¬¬äºŒè¡Œ(éœ€è¦Tabç¼©è¿›)ï¼šé€šè¿‡æ‰§è¡Œè¯¥å‘½ä»¤ç”Ÿæˆç›®æ ‡</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713104408213.png" alt="image-20230713104408213"></p><h3 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å·¥ä½œåŸç†"></a> å·¥ä½œåŸç†</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713105602304.png" alt="image-20230713105602304"></p><p><strong>makefileå¯ä»¥æ£€æµ‹æ›´æ–°ï¼Œå°±æ˜¯æˆ‘æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™ï¼Œä¼šçœ‹ä¸Šæ¬¡ç›®æ ‡çš„ç”Ÿæˆæ—¶é—´å’Œç°åœ¨çš„ä¾èµ–æ–‡ä»¶çš„æ—¶å€™æ˜¯å¦åŒ¹é…ï¼Œä¸åŒ¹é…åˆ™æ›´æ–°äº†ï¼Œäºæ˜¯é‡æ–°æ‰§è¡Œç›¸å¯¹åº”çš„ä»£ç ç„¶åæ›´æ–°ç›®æ ‡æ–‡ä»¶</strong></p><p>ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713105556164.png" alt="image-20230713105556164"></p><p><strong>ç°åœ¨æˆ‘çš„ç›®æ ‡æ˜¯appæ–‡ä»¶ï¼Œç„¶åæˆ‘å†™çš„ä¾èµ–æ˜¯è¿™äº› .o æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ç¼–è¯‘äº†ä½†æœªé“¾æ¥çš„å¯æ‰§è¡Œæ–‡ä»¶</strong></p><p><strong>ç„¶åè¿™äº›æ–‡ä»¶æŒ‰ç†æ¥è¯´æ˜¯æ‰¾ä¸åˆ°çš„ï¼Œæ‰€ä»¥éœ€è¦åœ¨ä¸‹é¢ä½œä¸ºç›®æ ‡æ–‡ä»¶è¢«å·²æœ‰çš„ä¾èµ–æ¥è¿›è¡Œå‘½ä»¤ç”Ÿæˆ</strong></p><p>*<em>æœ€ä¸‹é¢çš„cleanæ˜¯makefileæ–‡ä»¶æœ€å¥½éƒ½æœ‰çš„ï¼Œæ¸…ç†ç¼–è¯‘è¿‡ç¨‹ä¸­ç”Ÿæˆçš„ <em>.o å’Œ app æ–‡ä»¶</em></em></p><p><strong>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼šå½“æŸä¸ªæºæ–‡ä»¶è¿›è¡Œä¿®æ”¹ä¹‹åï¼Œåœ¨æ‰§è¡Œmakeå‘½ä»¤çš„æ—¶å€™ï¼Œå…¶ä»–çš„æ–‡ä»¶ä¸ç”¨é‡æ–°ç¼–è¯‘ï¼Œæé«˜äº†æ•ˆç‡</strong></p><h3 id="å˜é‡"><a href="#å˜é‡" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å˜é‡"></a> å˜é‡</h3><p><strong>è‡ªåŠ¨å˜é‡åªèƒ½åœ¨è§„åˆ™çš„å‘½ä»¤å½“ä¸­ä½¿ç”¨!!!</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713113345866.png" alt="image-20230713113345866"></p><h3 id="æ¨¡å¼åŒ¹é…"><a href="#æ¨¡å¼åŒ¹é…" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ¨¡å¼åŒ¹é…"></a> æ¨¡å¼åŒ¹é…</h3><p><strong>æŠŠä¸€äº›æ ¼å¼å·®ä¸å¤šçš„è§„åˆ™ç”¨é€šå¼å†™å‡ºæ¥</strong>!</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713113808672.png" alt="image-20230713113808672"></p><h3 id="å‡½æ•°"><a href="#å‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å‡½æ•°"></a> å‡½æ•°</h3><p><strong>wildcardè¿™ä¸ªå‡½æ•°åªèƒ½ç”¨æ¥è·å– .c æ–‡ä»¶</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713132533052.png" alt="image-20230713132533052"></p><p><strong>ç”¨patsubst æ¥å°† .c æ–‡ä»¶æ›¿æ¢ä¸º .oæ–‡ä»¶</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713132756923.png" alt="image-20230713132756923"></p><p>ä¸¾ä¾‹ï¼šè¿™æ ·å°±å¯ä»¥æŠŠä¸Šé¢çš„ä¾‹å­ä¼˜åŒ–æˆè¿™æ ·</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713133926048.png" alt="image-20230713133926048" style="zoom:80%"><p>é‡åˆ°c++å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713140259470.png" alt="image-20230713140259470" style="zoom:80%"><p><strong>æ³¨æ„ï¼špatsubsté‡Œé¢å‡ ä¸ªé€—å·ä¹‹é—´ä¸èƒ½ç”¨ç©ºæ ¼!!!(å¦åˆ™å‡ºé”™)</strong></p><h2 id="gdbè°ƒè¯•"><a href="#gdbè°ƒè¯•" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#gdbè°ƒè¯•"></a> GDBè°ƒè¯•</h2><h3 id="ä»€ä¹ˆæ˜¯gdb"><a href="#ä»€ä¹ˆæ˜¯gdb" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯gdb"></a> ä»€ä¹ˆæ˜¯GDB</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713140857081.png" alt="image-20230713140857081"></p><h3 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å‡†å¤‡å·¥ä½œ"></a> å‡†å¤‡å·¥ä½œ</h3><p><strong>gdbæ˜¯è°ƒè¯•å¯æ‰§è¡Œç¨‹åºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆç¼–è¯‘æ–‡ä»¶æˆä¸ºä¸€ä¸ªå¯æ‰§è¡Œç¨‹åº</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713141622040.png" alt="image-20230713141622040"></p><p>ç¤ºä¾‹</p><p><strong>-g ä¿è¯äº†gdbèƒ½æ‰¾åˆ°æºæ–‡ä»¶</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713143121240.png" alt="image-20230713143121240"></p><h3 id="gdbå‘½ä»¤"><a href="#gdbå‘½ä»¤" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#gdbå‘½ä»¤"></a> GDBå‘½ä»¤</h3><p><strong>gdb å¯åŠ¨çš„æ˜¯å¯æ‰§è¡Œç¨‹åº!!!</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713142329930.png" alt="image-20230713142329930"></p><p>ç¤ºä¾‹ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713143240623.png" alt="image-20230713143240623"></p><h4 id="æŸ¥çœ‹-list"><a href="#æŸ¥çœ‹-list" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æŸ¥çœ‹-list"></a> æŸ¥çœ‹ list</h4><p><strong>listå‘½ä»¤</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713143813271.png" alt="image-20230713143813271"></p><p><strong>æŸ¥çœ‹åˆ«çš„æ–‡ä»¶</strong></p><p>å…ˆæŠŠè¿™ä¸‰ä¸ªcppæ–‡ä»¶ç¼–è¯‘è¿æ¥æˆä¸ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼ŒåŠ ä¸Š-g -Wall</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713144716128.png" alt="image-20230713144716128"></p><p>è¿›å…¥gdbï¼Œé»˜è®¤æŸ¥çœ‹çš„æ˜¯main.cppï¼Œç°åœ¨æˆ‘çœ‹bubble.cpp</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713144828842.png" alt="image-20230713144828842"></p><h4 id="æ–­ç‚¹æ“ä½œ-break"><a href="#æ–­ç‚¹æ“ä½œ-break" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ–­ç‚¹æ“ä½œ-break"></a> æ–­ç‚¹æ“ä½œ break</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713150206430.png" alt="image-20230713150206430"></p><p><strong>ç¤ºä¾‹ï¼š</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713150556682.png" alt="image-20230713150556682"></p><p><strong>åœ¨å…¶ä»–æ–‡ä»¶æ‰“æ–­ç‚¹</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713150932690.png" alt="image-20230713150932690"></p><p><strong>è®¾ç½®æ–­ç‚¹æ— æ•ˆæˆ–è€…æœ‰æ•ˆ</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713151406288.png" alt="image-20230713151406288"></p><p><strong>è®¾ç½®æ¡ä»¶æ–­ç‚¹(ä¸€èˆ¬ç”¨åœ¨å¾ªç¯çš„ä½ç½®)</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713151623439.png" alt="image-20230713151623439"></p><h4 id="è°ƒè¯•å‘½ä»¤"><a href="#è°ƒè¯•å‘½ä»¤" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è°ƒè¯•å‘½ä»¤"></a> è°ƒè¯•å‘½ä»¤</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713152020106.png" alt="image-20230713152020106"></p><p>ç¤ºä¾‹ï¼š</p><p>start</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713152439462.png" alt="image-20230713152439462"></p><p>runï¼Œnextï¼Œstep</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713153024581.png" alt="image-20230713153024581"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713153323313.png" alt="image-20230713153323313"></p><p><strong>nextä¸ä¼šè¿›å…¥å‡½æ•°ä½“ï¼Œstepä¼šè¿›å…¥å‡½æ•°ä½“</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713153540431.png" alt="image-20230713153540431"></p><p><strong>è‡ªåŠ¨å˜é‡æ“ä½œ</strong></p><p><strong>è¿™æ ·æ¯æ¬¡æ‰§è¡Œä»£ç éƒ½å¯ä»¥æ‰“å°å˜é‡çš„å€¼</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230713154539740.png" alt="image-20230713154539740"></p><h2 id="æ–‡ä»¶io"><a href="#æ–‡ä»¶io" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ–‡ä»¶io"></a> æ–‡ä»¶IO</h2><h3 id="æ ‡å‡†cåº“ioå‡½æ•°"><a href="#æ ‡å‡†cåº“ioå‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ ‡å‡†cåº“ioå‡½æ•°"></a> æ ‡å‡†Cåº“IOå‡½æ•°</h3><p><strong>ä½¿ç”¨æ ‡å‡†Cåº“çš„IOå‡½æ•°å¼€å‘çš„ç¨‹åºåœ¨ä»»æ„å¹³å°ä¸Šéƒ½å¯ä»¥è¿è¡Œ</strong></p><p><strong>æ ‡å‡†Cåº“çš„IOå‡½æ•°çš„æ•ˆç‡æ›´é«˜ï¼Œå› ä¸ºå½“ä¸­å¸¦æœ‰ç¼“å†²åŒº(è®¾ç½®åœ¨å†…å­˜å½“ä¸­)</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230714100055222.png" alt="image-20230714100055222"></p><p>æ ‡å‡†Cåº“çš„IOå’ŒLinuxç³»ç»ŸIOçš„å…³ç³»</p><p><strong>è°ƒç”¨è¿™ä¸¤ä¸ªæ ‡å‡†Cåº“IOå‡½æ•°çš„æ—¶å€™ï¼Œä¼šè®©æ•°æ®è¿›å…¥è®¾ç½®åœ¨å†…å­˜å½“ä¸­çš„ç¼“å†²åŒºIO bufferï¼Œç„¶åé€šè¿‡ç³»ç»Ÿæä¾›çš„APIä¾‹å¦‚writeå’Œreadæ¥è¿›è¡Œå†…å­˜åˆ°ç£ç›˜çš„è¯»å†™æ“ä½œï¼›å¦‚æœç›´æ¥ä½¿ç”¨Linuxç³»ç»ŸIOå‡½æ•°ï¼Œåˆ™ä¸ä¼šç»è¿‡å†…å­˜ä¸­çš„ç¼“å†²åŒº</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230714101445015.png" alt="image-20230714101445015"></p><h3 id="è™šæ‹Ÿåœ°å€ç©ºé—´"><a href="#è™šæ‹Ÿåœ°å€ç©ºé—´" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è™šæ‹Ÿåœ°å€ç©ºé—´"></a> è™šæ‹Ÿåœ°å€ç©ºé—´</h3><p><strong>å †ç©ºé—´æ˜¯ä»ä¸‹å¾€ä¸Šå­˜ï¼Œä¹Ÿå°±æ˜¯ä½åœ°å€åˆ°é«˜åœ°å€ï¼›</strong></p><p><strong>æ ˆç©ºé—´æ˜¯ä»ä¸Šå¾€ä¸‹æ‘ï¼Œä¹Ÿå°±æ˜¯é«˜åœ°å€åˆ°ä½åœ°å€</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230714102646385.png" alt="image-20230714102646385"></p><h3 id="æ–‡ä»¶æè¿°ç¬¦"><a href="#æ–‡ä»¶æè¿°ç¬¦" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ–‡ä»¶æè¿°ç¬¦"></a> æ–‡ä»¶æè¿°ç¬¦</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230714105536343.png" alt="image-20230714105536343"></p><h3 id="linuxç³»ç»Ÿioå‡½æ•°"><a href="#linuxç³»ç»Ÿioå‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#linuxç³»ç»Ÿioå‡½æ•°"></a> Linuxç³»ç»ŸIOå‡½æ•°</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230714110840838.png" alt="image-20230714110840838"></p><h3 id="openå‡½æ•°"><a href="#openå‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#openå‡½æ•°"></a> openå‡½æ•°</h3><p>ä¸¤ç§å½¢å¼</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰“å¼€ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ–‡ä»¶</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">open</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *pathname, <span class="type">int</span> flags)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">open</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *pathname, <span class="type">int</span> flags, <span class="type">mode_t</span> mode)</span></span>;</span><br></pre></td></tr></table></div></figure><h4 id="openå‡½æ•°æ‰“å¼€æ–‡ä»¶"><a href="#openå‡½æ•°æ‰“å¼€æ–‡ä»¶" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#openå‡½æ•°æ‰“å¼€æ–‡ä»¶"></a> openå‡½æ•°æ‰“å¼€æ–‡ä»¶</h4><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">open</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* pathname, <span class="type">int</span> flags)</span></span>;</span><br></pre></td></tr></table></div></figure><p>å‚æ•°è§£é‡Š</p><ul><li>pathnameï¼šæ–‡ä»¶è·¯å¾„</li><li>flagsï¼šå¯¹æ–‡ä»¶çš„æ“ä½œæƒé™è®¾ç½®ï¼Œè¿˜æœ‰å…¶ä»–çš„è®¾ç½®ï¼Œä¾‹å¦‚ï¼šO_RDONLYï¼ŒO_WRONLYï¼ŒO_RDWR è¿™ä¸‰ä¸ªè®¾ç½®æ˜¯äº’æ–¥çš„</li><li>è¿”å›å€¼ï¼šè¿”å›ä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦(intç±»å‹ï¼Œç±»ä¼¼äºç¼–å·)ï¼Œå¦‚æœå¤±è´¥ï¼Œè¿”å›-1</li></ul><p>å…³äºé”™è¯¯errno</p><p><strong>å½“æ‰“å¼€æ–‡ä»¶é”™è¯¯çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†é”™è¯¯å·èµ‹å€¼ç»™errno</strong></p><p>errnoå±äºlinuxç³»ç»Ÿå‡½æ•°åº“ï¼Œåº“é‡Œé¢ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œè®°å½•é”™è¯¯å·ï¼Œè®°å½•çš„æ˜¯æœ€è¿‘çš„é”™è¯¯å·</p><p>æ¯”å¦‚è¿™é‡Œopenå‡½æ•°å¤±è´¥äº†ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠŠé”™è¯¯å·èµ‹å€¼ç»™errno</p><p>å¦‚ä½•æ‰“å°é”™è¯¯ä¿¡æ¯ï¼Ÿperror()</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">perror</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *s)</span></span>;</span><br></pre></td></tr></table></div></figure><p>æ‰“å°errorå¯¹åº”çš„é”™è¯¯æè¿°</p><p>så‚æ•°ï¼šç”¨æˆ·æè¿°ï¼Œæ¯”å¦‚helloï¼Œæœ€ç»ˆè¾“å‡ºçš„å†…å®¹æ˜¯ hello:xxx(å®é™…çš„é”™è¯¯æè¿°)</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230714113744182.png" alt="image-20230714113744182"></p><p>ä»£ç ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨linuxç³»ç»ŸIO open()å‡½æ•°çš„å¤´æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span>  <span class="comment">//å‡½æ•°çš„å£°æ˜æ–‡ä»¶</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ close()å‡½æ•°å¤´æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ‰“å¼€</span></span><br><span class="line">    <span class="type">int</span> fd = <span class="built_in">open</span>(<span class="string">&quot;a.txt&quot;</span>, O_RDONLY);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (fd == <span class="number">-1</span>)  <span class="comment">// è°ƒç”¨é”™è¯¯</span></span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;open&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­</span></span><br><span class="line">    <span class="built_in">close</span>(fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>å…³é—­å‡½æ•°</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">close</span><span class="params">(<span class="type">int</span> fd)</span></span>;<span class="comment">//  fdï¼šæ–‡ä»¶æè¿°ç¬¦ fd</span></span><br></pre></td></tr></table></div></figure><h4 id="openå‡½æ•°åˆ›å»ºæ–°æ–‡ä»¶"><a href="#openå‡½æ•°åˆ›å»ºæ–°æ–‡ä»¶" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#openå‡½æ•°åˆ›å»ºæ–°æ–‡ä»¶"></a> openå‡½æ•°åˆ›å»ºæ–°æ–‡ä»¶</h4><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">open</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *pathname, <span class="type">int</span> flags, <span class="type">mode_t</span> mode)</span></span>;</span><br></pre></td></tr></table></div></figure><p>å‚æ•°è§£é‡Šï¼š</p><ul><li><p>pathnameï¼šåˆ›å»ºçš„æ–‡ä»¶è·¯å¾„</p></li><li><p>flagsï¼šå¯¹æ–‡ä»¶çš„æ“ä½œæƒé™å’Œå…¶ä»–çš„è®¾ç½®<br><strong>å¿…é€‰é¡¹ï¼šO_RDONLY, O_WRONLY, or O_RDWR è¿™ä¸‰ä¸ªä¹‹é—´æ˜¯äº’æ–¥çš„</strong><br><strong>å¯é€‰é¡¹ï¼šO_CREAT æ–‡ä»¶ä¸å­˜åœ¨åˆ›å»ºæ–°æ–‡ä»¶ï¼›O_APPEND å¯ä»¥è¿›è¡Œæ–‡ä»¶çš„è¿½åŠ </strong><br><strong>flagså‚æ•°æ˜¯ä¸€ä¸ªintç±»å‹çš„æ•°æ®ï¼Œå 4ä¸ªå­—èŠ‚ï¼Œ32ä½ï¼Œæ¯ä¸€ä½å°±æ˜¯ä¸€ä¸ªæ ‡å¿—ä½ï¼Œ1è¡¨ç¤ºæœ‰ï¼Œ0è¡¨ç¤ºæ²¡æœ‰ï¼Œæ‰€ä»¥ç”¨æŒ‰ä½æˆ–</strong></p></li><li><p>modeï¼šå…«è¿›åˆ¶çš„æ•°ï¼Œè¡¨ç¤ºç”¨æˆ·å¯¹åˆ›å»ºå‡ºçš„æ–°çš„æ–‡ä»¶çš„æ“ä½œæƒé™ï¼Œæ¯”å¦‚ï¼š0777<br><strong>3ä¸ª7åˆ†åˆ«è¡¨ç¤ºå¯¹ä¸åŒçš„ç”¨æˆ·(æ‰€æœ‰è€…ï¼Œç»„æˆå‘˜ï¼Œå…¶ä»–ç”¨æˆ·çš„æƒé™)çš„æƒé™ï¼Œæ¯ä¸€ä¸ªéƒ½æ˜¯3ä½ ï¼Œç¬¬ä¸€ä½è¡¨ç¤ºè¯»Rï¼Œç¬¬äºŒä½è¡¨ç¤ºå†™Wï¼Œç¬¬ä¸‰ä½ è¡¨ç¤ºå¯æ‰§è¡ŒXï¼Œ7å¯¹åº”å°±æ˜¯111å…¨æœ‰!!!</strong></p><p><strong>æœ€ç»ˆçš„æƒé™æ˜¯ï¼šmode &amp; ~umask</strong><br>umaskå¯ä»¥é€šè¿‡shellå‘½ä»¤ umask æŸ¥çœ‹<br>umaskçš„ä½œç”¨æ˜¯ä¸ºäº†æŠ¹å»æŸäº›æƒé™ï¼Œè®©æˆ‘ä»¬åˆ›å»ºçš„æƒé™æ›´åŠ åˆç†ä¸€äº›<br>ä¾‹å­ï¼š0777 &amp; ~0022</p></li></ul><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="type">int</span> fd = <span class="built_in">open</span>(<span class="string">&quot;1.txt&quot;</span>, O_RDWR | O_CREAT, <span class="number">0777</span>);  <span class="comment">// æ ‡ç­¾ä¹‹é—´è¦ç”¨æŒ‰ä½æˆ–</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (fd == <span class="number">-1</span>)</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;create&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">close</span>(fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p><strong>ç”¨shellå‘½ä»¤ ll æ¥æŸ¥çœ‹æ–‡ä»¶çš„æƒé™</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230714134141808.png" alt="image-20230714134141808"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230714134158964.png" alt="image-20230714134158964"></p><h3 id="readwriteå‡½æ•°"><a href="#readwriteå‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#readwriteå‡½æ•°"></a> read,writeå‡½æ•°</h3><p>å¤´æ–‡ä»¶ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br></pre></td></tr></table></div></figure><p>ä¸¤ä¸ªå‡½æ•°ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">ssize_t</span> <span class="title">read</span><span class="params">(<span class="type">int</span> fd, <span class="type">void</span> *buf, <span class="type">size_t</span> count)</span></span>;</span><br></pre></td></tr></table></div></figure><ul><li><p>å‚æ•°ï¼š</p><ul><li>fdï¼šæ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡openå¾—åˆ°çš„ï¼Œé€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ“ä½œæŸä¸ªæ–‡ä»¶</li><li>bufï¼šç¼“å†²åŒºï¼Œéœ€è¦è¯»å–æ•°æ®å­˜æ”¾çš„åœ°æ–¹ï¼Œæ•°ç»„çš„åœ°æ–¹(ä¼ å‡ºå‚æ•°)</li><li>countï¼šæŒ‡å®šçš„æ•°ç»„çš„å¤§å°</li></ul></li><li><p>è¿”å›å€¼ï¼š</p><ul><li><p>æˆåŠŸ &gt;0 è¿”å›å®é™…è¯»å–åˆ°çš„å­—èŠ‚æ•°</p><pre><code>	**==0 æ–‡ä»¶å·²ç»è¯»å–å®Œäº†(æ³¨æ„æ˜¯åœ¨è°ƒç”¨readå‡½æ•°ä¹‹å‰æ–‡ä»¶æŒ‡é’ˆå°±åœ¨æœ«å°¾äº†æ‰ä¼šè¿”å›0ï¼Œä¸€æ¬¡æ€§ä»å¤´è¯»å®Œæ˜¯ä¼šè¿”å›è¯»å–çš„å­—èŠ‚æ•°çš„)**
</code></pre></li><li><p>å¤±è´¥ -1 å¹¶ä¸”ä¿®æ”¹errno</p></li></ul></li></ul><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">ssize_t</span> <span class="title">write</span><span class="params">(<span class="type">int</span> fd, <span class="type">const</span> <span class="type">void</span> *buf, <span class="type">size_t</span> count)</span></span>;</span><br></pre></td></tr></table></div></figure><ul><li><p>å‚æ•°ï¼š</p><ul><li>fdï¼šæ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡openå¾—åˆ°ï¼Œé€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ“ä½œæŸä¸ªæ–‡ä»¶</li><li>bufï¼šè¦å¾€ç£ç›˜å†™å…¥çš„æ•°æ®</li><li>countï¼šè¦å†™å…¥çš„å®é™…çš„å¤§å°</li></ul></li><li><p>è¿”å›å€¼ï¼š</p><ul><li>æˆåŠŸ &gt;0 è¿”å›å®é™…å†™å…¥çš„å­—èŠ‚æ•°<br>==0 æ–‡ä»¶å·²ç»å†™å…¥å®Œäº†</li><li>å¤±è´¥ -1 å¹¶ä¸”ä¿®æ”¹errno</li></ul></li></ul><p>ä»£ç ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SIZE 1024</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// é€šè¿‡openæ‰“å¼€english.txtæ–‡ä»¶</span></span><br><span class="line">    <span class="type">int</span> fd_src = <span class="built_in">open</span>(<span class="string">&quot;english.txt&quot;</span>, O_RDONLY);</span><br><span class="line">    <span class="keyword">if</span> (fd_src == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºæ–°çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="type">int</span> fd_dest = <span class="built_in">open</span>(<span class="string">&quot;cpy.txt&quot;</span>, O_WRONLY | O_CREAT | O_APPEND, <span class="number">0777</span>);</span><br><span class="line">    <span class="keyword">if</span> (fd_dest == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;create&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é¢‘ç¹çš„è¯»å†™æ“ä½œ</span></span><br><span class="line">    <span class="type">char</span> buf[SIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ((len = <span class="built_in">read</span>(fd_src, buf, <span class="built_in">sizeof</span>(buf))) &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="comment">// åœ¨å¾ªç¯çš„æ¡ä»¶ä¸­è¿›è¡Œè¯»æ“ä½œï¼Œåœ¨å¾ªç¯ä½“ä¸­è¿›è¡Œå†™å…¥</span></span><br><span class="line">        <span class="built_in">write</span>(fd_dest, buf, len);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­æ–‡ä»¶</span></span><br><span class="line">    <span class="built_in">close</span>(fd_src);</span><br><span class="line">    <span class="built_in">close</span>(fd_dest);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="lseekå‡½æ•°"><a href="#lseekå‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#lseekå‡½æ•°"></a> lseekå‡½æ•°</h3><p>åœ¨æ ‡å‡†Cåº“é‡Œé¢ä¹Ÿæœ‰ä¸€ä¸ªéå¸¸ç›¸ä¼¼çš„å‡½æ•°fseek()ï¼Œæˆ‘ç”šè‡³æ€€ç–‘åœ¨linuxå¹³å°ä¸‹ä»–çš„åº•å±‚æ˜¯ä¸æ˜¯è°ƒç”¨çš„æ˜¯fseek()</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ ‡å‡†Cåº“çš„å‡½æ•°</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">fseek</span><span class="params">(FILE *stream, <span class="type">long</span> offset, <span class="type">int</span> whence)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Linuxç³»ç»Ÿå‡½æ•°</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">off_t</span> <span class="title">lseek</span><span class="params">(<span class="type">int</span> fd, <span class="type">off_t</span> offset, <span class="type">int</span> whence)</span></span>;</span><br></pre></td></tr></table></div></figure><ul><li><p>å‚æ•°ï¼š</p><ul><li><p>fdï¼šæ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡openå¾—åˆ°ï¼Œé€šè¿‡è¿™ä¸ªfdæ“ä½œæŸä¸ªæ–‡ä»¶</p></li><li><p>offsetï¼šoff_t(longåˆ«å) åç§»é‡</p></li><li><p>whenceï¼š</p><pre><code> \- SEEK_SET è®¾ç½®æ–‡ä»¶æŒ‡é’ˆçš„åç§»é‡ï¼Œä»å¤´å¼€å§‹

- SEEK_CUR è®¾ç½®åç§»é‡ï¼šå½“å‰ä½ç½® + ç¬¬äºŒå‚æ•°offsetçš„å€¼
	
 	- SEEK_END è®¾ç½®åç§»é‡ï¼šæ–‡ä»¶å¤§å° + ç¬¬äºŒå‚æ•°offsetçš„å€¼
</code></pre></li></ul></li><li><p>è¿”å›å€¼ï¼šè¿”å›æ–‡ä»¶æŒ‡é’ˆè®¾ç½®ä¹‹åçš„ä½ç½®</p></li><li><p>ä½œç”¨ï¼š</p><p>1.ç§»åŠ¨æ–‡ä»¶æŒ‡é’ˆåˆ°å¤´éƒ¨ lseek(fd,0,SEEK_SET);</p><p>2.è·å–å½“å‰æ–‡ä»¶æŒ‡é’ˆçš„ä½ç½® lseek(fd,0,SEEK_CUR);</p><p>3.è·å–æ–‡ä»¶é•¿åº¦ lseek(fd,0,SEEK_END);</p><p>4.æ‹“å±•æ–‡ä»¶çš„é•¿åº¦ï¼Œå½“å‰æ–‡ä»¶10Bï¼Œå¢åŠ 100Bï¼Œå¢åŠ äº†100ä¸ªå­—èŠ‚ lseek(fd,100,SEEK_END);</p><p><strong>ä¸ºä»€ä¹ˆèƒ½æ‰©å±•ï¼Ÿ</strong></p><p><strong>å› ä¸ºæˆ‘ä»¬æŠŠæ–‡ä»¶æŒ‡é’ˆç§»åŠ¨åˆ°äº†æœ¬æ¥ä¸å±äºæ–‡ä»¶çš„ä½ç½®ä¸Šå»ï¼Œç³»ç»Ÿå°±è¿›è¡Œäº†æ‰©å±•ï¼Œ</strong></p><p><strong>ä¸è¿‡ä¸€å®šè¦ä¸€æ¬¡å†™çš„æ“ä½œã€‚è¿…é›·ç­‰ä¸‹è½½å·¥å…·åœ¨ä¸‹è½½æ–‡ä»¶æ—¶å€™å…ˆæ‰©å±•ä¸€ä¸ªç©ºé—´ï¼Œç„¶åå†ä¸‹è½½çš„ã€‚</strong></p></li></ul><p>ä»£ç ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> fd = <span class="built_in">open</span>(<span class="string">&quot;hello.txt&quot;</span>, O_RDWR);</span><br><span class="line">    <span class="keyword">if</span> (fd == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">lseek</span>(fd, <span class="number">100</span>, SEEK_END);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;lseek&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†™å…¥ä¸€ä¸ªç©ºæ•°æ®</span></span><br><span class="line">    <span class="built_in">write</span>(fd, <span class="string">&quot; &quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">close</span>(fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="statlstatå‡½æ•°"><a href="#statlstatå‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#statlstatå‡½æ•°"></a> stat,lstatå‡½æ•°</h3><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">stat</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *pathname, <span class="keyword">struct</span> stat *statbuf)</span></span>;</span><br><span class="line"><span class="comment">//ä½œç”¨ï¼šè·å–ä¸€ä¸ªæ–‡ä»¶çš„ç›¸å…³çš„ä¿¡æ¯</span></span><br><span class="line"><span class="comment">//å‚æ•°ï¼š</span></span><br><span class="line">    <span class="comment">//pathnameï¼šæ“ä½œçš„æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">    <span class="comment">//statbufï¼šç»“æ„ä½“å˜é‡ï¼Œä¼ å‡ºå‚æ•°ï¼Œç”¨äºä¿å­˜è·å–åˆ°çš„æ–‡ä»¶ä¿¡æ¯</span></span><br><span class="line"><span class="comment">//è¿”å›å€¼ï¼š</span></span><br><span class="line">    <span class="comment">//æˆåŠŸ 0</span></span><br><span class="line">    <span class="comment">//å¤±è´¥ -1ï¼Œå¹¶ä¸”ä¿®æ”¹errno</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">lstat</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *pathname, <span class="keyword">struct</span> stat *statbuf)</span></span>;</span><br><span class="line"><span class="comment">//å‚æ•°ï¼Œè¿”å›å€¼åŒä¸Š</span></span><br></pre></td></tr></table></div></figure><p>é‡Œé¢æœ‰ä¸€ä¸ªstatç»“æ„ä½“å˜é‡ï¼Œä»–çš„ç»“æ„å¦‚ä¸‹ï¼š</p><h4 id="statç»“æ„ä½“"><a href="#statç»“æ„ä½“" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#statç»“æ„ä½“"></a> statç»“æ„ä½“(!!!)</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230714152755154.png" alt="image-20230714152755154"></p><p>æ¯”è¾ƒé‡è¦çš„æ˜¯mode_tç±»å‹çš„ st_modeå˜é‡ï¼š<strong>å°±æ˜¯ä¸‹é¢çš„16ä½æ•°(01)</strong></p><p><strong>ä¹‹å‰åˆ›å»ºæ–‡ä»¶openå‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¹Ÿæ˜¯è¿™ä¸ªç±»å‹ï¼Œåªä¸è¿‡é‡Œé¢åªç”¨äº†User,Group,Othersè¿™ä¸‰ä¸ª</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230714153204023.png" alt="image-20230714153204023"></p><p><strong>åˆ¤æ–­åé¢æŸä¸€ä½æ˜¯å¦ä¸º1ï¼Œä¹Ÿå°±æ˜¯æ¯”å¦‚Useræ˜¯å¦å…·æœ‰ræƒé™ï¼Œå°±ç”¨st_modeå˜é‡(ä»–å°±æ˜¯è¿™16ä½æ•°)ä¸å…¶ç›¸ä¸</strong></p><p><strong>åˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼šç”±äºæ–‡ä»¶ç±»å‹åœ¨å‰å››ä½å½“ä¸­å¯èƒ½ä¸æ­¢ä¸€ä½ä¸º1ï¼Œé‚£ä¹ˆè”ç³»è®¡ç½‘ï¼Œä¸æ©ç ç›¸ä¸çœ‹æ˜¯ä¸æ˜¯å’Œè¿™ä¸ªæ ‡è¯†ç›¸åŒå°±çŸ¥é“äº†!!!</strong></p><h4 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#åŒºåˆ«"></a> åŒºåˆ«</h4><p>è½¯é“¾æ¥æ–‡ä»¶</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230714154550861.png" alt="image-20230714154550861"></p><p><strong>å°±æ˜¯è¯´ 2.txt æ˜¯æŒ‡å‘ 1.txt æ–‡ä»¶çš„!!!ä½†æ˜¯å®ƒæœ¬èº«çš„å¤§å°æ˜¯5ä¸ªå­—èŠ‚</strong></p><p><strong>lstat()å°±æ˜¯ç”¨æ¥è·å–è¯¥è½¯é“¾æ¥æ–‡ä»¶æœ¬èº«çš„ä¿¡æ¯çš„ï¼Œè€Œä¸æ˜¯è·å–ä»–æŒ‡å‘çš„æ–‡ä»¶çš„ä¿¡æ¯ï¼Œå¦‚æœç”¨stat()å‡½æ•°å°±ä¼šè·å¾—æŒ‡å‘çš„æ–‡ä»¶ï¼Œè¿™é‡Œå°±æ˜¯1.txtçš„ä¿¡æ¯</strong></p><p>ä»£ç ï¼š</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">stat</span> statbuf;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">stat</span>(<span class="string">&quot;1.txt&quot;</span>, &amp;statbuf);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;stat&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;size: &quot;</span> &lt;&lt; statbuf.st_size &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    ret = <span class="built_in">stat</span>(<span class="string">&quot;2.txt&quot;</span>, &amp;statbuf);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;stat&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;size: &quot;</span> &lt;&lt; statbuf.st_size &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    ret = <span class="built_in">lstat</span>(<span class="string">&quot;2.txt&quot;</span>, &amp;statbuf);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;stat&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;size: &quot;</span> &lt;&lt; statbuf.st_size &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p><strong>åœ¨shellç»ˆç«¯ä¸­å¯ä»¥ç”¨ stat å‘½ä»¤æ¥è·å–æ–‡ä»¶çš„ä¿¡æ¯ï¼Œè¿™é‡Œçš„æ–‡ä»¶ä¿¡æ¯å°±æ˜¯æœ¬æ–‡ä»¶äº†ï¼Œå°±ä¸æ˜¯è½¯é“¾æ¥æ–‡ä»¶çš„æŒ‡å‘æ–‡ä»¶</strong></p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230714154900243.png" alt="image-20230714154900243"><h3 id="æ¨¡æ‹Ÿå®ç°ls-l-å‘½ä»¤"><a href="#æ¨¡æ‹Ÿå®ç°ls-l-å‘½ä»¤" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ¨¡æ‹Ÿå®ç°ls-l-å‘½ä»¤"></a> æ¨¡æ‹Ÿå®ç°ls -l å‘½ä»¤</h3><p><strong>é‡Œé¢æœ‰å¾ˆå¤šåº“å‡½æ•°çš„è°ƒç”¨ï¼Œè¿™äº›å¤§æ¦‚çŸ¥é“å°±è¡Œï¼Œå¼€å‘çš„æ—¶å€™å»æŸ¥æ–‡æ¡£å°±å¥½äº†</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230715104004715.png" alt="image-20230715104004715"></p><p>ç¬¬ä¸€ä¸ªå­—ç¬¦( â€™-â€˜ )æ˜¯æ–‡ä»¶ç±»å‹ï¼Œåé¢ä¸€å †rwxæ˜¯è¯»å†™æƒé™</p><p>åé¢ 1 æ˜¯ç¡¬è¿æ¥æ•°é‡</p><p>åœ¨åé¢ä¸¤ä¸ªæ˜¯æ–‡ä»¶æ‰€æœ‰è€…å’Œæ–‡ä»¶æ‰€åœ¨ç»„</p><p>ç„¶åæ˜¯æ–‡ä»¶å¤§å°</p><p>ç„¶åæ˜¯ä¸Šä¸€æ¬¡çš„ä¿®æ”¹æ—¶é—´</p><p>æœ€åå°±è·Ÿç€æ–‡ä»¶çš„åç§°</p><p>ä»£ç ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;grp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pwd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXSIZE 1024</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿå®ç° ls -l è¿™ä¸ªæŒ‡ä»¤</span></span><br><span class="line"><span class="comment">// -rwxrwxrwx 1 lzx0626 lzx0626 107 Jul 15 09:40 ls-l.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> <span class="type">const</span> *argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (argc &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;usage: &quot;</span> &lt;&lt; argv[<span class="number">0</span>] &lt;&lt; <span class="string">&quot; &lt;filename&gt;&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">stat</span> statbuf;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡stat()å‡½æ•°è·å–æ–‡ä»¶çš„ä¿¡æ¯</span></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">stat</span>(argv[<span class="number">1</span>], &amp;statbuf);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;stat&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–æ–‡ä»¶ç±»å‹å’Œæ–‡ä»¶æƒé™ st_modeå˜é‡</span></span><br><span class="line">    string perms;  <span class="comment">// ä¿å­˜æ–‡ä»¶ç±»å‹å’Œæƒé™çš„å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="type">mode_t</span> _mode = statbuf.st_mode;</span><br><span class="line">    <span class="comment">// è·å¾—æ–‡ä»¶ç±»å‹å’Œæ©ç  -S_IFMT ç›¸ä¸</span></span><br><span class="line">    <span class="keyword">switch</span> (_mode &amp; S_IFMT) &#123;</span><br><span class="line">    <span class="keyword">case</span> S_IFSOCK:</span><br><span class="line">        perms.<span class="built_in">append</span>(<span class="string">&quot;s&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> S_IFLNK:</span><br><span class="line">        perms.<span class="built_in">append</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> S_IFREG:</span><br><span class="line">        perms.<span class="built_in">append</span>(<span class="string">&quot;-&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> S_IFBLK:</span><br><span class="line">        perms.<span class="built_in">append</span>(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> S_IFDIR:</span><br><span class="line">        perms.<span class="built_in">append</span>(<span class="string">&quot;d&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> S_IFCHR:</span><br><span class="line">        perms.<span class="built_in">append</span>(<span class="string">&quot;c&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> S_IFIFO:</span><br><span class="line">        perms.<span class="built_in">append</span>(<span class="string">&quot;p&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        perms.<span class="built_in">append</span>(<span class="string">&quot;?&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ–‡ä»¶è®¿é—®æƒé™ Users Group Others</span></span><br><span class="line">    <span class="comment">// Users</span></span><br><span class="line">    perms.<span class="built_in">append</span>((_mode &amp; S_IRUSR) ? <span class="string">&quot;r&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">    perms.<span class="built_in">append</span>((_mode &amp; S_IWUSR) ? <span class="string">&quot;w&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">    perms.<span class="built_in">append</span>((_mode &amp; S_IXUSR) ? <span class="string">&quot;x&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">    <span class="comment">// Group</span></span><br><span class="line">    perms.<span class="built_in">append</span>((_mode &amp; S_IRGRP) ? <span class="string">&quot;r&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">    perms.<span class="built_in">append</span>((_mode &amp; S_IWGRP) ? <span class="string">&quot;w&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">    perms.<span class="built_in">append</span>((_mode &amp; S_IXGRP) ? <span class="string">&quot;x&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">    <span class="comment">// Others</span></span><br><span class="line">    perms.<span class="built_in">append</span>((_mode &amp; S_IROTH) ? <span class="string">&quot;r&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">    perms.<span class="built_in">append</span>((_mode &amp; S_IWOTH) ? <span class="string">&quot;w&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">    perms.<span class="built_in">append</span>((_mode &amp; S_IXOTH) ? <span class="string">&quot;x&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–ç¡¬è¿æ¥æ•°</span></span><br><span class="line">    <span class="type">nlink_t</span> link_num = statbuf.st_nlink;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–‡ä»¶æ‰€æœ‰è€…</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªå‡½æ•°å¯ä»¥é€šè¿‡ç”¨æˆ·uidè·å¾—ç”¨æˆ·åç§°</span></span><br><span class="line">    string _User = <span class="built_in">getpwuid</span>(statbuf.st_uid)-&gt;pw_name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–‡ä»¶æ‰€åœ¨ç»„</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªå‡½æ•°é€šè¿‡ç»„gidè·å¾—åç§°</span></span><br><span class="line">    string _Group = <span class="built_in">getgrgid</span>(statbuf.st_gid)-&gt;gr_name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–‡ä»¶å¤§å°</span></span><br><span class="line">    <span class="type">off_t</span> _size = statbuf.st_size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–ä¿®æ”¹æ—¶é—´</span></span><br><span class="line">    <span class="comment">// ctime()å‡½æ•°å¯ä»¥å°†æ—¶é—´å·®å€¼è½¬åŒ–ä¸ºæœ¬åœ°æ—¶é—´</span></span><br><span class="line">    string _mtime = <span class="built_in">string</span>(<span class="built_in">ctime</span>(&amp;statbuf.st_mtime));</span><br><span class="line">    <span class="comment">// è¿™ä¸ªæ—¶é—´æ ¼å¼åŒ–ä¹‹åå›è½¦æ¢è¡Œäº†ï¼Œå°†å…¶å»æ‰</span></span><br><span class="line">    _mtime.<span class="built_in">pop_back</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¾“å‡º</span></span><br><span class="line">    <span class="type">char</span> ret_buf[MAXSIZE];</span><br><span class="line">    <span class="comment">// è¿™ä¸ªå‡½æ•°å¯ä»¥å¾€å­—ç¬¦ä¸²ä¸­å¡«å……</span></span><br><span class="line">    <span class="built_in">sprintf</span>(ret_buf, <span class="string">&quot;%s %ld %s %s %ld %s %s&quot;</span>, perms.<span class="built_in">c_str</span>(), link_num, _User.<span class="built_in">c_str</span>(), _Group.<span class="built_in">c_str</span>(),</span><br><span class="line">            _size, _mtime.<span class="built_in">c_str</span>(), argv[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; ret_buf &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>é‡Œé¢æœ‰ä¸€ä¸ªç³»ç»Ÿå‡½æ•°å¯¹åº”çš„åŠŸèƒ½å·²ç»åˆ—å‡ºäº†ï¼Œä¸‹é¢ç½—åˆ—ä»–ä»¬çš„å¤´æ–‡ä»¶</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pwd.h&gt;</span></span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">passwd</span> *<span class="built_in">getpwuid</span>(<span class="type">uid_t</span> uid);</span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;grp.h&gt;</span></span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">group</span> *<span class="built_in">getgrgid</span>(<span class="type">gid_t</span> gid);</span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">char</span> *<span class="title">ctime</span><span class="params">(<span class="type">const</span> <span class="type">time_t</span> *timep)</span></span>;</span><br></pre></td></tr></table></div></figure><h3 id="æ–‡ä»¶å±æ€§æ“ä½œå‡½æ•°"><a href="#æ–‡ä»¶å±æ€§æ“ä½œå‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ–‡ä»¶å±æ€§æ“ä½œå‡½æ•°"></a> æ–‡ä»¶å±æ€§æ“ä½œå‡½æ•°</h3><p>å››ä¸ªå‡½æ•°</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230715110918357.png" alt="image-20230715110918357"></p><h4 id="accesså‡½æ•°"><a href="#accesså‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#accesså‡½æ•°"></a> accesså‡½æ•°</h4><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">access</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *pathname, <span class="type">int</span> mode)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šç”¨æ¥åˆ¤æ–­æŸä¸ªæ–‡ä»¶æ˜¯å¦æœ‰æŸä¸ªæƒé™ï¼Œæˆ–è€…åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">// pathnameï¼šæ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment">// modeï¼š</span></span><br><span class="line">    <span class="comment">// R_OK æ˜¯å¦æœ‰è¯»æƒé™</span></span><br><span class="line">    <span class="comment">// W_OK æ˜¯å¦æœ‰å†™æƒé™</span></span><br><span class="line">    <span class="comment">// X_OK æ˜¯å¦æœ‰æ‰§è¡Œæƒé™</span></span><br><span class="line">    <span class="comment">// F_OK æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼š</span></span><br><span class="line"><span class="comment">// æˆåŠŸ è¿”å›0</span></span><br><span class="line"><span class="comment">// å¤±è´¥(æ²¡æœ‰è¿™ä¸ªæƒé™) è¿”å›-1ï¼Œå¹¶ä¸”ä¿®æ”¹errno</span></span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">access</span>(<span class="string">&quot;1.txt&quot;</span>, F_OK);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;access&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;file exists.&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h4 id="chmodå‡½æ•°"><a href="#chmodå‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#chmodå‡½æ•°"></a> chmodå‡½æ•°</h4><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">chmod</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *pathname, <span class="type">mode_t</span> mode)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šä¿®æ”¹æ–‡ä»¶æƒé™</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">//     pathnameï¼šæ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment">//     modeï¼šéœ€è¦ä¿®æ”¹çš„æƒé™å€¼ï¼Œå…«è¿›åˆ¶çš„æ•°</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼š</span></span><br><span class="line"><span class="comment">//     æˆåŠŸè¿”å›0</span></span><br><span class="line"><span class="comment">//     å¤±è´¥è¿”å›-1</span></span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">chmod</span>(<span class="string">&quot;1.txt&quot;</span>, <span class="number">0777</span>);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;chmod&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h4 id="chownå‡½æ•°äº†è§£"><a href="#chownå‡½æ•°äº†è§£" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#chownå‡½æ•°äº†è§£"></a> chownå‡½æ•°(äº†è§£)</h4><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">chown</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *pathname, <span class="type">uid_t</span> owner, <span class="type">gid_t</span> group)</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">fchown</span><span class="params">(<span class="type">int</span> fd, <span class="type">uid_t</span> owner, <span class="type">gid_t</span> group)</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lchown</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *pathname, <span class="type">uid_t</span> owner, <span class="type">gid_t</span> group)</span></span>;</span><br></pre></td></tr></table></div></figure><h4 id="truncateå‡½æ•°"><a href="#truncateå‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#truncateå‡½æ•°"></a> truncateå‡½æ•°</h4><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">truncate</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *path, <span class="type">off_t</span> length)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šç¼©å‡æˆ–è€…æ‰©å±•æ–‡ä»¶å°ºå¯¸åˆ°è¾¾æŒ‡å®šçš„å¤§å°</span></span><br><span class="line"><span class="comment">// å‚æ•°:</span></span><br><span class="line">    <span class="comment">// pathï¼šæ–‡ä»¶è·¯å¾„</span></span><br><span class="line">    <span class="comment">// lengthï¼šéœ€è¦æœ€ç»ˆæ–‡ä»¶å˜æˆçš„å¤§å°</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼š</span></span><br><span class="line">    <span class="comment">// æˆåŠŸ 0</span></span><br><span class="line">    <span class="comment">// å¤±è´¥ -1</span></span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">truncate</span>(<span class="string">&quot;b.txt&quot;</span>, <span class="number">5</span>);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;truncate&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="æ–‡ä»¶ç›®å½•æ“ä½œå‡½æ•°"><a href="#æ–‡ä»¶ç›®å½•æ“ä½œå‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ–‡ä»¶ç›®å½•æ“ä½œå‡½æ•°"></a> æ–‡ä»¶ç›®å½•æ“ä½œå‡½æ•°</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230715113517243.png" alt="image-20230715113517243"></p><h4 id="mkdirå‡½æ•°"><a href="#mkdirå‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#mkdirå‡½æ•°"></a> mkdirå‡½æ•°</h4><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">mkdir</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *pathname, <span class="type">mode_t</span> mode)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šå»åˆ›å»ºä¸€ä¸ªç›®å½•</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">//     pathnameï¼šç›®å½•åç§°</span></span><br><span class="line"><span class="comment">//     modeï¼šæƒé™ï¼Œå…«è¿›åˆ¶æ•°</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼š</span></span><br><span class="line"><span class="comment">//     æˆåŠŸ 0</span></span><br><span class="line"><span class="comment">//     å¤±è´¥ -1</span></span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">mkdir</span>(<span class="string">&quot;fuck&quot;</span>, <span class="number">0777</span>);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;mkdir&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h4 id="rmdirå‡½æ•°"><a href="#rmdirå‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#rmdirå‡½æ•°"></a> rmdirå‡½æ•°</h4><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rmdir</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *pathname)</span></span>;</span><br></pre></td></tr></table></div></figure><p>åˆ é™¤ç›®å½•ï¼Œç•¥</p><p><strong>è¿™ä¸ªå‡½æ•°åªèƒ½åˆ é™¤ç©ºç›®å½•ï¼Œå¦‚æœé‡Œé¢æœ‰æ–‡ä»¶éœ€è¦å…ˆæŠŠæ–‡ä»¶æ¸…ç©ºï¼Œæ‰èƒ½è¿›è¡Œåˆ é™¤!!!</strong></p><h4 id="renameå‡½æ•°"><a href="#renameå‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#renameå‡½æ•°"></a> renameå‡½æ•°</h4><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rename</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *oldpath, <span class="type">const</span> <span class="type">char</span> *newpath)</span></span>;</span><br><span class="line"><span class="comment">//ä¸€çœ‹å°±æ‡‚äº†</span></span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">rename</span>(<span class="string">&quot;fuck&quot;</span>, <span class="string">&quot;fuckyou&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;rename&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h4 id="chdirå‡½æ•°å’Œgetcwdå‡½æ•°"><a href="#chdirå‡½æ•°å’Œgetcwdå‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#chdirå‡½æ•°å’Œgetcwdå‡½æ•°"></a> chdirå‡½æ•°å’Œgetcwdå‡½æ•°</h4><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">chdir</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *path)</span></span>;</span><br><span class="line"><span class="comment">//ä½œç”¨ï¼šä¿®æ”¹è¿›ç¨‹çš„å·¥ä½œç›®å½•</span></span><br><span class="line">    <span class="comment">//æ¯”å¦‚åœ¨ /home/newcoder å¯åŠ¨äº†ä¸€ä¸ªå¯æ‰§è¡Œç¨‹åº a.outï¼Œè¿›ç¨‹çš„å·¥ä½œç›®å½• /home/newcoder</span></span><br><span class="line"><span class="comment">//å‚æ•°ï¼š</span></span><br><span class="line">    <span class="comment">//pathï¼šéœ€è¦ä¿®æ”¹åˆ°çš„å·¥ä½œç›®å½•</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">char</span> *<span class="title">getcwd</span><span class="params">(<span class="type">char</span> *buf, <span class="type">size_t</span> size)</span></span>;</span><br><span class="line"><span class="comment">//ä½œç”¨ï¼šè·å–å½“å‰å·¥ä½œç›®å½•</span></span><br><span class="line"><span class="comment">//å‚æ•°ï¼š</span></span><br><span class="line">    <span class="comment">//bufï¼šå¾€æ•°ç»„é‡Œå­˜ï¼Œä¼ å‡ºå‚æ•°</span></span><br><span class="line">    <span class="comment">//sizeï¼šæ•°ç»„çš„å¤§å°</span></span><br><span class="line"><span class="comment">//è¿”å›å€¼ï¼šè¿”å›çš„æ˜¯æŒ‡å‘çš„ä¸€å—å†…å­˜ï¼Œè¿™ä¸ªæ•°æ®å°±æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°buf</span></span><br></pre></td></tr></table></div></figure><p>ä»£ç ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è·å–å½“å‰å·¥ä½œç›®å½•</span></span><br><span class="line">    <span class="type">char</span> buf[<span class="number">1024</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">getcwd</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">    cout &lt;&lt; buf &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¿®æ”¹å·¥ä½œç›®å½•</span></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">chdir</span>(<span class="string">&quot;./fuckyou&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;chdir&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»£ç æ‰§è¡Œåˆ°è¿™é‡ŒæŠŠå·¥ä½œç›®å½•ä¿®æ”¹ä¹‹ååœ¨è¯¥ç›®å½•ä¹‹ä¸‹è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œ</span></span><br><span class="line">    <span class="comment">// åªåœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™ç”Ÿæ•ˆï¼Œç¨‹åºç»“æŸåç»ˆç«¯å½“ä¸­çš„å·¥ä½œç›®å½•ä¸ä¼šæ”¹å˜!</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºæ–°çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="type">int</span> fd = <span class="built_in">open</span>(<span class="string">&quot;1.txt&quot;</span>, O_RDWR | O_CREAT, <span class="number">0664</span>);</span><br><span class="line">    <span class="keyword">if</span> (fd == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">close</span>(fd);</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> Null_buf[<span class="number">1024</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">strncpy</span>(buf, Null_buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">getcwd</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">    cout &lt;&lt; buf &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="æ–‡ä»¶ç›®å½•éå†å‡½æ•°"><a href="#æ–‡ä»¶ç›®å½•éå†å‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ–‡ä»¶ç›®å½•éå†å‡½æ•°"></a> æ–‡ä»¶ç›®å½•éå†å‡½æ•°</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230715125019218.png" alt="image-20230715125019218"></p><h4 id="opendirå‡½æ•°"><a href="#opendirå‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#opendirå‡½æ•°"></a> opendirå‡½æ•°</h4><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;dirent.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="function">DIR *<span class="title">opendir</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *name)</span></span>;</span><br><span class="line"><span class="comment">//å‚æ•°ï¼š</span></span><br><span class="line">    <span class="comment">//nameï¼šéœ€è¦æ‰“å¼€çš„ç›®å½•çš„åç§°</span></span><br><span class="line"><span class="comment">//è¿”å›å€¼ï¼š</span></span><br><span class="line">    <span class="comment">//DIR * ç±»å‹ï¼Œç†è§£ä¸ºç›®å½•æµ</span></span><br><span class="line">    <span class="comment">//é”™è¯¯ è¿”å›nullptr</span></span><br></pre></td></tr></table></div></figure><h4 id="readdirå‡½æ•°"><a href="#readdirå‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#readdirå‡½æ•°"></a> readdirå‡½æ•°</h4><h4 id="direntç»“æ„ä½“å’Œd_type"><a href="#direntç»“æ„ä½“å’Œd_type" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#direntç»“æ„ä½“å’Œd_type"></a> direntç»“æ„ä½“å’Œd_type(!!!)</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230715130311932.png" alt="image-20230715130311932"></p><p><strong>è¿™ä¸ªdirentå­˜å‚¨çš„ä¹Ÿæ˜¯æ–‡ä»¶çš„ä¿¡æ¯ï¼Œå‰é¢ä¹Ÿæœ‰ä¸ªstatç»“æ„ä½“ä¹Ÿæœ‰å­˜å‚¨ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªå­˜å‚¨çš„ä¸œè¥¿ä¸å¤ªä¸€æ ·</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‰“å¼€ç›®å½•</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;dirent.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="function">DIR *<span class="title">opendir</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *name)</span></span>;</span><br><span class="line"><span class="comment">//å‚æ•°ï¼š</span></span><br><span class="line">    <span class="comment">//nameï¼šéœ€è¦æ‰“å¼€çš„ç›®å½•çš„åç§°</span></span><br><span class="line"><span class="comment">//è¿”å›å€¼ï¼š</span></span><br><span class="line">    <span class="comment">//DIR * ç±»å‹ï¼Œç†è§£ä¸ºç›®å½•æµ</span></span><br><span class="line">    <span class="comment">//é”™è¯¯ è¿”å›nullptr</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¯»å–ç›®å½•ä¸­çš„æ•°æ®</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;dirent.h&gt;</span></span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">dirent</span> *<span class="built_in">readdir</span>(DIR *dirp);</span><br><span class="line"><span class="comment">//å‚æ•°ï¼š</span></span><br><span class="line">    <span class="comment">//dirpæ˜¯é€šè¿‡opendirè¿”å›çš„ç»“æœ</span></span><br><span class="line"><span class="comment">//è¿”å›å€¼ï¼š</span></span><br><span class="line">    <span class="comment">//struct dirent ä»£è¡¨è¯»å–åˆ°çš„æ–‡ä»¶çš„ä¿¡æ¯</span></span><br><span class="line">    <span class="comment">//è¯»å–åˆ°äº†æ–‡ä»¶æœ«å°¾æˆ–è€…å¤±è´¥äº†ï¼Œè¿”å›Nullï¼ŒåŒºåˆ«æ˜¯è¯»åˆ°æ–‡ä»¶æœ«å°¾ä¸ä¼šä¿®æ”¹errnoï¼Œå¤±è´¥ä¼šä¿®æ”¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å…³é—­ç›®å½•</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;dirent.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">closedir</span><span class="params">(DIR *dirp)</span></span>;</span><br></pre></td></tr></table></div></figure><p>ä»£ç ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;dirent.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é€’å½’å‡½æ•°ï¼Œç”¨äºè·å–ç›®å½•ä¸‹æ‰€æœ‰æ™®é€šæ–‡ä»¶çš„ä¸ªæ•°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">getFileNum</span><span class="params">(string path, <span class="type">int</span>&amp; num)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ‰“å¼€ç›®å½•</span></span><br><span class="line">    DIR* _dir = <span class="built_in">opendir</span>(path.<span class="built_in">c_str</span>());</span><br><span class="line">    <span class="keyword">if</span> (_dir == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;opendir&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯»å–ç›®å½•æ•°æ®</span></span><br><span class="line">    <span class="comment">// å¾ªç¯è¯»å–ï¼Œå› ä¸º// æ³¨æ„è¿™ä¸ª16çš„ç”±æ¥diræ˜¯ä¸€ä¸ªä¸€ä¸ªè¯»å–çš„ï¼Œè¯»åˆ°æœ«å°¾è¿”å›Null</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">dirent</span>* _ptr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> ((_ptr = <span class="built_in">readdir</span>(_dir)) != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        <span class="comment">// è·å–åç§°</span></span><br><span class="line">        <span class="comment">// Shellç»ˆç«¯ä¸­æœ‰å½“å‰ç›®å½• ./ å’Œ ä¸Šçº§ç›®å½• ../ï¼Œè¿™ä¸¤ä¸ªä¸èƒ½æ‹¿æ¥é€’å½’ï¼Œéœ€è¦å¿½ç•¥</span></span><br><span class="line">        string _dname = _ptr-&gt;d_name;</span><br><span class="line">        <span class="keyword">if</span> (_dname == <span class="string">&quot;.&quot;</span> || _dname == <span class="string">&quot;..&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯æ™®é€šæ–‡ä»¶è¿˜æ˜¯ç›®å½•</span></span><br><span class="line">        <span class="keyword">if</span> (_ptr-&gt;d_type == DT_DIR)</span><br><span class="line">            <span class="comment">// ç›®å½•éœ€è¦æ‹¼æ¥ä¸€ä¸‹</span></span><br><span class="line">            <span class="built_in">getFileNum</span>(path + <span class="string">&quot;/&quot;</span> + _dname, num);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (_ptr-&gt;d_type == DT_REG)</span><br><span class="line">            ++num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­ç›®å½•</span></span><br><span class="line">    <span class="built_in">closedir</span>(_dir);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* <span class="type">const</span> argv[])</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è¯»å–æŸä¸ªç›®å½•ä¸‹æ‰€æœ‰æ™®é€šæ–‡ä»¶çš„ä¸ªæ•°</span></span><br><span class="line">    <span class="keyword">if</span> (argc &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;usage: &quot;</span> &lt;&lt; argv[<span class="number">0</span>] &lt;&lt; <span class="string">&quot; &lt;path&gt;&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> num = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">getFileNum</span>(argv[<span class="number">1</span>], num);</span><br><span class="line">    cout &lt;&lt; num &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="dupdup2å‡½æ•°ä¸æ–‡ä»¶æè¿°ç¬¦ç›¸å…³"><a href="#dupdup2å‡½æ•°ä¸æ–‡ä»¶æè¿°ç¬¦ç›¸å…³" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#dupdup2å‡½æ•°ä¸æ–‡ä»¶æè¿°ç¬¦ç›¸å…³"></a> dup,dup2å‡½æ•°(ä¸æ–‡ä»¶æè¿°ç¬¦ç›¸å…³)</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230715141246853.png" alt="image-20230715141246853"></p><h4 id="dup"><a href="#dup" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#dup"></a> dup()</h4><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dup</span><span class="params">(<span class="type">int</span> oldfd)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šå¤åˆ¶ä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»–ä»¬æ˜¯æŒ‡å‘åŒä¸€ä¸ªæ–‡ä»¶çš„ï¼Œåªæ˜¯ç”¨äº†ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line"><span class="comment">// æ–°çš„æ–‡ä»¶æè¿°ç¬¦ä¼šä½¿ç”¨ç©ºé—²çš„æ–‡ä»¶æè¿°ç¬¦è¡¨ä¸­æœ€å°çš„é‚£ä¸ª!!!</span></span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> fd = <span class="built_in">open</span>(<span class="string">&quot;1.txt&quot;</span>, O_RDWR | O_CREAT, <span class="number">0664</span>);</span><br><span class="line">    <span class="keyword">if</span> (fd == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> fd1 = <span class="built_in">dup</span>(fd);</span><br><span class="line">    <span class="keyword">if</span> (fd1 == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;dup&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;fd : %d , fd1 : %d\n&quot;</span>, fd, fd1);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­fdï¼Œç°åœ¨åªæœ‰fd1æŒ‡å‘æ–‡ä»¶</span></span><br><span class="line">    <span class="built_in">close</span>(fd);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡fd1æ¥å†™è¯¥æ–‡ä»¶</span></span><br><span class="line">    string fuck = <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">write</span>(fd1, fuck.<span class="built_in">c_str</span>(), fuck.<span class="built_in">size</span>());</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;write&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h4 id="dup2"><a href="#dup2" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#dup2"></a> dup2()</h4><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dup2</span><span class="params">(<span class="type">int</span> fd1, <span class="type">int</span> fd2)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šé‡å®šå‘æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">    <span class="comment">// fd1æŒ‡å‘a.txtï¼Œfd2æŒ‡å‘b.txt</span></span><br><span class="line">    <span class="comment">// è°ƒç”¨å‡½æ•°æˆåŠŸåï¼Œfd2å’Œb.txtçš„è¿æ¥åšclose(fd1ä»æŒ‡å‘a.txt)ï¼Œfd2æŒ‡å‘a.txt</span></span><br><span class="line">    <span class="comment">// fd1å¿…é¡»æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">    <span class="comment">// å¦‚æœç›¸åŒåˆ™ç›¸å½“äºä»€ä¹ˆéƒ½æ²¡åš</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼š</span></span><br><span class="line">    <span class="comment">// fd2ï¼Œä»–ä»¬éƒ½æŒ‡å‘çš„æ˜¯fd1ä¹‹å‰æŒ‡å‘çš„æ–‡ä»¶</span></span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> fd = <span class="built_in">open</span>(<span class="string">&quot;2.txt&quot;</span>, O_RDWR | O_CREAT, <span class="number">0664</span>);</span><br><span class="line">    <span class="keyword">if</span> (fd == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> fd1 = <span class="built_in">open</span>(<span class="string">&quot;3.txt&quot;</span>, O_RDWR | O_CREAT, <span class="number">0664</span>);</span><br><span class="line">    <span class="keyword">if</span> (fd1 == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;fd : %d , fd1 : %d\n&quot;</span>, fd, fd1);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> fd2 = <span class="built_in">dup2</span>(fd, fd1);</span><br><span class="line">    <span class="comment">// ç°åœ¨fdæœ¬æ¥æŒ‡å‘ 2.txt ï¼Œç°åœ¨fdä»æŒ‡å‘2.txt</span></span><br><span class="line">    <span class="comment">// fd1æœ¬æ¥ 3.txtï¼Œç°åœ¨æŒ‡å‘åˆ°äº† 2.txt</span></span><br><span class="line">    <span class="keyword">if</span> (fd2 == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;dup2&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡fd1å»å†™æ•°æ®ï¼Œå®é™…æ“ä½œçš„æ˜¯2.txt</span></span><br><span class="line">    <span class="comment">// é€šè¿‡fdä¸€æ ·æŒ‡å‘2.txt</span></span><br><span class="line">    string fuck = <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">write</span>(fd1, fuck.<span class="built_in">c_str</span>(), fuck.<span class="built_in">size</span>());</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;write&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;fd : %d , fd1 : %d , fd2: %d\n&quot;</span>, fd, fd1, fd2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="fcntl"><a href="#fcntl" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#fcntl"></a> fcntl()</h3><p>ä¸¤ä¸ªä½œç”¨ï¼š</p><p><strong>å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦</strong></p><p><strong>è®¾ç½®æˆ–è€…è·å–æ–‡ä»¶çš„çŠ¶æ€æ ‡å¿—</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230715145100478.png" alt="image-20230715145100478"></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">fcntl</span><span class="params">(<span class="type">int</span> fd, <span class="type">int</span> cmd, ...)</span></span>; ...å½“ä¸­æ˜¯å¯å˜å‚æ•°</span><br><span class="line"><span class="comment">// å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">//     fdï¼šéœ€è¦æ“ä½œçš„æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line"><span class="comment">//     cmdï¼šè¡¨ç¤ºå¯¹æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œå¦‚ä½•æ“ä½œ</span></span><br><span class="line"><span class="comment">//         F_DUPFD å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤åˆ¶çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦(è¿”å›å€¼)</span></span><br><span class="line"><span class="comment">//             int ret = fcntl(fd,F_DUPFD);</span></span><br><span class="line"><span class="comment">//         F_GETFL è·å–æŒ‡å®šæ–‡ä»¶æè¿°ç¬¦çš„æ–‡ä»¶çŠ¶æ€flag</span></span><br><span class="line"><span class="comment">//             è·å–çš„flagå’Œæˆ‘ä»¬é€šè¿‡openå‡½æ•°ä¼ é€’çš„flagæ˜¯ä¸€ä¸ªä¸œè¥¿</span></span><br><span class="line"><span class="comment">//         F_SETFL è®¾ç½®æ–‡ä»¶æè¿°ç¬¦çš„æ–‡ä»¶çŠ¶æ€flag</span></span><br><span class="line"><span class="comment">//             å¿…é€‰é¡¹ï¼šO_RDONLY O_WRONLY O_RDWR ä¸å¯ä»¥è¢«ä¿®æ”¹</span></span><br><span class="line"><span class="comment">//             å¯é€‰é¡¹ï¼šO_APPEND O_NONBLOCK</span></span><br><span class="line"><span class="comment">//                 O_APPEND è¡¨ç¤ºè¿½åŠ æ•°æ®</span></span><br><span class="line"><span class="comment">//                 O_NONBLOCK è®¾ç½®æˆéé˜»å¡</span></span><br><span class="line"><span class="comment">//                     é˜»å¡å’Œéé˜»å¡ï¼šæè¿°çš„æ˜¯å‡½æ•°è°ƒç”¨çš„è¡Œä¸º</span></span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦ï¼Œå¾—åˆ°ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦(intå€¼ä¸åŒ)æŒ‡å‘åŒä¸€ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥è¿›è¡Œçš„æ“ä½œç›¸åŒ</span></span><br><span class="line">    <span class="comment">// int fd = open(&quot;1.txt&quot;, O_RDONLY);</span></span><br><span class="line">    <span class="comment">// if (fd == -1) &#123;</span></span><br><span class="line">    <span class="comment">//     perror(&quot;open&quot;);</span></span><br><span class="line">    <span class="comment">//     return -1;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// int ret = fcntl(fd, F_DUPFD);</span></span><br><span class="line">    <span class="comment">// if (ret == -1) &#123;</span></span><br><span class="line">    <span class="comment">//     perror(&quot;fcntl&quot;);</span></span><br><span class="line">    <span class="comment">//     return -1;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.ä¿®æ”¹æˆ–è€…è·å–æ–‡ä»¶æè¿°ç¬¦çš„æ–‡ä»¶çŠ¶æ€flag</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œå¿…é¡»è¯»å†™æƒé™éƒ½è¦æœ‰æ‰è¡Œ</span></span><br><span class="line">    <span class="type">int</span> fd = <span class="built_in">open</span>(<span class="string">&quot;1.txt&quot;</span>, O_RDWR, <span class="number">0664</span>);</span><br><span class="line">    <span class="keyword">if</span> (fd == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¿®æ”¹æ–‡ä»¶æè¿°ç¬¦çš„flagï¼ŒåŠ å…¥O_APPENDè¿™ä¸ªæ ‡è®°</span></span><br><span class="line">    <span class="comment">// é¦–å…ˆè·å¾—</span></span><br><span class="line">    <span class="type">int</span> _flag = <span class="built_in">fcntl</span>(fd, F_GETFL);</span><br><span class="line">    <span class="keyword">if</span> (_flag == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;fcntl&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç„¶åä¿®æ”¹</span></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">fcntl</span>(fd, F_SETFL, _flag | O_APPEND);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;fcntl&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç„¶åè¿›è¡Œè¿½åŠ </span></span><br><span class="line">    string fuck = <span class="string">&quot;ä½ å¥½&quot;</span>;</span><br><span class="line">    ret = <span class="built_in">write</span>(fd, fuck.<span class="built_in">c_str</span>(), fuck.<span class="built_in">size</span>());</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;write&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">close</span>(fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="æ–‡ä»¶åˆ é™¤å‡½æ•°"><a href="#æ–‡ä»¶åˆ é™¤å‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ–‡ä»¶åˆ é™¤å‡½æ•°"></a> æ–‡ä»¶åˆ é™¤å‡½æ•°</h3><h4 id="unlinkå’Œremove"><a href="#unlinkå’Œremove" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#unlinkå’Œremove"></a> unlink()å’Œremove()</h4><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">unlink</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *pathname)</span></span>; <span class="comment">// linuxç³»ç»Ÿçš„å‡½æ•°</span></span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">remove</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *pathname)</span></span>; <span class="comment">// æ ‡å‡†Cåº“çš„å‡½æ•°</span></span><br></pre></td></tr></table></div></figure><h1 id="ç¬¬äºŒç« -linuxå¤šè¿›ç¨‹å¼€å‘"><a href="#ç¬¬äºŒç« -linuxå¤šè¿›ç¨‹å¼€å‘" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¬¬äºŒç« -linuxå¤šè¿›ç¨‹å¼€å‘"></a> ç¬¬äºŒç«  Linuxå¤šè¿›ç¨‹å¼€å‘</h1><h2 id="ä¸€äº›æ¦‚å¿µ"><a href="#ä¸€äº›æ¦‚å¿µ" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä¸€äº›æ¦‚å¿µ"></a> ä¸€äº›æ¦‚å¿µ</h2><h3 id="ç¨‹åºå’Œè¿›ç¨‹"><a href="#ç¨‹åºå’Œè¿›ç¨‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¨‹åºå’Œè¿›ç¨‹"></a> ç¨‹åºå’Œè¿›ç¨‹</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230716113520531.png" alt="image-20230716113520531"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230716113908652.png" alt="image-20230716113908652"></p><h3 id="å•é“å¤šé“ç¨‹åºè®¾è®¡"><a href="#å•é“å¤šé“ç¨‹åºè®¾è®¡" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å•é“å¤šé“ç¨‹åºè®¾è®¡"></a> å•é“ï¼Œå¤šé“ç¨‹åºè®¾è®¡</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230716114055627.png" alt="image-20230716114055627"></p><h3 id="æ—¶é—´ç‰‡"><a href="#æ—¶é—´ç‰‡" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ—¶é—´ç‰‡"></a> æ—¶é—´ç‰‡</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230716114135444.png" alt="image-20230716114135444"></p><h3 id="å¹¶è¡Œå’Œå¹¶å‘"><a href="#å¹¶è¡Œå’Œå¹¶å‘" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å¹¶è¡Œå’Œå¹¶å‘"></a> å¹¶è¡Œå’Œå¹¶å‘</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230716114205304.png" alt="image-20230716114205304"></p><h3 id="è¿›ç¨‹æ§åˆ¶å—pcb"><a href="#è¿›ç¨‹æ§åˆ¶å—pcb" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è¿›ç¨‹æ§åˆ¶å—pcb"></a> è¿›ç¨‹æ§åˆ¶å—PCB</h3><p><strong>åœ¨Linuxå†…æ ¸çš„è¿›ç¨‹æ§åˆ¶å—æ˜¯ task_struct ç»“æ„ä½“</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230716120419774.png" alt="image-20230716120419774"></p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230716121448756.png" alt="image-20230716121448756" style="zoom:80%"><h2 id="è¿›ç¨‹çŠ¶æ€"><a href="#è¿›ç¨‹çŠ¶æ€" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è¿›ç¨‹çŠ¶æ€"></a> è¿›ç¨‹çŠ¶æ€</h2><h3 id="çŠ¶æ€è½¬åŒ–å›¾"><a href="#çŠ¶æ€è½¬åŒ–å›¾" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#çŠ¶æ€è½¬åŒ–å›¾"></a> çŠ¶æ€è½¬åŒ–å›¾</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718093121456.png" alt="image-20230718093121456"></p><p><strong>åŠ å…¥æ–°å»ºå’Œç»ˆæ­¢çš„çŠ¶æ€</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718093806701.png" alt="image-20230718093806701"></p><h3 id="è¿›ç¨‹ç›¸å…³å‘½ä»¤"><a href="#è¿›ç¨‹ç›¸å…³å‘½ä»¤" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è¿›ç¨‹ç›¸å…³å‘½ä»¤"></a> è¿›ç¨‹ç›¸å…³å‘½ä»¤</h3><figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps aux / ajx</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ³¨æ„auxå’Œajxçš„åŒºåˆ«</span></span><br></pre></td></tr></table></div></figure><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718094028703.png" alt="image-20230718094028703"></p><h4 id="ps-aux"><a href="#ps-aux" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ps-aux"></a> ps aux</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718094423758.png" alt="image-20230718094423758"></p><p>statå‚æ•°çš„æ„ä¹‰ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718095104233.png" alt="image-20230718095104233"></p><h4 id="ps-ajx"><a href="#ps-ajx" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ps-ajx"></a> ps ajx</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718095230919.png" alt="image-20230718095230919"></p><h4 id="top"><a href="#top" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#top"></a> top</h4><p><strong>å®æ—¶æ˜¾ç¤ºè¿›ç¨‹åŠ¨æ€</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718095445176.png" alt="image-20230718095445176"></p><h4 id="kill"><a href="#kill" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#kill"></a> kill</h4><p><strong>æ€æ­»è¿›ç¨‹</strong></p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718095843259.png" alt="image-20230718095843259" style="zoom:80%"><p>é‡Œé¢æœ‰ä¸€ä¸ª 9 å·ä¿¡å·(SIGKILL)ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -9 &lt;pid&gt;</span><br></pre></td></tr></table></div></figure><p><strong>è¿™ä¸ªå‘½ä»¤å¯ä»¥å¼ºåˆ¶æ€æ‰æŸä¸ªè¿›ç¨‹</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718100643298.png" alt="image-20230718100643298"></p><h4 id="aout-åå°è¿è¡Œç¨‹åº"><a href="#aout-åå°è¿è¡Œç¨‹åº" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#aout-åå°è¿è¡Œç¨‹åº"></a> ./a.out &amp; åå°è¿è¡Œç¨‹åº</h4><p><strong>è¿™ä¸ªæ—¶å€™ï¼Œè¿™ä¸ªè¿›ç¨‹ä¼šè¢«æŒ‚åœ¨åå°è¿›è¡Œè¿è¡Œï¼Œç„¶åä»–çš„æ‰“å°ä¿¡æ¯ä»ç„¶ä¼šæ‰“å°åœ¨å±å¹•ä¸Šï¼Œè¿™é‡Œä½¿ç”¨ps auxæŸ¥çœ‹å‘½ä»¤å¯ä»¥çœ‹å‡ºæ˜¯å¯ä»¥æ­£å¸¸æ‰§è¡Œå‘½ä»¤çš„ï¼Œä¸å†²çªï¼Œç„¶åå¯ä»¥ç”¨ kill 998 å°†å…¶æ€æ‰</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718101259447.png" alt="image-20230718101259447"></p><h2 id="åˆ›å»ºè¿›ç¨‹"><a href="#åˆ›å»ºè¿›ç¨‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#åˆ›å»ºè¿›ç¨‹"></a> åˆ›å»ºè¿›ç¨‹</h2><h3 id="è¿›ç¨‹å·å’Œç›¸å…³å‡½æ•°"><a href="#è¿›ç¨‹å·å’Œç›¸å…³å‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è¿›ç¨‹å·å’Œç›¸å…³å‡½æ•°"></a> è¿›ç¨‹å·å’Œç›¸å…³å‡½æ•°</h3><p><strong>è¿›ç¨‹ç»„æ˜¯ä¸€ä¸ªæˆ–è€…å¤šä¸ªè¿›ç¨‹çš„é›†åˆï¼Œä»–ä»¬ç›¸å…³è”ï¼Œå¹¶ä¸”å¯ä»¥æ¥å—åŒä¸€ç»ˆç«¯çš„å„ç§ä¿¡å·ï¼Œå…·æœ‰ä¸€ä¸ªè¿›ç¨‹ç»„å·(pgid)</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718101452289.png" alt="image-20230718101452289"></p><h3 id="è¿›ç¨‹åˆ›å»º"><a href="#è¿›ç¨‹åˆ›å»º" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è¿›ç¨‹åˆ›å»º"></a> è¿›ç¨‹åˆ›å»º</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718101951634.png" alt="image-20230718101951634"></p><h4 id="fork"><a href="#fork" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#fork"></a> fork()</h4><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">pid_t</span> <span class="title">fork</span><span class="params">(<span class="type">void</span>)</span></span>;</span><br><span class="line"><span class="comment">//ä½œç”¨ï¼šç”¨äºåˆ›å»ºå­è¿›ç¨‹</span></span><br><span class="line"><span class="comment">//è¿”å›å€¼ï¼š</span></span><br><span class="line">    <span class="comment">//fork()çš„è¿”å›å€¼ä¼šè¿”å›ä¸¤æ¬¡ï¼Œä¸€æ¬¡æ˜¯åœ¨çˆ¶è¿›ç¨‹ä¸­ï¼Œä¸€æ¬¡æ˜¯åœ¨å­è¿›ç¨‹ä¸­</span></span><br><span class="line">    <span class="comment">//ä¸ºä»€ä¹ˆä¼šèµ°ä¸¤æ¬¡å‘¢ï¼Ÿå› ä¸ºè¿™ä¸ªcppæ–‡ä»¶ç¼–è¯‘å‡ºæ¥æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ a.outï¼Œè¿™ä¸ªæ–‡ä»¶æ‰§è¡Œåæ˜¯è¿›ç¨‹ ./a.outï¼Œè‡ªç„¶åˆ›å»ºå‡ºæ¥çš„ä¹Ÿæ˜¯ ./a.outè¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯èµ°çš„æ˜¯è¿™ä¸ªcppç¨‹åº</span></span><br><span class="line">    <span class="comment">//ä½†æ˜¯æ³¨æ„ä¸€ç‚¹ï¼šå­è¿›ç¨‹æ˜¯ä¸ä¼šæ‰§è¡Œfork()å‡½æ•°çš„ï¼Œå› ä¸ºfork()å‡½æ•°æ˜¯çˆ¶è¿›ç¨‹æ‰§è¡Œçš„ï¼Œä½†æ˜¯ä»–ä¼šæŒæœ‰è¿”å›å€¼ï¼Œåœ¨å­è¿›ç¨‹å½“ä¸­å°±æ˜¯0</span></span><br><span class="line">    <span class="comment">//æˆåŠŸ çˆ¶è¿›ç¨‹ä¸­è¿”å›å­è¿›ç¨‹çš„pidï¼Œå­è¿›ç¨‹ä¸­è¿”å›0</span></span><br><span class="line">    <span class="comment">//å¤±è´¥ çˆ¶è¿›ç¨‹ä¸­è¿”å›-1ï¼Œæ²¡æœ‰å­è¿›ç¨‹è¢«åˆ›å»ºï¼Œç„¶åä¿®æ”¹errno</span></span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯çˆ¶è¿›ç¨‹è¿˜æ˜¯å­è¿›ç¨‹</span></span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;  <span class="comment">// çˆ¶è¿›ç¨‹èµ°ï¼Œè¿”å›çš„æ˜¯åˆ›å»ºçš„å­è¿›ç¨‹ç¼–å·</span></span><br><span class="line">        cout &lt;&lt; pid &lt;&lt; endl;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I am parent process, pid : %d , ppid : %d\n&quot;</span>, <span class="built_in">getpid</span>(), <span class="built_in">getppid</span>());</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>)  <span class="comment">// å­è¿›ç¨‹èµ°</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I am child process, pid : %d , ppid : %d\n&quot;</span>, <span class="built_in">getpid</span>(), <span class="built_in">getppid</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// for</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++i) &#123;</span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">        cout &lt;&lt; i &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p><strong>çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹æ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œåœ¨å¦‚ä¸Šçš„ç¨‹åºå½“ä¸­å…ˆæ‰“å°é‚£ä¸ªæ˜¯ä¸ç¡®å®šçš„ï¼Œå–å†³äºè°å…ˆæ‹¿åˆ°å¤„ç†æœº!!!</strong></p><p><strong>å½“ç„¶å¦‚æœç¨‹åºçš„è¿è¡Œæ—¶é—´å¤ªçŸ­äº†ï¼Œå¯¼è‡´åœ¨ä¸€ä¸ªæ—¶é—´ç‰‡å½“ä¸­å¯ä»¥å®Œæˆï¼Œé‚£ä¹ˆçœ‹èµ·æ¥å°±åƒæ˜¯ä¸¤ä¸ªä¸œè¥¿æ˜¯æŒ‰ç…§é¡ºåºè¿›è¡Œçš„ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯å¹¶å‘çš„!!!</strong></p><p>ä¾‹å¦‚è¿™æ˜¯ä¸¤æ¬¡çš„æ‰§è¡Œç»“æœï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718104207327.png" alt="image-20230718104207327"></p><p>å½“ç»™å¤šç‚¹çš„æ—¶å€™ï¼Œåˆ°åé¢å¹¶å‘æ‰§è¡Œçš„æ—¶å€™å°±å¯èƒ½æ˜¯äº¤æ›¿æ‰§è¡Œ</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718105046657.png" alt="image-20230718105046657" style="zoom:67%"><h3 id="çˆ¶å­è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´"><a href="#çˆ¶å­è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#çˆ¶å­è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´"></a> çˆ¶å­è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´</h3><p><strong>æ‰§è¡Œåˆ°fork()å‡½æ•°çš„æ—¶å€™ï¼Œå…‹éš†ä¸€ä»½ç©ºé—´(ä¸å®Œå…¨æ­£ç¡®ï¼Œåé¢ä¼šè®²)ï¼Œå­è¿›ç¨‹è¿™è¾¹ä¸æ‰§è¡Œfork()å‡½æ•°ï¼Œfork()å‡½æ•°åªç»™çˆ¶è¿›ç¨‹æ‰§è¡Œï¼Œä½†æ˜¯å­è¿›ç¨‹ä¼šå¾—åˆ°è¿”å›å€¼ä¸º0ç”¨æ¥å’Œçˆ¶è¿›ç¨‹è¿›è¡ŒåŒºåˆ«ï¼Œç„¶åä¸¤ä¸ªè¿›ç¨‹æ ¹æ®é€»è¾‘å¹¶å‘æ‰§è¡Œ!!</strong></p><p><strong>ä½†å…¶å®è¿™ä¸¤ä¸ªç©ºé—´å¤§éƒ¨åˆ†çš„ä¸œè¥¿éƒ½æ˜¯ä¸€æ ·çš„!!!</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718142613257.png" alt="image-20230718142613257"></p><h4 id="è¯»æ—¶æ‹·è´å†™æ—¶å…±äº«"><a href="#è¯»æ—¶æ‹·è´å†™æ—¶å…±äº«" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è¯»æ—¶æ‹·è´å†™æ—¶å…±äº«"></a> è¯»æ—¶æ‹·è´ï¼Œå†™æ—¶å…±äº«</h4><p><strong>å­è¿›ç¨‹åœ¨è¢«åˆ›å»ºå‡ºæ¥çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰å¯¹å˜é‡è¿›è¡Œä¿®æ”¹ï¼Œè¿›è¡Œå†™çš„æ“ä½œï¼Œé‚£ä¹ˆçˆ¶å­è¿›ç¨‹å…±äº«ä¸€å—ç©ºé—´ï¼›å½“çˆ¶å­è¿›ç¨‹éœ€è¦è¿›è¡Œå†™ï¼Œå°±æ˜¯ä¿®æ”¹å˜é‡çš„å€¼çš„æ—¶å€™å°±æ‹·è´ä¸€å—ç©ºé—´ï¼Œè¿™æ ·å°±èŠ‚çœäº†ç‰©ç†å†…ç²—æ‹¿åˆ°ç©ºé—´!!!</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718143403658.png" alt="image-20230718143403658"></p><h3 id="æ€»ç»“çˆ¶å­è¿›ç¨‹å…³ç³»"><a href="#æ€»ç»“çˆ¶å­è¿›ç¨‹å…³ç³»" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ€»ç»“çˆ¶å­è¿›ç¨‹å…³ç³»"></a> æ€»ç»“ï¼šçˆ¶å­è¿›ç¨‹å…³ç³»</h3><p>åŒºåˆ«ï¼š</p><ul><li>fork()å‡½æ•°è¿”å›å€¼ä¸åŒï¼šçˆ¶è¿›ç¨‹ &gt; 0 ï¼Œè¿”å›å­è¿›ç¨‹çš„pidï¼›å­è¿›ç¨‹ = 0</li><li>pcbä¸­çš„ä¸€äº›æ•°æ®ï¼šå½“å‰è¿›ç¨‹çš„id pidï¼Œå½“å‰è¿›ç¨‹çš„çˆ¶è¿›ç¨‹çš„id ppidï¼Œ<strong>ä¿¡å·é›†</strong></li></ul><p>å…±åŒç‚¹ï¼š</p><ul><li><p>åœ¨æŸäº›çŠ¶æ€ä¸‹ï¼Œå­è¿›ç¨‹åˆšè¢«åˆ›å»ºå‡ºæ¥ï¼Œè¿˜æ²¡æ‰§è¡Œä»»ä½•å†™çš„æ“ä½œ</p><p>ç”¨æˆ·åŒºçš„æ•°æ®ï¼Œæ–‡ä»¶æè¿°ç¬¦è¡¨æ˜¯å…±äº«çš„!!!</p></li><li><p>çˆ¶å­è¿›ç¨‹å¯¹å˜é‡æ˜¯ä¸æ˜¯å…±äº«çš„ï¼Ÿ</p><p>åˆšå¼€å§‹çš„æ—¶å€™æ˜¯ä¸€æ ·çš„ï¼Œå…±äº«çš„ï¼›ä½†æ˜¯ä¿®æ”¹äº†æ•°æ®å°±ä¸å…±äº«äº†</p><p>è¯»æ—¶å…±äº«(ä¸¤ä¸ªè¿›ç¨‹æ²¡æœ‰åšä»»ä½•å†™çš„æ“ä½œ)ï¼Œå†™æ—¶æ‹·è´</p></li></ul><h2 id="gdbå¤šè¿›ç¨‹è°ƒè¯•"><a href="#gdbå¤šè¿›ç¨‹è°ƒè¯•" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#gdbå¤šè¿›ç¨‹è°ƒè¯•"></a> GDBå¤šè¿›ç¨‹è°ƒè¯•</h2><p><strong>é»˜è®¤æƒ…å†µä¸‹gdbè°ƒè¯•çš„éƒ½æ˜¯çˆ¶è¿›ç¨‹ï¼ŒåŠ äº†æ–­ç‚¹çš„è¯é»˜è®¤åªå¯¹çˆ¶è¿›ç¨‹ç”Ÿæ•ˆï¼Œå¯ä»¥è®¾ç½®</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718145227613.png" alt="image-20230718145227613"></p><h3 id="è®¾ç½®è°ƒè¯•å­è¿›ç¨‹"><a href="#è®¾ç½®è°ƒè¯•å­è¿›ç¨‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è®¾ç½®è°ƒè¯•å­è¿›ç¨‹"></a> è®¾ç½®è°ƒè¯•å­è¿›ç¨‹</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718145632605.png" alt="image-20230718145632605"></p><h3 id="è®¾ç½®è°ƒè¯•æ¨¡å¼"><a href="#è®¾ç½®è°ƒè¯•æ¨¡å¼" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è®¾ç½®è°ƒè¯•æ¨¡å¼"></a> è®¾ç½®è°ƒè¯•æ¨¡å¼</h3><p><strong>è¿™é‡Œæˆ‘æŠŠ detac-on-fork æ¨¡å¼å…³é—­äº†ï¼Œçˆ¶è¿›ç¨‹åœ¨è¢«è°ƒè¯•çš„æ—¶å€™ï¼Œå­è¿›ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œæ‰€ä»¥å±å¹•ä¸Šæ²¡æ˜¾ç¤ºjçš„ä¿¡æ¯</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718151209448.png" alt="image-20230718151209448"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718151224879.png" alt="image-20230718151224879"></p><h2 id="execå‡½æ•°æ—"><a href="#execå‡½æ•°æ—" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#execå‡½æ•°æ—"></a> execå‡½æ•°æ—</h2><h3 id="å‡½æ•°æ—ä»‹ç»"><a href="#å‡½æ•°æ—ä»‹ç»" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å‡½æ•°æ—ä»‹ç»"></a> å‡½æ•°æ—ä»‹ç»</h3><p><strong>execå‡½æ•°æ—çš„ä½œç”¨æ˜¯æ ¹æ®æŒ‡å®šçš„æ–‡ä»¶åæ‰¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç„¶åç”¨å®ƒæ›¿æ¢å½“å‰æˆ‘ä»¬è°ƒç”¨çš„è¿›ç¨‹çš„å†…å®¹ç„¶åå»æ‰§è¡Œ</strong></p><p><strong>ä¸ºäº†ä¿æŠ¤å½“å‰çš„è¿›ç¨‹çš„å†…å®¹ï¼Œä¸€èˆ¬åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ç„¶åè®©execå‡½æ•°æ—å»æ›¿æ¢å­è¿›ç¨‹çš„å†…å®¹å»æ‰§è¡Œï¼Œè¿™æ ·å°±å¥½äº†</strong></p><p><strong>æ‰§è¡ŒæˆåŠŸäº†ä¸ä¼šè¿”å›ï¼Œå› ä¸ºæ–°çš„å·²ç»å–ä»£äº†æ—§çš„ï¼Œæ—§çš„å†æ¥å—è¿”å›å€¼å¹¶åšæ“ä½œæ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼›åªæœ‰è°ƒç”¨å¤±è´¥äº†æ‰ä¼šè¿”å›-1ï¼Œè¿™ä¸ªæ—¶å€™æ–°çš„ä¸ä¼šè¿›æ¥ï¼Œè¿˜æ˜¯æ—§çš„</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718152959795.png" alt="image-20230718152959795"></p><p>å›¾è§£</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718154755731.png" alt="image-20230718154755731"></p><h3 id="å‡½æ•°æ—é™„å›¾"><a href="#å‡½æ•°æ—é™„å›¾" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å‡½æ•°æ—é™„å›¾"></a> å‡½æ•°æ—(é™„å›¾)</h3><p><strong>å‰é¢6ä¸ªå‡½æ•°æ˜¯Cæ ‡å‡†åº“å½“ä¸­çš„å‡½æ•°ï¼Œæœ€åä¸€ä¸ª(execve)æ˜¯Linuxä¸‹çš„ç³»ç»Ÿå‡½æ•°</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718154816547.png" alt="image-20230718154816547"></p><h4 id="execl"><a href="#execl" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#execl"></a> execl()</h4><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">execl</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *pathname, <span class="type">const</span> <span class="type">char</span> *arg, ... , (<span class="type">char</span> *) <span class="literal">NULL</span> )</span></span>;</span><br><span class="line"><span class="comment">//å‚æ•°ï¼š</span></span><br><span class="line">    <span class="comment">//pathï¼šæŒ‡å®šçš„æ‰§è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ï¼Œä¾‹å¦‚ï¼ša.out æ¨èå†™ç»å¯¹è·¯å¾„</span></span><br><span class="line">    <span class="comment">//argï¼šå­—ç¬¦ä¸²ï¼Œæ˜¯å¯æ‰§è¡Œæ–‡ä»¶æ‰€éœ€è¦çš„å‚æ•°åˆ—è¡¨</span></span><br><span class="line">        <span class="comment">//ç¬¬ä¸€ä¸ªå‚æ•°(argå½“ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°!!)ä¸€èˆ¬æ²¡æœ‰ä½œç”¨ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œä¸€èˆ¬å†™çš„æ˜¯å¯æ‰§è¡Œçš„ç¨‹åºçš„åç§°</span></span><br><span class="line">        <span class="comment">//ä»ç¬¬äºŒå‚æ•°å¼€å§‹å¾€åï¼Œå°±æ˜¯ç¨‹åºæ‰§è¡Œæ‰€éœ€è¦çš„å‚æ•°åˆ—è¡¨</span></span><br><span class="line">        <span class="comment">//å‚æ•°æœ€åéœ€è¦ä»¥NULLç»“æŸ(å“¨å…µ)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿”å›å€¼ï¼š</span></span><br><span class="line">    <span class="comment">//åªæœ‰è°ƒç”¨é”™è¯¯ï¼Œæ‰ä¼šæœ‰è¿”å›å€¼ï¼Œä¸º-1ï¼Œä¸”è®¾ç½®errno</span></span><br><span class="line">    <span class="comment">//è°ƒç”¨æˆåŠŸä¸ä¼šæœ‰è¿”å›å€¼ï¼Œ</span></span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œåœ¨å­è¿›ç¨‹ä¸­æ‰§è¡Œexecå‡½æ•°æ—å½“ä¸­çš„å‡½æ•°</span></span><br><span class="line">    <span class="type">pid_t</span> child_pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (child_pid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (child_pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// çˆ¶è¿›ç¨‹</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I am parent process , pid : %d\n&quot;</span>, <span class="built_in">getpid</span>());</span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (child_pid == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// å­è¿›ç¨‹</span></span><br><span class="line">        <span class="built_in">execl</span>(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;hello&quot;</span>, <span class="literal">nullptr</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I am child process , pid : %d\n&quot;</span>, <span class="built_in">getpid</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;i = %d , pid = %d\n&quot;</span>, i, <span class="built_in">getpid</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ‰§è¡Œç»“æœï¼š</p><p>å¯ä»¥çœ‹å‡º child process è¿™å¥è¯æ²¡æœ‰æ‰“å°å‡ºæ¥ï¼Œä»–è¢«å¯æ‰§è¡Œæ–‡ä»¶helloæ›¿æ¢æ‰äº†ï¼Œæœ€åçš„æ‰“å°iæ˜¯çˆ¶è¿›ç¨‹æ‰“å°å‡ºæ¥çš„</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/02/01/image-20230718170703719.png" alt="image-20230718170703719"></p><p><strong>è¿˜å¯ä»¥è®©å…¶æ‰§è¡Œlinuxçš„shellå‘½ä»¤</strong></p><p>æ¯”å¦‚ ps aux å‘½ä»¤ï¼Œpså°±æ˜¯ä¸€ä¸ªå‘½ä»¤ï¼Œå¯¹åº”å¯æ‰§è¡Œæ–‡ä»¶ /usr/bin/ps</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œåœ¨å­è¿›ç¨‹ä¸­æ‰§è¡Œexecå‡½æ•°æ—å½“ä¸­çš„å‡½æ•°</span></span><br><span class="line">    <span class="type">pid_t</span> child_pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (child_pid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (child_pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// çˆ¶è¿›ç¨‹</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I am parent process , pid : %d\n&quot;</span>, <span class="built_in">getpid</span>());</span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (child_pid == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// å­è¿›ç¨‹</span></span><br><span class="line">        <span class="comment">// execl(&quot;hello&quot;, &quot;hello&quot;, nullptr);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯ä»¥æ‰§è¡Œlinuxç³»ç»Ÿè‡ªå·±çš„å¯æ‰§è¡Œç¨‹åºï¼Œæ¯”å¦‚pså‘½ä»¤(/usr/bin/ps)</span></span><br><span class="line">        <span class="built_in">execl</span>(<span class="string">&quot;/usr/bin/ps&quot;</span>, <span class="string">&quot;ps&quot;</span>, <span class="string">&quot;aux&quot;</span>, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I am child process , pid : %d\n&quot;</span>, <span class="built_in">getpid</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;i = %d , pid = %d\n&quot;</span>, i, <span class="built_in">getpid</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ‰§è¡Œç»“æœï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718171319019.png" alt="image-20230718171319019"></p><h4 id="execlp"><a href="#execlp" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#execlp"></a> execlp()</h4><p><strong>ä¸execl()å‡½æ•°çš„åŒºåˆ«æ˜¯execlp()å‡½æ•°é‡Œé¢ä¼ å…¥çš„æ˜¯å¯æ‰§è¡Œæ–‡ä»¶åï¼Œä¸æ˜¯è·¯å¾„ï¼›ä¼šè‡ªåŠ¨åˆ°ç¯å¢ƒå˜é‡ä¸­å»æŸ¥æ‰¾è¿™äº›å¯æ‰§è¡Œæ–‡ä»¶åï¼Œé€‚åˆç”¨ä½œç³»ç»Ÿçš„å‘½ä»¤ï¼Œè€Œexecl()ä¼ è·¯å¾„ï¼Œé€‚åˆè‡ªå·±çš„å¯æ‰§è¡Œæ–‡ä»¶(ä¸ç”¨é…ç½®ç¯å¢ƒå˜é‡)</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">execlp</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *file, <span class="type">const</span> <span class="type">char</span> *arg, ... , (<span class="type">char</span> *) <span class="literal">NULL</span> )</span></span>;</span><br><span class="line"><span class="comment">//å‚æ•°ï¼š</span></span><br><span class="line">    <span class="comment">//ä¼šåˆ°ç¯å¢ƒå˜é‡ä¸­æŸ¥æ‰¾å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ‰¾åˆ°äº†å°±æ‰§è¡Œï¼Œæ‰¾ä¸åˆ°å°±ä¸æˆåŠŸ!!!</span></span><br><span class="line">    <span class="comment">//fileï¼šéœ€è¦æ‰§è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶çš„æ–‡ä»¶åï¼Œä¸åŒ…å«è·¯å¾„!!!</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//argï¼šå­—ç¬¦ä¸²ï¼Œæ˜¯å¯æ‰§è¡Œæ–‡ä»¶æ‰€éœ€è¦çš„å‚æ•°åˆ—è¡¨</span></span><br><span class="line">        <span class="comment">//ç¬¬ä¸€ä¸ªå‚æ•°(argå½“ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°!!)ä¸€èˆ¬æ²¡æœ‰ä½œç”¨ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œä¸€èˆ¬å†™çš„æ˜¯å¯æ‰§è¡Œçš„ç¨‹åºçš„åç§°</span></span><br><span class="line">        <span class="comment">//ä»ç¬¬äºŒå‚æ•°å¼€å§‹å¾€åï¼Œå°±æ˜¯ç¨‹åºæ‰§è¡Œæ‰€éœ€è¦çš„å‚æ•°åˆ—è¡¨</span></span><br><span class="line">        <span class="comment">//å‚æ•°æœ€åéœ€è¦ä»¥NULLç»“æŸ(å“¨å…µ)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿”å›å€¼ï¼š</span></span><br><span class="line">    <span class="comment">//åªæœ‰è°ƒç”¨é”™è¯¯ï¼Œæ‰ä¼šæœ‰è¿”å›å€¼ï¼Œä¸º-1ï¼Œä¸”è®¾ç½®errno</span></span><br><span class="line">    <span class="comment">//è°ƒç”¨æˆåŠŸä¸ä¼šæœ‰è¿”å›å€¼</span></span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œåœ¨å­è¿›ç¨‹ä¸­æ‰§è¡Œexecå‡½æ•°æ—å½“ä¸­çš„å‡½æ•°</span></span><br><span class="line">    <span class="type">pid_t</span> child_pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (child_pid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (child_pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// çˆ¶è¿›ç¨‹</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I am parent process , pid : %d\n&quot;</span>, <span class="built_in">getpid</span>());</span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (child_pid == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// å­è¿›ç¨‹</span></span><br><span class="line">        <span class="comment">// execl(&quot;hello&quot;, &quot;hello&quot;, nullptr);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯ä»¥æ‰§è¡Œlinuxç³»ç»Ÿè‡ªå·±çš„å¯æ‰§è¡Œç¨‹åºï¼Œæ¯”å¦‚pså‘½ä»¤(/usr/bin/ps)</span></span><br><span class="line">        <span class="built_in">execlp</span>(<span class="string">&quot;ps&quot;</span>, <span class="string">&quot;ps&quot;</span>, <span class="string">&quot;aux&quot;</span>, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I am child process , pid : %d\n&quot;</span>, <span class="built_in">getpid</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;i = %d , pid = %d\n&quot;</span>, i, <span class="built_in">getpid</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>ä¾ç„¶èƒ½æ‰§è¡Œps aux å‘½ä»¤</p><h2 id="è¿›ç¨‹æ§åˆ¶"><a href="#è¿›ç¨‹æ§åˆ¶" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è¿›ç¨‹æ§åˆ¶"></a> è¿›ç¨‹æ§åˆ¶</h2><h3 id="è¿›ç¨‹é€€å‡º"><a href="#è¿›ç¨‹é€€å‡º" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è¿›ç¨‹é€€å‡º"></a> è¿›ç¨‹é€€å‡º</h3><p><strong>exit()æ˜¯æ ‡å‡†Cåº“çš„å‡½æ•°ï¼Œåœ¨linuxç³»ç»Ÿä¸‹åº•å±‚ä¼šè°ƒç”¨linuxç³»ç»Ÿçš„å‡½æ•°_exit()</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718194621050.png" alt="image-20230718194621050"></p><p>ä¸¤ä¸ªçš„åŒºåˆ«ï¼š<strong>exit()åœ¨è°ƒç”¨ä¹‹åéœ€è¦æ¯”_exit()åšæ›´å¤šçš„äº‹æƒ…ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå°±æ˜¯åˆ·æ–°I/Oç¼“å†²å…³é—­æ–‡ä»¶æè¿°ç¬¦</strong></p><p>å¯¹äºä¸‹é¢çš„ç¨‹åº</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;hello&quot;</span> &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;world&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// exit(0);</span></span><br><span class="line">    _exit(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>ä½¿ç”¨exit(0)å’Œ_exit(0)ä¼šæœ‰å¦‚ä¸‹ä¸¤ä¸ªä¸åŒç»“æœ</p><p>exit:</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718195742100.png" alt="image-20230718195742100"></p><p>_exit:</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/02/01/image-20230718195756973.png" alt="image-20230718195756973"></p><p>é‚£ä¹ˆä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿ</p><h4 id="åˆ·æ–°ç¼“å†²åŒºé—®é¢˜é‡è¦"><a href="#åˆ·æ–°ç¼“å†²åŒºé—®é¢˜é‡è¦" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#åˆ·æ–°ç¼“å†²åŒºé—®é¢˜é‡è¦"></a> åˆ·æ–°ç¼“å†²åŒºé—®é¢˜(é‡è¦)</h4><p><strong>c++å’Œcè¯­è¨€ä¸­çš„coutæˆ–è€…printf()ä¹Ÿå¥½ï¼Œæœ¬è´¨éƒ½æ˜¯printf()ï¼Œprintf()ä½œä¸ºCè¯­è¨€æ ‡å‡†åº“çš„å‡½æ•°ï¼Œå¹¶ä¸æ˜¯ç›´æ¥è¾“å‡ºåˆ°ç»ˆç«¯å±å¹•ä¸Šï¼Œè€Œæ˜¯å…ˆå†™åœ¨ç¼“å†²åŒºå½“ä¸­ï¼Œç„¶åå½“ç¼“å†²åŒºåˆ·æ–°çš„æ—¶å€™åœ¨æ¸…ç©ºç¼“å†²åŒºè¾“å‡ºåˆ°å±å¹•å½“ä¸­!!!</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718200326121.png" alt="image-20230718200326121"></p><p>äºæ˜¯ä¹åˆšæ‰çš„ä»£ç ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cout &lt;&lt; <span class="string">&quot;hello&quot;</span> &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;world&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// exit(0);</span></span><br><span class="line">_exit(<span class="number">0</span>);</span><br></pre></td></tr></table></div></figure><p>helloé‡åˆ°endlï¼Œç›¸å½“äº â€˜\nâ€™ï¼Œåˆ·æ–°ç¼“å†²åŒºï¼Œæ˜¾ç¤ºï¼›ç¬¬äºŒä¸ªworldåœ¨ç¼“å†²åŒºä¸­ï¼Œæœ¬æ¥æ­£å¸¸ç¨‹åºç»“æŸå°±æ˜¾ç¤ºåœ¨å±å¹•ä¸Šäº†ï¼Œç°åœ¨é‡åˆ°äº†_exit()ä¸åˆ·æ–°ç¼“å†²åŒºï¼Œé‚£ä¹ˆå°±ä¸¢æ‰äº†ï¼Œä¸æ˜¾ç¤º</p><h5 id="å˜å¼"><a href="#å˜å¼" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å˜å¼"></a> å˜å¼</h5><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è¿™ä¸ªç¨‹åºåœ¨è¾“å‡ºçš„æ—¶å€™ä¸ä¼šç«‹åˆ»è¾“å‡ºhelloï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™ç¼“å†²åŒºæ²¡æœ‰åˆ·æ–°ï¼Œä¼šè°2ç§’ï¼Œç„¶åreturn 0ä¸»ç¨‹åºç»“æŸçš„æ—¶å€™å†åˆ·æ–°ç¼“å†²åŒºè¿›è¡Œæ˜¾ç¤º!!!</p><h3 id="å­¤å„¿è¿›ç¨‹"><a href="#å­¤å„¿è¿›ç¨‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å­¤å„¿è¿›ç¨‹"></a> å­¤å„¿è¿›ç¨‹</h3><p><strong>çˆ¶è¿›ç¨‹æœ‰ä¹‰åŠ¡å›æ”¶å­è¿›ç¨‹çš„èµ„æºï¼Œä½†æ˜¯å½“çˆ¶è¿›ç¨‹ç»“æŸè€Œå­è¿›ç¨‹æœªç»“æŸçš„æ—¶å€™è¿™ä¸€ç‚¹æ— æ³•åšåˆ°ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™å†…æ ¸ä¼šæŠŠè¿™ä¸ªå­è¿›ç¨‹çš„çˆ¶è¿›ç¨‹è®¾ç½®ä¸ºinitè¿›ç¨‹(linuxä¸Šçš„ç¬¬ä¸€å±‚è¿›ç¨‹ï¼Œlinuxä¸‹çš„è¿›ç¨‹éƒ½æ˜¯ä¸æ–­çš„åˆ›å»ºå­è¿›ç¨‹è€Œåˆ›å»ºå‡ºæ¥çš„)ï¼Œinitè¿›ç¨‹ä¼šå¾ªç¯çš„wait()ç­‰å¾…è¿™ä¸ªå­è¿›ç¨‹ï¼Œå½“è¿™ä¸ªå­è¿›ç¨‹ç»“æŸäº†ä¹‹åï¼Œinitè¿›ç¨‹ä¼šå°†å…¶å›æ”¶ï¼Œå¤„ç†å–„åå·¥ä½œ!!!</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718202030384.png" alt="image-20230718202030384"></p><p>æ¼”ç¤ºä»£ç ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯çˆ¶è¿›ç¨‹è¿˜æ˜¯å­è¿›ç¨‹</span></span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;  <span class="comment">// çˆ¶è¿›ç¨‹èµ°ï¼Œè¿”å›çš„æ˜¯åˆ›å»ºçš„å­è¿›ç¨‹ç¼–å·</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I am parent process, pid : %d , ppid : %d\n&quot;</span>, <span class="built_in">getpid</span>(), <span class="built_in">getppid</span>());</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;  <span class="comment">// å­è¿›ç¨‹èµ°</span></span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">1</span>);           <span class="comment">// å¼ºåˆ¶è®©å­è¿›ç¨‹ç¡1ç§’ï¼Œè®©çˆ¶è¿›ç¨‹è·‘å®Œï¼Œå­è¿›ç¨‹ç§°ä¸ºå­¤å„¿è¿›ç¨‹</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I am child process, pid : %d , ppid : %d\n&quot;</span>, <span class="built_in">getpid</span>(), <span class="built_in">getppid</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// for</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++i) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;i : %d , pid : %d\n&quot;</span>, i, <span class="built_in">getpid</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è¾“å‡ºæ•ˆæœï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718203522772.png" alt="image-20230718203522772"></p><p><strong>çˆ¶è¿›ç¨‹åˆ›å»ºå‡ºæ¥å­è¿›ç¨‹ä¹‹åï¼Œå­è¿›ç¨‹ä¼‘çœ 1ç§’ï¼Œçˆ¶è¿›ç¨‹æ—©å·²è·‘å®Œï¼Œç»“æŸï¼Œå­è¿›ç¨‹äº¤ç»™_initè¿›ç¨‹ä½œä¸ºä»–çš„çˆ¶è¿›ç¨‹è¿›è¡Œç®¡ç†ï¼Œæ‰€ä»¥ä¼šæ˜¾ç¤ºç»ˆç«¯æ˜¯å› ä¸ºçˆ¶è¿›ç¨‹ç»“æŸäº†ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™å­è¿›ç¨‹å°šæœªç»“æŸï¼Œçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹åœ¨å†…æ ¸åŒºåŸŸæœ‰ä¸€äº›æ•°æ®æ˜¯ä¸€æ ·çš„ï¼Œæ¯”å¦‚æ–‡ä»¶æè¿°ç¬¦012çš„æ ‡å‡†è¾“å…¥ï¼Œè¾“å‡ºå’Œé”™è¯¯ï¼Œæ‰€ä»¥ä»ç„¶å¯ä»¥åœ¨å½“å‰ç»ˆç«¯è¾“å‡ºä¿¡æ¯ã€‚å¹¶ä¸”è¿™é‡Œ _initè¿˜è®©ä»–ç»“æŸä¹‹åé˜»å¡äº†</strong></p><h3 id="åƒµå°¸è¿›ç¨‹"><a href="#åƒµå°¸è¿›ç¨‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#åƒµå°¸è¿›ç¨‹"></a> åƒµå°¸è¿›ç¨‹</h3><p><strong>æ¯ä¸ªè¿›ç¨‹ç»“æŸä¹‹åï¼Œå†…æ ¸åŒºçš„PCBæ²¡æœ‰åŠæ³•è‡ªå·±é‡Šæ”¾ï¼Œéœ€è¦çˆ¶è¿›ç¨‹é‡Šæ”¾ï¼›ç”¨æˆ·åŒºçš„æ•°æ®å¯ä»¥è‡ªå·±é‡Šæ”¾</strong></p><p><strong>è¿›ç¨‹ç»ˆæ­¢çš„æ—¶å€™ï¼Œçˆ¶è¿›ç¨‹å°šæœªå›æ”¶ï¼Œå­è¿›ç¨‹çš„æ®‹ç•™èµ„æº(PCB)å­˜æ”¾åœ¨å†…æ ¸ä¸­ï¼Œå˜æˆäº†åƒµå°¸è¿›ç¨‹</strong></p><p><strong>åƒµå°¸è¿›ç¨‹ä¸èƒ½è¢« kill -9 æ€æ­»</strong></p><p><strong>åƒµå°¸è¿›ç¨‹å¤šäº†ä¼šå æ®è¿›ç¨‹å·ï¼Œè¿›ç¨‹å·èŒƒå›´ 0 ~ 32767ï¼Œå æ®å®Œäº†å°±ä¼šæœ‰å±é™©</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718203825193.png" alt="image-20230718203825193"></p><p>æ¼”ç¤ºä»£ç ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯çˆ¶è¿›ç¨‹è¿˜æ˜¯å­è¿›ç¨‹</span></span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;   <span class="comment">// çˆ¶è¿›ç¨‹èµ°ï¼Œè¿”å›çš„æ˜¯åˆ›å»ºçš„å­è¿›ç¨‹ç¼–å·</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;  <span class="comment">// å¼ºåˆ¶è®©çˆ¶è¿›ç¨‹ä¸€ç›´å¾ªç¯ï¼Œä¸é€€å‡ºï¼Œè®©å­è¿›ç¨‹ç»“æŸï¼Œçˆ¶è¿›ç¨‹æ²¡åŠæ³•å›æ”¶ä»–çš„èµ„æº</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;I am parent process, pid : %d , ppid : %d\n&quot;</span>, <span class="built_in">getpid</span>(), <span class="built_in">getppid</span>());</span><br><span class="line">            <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;  <span class="comment">// å­è¿›ç¨‹èµ°</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I am child process, pid : %d , ppid : %d\n&quot;</span>, <span class="built_in">getpid</span>(), <span class="built_in">getppid</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è¾“å‡ºç»“æœï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718205238264.png" alt="image-20230718205238264"></p><p>å¯ä»¥çœ‹å‡ºï¼Œå­è¿›ç¨‹ç»“æŸäº†ä½†æ˜¯çˆ¶è¿›ç¨‹æ²¡ç»“æŸï¼Œæ²¡æœ‰åŠæ³•é‡Šæ”¾å­è¿›ç¨‹å†…æ ¸åŒºåŸŸçš„æ•°æ®ï¼Œå¯¼è‡´äº†åƒµå°¸è¿›ç¨‹</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/02/01/image-20230718205324350.png" alt="image-20230718205324350"></p><p>ç°åœ¨çš„çŠ¶æ€ï¼Œå­è¿›ç¨‹Z+ä»£è¡¨æ˜¯åƒµå°¸è¿›ç¨‹ï¼Œ&lt; defunct &gt;ä»£è¡¨ä¸å­˜åœ¨çš„ï¼›çˆ¶è¿›ç¨‹S+ä»£è¡¨ç¡çœ </p><p>kill -9 æ€ä¸æ‰åƒµå°¸è¿›ç¨‹</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718205637544.png" alt="image-20230718205637544"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/02/01/image-20230718205647171.png" alt="image-20230718205647171"></p><p><strong>è¿™ä¸ªæ—¶å€™æƒ³è¦è§£å†³è¿™ä¸ªé—®é¢˜åªèƒ½æ€æ‰çˆ¶è¿›ç¨‹ï¼ŒæŠŠå­è¿›ç¨‹æ‰˜ç®¡ç»™ /init ï¼Œè¿™æ ·æ‰èƒ½å°†å…¶é‡Šæ”¾ï¼Œä½†æ˜¯å®é™…å¼€å‘å½“ä¸­æ€æ‰çˆ¶è¿›ç¨‹å¾€å¾€ä¸ç°å®ï¼Œæ‰€ä»¥éœ€è¦çˆ¶è¿›ç¨‹è°ƒç”¨wait()å’Œwaitpid()æ¥ä¿è¯çˆ¶è¿›ç¨‹ä¼šæŠŠå­è¿›ç¨‹çš„å†…æ ¸PCBçš„æ•°æ®ç»™é‡Šæ”¾æ‰ï¼Œè¿™æ ·æ‰èƒ½é¿å…åƒµå°¸è¿›ç¨‹</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718210109506.png" alt="image-20230718210109506"></p><h3 id="è¿›ç¨‹å›æ”¶"><a href="#è¿›ç¨‹å›æ”¶" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è¿›ç¨‹å›æ”¶"></a> è¿›ç¨‹å›æ”¶</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718211154805.png" alt="image-20230718211154805"></p><h4 id="wait"><a href="#wait" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#wait"></a> wait()</h4><p><strong>ä¸ºäº†é¿å…åƒµå°¸è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹éœ€è¦å›æ”¶å­è¿›ç¨‹çš„èµ„æº</strong></p><p><strong>wait()å‡½æ•°ä¼šé˜»å¡ï¼Œçˆ¶è¿›ç¨‹è°ƒç”¨ä¹‹åä¼šé˜»å¡åœ¨é‚£é‡Œç­‰å¾…å­è¿›ç¨‹ç»“æŸç„¶åé‡Šæ”¾å­è¿›ç¨‹çš„èµ„æº</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">pid_t</span> <span class="title">wait</span><span class="params">(<span class="type">int</span> *wstatus)</span></span>;</span><br><span class="line"><span class="comment">//åŠŸèƒ½ï¼šç­‰å¾…ä»»æ„ä¸€ä¸ªå­è¿›ç¨‹ç»“æŸï¼Œå¦‚æœä»»æ„ä¸€ä¸ªå­è¿›ç¨‹ç»“æŸäº†ï¼Œæ­¤å‡½æ•°ä¼šå›æ”¶è¿™ä¸ªå­è¿›ç¨‹çš„èµ„æº</span></span><br><span class="line"><span class="comment">//å‚æ•°ï¼šint *wstatus</span></span><br><span class="line">    <span class="comment">//è¿›ç¨‹é€€å‡ºæ—¶å€™çš„çŠ¶æ€ä¿¡æ¯ï¼Œä¼ å…¥çš„æ˜¯ä¸€ä¸ªintç±»å‹çš„åœ°å€ï¼Œä¼ å‡ºå‚æ•°</span></span><br><span class="line"><span class="comment">//è¿”å›å€¼ï¼š</span></span><br><span class="line">    <span class="comment">//æˆåŠŸ è¿”å›è¢«å›æ”¶çš„å­è¿›ç¨‹çš„id</span></span><br><span class="line">    <span class="comment">//å¤±è´¥ -1(æ‰€æœ‰çš„å­è¿›ç¨‹éƒ½ç»“æŸï¼Œè°ƒç”¨å‡½æ•°å¤±è´¥) å¹¶ä¸”ä¿®æ”¹errno</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è°ƒç”¨wait()å‡½æ•°ï¼Œè¿›ç¨‹ä¼šé˜»å¡ï¼ŒçŸ¥é“ä»–çš„ä¸€ä¸ªå­è¿›ç¨‹é€€å‡ºæˆ–è€…æ”¶åˆ°ä¸€ä¸ªä¸èƒ½è¢«å¿½ç•¥çš„ä¿¡å·ï¼Œè¿™ä¸ªæ—¶å€™æ‰è¢«å”¤é†’</span></span><br><span class="line"><span class="comment">//å¦‚æœæ²¡æœ‰å­è¿›ç¨‹ï¼Œè¿™ä¸ªå‡½æ•°ç«‹åˆ»è¿”å›-1ï¼›å¦‚æœå­è¿›ç¨‹éƒ½å·²ç»ç»“æŸäº†ï¼Œä¹Ÿä¼šè¿”å›-1</span></span><br></pre></td></tr></table></div></figure><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æœ‰ä¸€ä¸ªçˆ¶è¿›ç¨‹ï¼Œåˆ›å»º5ä¸ªå­è¿›ç¨‹</span></span><br><span class="line">    <span class="type">pid_t</span> pid;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i) &#123;</span><br><span class="line">        pid = fork();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (pid == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (pid == <span class="number">0</span>)  <span class="comment">// è¯´æ˜æ˜¯å­è¿›ç¨‹ï¼Œå¦‚æœä¸åŠ è¿™è¡Œä»£ç ï¼Œå­è¿›ç¨‹ä¹Ÿä¼šèµ°forå¾ªç¯ï¼Œä»–ä¹Ÿä¼šfork()äº§ç”Ÿæ›´å¤šçš„å­™å­è¿›ç¨‹ï¼Œé‡å­™è¿›ç¨‹ç­‰ç­‰</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// çˆ¶è¿›ç¨‹</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;parent , pid = %d\n&quot;</span>, <span class="built_in">getpid</span>());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// int ret = wait(NULL);</span></span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> status;</span><br><span class="line">            <span class="type">int</span> ret = <span class="built_in">wait</span>(&amp;status);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;child die,pid = %d\n&quot;</span>, ret);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// å­è¿›ç¨‹</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;child , pid = %d\n&quot;</span>, <span class="built_in">getpid</span>());</span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è¿™ä¸ªä»£ç ç”¨çˆ¶è¿›ç¨‹åˆ›å»ºäº†5ä¸ªå­è¿›ç¨‹(æ³¨æ„çœ‹æ€ä¹ˆåˆ›å»ºçš„)ï¼Œçˆ¶è¿›ç¨‹ä¸­ç”¨wait()å‡½æ•°é˜»å¡ç­‰å¾…å­è¿›ç¨‹ç»“æŸï¼Œå­è¿›ç¨‹ç»“æŸä¸€ä¸ªï¼Œçˆ¶è¿›ç¨‹è¾“å‡ºå…³äºretçš„ä¸€æ®µä¿¡æ¯è¡¨ç¤ºå­è¿›ç¨‹å·²ç»è¢«å›æ”¶ï¼Œç„¶åé‡å¤ï¼Œç›´åˆ°æ‰€æœ‰å­è¿›ç¨‹å…¨éƒ¨ç»“æŸè¢«å›æ”¶å®Œæ¯•ï¼›è¿™ä¸ªæ—¶å€™çˆ¶è¿›ç¨‹ä¾ç„¶åœ¨å¾ªç¯ï¼Œåªä¸è¿‡wait()è¿”å›-1</p><p>æ‰§è¡Œç»“æœï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719094953685.png" alt="image-20230719094953685"></p><p>ç¨åŠ ä¿®æ”¹ï¼Œç°åœ¨æˆ‘éœ€è¦æŸ¥çœ‹è¿›ç¨‹é€€å‡ºçš„çŠ¶æ€ï¼š</p><p>æˆ‘è®©è¿›ç¨‹æ­£å¸¸é€€å‡º</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æœ‰ä¸€ä¸ªçˆ¶è¿›ç¨‹ï¼Œåˆ›å»º5ä¸ªå­è¿›ç¨‹</span></span><br><span class="line">    <span class="type">pid_t</span> pid;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i) &#123;</span><br><span class="line">        pid = fork();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (pid == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (pid == <span class="number">0</span>)  <span class="comment">// è¯´æ˜æ˜¯å­è¿›ç¨‹ï¼Œå¦‚æœä¸åŠ è¿™è¡Œä»£ç ï¼Œå­è¿›ç¨‹ä¹Ÿä¼šèµ°forå¾ªç¯ï¼Œä»–ä¹Ÿä¼šfork()äº§ç”Ÿæ›´å¤šçš„å­™å­è¿›ç¨‹ï¼Œé‡å­™è¿›ç¨‹ç­‰ç­‰</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// çˆ¶è¿›ç¨‹</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;parent , pid = %d\n&quot;</span>, <span class="built_in">getpid</span>());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// int ret = wait(NULL);</span></span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> status;</span><br><span class="line">            <span class="type">int</span> ret = <span class="built_in">wait</span>(&amp;status);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (ret == <span class="number">-1</span>)  <span class="comment">// æ²¡æœ‰å­è¿›ç¨‹</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æœ‰å­è¿›ç¨‹ï¼Œå›æ”¶äº†å­è¿›ç¨‹çš„èµ„æº</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">WIFEXITED</span>(status)) &#123;  <span class="comment">// æ˜¯ä¸æ˜¯æ­£å¸¸é€€å‡º</span></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;é€€å‡ºçš„çŠ¶æ€ç : %d\n&quot;</span>, <span class="built_in">WEXITSTATUS</span>(status));</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">WIFSIGNALED</span>(status)) &#123;  <span class="comment">// æ˜¯ä¸æ˜¯å¼‚å¸¸é€€å‡º</span></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;è¢«å“ªä¸ªä¿¡å·å¹²æ‰äº†: %d\n&quot;</span>, <span class="built_in">WTERMSIG</span>(status));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;child die,pid = %d\n&quot;</span>, ret);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// å­è¿›ç¨‹</span></span><br><span class="line">        <span class="comment">// while(1) &#123;</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;child , pid = %d\n&quot;</span>, <span class="built_in">getpid</span>());</span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">	    <span class="comment">// &#125;</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è¿™ä¸ªæ—¶å€™å­è¿›ç¨‹é€€å‡ºæ—¶å€™è°ƒç”¨Cæ ‡å‡†åº“å‡½æ•°exit(0)ï¼ŒçŠ¶æ€ç å°±æ˜¯0ï¼Œå› æ­¤æ­£å¸¸é€€å‡ºçš„çŠ¶æ€ç ç”¨å›¾ä¸­å½¢å¼æ¥å—å¹¶æ‰“å°</p><p>æ‰§è¡Œç»“æœï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719095319683.png" alt="image-20230719095319683"></p><p>ç°åœ¨æˆ‘æŠŠå­è¿›ç¨‹æ”¹æˆwhile(1)å¾ªç¯ï¼Œç„¶åç”¨ kill -9 æ€æ‰ä»–ï¼Œçœ‹çœ‹ä»–æ˜¯è¢«å“ªä¸ªä¿¡å·å¹²æ‰çš„</p><h5 id="é€€å‡ºä¿¡æ¯å®å‡½æ•°statusç›¸å…³"><a href="#é€€å‡ºä¿¡æ¯å®å‡½æ•°statusç›¸å…³" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#é€€å‡ºä¿¡æ¯å®å‡½æ•°statusç›¸å…³"></a> é€€å‡ºä¿¡æ¯å®å‡½æ•°(statusç›¸å…³)</h5><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230718220547310.png" alt="image-20230718220547310"></p><p>æ‰§è¡Œç»“æœï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719095606504.png" alt="image-20230719095606504"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719095625400.png" alt="image-20230719095625400"></p><h4 id="waitpid"><a href="#waitpid" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#waitpid"></a> waitpid()</h4><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">pid_t</span> <span class="title">waitpid</span><span class="params">(<span class="type">pid_t</span> pid, <span class="type">int</span> *_Nullable wstatus, <span class="type">int</span> options)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šå›æ”¶æŒ‡å®šè¿›ç¨‹å·çš„å­è¿›ç¨‹ï¼Œå¯ä»¥è®¾ç½®æ˜¯å¦é˜»å¡</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">//     pidï¼š&gt; 0 è¡¨ç¤ºæŸä¸ªå­è¿›ç¨‹çš„id</span></span><br><span class="line"><span class="comment">//         == 0 å›æ”¶å½“å‰è¿›ç¨‹ç»„çš„æ‰€æœ‰å­è¿›ç¨‹(æˆ‘è‡ªå·±çš„å­è¿›ç¨‹ä¸ä¸€å®šå’Œæˆ‘å±äºä¸€ä¸ªç»„ï¼Œæœ‰å¯èƒ½è¢«æˆ‘ç»™å‡ºå»äº†)</span></span><br><span class="line"><span class="comment">//         == -1 å›æ”¶æ‰€æœ‰çš„å­è¿›ç¨‹ï¼Œç›¸å½“äºwait()ï¼Œæœ€å¸¸ç”¨</span></span><br><span class="line"><span class="comment">//         &lt; -1 å›æ”¶æŸä¸ªè¿›ç¨‹ç»„å½“ä¸­çš„æ‰€æœ‰å­è¿›ç¨‹ï¼Œç»„å·æ˜¯è¿™ä¸ªå‚æ•°çš„ç»å¯¹å€¼</span></span><br><span class="line"><span class="comment">//     optionsï¼šè®¾ç½®é˜»å¡æˆ–è€…éé˜»å¡</span></span><br><span class="line"><span class="comment">//         0 é˜»å¡</span></span><br><span class="line"><span class="comment">//         WNOHANGï¼šéé˜»å¡</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼š</span></span><br><span class="line"><span class="comment">//     &gt; 0 è¿”å›å­è¿›ç¨‹çš„id</span></span><br><span class="line"><span class="comment">//     == 0 options = WNOHANGï¼Œè¡¨ç¤ºè¿˜æœ‰å­è¿›ç¨‹æ´»ç€</span></span><br><span class="line"><span class="comment">//     ==-1 é”™è¯¯ï¼Œå¹¶ä¸”è®¾ç½®é”™è¯¯å·ï¼Œåœ¨éé˜»å¡çš„æƒ…å†µä¸‹è¿”å›-1å¯ä»¥ä»£è¡¨æ²¡æœ‰å­è¿›ç¨‹äº†</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™ä¹ˆæ¥çœ‹,waitpid(-1,&amp;status,0) ç›¸å½“äºæ˜¯ wait(&amp;status)</span></span><br></pre></td></tr></table></div></figure><p>ä»£ç ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æœ‰ä¸€ä¸ªçˆ¶è¿›ç¨‹ï¼Œåˆ›å»º5ä¸ªå­è¿›ç¨‹</span></span><br><span class="line">    <span class="type">pid_t</span> pid;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i) &#123;</span><br><span class="line">        pid = fork();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (pid == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (pid == <span class="number">0</span>)  <span class="comment">// è¯´æ˜æ˜¯å­è¿›ç¨‹ï¼Œå¦‚æœä¸åŠ è¿™è¡Œä»£ç ï¼Œå­è¿›ç¨‹ä¹Ÿä¼šèµ°forå¾ªç¯ï¼Œä»–ä¹Ÿä¼šfork()äº§ç”Ÿæ›´å¤šçš„å­™å­è¿›ç¨‹ï¼Œé‡å­™è¿›ç¨‹ç­‰ç­‰</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// çˆ¶è¿›ç¨‹</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;parent , pid = %d\n&quot;</span>, <span class="built_in">getpid</span>());</span><br><span class="line">            <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// int ret = wait(NULL);</span></span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> status;</span><br><span class="line">            <span class="comment">// int ret = waitpid(-1, &amp;status, 0);        // é˜»å¡</span></span><br><span class="line">            <span class="type">int</span> ret = <span class="built_in">waitpid</span>(<span class="number">-1</span>, &amp;status, WNOHANG);  <span class="comment">// éé˜»å¡</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (ret == <span class="number">-1</span>)  <span class="comment">// æ²¡æœ‰å­è¿›ç¨‹</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (ret == <span class="number">0</span>)</span><br><span class="line">                <span class="comment">// éé˜»å¡å°±æ˜¯æ‰§è¡Œåˆ°è¿™ä¸ªä½ç½®åˆ¤æ–­ä¸€ä¸‹ï¼Œç„¶åé‡åˆ°äº†å°±å›æ”¶äº†ï¼Œæ²¡æœ‰å°±èµ°äº†</span></span><br><span class="line">                <span class="comment">// ret==0è¡¨æ˜è¿˜æœ‰å­è¿›ç¨‹æ´»ç€ï¼Œé‡å¼€å¾ªç¯åˆ¤æ–­</span></span><br><span class="line">                <span class="comment">// éé˜»å¡çš„å¥½å¤„ï¼šçˆ¶è¿›ç¨‹ä¸ç”¨ä¸€ç›´é˜»å¡è¿™ç­‰å¾…å­è¿›ç¨‹ç»“æŸï¼Œå¯ä»¥åšè‡ªå·±çš„é€»è¾‘ï¼Œç„¶åæ¯éš”ä¸€æ®µæ—¶é—´å°±å›æ¥çœ‹å­è¿›ç¨‹æ˜¯å¦è¿è¡Œå®Œæ¯•ç„¶åå›æ”¶ã€‚æé«˜æ•ˆç‡</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (ret &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// æœ‰å­è¿›ç¨‹ï¼Œå›æ”¶äº†å­è¿›ç¨‹çš„èµ„æº</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">WIFEXITED</span>(status)) &#123;  <span class="comment">// æ˜¯ä¸æ˜¯æ­£å¸¸é€€å‡º</span></span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;é€€å‡ºçš„çŠ¶æ€ç : %d\n&quot;</span>, <span class="built_in">WEXITSTATUS</span>(status));</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">WIFSIGNALED</span>(status)) &#123;  <span class="comment">// æ˜¯ä¸æ˜¯å¼‚å¸¸é€€å‡º</span></span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;è¢«å“ªä¸ªä¿¡å·å¹²æ‰äº†: %d\n&quot;</span>, <span class="built_in">WTERMSIG</span>(status));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;child die,pid = %d\n&quot;</span>, ret);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// å­è¿›ç¨‹</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;child , pid = %d\n&quot;</span>, <span class="built_in">getpid</span>());</span><br><span class="line">            <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>éé˜»å¡çš„å«ä¹‰ï¼šéé˜»å¡å°±æ˜¯æ‰§è¡Œåˆ°è¿™ä¸ªä½ç½®åˆ¤æ–­ä¸€ä¸‹ï¼Œç„¶åé‡åˆ°äº†å°±å›æ”¶äº†ï¼Œæ²¡æœ‰å°±èµ°äº†</p><p>éé˜»å¡çš„å¥½å¤„ï¼šçˆ¶è¿›ç¨‹ä¸ç”¨ä¸€ç›´é˜»å¡è¿™ç­‰å¾…å­è¿›ç¨‹ç»“æŸï¼Œå¯ä»¥åšè‡ªå·±çš„é€»è¾‘ï¼Œç„¶åæ¯éš”ä¸€æ®µæ—¶é—´å°±å›æ¥çœ‹å­è¿›ç¨‹æ˜¯å¦è¿è¡Œå®Œæ¯•ç„¶åå›æ”¶ã€‚æé«˜æ•ˆç‡</p><p>å›¾ä¸­çš„ä»£ç å«ä¹‰å°±æ˜¯ï¼šå­è¿›ç¨‹ä¸€ç›´å¾ªç¯è¾“å‡ºï¼Œçˆ¶è¿›ç¨‹æ¯æ¬¡éé˜»å¡çš„waitpid()ï¼Œæœ‰å­è¿›ç¨‹åˆ™é‡æ–°å¾ªç¯å†æ¬¡åˆ¤æ–­ï¼Œå¦‚æœå­è¿›ç¨‹ç»“æŸ(æ­£å¸¸æˆ–å¼‚å¸¸)ï¼Œåˆ™è¿›å…¥ä¸‹æ–¹å¾ªç¯è¾“å‡ºç›¸å…³ä¿¡æ¯ç„¶åå†å›å»å¾ªç¯</p><p>æ‰§è¡Œç»“æœï¼š</p><p>æˆ‘ä¸ç®¡ä»–æ˜¯è¿™æ ·ï¼Œå¯ä»¥çˆ¶è¿›ç¨‹æ˜¯éé˜»å¡çš„ä¸€ç›´åœ¨å·¥ä½œçš„</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719103805234.png" alt="image-20230719103805234"></p><p>ç°åœ¨æˆ‘æŠŠå­è¿›ç¨‹killæ‰</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719103852259.png" alt="image-20230719103852259"></p><p>killä¸€æ¬¡è¾“å‡ºä¸€ä¸ªä¿¡æ¯ï¼Œç„¶åkillå®Œæ¯•ä¹‹åç»“æŸè¿›ç¨‹</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719103900180.png" alt="image-20230719103900180"></p><h2 id="è¿›ç¨‹é—´é€šä¿¡-ipc"><a href="#è¿›ç¨‹é—´é€šä¿¡-ipc" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è¿›ç¨‹é—´é€šä¿¡-ipc"></a> è¿›ç¨‹é—´é€šä¿¡ IPC</h2><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ¦‚å¿µ"></a> æ¦‚å¿µ</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719104207710.png" alt="image-20230719104207710"></p><p>è¿›ç¨‹é—´é€šä¿¡æ–¹å¼(è®°å¿†!!!)</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719110333954.png" alt="image-20230719110333954"></p><h3 id="ç®¡é“"><a href="#ç®¡é“" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç®¡é“"></a> ç®¡é“</h3><p>ç®¡é“çš„æ•°æ®ç»“æ„æ˜¯ç¯å½¢é˜Ÿåˆ—ã€‚ä¸ºä»€ä¹ˆæ˜¯ç¯å½¢ï¼Ÿå¤§æ¦‚ç‡æ˜¯ä¸ºäº†å¤„ç†è¾¹ç•Œé—®é¢˜å§</p><p><strong>ç®¡é“æ‹¥æœ‰æ–‡ä»¶çš„ç‰¹è´¨ï¼Œè¯»æ“ä½œå’Œå†™æ“ä½œï¼›</strong></p><p><strong>åŒ¿åç®¡é“æ²¡æœ‰æ–‡ä»¶å®ä½“ï¼›æœ‰åç®¡é“æœ‰æ–‡ä»¶å®ä½“ï¼Œä½†æ˜¯ä¸å­˜å‚¨æ•°æ®</strong></p><p><strong>å¯ä»¥æŒ‰ç…§æ“ä½œæ–‡ä»¶çš„æ–¹å¼å¯¹ç®¡é“è¿›è¡Œæ“ä½œï¼Œä¹Ÿå…·æœ‰æ–‡ä»¶æè¿°ç¬¦ï¼Œæœ‰ä¸¤ä¸ªï¼Œåˆ†åˆ«æŒ‡å‘è¯»ç«¯å’Œå†™ç«¯</strong></p><p><strong>ä¸€ä¸ªç®¡é“å°±æ˜¯ä¸€ä¸ªå­—èŠ‚æµï¼Œç®¡é“æ²¡æœ‰æ¶ˆæ¯æˆ–è€…æ¶ˆæ¯è¾¹ç•Œçš„æ¦‚å¿µï¼Œä»ç®¡é“è¯»æ•°æ®å¯ä»¥ä»»æ„è¯»ï¼Œä¸ç”¨è€ƒè™‘å†™å…¥çš„æ•°æ®æ˜¯å¤šå°‘ï¼›å¹¶ä¸”ç®¡é“ä¼ é€’çš„æ•°æ®æ˜¯æœ‰é¡ºåºçš„</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719112527654.png" alt="image-20230719112527654"></p><p><strong>ç®¡é“å•å‘ï¼Œä¸€è¾¹å†™ï¼Œä¸€è¾¹è¯»ï¼›åŠåŒå·¥</strong></p><p><strong>åŒ¿åç®¡é“åªèƒ½åœ¨æ‹¥æœ‰å…±åŒç¥–å…ˆçš„è¿›ç¨‹å½“ä¸­ä½¿ç”¨ï¼Œä¾‹å¦‚çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ï¼›ä¸¤ä¸ªå…„å¼Ÿè¿›ç¨‹</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719143725384.png" alt="image-20230719143725384"></p><p><strong>ä¸ºä»€ä¹ˆå¯ä»¥ç”¨ç®¡é“é€šä¿¡</strong></p><p>çˆ¶è¿›ç¨‹ fork() ä¹‹åï¼Œå­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹å…±äº«äº†ä¸€ä»½è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦è¡¨ã€‚ç®¡é“ä¹Ÿå…·æœ‰æ–‡ä»¶çš„æ€§è´¨ï¼Œä»–çš„ä¸¤ç«¯åˆ†åˆ«å¯¹åº”è¯»å’Œå†™çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå› æ­¤éœ€è¦ä¸¤ä¸ªè¿›ç¨‹æŒ‡å‘è¿™åŒä¸€ä¸ªä½ç½®ï¼Œæ‰€ä»¥å¿…é¡»æ˜¯å…·æœ‰ä¸€å®šå…³ç³»çš„è¿›ç¨‹æ‰èƒ½ä½¿ç”¨ï¼Œå°±åƒå¦‚å›¾æ‰€ç¤ºï¼Œçˆ¶å­è¿›ç¨‹çš„5å·éƒ½å¯¹åº”å†™æ•°æ®ï¼Œ6å·éƒ½å¯¹åº”è¯»æ•°æ®ï¼Œç„¶åè¿™æ ·å°±å¯ä»¥è”ç³»èµ·æ¥äº†</p><h4 id="é‚£ä¹ˆåœ¨forkä¹‹å‰è¿˜æ˜¯forkä¹‹åå»ºç«‹ç®¡é“å‘¢"><a href="#é‚£ä¹ˆåœ¨forkä¹‹å‰è¿˜æ˜¯forkä¹‹åå»ºç«‹ç®¡é“å‘¢" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#é‚£ä¹ˆåœ¨forkä¹‹å‰è¿˜æ˜¯forkä¹‹åå»ºç«‹ç®¡é“å‘¢"></a> é‚£ä¹ˆåœ¨forkä¹‹å‰è¿˜æ˜¯forkä¹‹åå»ºç«‹ç®¡é“å‘¢ï¼Ÿ</h4><p><strong>ç­”æ¡ˆæ˜¯fork()ä¹‹å‰ã€‚</strong></p><p><strong>å› ä¸ºfork()ä¹‹å‰å»ºç«‹ç®¡é“ï¼Œæ¯”å¦‚å¦‚å›¾ï¼Œç®¡é“å æ®ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦5å’Œ6ï¼Œç°åœ¨fork()ä¹‹åï¼Œç”±äºç®¡é“å…·æœ‰æ–‡ä»¶æè¿°ç¬¦ï¼Œå­è¿›ç¨‹å†…æ ¸åŒºåŸŸæ–‡ä»¶æè¿°ç¬¦æŒ‡å‘çš„ä¸œè¥¿æ˜¯å’Œçˆ¶è¿›ç¨‹ä¸€å—ä¸œè¥¿ï¼Œæ‰€ä»¥ä»–ä»¬ä¸¤ä¸ªæŒ‡å‘çš„æ˜¯åŒä¸€å—ç®¡é“ï¼Œè¿™æ ·æ‰èƒ½è¿›è¡Œé€šä¿¡!!!</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719144556698.png" alt="image-20230719144556698"></p><p>ç®¡é“çš„æ•°æ®ç»“æ„ï¼šç¯å½¢é˜Ÿåˆ—</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719145008340.png" alt="image-20230719145008340"></p><h4 id="åŒ¿åç®¡é“pipe"><a href="#åŒ¿åç®¡é“pipe" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#åŒ¿åç®¡é“pipe"></a> åŒ¿åç®¡é“(pipe)</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719111308071.png" alt="image-20230719111308071"></p><p>çœ‹å¦‚å›¾çš„å‘½ä»¤ï¼š</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> | <span class="built_in">wc</span> -l</span><br></pre></td></tr></table></div></figure><p><strong>è¿™æ˜¯ä¸¤ä¸ªå‘½ä»¤ ls å’Œ wc -lï¼Œæ•´ä¸ªçš„ä½œç”¨å°±æ˜¯ç”¨lsæŸ¥çœ‹ç›®å½•ä¸‹çš„æ–‡ä»¶ç„¶åä¼ é€’ç»™ wc -l å‘½ä»¤å®ç°ç»Ÿè®¡å¹¶ä¸”åœ¨å±å¹•ä¸Šè¿›è¡Œè¾“å‡º</strong></p><p><strong>é‚£ä¹ˆæ€ä¹ˆè¿›è¡Œä¼ é€’å‘¢ï¼Ÿæˆ–è€…è¯´æ€ä¹ˆæŠŠlsè·å–åˆ°çš„æ•°æ®äº¤ç»™wcè¿›ç¨‹å‘¢ï¼Ÿ</strong></p><p><strong>è¿™å°±éœ€è¦ç®¡é“äº†ï¼Œå‘½ä»¤å½“ä¸­çš„ | å°±æ˜¯æŒ‡åœ¨ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´å»ºç«‹ä¸€ä¸ªåŒ¿åç®¡é“ï¼Œç„¶åå‰é¢çš„è¿›ç¨‹å‘åé¢çš„è¿›ç¨‹è¿›è¡Œé€šä¿¡ï¼Œæä¾›æ•°æ®ä¿¡æ¯</strong></p><p>åŒ¿åç®¡é“çš„ä½¿ç”¨</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/02/01/image-20230719145051553.png" alt="image-20230719145051553"></p><h5 id="pipe"><a href="#pipe" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#pipe"></a> pipe()</h5><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">pipe</span><span class="params">(<span class="type">int</span> pipefd[<span class="number">2</span>])</span></span>;</span><br><span class="line"><span class="comment">// åŠŸèƒ½ï¼šåˆ›å»ºä¸€ä¸ªåŒ¿åç®¡é“ï¼Œç”¨äºè¿›ç¨‹é—´é€šä¿¡</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼šint pipefd[2] è¿™ä¸ªæ•°ç»„æ˜¯ä¸€ä¸ªä¼ å‡ºå‚æ•°</span></span><br><span class="line"><span class="comment">//     pipefd[0] å¯¹åº”çš„æ˜¯ç®¡é“çš„è¯»ç«¯</span></span><br><span class="line"><span class="comment">//     pipefd[1] å¯¹åº”çš„æ˜¯ç®¡é“çš„å†™ç«¯</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼š</span></span><br><span class="line"><span class="comment">//     æˆåŠŸ 0</span></span><br><span class="line"><span class="comment">//     å¤±è´¥ -1ï¼Œå¹¶ä¸”è®¾ç½®errno</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨æ„ï¼šåŒ¿åç®¡é“åªèƒ½ç”¨äºå…·æœ‰å…³ç³»çš„è¿›ç¨‹é€šä¿¡ä¹‹é—´ï¼Œæ¯”å¦‚ï¼šçˆ¶å­è¿›ç¨‹ï¼Œå…„å¼Ÿè¿›ç¨‹ç­‰ç­‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     ç®¡é“é»˜è®¤æ˜¯é˜»å¡çš„ï¼Œå¦‚æœç®¡é“ä¸­æ²¡æœ‰æ•°æ®ï¼Œreadé˜»å¡ï¼›ç®¡é“æ»¡äº†ï¼Œwriteé˜»å¡</span></span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _size 1024</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å­è¿›ç¨‹å‘é€æ•°æ®ç»™çˆ¶è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹è¯»å–åˆ°æ•°æ®è¾“å‡º</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨forkä¹‹å‰åˆ›å»ºç®¡é“ï¼Œå› ä¸ºè¦æŒ‡å‘ä¸€ä¸ªç®¡é“</span></span><br><span class="line">    <span class="type">int</span> pipefd[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">pipe</span>(pipefd);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;pipe&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç®¡é“åˆ›å»ºæˆåŠŸäº†ï¼Œç°åœ¨åˆ›å»ºå­è¿›ç¨‹</span></span><br><span class="line">    <span class="type">pid_t</span> pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;  <span class="comment">// çˆ¶è¿›ç¨‹</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;i am parent process , pid : %d\n&quot;</span>, <span class="built_in">getpid</span>());</span><br><span class="line"></span><br><span class="line">        <span class="type">char</span> buf[_size] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="type">const</span> <span class="type">char</span> *str = <span class="string">&quot;hello,i am parent&quot;</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// è¯»æ•°æ®</span></span><br><span class="line">            <span class="comment">// readé»˜è®¤æ˜¯é˜»å¡çš„</span></span><br><span class="line">            <span class="built_in">read</span>(pipefd[<span class="number">0</span>], buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;parent recv : \&quot;%s\&quot; , pid : %d\n&quot;</span>, buf, <span class="built_in">getpid</span>());</span><br><span class="line">            <span class="comment">// è¯»å®Œæ¸…ç©ºbuf</span></span><br><span class="line">            <span class="built_in">bzero</span>(buf, _size);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å†™æ•°æ®</span></span><br><span class="line">            <span class="built_in">write</span>(pipefd[<span class="number">1</span>], str, <span class="built_in">strlen</span>(str));</span><br><span class="line">            <span class="comment">// readä¼šåœ¨ç¼“å†²åŒºç©ºçš„æ—¶å€™é˜»å¡ï¼Œçˆ¶è¿›ç¨‹å†™ä¸€æ¬¡å­è¿›ç¨‹è¯»ä¸€æ¬¡ï¼Œç„¶åå†æ¬¡é˜»å¡ï¼Œæ‰€ä»¥sleepæ˜¯åœ¨çˆ¶è¿›ç¨‹è¿™è¾¹</span></span><br><span class="line">            <span class="comment">// å¦‚æœåœ¨å­è¿›ç¨‹è¿™è¾¹sleepï¼Œçˆ¶è¿›ç¨‹åœ¨è¿™æ®µæ—¶é—´ç–¯ç‹‚å†™</span></span><br><span class="line">            <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;  <span class="comment">// å­è¿›ç¨‹</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;i am child process , pid : %d\n&quot;</span>, <span class="built_in">getpid</span>());</span><br><span class="line"></span><br><span class="line">        <span class="type">char</span> buf[_size] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="type">const</span> <span class="type">char</span> *str = <span class="string">&quot;hello,i am child&quot;</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// å†™æ•°æ®</span></span><br><span class="line">            <span class="built_in">write</span>(pipefd[<span class="number">1</span>], str, <span class="built_in">strlen</span>(str));</span><br><span class="line">            <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è¯»æ•°æ®</span></span><br><span class="line">            <span class="comment">// readé»˜è®¤æ˜¯é˜»å¡çš„</span></span><br><span class="line">            <span class="built_in">read</span>(pipefd[<span class="number">0</span>], buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;child recv : \&quot;%s\&quot; , pid : %d\n&quot;</span>, buf, <span class="built_in">getpid</span>());</span><br><span class="line">            <span class="comment">// è¯»å®Œæ¸…ç©ºbuf</span></span><br><span class="line">            <span class="built_in">bzero</span>(buf, _size);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è¿™ä¸ªç¨‹åºçš„æœ¬æ„æ˜¯è®©çˆ¶å­è¿›ç¨‹ä¹‹é—´å»ºç«‹ç®¡é“ï¼Œç„¶åå­è¿›ç¨‹å‘ç®¡é“å†™æ•°æ®ï¼Œçˆ¶è¿›ç¨‹æ¥å—æ•°æ®å¹¶è¾“å‡º</p><p>ä»£ç å½“ä¸­ç”¨äº†ä¸¤ä¸ªå¾ªç¯ï¼Œå­è¿›ç¨‹å¾ªç¯å†™æ•°æ®ç»™ç®¡é“ï¼Œçˆ¶è¿›ç¨‹è°ƒç”¨read()å‡½æ•°æ¥å—ï¼Œread()å‡½æ•°é»˜è®¤æ˜¯é˜»å¡çš„ï¼Œè°ƒç”¨while(1)ä¸€ç›´è¯»ï¼Œå› æ­¤æœ€åçš„ç»“æœæ˜¯è¿™æ ·</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719153654422.png" alt="image-20230719153654422"></p><p>å˜å¼ï¼š</p><p>çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ç›¸äº’é€šä¿¡ï¼Œä¸€ä¸ªé“ç†</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å­è¿›ç¨‹å‘é€æ•°æ®ç»™çˆ¶è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹è¯»å–åˆ°æ•°æ®è¾“å‡º</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨forkä¹‹å‰åˆ›å»ºç®¡é“ï¼Œå› ä¸ºè¦æŒ‡å‘ä¸€ä¸ªç®¡é“</span></span><br><span class="line">    <span class="type">int</span> pipefd[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">pipe</span>(pipefd);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;pipe&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç®¡é“åˆ›å»ºæˆåŠŸäº†ï¼Œç°åœ¨åˆ›å»ºå­è¿›ç¨‹</span></span><br><span class="line">    <span class="type">pid_t</span> pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;  <span class="comment">// çˆ¶è¿›ç¨‹</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;i am parent process , pid : %d\n&quot;</span>, <span class="built_in">getpid</span>());</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// è¯»æ•°æ®</span></span><br><span class="line">            <span class="type">char</span> buf[<span class="number">1024</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">            <span class="comment">// readé»˜è®¤æ˜¯é˜»å¡çš„</span></span><br><span class="line">            <span class="built_in">read</span>(pipefd[<span class="number">0</span>], buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;parent recv : \&quot;%s\&quot; , pid : %d\n&quot;</span>, buf, <span class="built_in">getpid</span>());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å†™æ•°æ®</span></span><br><span class="line">            <span class="type">const</span> <span class="type">char</span> *str = <span class="string">&quot;hello,i am parent&quot;</span>;</span><br><span class="line">            <span class="built_in">write</span>(pipefd[<span class="number">1</span>], str, <span class="built_in">strlen</span>(str));</span><br><span class="line">            <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;  <span class="comment">// å­è¿›ç¨‹</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;i am child process , pid : %d\n&quot;</span>, <span class="built_in">getpid</span>());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// å†™æ•°æ®</span></span><br><span class="line">            <span class="type">const</span> <span class="type">char</span> *str = <span class="string">&quot;hello,i am child&quot;</span>;</span><br><span class="line">            <span class="built_in">write</span>(pipefd[<span class="number">1</span>], str, <span class="built_in">strlen</span>(str));</span><br><span class="line">            <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è¯»æ•°æ®</span></span><br><span class="line">            <span class="type">char</span> buf[<span class="number">1024</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">            <span class="comment">// readé»˜è®¤æ˜¯é˜»å¡çš„</span></span><br><span class="line">            <span class="built_in">read</span>(pipefd[<span class="number">0</span>], buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;child recv : \&quot;%s\&quot; , pid : %d\n&quot;</span>, buf, <span class="built_in">getpid</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>çˆ¶å­è¿›ç¨‹éƒ½è®¾ç½®è¯»æ“ä½œå’Œå†™æ“ä½œï¼Œåªæ˜¯è¦æ³¨æ„ä¸€ç‚¹ï¼Œè¿™é‡Œé¡ºåºè¦ç›¸åï¼Œå› ä¸ºçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹å¦‚æœéƒ½å…ˆè¯»éƒ½é˜»å¡ç¨‹åºæ²¡åŠæ³•æ¨è¿›äº†</p><p>æ‰§è¡Œç»“æœï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230719153922897.png" alt="image-20230719153922897"></p><h5 id="fpathconf"><a href="#fpathconf" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#fpathconf"></a> fpathconf()</h5><p>ç”¨æ¥è·å–ç®¡é“ç¼“å†²åŒºçš„å¤§å°(4096 bytes)</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">long</span> <span class="title">fpathconf</span><span class="params">(<span class="type">int</span> fd, <span class="type">int</span> name)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šè·å–ç®¡é“çš„å¤§å°</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼šfd ç®¡é“çš„æ–‡ä»¶æè¿°ç¬¦(ä¸¤ä¸ªå¡«ä¸€ä¸ªå³å¯)</span></span><br><span class="line"><span class="comment">//     nameï¼šå®å€¼</span></span><br><span class="line"><span class="comment">//         è·å–å¤§å°ä½¿ç”¨ _PC_PIPE_BUF</span></span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> pipefd[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">pipe</span>(pipefd);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;pipe&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–ç®¡é“å¤§å°</span></span><br><span class="line">    <span class="type">long</span> size = <span class="built_in">fpathconf</span>(pipefd[<span class="number">0</span>], _PC_PIPE_BUF);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;pipe size : %ld\n&quot;</span>, size);  <span class="comment">// 4096</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h4 id="åŒ¿åç®¡é“é€šä¿¡æ¡ˆä¾‹"><a href="#åŒ¿åç®¡é“é€šä¿¡æ¡ˆä¾‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#åŒ¿åç®¡é“é€šä¿¡æ¡ˆä¾‹"></a> åŒ¿åç®¡é“é€šä¿¡æ¡ˆä¾‹</h4><h5 id="æ³¨æ„"><a href="#æ³¨æ„" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ³¨æ„"></a> æ³¨æ„</h5><p>åˆšæ‰çš„æ¡ˆä¾‹æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯è¯´åŒ¿åç®¡é“åœ¨å®ç°ç›¸äº’é€šä¿¡çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‡ºç°è¿›ç¨‹è‡ªå·±å†™çš„æ•°æ®è¢«è‡ªå·±è¯»å–</p><p>ä¸€èˆ¬çš„äº¤äº’æƒ…å†µå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721103551177.png" alt="image-20230721103551177"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721103558631.png" alt="image-20230721103558631"></p><p><strong>ä½†æ˜¯æœ‰å¯èƒ½åœ¨cpuåˆ†é…æ—¶é—´ç‰‡çš„æ—¶å€™å¤„ç†ä¸å¾—å½“ï¼Œæˆ–è€…è¯´æˆ‘å†™äº†æ•°æ®ä¹‹åå¿˜äº†åŠ sleepè®©è‡ªå·±çš„è¿›ç¨‹å’Œå¯¹é¢æŠ¢å¤ºreadï¼Œå°±å¯èƒ½å¯¼è‡´è‡ªå·±å†™çš„æ•°æ®è¢«è‡ªå·±è¯»å–ï¼Œå¹¶ä¸”åœ¨å®é™…å¼€å‘çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬è‚¯å®šä¸å¯èƒ½è®©å†™çš„ä¸€æ–¹sleepæ¥è®©å‡ºcpuè®©å¯¹æ–¹æ¥è¯»å–ï¼Œæ‰€ä»¥å°±å¾ˆå¯èƒ½å‡ºç°è¿™ç§æƒ…å†µï¼Œè¿™ä¸ªæ˜¯æ²¡æœ‰åŠæ³•é¿å…çš„</strong></p><p><strong>æ‰€ä»¥æˆ‘ä»¬åŒ¿åç®¡é“åœ¨å®é™…è¿ç”¨çš„æ—¶å€™ä¸€èˆ¬è§„å®šæ•°æ®æµåªä»ä¸€ç«¯æµå‘å¦ä¸€ç«¯ï¼Œä¸ä¼šå»å®ç°åŒå‘çš„æ•°æ®æµåŠ¨ï¼Œå› ä¸ºè¿™æ ·å°±å¯èƒ½å‘ç”Ÿè‡ªå·±æ•°æ®è¢«è‡ªå·±æ¥å—çš„æƒ…å†µ</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721103607149.png" alt="image-20230721103607149"></p><p>æ‰€ä»¥åœ¨å®é™…çš„å¼€å‘è¿‡ç¨‹ä¸­æˆ‘ä»¬å¾€å¾€ç›´æ¥å…³é—­ä¸€æ–¹çš„å†™ç«¯å’Œå¦ä¸€æ–¹çš„è¯»ç«¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>æˆ‘ä»¬æƒ³è¦çš„å°±æ˜¯ç¬¬ä¸‰ç§æƒ…å†µ</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721104349892.png" alt="image-20230721104349892" style="zoom:80%"><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _size 1024</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å­è¿›ç¨‹å‘é€æ•°æ®ç»™çˆ¶è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹è¯»å–åˆ°æ•°æ®è¾“å‡º</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨forkä¹‹å‰åˆ›å»ºç®¡é“ï¼Œå› ä¸ºè¦æŒ‡å‘ä¸€ä¸ªç®¡é“</span></span><br><span class="line">    <span class="type">int</span> pipefd[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">pipe</span>(pipefd);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;pipe&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç®¡é“åˆ›å»ºæˆåŠŸäº†ï¼Œç°åœ¨åˆ›å»ºå­è¿›ç¨‹</span></span><br><span class="line">    <span class="type">pid_t</span> pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;  <span class="comment">// çˆ¶è¿›ç¨‹</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;i am parent process , pid : %d\n&quot;</span>, <span class="built_in">getpid</span>());</span><br><span class="line"></span><br><span class="line">        <span class="type">char</span> buf[_size] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="comment">// const char *str = &quot;hello,i am parent&quot;;</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// è¯»æ•°æ®</span></span><br><span class="line">            <span class="comment">// readé»˜è®¤æ˜¯é˜»å¡çš„</span></span><br><span class="line">            <span class="built_in">read</span>(pipefd[<span class="number">0</span>], buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;parent recv : \&quot;%s\&quot; , pid : %d\n&quot;</span>, buf, <span class="built_in">getpid</span>());</span><br><span class="line">            <span class="comment">// è¯»å®Œæ¸…ç©ºbuf</span></span><br><span class="line">            <span class="built_in">bzero</span>(buf, _size);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å…³é—­å†™ç«¯</span></span><br><span class="line">            <span class="built_in">close</span>(pipefd[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;  <span class="comment">// å­è¿›ç¨‹</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;i am child process , pid : %d\n&quot;</span>, <span class="built_in">getpid</span>());</span><br><span class="line"></span><br><span class="line">        <span class="type">char</span> buf[_size] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="type">const</span> <span class="type">char</span> *str = <span class="string">&quot;hello,i am child&quot;</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// å†™æ•°æ®</span></span><br><span class="line">            <span class="built_in">write</span>(pipefd[<span class="number">1</span>], str, <span class="built_in">strlen</span>(str));</span><br><span class="line">            <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å…³é—­è¯»ç«¯</span></span><br><span class="line">            <span class="built_in">close</span>(pipefd[<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h5 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ¡ˆä¾‹"></a> æ¡ˆä¾‹(!!!)</h5><p>å®ç° ps aux | grep rootï¼Œçˆ¶å­è¿›ç¨‹ä¹‹é—´é€šä¿¡</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721115524021.png" alt="image-20230721115524021"></p><p>ä»£ç ï¼š(çœ‹ä»£ç ç†è§£!!!)</p><p>æ³¨æ„ï¼š</p><p>çˆ¶è¿›ç¨‹éœ€è¦è°ƒç”¨wait()å‡½æ•°æ¥é‡Šæ”¾å­è¿›ç¨‹ï¼Œé˜²æ­¢å‡ºç°åƒµå°¸è¿›ç¨‹;</p><p>dup2()å‡½æ•°çš„ä½œç”¨ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dup2</span><span class="params">(<span class="type">int</span> oldfd , <span class="type">int</span> newfd)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½œç”¨ï¼šé‡å®šå‘æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">    <span class="comment">//oldfdæŒ‡å‘a.txtï¼ŒnewfdæŒ‡å‘b.txt</span></span><br><span class="line">    <span class="comment">//è°ƒç”¨å‡½æ•°æˆåŠŸåï¼Œnewfdå’Œb.txtçš„è¿æ¥åšclose(oldfdä»æŒ‡å‘a.txt)ï¼ŒnewfdæŒ‡å‘a.txt</span></span><br><span class="line">    <span class="comment">//oldfdå¿…é¡»æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">    <span class="comment">//å¦‚æœç›¸åŒåˆ™ç›¸å½“äºä»€ä¹ˆéƒ½æ²¡åš</span></span><br><span class="line"><span class="comment">//è¿”å›å€¼ï¼š</span></span><br><span class="line">    <span class="comment">//newfdï¼Œä»–ä»¬éƒ½æŒ‡å‘çš„æ˜¯oldfdä¹‹å‰æŒ‡å‘çš„æ–‡ä»¶</span></span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _size 1024</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    å®ç° ps aux çˆ¶å­è¿›ç¨‹ä¹‹é—´é€šä¿¡</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    å­è¿›ç¨‹ï¼šps auxï¼Œå­è¿›ç¨‹ç»“æŸä¹‹åå°†æ•°æ®å‘é€ç»™çˆ¶è¿›ç¨‹</span></span><br><span class="line"><span class="comment">    çˆ¶è¿›ç¨‹ï¼šè·å–åˆ°æ•°æ®ï¼Œæ‰“å°</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    æ€è·¯ï¼š</span></span><br><span class="line"><span class="comment">    å­è¿›ç¨‹éœ€è¦æ‰§è¡Œ ps aux å‘½ä»¤ï¼Œè°ƒç”¨execæ—å‡½æ•°ï¼Œä½†æ˜¯è¿™äº›å‡½æ•°çš„é»˜è®¤è¾“å‡ºç«¯æ˜¯åœ¨stdout_fileno</span></span><br><span class="line"><span class="comment">    æ‰€ä»¥éœ€è¦ä½¿ç”¨dup2()å‡½æ•°å°†å…¶é‡å®šå‘åˆ°ç®¡é“çš„å†™ç«¯</span></span><br><span class="line"><span class="comment">    å°†è¯»å–çš„å†…å®¹å­˜åˆ°æ–‡æœ¬ä¸­ï¼Œç„¶åå»æ‰§è¡Œgrepå‘½ä»¤å³å¯</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºç®¡é“</span></span><br><span class="line">    <span class="type">int</span> pipefd[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">pipe</span>(pipefd);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;pipe&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºå­è¿›ç¨‹</span></span><br><span class="line">    <span class="type">pid_t</span> pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// çˆ¶è¿›ç¨‹</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…³é—­å†™ç«¯</span></span><br><span class="line">        <span class="built_in">close</span>(pipefd[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¯»</span></span><br><span class="line">        <span class="type">char</span> buf[_size] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="type">int</span> len = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…ˆæ‰“å¼€ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œå­˜åœ¨åˆ™åˆ é™¤å†åˆ›å»º</span></span><br><span class="line">        <span class="comment">// å»ºè®®ä¸è¦é‡å¤æ‰“å¼€ï¼Œè¿™é‡Œå°±æ‰“å¼€ä¸€æ¬¡ç„¶åå†™ï¼Œæœ€åå…³é—­å³å¯</span></span><br><span class="line">        <span class="type">int</span> fd = <span class="built_in">open</span>(<span class="string">&quot;file.txt&quot;</span>, O_RDONLY);</span><br><span class="line">        <span class="keyword">if</span> (fd != <span class="number">-1</span>)            <span class="comment">// å­˜åœ¨ï¼Œå°†å…¶åˆ é™¤</span></span><br><span class="line">            <span class="built_in">remove</span>(<span class="string">&quot;file.txt&quot;</span>);  <span class="comment">// ä¸èƒ½ç”¨exec()å‡½æ•°æ—ï¼Œå› ä¸ºè¿™å°±æŠŠè¿™ä¸ªä¸»è¿›ç¨‹æ›¿æ¢äº†ï¼Œä¸ä¼šå›æ¥</span></span><br><span class="line">        <span class="built_in">close</span>(fd);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç„¶ååˆ›å»ºä¸€ä¸ª</span></span><br><span class="line">        fd = <span class="built_in">open</span>(<span class="string">&quot;file.txt&quot;</span>, O_RDWR | O_CREAT, <span class="number">0664</span>);</span><br><span class="line">        <span class="keyword">if</span> (fd == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// -1 ç•™ä¸€ä¸ªç»“æŸç¬¦</span></span><br><span class="line">        <span class="comment">// å¾ªç¯è¯»</span></span><br><span class="line">        <span class="keyword">while</span> ((len = <span class="built_in">read</span>(pipefd[<span class="number">0</span>], buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>)) != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (len == <span class="number">-1</span>) &#123;</span><br><span class="line">                <span class="built_in">perror</span>(<span class="string">&quot;read&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// printf(&quot;%s&quot;, buf);</span></span><br><span class="line">            <span class="built_in">write</span>(fd, buf, <span class="built_in">strlen</span>(buf));</span><br><span class="line"></span><br><span class="line">            <span class="built_in">bzero</span>(buf, _size);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">close</span>(fd);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// grepç­›é€‰root</span></span><br><span class="line">        <span class="built_in">execlp</span>(<span class="string">&quot;grep&quot;</span>, <span class="string">&quot;grep&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;file.txt&quot;</span>, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// çˆ¶è¿›ç¨‹å›æ”¶å­è¿›ç¨‹èµ„æºé˜²æ­¢å‡ºç°åƒµå°¸è¿›ç¨‹</span></span><br><span class="line">        <span class="built_in">wait</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// å­è¿›ç¨‹</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…³é—­è¯»ç«¯</span></span><br><span class="line">        <span class="built_in">close</span>(pipefd[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†æ ‡å‡†è¾“å…¥stdout_filenoé‡å®šå‘åˆ°ç®¡é“çš„å†™ç«¯</span></span><br><span class="line">        <span class="comment">// dup2() newfdæŒ‡å‘oldfdæŒ‡å‘çš„ä½ç½®ï¼Œoldfdè¢«é‡Šæ”¾</span></span><br><span class="line">        <span class="type">int</span> ret = <span class="built_in">dup2</span>(pipefd[<span class="number">1</span>], STDOUT_FILENO);</span><br><span class="line">        <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;dup2&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨execå‡½æ•°æ—æ‰§è¡Œshellå‘½ä»¤ï¼Œä»–è¾“å‡ºé çš„æ˜¯çš„æ˜¯stdout_fileno</span></span><br><span class="line">        <span class="comment">// ä¸ºé˜²æ­¢ç®¡é“å¤§å°ä¸å¤Ÿï¼Œå¾ªç¯çš„å»æ‰§è¡Œä¿è¯æŒ‡ä»¤è¢«å†™å®Œ</span></span><br><span class="line">        <span class="keyword">while</span> (ret = <span class="built_in">execlp</span>(<span class="string">&quot;ps&quot;</span>, <span class="string">&quot;ps&quot;</span>, <span class="string">&quot;aux&quot;</span>, <span class="literal">nullptr</span>))</span><br><span class="line">            <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">                <span class="built_in">perror</span>(<span class="string">&quot;execlp&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ‰§è¡Œç»“æœï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721115546729.png" alt="image-20230721115546729"></p><h4 id="ç®¡é“çš„è¯»å†™ç‰¹ç‚¹"><a href="#ç®¡é“çš„è¯»å†™ç‰¹ç‚¹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç®¡é“çš„è¯»å†™ç‰¹ç‚¹"></a> ç®¡é“çš„è¯»å†™ç‰¹ç‚¹</h4><p>ä½¿ç”¨ç®¡é“çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ä¸€ä¸‹å‡ ç§ç‰¹æ®Šçš„æƒ…å†µ(å‡è®¾éƒ½æ˜¯é˜»å¡I/Oæ“ä½œ)ï¼š</p><ul><li><p><strong>æ‰€æœ‰æŒ‡å‘ç®¡é“å†™ç«¯çš„æ–‡ä»¶æè¿°ç¬¦éƒ½å…³é—­äº†(ç®¡é“å†™ç«¯å¼•ç”¨è®¡æ•°ä¸º0)ï¼Œæœ‰è¿›ç¨‹ä»ç®¡é“çš„è¯»ç«¯è¯»æ•°æ®ï¼Œé‚£ä¹ˆç®¡é“ä¸­å‰©ä½™çš„æ•°æ®è¢«è¯»å–ä»¥åï¼Œå†æ¬¡å»read()ä¼šè¿”å›0ï¼Œå°±åƒè¯»åˆ°æ–‡ä»¶æœ«å°¾ä¸€æ ·</strong></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œè¿™é‡Œçš„è¯»ç«¯è®¡æ•°ä¸º2ï¼Œå†™ç«¯è®¡æ•°ä¸º0</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721134808630.png" alt="image-20230721134808630"></p></li><li><p><strong>å¦‚æœæœ‰æŒ‡å‘ç®¡é“å†™ç«¯çš„æ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰å…³é—­(ç®¡é“å†™ç«¯çš„å¼•ç”¨è®¡æ•°å¤§äº0)ï¼Œè€ŒæŒæœ‰ç®¡é“å†™ç«¯çš„è¿›ç¨‹ä¹Ÿæ²¡æœ‰å¾€ç®¡é“ä¸­å†™æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™æœ‰è¿›ç¨‹å¾€ç®¡é“ä¸­è¯»å–æ•°æ®ï¼Œé‚£ä¹ˆç®¡é“ä¸­å‰©ä½™çš„æ•°æ®è¢«è¯»å–å®Œæ¯•ä¹‹åï¼Œå†æ¬¡readé˜»å¡ï¼Œç›´åˆ°ç®¡é“ä¸­æœ‰æ•°æ®å¯ä»¥è¯»å–äº†æ‰ä¼šè¯»å–æ•°æ®å¹¶ä¸”è¿”å›</strong><br><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721135603117.png" alt="image-20230721135603117"></p></li><li><p><strong>å¦‚æœæ‰€æœ‰æŒ‡å‘ç®¡é“è¯»ç«¯çš„æ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰å…³é—­(ç®¡é“è¯»ç«¯çš„å¼•ç”¨è®¡æ•°ä¸º0)ï¼Œè¿™ä¸ªæ—¶å€™æœ‰è¿›ç¨‹å‘ç®¡é“ä¸­å†™æ•°æ®ï¼Œé‚£ä¹ˆè¯¥è¿›ç¨‹ä¼šæ”¶åˆ°ä¸€ä¸ªä¿¡å·SIGPIPEï¼Œé€šå¸¸ä¼šå¯¼è‡´è¿›ç¨‹å¼‚å¸¸ç»ˆæ­¢</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721135452517.png" alt="image-20230721135452517"></p></li><li><p><strong>å¦‚æœæœ‰æŒ‡å‘ç®¡é“è¯»ç«¯çš„æ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰å…³é—­(ç®¡é“è¯»ç«¯çš„å¼•ç”¨è®¡æ•°å¤§äº0)ï¼Œè€ŒæŒæœ‰ç®¡é“è¯»ç«¯çš„è¿›ç¨‹ä¹Ÿæ²¡æœ‰ä»ç®¡é“ä¸­è¯»å–æ•°æ®ï¼Œè¿™æ—¶å€™æœ‰è¿›ç¨‹å‘ç®¡é“ä¸­å†™æ•°æ®ï¼Œé‚£ä¹ˆåœ¨ç®¡é“è¢«å†™æ»¡çš„æ—¶å€™å†æ¬¡è°ƒç”¨write()ä¼šé˜»å¡ï¼Œç›´åˆ°ç®¡é“ä¸­æœ‰ç©ºä½ç½®æ‰èƒ½å†æ¬¡å†™å…¥æ•°æ®å¹¶è¿”å›</strong><br><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721140511484.png" alt="image-20230721140511484"></p></li></ul><p>æ€»ç»“ï¼š</p><ul><li><strong>è¯»ç®¡é“ï¼š</strong><ul><li><strong>ç®¡é“ä¸­æœ‰æ•°æ®ï¼Œè¯»å–ä¼šè¿”å›å®é™…è¯»åˆ°çš„å­—èŠ‚æ•°</strong></li><li><strong>ç®¡é“ä¸­æ— æ•°æ®ï¼š</strong><ul><li><strong>å†™ç«¯å…¨éƒ¨å…³é—­ï¼Œreadè¿”å›0(ç›¸å½“äºè¯»åˆ°æ–‡ä»¶çš„æœ«å°¾)</strong></li><li><strong>å†™ç«¯æ²¡æœ‰å®Œå…¨å…³é—­ï¼Œreadé˜»å¡ç­‰å¾…</strong></li></ul></li></ul></li><li><strong>å†™ç®¡é“ï¼š</strong><ul><li><strong>ç®¡é“è¯»ç«¯å…¨éƒ¨å…³é—­ï¼Œäº§ç”Ÿä¿¡å·SIGPIPEï¼Œè¿›ç¨‹å¼‚å¸¸ç»ˆæ­¢</strong></li><li><strong>ç®¡é“è¯»ç«¯æ²¡æœ‰å…¨éƒ¨å…³é—­ï¼š</strong><ul><li><strong>ç®¡é“å·²æ»¡ï¼Œwriteé˜»å¡</strong></li><li><strong>ç®¡é“æ²¡æœ‰æ»¡ï¼Œwriteå°†æ•°æ®å†™å…¥ï¼Œå¹¶è¿”å›å®é™…å†™å…¥çš„å­—èŠ‚æ•°</strong></li></ul></li></ul></li></ul><h4 id="è®¾ç½®ç®¡é“éé˜»å¡fcntl"><a href="#è®¾ç½®ç®¡é“éé˜»å¡fcntl" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è®¾ç½®ç®¡é“éé˜»å¡fcntl"></a> è®¾ç½®ç®¡é“éé˜»å¡(fcntl)</h4><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">fcntl</span><span class="params">(<span class="type">int</span> fd, <span class="type">int</span> cmd, ...)</span></span>; ...å½“ä¸­æ˜¯å¯å˜å‚æ•°</span><br><span class="line"><span class="comment">// å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">//     fdï¼šéœ€è¦æ“ä½œçš„æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line"><span class="comment">//     cmdï¼šè¡¨ç¤ºå¯¹æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œå¦‚ä½•æ“ä½œ</span></span><br><span class="line"><span class="comment">//         F_DUPFD å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤åˆ¶çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦(è¿”å›å€¼)</span></span><br><span class="line"><span class="comment">//             int ret = fcntl(fd,F_DUPFD);</span></span><br><span class="line"><span class="comment">//         F_GETFL è·å–æŒ‡å®šæ–‡ä»¶æè¿°ç¬¦çš„æ–‡ä»¶çŠ¶æ€flag</span></span><br><span class="line"><span class="comment">//             è·å–çš„flagå’Œæˆ‘ä»¬é€šè¿‡openå‡½æ•°ä¼ é€’çš„flagæ˜¯ä¸€ä¸ªä¸œè¥¿</span></span><br><span class="line"><span class="comment">//         F_SETFL è®¾ç½®æ–‡ä»¶æè¿°ç¬¦çš„æ–‡ä»¶çŠ¶æ€flag</span></span><br><span class="line"><span class="comment">//             å¿…é€‰é¡¹ï¼šO_RDONLY O_WRONLY O_RDWR ä¸å¯ä»¥è¢«ä¿®æ”¹</span></span><br><span class="line"><span class="comment">//             å¯é€‰é¡¹ï¼šO_APPEND O_NONBLOCK</span></span><br><span class="line"><span class="comment">//                 O_APPEND è¡¨ç¤ºè¿½åŠ æ•°æ®</span></span><br><span class="line"><span class="comment">//                 O_NONBLOCK è®¾ç½®æˆéé˜»å¡</span></span><br><span class="line"><span class="comment">//                     é˜»å¡å’Œéé˜»å¡ï¼šæè¿°çš„æ˜¯å‡½æ•°è°ƒç”¨çš„è¡Œä¸º</span></span><br></pre></td></tr></table></div></figure><p>å¦‚ä½•è®¾ç½®ï¼Ÿ</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> flags = <span class="built_in">fcntl</span>(pipefd[<span class="number">0</span>], F_GETFL);</span><br><span class="line">flags |= O_NONBLOCK;</span><br><span class="line"><span class="built_in">fcntl</span>(pipefd[<span class="number">0</span>], F_SETFL, flags);</span><br></pre></td></tr></table></div></figure><p>ä»£ç ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _size 1024</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    è®¾ç½®ç®¡é“éé˜»å¡</span></span><br><span class="line"><span class="comment">    int flags =  fcntl(fd[0],F_GETFL); //è·å–åŸæ¥çš„flag</span></span><br><span class="line"><span class="comment">    flags | = O_NONBLOCK; //ä¿®æ”¹flagçš„å€¼</span></span><br><span class="line"><span class="comment">    fcntl(fd[0],F_SETFL,flags); //è®¾ç½®æ–°çš„flag</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å­è¿›ç¨‹å‘é€æ•°æ®ç»™çˆ¶è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹è¯»å–åˆ°æ•°æ®è¾“å‡º</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨forkä¹‹å‰åˆ›å»ºç®¡é“ï¼Œå› ä¸ºè¦æŒ‡å‘ä¸€ä¸ªç®¡é“</span></span><br><span class="line">    <span class="type">int</span> pipefd[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">pipe</span>(pipefd);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;pipe&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç®¡é“åˆ›å»ºæˆåŠŸäº†ï¼Œç°åœ¨åˆ›å»ºå­è¿›ç¨‹</span></span><br><span class="line">    <span class="type">pid_t</span> pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;  <span class="comment">// çˆ¶è¿›ç¨‹</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;i am parent process , pid : %d\n&quot;</span>, <span class="built_in">getpid</span>());</span><br><span class="line"></span><br><span class="line">        <span class="type">char</span> buf[_size] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> flags = <span class="built_in">fcntl</span>(pipefd[<span class="number">0</span>], F_GETFL);</span><br><span class="line">        flags |= O_NONBLOCK;</span><br><span class="line">        <span class="built_in">fcntl</span>(pipefd[<span class="number">0</span>], F_SETFL, flags);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…³é—­å†™ç«¯</span></span><br><span class="line">        <span class="built_in">close</span>(pipefd[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// è¯»æ•°æ®</span></span><br><span class="line">            <span class="comment">// readé»˜è®¤æ˜¯é˜»å¡çš„</span></span><br><span class="line">            <span class="comment">// è®¾ç½®æˆä¸ºéé˜»å¡</span></span><br><span class="line">            <span class="type">int</span> len = <span class="built_in">read</span>(pipefd[<span class="number">0</span>], buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;len = %d\n&quot;</span>, len);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;parent recv : \&quot;%s\&quot; , pid : %d\n&quot;</span>, buf, <span class="built_in">getpid</span>());</span><br><span class="line">            <span class="comment">// è¯»å®Œæ¸…ç©ºbuf</span></span><br><span class="line">            <span class="built_in">bzero</span>(buf, _size);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">sleep</span>(<span class="number">1</span>);  <span class="comment">// å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹ç¡çœ çš„æ—¶é—´ä¸åŒï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿çš„è§‚å¯Ÿæ˜¯å¦é˜»å¡</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;  <span class="comment">// å­è¿›ç¨‹</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;i am child process , pid : %d\n&quot;</span>, <span class="built_in">getpid</span>());</span><br><span class="line">        <span class="type">const</span> <span class="type">char</span> *str = <span class="string">&quot;hello,i am child&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…³é—­è¯»ç«¯</span></span><br><span class="line">        <span class="built_in">close</span>(pipefd[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// å†™æ•°æ®</span></span><br><span class="line">            <span class="built_in">write</span>(pipefd[<span class="number">1</span>], str, <span class="built_in">strlen</span>(str));</span><br><span class="line">            <span class="built_in">sleep</span>(<span class="number">5</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ‰§è¡Œç»“æœï¼š</p><p>å¯è§å­è¿›ç¨‹åœ¨ç¡çœ çš„æ—¶å€™çˆ¶è¿›ç¨‹æ‰§è¡Œåˆ°read()å¹¶æ²¡æœ‰é˜»å¡ï¼Œè€Œæ˜¯æ‰§è¡Œèµ°äº†!!!</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721145953793.png" alt="image-20230721145953793"></p><h4 id="æœ‰åç®¡é“fifo"><a href="#æœ‰åç®¡é“fifo" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æœ‰åç®¡é“fifo"></a> æœ‰åç®¡é“(FIFO)</h4><p><strong>æœ‰åç®¡é“å’ŒåŒ¿åç®¡é“çš„åŒºåˆ«åœ¨äºï¼šåŒ¿åç®¡é“æœ¬èº«æ²¡æœ‰ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æˆ–è€…è¯´è·¯å¾„å¯ä»¥è®©ä¸¤ä¸ªè¿›ç¨‹æ‰¾åˆ°ä»–ï¼Œè¿™å°±å¯¼è‡´æˆ‘ä»¬åªèƒ½é€šè¿‡æŸç§æ–¹å¼è®©ä¸¤ä¸ªè¿›ç¨‹æŒ‡å‘åŒä¸€å—ç®¡é“ï¼Œæ¯”å¦‚ä¸»è¿›ç¨‹å…ˆå»ºç«‹ç®¡é“ï¼Œç„¶ååˆ›å»ºå­è¿›ç¨‹ï¼Œè¿™æ ·ä¿è¯äº†ä¸¤ä¸ªè¿›ç¨‹çš„è¯»ç«¯å’Œå†™ç«¯çš„æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘çš„æ˜¯åŒæ ·çš„åŒ¿åç®¡é“çš„ä¸¤ç«¯ï¼Œè¿™æ ·å°±åªèƒ½ç”¨äºäº²ç¼˜å…³ç³»çš„è¿›ç¨‹ä¹‹é—´é€šä¿¡ï¼Œè€Œæœ‰åç®¡é“åˆ™æ°å¥½å…‹æœäº†è¿™ä¸ªé—®é¢˜ï¼›è®¾ç½®äº†ä¸€ä¸ªè·¯å¾„åæ–¹ä¾¿ä¸¤ä¸ªè¿›ç¨‹å…³è”ï¼Œå¹¶ä¸”è¿™ä¸ªè·¯å¾„åå¯ä»¥åƒæ–‡ä»¶ä¸€æ ·è¢«è®¿é—®(FIFO)ï¼Œè¿™æ ·å°±å¯ä»¥è¢«ä»»æ„å…³ç³»çš„ä¸¤ä¸ªè¿›ç¨‹æ‰¾åˆ°å¹¶ä¸”å»ºç«‹é€šä¿¡</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721150130194.png" alt="image-20230721150130194"></p><p>åŒºåˆ«ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721151257066.png" alt="image-20230721151257066"></p><h5 id="mkinfo"><a href="#mkinfo" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#mkinfo"></a> mkinfo()</h5><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721151329604.png" alt="image-20230721151329604"></p><p><strong>é€šè¿‡å‘½ä»¤ mkfifo &lt; name &gt;</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721152717230.png" alt="image-20230721152717230"></p><p>è¿™é‡Œåˆ›å»ºå¤±è´¥ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºwindowsç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿä¸æ”¯æŒç®¡é“æ–‡ä»¶(åŒ¿åç®¡é“æ²¡æœ‰ç®¡é“æ–‡ä»¶)</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721151935217.png" alt="image-20230721151935217"></p><p>åœ¨linuxç³»ç»Ÿè‡ªå·±çš„æœ¬åœ°æ–‡ä»¶å¤¹å½“ä¸­åˆ›å»º</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721152127780.png" alt="image-20230721152127780"></p><p><strong>è§‚å¯Ÿå‘ç°fifoæ–‡ä»¶çš„å¤§å°ä¸º0ï¼Œè¿™æ˜¯å› ä¸ºfifoç®¡é“æ–‡ä»¶çš„ä¿¡æ¯æ˜¯å­˜å‚¨åœ¨å†…æ ¸çš„ç¼“å†²åŒºé‡Œé¢çš„ï¼Œå½“ç¨‹åºç»“æŸä¹‹åä¾¿ä¼šæ¸…ç©ºï¼Œç•™ç»™ä¸‹ä¸€æ¬¡ä½¿ç”¨</strong></p><p><strong>é€šè¿‡å‡½æ•° mkfifo()</strong></p><p>æ³¨æ„è¿™é‡Œçš„è·¯å¾„ä¹Ÿæ˜¯linuxæœ¬åœ°æ–‡ä»¶å¤¹çš„è·¯å¾„ï¼Œå¦åˆ™å°±ä¼šè¢«æ‹’ç»</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// - é€šè¿‡å‡½æ•°</span></span><br><span class="line"> 	<span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line">	<span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">mkfifo</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *pathname, <span class="type">mode_t</span> mode)</span></span>;</span><br><span class="line"><span class="comment">// å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">//     pathnameï¼šç®¡é“åç§°çš„è·¯å¾„</span></span><br><span class="line"><span class="comment">//     modeï¼šæ–‡ä»¶çš„æƒé™ å’Œ open çš„ mode ä¸€æ ·ï¼Œå…«è¿›åˆ¶æ•°</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼š</span></span><br><span class="line"><span class="comment">//     æˆåŠŸ è¿”å›0</span></span><br><span class="line"><span class="comment">//     å¤±è´¥ è¿”å›-1ï¼Œå¹¶è®¾æ–½errno</span></span><br></pre></td></tr></table></div></figure><p>ä»£ç ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="comment">// access()å‡½æ•°å¯ä»¥è·å–æ–‡ä»¶çš„æƒé™å’ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">access</span>(<span class="string">&quot;/home/lzx0626/fuck/fifo&quot;</span>, F_OK);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ç®¡é“ä¸å­˜åœ¨ï¼Œåˆ›å»ºç®¡é“\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">        ret = <span class="built_in">mkfifo</span>(<span class="string">&quot;/home/lzx0626/fuck/fifo&quot;</span>, <span class="number">0664</span>);</span><br><span class="line">        <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;mkfifo&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>ç°åœ¨æˆ‘éœ€è¦å†™ä¸¤ä¸ªè¿›ç¨‹å¹¶ä¸”é€šè¿‡æœ‰åç®¡é“æ¥å®ç°é€šä¿¡ï¼Œå®ç°write.cppå’Œread.cpp</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// write.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _size 1024</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘ç®¡é“ä¸­å†™æ•°æ®</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­ç®¡é“æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">access</span>(<span class="string">&quot;/home/lzx0626/fuck/fifo&quot;</span>, F_OK);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ç®¡é“ä¸å­˜åœ¨ï¼Œåˆ›å»ºç®¡é“\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">        ret = <span class="built_in">mkfifo</span>(<span class="string">&quot;/home/lzx0626/fuck/fifo&quot;</span>, <span class="number">0664</span>);</span><br><span class="line">        <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;mkfifo&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å¼€ç®¡é“ï¼Œä»¥åªå†™çš„æ–¹å¼</span></span><br><span class="line">    <span class="type">int</span> fd = <span class="built_in">open</span>(<span class="string">&quot;/home/lzx0626/fuck/fifo&quot;</span>, O_WRONLY);</span><br><span class="line">    <span class="keyword">if</span> (fd == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†™æ•°æ®</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; ++i) &#123;</span><br><span class="line">        <span class="type">char</span> buf[_size];</span><br><span class="line">        <span class="built_in">sprintf</span>(buf, <span class="string">&quot;hello, %d&quot;</span>, i);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;write data : %s\n&quot;</span>, buf);</span><br><span class="line">        <span class="built_in">write</span>(fd, buf, <span class="built_in">strlen</span>(buf));</span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">close</span>(fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// read.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _size 1024</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘ç®¡é“ä¸­è¯»æ•°æ®</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ‰“å¼€ç®¡é“æ–‡ä»¶ï¼Œä»¥åªè¯»çš„æ–¹å¼</span></span><br><span class="line">    <span class="type">int</span> fd = <span class="built_in">open</span>(<span class="string">&quot;/home/lzx0626/fuck/fifo&quot;</span>, O_RDONLY);</span><br><span class="line">    <span class="keyword">if</span> (fd == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯»å–æ•°æ®</span></span><br><span class="line">    <span class="type">char</span> buf[_size] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">int</span> len = <span class="built_in">read</span>(fd, buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">        <span class="keyword">if</span> (len == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;å†™ç«¯æ–­å¼€è¿æ¥äº†...\n&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;recv buf : %s\n&quot;</span>, buf);</span><br><span class="line">        <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">close</span>(fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ‰§è¡Œç»“æœï¼š(æœ¬æ¥æƒ³å†™æ³¨æ„äº‹é¡¹çš„ï¼Œéƒ½åœ¨ä¸‹é¢äº†)</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721164727872.png" alt="image-20230721164727872"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721164735118.png" alt="image-20230721164735118"></p><p><strong>æœ‰åç®¡é“çš„æ³¨æ„äº‹é¡¹ï¼š</strong></p><ul><li><p><strong>ä¸€ä¸ªä¸ºè¯»è€Œæ‰“å¼€ä¸€ä¸ªç®¡é“çš„è¿›ç¨‹ä¼šé˜»å¡ï¼Œç›´åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ä¸ºå†™æ‰“å¼€ç®¡é“</strong></p></li><li><p><strong>ä¸€ä¸ªä¸ºå†™è€Œæ‰“å¼€ä¸€ä¸ªç®¡é“çš„è¿›ç¨‹ä¼šé˜»å¡ï¼Œç›´åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ä¸ºè¯»æ‰“å¼€ç®¡é“</strong><br><strong>(å¯è§æœ‰åç®¡é“çš„å®ç°è¿˜æ˜¯éå¸¸ä¸¥è°¨çš„ï¼ŒåŒæ–¹æ²¡æœ‰å°±ä½ä¸å¼€æ”¾)</strong></p><p>(æ‰€ä»¥æµ‹è¯•ç¨‹åºå½“ä¸­å…ˆåæ‰“å¼€ä¸¤ä¸ªè¿›ç¨‹å…ˆæ‰“å¼€çš„è¿›ç¨‹ä¼šç­‰å¾…åæ‰“å¼€çš„è¿›ç¨‹ï¼Œè¿™é‡Œé˜»å¡å°±æ˜¯å› ä¸ºè¿™ä¸ªï¼Œå¹¶ä¸”æ˜¯é˜»å¡åœ¨open()å‡½æ•°çš„ä½ç½®)</p></li></ul><p><strong>è¯»ç®¡é“ï¼š</strong></p><ul><li><strong>ç®¡é“ä¸­æœ‰æ•°æ®ï¼Œreadä¼šè¿”å›å®é™…è¯»å–åˆ°çš„æ•°æ®</strong></li><li><strong>ç®¡é“ä¸­æ— æ•°æ®ï¼š</strong><ul><li><strong>ç®¡é“å†™ç«¯è¢«å…¨éƒ¨å…³é—­ï¼Œreadè¿”å›0(ç›¸å½“äºè¯»åˆ°æ–‡ä»¶æœ«å°¾)</strong></li><li><strong>ç®¡é“å†™ç«¯æ²¡æœ‰è¢«å®Œå…¨å…³é—­ï¼Œreadé˜»å¡ç­‰å¾…</strong></li></ul></li></ul><p><strong>å†™ç®¡é“ï¼š</strong></p><ul><li><strong>ç®¡é“è¯»ç«¯è¢«å…¨éƒ¨å…³é—­ï¼Œè¿›ç¨‹å¼‚å¸¸ç»ˆæ­¢(æ”¶åˆ° SIGPIPEä¿¡å·)</strong></li><li><strong>ç®¡é“è¯»ç«¯æ²¡æœ‰å…¨éƒ¨å…³é—­ï¼š</strong><ul><li><strong>ç®¡é“å·²ç»æ»¡äº†ï¼Œwriteä¼šé˜»å¡</strong></li><li><strong>ç®¡é“æ²¡æœ‰æ»¡ï¼Œwriteä¼šå°†æ•°æ®å†™å…¥ï¼Œå¹¶ä¸”è¿”å›å®é™…å†™å…¥çš„å­—èŠ‚æ•°</strong></li></ul></li></ul><h4 id="æœ‰åç®¡é“é€šä¿¡æ¡ˆä¾‹"><a href="#æœ‰åç®¡é“é€šä¿¡æ¡ˆä¾‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æœ‰åç®¡é“é€šä¿¡æ¡ˆä¾‹"></a> æœ‰åç®¡é“é€šä¿¡æ¡ˆä¾‹</h4><p>å®ç°ä¸€ä¸ªç®€æ˜“èŠå¤©çš„åŠŸèƒ½ï¼Œå¾ªç¯è¯»å†™ï¼Œæˆ‘å†™ä½ è¯»ï¼Œä½ å†™æˆ‘è¯»</p><h5 id="æ€è·¯"><a href="#æ€è·¯" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ€è·¯"></a> æ€è·¯</h5><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230721170443404.png" alt="image-20230721170443404"></p><p>éœ€è¦æ³¨æ„ä¸€ç‚¹çš„å°±æ˜¯ä¸¤ä¸ªè¿›ç¨‹æ˜¯ä½ æ¥æˆ‘å¾€çš„ï¼Œæ‰€ä»¥éœ€è¦ä¸€æ–¹å…ˆå†™ï¼Œå¦ä¸€æ–¹å…ˆè¯»ï¼Œå¦åˆ™å°±ä¼šå¯¼è‡´é˜»å¡</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸€æ–¹çš„ä»£ç ï¼Œå¦ä¸€æ–¹ç¨åŠ ä¿®æ”¹å³å¯</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _size 1024</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æœ‰åç®¡é“æ–‡ä»¶1 2æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">access</span>(<span class="string">&quot;/home/lzx0626/FIFO/fifo1&quot;</span>, F_OK);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ç®¡é“1ä¸å­˜åœ¨,åˆ›å»ºç›¸å…³çš„ç®¡é“æ–‡ä»¶\n&quot;</span>);</span><br><span class="line">        ret = <span class="built_in">mkfifo</span>(<span class="string">&quot;/home/lzx0626/FIFO/fifo1&quot;</span>, <span class="number">0664</span>);</span><br><span class="line">        <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;mkfifo&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ret = <span class="built_in">access</span>(<span class="string">&quot;/home/lzx0626/FIFO/fifo2&quot;</span>, F_OK);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ç®¡é“2ä¸å­˜åœ¨,åˆ›å»ºç›¸å…³çš„ç®¡é“æ–‡ä»¶\n&quot;</span>);</span><br><span class="line">        ret = <span class="built_in">mkfifo</span>(<span class="string">&quot;/home/lzx0626/FIFO/fifo2&quot;</span>, <span class="number">0664</span>);</span><br><span class="line">        <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;mkfifo&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»¥åªå†™çš„æ–¹å¼æ‰“å¼€ç®¡é“1</span></span><br><span class="line">    <span class="type">int</span> fdw = <span class="built_in">open</span>(<span class="string">&quot;/home/lzx0626/FIFO/fifo1&quot;</span>, O_WRONLY);</span><br><span class="line">    <span class="keyword">if</span> (fdw == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;æ‰“å¼€ç®¡é“fifo1æˆåŠŸ,ç­‰å¾…å†™å…¥...\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»¥åªè¯»çš„æ–¹å¼æ‰“å¼€ç®¡é“2</span></span><br><span class="line">    <span class="type">int</span> fdr = <span class="built_in">open</span>(<span class="string">&quot;/home/lzx0626/FIFO/fifo2&quot;</span>, O_RDONLY);</span><br><span class="line">    <span class="keyword">if</span> (fdr == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;æ‰“å¼€ç®¡é“fifo2æˆåŠŸ,ç­‰å¾…è¯»å–...\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> buf[_size] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="comment">// å¾ªç¯çš„å†™è¯»æ•°æ®</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// å†™æ•°æ®</span></span><br><span class="line">        <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">        <span class="comment">// è·å–æ ‡å‡†è¾“å…¥çš„æ•°æ®</span></span><br><span class="line">        <span class="built_in">fgets</span>(buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>, stdin);  <span class="comment">// åŒ…å«äº†å›è½¦ç¬¦å·</span></span><br><span class="line">        <span class="comment">// å†™æ•°æ®</span></span><br><span class="line">        <span class="type">int</span> ret = <span class="built_in">write</span>(fdw, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;write&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¯»æ•°æ®</span></span><br><span class="line">        <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">        <span class="type">int</span> len = <span class="built_in">read</span>(fdr, buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">        <span class="keyword">if</span> (len == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;read&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (len == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;buf : %s&quot;</span>, buf);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­</span></span><br><span class="line">    <span class="built_in">close</span>(fdw);</span><br><span class="line">    <span class="built_in">close</span>(fdr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>é—®é¢˜æ¥äº†ï¼Œè¿™ä¸ªç¨‹åºåªèƒ½æˆ‘å†™äº†ä½ è¯»ï¼Œç„¶åä½ å†™äº†æˆ‘è¯»ï¼Œä¸èƒ½å®ç°éšæ„çš„äº¤æµï¼Œå› ä¸ºç¨‹åºçš„é€»è¾‘å°±æ˜¯å†™äº†ä¹‹åè¯»ï¼Œè¯»äº†ä¹‹åå†™ï¼Œå¦‚æœå†™äº†ä¹‹åå†å†™ï¼Œç”±äºè¯»æ˜¯é˜»å¡åœ¨é‚£é‡Œçš„ï¼Œæ‰€ä»¥å†™çš„ä¸œè¥¿ä¼šå­˜åœ¨ç»ˆç«¯stdinçš„ç¼“å†²åŒºå½“ä¸­ï¼Œç›´åˆ°read()ä¹‹åå†åˆ·æ–°</p><p>ç°åœ¨æˆ‘æƒ³è®©éšæ—¶é€šä¿¡ï¼Œéšæ„çš„è¯»å†™ï¼Œè¿™æ ·ä¸å¦¨å¯ä»¥è”æƒ³åˆ°å¯ä»¥è®©è¯»å’Œå†™çš„æ“ä½œç‹¬ç«‹èµ·æ¥ï¼Œå¯ä»¥ç”¨å­è¿›ç¨‹çš„æ–¹å¼ï¼Œçˆ¶è¿›ç¨‹ç»‘å®šè¯»ï¼Œå­è¿›ç¨‹ç»‘å®šå†™ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°äº†</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸€æ–¹çš„ä»£ç ï¼Œå¦ä¸€æ–¹ç¨å¾®ä¿®æ”¹ä¸€äº›å°±å¥½äº†</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _size 1024</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// çˆ¶è¿›ç¨‹å†™ï¼Œå­è¿›ç¨‹è¯»</span></span><br><span class="line">    <span class="type">int</span> pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// è´Ÿè´£å†™ï¼Œç»‘å®šç®¡é“fifo1</span></span><br><span class="line">        <span class="type">int</span> ret = <span class="built_in">access</span>(<span class="string">&quot;/home/lzx0626/FIFO/fifo1&quot;</span>, F_OK);</span><br><span class="line">        <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;ç®¡é“æ–‡ä»¶fifo1ä¸å­˜åœ¨,æ­£åœ¨åˆ›å»º...\n&quot;</span>);</span><br><span class="line">            <span class="comment">// ä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br><span class="line">            ret = <span class="built_in">mkfifo</span>(<span class="string">&quot;/home/lzx0626/FIFO/fifo1&quot;</span>, <span class="number">0664</span>);</span><br><span class="line">            <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">                <span class="built_in">perror</span>(<span class="string">&quot;mkfifo&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰“å¼€ç®¡é“</span></span><br><span class="line">        <span class="type">int</span> fdw = <span class="built_in">open</span>(<span class="string">&quot;/home/lzx0626/FIFO/fifo1&quot;</span>, O_WRONLY);</span><br><span class="line">        <span class="keyword">if</span> (fdw == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;çˆ¶è¿›ç¨‹ç®¡é“å·²æ‰“å¼€,ç­‰å¾…å†™å…¥...\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å†™æ•°æ®</span></span><br><span class="line">        <span class="type">char</span> buf[_size] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">            <span class="built_in">fgets</span>(buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>, stdin);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;send : %s&quot;</span>, buf);</span><br><span class="line">            <span class="type">int</span> len = <span class="built_in">write</span>(fdw, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (len == <span class="number">-1</span>) &#123;</span><br><span class="line">                <span class="built_in">perror</span>(<span class="string">&quot;write&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å…³é—­</span></span><br><span class="line">        <span class="built_in">close</span>(fdw);</span><br><span class="line">        <span class="comment">// çˆ¶è¿›ç¨‹å›æ”¶å­è¿›ç¨‹</span></span><br><span class="line">        <span class="built_in">wait</span>(<span class="literal">NULL</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// è´Ÿè´£è¯»ï¼Œç»‘å®šç®¡é“fifo2</span></span><br><span class="line">        <span class="type">int</span> ret = <span class="built_in">access</span>(<span class="string">&quot;/home/lzx0626/FIFO/fifo2&quot;</span>, F_OK);</span><br><span class="line">        <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="comment">// ä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;ç®¡é“æ–‡ä»¶fifo2ä¸å­˜åœ¨,æ­£åœ¨åˆ›å»º...\n&quot;</span>);</span><br><span class="line">            ret = <span class="built_in">mkfifo</span>(<span class="string">&quot;/home/lzx0626/FIFO/fifo2&quot;</span>, <span class="number">0664</span>);</span><br><span class="line">            <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">                <span class="built_in">perror</span>(<span class="string">&quot;mkfifo&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰“å¼€ç®¡é“</span></span><br><span class="line">        <span class="type">int</span> fdr = <span class="built_in">open</span>(<span class="string">&quot;/home/lzx0626/FIFO/fifo2&quot;</span>, O_RDONLY);</span><br><span class="line">        <span class="keyword">if</span> (fdr == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;å­è¿›ç¨‹ç®¡é“å·²æ‰“å¼€,ç­‰å¾…è¯»å–...\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¯»æ•°æ®</span></span><br><span class="line">        <span class="type">char</span> buf[_size] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">            <span class="type">int</span> len = <span class="built_in">read</span>(fdr, buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">            <span class="keyword">if</span> (len == <span class="number">-1</span>) &#123;</span><br><span class="line">                <span class="built_in">perror</span>(<span class="string">&quot;read&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (len == <span class="number">0</span>)  <span class="comment">// è¯»ç«¯å…¨éƒ¨å…³é—­ï¼Œç›¸å½“äºè¯»åˆ°æ–‡ä»¶æœ«å°¾</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;recv : %s&quot;</span>, buf);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å…³é—­</span></span><br><span class="line">        <span class="built_in">close</span>(fdr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="å†…å­˜æ˜ å°„"><a href="#å†…å­˜æ˜ å°„" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å†…å­˜æ˜ å°„"></a> å†…å­˜æ˜ å°„</h3><p>å°†ç£ç›˜æ–‡ä»¶çš„æ•°æ®æ˜ å°„åˆ°å†…å­˜ï¼Œç”¨æˆ·ä¿®æ”¹å†…å­˜å°±èƒ½ä¿®æ”¹ç£ç›˜æ–‡ä»¶</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722143701427.png" alt="image-20230722143701427"></p><h4 id="ç›¸å…³å‡½æ•°"><a href="#ç›¸å…³å‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç›¸å…³å‡½æ•°"></a> ç›¸å…³å‡½æ•°(!!!)</h4><p>mmap()ç”¨æ¥å»ºç«‹æ˜ å°„ï¼Œmunmap()ç”¨æ¥å–æ¶ˆæ˜ å°„</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722143806582.png" alt="image-20230722143806582"></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> *<span class="title">mmap</span><span class="params">(<span class="type">void</span> *addr, <span class="type">size_t</span> length, <span class="type">int</span> prot, <span class="type">int</span> flags, <span class="type">int</span> fd, <span class="type">off_t</span> offset)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šå°†ä¸€ä¸ªæ–‡ä»¶æˆ–è€…è®¾å¤‡çš„æ•°æ®æ˜ å°„åˆ°å†…å­˜ä¸­</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">//     void *addrï¼šç»å¤§å¤šæ•°æƒ…å†µä¼ nullptrï¼Œè¡¨ç¤ºç”±å†…æ ¸å†³å®šæ˜ å°„çš„å†…å­˜åœ°å€åœ¨å“ªé‡Œ</span></span><br><span class="line"><span class="comment">//     lengthï¼šè¦æ˜ å°„çš„æ•°æ®çš„é•¿åº¦ï¼Œè¿™ä¸ªå€¼ä¸èƒ½ä¸º0ï¼Œå»ºè®®ä½¿ç”¨æ–‡ä»¶çš„é•¿åº¦</span></span><br><span class="line"><span class="comment">//         è·å–æ–‡ä»¶çš„é•¿åº¦ï¼šstat lseek</span></span><br><span class="line"><span class="comment">//         è¿™ä¸ªè™šæ‹Ÿåœ°å€çš„åº”æ˜ å°„æ˜¯ä»¥åˆ†é¡µä¸ºç®¡ç†çš„ï¼Œå¦‚æœæ˜ å°„çš„é•¿åº¦ä¸æ»¡é¡µçš„å¤§å°ï¼Œä¼šè‡ªåŠ¨è°ƒæ•´ä¸ºä¸€ä¸ªåˆ†é¡µçš„å¤§å°</span></span><br><span class="line"><span class="comment">//     protï¼šå¯¹æˆ‘ä»¬ç”³è¯·çš„å†…å­˜æ˜ å°„åŒºçš„æ“ä½œæƒé™</span></span><br><span class="line"><span class="comment">//         - PROT_EXEC  å¯æ‰§è¡Œçš„æƒé™</span></span><br><span class="line"><span class="comment">//         - PROT_READ  è¯»çš„æƒé™</span></span><br><span class="line"><span class="comment">//         - PROT_WRITE å†™çš„æƒé™</span></span><br><span class="line"><span class="comment">//         - PROT_NONE  æ²¡æœ‰æƒé™</span></span><br><span class="line"><span class="comment">//         è¦æ“ä½œæ˜ å°„åŒºï¼Œå¿…é¡»è¦æœ‰è¯»æƒé™ï¼Œä¸€èˆ¬ç»™ è¯»æƒé™ æˆ–è€… è¯»æƒé™å’Œå†™æƒé™éƒ½æœ‰ (æŒ‰ä½æˆ–)</span></span><br><span class="line"><span class="comment">//     flagsï¼š</span></span><br><span class="line"><span class="comment">//         - MAP_SHARED æ˜ å°„åŒºçš„æ•°æ®ä¼šè‡ªåŠ¨å’Œç£ç›˜æ–‡ä»¶è¿›è¡ŒåŒæ­¥ï¼Œè¿›ç¨‹é—´é€šä¿¡å¿…é¡»è®¾ç½®è¿™ä¸ªé€‰é¡¹</span></span><br><span class="line"><span class="comment">//         - MAP_PROVATE ä¸åŒæ­¥ï¼Œå†…å­˜æ˜ å°„åŒºçš„æ•°æ®æ”¹å˜äº†ï¼Œå¯¹åŸæ¥çš„æ–‡ä»¶ä¸ä¼šä¿®æ”¹ï¼Œä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶(copy on write)</span></span><br><span class="line"><span class="comment">//     fdï¼šéœ€è¦æ˜ å°„çš„æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line"><span class="comment">//         é€šè¿‡open()å¾—åˆ°ï¼Œopençš„æ˜¯ä¸€ä¸ªç£ç›˜æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//         æ³¨æ„ï¼Œæ–‡ä»¶çš„å¤§å°ä¸èƒ½ä¸º0ï¼›openæŒ‡å®šçš„æƒé™ä¸èƒ½å’Œprotå‚æ•°çš„æƒé™æœ‰å†²çª</span></span><br><span class="line"><span class="comment">//         æ¯”å¦‚ï¼Œ   protï¼šPROT_READ                    openï¼šåªè¯»/è¯»å†™</span></span><br><span class="line"><span class="comment">//                 protï¼šPROT_READ | PROT_WRITE       openï¼šè¯»å†™</span></span><br><span class="line"><span class="comment">//     offsetï¼šæ˜ å°„æ—¶å€™çš„åç§»é‡ï¼Œå¿…é¡»æŒ‡å®šçš„æ˜¯4Kçš„æ•´æ•°å€ï¼Œ0è¡¨ç¤ºä¸åç§»</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼š</span></span><br><span class="line"><span class="comment">//     æˆåŠŸ è¿”å›åˆ›å»ºå¥½çš„æ˜ å°„åŒºçš„å†…å­˜é¦–åœ°å€</span></span><br><span class="line"><span class="comment">//     å¤±è´¥ è¿”å› MAP_FAILED (void *)-1ï¼Œå¹¶ä¸”è®¾ç½®errno</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">munmap</span><span class="params">(<span class="type">void</span> *addr, <span class="type">size_t</span> length)</span></span>;</span><br><span class="line"><span class="comment">// åŠŸèƒ½ï¼šé‡Šæ”¾å†…å­˜æ˜ å°„</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">//     addrï¼šè¦é‡Šæ”¾çš„å†…å­˜æ˜ å°„çš„é¦–åœ°å€</span></span><br><span class="line"><span class="comment">//     lengthï¼šè¦é‡Šæ”¾çš„å†…å­˜å¤§å°ï¼Œè¦å’Œmmap()çš„lengthå‚æ•°å€¼ä¸€æ ·</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// ä½¿ç”¨å†…å­˜æ˜ å°„å®ç°è¿›ç¨‹ä¹‹é—´é€šä¿¡</span></span><br><span class="line"><span class="comment">// 1.æœ‰å…³ç³»çš„è¿›ç¨‹ï¼Œçˆ¶å­è¿›ç¨‹</span></span><br><span class="line"><span class="comment">//     åœ¨æ²¡æœ‰å­è¿›ç¨‹çš„æ—¶å€™ï¼Œé€šè¿‡å”¯ä¸€çš„çˆ¶è¿›ç¨‹å…ˆé€šè¿‡ä¸€ä¸ªå¤§å°ä¸æ˜¯0çš„ç£ç›˜æ–‡ä»¶åˆ›å»ºå†…å­˜æ˜ å°„åŒºï¼Œæœ‰äº†ä¹‹åå†åˆ›å»ºå­è¿›ç¨‹ï¼Œç„¶åçˆ¶å­å…±äº«è¿™ä¸ªå†…å­˜æ˜ å°„åŒº</span></span><br><span class="line"><span class="comment">// 2.æ²¡æœ‰å…³ç³»çš„è¿›ç¨‹é—´é€šä¿¡</span></span><br><span class="line"><span class="comment">//     å‡†å¤‡ä¸€ä¸ªå¤§å°ä¸æ˜¯0çš„ç£ç›˜æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//     è¿›ç¨‹1é€šè¿‡ç£ç›˜æ–‡ä»¶å¾—åˆ°ä¸€ä¸ªå†…å­˜æ˜ å°„åŒºï¼Œå¾—åˆ°ä¸€ä¸ªæ“ä½œè¿™ä¸ªå†…å­˜çš„æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">//     è¿›ç¨‹2åŒç†ï¼Œå¾—åˆ°ä¸€ä¸ªæŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">//     ä½¿ç”¨å†…å­˜æ˜ å°„åŒºè¿›è¡Œé€šä¿¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨æ„ï¼šå†…å­˜æ˜ å°„åŒºé€šä¿¡ï¼Œä¸ä¼šé˜»å¡</span></span><br></pre></td></tr></table></div></figure><p>çˆ¶å­è¿›ç¨‹é€šè¿‡å†…å­˜æ˜ å°„åŒºé€šä¿¡çš„ä¾‹å­ï¼š</p><p><strong>æ€è·¯ï¼šé€šä¿¡ï¼Ÿå†…å­˜æ˜ å°„çš„æœ¬è´¨æ˜¯å°†æ–‡ä»¶æ˜ å°„åˆ°å†…å­˜å½“ä¸­å½¢æˆä¸€å—åŒºåŸŸï¼Œå’Œçˆ¶å­è¿›ç¨‹è”ç³»èµ·æ¥ï¼Œä¸å¦¨è”æƒ³åˆ°äº†åŒ¿åç®¡é“ï¼Œçˆ¶è¿›ç¨‹åœ¨åˆ›å»ºå­è¿›ç¨‹ä¹‹å‰å°±åˆ›å»ºå¥½å†…å­˜æ˜ å°„åŒºï¼Œç„¶åfork()å‡ºå­è¿›ç¨‹ï¼Œè¿™æ ·çˆ¶å­è¿›ç¨‹å°±æŒ‡å‘äº†åŒä¸€å—å†…å­˜æ˜ å°„åŒºäº†ï¼Œå°±å¯ä»¥äº’ç›¸é€šä¿¡äº†</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _size 1024</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ‰“å¼€1ä¸ªæ–‡ä»¶</span></span><br><span class="line">    <span class="type">int</span> fd = <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, O_RDWR);</span><br><span class="line">    <span class="keyword">if</span> (fd == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è·å–å¤§å°</span></span><br><span class="line">    <span class="type">off_t</span> size = <span class="built_in">lseek</span>(fd, <span class="number">0</span>, SEEK_END);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºå†…å­˜æ˜ å°„åŒº</span></span><br><span class="line">    <span class="type">void</span>* ptr = <span class="built_in">mmap</span>(<span class="literal">nullptr</span>, size, PROT_WRITE | PROT_READ, MAP_SHARED, fd, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (ptr == MAP_FAILED) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;mmap&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºå­è¿›ç¨‹</span></span><br><span class="line">    <span class="type">pid_t</span> pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;   <span class="comment">// çˆ¶è¿›ç¨‹</span></span><br><span class="line">        <span class="built_in">wait</span>(<span class="literal">NULL</span>);  <span class="comment">// ç­‰å¾…å­è¿›ç¨‹å†™å…¥æ•°æ®ç„¶åå›æ”¶å®Œæ¯•å†è¯»å–</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¯»æ•°æ®</span></span><br><span class="line">        <span class="type">char</span> buf[_size] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="built_in">strcpy</span>(buf, (<span class="type">char</span>*)ptr);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;read data : %s\n&quot;</span>, buf);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;  <span class="comment">// å­è¿›ç¨‹</span></span><br><span class="line">        <span class="comment">// å†™æ•°æ®ï¼Œæ³¨æ„æ˜¯ç›´æ¥æ“ä½œè¿™ä¸ªæŒ‡é’ˆï¼Œå’Œç®¡é“ä¸ä¸€æ ·ï¼Œç®¡é“æ˜¯é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ“ä½œ</span></span><br><span class="line">        <span class="comment">// æˆ‘å†™çš„å­—ç¬¦ä¸²åé¢å¸¦æœ‰ &#x27;\0&#x27; ç»“æŸç¬¦ï¼Œä¸ç”¨æ‹…å¿ƒä¼šå’ŒåŸæ¥æ–‡ä»¶çš„æ•°æ®å†²çªï¼Œå› ä¸ºæˆ‘æ˜¯ä»å¤´å¼€å§‹è¦†ç›–ï¼Œç„¶åèµ°åˆ°å°¾éƒ¨è‡ªåŠ¨è¡¥ä¸Š &#x27;\0&#x27;ï¼Œè¯»æ“ä½œä¹Ÿæ˜¯ä¸€æ ·çš„</span></span><br><span class="line">        <span class="built_in">strcpy</span>((<span class="type">char</span>*)ptr, <span class="string">&quot;nihao&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­å†…å­˜æ˜ å°„åŒº</span></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">munmap</span>(ptr, size);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;munmap&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­æ–‡ä»¶</span></span><br><span class="line">    <span class="built_in">close</span>(fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p><strong>æ³¨æ„ï¼š'\0â€™å°±æ˜¯ char(0)ï¼Œæ‰€ä»¥æˆ‘æ‰ç”¨ char buf[_size] = {0} å¯¹å­—ç¬¦ä¸²åˆå§‹åŒ–!!!</strong></p><p>ä¸ç›¸å…³çš„è¿›ç¨‹ä¹‹é—´é€šè¿‡å†…å­˜æ˜ å°„é€šä¿¡</p><p>æ€è·¯ï¼šå†™è¿›ç¨‹å…ˆæ‰“å¼€æ–‡ä»¶ï¼Œåˆ›å»ºæ˜ å°„åŒºï¼Œç„¶åä¿®æ”¹æ•°æ®ï¼Œç„¶åè¯»è¿›ç¨‹æ‰“å¼€æ–‡ä»¶ï¼Œåˆ›å»ºæ˜ å°„åŒºç„¶åè¯»å–ä¿®æ”¹åçš„æ•°æ®ï¼›æˆ‘è¿™é‡Œçš„è®¾è®¡ä¸¤ä¸ªè¿›ç¨‹ä¸èƒ½å¹¶å‘æ‰§è¡Œï¼Œå› ä¸ºè¯»è¿›ç¨‹ä¸æ˜¯é˜»å¡çš„ï¼Œè¿™æ ·è¯»å–çš„æ˜¯æ–‡ä»¶ä¸­åŸæœ¬çš„æ•°æ®ï¼Œéœ€è¦ç­‰å¾…å†™è¿›ç¨‹å†™å®Œæ•°æ®ä¹‹åå†æ‰§è¡Œ</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// write.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _size 1024</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ‰“å¼€æ–‡ä»¶</span></span><br><span class="line">    <span class="type">int</span> fd = <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, O_RDWR);</span><br><span class="line">    <span class="keyword">if</span> (fd == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–æ–‡ä»¶å¤§å°</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">stat</span> statbuf;</span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">stat</span>(<span class="string">&quot;test.txt&quot;</span>, &amp;statbuf);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;stat&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">off_t</span> size = statbuf.st_size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºå†…å­˜æ˜ å°„åŒº</span></span><br><span class="line">    <span class="type">void</span>* ptr = <span class="built_in">mmap</span>(<span class="literal">nullptr</span>, size, PROT_READ | PROT_WRITE, MAP_SHARED, fd, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (ptr == MAP_FAILED) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;mmap&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ“ä½œè¿™å—å†…å­˜</span></span><br><span class="line">    <span class="type">char</span> buf[_size] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">fgets</span>(buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>, stdin);  <span class="comment">// ä¿è¯åé¢ç•™æœ‰ä¸€ä¸ª&#x27;\0&#x27;ç¬¦å·</span></span><br><span class="line">    <span class="comment">// å†™æ•°æ®</span></span><br><span class="line">    <span class="built_in">strcpy</span>((<span class="type">char</span>*)ptr, buf);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­å†…å­˜æ˜ å°„åŒº</span></span><br><span class="line">    <span class="built_in">munmap</span>(ptr, size);</span><br><span class="line">    <span class="comment">// å…³é—­æ–‡ä»¶</span></span><br><span class="line">    <span class="built_in">close</span>(fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// read.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _size 1024</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ‰“å¼€æ–‡ä»¶</span></span><br><span class="line">    <span class="type">int</span> fd = <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, O_RDWR);</span><br><span class="line">    <span class="keyword">if</span> (fd == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–æ–‡ä»¶å¤§å°</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">stat</span> statbuf;</span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">stat</span>(<span class="string">&quot;test.txt&quot;</span>, &amp;statbuf);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;stat&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">off_t</span> size = statbuf.st_size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºå†…å­˜æ˜ å°„åŒº</span></span><br><span class="line">    <span class="type">void</span>* ptr = <span class="built_in">mmap</span>(<span class="literal">nullptr</span>, size, PROT_READ | PROT_WRITE, MAP_SHARED, fd, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (ptr == MAP_FAILED) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;mmap&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ“ä½œè¿™å—å†…å­˜</span></span><br><span class="line">    <span class="type">char</span> buf[_size] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="comment">// è¯»æ•°æ®</span></span><br><span class="line">    <span class="built_in">strcpy</span>(buf, (<span class="type">char</span>*)ptr);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;read data : %s&quot;</span>, buf);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­å†…å­˜æ˜ å°„åŒº</span></span><br><span class="line">    <span class="built_in">munmap</span>(ptr, size);</span><br><span class="line">    <span class="comment">// å…³é—­æ–‡ä»¶</span></span><br><span class="line">    <span class="built_in">close</span>(fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ‰§è¡Œç»“æœï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722155039444.png" alt="image-20230722155039444"></p><p><strong>ä½†æ˜¯è¦æ³¨æ„ä¸€ç‚¹ï¼Œå†™çš„æ•°æ®ä¸èƒ½æ¯”æ–‡ä»¶æœ¬èº«çš„å¤§å°å¤§ï¼Œä¸ç„¶å°±ä¼šè¶…å‡ºå†…å­˜çš„å¤§å°èŒƒå›´äº†ï¼Œå°±ä¼šå†™ä¸è¿›å»!!!</strong></p><h4 id="æ€è€ƒé—®é¢˜"><a href="#æ€è€ƒé—®é¢˜" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ€è€ƒé—®é¢˜"></a> æ€è€ƒé—®é¢˜</h4><p>1.å¦‚æœå¯¹mmapçš„è¿”å›å€¼(ptr)åš<ins>æ“ä½œ(ptr</ins>), munmapæ˜¯å¦èƒ½å¤ŸæˆåŠŸ?<br>void * ptr = mmap(â€¦);<br>ptr++; å¯ä»¥å¯¹å…¶è¿›è¡Œ++æ“ä½œ<br>munmap(ptr, len); // é”™è¯¯,è¦ä¿å­˜åœ°å€</p><p>2.å¦‚æœopenæ—¶O_RDONLY, mmapæ—¶protå‚æ•°æŒ‡å®šPROT_READ | PROT_WRITEä¼šæ€æ ·?<br>é”™è¯¯ï¼Œè¿”å›MAP_FAILED<br>open()å‡½æ•°ä¸­çš„æƒé™å»ºè®®å’Œprotå‚æ•°çš„æƒé™ä¿æŒä¸€è‡´ã€‚</p><p>3.å¦‚æœæ–‡ä»¶åç§»é‡ä¸º1000ä¼šæ€æ ·?<br><strong>åç§»é‡å¿…é¡»æ˜¯4Kçš„æ•´æ•°å€ï¼Œè¿”å›MAP_FAILED</strong></p><p>4.mmapä»€ä¹ˆæƒ…å†µä¸‹ä¼šè°ƒç”¨å¤±è´¥?<br>- ç¬¬äºŒä¸ªå‚æ•°ï¼šlength = 0<br>- ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šprot<br>- åªæŒ‡å®šäº†å†™æƒé™<br>- prot PROT_READ | PROT_WRITE<br>ç¬¬5ä¸ªå‚æ•°fd é€šè¿‡openå‡½æ•°æ—¶æŒ‡å®šçš„ O_RDONLY / O_WRONLY</p><p>5.å¯ä»¥opençš„æ—¶å€™O_CREATä¸€ä¸ªæ–°æ–‡ä»¶æ¥åˆ›å»ºæ˜ å°„åŒºå—?<br>- å¯ä»¥çš„ï¼Œä½†æ˜¯åˆ›å»ºçš„æ–‡ä»¶çš„å¤§å°å¦‚æœä¸º0çš„è¯ï¼Œè‚¯å®šä¸è¡Œ<br>- å¯ä»¥å¯¹æ–°çš„æ–‡ä»¶è¿›è¡Œæ‰©å±•<br>- lseek()<br>- truncate()</p><p>6.mmapåå…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯¹mmapæ˜ å°„æœ‰æ²¡æœ‰å½±å“ï¼Ÿ<br>int fd = open(â€œXXXâ€);<br>mmap(,fd,0);<br>close(fd);<br>æ˜ å°„åŒºè¿˜å­˜åœ¨ï¼Œåˆ›å»ºæ˜ å°„åŒºçš„fdè¢«å…³é—­ï¼Œæ²¡æœ‰ä»»ä½•å½±å“ã€‚</p><p>7.å¯¹ptrè¶Šç•Œæ“ä½œä¼šæ€æ ·ï¼Ÿ<br>void * ptr = mmap(NULL, 100,);<br>æ˜ å°„å‡ºæ¥ä¼šè°ƒæ•´ä¸º<strong>4K</strong><br>è¶Šç•Œæ“ä½œæ“ä½œçš„æ˜¯éæ³•çš„å†…å­˜ -&gt; æ®µé”™è¯¯</p><h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¤ºä¾‹"></a> ç¤ºä¾‹</h4><p><strong>å°†english.txtæ–‡ä»¶æ‹·è´ä¸€ä»½ä¸ºcpy.txtï¼Œä¿å­˜åœ¨å½“å‰ç›®å½•</strong></p><p>æ€è·¯ï¼šä¸¤ä¸ªæ–‡ä»¶åˆ†åˆ«æ˜ å°„åˆ°å†…å­˜å½“ä¸­ï¼Œç„¶åæ“çºµå†…å­˜è¿›è¡Œå¤åˆ¶å³å¯</p><p><strong>æ³¨æ„ï¼šæ–°æ–‡ä»¶éœ€è¦é¢„åˆ†é…å¤§å°ï¼Œä¸èƒ½å‡ºç°ç©ºæ–‡ä»¶</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†english.txtæ–‡ä»¶æ‹·è´ä¸€ä»½ä¸ºcpy.txtï¼Œä¿å­˜åœ¨å½“å‰ç›®å½•</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ‰“å¼€english.txt</span></span><br><span class="line">    <span class="type">int</span> fd_src = <span class="built_in">open</span>(<span class="string">&quot;english.txt&quot;</span>, O_RDONLY);</span><br><span class="line">    <span class="keyword">if</span> (fd_src == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–english.txtçš„å¤§å°</span></span><br><span class="line">    <span class="type">off_t</span> size = <span class="built_in">lseek</span>(fd_src, <span class="number">0</span>, SEEK_END);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºå†…å­˜æ˜ å°„åŒº</span></span><br><span class="line">    <span class="type">void</span>* ptr_src = <span class="built_in">mmap</span>(<span class="literal">nullptr</span>, size, PROT_READ, MAP_SHARED, fd_src, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (ptr_src == MAP_FAILED) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;mmap&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºcpy.txt</span></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">access</span>(<span class="string">&quot;copy.txt&quot;</span>, F_OK);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">0</span>)  <span class="comment">// å­˜åœ¨æŠŠä»–åˆ é™¤</span></span><br><span class="line">        <span class="built_in">unlink</span>(<span class="string">&quot;cpy.txt&quot;</span>);</span><br><span class="line">    <span class="comment">// åˆ›å»º</span></span><br><span class="line">    <span class="type">int</span> fd_dest = <span class="built_in">open</span>(<span class="string">&quot;cpy.txt&quot;</span>, O_RDWR | O_CREAT, <span class="number">0664</span>);</span><br><span class="line">    <span class="keyword">if</span> (fd_dest == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°†ç©ºæ–‡ä»¶çš„å¤§å°ä¿®æ”¹ä¸ºæºæ–‡ä»¶çš„å¤§å°ï¼Œé˜²æ­¢å‡ºç°ç©ºæ–‡ä»¶</span></span><br><span class="line">    ret = <span class="built_in">truncate</span>(<span class="string">&quot;cpy.txt&quot;</span>, size);</span><br><span class="line">    <span class="comment">// ret = lseek(fd_dest, size, SEEK_END);</span></span><br><span class="line">    <span class="comment">// write(fd_dest, &quot; &quot;, 1);  // lseekæ‰©å±•æ–‡ä»¶éœ€è¦è¿›è¡Œä¸€æ¬¡å†™çš„æ“ä½œï¼Œtruncateä¸éœ€è¦!!!</span></span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;truncate&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºå†…å­˜æ˜ å°„åŒº</span></span><br><span class="line">    <span class="type">void</span>* ptr_dest = <span class="built_in">mmap</span>(<span class="literal">nullptr</span>, size, PROT_READ | PROT_WRITE, MAP_SHARED, fd_dest, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (ptr_dest == MAP_FAILED) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;mmap&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‹·è´</span></span><br><span class="line">    <span class="built_in">strncpy</span>((<span class="type">char</span>*)ptr_dest, (<span class="type">char</span>*)ptr_src, size);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­å†…å­˜æ˜ å°„åŒº</span></span><br><span class="line">    <span class="built_in">munmap</span>(ptr_src, size);</span><br><span class="line">    <span class="built_in">munmap</span>(ptr_dest, size);</span><br><span class="line">    <span class="comment">// å…³é—­æ–‡ä»¶</span></span><br><span class="line">    <span class="built_in">close</span>(fd_src);</span><br><span class="line">    <span class="built_in">close</span>(fd_dest);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è¿™é‡Œæˆ‘ä»¬å¾—åˆ°äº†ä¸¤ç§æ‰©å±•æ–‡ä»¶å†…å­˜çš„æ–¹å¼ï¼Œåˆ†åˆ«ä½¿ç”¨truncate()å’Œlseek()</p><ul><li><strong>truncate()ä¸­ï¼Œsizeæ˜¯æƒ³è¦æ‰©å±•åˆ°çš„æ–‡ä»¶å¤§å°</strong></li><li><strong>lseek()ä¸­ï¼Œlengthæ˜¯åœ¨SEEK_ENDåŸºç¡€ä¸Šçš„æ–‡ä»¶æŒ‡é’ˆåç§»é‡ï¼Œæœ€åæ–‡ä»¶æŒ‡é’ˆä¼šèµ°åˆ°length+SEEK_ENDçš„ä½ç½®ï¼Œè¿™æ˜¯åŸæ¥æ–‡ä»¶èµ°ä¸åˆ°çš„ä½ç½®ï¼Œå› æ­¤æ–‡ä»¶å°±ç›¸åº”æ‰©å±•äº†ï¼Œlengthå°±æ˜¯æ‰©å±•äº†çš„æ–‡ä»¶å¤§å°</strong></li><li><strong>lseekæ‰©å±•æ–‡ä»¶éœ€è¦è¿›è¡Œä¸€æ¬¡å†™çš„æ“ä½œï¼Œtruncateä¸éœ€è¦!!!</strong></li></ul><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">truncate</span>(<span class="string">&quot;cpy.txt&quot;</span>, size);</span><br><span class="line"></span><br><span class="line"><span class="built_in">lseek</span>(fd_dest, length, SEEK_END);</span><br><span class="line"><span class="built_in">write</span>(fd_dest, <span class="string">&quot; &quot;</span>, <span class="number">1</span>);  <span class="comment">// lseekæ‰©å±•æ–‡ä»¶éœ€è¦è¿›è¡Œä¸€æ¬¡å†™çš„æ“ä½œï¼Œtruncateä¸éœ€è¦!!!</span></span><br></pre></td></tr></table></div></figure><h4 id="åŒ¿åæ˜ å°„"><a href="#åŒ¿åæ˜ å°„" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#åŒ¿åæ˜ å°„"></a> åŒ¿åæ˜ å°„</h4><p><strong>é¡¾åæ€ä¹‰ï¼ŒåŒ¿åæ˜ å°„ï¼Œéƒ½åŒ¿åäº†ï¼Œè¯´æ˜æ²¡æœ‰æ–‡ä»¶å®ä½“åšæ”¯æ’‘äº†å§ï¼Œå› æ­¤ä¸¤ä¸ªä¸ç›¸å…³çš„è¿›ç¨‹ä¸é€‚ç”¨äºè¿™ä¸ªï¼Œå› ä¸ºæ‰¾ä¸åˆ°è¿æ¥çš„æ¥å£ï¼Œè€Œçˆ¶å­è¿›ç¨‹æ°å¥½å¯ä»¥ç”¨è¿™ä¸ªæ¥é€šä¿¡</strong></p><p><strong>flagså‚æ•°å½“ä¸­ï¼ŒMAP_SHAREDå’ŒMAP_PRIVATEå‚æ•°æ˜¯å¿…é€‰ä¸€ä¸ªï¼Œç„¶åå…¶ä»–çš„æ˜¯å¯é€‰é¡¹ï¼ŒMAP_ANONYMOUSå°±æ˜¯ä¸€ä¸ªå¯é€‰é¡¹</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _size 1024</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">åŒ¿åæ˜ å°„ï¼šä¸éœ€è¦æ–‡ä»¶å®ä½“è¿›è¡Œä¸€ä¸ªå†…å­˜æ˜ å°„ï¼Œåªèƒ½åœ¨çˆ¶å­å’Œæœ‰å…³ç³»çš„è¿›ç¨‹ä¹‹é—´é€šä¿¡ï¼Œå› ä¸ºæ²¡æœ‰åŠæ³•é€šè¿‡æ–‡ä»¶è¿›è¡Œå…³è”</span></span><br><span class="line"><span class="comment">- ä¿®æ”¹flagså‚æ•°ï¼ŒåšåŒ¿åæ˜ å°„éœ€è¦ä¼ å…¥ MAP_ANONYMOUSï¼Œè¿™æ ·ä¼šå¿½ç•¥æ‰fdå‚æ•°ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼ å…¥-1</span></span><br><span class="line"><span class="comment">- flagså‚æ•°å½“ä¸­ï¼ŒMAP_SHAREDå’ŒMAP_PRIVATEå‚æ•°æ˜¯å¿…é€‰ä¸€ä¸ªï¼Œç„¶åå…¶ä»–çš„æ˜¯å¯é€‰é¡¹ï¼ŒMAP_ANONYMOUSå°±æ˜¯ä¸€ä¸ªå¯é€‰é¡¹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºåŒ¿åå†…å­˜æ˜ å°„åŒº</span></span><br><span class="line">    <span class="type">int</span> length = <span class="number">4096</span>;</span><br><span class="line">    <span class="type">void</span>* ptr = <span class="built_in">mmap</span>(<span class="literal">nullptr</span>, length, PROT_READ | PROT_WRITE, MAP_ANONYMOUS | MAP_SHARED, <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (ptr == MAP_FAILED) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;mmap&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çˆ¶å­è¿›ç¨‹é—´é€šä¿¡</span></span><br><span class="line">    <span class="type">pid_t</span> pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;  <span class="comment">// çˆ¶è¿›ç¨‹</span></span><br><span class="line">        <span class="built_in">strcpy</span>((<span class="type">char</span>*)ptr, <span class="string">&quot;helloworld&quot;</span>);</span><br><span class="line">        <span class="built_in">wait</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;  <span class="comment">// å­è¿›ç¨‹</span></span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">1</span>);           <span class="comment">// éé˜»å¡ï¼Œå…ˆç¡ä¸€ç§’è®©çˆ¶è¿›ç¨‹æ‰§è¡Œå®Œå†™å…¥æ“ä½œ</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, (<span class="type">char</span>*)ptr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­å†…å­˜æ˜ å°„åŒº</span></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">munmap</span>(ptr, length);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;munmap&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="ä¿¡å·"><a href="#ä¿¡å·" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä¿¡å·"></a> ä¿¡å·</h3><h4 id="æ¦‚å¿µ-2"><a href="#æ¦‚å¿µ-2" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ¦‚å¿µ-2"></a> æ¦‚å¿µ</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722171544342.png" alt="image-20230722171544342"></p><p>è½¯ä»¶ä¸­æ–­</p><p>å¤„ç†ç´§æ€¥äº‹åŠ¡ï¼Œå®Œæ¯•åå›åˆ°ä¿å­˜çš„ä½ç½®ç»§ç»­æ‰§è¡Œ</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722171944530.png" alt="image-20230722171944530" style="zoom:67%"><h4 id="ç›®çš„"><a href="#ç›®çš„" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç›®çš„"></a> ç›®çš„</h4><p><strong>è®©è¿›ç¨‹çŸ¥é“äº†å·²ç»å‘ç”Ÿäº†æŸä¸€ä¸ªç‰¹å®šçš„äº‹æƒ…ï¼›å¼ºè¿«è¿›ç¨‹æ‰§è¡Œä»–è‡ªå·±ä»£ç å½“ä¸­çš„ä¿¡å·å¤„ç†ç¨‹åº</strong></p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722172651186.png" alt="image-20230722172651186" style="zoom:67%"><h4 id="linuxä¿¡å·åˆ—è¡¨"><a href="#linuxä¿¡å·åˆ—è¡¨" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#linuxä¿¡å·åˆ—è¡¨"></a> Linuxä¿¡å·åˆ—è¡¨</h4><p><strong>ä¸€å…±62ä¸ª(32 33æ²¡æœ‰)ï¼Œ1-31æ˜¯å¸¸è§„ä¿¡å·ï¼Œ32-64æ˜¯é¢„å®šä¹‰å¥½çš„ä¿¡å·ï¼Œç›®å‰è¿˜æ²¡æœ‰ä½¿ç”¨ï¼Œå°†æ¥å¯èƒ½ä¼šä½¿ç”¨ï¼Œå¹¶ä¸”æ˜¯å®æ—¶ä¿¡å·</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722172945238.png" alt="image-20230722172945238"></p><p>çº¢è‰²ä¿¡å·æ¯”è¾ƒé‡è¦ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722173136070.png" alt="image-20230722173136070"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722173332099.png" alt="image-20230722173332099"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722173427247.png" alt="image-20230722173427247"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722173511150.png" alt="image-20230722173511150"></p><h4 id="ä¿¡å·çš„5ç§é»˜è®¤å¤„ç†åŠ¨ä½œ"><a href="#ä¿¡å·çš„5ç§é»˜è®¤å¤„ç†åŠ¨ä½œ" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä¿¡å·çš„5ç§é»˜è®¤å¤„ç†åŠ¨ä½œ"></a> ä¿¡å·çš„5ç§é»˜è®¤å¤„ç†åŠ¨ä½œ</h4><p>å…¶ä¸­ï¼ŒCoreæ˜¯æŒ‡ç»ˆæ­¢è¿›ç¨‹å¹¶ä¸”ç”Ÿæˆä¸€ä¸ªCoreæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å½“ä¸­è®°è½½äº†ç¨‹åºå¼‚å¸¸ç»ˆæ­¢æ—¶å€™ä¿å­˜çš„ä¸€äº›é”™è¯¯ä¿¡æ¯ç­‰ç­‰</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722173544492.png" alt="image-20230722173544492"></p><h5 id="æŸ¥çœ‹å¹¶ä¸”ä½¿ç”¨coreæ–‡ä»¶"><a href="#æŸ¥çœ‹å¹¶ä¸”ä½¿ç”¨coreæ–‡ä»¶" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æŸ¥çœ‹å¹¶ä¸”ä½¿ç”¨coreæ–‡ä»¶"></a> æŸ¥çœ‹å¹¶ä¸”ä½¿ç”¨Coreæ–‡ä»¶</h5><p>Coreæ–‡ä»¶é‡Œé¢è®°å½•äº†ç¨‹åºå¼‚å¸¸é€€å‡ºçš„çŠ¶æ€ä¿¡æ¯ï¼Œå¯ä»¥è®©ç¨‹åºåœ¨å¼‚å¸¸é€€å‡ºçš„æ—¶å€™ç”ŸæˆCoreæ–‡ä»¶ï¼Œæ–¹ä¾¿æˆ‘ä»¬æŸ¥çœ‹å’Œè°ƒè¯•é”™è¯¯çš„ä¿¡æ¯</p><p>ç³»ç»Ÿé»˜è®¤åœ¨è¿›ç¨‹å¼‚å¸¸é€€å‡ºçš„æ—¶å€™æ˜¯ä¸ä¼šäº§ç”ŸCoreæ–‡ä»¶çš„ï¼Œé€šè¿‡ ulimit -a å‘½ä»¤æŸ¥çœ‹ï¼š</p><p>å¯ä»¥çœ‹å‡º core file size è¿™ä¸€é¡¹é»˜è®¤æ˜¯0</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722190246653.png" alt="image-20230722190246653"></p><p>æˆ‘ä»¬å°†å…¶è®¾ç½®ä¸€ä¸‹ï¼Œå¯ä»¥è®¾ç½®ä¸ºä¸€ä¸ªå…·ä½“çš„å¤§å°æˆ–è€…ä¸é™åˆ¶</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722190333227.png" alt="image-20230722190333227"></p><p>ç°åœ¨å°±åº”è¯¥æœ‰äº†</p><p>è¿˜è¦æ³¨æ„ä¸€ç‚¹ï¼šè¿™ä¸ªCoreæ–‡ä»¶è¦æƒ³è¢«è®°å½•ä¸‹æ¥ï¼Œå¿…é¡»åœ¨Linuxçš„æœ¬åœ°ç›®å½•å½“ä¸­æ“ä½œï¼Œä¸èƒ½åœ¨å’Œwindowsçš„å…±äº«æ–‡ä»¶å¤¹æˆ–è€…windowsæ–‡ä»¶å¤¹å½“ä¸­æ“ä½œï¼Œè¿™æ ·å‡ºæ¥çš„Coreæ–‡ä»¶æ˜¯ä¼šç”Ÿæˆï¼Œä½†æ˜¯å¤§å°ä¸º0ï¼Œæ²¡æœ‰ç”¨</p><p>æºä»£ç ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">char</span>* buf;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">strcpy</span>(buf, <span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    <span class="comment">//è¿™é‡Œæ˜¾ç„¶ä¼šæŠ¥é”™ï¼Œå› ä¸ºbufæŒ‡é’ˆæ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œæ ¹æœ¬ä¸çŸ¥é“æ“ä½œçš„æ˜¯å“ªä¸€å—å†…å­˜ï¼ŒæŒ‡å‘çš„å­—ç¬¦ä¸²åŒºåŸŸæœ‰å¤šå¤§ï¼Œæ˜¯ä¸ªé‡æŒ‡é’ˆ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722190630746.png" alt="image-20230722190630746" style="zoom:67%"><p>æ‰§è¡Œ a.out ä¹‹åï¼ŒæŠ¥äº†æ®µé”™è¯¯ï¼Œæˆ‘ä»¬æ¥æŸ¥çœ‹ä¸‹coreæ–‡ä»¶çš„å¤§å°ï¼Œä¸ä¸º0ï¼Œå¯è§è®°å½•äº†ç›¸å…³é”™è¯¯ä¿¡æ¯</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722190751504.png" alt="image-20230722190751504" style="zoom:80%"><p>æ€ä¹ˆæŸ¥çœ‹å‘¢ï¼Ÿå¯ä»¥é€šè¿‡gdbè°ƒè¯•æ¥æŸ¥çœ‹ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ç¼–è¯‘çš„æ—¶å€™åŠ ä¸Š -g è°ƒè¯•å‚æ•°çš„åŸå› </p><p>é€šè¿‡gdbè°ƒè¯•å¯æ‰§è¡Œæ–‡ä»¶a.outï¼Œé‡Œé¢æœ‰ä¸€ä¸ªå‘½ä»¤</p><figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">core-file core #ç”¨æ¥æŸ¥çœ‹è¯¥å¯æ‰§è¡Œæ–‡ä»¶å¯¹åº”çš„coreæ–‡ä»¶ä¿¡æ¯</span><br></pre></td></tr></table></div></figure><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722190919579.png" alt="image-20230722190919579" style="zoom:80%"><p>å¯ä»¥çœ‹å‡ºç¨‹åºçš„å¼‚å¸¸ç»ˆæ­¢æ˜¯å› ä¸ºè¿™ä¸€è¡Œçš„é—®é¢˜ï¼Œä¸æˆ‘ä»¬çš„é¢„æœŸä¸€è‡´ï¼›</p><p>è€Œå‘å‡ºçš„ç»ˆæ­¢ä¿¡å·SIGSEGVçš„å«ä¹‰å°±æ˜¯ç¨‹åºè¿›è¡Œäº†æ— æ•ˆçš„å†…å­˜è®¿é—®ï¼Œä¹Ÿå°±æ˜¯æ®µé”™è¯¯</p><h4 id="ç›¸å…³å‡½æ•°-2"><a href="#ç›¸å…³å‡½æ•°-2" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç›¸å…³å‡½æ•°-2"></a> ç›¸å…³å‡½æ•°</h4><h5 id="killraiseabort"><a href="#killraiseabort" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#killraiseabort"></a> kill(),raise(),abort()</h5><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722174710585.png" alt="image-20230722174710585"></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">kill</span><span class="params">(<span class="type">pid_t</span> pid, <span class="type">int</span> sig)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šç»™ä»»ä½•çš„è¿›ç¨‹æˆ–è€…è¿›ç¨‹ç»„pidï¼Œå‘é€ä»»ä½•çš„ä¿¡å·sig</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">//     pidï¼š</span></span><br><span class="line"><span class="comment">//         &gt;  0  å°†ä¿¡å·å‘é€ç»™æŒ‡å®šçš„è¿›ç¨‹</span></span><br><span class="line"><span class="comment">//         == 0  å°†ä¿¡å·å‘é€ç»™å½“å‰çš„è¿›ç¨‹ç»„ä¸­æ‰€æœ‰çš„è¿›ç¨‹</span></span><br><span class="line"><span class="comment">//         == -1 å°†ä¿¡å·å‘é€ç»™æ¯ä¸€ä¸ªæœ‰æƒé™æ¥å—è¿™ä¸ªä¿¡å·çš„è¿›ç¨‹</span></span><br><span class="line"><span class="comment">//         &lt;  -1 è¿™ä¸ªpid = æŸä¸ªè¿›ç¨‹ç»„çš„IDçš„ç›¸åæ•°ï¼Œç»™è¿™ä¸ªè¿›ç¨‹ç»„ä¸­æ‰€æœ‰çš„è¿›ç¨‹å‘é€ä¿¡å·</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     sigï¼šéœ€è¦å‘é€çš„ä¿¡å·ç¼–å·æˆ–è€…å®å€¼ï¼Œå¦‚æœæ˜¯0åˆ™è¡¨ç¤ºä¸å‘é€ä»»ä½•ä¿¡å·</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼šæˆåŠŸ 0 ; å¤±è´¥ -1ï¼Œå¹¶è®¾ç½®errno</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">raise</span><span class="params">(<span class="type">int</span> sig)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šç»™å½“å‰è¿›ç¨‹å‘é€ä¿¡å·</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼šsigï¼šéœ€è¦å‘é€çš„ä¿¡å·ç¼–å·æˆ–è€…å®å€¼ï¼Œå¦‚æœæ˜¯0åˆ™è¡¨ç¤ºä¸å‘é€ä»»ä½•ä¿¡å·</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼š æˆåŠŸ 0 ; å¤±è´¥ é 0</span></span><br><span class="line"><span class="comment">//     kill(getpid(),sig);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">abort</span><span class="params">(<span class="type">void</span>)</span></span>;</span><br><span class="line"><span class="comment">// åŠŸèƒ½ï¼šå‘é€ä¸€ä¸ªSIGABRTä¿¡å·ç»™å½“å‰çš„è¿›ç¨‹ï¼Œé»˜è®¤æ˜¯æ€æ­»å½“å‰çš„è¿›ç¨‹</span></span><br><span class="line"><span class="comment">//     kill(getpid(),SIGABRT);</span></span><br></pre></td></tr></table></div></figure><p>æµ‹è¯•ç¨‹åºï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">pid_t</span> pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;parent process\n&quot;</span>);</span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">2</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;kill child process now\n&quot;</span>);</span><br><span class="line">        <span class="built_in">kill</span>(pid, SIGINT);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;child process\n&quot;</span>);</span><br><span class="line">            <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ‰§è¡Œç»“æœï¼š</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722193118885.png" alt="image-20230722193118885" style="zoom:67%"> <img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722193131543.png" alt="image-20230722193131543" style="zoom:67%"><p><strong>æœ‰å¯èƒ½ä¸º2æ¬¡ä¹Ÿæœ‰å¯èƒ½ä¸º3æ¬¡ï¼Œå› ä¸ºçˆ¶å­è¿›ç¨‹æ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œè°å…ˆè¿è¡Œè¦çœ‹æŠ¢å cpuï¼Œè¿™é‡Œå¦‚æœæ˜¯çˆ¶è¿›ç¨‹å…ˆæ‰§è¡Œå°±æ˜¯2æ¬¡ï¼Œå­è¿›ç¨‹å…ˆæ‰§è¡Œå°±ä¼šå…ˆå·å·æ‰“å°ä¸€æ¬¡ï¼Œå°±æ˜¯3æ¬¡ï¼Œè¿™ä¹Ÿä½“ç°äº†å¤šè¿›ç¨‹ç¨‹åºæ‰§è¡Œç»“æœçš„ä¸ç¡®å®šæ€§ï¼Œè¿™å®Œå…¨å–å†³äºæ“ä½œç³»ç»Ÿå¯¹äºè¿›ç¨‹çš„è°ƒåº¦</strong></p><h5 id="alarm"><a href="#alarm" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#alarm"></a> alarm()</h5><p><strong>è¿™é‡Œé¢è¯·æ³¨æ„alarm()å‡½æ•°çš„è¿”å›å€¼å’Œè®¾ç½®å‚æ•°ä¸º0æ—¶å€™çš„æƒ…å†µ</strong></p><p>å®šæ—¶å™¨åˆ°æ—¶é—´ä¹‹åç¨‹åºä¼šæ¥å— SIGALARM ä¿¡å·ï¼Œç„¶åç»ˆæ­¢</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">unsigned</span> <span class="type">int</span> <span class="title">alarm</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> seconds)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šå»è®¾ç½®å®šæ—¶å™¨ï¼›å‡½æ•°è°ƒç”¨ï¼Œå¼€å§‹å€’è®¡æ—¶ï¼›</span></span><br><span class="line"><span class="comment">//     å½“å€’è®¡æ—¶ä¸º0çš„æ—¶å€™ï¼Œå‡½æ•°ä¼šç»™å½“å‰çš„è¿›ç¨‹å‘é€ä¸€ä¸ªä¿¡å· SIGALARM</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">//     secondsï¼šå€’è®¡æ—¶æ—¶é•¿ï¼Œå•ä½ç§’ï¼Œå½“å‚æ•°ä¸º0çš„æ—¶å€™ï¼Œè®¡æ—¶å™¨æ— æ•ˆ(ä¸è¿›è¡Œå€’è®¡æ—¶ï¼Œä¹Ÿä¸å‘é€ä¿¡å·)</span></span><br><span class="line"><span class="comment">//         å–æ¶ˆä¸€ä¸ªå®šæ—¶å™¨ alarm(0)</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼š</span></span><br><span class="line"><span class="comment">//     - ä¹‹å‰æ²¡æœ‰å®šæ—¶å™¨ï¼Œè¿”å›0</span></span><br><span class="line"><span class="comment">//     - ä¹‹å‰æœ‰å®šæ—¶å™¨ï¼Œè¿”å›ä¹‹å‰å®šæ—¶å™¨å‰©ä½™çš„æ—¶é—´</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// - SIGALARM ä¿¡å·ï¼šé»˜è®¤ç»ˆæ­¢å½“å‰çš„è¿›ç¨‹ï¼Œæ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸”åªæœ‰å”¯ä¸€çš„ä¸€ä¸ªå®šæ—¶å™¨</span></span><br><span class="line"><span class="comment">//     alarm(10); -&gt;è¿”å›0</span></span><br><span class="line"><span class="comment">//     //è¿‡äº†ä¸€ç§’</span></span><br><span class="line"><span class="comment">//     alarm(5);  -&gt;è¿”å›9</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯¥å‡½æ•°ä¸é˜»å¡ï¼Œè®¾ç½®ä¹‹åä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œ</span></span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> seconds = <span class="built_in">alarm</span>(<span class="number">5</span>);             <span class="comment">// ä¸é˜»å¡</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;seconds : %d\n&quot;</span>, seconds);  <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">2</span>);</span><br><span class="line">    seconds = <span class="built_in">alarm</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;seconds : %d\n&quot;</span>, seconds);  <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ‰§è¡Œç»“æœï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722200410797.png" alt="image-20230722200410797"></p><p>æ¡ˆä¾‹ï¼šæŸ¥çœ‹è®¡ç®—æœºä¸€ç§’èƒ½è¾“å‡ºå¤šå°‘ä¸ªæ•°</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1ç§’é’Ÿç”µè„‘èƒ½æ•°å¤šå°‘ä¸ªæ•°</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">alarm</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, i++);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ‰§è¡Œç»“æœï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722200801779.png" alt="image-20230722200801779"></p><p>ä½†æ˜¯æˆ‘ä»¬è§‚å¯Ÿåˆ°è¾“å‡ºå®Œæ¯•èŠ±çš„æ—¶é—´å¥½åƒä¸æ­¢1ç§’ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p><strong>æ³¨æ„åˆ°è¿™é‡Œè¾“å‡ºçš„æ•°å¥½å¤šå¥½å¤šï¼Œè€Œç»ˆç«¯çš„è¾“å‡ºæ˜¯ä¾é å†…æ ¸å½“ä¸­çš„012æ–‡ä»¶æè¿°ç¬¦ï¼Œ0æ ‡å‡†è¾“å…¥STDIN_FILENOï¼Œ1æ ‡å‡†è¾“å‡ºSTDOUT_FILENOï¼Œ2æ ‡å‡†é”™è¯¯STDERR_FILENOï¼Œç„¶åè¦æƒ³è¾“å‡ºåˆ°ç»ˆç«¯å¿…é¡»è¦ç»å†ç‰¹å®šçš„äº‹ä»¶ï¼Œæ¯”å¦‚ç¨‹åºç»ˆæ­¢æˆ–è€…é‡åˆ°å›è½¦â€™\nâ€™ç­‰ç­‰ï¼Œè¿™æ˜¯å› ä¸ºç»ˆç«¯æœ‰ç¼“å†²åŒºçš„å­˜åœ¨ï¼›ä¹‹æ‰€ä»¥èŠ±äº†è¶…è¿‡1ç§’æ˜¯å› ä¸ºä»ç¼“å†²åŒºè¾“å‡ºåˆ°å±å¹•ä¸Šï¼Œè¿˜æ˜¯è¾“å‡ºäº†è¿™ä¹ˆå¤šçš„æ•°æ®ï¼ŒèŠ±è´¹äº†å¤§é‡æ—¶é—´</strong></p><p><strong>ä½†æ˜¯è¿™é‡Œåªæ•°äº†20ä¸‡ä¸åˆ°ï¼Œæ„Ÿè§‰å°‘å¤ªå¤šäº†ï¼Œè¿™æ˜¯å› ä¸ºå¾€ç»ˆç«¯ä¸Šè¾“å‡ºçš„æ—¶å€™éœ€è¦è°ƒç”¨æ–‡ä»¶æè¿°ç¬¦ï¼Œè¾“å‡ºä¸€æ¬¡è°ƒç”¨ä¸€æ¬¡ç£ç›˜I/Oï¼Œè¿™æ ·æµªè´¹æ—¶é—´ï¼ŒCPUæ²¡æœ‰ç™¾åˆ†ç™¾å»æ‰§è¡Œæ•°çš„è¿™ä¸ªæ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è¾“å‡ºé‡å®šå‘åˆ°ä¸€ä¸ªæ–‡æœ¬å½“ä¸­ï¼Œè¿™æ ·åªç”¨è°ƒç”¨ä¸€æ¬¡æ–‡ä»¶I/Oå°±å¯ä»¥æŠŠæ–‡ä»¶å†™åœ¨é‡Œé¢</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722201704262.png" alt="image-20230722201704262"></p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230722201732964.png" alt="image-20230722201732964" style="zoom:67%"><p>å¯è§è¿™æ ·å°±å¤šäº†å¾ˆå¤š</p><p><strong>å®é™…çš„æ—¶é—´ = å†…æ ¸æ—¶é—´ + ç”¨æˆ·æ—¶é—´ + æ¶ˆè€—çš„æ—¶é—´(æ¯”å¦‚I/Oæ“ä½œ)</strong></p><p><strong>è¿›è¡Œæ–‡ä»¶I/Oæ“ä½œçš„æ—¶å€™æ¯”è¾ƒæµªè´¹æ—¶é—´</strong></p><p><strong>å®šæ—¶å™¨ï¼Œå’Œè¿›ç¨‹çš„çŠ¶æ€æ— å…³(è‡ªç„¶å®šæ—¶æ³•)ï¼›æ— è®ºè¿›ç¨‹å¤„äºä»€ä¹ˆçŠ¶æ€ï¼Œè¿™ä¸ªalarm()éƒ½ä¼šè®¡æ—¶</strong></p><h5 id="settimer"><a href="#settimer" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#settimer"></a> settimer()</h5><p>æ³¨æ„æ³¨é‡Šçš„ä»‹ç»</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">setitimer</span><span class="params">(<span class="type">int</span> which, <span class="type">const</span> <span class="keyword">struct</span> itimerval *restrict new_value,</span></span></span><br><span class="line"><span class="params"><span class="function">                <span class="keyword">struct</span> itimerval *_Nullable restrict old_value)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šè®¾ç½®å®šæ—¶å™¨ï¼›å¯ä»¥æ›¿ä»£alarmå‡½æ•°ã€‚ç²¾åº¦å¯ä»¥è¾¾åˆ°å¾®ç§’ï¼Œå¹¶ä¸”è¿˜å¯ä»¥å®ç°å‘¨æœŸæ€§çš„å®šæ—¶</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">//     whichï¼šæŒ‡å®šçš„æ˜¯å®šæ—¶å™¨ä»¥ä»€ä¹ˆæ—¶é—´è®¡æ—¶</span></span><br><span class="line"><span class="comment">//         - ITIMER_REALï¼šçœŸå®æ—¶é—´(åŒ…å«å†…æ ¸+ç”¨æˆ·+æ¶ˆè€—çš„æ—¶é—´(ä¾‹å¦‚I/O))ï¼Œæ—¶é—´åˆ°è¾¾å‘é€ SIGALRM å¸¸ç”¨</span></span><br><span class="line"><span class="comment">//         - ITIMER_VIRTUALï¼šç”¨æˆ·æ—¶é—´ï¼Œæ—¶é—´åˆ°è¾¾å‘é€ SIGVTALRM</span></span><br><span class="line"><span class="comment">//         - ITIMER_PROFï¼šä»¥è¯¥è¿›ç¨‹åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€æ‰€æ¶ˆè€—çš„æ—¶é—´æ¥è®¡ç®—ï¼Œæ—¶é—´åˆ°è¾¾å‘é€ SIGPROF</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     new_valueï¼šè®¾ç½®å®šæ—¶å™¨å±æ€§</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//         struct itimerval &#123; //å®šæ—¶å™¨çš„ç»“æ„ä½“</span></span><br><span class="line"><span class="comment">//             struct timeval it_interval;  // æ¯ä¸ªé˜¶æ®µçš„æ—¶é—´ï¼Œé—´éš”æ—¶é—´</span></span><br><span class="line"><span class="comment">//             struct timeval it_value;     // å»¶è¿Ÿå¤šé•¿æ—¶é—´æ‰§è¡Œå®šæ—¶å™¨</span></span><br><span class="line"><span class="comment">//         &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//         struct timeval &#123; //æ—¶é—´çš„ç»“æ„ä½“</span></span><br><span class="line"><span class="comment">//             time_t tv_sec;        // ç§’æ•°</span></span><br><span class="line"><span class="comment">//             suseconds_t tv_usec;  // å¾®ç§’</span></span><br><span class="line"><span class="comment">//         &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//         egï¼šè¿‡10ç§’(it_value)åï¼Œæ¯éš”2ç§’(it_interval)å®šæ—¶ä¸€æ¬¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     old_valueï¼šè®°å½•ä¸Šä¸€æ¬¡å®šæ—¶çš„æ—¶é—´å‚æ•°ï¼Œæ˜¯ä¸€ä¸ªä¼ å‡ºå‚æ•°ï¼Œå‡½æ•°å°†ä¸Šä¸€æ¬¡çš„çŠ¶æ€å¿ƒå¦‚è¿›å»ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ï¼Œå°±æŒ‡å®šnullptrå°±å¯ä»¥äº†</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼š</span></span><br><span class="line"><span class="comment">//     æˆåŠŸ 0</span></span><br><span class="line"><span class="comment">//     å¤±è´¥ -1ï¼Œè®¾ç½®errno</span></span><br></pre></td></tr></table></div></figure><p>ä»£ç ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿‡3ç§’ä»¥åï¼Œæ¯éš”2ç§’å®šæ—¶ä¸€æ¬¡</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è¿‡ä¸‰ç§’ï¼Œä¼šå‘é€ä¿¡å·</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">timeval</span> _value;</span><br><span class="line">    _value.tv_sec = <span class="number">3</span>;</span><br><span class="line">    _value.tv_usec = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¯éš”ä¸¤ç§’ï¼Œä¼šå‘é€ä¿¡å·</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">timeval</span> _interavl;</span><br><span class="line">    _interavl.tv_sec = <span class="number">2</span>;</span><br><span class="line">    _interavl.tv_usec = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// itimervalç»“æ„ä½“</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">itimerval</span> new_value;</span><br><span class="line">    new_value.it_value = _value;</span><br><span class="line">    new_value.it_interval = _interavl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®å®šæ—¶å™¨</span></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">setitimer</span>(ITIMER_REAL, &amp;new_value, <span class="literal">nullptr</span>);  <span class="comment">// éé˜»å¡</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;å®šæ—¶å™¨å¼€å§‹äº†\n&quot;</span>);                               <span class="comment">// ç«‹åˆ»æ‰§è¡Œï¼Œè¡¨æ˜æ˜¯éé˜»å¡çš„</span></span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;setitimer&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p><strong>3ç§’çš„å»¶è¿Ÿå¼€å§‹å’Œ2ç§’çš„å®šæ—¶é—´éš”åˆ°äº†åéƒ½ä¼šå‘é€ä¿¡å·ï¼Œå› æ­¤ç¨‹åºæ‰§è¡Œä¸‹æ¥æ˜¯åœ¨3ç§’ä¹‹åå°±é€€å‡ºäº†ï¼Œè¿™æ˜¯3ç§’çš„å»¶è¿Ÿå¼€å§‹çš„ä¿¡å·</strong></p><p><strong>è€Œä¸”&quot;å®šæ—¶å™¨å¼€å§‹äº†&quot;è¿™å¥è¯æ˜¯ç«‹åˆ»å¼€å§‹çš„ï¼Œè¿™å°±è¡¨æ˜è¿™ä¸ªå‡½æ•°æ˜¯éé˜»å¡çš„ï¼Œè¿™ä¸ªå‡½æ•°æ‰§è¡Œåï¼Œè™½ç„¶å®šæ—¶å™¨è¿˜æ²¡æœ‰å¼€å§‹ï¼Œä½†æ˜¯ç¨‹åºç»§ç»­åœ¨æ‰§è¡Œ</strong></p><p><strong>ä½†æ˜¯è¿™æ ·çœ‹èµ·æ¥æ²¡æœ‰åŠæ³•å®ç°æ¯2ç§’ä¸€æ¬¡çš„æ•ˆæœï¼Œè¿™å°±éœ€è¦æ•æ‰ä¿¡å·ï¼Œè¿™æ ·æ‰èƒ½åšæˆ‘ä»¬è‡ªå·±çš„äº‹æƒ…</strong></p><h4 id="ä¿¡å·æ•æ‰å‡½æ•°"><a href="#ä¿¡å·æ•æ‰å‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä¿¡å·æ•æ‰å‡½æ•°"></a> ä¿¡å·æ•æ‰å‡½æ•°</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230723150743944.png" alt="image-20230723150743944"></p><h5 id="signal"><a href="#signal" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#signal"></a> signal()</h5><p>æ³¨æ„å›è°ƒå‡½æ•°çš„å‡½æ•°æ ¼å¼å®šä¹‰æ˜¯æœ‰è¦æ±‚çš„ï¼Œå°±æ˜¯ typedef é‚£ä¸€è¡Œï¼Œé‚£æ˜¯ä¸ªå‡½æ•°æŒ‡é’ˆçš„å†™æ³•ï¼Œ<strong>è¦æ±‚æˆ‘ä»¬ä¼ å…¥çš„å›è°ƒå‡½æ•°è¿”å›å€¼å¿…é¡»ä¸ºvoidï¼Œç„¶åå‚æ•°æ˜¯intï¼Œè¿™ä¸ªè®°å½•çš„æ˜¯æ•æ‰åˆ°çš„ä¿¡å·çš„ç¼–å·</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*<span class="type">sighandler_t</span>)</span><span class="params">(<span class="type">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">sighandler_t</span> <span class="title">signal</span><span class="params">(<span class="type">int</span> signum, <span class="type">sighandler_t</span> handler)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šè®¾ç½®æŸä¸ªä¿¡å·çš„æ•æ‰è¡Œä¸ºï¼Œ</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">//     signumï¼šè¦æ•æ‰çš„ä¿¡å·</span></span><br><span class="line"><span class="comment">//         æ³¨æ„ï¼šSIGKILL å’Œ SIGSTOP ä¸èƒ½è¢«æ•æ‰ï¼Œä¸èƒ½è¢«å¿½ç•¥ï¼›</span></span><br><span class="line"><span class="comment">//             å› ä¸ºè¿™ä¸¤ä¸ªä¿¡å·éƒ½æ˜¯å¸¦æœ‰å¼ºåˆ¶æ€§çš„æ€æ­»æˆ–è€…æš‚åœè¿›ç¨‹ï¼Œè¿™ä¸ªæ˜¯éœ€è¦ä¿è¯æƒå¨çš„ï¼Œå¦åˆ™å¼ºåˆ¶æ€§éƒ½è§£å†³ä¸äº†å°±å¯ä»¥è¢«ä¸æ³•åˆ†å­åˆ©ç”¨äº†ï¼Œæ¯”å¦‚åˆ¶ä½œç—…æ¯’è®©è¿›ç¨‹ä¸€ç›´è¿è¡Œæ¶ˆè€—èµ„æºï¼Œè¿™ä¸¤ä¸ªä¿¡å·æ²¡æœ‰åŠæ³•è§£å†³</span></span><br><span class="line"><span class="comment">//     handerï¼šæ•æ‰åˆ°ä¿¡å·è¦å¦‚ä½•å¤„ç†</span></span><br><span class="line"><span class="comment">//         SIG_IGNï¼šå¿½ç•¥ä¿¡å·</span></span><br><span class="line"><span class="comment">//         SIG_DFLï¼šç”¨ä¿¡å·é»˜è®¤çš„è¡Œä¸º</span></span><br><span class="line"><span class="comment">//         å›è°ƒå‡½æ•°ï¼šè¿™ä¸ªå‡½æ•°æ˜¯å†…æ ¸è°ƒç”¨ï¼Œç¨‹åºå‘˜åªè´Ÿè´£å†™ï¼Œæ•æ‰åˆ°ä¿¡å·åå¦‚ä½•å»å¤„ç†ä¿¡å·</span></span><br><span class="line"><span class="comment">//             å›è°ƒå‡½æ•°éœ€è¦ç¨‹åºå‘˜å®ç°ï¼Œæå‰å‡†å¤‡å¥½ï¼Œå‡½æ•°çš„ç±»å‹æ ¹æ®å®é™…éœ€æ±‚ï¼Œçœ‹å‡½æ•°æŒ‡é’ˆçš„å®šä¹‰</span></span><br><span class="line"><span class="comment">//             ä¸æ˜¯ç¨‹åºå‘˜è°ƒç”¨çš„ï¼Œè€Œæ˜¯å½“ä¿¡å·äº§ç”Ÿç”±å†…æ ¸è°ƒç”¨</span></span><br><span class="line"><span class="comment">//             å‡½æ•°æŒ‡é’ˆæ˜¯å®ç°å›è°ƒçš„æ‰‹æ®µï¼Œå‡½æ•°å®ç°åï¼Œå°†å‡½æ•°åæ”¾åˆ°å‡½æ•°æŒ‡é’ˆçš„ä½ç½®å°±å¯ä»¥äº†</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼š</span></span><br><span class="line"><span class="comment">//     æˆåŠŸï¼Œè¿”å›ä¸Šä¸€æ¬¡æ³¨å†Œçš„ä¿¡å·å¤„ç†å‡½æ•°çš„åœ°å€ï¼›ç¬¬ä¸€æ¬¡è¿”å›nullptr</span></span><br><span class="line"><span class="comment">//     å¤±è´¥ï¼Œè¿”å›SIG_ERRï¼Œè®¾ç½®errno</span></span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">myalarm</span><span class="params">(<span class="type">int</span> num)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;æ•æ‰åˆ°äº†ä¿¡å·çš„ç¼–å·æ˜¯: %d\n&quot;</span>, num);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ³¨å†Œä¿¡å·æ•æ‰ï¼Œéœ€è¦æå‰æ³¨å†Œï¼Œé¿å…å®šæ—¶å™¨å¼€å§‹æ‰§è¡Œåå¯èƒ½ä¿¡å·æ•æ‰è¿˜æ²¡ç”Ÿæ•ˆå¯¼è‡´é”™è¿‡ä¿¡å·æ•æ‰çš„æƒ…å†µ</span></span><br><span class="line">    <span class="comment">// signal(SIGALRM, SIG_IGN);  // ä¿¡å·äº§ç”Ÿåå¿½ç•¥ä¿¡å·ï¼Œç¨‹åºä¼šä¸€ç›´æ‰§è¡Œ</span></span><br><span class="line">    <span class="comment">// signal(SIGALRM, SIG_DFL);  // æŒ‰ç…§é»˜è®¤çš„æ–¹å¼å¤„ç†ä¿¡å·ï¼Œç¨‹åºå»¶è¿Ÿ3ç§’çš„æ—¶å€™å¼€å§‹è®¡æ—¶ï¼Œå‘é€ä¿¡å·ç„¶åç»ˆæ­¢</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// typedef void (*sighandler_t)(int); å‡½æ•°æŒ‡é’ˆçš„ç±»å‹ï¼Œintç±»å‹çš„å‚æ•°è¡¨ç¤ºæ•æ‰åˆ°çš„ä¿¡å·çš„å€¼</span></span><br><span class="line">    <span class="type">sighandler_t</span> ret = <span class="built_in">signal</span>(SIGALRM, myalarm);</span><br><span class="line">    <span class="keyword">if</span> (ret == SIG_ERR) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;signal&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿‡ä¸‰ç§’ï¼Œä¼šå‘é€ä¿¡å·</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">timeval</span> _value;</span><br><span class="line">    _value.tv_sec = <span class="number">3</span>;</span><br><span class="line">    _value.tv_usec = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¯éš”ä¸¤ç§’ï¼Œä¼šå‘é€ä¿¡å·</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">timeval</span> _interavl;</span><br><span class="line">    _interavl.tv_sec = <span class="number">2</span>;</span><br><span class="line">    _interavl.tv_usec = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// itimervalç»“æ„ä½“</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">itimerval</span> new_value;</span><br><span class="line">    new_value.it_value = _value;</span><br><span class="line">    new_value.it_interval = _interavl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®å®šæ—¶å™¨</span></span><br><span class="line">    <span class="type">int</span> rets = <span class="built_in">setitimer</span>(ITIMER_REAL, &amp;new_value, <span class="literal">nullptr</span>);  <span class="comment">// éé˜»å¡</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;å®šæ—¶å™¨å¼€å§‹äº†\n&quot;</span>);                                <span class="comment">// ç«‹åˆ»æ‰§è¡Œï¼Œè¡¨æ˜æ˜¯éé˜»å¡çš„</span></span><br><span class="line">    <span class="keyword">if</span> (rets == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;setitimer&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h4 id="ä¿¡å·é›†"><a href="#ä¿¡å·é›†" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä¿¡å·é›†"></a> ä¿¡å·é›†</h4><p><strong>ä½å›¾æœºåˆ¶ï¼šä¿¡å·é›†æ˜¯ä¸€å †ä¿¡å·çš„é›†åˆï¼Œé‚£ä¹ˆæ€ä¹ˆå»è¡¨ç¤ºè¿™ä¸ªä¿¡å·é›†å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ä¿¡å·æ˜¯ç”¨ä¸€ä¸ªæ•´æ•°çš„åºå·è¡¨ç¤ºçš„(1-31 34-64)ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ç±»ä¼¼äºæ–‡ä»¶st_modeé‚£ä¸ªçš„å½¢å¼ï¼Œç”¨æ¯ä¸€ä½æ¥è¡¨ç¤ºä¸€ä¸ªä¿¡å·ï¼Œ0 1 è¡¨ç¤ºä¿¡å·æœ‰æ— ï¼Œè¿™æ ·ä¿¡å·é›†å°±ç›¸å½“äºæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œè€Œæƒ³è¦æ·»åŠ ä¸€ä¸ªä¿¡å·è¿›å»å°±ç”¨è¿™ä¸ªä¿¡å·(ç”¨ä¿¡å·é›†çš„æ ¼å¼è¡¨ç¤º)æŒ‰ä½æˆ–å°±å¥½äº†</strong></p><p><strong>ä¿¡å·ä¸‰ç§çŠ¶æ€ï¼š</strong></p><p><strong>äº§ç”Ÿï¼šä¿¡å·äº§ç”Ÿ</strong></p><p><strong>æœªå†³ï¼šä¿¡å·äº§ç”Ÿåˆ°ä¿¡å·è¢«å¤„ç†ä¹‹å‰çš„è¿™æ®µæ—¶é—´</strong></p><p><strong>æŠµè¾¾ï¼šä¿¡å·æŠµè¾¾</strong></p><p><strong>ç„¶åé˜»å¡ä¿¡å·æ˜¯æŒ‡é˜»æ­¢ä¿¡å·è¢«å¤„ç†ï¼Œè€Œä¸æ˜¯é˜»æ­¢ä¿¡å·äº§ç”Ÿï¼›é˜»å¡å°±æ˜¯è®©ç³»ç»Ÿä¿æŒä¿¡å·ï¼Œç•™ç€ä»¥åå‘é€</strong></p><p><strong>æˆ‘ä»¬å¯ä»¥è®¾ç½®é˜»å¡ä¿¡å·é›†ï¼Œè¡¨ç¤ºè¦é˜»å¡å“ªäº›ä¿¡å·ï¼›è€Œä¸èƒ½ä¿®æ”¹æˆ–è€…è®¾ç½®æœªå†³ä¿¡å·é›†ï¼Œæˆ‘ä»¬ä¸èƒ½é˜»æ­¢ä¿¡å·çš„äº§ç”Ÿï¼›</strong></p><p><strong>ç³»ç»ŸPCBå½“ä¸­è‡ªå¸¦é˜»å¡ä¿¡å·é›†å’Œæœªå†³ä¿¡å·é›†ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½ç›´æ¥æ“ä½œï¼Œéœ€è¦å€ŸåŠ©ç³»ç»Ÿæä¾›çš„APIæ‰èƒ½æ“ä½œ</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230723154213795.png" alt="image-20230723154213795"></p><p>é˜»å¡ä¿¡å·é›†å’Œæœªå†³ä¿¡å·é›†(åœ¨PCBå½“ä¸­)</p><ul><li><strong>ç”¨æˆ·é€šè¿‡é”®ç›˜ Ctrl + Cï¼Œäº§ç”ŸSIGINTä¿¡å·ï¼Œä¿¡å·è¢«åˆ›å»º</strong></li><li><strong>ä¿¡å·äº§ç”Ÿï¼Œä½†æ˜¯æ²¡æœ‰è¢«å¤„ç†ï¼Œæœªå†³çŠ¶æ€ï¼Œä»¥ä¸‹æ˜¯å·¥ä½œè¿‡ç¨‹(ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆä¿¡å·äº§ç”Ÿäº†ä¸ä¼šè¢«ç«‹å³å¤„ç†)</strong><ul><li><strong>åœ¨å†…æ ¸å½“ä¸­ï¼Œå°†æ‰€æœ‰çš„æ²¡æœ‰è¢«å¤„ç†çš„ä¿¡å·å­˜å‚¨åœ¨ä¸€ä¸ªé›†åˆå½“ä¸­(æœªå†³ä¿¡å·é›†)</strong></li><li><strong>SIGINTä¿¡å·ï¼ŒçŠ¶æ€å­˜å‚¨åœ¨ç¬¬äºŒä¸ªæ ‡å¿—ä½ï¼Œè¿™ä¸ªæ ‡å¿—ä½çš„å€¼ä¸º0è¯´æ˜ä¿¡å·ä¸æ˜¯æœªå†³çŠ¶æ€ï¼Œä¸º1è¯´æ˜ä¿¡å·æ˜¯æœªå†³çŠ¶æ€</strong></li></ul></li><li><strong>è¿™ä¸ªæœªå†³çŠ¶æ€çš„ä¿¡å·ï¼Œéœ€è¦è¢«å¤„ç†ï¼Œå¤„ç†ä¹‹å‰éœ€è¦å’Œå¦ä¸€ä¸ªä¿¡å·é›†(é˜»å¡ä¿¡å·é›†)å¯¹åº”çš„æ ‡å¿—ä½è¿›è¡Œæ¯”è¾ƒ</strong><ul><li><strong>é˜»å¡ä¿¡å·é›†é»˜è®¤ä¸é˜»å¡æ‰€æœ‰ä¿¡å·</strong></li><li><strong>å¦‚æœæƒ³è¦é˜»å¡æŸäº›ä¿¡å·ï¼Œéœ€è¦ç”¨æˆ·è°ƒç”¨ç³»ç»Ÿçš„API</strong></li></ul></li><li><strong>åœ¨å¤„ç†çš„æ—¶å€™å’Œé˜»å¡ä¿¡å·é›†ä¸­çš„æ ‡å¿—ä½æŸ¥è¯¢ï¼Œçœ‹æ˜¯ä¸æ˜¯å¯¹è¯¥ä¿¡å·è®¾ç½®äº†é˜»å¡</strong><ul><li><strong>æ²¡æœ‰é˜»å¡ï¼Œè¿™ä¸ªä¿¡å·å°±ä¼šè¢«å¤„ç†</strong></li><li><strong>å¦‚æœé˜»å¡äº†ï¼Œè¿™ä¸ªä¿¡å·å°±ç»§ç»­å¤„äºæœªå†³çŠ¶æ€ï¼Œç›´åˆ°é˜»å¡è§£é™¤ï¼Œè¿™ä¸ªä¿¡å·è¢«å¤„ç†</strong></li></ul></li></ul><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230723165142990.png" alt="image-20230723165142990"></p><h5 id="ç›¸å…³å‡½æ•°-3"><a href="#ç›¸å…³å‡½æ•°-3" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç›¸å…³å‡½æ•°-3"></a> ç›¸å…³å‡½æ•°</h5><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230723170027725.png" alt="image-20230723170027725"></p><p><strong>å‰é¢äº”ä¸ªï¼Œéƒ½æ˜¯å¯¹è‡ªå·±å®šä¹‰çš„ä¿¡å·é›†è¿›è¡Œæ“ä½œï¼Œä¿¡å·é›†çš„ç±»å‹æ˜¯ sigset_tï¼Œæœ¬è´¨å°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¸‹æ ‡å¯¹åº”ä¿¡å·signumï¼Œå€¼ä»£è¡¨æ˜¯å¦ä¿¡å·çŠ¶æ€</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">	<span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»¥ä¸‹çš„ä¿¡å·é›†ç›¸å…³çš„å‡½æ•°éƒ½æ˜¯å¯¹è‡ªå®šä¹‰çš„ä¿¡å·é›†è¿›è¡Œæ“ä½œï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥ä¿®æ”¹ç³»ç»Ÿå½“ä¸­çš„æœªå†³ä¿¡å·é›†å’Œé˜»å¡ä¿¡å·é›†!!!</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">sigemptyset</span><span class="params">(<span class="type">sigset_t</span> *set)</span></span>;</span><br><span class="line"><span class="comment">// åŠŸèƒ½ï¼šæ¸…ç©ºä¿¡å·é›†ä¸­çš„æ•°æ®ï¼Œå°†ä¿¡å·é›†ä¸­çš„æ‰€æœ‰æ ‡å¿—ä½ç½®ä¸º0</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼šsetï¼Œä¼ å‡ºå‚æ•°ï¼Œéœ€è¦æ“ä½œçš„ä¿¡å·é›†</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼šæˆåŠŸ 0ï¼›å¤±è´¥ -1ï¼Œä¿®æ”¹errno</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">sigfillset</span><span class="params">(<span class="type">sigset_t</span> *set)</span></span>;</span><br><span class="line"><span class="comment">// åŠŸèƒ½ï¼šå°†ä¿¡å·é›†ä¸­çš„æ‰€æœ‰æ ‡å¿—ä½ç½®ä¸º1</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼šsetï¼Œä¼ å‡ºå‚æ•°ï¼Œéœ€è¦æ“ä½œçš„ä¿¡å·é›†</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼šæˆåŠŸ 0ï¼›å¤±è´¥ -1ï¼Œä¿®æ”¹errno</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">sigaddset</span><span class="params">(<span class="type">sigset_t</span> *set, <span class="type">int</span> signum)</span></span>;</span><br><span class="line"><span class="comment">// åŠŸèƒ½ï¼šè®¾ç½®ä¿¡å·é›†ä¸­çš„æŸä¸€ä¸ªä¿¡å·å¯¹åº”çš„æ ‡å¿—ä½ä¸º1ï¼Œè¡¨ç¤ºé˜»å¡è¿™ä¸ªä¿¡å·</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼šsetï¼Œä¼ å‡ºå‚æ•°ï¼Œéœ€è¦æ“ä½œçš„ä¿¡å·é›†ï¼›signumï¼šéœ€è¦è®¾ç½®ä¸ºé˜»å¡çš„ä¿¡å·</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼šæˆåŠŸ 0ï¼›å¤±è´¥ -1ï¼Œä¿®æ”¹errno</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">sigdelset</span><span class="params">(<span class="type">sigset_t</span> *set, <span class="type">int</span> signum)</span></span>;</span><br><span class="line"><span class="comment">// åŠŸèƒ½ï¼šè®¾ç½®ä¿¡å·é›†ä¸­çš„æŸä¸€ä¸ªä¿¡å·å¯¹åº”çš„æ ‡å¿—ä½ä¸º0ï¼Œè¡¨ç¤ºä¸é˜»å¡è¿™ä¸ªä¿¡å·</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼šsetï¼Œä¼ å‡ºå‚æ•°ï¼Œéœ€è¦æ“ä½œçš„ä¿¡å·é›†ï¼›signumï¼šéœ€è¦è®¾ç½®ä¸ä¸ºé˜»å¡çš„ä¿¡å·</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼šæˆåŠŸ 0ï¼›å¤±è´¥ -1ï¼Œä¿®æ”¹errno</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">sigismember</span><span class="params">(<span class="type">const</span> <span class="type">sigset_t</span> *set, <span class="type">int</span> signum)</span></span>;</span><br><span class="line"><span class="comment">// åŠŸèƒ½ï¼šåˆ¤æ–­æŸä¸ªä¿¡å·æ˜¯å¦é˜»å¡</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼šsetï¼Œéœ€è¦æ“ä½œçš„ä¿¡å·é›†ï¼›signumï¼šéœ€è¦æŸ¥çœ‹æ˜¯å¦é˜»å¡çš„ä¿¡å·</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼š(ä¸å‰é¢ä¸ä¸€æ ·!!!)</span></span><br><span class="line"><span class="comment">//     1 æ˜¯æˆå‘˜ï¼Œsignumè¢«é˜»å¡ï¼›0 ä¸æ˜¯æˆå‘˜ï¼Œä¸é˜»å¡</span></span><br><span class="line"><span class="comment">//     -1 è¡¨ç¤ºå¤±è´¥ï¼Œä¿®æ”¹errno</span></span><br></pre></td></tr></table></div></figure><p>ä»£ç ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Judge</span><span class="params">(<span class="type">const</span> <span class="type">sigset_t</span>&amp; set, <span class="type">const</span> <span class="type">int</span>&amp; signum)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">sigismember</span>(&amp;set, signum);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;sigismember&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">1</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ä¿¡å·%dåœ¨setå½“ä¸­\n&quot;</span>, signum);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (ret == <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ä¿¡å·%dä¸åœ¨setå½“ä¸­\n&quot;</span>, signum);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªä¿¡å·é›†</span></span><br><span class="line">    <span class="type">sigset_t</span> set;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™ä¹ˆåˆ›å»ºçš„æ•°æ®ä¸€èˆ¬æ˜¯éšæœºçš„ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç”¨ç³»ç»Ÿçš„apiæ¸…ç©º</span></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">sigemptyset</span>(&amp;set);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;sigemptyset&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ¤æ–­SIGINTæ˜¯å¦åœ¨ä¿¡å·é›†setä¸­</span></span><br><span class="line">    <span class="built_in">Judge</span>(set, SIGINT);  <span class="comment">// 2å·ä¿¡å·ä¸åœ¨</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ·»åŠ å‡ ä¸ªä¿¡å·</span></span><br><span class="line">    ret = <span class="built_in">sigaddset</span>(&amp;set, SIGINT);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;sigaddset&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ret = <span class="built_in">sigaddset</span>(&amp;set, SIGQUIT);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;sigaddset&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦åœ¨ä¿¡å·é›†setä¸­</span></span><br><span class="line">    <span class="built_in">Judge</span>(set, SIGINT);   <span class="comment">// 2å·ä¿¡å·åœ¨</span></span><br><span class="line">    <span class="built_in">Judge</span>(set, SIGQUIT);  <span class="comment">// 3å·ä¿¡å·åœ¨</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ é™¤ä¸€ä¸ªä¿¡å·</span></span><br><span class="line">    ret = <span class="built_in">sigdelset</span>(&amp;set, SIGQUIT);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;sigdelset&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ¤æ–­SIGQUITæ˜¯å¦åœ¨ä¿¡å·é›†setä¸­</span></span><br><span class="line">    <span class="built_in">Judge</span>(set, SIGQUIT);  <span class="comment">// 3å·ä¿¡å·ä¸åœ¨</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p><strong>sigprocmask()å’Œsigpending()</strong></p><p><strong>è°ƒç”¨ä¹‹åå°±å¯ä»¥æŠŠæˆ‘ä»¬è‡ªå·±è®¾ç½®çš„ä¿¡å·é›†è®¾ç½®åˆ°ç³»ç»Ÿæä¾›çš„é˜»å¡ä¿¡å·é›†å½“ä¸­ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å”¯ä¸€èƒ½è®¾ç½®ç³»ç»Ÿå†…æ ¸PCBä¸­çš„ä¿¡å·é›†ï¼Œæœªå†³ä¿¡å·é›†ä¸èƒ½è¢«è®¾ç½®æˆ–è€…å¤„ç†ï¼Œåªèƒ½è¢«è¯»å–</strong></p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230724150434261.png" alt="image-20230724150434261" style="zoom:50%"><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">sigprocmask</span><span class="params">(<span class="type">int</span> how, <span class="type">const</span> <span class="type">sigset_t</span> *_Nullable restrict set,</span></span></span><br><span class="line"><span class="params"><span class="function">                                   <span class="type">sigset_t</span> *_Nullable restrict oldset)</span></span>;</span><br><span class="line"><span class="comment">// åŠŸèƒ½ï¼šå°†è‡ªå®šä¹‰ä¿¡å·é›†ä¸­çš„æ•°æ®è®¾ç½®åˆ°å†…æ ¸å½“ä¸­(è®¾ç½®é˜»å¡ï¼Œæ¥è§¦é˜»å¡ï¼Œæ›¿æ¢)</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">//     howï¼šå¦‚ä½•å¯¹å†…æ ¸é˜»å¡ä¿¡å·é›†è¿›è¡Œå¤„ç†</span></span><br><span class="line"><span class="comment">//         SIG_BLOCKï¼šå°†ç”¨æˆ·è®¾ç½®çš„é˜»å¡ä¿¡å·é›†æ·»åŠ åˆ°å†…æ ¸ä¸­ï¼ŒåŸæ¥çš„æ•°æ®ä¸å˜</span></span><br><span class="line"><span class="comment">//             å‡è®¾ä¸­å†…æ ¸ä¸­é»˜è®¤çš„é˜»å¡ä¿¡å·é›†æ˜¯maskï¼Œåˆ™ mask | set (æ·»åŠ çš„å…¬å¼)</span></span><br><span class="line"><span class="comment">//         SIG_UNBLOCKï¼šæ ¹æ®ç”¨æˆ·è®¾ç½®çš„æ•°æ®ï¼Œå¯¹å†…æ ¸ä¸­çš„æ•°æ®è¿›è¡Œæ¥è§¦é˜»å¡</span></span><br><span class="line"><span class="comment">//             mask &amp; = ~ set (å»é™¤çš„å…¬å¼)</span></span><br><span class="line"><span class="comment">//             æ¯”å¦‚ mask 1 0 1 1 1 ï¼Œset 0 0 1 0 1ï¼Œè§£é™¤è¿™ä¸¤ä½çš„é˜»å¡</span></span><br><span class="line"><span class="comment">//             é‚£ä¹ˆå°±æ˜¯ ~set 1 1 0 1 0 ï¼Œç„¶åæƒ³ä¸å°±å¾—åˆ° 1 0 0 1 0</span></span><br><span class="line"><span class="comment">//         SIG_SETMASKï¼šè¦†ç›–å†…æ ¸ä¸­åŸæ¥çš„å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     setï¼šå·²ç»åˆå§‹åŒ–å¥½çš„ç”¨æˆ·è‡ªå®šä¹‰çš„ä¿¡å·é›†</span></span><br><span class="line"><span class="comment">//     oldsetï¼šä¿å­˜çš„ä¹‹å‰å†…æ ¸ä¸­çš„é˜»å¡ä¿¡å·é›†çš„çŠ¶æ€ï¼Œä¼ å‡ºå‚æ•°ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ï¼Œè®¾ç½®ä¸ºnullptrå³å¯</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼š</span></span><br><span class="line"><span class="comment">//     æˆåŠŸ 0</span></span><br><span class="line"><span class="comment">//     å¤±è´¥ -1ï¼Œå¹¶ä¸”è®¾ç½®errnoï¼Œæœ‰ä¸¤ä¸ªå€¼ï¼šEFAULTï¼ŒEINVAL</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">sigpending</span><span class="params">(<span class="type">sigset_t</span> *set)</span></span>;</span><br><span class="line"><span class="comment">// åŠŸèƒ½ï¼šè·å–å†…æ ¸ä¸­çš„æœªå†³ä¿¡å·é›†</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼šsetï¼Œä¼ å‡ºå‚æ•°ï¼Œä¿å­˜çš„æ˜¯å†…æ ¸ä¸­çš„æœªå†³ä¿¡å·é›†</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼š</span></span><br><span class="line"><span class="comment">//     æˆåŠŸ 0ï¼Œå¤±è´¥ -1ï¼Œè®¾ç½®errno</span></span><br></pre></td></tr></table></div></figure><p>æ³¨æ„ä¸€ç‚¹ï¼Œå°±æ˜¯åœ¨äºŒè¿›åˆ¶æ•°å½“ä¸­ï¼Œæ·»åŠ ä½æ•°ä¸º1å’Œè§£é™¤ä½æ•°ä¸º1(å˜ä¸º0)çš„æ“ä½œ</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mask | set <span class="comment">//æ·»åŠ </span></span><br><span class="line">mask &amp; = ~set <span class="comment">//è§£é™¤</span></span><br></pre></td></tr></table></div></figure><p>ç°åœ¨æˆ‘ä»¬éœ€è¦å†™ä¸€ä¸ªç¨‹åºï¼Œç”¨æ¥æŸ¥çœ‹å†…æ ¸å½“ä¸­çš„æœªå†³ä¿¡å·é›†ï¼Œå¹¶ä¸”è®¾ç½®æŸäº›ä¿¡å·é˜»å¡ï¼Œç„¶åå†æ¬¡æŸ¥çœ‹</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼–å†™ä¸€ä¸ªç¨‹åºï¼ŒæŠŠæ‰€æœ‰çš„å¸¸è§„ä¿¡å·(1-31)çš„æœªå†³çŠ¶æ€æ‰“å°åˆ°å±å¹•</span></span><br><span class="line"><span class="comment">// è®¾ç½®æŸäº›ä¿¡å·æ˜¯é˜»å¡çš„ï¼Œé€šè¿‡é”®ç›˜äº§ç”Ÿè¿™äº›ä¿¡å·</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è®¾ç½® 2å·ä¿¡å· SIGINT(ctrl+C) å’Œ 3å·ä¿¡å·SIGQUIT(ctrl+\) é˜»å¡</span></span><br><span class="line">    <span class="type">sigset_t</span> set;</span><br><span class="line">    <span class="comment">// æ¸…ç©º</span></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">sigemptyset</span>(&amp;set);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;sigemptyset&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†2å·å’Œ3å·ä¿¡å·æ·»åŠ è¿›å»</span></span><br><span class="line">    ret = <span class="built_in">sigaddset</span>(&amp;set, SIGINT);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;sigaddset&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ret = <span class="built_in">sigaddset</span>(&amp;set, SIGQUIT);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;sigaddset&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¿®æ”¹å†…æ ¸ä¸­çš„ä¿¡å·é›†</span></span><br><span class="line">    ret = <span class="built_in">sigprocmask</span>(SIG_BLOCK, &amp;set, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;sigprocmask&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨å¾ªç¯å½“ä¸­è·å–æœªå†³ä¿¡å·é›†çš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">sigset_t</span> pendingset;</span><br><span class="line">        ret = <span class="built_in">sigemptyset</span>(&amp;pendingset);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;sigemptyset&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">sigpending</span>(&amp;pendingset);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éå†å‰32ä½ å³1-31å·(0å·æ²¡ç”¨)</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; <span class="number">32</span>; ++i) &#123;</span><br><span class="line">            ret = <span class="built_in">sigismember</span>(&amp;pendingset, i);</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">                <span class="built_in">perror</span>(<span class="string">&quot;sigismember&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="number">1</span> == ret)</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == ret)</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸ºäº†é˜²æ­¢åªèƒ½é€šè¿‡kill -9 å‘½ä»¤æ€æ­»è¯¥è¿›ç¨‹ï¼Œç°åœ¨æˆ‘ä»¬è®¡æ•°ï¼Œåˆ°10å°±æ¥è§¦é˜»å¡</span></span><br><span class="line">        <span class="keyword">if</span> (count++ == <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;2å·ä¿¡å·SIGINTå’Œ3å·ä¿¡å·SIGQUITå·²ç»è§£é™¤é˜»å¡\n&quot;</span>);</span><br><span class="line">            ret = <span class="built_in">sigprocmask</span>(SIG_UNBLOCK, &amp;set, <span class="literal">nullptr</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">                <span class="built_in">perror</span>(<span class="string">&quot;sigprocmask&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è¿™é‡Œæˆ‘ä»¬è®¾ç½®äº†10ç§’åå°±ä¼šè§£é™¤é˜»å¡ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦é˜²æ­¢è¿™ä¸ªè¿›ç¨‹åªèƒ½é€šè¿‡kill -9å‘½ä»¤å¼ºåˆ¶æ€æ­»ï¼Œç»™è‡ªå·±ç•™ä¸€æ¡åè·¯</p><p>æ‰§è¡Œç»“æœï¼š</p><p><strong>å¯è§ï¼Œå½“æˆ‘ä»¬è¾“å‡º ctrl+c å’Œctrl+\ çš„æ—¶å€™ï¼Œæœªå†³ä¿¡å·é›†é‡Œé¢æ·»åŠ äº†è¿™ä¸¤ä¸ªä¿¡å·ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬è®¾ç½®äº†é˜»å¡ï¼Œä¸ä¼šå»ç«‹å³å¤„ç†ï¼Œè¿™ç§æƒ…å†µä¼šæŒç»­åˆ°æˆ‘è§£é™¤ä»–çš„é˜»å¡æ‰è¡Œï¼Œæ‰€ä»¥ä»–å¾ˆæ€¥ï¼Œä½†æ˜¯ä»–æ²¡å¾—é€‰æ‹©ã€‚å½“æˆ‘è§£é™¤äº†è¿™ä¸¤ä¸ªä¿¡å·çš„é˜»å¡åï¼Œé©¬ä¸Šå°±å¤„ç†äº†ï¼Œç¨‹åºå¼‚å¸¸ç»ˆæ­¢</strong></p><p>è¿™é‡Œè¾“å‡ºä¸€ä¸ªç©ºè¡Œæ˜¯å› ä¸ºç¬¬ä¸€ï¼Œå­—ç¬¦ä¸²æˆ‘è¾“å‡ºäº†æ¢è¡Œï¼Œç¬¬äºŒï¼ŒSIGINTä¿¡å·å’ŒSIGQUITä¿¡å·æ‰§è¡Œåéƒ½ä¼šè¾“å‡ºç©ºè¡Œï¼Œè¿™é‡Œæ˜¯æ‰§è¡Œäº†SIGINTä¿¡å·</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230724155507574.png" alt="image-20230724155507574"></p><p>è¡¥å……ï¼šå°†ç¨‹åºæŒ‚åˆ°åå°æ‰§è¡Œï¼ŒåŠ ä¸Š &amp; ç¬¦å·</p><figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./a.out &amp;</span><br></pre></td></tr></table></div></figure><p>ç¨‹åºåˆ°åå°è¿è¡Œï¼Œæ‰€ä»¥æˆ‘ ctrl+c æ²¡æœ‰ç”¨ï¼Œå¹¶ä¸”æˆ‘å¯ä»¥æ‰§è¡Œæˆ‘è‡ªå·±çš„å‘½ä»¤ï¼Œå›¾ä¸­å°±æ‰§è¡Œäº†lså’Œkill -9</p><p>å¹¶ä¸”ç”±äºè¿™ä¸ªè¿›ç¨‹çš„è¾“å‡ºæ˜¯é»˜è®¤å®šå‘åˆ°ç»ˆç«¯çš„ï¼Œæ‰€ä»¥ç»ˆç«¯ä¼šè¾“å‡º</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230724160250340.png" alt="image-20230724160250340"></p><p>åˆ‡æ¢åˆ°å‰å°</p><figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fg</span><br></pre></td></tr></table></div></figure><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230724160542261.png" alt="image-20230724160542261"></p><h4 id="ç»­ä¿¡å·æ•æ‰å‡½æ•°sigaction"><a href="#ç»­ä¿¡å·æ•æ‰å‡½æ•°sigaction" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç»­ä¿¡å·æ•æ‰å‡½æ•°sigaction"></a> (ç»­ä¿¡å·æ•æ‰å‡½æ•°)sigaction()</h4><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">sigaction</span><span class="params">(<span class="type">int</span> signum,</span></span></span><br><span class="line"><span class="params"><span class="function">                        <span class="type">const</span> <span class="keyword">struct</span> sigaction *_Nullable restrict act,</span></span></span><br><span class="line"><span class="params"><span class="function">                        <span class="keyword">struct</span> sigaction *_Nullable restrict oldact)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šç”¨æ¥æ£€æŸ¥æˆ–è€…æ”¹å˜ä¿¡å·çš„å¤„ç†ï¼Œä¿¡å·æ•æ‰</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">//     signumï¼šéœ€è¦æ•æ‰çš„ä¿¡å·çš„ç¼–å·æˆ–è€…å®å€¼</span></span><br><span class="line"><span class="comment">//     actï¼šæ•æ‰åˆ°ä¿¡å·ä¹‹åç›¸åº”çš„å¤„ç†åŠ¨ä½œ</span></span><br><span class="line"><span class="comment">//     oldactï¼šä¸Šä¸€æ¬¡å¯¹ä¿¡å·æ•æ‰çš„ç›¸å…³çš„è®¾ç½®ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ï¼Œä¼ é€’nullptr</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼š</span></span><br><span class="line"><span class="comment">//     æˆåŠŸ 0</span></span><br><span class="line"><span class="comment">//     å¤±è´¥ -1ï¼Œè®¾ç½®errno</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sigaction</span> &#123;</span><br><span class="line">            <span class="comment">//å‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘çš„å‡½æ•°å°±æ˜¯ä¿¡å·æ•æ‰åˆ°ä¹‹åçš„å¤„ç†å‡½æ•°</span></span><br><span class="line">            <span class="built_in">void</span>     (*sa_handler)(<span class="type">int</span>);</span><br><span class="line">            <span class="comment">//å‡½æ•°æŒ‡é’ˆï¼Œä¸€èˆ¬ä¸ä½¿ç”¨</span></span><br><span class="line">            <span class="built_in">void</span>     (*sa_sigaction)(<span class="type">int</span>, <span class="type">siginfo_t</span> *, <span class="type">void</span> *);</span><br><span class="line">            <span class="comment">//ä¸´æ—¶é˜»å¡ä¿¡å·é›†ï¼Œåœ¨ä¿¡å·æ•æ‰å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šä¸´æ—¶é˜»å¡æŸäº›ä¿¡å·ï¼Œæ‰§è¡Œå®Œä¹‹åæ¢å¤</span></span><br><span class="line">            <span class="type">sigset_t</span>   sa_mask;</span><br><span class="line">            <span class="comment">//æŒ‡å®šæ˜¯ç”¨ç¬¬ä¸€ä¸ªå›è°ƒå¤„ç†sa_handlerè¿˜æ˜¯ç¬¬äºŒä¸ªsa_sigactionï¼Œ0è¡¨ç¤ºç¬¬ä¸€ä¸ªï¼ŒSA_SIGINFOè¡¨ç¤ºç¬¬äºŒä¸ªï¼Œè¿˜æœ‰å…¶ä»–çš„å€¼ï¼Œä½†æ˜¯ç”¨çš„å°‘</span></span><br><span class="line">            <span class="type">int</span>        sa_flags;</span><br><span class="line">            <span class="comment">//è¢«åºŸå¼ƒæ‰äº†ï¼Œä¸éœ€è¦ç”¨ï¼Œä¼ å…¥nullptr</span></span><br><span class="line">            <span class="built_in">void</span>     (*sa_restorer)(<span class="type">void</span>);</span><br><span class="line">	&#125;;</span><br></pre></td></tr></table></div></figure><p>ä»£ç ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">myalarm</span><span class="params">(<span class="type">int</span> num)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;æ•æ‰åˆ°äº†ä¿¡å·çš„ç¼–å·æ˜¯: %d\n&quot;</span>, num);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sigaction</span> act;</span><br><span class="line">    act.sa_flags = <span class="number">0</span>;</span><br><span class="line">    act.sa_handler = myalarm;</span><br><span class="line">    <span class="built_in">sigemptyset</span>(&amp;act.sa_mask);  <span class="comment">// æ¸…ç©ºå§ï¼Œè¡¨ç¤ºä¸è¦ä¸´æ—¶é˜»å¡ä»»ä½•ä¿¡å·</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">sigaction</span>(SIGALRM, &amp;act, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;signal&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿‡ä¸‰ç§’ï¼Œä¼šå‘é€ä¿¡å·</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">timeval</span> _value;</span><br><span class="line">    _value.tv_sec = <span class="number">3</span>;</span><br><span class="line">    _value.tv_usec = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¯éš”ä¸¤ç§’ï¼Œä¼šå‘é€ä¿¡å·</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">timeval</span> _interavl;</span><br><span class="line">    _interavl.tv_sec = <span class="number">2</span>;</span><br><span class="line">    _interavl.tv_usec = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// itimervalç»“æ„ä½“</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">itimerval</span> new_value;</span><br><span class="line">    new_value.it_value = _value;</span><br><span class="line">    new_value.it_interval = _interavl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®å®šæ—¶å™¨</span></span><br><span class="line">    <span class="type">int</span> rets = <span class="built_in">setitimer</span>(ITIMER_REAL, &amp;new_value, <span class="literal">nullptr</span>);  <span class="comment">// éé˜»å¡</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;å®šæ—¶å™¨å¼€å§‹äº†\n&quot;</span>);                                <span class="comment">// ç«‹åˆ»æ‰§è¡Œï¼Œè¡¨æ˜æ˜¯éé˜»å¡çš„</span></span><br><span class="line">    <span class="keyword">if</span> (rets == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;setitimer&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ‰§è¡Œç»“æœå’Œsignal.cppæ˜¯ä¸€æ ·çš„ï¼Œå»¶è¿Ÿä¸‰ç§’åå¼€å§‹å®šæ—¶å™¨å‘é€ä¿¡å·ï¼Œç„¶åæ¯éš”ä¸¤ç§’å‘é€ä¿¡å·</p><h5 id="æ¯”è¾ƒäºŒè€…"><a href="#æ¯”è¾ƒäºŒè€…" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ¯”è¾ƒäºŒè€…"></a> æ¯”è¾ƒäºŒè€…</h5><p><strong>å»ºè®®ä½¿ç”¨ sigaction()</strong></p><ul><li><strong>signal()æ˜¯ANSI C signal handlingï¼Œæ˜¯ç¾å›½é‚£è¾¹çš„æ ‡å‡†ï¼Œå¯¹å…¶ä»–çš„æ ‡å‡†ä¾‹å¦‚POSIXå¯èƒ½ä¸åŒ¹é…ï¼Œæ‰€ä»¥æœ‰ä¸€å®šå±€é™æ€§</strong></li><li><strong>sigaction()æ˜¯æ ‡å‡†çš„ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯æ”¹è¿›è¿‡çš„å‡½æ•°ï¼ŒåŸºæœ¬éƒ½èƒ½é€‚é…æ ‡å‡†ï¼Œå¹¶ä¸”åŠŸèƒ½æ›´å¤š</strong></li></ul><h5 id="æ›´å¥½ç†è§£ä¿¡å·æ•æ‰"><a href="#æ›´å¥½ç†è§£ä¿¡å·æ•æ‰" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ›´å¥½ç†è§£ä¿¡å·æ•æ‰"></a> æ›´å¥½ç†è§£ä¿¡å·æ•æ‰</h5><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230724170811186.png" alt="image-20230724170811186"></p><p>è¦æ³¨æ„å‡ ç‚¹ï¼š</p><ul><li><strong>åœ¨sigaction()ä¸­ï¼Œå¤„ç†ä¿¡å·çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯æˆ‘ä»¬ä¼ é€’è¿›å»çš„ä¸´æ—¶é˜»å¡ä¿¡å·é›†ï¼Œå½“å¤„ç†ç»“æŸä¹‹åä¼šå›åˆ°PCBå½“ä¸­çš„é˜»å¡ä¿¡å·é›†</strong></li><li><strong>ä¿¡å·å‘å‡ºä¹‹åä¸ä¼šç«‹å³å¤„ç†ï¼Œå…ˆè¿›å…¥æœªå†³ä¿¡å·é›†ï¼Œå˜ä¸º1ï¼Œç„¶åå»æ‰¾å¯¹åº”çš„é˜»å¡ä¿¡å·é›†ï¼Œä¸é˜»å¡åˆ™å¤„ç†ï¼Œå¹¶ä¸”ä¿®æ”¹æœªå†³ä¿¡å·é›†ç›¸åº”ä¸º0ï¼Œå½“ä¿¡å·åœ¨å¤„ç†è¿‡ç¨‹å½“ä¸­å¦‚æœæœªå¤„ç†å®Œæ¯•è¿™æ—¶å€™æ”¶åˆ°ä¸€ä¸ªå¯¹åº”çš„æ–°çš„ä¿¡å·ï¼Œä¸ä¼šå¤„ç†ï¼Œè€Œæ˜¯å…ˆå¡«å…¥æœªå†³ä¿¡å·é›†ï¼Œç„¶åç­‰å¾…å¤„ç†ç»“æŸç„¶åå¤„ç†</strong></li><li><strong>å¦‚æœæŸ¥æ‰¾é˜»å¡ä¿¡å·é›†å‘ç°é˜»å¡ï¼Œåˆ™é˜»å¡ç­‰å¾…ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœæ”¶åˆ°æ–°çš„ä¿¡å·ï¼Œç”±äºæœªå†³ä¿¡å·é›†ç›¸åº”ä½ç½®éƒ½è¿˜æ˜¯1ï¼Œé‚£ä¹ˆè¡¨ç¤ºä¿¡å·å°šæœªè¢«å¤„ç†ï¼Œæ–°æ¥çš„ä¿¡å·ä¼šè¢«å¿½ç•¥ï¼Œå½“ç„¶ä¹Ÿä¸å¯èƒ½è®°å½•æ¥äº†å‡ ä¸ªï¼Œåˆ°æ—¶å€™ä¸€èµ·å¤„ç†è¿™ç§ï¼Œå› ä¸ºåªèƒ½å­˜0 1ï¼Œè¿™ä¹Ÿæ˜¯å¿½ç•¥çš„åŸå› </strong></li></ul><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230724172117665.png" alt="image-20230724172117665"></p><h4 id="sigchldä¿¡å·"><a href="#sigchldä¿¡å·" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#sigchldä¿¡å·"></a> SIGCHLDä¿¡å·</h4><p><strong>é¡¾åæ€ä¹‰ï¼Œè¿™æ˜¯å­è¿›ç¨‹ç»™çˆ¶è¿›ç¨‹å‘é€çš„ä¿¡å·</strong></p><p><strong>äº§ç”Ÿçš„ä¸‰ç§æ¡ä»¶ï¼š</strong></p><ul><li><strong>å­è¿›ç¨‹ç»ˆæ­¢</strong></li><li><strong>å­è¿›ç¨‹æ”¶åˆ°SIGSTOPä¿¡å·åœæ­¢</strong></li><li><strong>å­è¿›ç¨‹å¤„åœ¨åœæ­¢æ€ï¼Œæ”¶åˆ°SIGCONTå”¤é†’</strong></li></ul><p><strong>çˆ¶è¿›ç¨‹æ¥æ”¶åˆ°è¿™ä¸ªä¿¡å·ä¹‹åï¼Œé»˜è®¤å¤„ç†æ˜¯å¿½ç•¥è¿™ä¸ªä¿¡å·</strong></p><p><strong>å¦‚æœæˆ‘ä»¬èƒ½æ¥å—è¿™ä¸ªä¿¡å·ï¼Œç„¶åå»å›æ”¶å­è¿›ç¨‹çš„èµ„æºï¼Œå› ä¸ºwait()å‡½æ•°æ˜¯é˜»å¡çš„ï¼Œçˆ¶è¿›ç¨‹ä¸å¯èƒ½ä¸€ç›´ç­‰å¾…å­è¿›ç¨‹ç­‰å¾…ç»“æŸç„¶åå›æ”¶ï¼Œé‚£ä¹ˆå¯ä»¥æ•æ‰å­è¿›ç¨‹ç»“æŸæ—¶å€™(å½“ç„¶è¿˜æœ‰å…¶ä»–ä¸¤ç§æƒ…å†µ)å‘å‡ºçš„SIGCHLDä¿¡å·ï¼Œç„¶åçˆ¶è¿›ç¨‹ä¸­æ–­å»å¤„ç†è¿™ä¸ªäº‹æƒ…ï¼Œå›æ”¶å­è¿›ç¨‹ï¼Œè¿™æ ·å°±å¾ˆå¥½çš„é¿å…äº†åƒµå°¸è¿›ç¨‹çš„é—®é¢˜</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230724173035421.png" alt="image-20230724173035421"></p><p>ä»£ç ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    SIGCHLDä¿¡å·äº§ç”Ÿçš„ä¸‰ä¸ªæ¡ä»¶</span></span><br><span class="line"><span class="comment">    - å­è¿›ç¨‹ç»“æŸ</span></span><br><span class="line"><span class="comment">    - å­è¿›ç¨‹æš‚åœ</span></span><br><span class="line"><span class="comment">    - å­è¿›ç¨‹ä»æš‚åœçŠ¶æ€ç»§ç»­è¿è¡Œ</span></span><br><span class="line"><span class="comment">    éƒ½ä¼šç»™çˆ¶è¿›ç¨‹å‘é€è¯¥ä¿¡å·ï¼Œçˆ¶è¿›ç¨‹é»˜è®¤å¿½ç•¥è¯¥ä¿¡å·</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    å¯ä»¥ä½¿ç”¨SIGCHLDä¿¡å·è§£å†³åƒµå°¸è¿›ç¨‹çš„é—®é¢˜</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">myFunc</span><span class="params">(<span class="type">int</span> num)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;æ•æ‰åˆ°çš„ä¿¡å· : %d\n&quot;</span>, num);</span><br><span class="line">    <span class="comment">// å›æ”¶å­è¿›ç¨‹PCBçš„èµ„æº</span></span><br><span class="line">    <span class="comment">// wait(nullptr);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">int</span> ret = <span class="built_in">waitpid</span>(<span class="number">-1</span>, <span class="literal">nullptr</span>, WNOHANG);</span><br><span class="line">        <span class="keyword">if</span> (ret &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;chile die , pid = %d\n&quot;</span>, <span class="built_in">getpid</span>());</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == ret)</span><br><span class="line">            <span class="comment">// è¯´æ˜è¿˜æœ‰å­è¿›ç¨‹ï¼Œè¿™ä¸€æ¬¡çš„å¾ªç¯æ•æ‰å›æ”¶æ²¡å›æ”¶å®Œæ¯•</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">-1</span> == ret)</span><br><span class="line">            <span class="comment">// è¯´æ˜æ²¡æœ‰å­è¿›ç¨‹äº†</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºå­è¿›ç¨‹</span></span><br><span class="line">    <span class="type">pid_t</span> pid;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; ++i) &#123;</span><br><span class="line">        pid = fork();</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> == pid)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// çˆ¶è¿›ç¨‹</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æå‰è®¾ç½®å¥½é˜»å¡ä¿¡å·é›†ï¼Œé˜»å¡SIGCHLDï¼Œå› ä¸ºå­è¿›ç¨‹å¯èƒ½å¾ˆå¿«ç»“æŸï¼Œçˆ¶è¿›ç¨‹è¿˜æ²¡æ³¨å†Œå¥½</span></span><br><span class="line">        <span class="type">sigset_t</span> set;</span><br><span class="line">        <span class="built_in">sigemptyset</span>(&amp;set);</span><br><span class="line">        <span class="built_in">sigaddset</span>(&amp;set, SIGCHLD);</span><br><span class="line">        <span class="built_in">sigprocmask</span>(SIG_BLOCK, &amp;set, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ•æ‰å­è¿›ç¨‹æ­»äº¡æ—¶å‘é€çš„SIGCHLDä¿¡å·</span></span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">sigaction</span> act;</span><br><span class="line">        act.sa_flags = <span class="number">0</span>;</span><br><span class="line">        act.sa_handler = myFunc;</span><br><span class="line">        <span class="built_in">sigemptyset</span>(&amp;act.sa_mask);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">sigaction</span>(SIGCHLD, &amp;act, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ³¨å†Œå®Œä¿¡å·æ•æ‰ä¹‹åè§£é™¤é˜»å¡</span></span><br><span class="line">        <span class="built_in">sigprocmask</span>(SIG_UNBLOCK, &amp;set, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;parent process pid : %d\n&quot;</span>, <span class="built_in">getpid</span>());</span><br><span class="line">            <span class="built_in">sleep</span>(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// å­è¿›ç¨‹</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;child process pid : %d\n&quot;</span>, <span class="built_in">getpid</span>());</span><br><span class="line">        <span class="comment">// sleep(1);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p><strong>ç”±äºæˆ‘ä»¬å¯¹å­è¿›ç¨‹çš„è®¾ç½®ï¼Œåœ¨è¿è¡Œä¸­20ä¸ªå­è¿›ç¨‹ç»“æŸçš„æ—¶é—´éå¸¸æ¥è¿‘ï¼Œwaitpid(-1,â€¦)æ˜¯èƒ½è¯†åˆ«æ‰€æœ‰çš„å­è¿›ç¨‹ï¼Œä½†æ˜¯ä¸€æ¬¡åªèƒ½æ¸…ç†ä¸€ä¸ªï¼Œè¿™äº›å­è¿›ç¨‹çš„SIGCHLDä¿¡å·å‘é€åˆ°æœªå†³ä¿¡å·é›†è¿™é‡Œï¼Œå½“ç„¶æœªå†³ä¿¡å·é›†åªèƒ½æ¥å—ä¸€ä¸ªå¹¶ä¸”å¡«å…¥ï¼Œç„¶åäº¤ç»™é˜»å¡ä¿¡å·é›†ï¼Œå…¶ä»–çš„ä¸¢å¼ƒï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦while()å¾ªç¯æ¥é‡Šæ”¾è¿™äº›å‡ ä¹åŒæ—¶ç»“æŸçš„å­è¿›ç¨‹ï¼›ä¹‹æ‰€ä»¥è®¾ç½®éé˜»å¡æ˜¯å› ä¸ºå¯èƒ½ä¸ªåˆ«å­è¿›ç¨‹å› ä¸ºè‡ªå·±çš„åŸå› ï¼Œæ²¡æœ‰å’Œä¸Šé¢çš„åŒ¹é…ï¼Œæ‰€ä»¥æˆ‘ä»¬è®¾ç½®éé˜»å¡ï¼Œé‚£ä¸ªæ—¶å€™è¿™ä¸ªè¿›ç¨‹å®Œäº†å‘é€ä¿¡å·ç„¶åçˆ¶è¿›ç¨‹å»å¤„ç†ï¼Œè¿™ä¸ªæ—¶å€™çš„æœªå†³ä¿¡å·é›†è‚¯å®šæ˜¯å†™å…¥(0)çš„ï¼Œå› ä¸ºå¦‚æœä¸å¯ä»¥å†™å…¥ï¼Œé‚£å¿…ç„¶è¿™ä¸ªè¿›ç¨‹å°±æ˜¯å’Œå‰é¢æ˜¯ä¸€æ ·çš„äº†</strong></p><h3 id="å…±äº«å†…å­˜æ•ˆç‡æœ€é«˜"><a href="#å…±äº«å†…å­˜æ•ˆç‡æœ€é«˜" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å…±äº«å†…å­˜æ•ˆç‡æœ€é«˜"></a> å…±äº«å†…å­˜(æ•ˆç‡æœ€é«˜)</h3><h4 id="æ¦‚å¿µ-3"><a href="#æ¦‚å¿µ-3" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ¦‚å¿µ-3"></a> æ¦‚å¿µ</h4><p>å¹¶ä¸æ˜¯å®Œå…¨æ²¡æœ‰å†…æ ¸ä»‹å…¥ï¼Œè€Œæ˜¯ç›¸æ¯”äºå…¶ä»–é€šä¿¡çš„æ“ä½œè¦å°‘å¾—å¤šï¼Œå› ä¸ºæ²¡æœ‰ç»è¿‡å†…æ ¸å’Œç”¨æˆ·ä¹‹é—´çš„åˆ‡æ¢æ“ä½œæˆ–è€…è¯´éå¸¸å°‘ï¼Œçœå»äº†è¿™ä¸€å¤§éƒ¨åˆ†çš„æ—¶é—´ï¼Œå°±æ˜¯å°†æ•°æ®ä»ç”¨æˆ·ç©ºé—´å½“ä¸­æ‹·è´åˆ°å†…æ ¸å½“ä¸­çš„è¿™ä¸€æ®µæ—¶é—´ï¼Œæ‰€ä»¥ä»–çš„æ•ˆç‡æ˜¯æœ€é«˜çš„</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230724204226816.png" alt="image-20230724204226816"></p><h4 id="ä½¿ç”¨æ­¥éª¤"><a href="#ä½¿ç”¨æ­¥éª¤" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä½¿ç”¨æ­¥éª¤"></a> ä½¿ç”¨æ­¥éª¤</h4><p>åˆ›å»ºå…±äº«å†…å­˜ï¼Œè¿æ¥å…±äº«å†…å­˜ï¼›åˆ†ç¦»ï¼Œåˆ é™¤</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725090718804.png" alt="image-20230725090718804"></p><h4 id="ç›¸å…³å‡½æ•°-4"><a href="#ç›¸å…³å‡½æ•°-4" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç›¸å…³å‡½æ•°-4"></a> ç›¸å…³å‡½æ•°</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725091618011.png" alt="image-20230725091618011"></p><p>è®°å¾—æŸ¥manæ–‡æ¡£ï¼Œå¤ªå¤šå¤ªæ‚äº†!!!</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">	<span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/shm.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">shmget</span><span class="params">(<span class="type">key_t</span> key, <span class="type">size_t</span> size, <span class="type">int</span> shmflg)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å…±äº«å†…å­˜æ®µæˆ–è€…è·å–ä¸€ä¸ªæ—¢æœ‰çš„å…±äº«å†…å­˜æ®µçš„æ ‡è¯†</span></span><br><span class="line"><span class="comment">//     æ–°åˆ›å»ºçš„å†…å­˜æ®µä¸­çš„æ•°æ®éƒ½ä¼šè¢«åˆå§‹åŒ–ä¸º0</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">//     keyï¼škey_tç±»å‹ï¼Œæ˜¯ä¸€ä¸ªæ•´å½¢ï¼Œé€šè¿‡è¿™ä¸ªæ‰¾åˆ°æˆ–è€…åˆ›å»ºä¸€ä¸ªå…±äº«å†…å­˜</span></span><br><span class="line"><span class="comment">//         ä¸€èˆ¬ç”¨16è¿›åˆ¶è¡¨ç¤ºï¼Œå¹¶ä¸”æ˜¯é0å€¼ï¼Œåˆ›å»ºçš„æ—¶å€™å¯ä»¥éšä¾¿ç»™ï¼Œç»™ä¸€ä¸ª16è¿›åˆ¶çš„æ•°æˆ–è€…10è¿›åˆ¶(ä¼šè½¬åŒ–)ï¼Œæ‰¾åˆ°çš„æ—¶å€™æŒ‰ç…§åˆ›å»ºæ—¶å€™åŒ¹é…å°±è¡Œ</span></span><br><span class="line"><span class="comment">//     sizeï¼šsize_tç±»å‹ï¼Œå…±äº«å†…å­˜çš„å¤§å°ï¼Œä¼šè‡ªåŠ¨è°ƒæ•´ä¸ºåˆ†é¡µè¾¹ç•Œçš„æ•´æ•°å€(å’Œå†…å­˜æ˜ å°„æ˜¯ä¸€æ ·çš„)</span></span><br><span class="line"><span class="comment">//     shmflgï¼š</span></span><br><span class="line"><span class="comment">//         å…±äº«å†…å­˜çš„å±æ€§ï¼šç”¨æŒ‰ä½æˆ–è¿æ¥</span></span><br><span class="line"><span class="comment">//             - è®¿é—®æƒé™</span></span><br><span class="line"><span class="comment">//             - é™„åŠ å±æ€§(åˆ›å»ºå…±äº«å†…å­˜ï¼Œåˆ¤æ–­å…±äº«å†…å­˜æ˜¯å¦å­˜åœ¨ï¼Œè·å–å…±äº«å†…å­˜)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//                 åˆ›å»ºï¼šIPC_CREAT åŠ ä¸Š è®¿é—®æƒé™(æ¯”å¦‚0664)</span></span><br><span class="line"><span class="comment">//                 è·å–ï¼šIPC_CREAT(ä¸åŠ è®¿é—®æƒé™)</span></span><br><span class="line"><span class="comment">//                 åˆ¤æ–­ï¼šIPC_EXCLï¼Œéœ€è¦å’ŒIPC_CREATä¸€èµ·ä½¿ç”¨ï¼Œç”¨æŒ‰ä½æˆ–è¿æ¥</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼š</span></span><br><span class="line"><span class="comment">//     æˆåŠŸ &gt;0 è¿”å›å…±äº«å†…å­˜å¼•ç”¨çš„IDï¼Œåé¢æ“ä½œå…±äº«å†…å­˜ä½¿ç”¨è¿™ä¸ªæ ‡è¯†</span></span><br><span class="line"><span class="comment">//     å¤±è´¥ -1.ä¿®æ”¹errno</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> *<span class="title">shmat</span><span class="params">(<span class="type">int</span> shmid, <span class="type">const</span> <span class="type">void</span> *_Nullable shmaddr, <span class="type">int</span> shmflg)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šå’Œå½“å‰çš„è¿›ç¨‹è¿›è¡Œå…³è”</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">//     shmidï¼šå…±äº«å†…å­˜çš„æ ‡è¯†ï¼ŒIDï¼Œç”±shmget()è¿”å›å€¼è·å–</span></span><br><span class="line"><span class="comment">//     shmaddrï¼šç”³è¯·çš„å…±äº«å†…å­˜çš„èµ·å§‹åœ°å€ï¼ŒæŒ‡å®šä¸ºnullptrï¼Œè®©ç³»ç»Ÿå¸®æˆ‘ä»¬å»åˆ†é…</span></span><br><span class="line"><span class="comment">//     shmflgï¼š</span></span><br><span class="line"><span class="comment">//         å¯¹å…±äº«å†…å­˜çš„æ“ä½œ</span></span><br><span class="line"><span class="comment">//             - è¯»ï¼šSHM_RDONLYï¼Œè€Œä¸”å¿…é¡»è¦æœ‰è¯»æƒé™</span></span><br><span class="line"><span class="comment">//             - è¯»å†™ï¼š0ï¼Œæˆ‘ä»¬æŒ‡å®šä»€ä¹ˆéƒ½ä¸ç»™ï¼Œä½†æ˜¯ç”±äºå¿…é¡»æœ‰è¯»æƒé™ï¼Œç³»ç»Ÿä¼šç»™æˆ‘ä»¬åŠ ä¸Šè¯»å†™çš„æƒé™</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼š</span></span><br><span class="line"><span class="comment">//     æˆåŠŸ è¿”å›å…±äº«å†…å­˜çš„èµ·å§‹åœ°å€</span></span><br><span class="line"><span class="comment">//     å¤±è´¥ (void*)-1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">shmdt</span><span class="params">(<span class="type">const</span> <span class="type">void</span> *shmaddr)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šè§£é™¤å½“å‰è¿›ç¨‹å’Œå…±äº«å†…å­˜çš„å…³è”</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">//     shmaddrï¼šå…±äº«å†…å­˜çš„é¦–åœ°å€</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼š</span></span><br><span class="line"><span class="comment">//     æˆåŠŸ 0</span></span><br><span class="line"><span class="comment">//     å¤±è´¥ -1ï¼Œä¿®æ”¹errno</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">shmctl</span><span class="params">(<span class="type">int</span> shmid, <span class="type">int</span> cmd, <span class="keyword">struct</span> shmid_ds *buf)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šå¯¹å…±äº«å†…å­˜è¿›è¡Œæ“ä½œï¼Œæ¯”å¦‚å¯ä»¥åˆ é™¤ï¼Œå…±äº«å†…å­˜è¦åˆ é™¤æ‰ä¼šæ¶ˆå¤±ï¼›åˆ›å»ºå…±äº«å†…å­˜çš„è¿›ç¨‹è¢«é”€æ¯äº†å¯¹è¿™å—å…±äº«å†…å­˜æ²¡æœ‰ä»»ä½•å½±å“ï¼Œå¿…é¡»è¦æ‰‹åŠ¨åˆ é™¤æ‰è¡Œ</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">//     shmidï¼šå…±äº«å†…å­˜çš„id</span></span><br><span class="line"><span class="comment">//     cmdï¼šè¦åšçš„æ“ä½œ</span></span><br><span class="line"><span class="comment">//         IPC_STATï¼šè·å–å…±äº«å†…å­˜å½“å‰çš„çŠ¶æ€</span></span><br><span class="line"><span class="comment">//         IPC_SETï¼šè®¾ç½®å…±äº«å†…å­˜çš„çŠ¶æ€</span></span><br><span class="line"><span class="comment">//         IPC_RMIDï¼šæ ‡è®°å…±äº«å†…å­˜è¢«é”€æ¯ï¼Œä¹‹æ‰€ä»¥æ˜¯æ ‡è®°æ˜¯å› ä¸ºæœ‰å¾ˆå¤šä¸ªè¿›ç¨‹éƒ½è¿æ¥äº†è¿™ä¸ªå…±äº«å†…å­˜ï¼Œæˆ‘è¿™ä¸€ä¸ªè¿›ç¨‹å¹¶ä¸èƒ½æƒ³åˆ é™¤å°±åˆ é™¤ï¼Œè€Œåªæ˜¯æ ‡è®°ä¸‹æ¥ï¼Œå½“æ£€æµ‹åˆ°è¿æ¥æ•°ä¸º0æ—¶ï¼Œç³»ç»Ÿè‡ªä¼šå°†è¿™å—å…±äº«å†…å­˜åˆ é™¤</span></span><br><span class="line"><span class="comment">//     bufï¼šéœ€è¦è®¾ç½®æˆ–è€…è·å–çš„å…±äº«å†…å­˜çš„å±æ€§ä¿¡æ¯</span></span><br><span class="line"><span class="comment">//         IPC_STATï¼šbufå­˜å‚¨æ•°æ®</span></span><br><span class="line"><span class="comment">//         IPC_SETï¼šbufä¸­éœ€è¦åˆå§‹åŒ–æ•°æ®ï¼Œè®¾ç½®åˆ°å†…æ ¸ä¸­</span></span><br><span class="line"><span class="comment">//         IPC_RMIDï¼šæ²¡æœ‰ç”¨ï¼Œä¼ é€’nullptrå³å¯</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/ipc.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">key_t</span> <span class="title">ftok</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *pathname, <span class="type">int</span> proj_id)</span></span>;</span><br><span class="line"><span class="comment">//ä½œç”¨ï¼šæ ¹æ®æŒ‡å®šçš„è·¯å¾„åå’Œintå€¼ï¼Œç”Ÿæˆä¸€ä¸ªå…±äº«å†…å­˜çš„keyï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç”¨è‡ªå·±æŒ‡å®š</span></span><br><span class="line"><span class="comment">//å‚æ•°ï¼š</span></span><br><span class="line">    <span class="comment">//pathnameï¼šæŒ‡å®šä¸€ä¸ªå­˜åœ¨çš„è·¯å¾„</span></span><br><span class="line">    <span class="comment">//proj_idï¼šintç±»å‹çš„å€¼ï¼Œä½†æ˜¯è¿™ç³»ç»Ÿè°ƒç”¨åªä¼šä½¿ç”¨å…¶ä¸­çš„ä¸€ä¸ªå­—èŠ‚(8ä½)</span></span><br><span class="line">        <span class="comment">//è¿”å›ï¼š0-255ï¼Œä¸€èˆ¬æŒ‡å®šä¸€ä¸ªå­—ç¬¦ &#x27;a&#x27;</span></span><br></pre></td></tr></table></div></figure><h4 id="ç¤ºä¾‹-2"><a href="#ç¤ºä¾‹-2" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¤ºä¾‹-2"></a> ç¤ºä¾‹</h4><p>å†™ä¸¤ä¸ªç¨‹åºè¿›è¡Œé€šä¿¡</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//write.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/ipc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/shm.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _size 1024</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºå…±äº«å†…å­˜</span></span><br><span class="line">    <span class="type">int</span> shmid = <span class="built_in">shmget</span>(<span class="number">100</span>, <span class="number">4096</span>, <span class="number">0664</span> | IPC_CREAT);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == shmid) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;shmget&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;shmid : %d\n&quot;</span>, shmid);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å’Œå½“å‰è¿›ç¨‹è¿›è¡Œå…³è”</span></span><br><span class="line">    <span class="type">void</span> *ptr = <span class="built_in">shmat</span>(shmid, <span class="literal">nullptr</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> ((<span class="type">void</span> *)<span class="number">-1</span> == ptr) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;shmat&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> str[_size] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;è¯·è¾“å…¥å†™å…¥çš„å­—ç¬¦ä¸²: &quot;</span>);</span><br><span class="line">    <span class="built_in">fgets</span>(str, <span class="built_in">sizeof</span>(str), stdin);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†™æ•°æ®</span></span><br><span class="line">    <span class="built_in">memcpy</span>(ptr, str, <span class="built_in">strlen</span>(str) + <span class="number">1</span>);  <span class="comment">// ä¸ºäº†ä¿é™©ï¼Œæ‹·ä¸Šå­—ç¬¦ä¸²ç»“æŸç¬¦</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;æŒ‰ä»»æ„é”®ç»§ç»­\n&quot;</span>);</span><br><span class="line">    <span class="built_in">getchar</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£é™¤å…³è”</span></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">shmdt</span>(ptr);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;shmdt&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ é™¤å…±äº«å†…å­˜</span></span><br><span class="line">    <span class="built_in">shmctl</span>(shmid, IPC_RMID, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//read.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/ipc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/shm.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è·å¾—å…±äº«å†…å­˜çš„æ ‡è¯†ï¼Œæˆ‘ä»¬æ˜¯ç”¨keyæ ‡è¯†çš„</span></span><br><span class="line">    <span class="type">int</span> shmid = <span class="built_in">shmget</span>(<span class="number">100</span>, <span class="number">4096</span>, IPC_CREAT);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == shmid) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;shmget&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;shmid : %d\n&quot;</span>, shmid);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»‘å®šè¿æ¥</span></span><br><span class="line">    <span class="type">void</span>* ptr = <span class="built_in">shmat</span>(shmid, <span class="literal">nullptr</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> ((<span class="type">void</span>*)<span class="number">-1</span> == ptr) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;shmat&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯»æ•°æ®</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;data : %s&quot;</span>, (<span class="type">char</span>*)ptr);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;æŒ‰ä»»æ„é”®ç»§ç»­\n&quot;</span>);</span><br><span class="line">    <span class="built_in">getchar</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­å…³è”</span></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">shmdt</span>(ptr);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;shmdt&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ‡è®°åˆ é™¤</span></span><br><span class="line">    <span class="built_in">shmctl</span>(shmid, IPC_RMID, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ‰§è¡Œç»“æœï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725102001298.png" alt="image-20230725102001298"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725102008328.png" alt="image-20230725102008328"></p><h4 id="å…±äº«å†…å­˜æ“ä½œå‘½ä»¤"><a href="#å…±äº«å†…å­˜æ“ä½œå‘½ä»¤" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å…±äº«å†…å­˜æ“ä½œå‘½ä»¤"></a> å…±äº«å†…å­˜æ“ä½œå‘½ä»¤</h4><p><strong>æ³¨æ„ï¼Œshmctl()æ‰§è¡Œçš„åˆ é™¤åªæ˜¯æ ‡è®°åˆ é™¤æ“ä½œï¼Œæ‰§è¡Œåˆ°è¿™ä¸€æ­¥åï¼Œè¿™ä¸ªå…±äº«å†…å­˜çš„keyä¿®æ”¹ä¸º0ï¼Œç„¶åä¸å†æ¥å—è¿æ¥ï¼Œå…¶ä»–ç¨‹åºå†æ¬¡æ‰§è¡Œshmctl()æ ‡è®°åˆ é™¤ç›¸å½“äºä»€ä¹ˆä¹Ÿæ²¡åšï¼Œä½†æ˜¯å¯ä»¥æ‰§è¡Œä¸ä¼šæŠ¥é”™ï¼Œç³»ç»Ÿå°±ç›‘å¬å…¶ä»–è¿›ç¨‹å¯¹è¿™ä¸ªå…±äº«å†…å­˜çš„è§£é™¤è¿æ¥æ“ä½œï¼Œç„¶åç»´æŠ¤shm_nattachï¼Œè®°å½•å…³è”æ•°ï¼Œå½“ç¨‹åºæ‰§è¡Œshmdt()æ‰‹åŠ¨è§£é™¤æˆ–è€…ç¨‹åºç»“æŸçš„æ—¶å€™ç³»ç»Ÿè‡ªåŠ¨è§£é™¤è¿æ¥ï¼Œå½“è¿æ¥æ•°ä¸º0ä¹‹åç³»ç»Ÿå°±åˆ é™¤è¿™å—å…±äº«å†…å­˜ã€‚ä¹‹æ‰€ä»¥æ ‡è®°åˆ é™¤ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢åˆ é™¤åè¿˜æœ‰å…¶ä»–è¿›ç¨‹åœ¨ä½¿ç”¨è¿™å—å†…å­˜é€ æˆä¸å¿…è¦çš„å±é™©</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725104726840.png" alt="image-20230725104726840"></p><h4 id="æ³¨æ„-2"><a href="#æ³¨æ„-2" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ³¨æ„-2"></a> æ³¨æ„</h4><p><strong>é—®é¢˜1ï¼šæ“ä½œç³»ç»Ÿå¦‚ä½•çŸ¥é“ä¸€å—å…±äº«å†…å­˜è¢«å¤šå°‘ä¸ªè¿›ç¨‹å…³è”ï¼Ÿ</strong></p><ul><li>å…±äº«å†…å­˜ç»´æŠ¤äº†ä¸€ä¸ªç»“æ„ä½“ struct shmid_ds è¿™ä¸ªç»“æ„ä½“ä¸­æœ‰ä¸€ä¸ªæˆå‘˜ shm_nattach</li><li>shm_nattachè®°å½•äº†å…³è”çš„è¿›ç¨‹ä¸ªæ•°</li></ul><p><strong>é—®é¢˜2ï¼šå¯ä»¥ä¸å¯ä»¥å¯¹å…±äº«å†…å­˜å¤šæ¬¡åˆ é™¤ stmctl()</strong></p><ul><li>å¯ä»¥ï¼Œå› ä¸ºshmctl()åªæ˜¯æ ‡è®°åˆ é™¤å…±äº«å†…å­˜ï¼Œä¸æ˜¯ç›´æ¥åˆ é™¤</li><li>ä»€ä¹ˆæ—¶å€™çœŸæ­£åˆ é™¤ï¼Œå½“å’Œå…±äº«å†…å­˜å…³è”çš„è¿›ç¨‹æ•°ä¸º0çš„æ—¶å€™ï¼Œå°±çœŸæ­£è¢«åˆ é™¤</li><li>å½“å…±äº«å†…å­˜çš„keyä¸º0çš„æ—¶å€™ï¼Œè¡¨ç¤ºå…±äº«å†…å­˜è¢«æ ‡è®°åˆ é™¤ï¼Œå¦‚æœè¿›ç¨‹å–æ¶ˆå…³è”å°±ä¸èƒ½ç»§ç»­æ“ä½œè¿™ä¸ªå…±äº«å†…å­˜ï¼Œè¿™ç§æƒ…å†µä¸‹ä¹Ÿä¸èƒ½å†æ¬¡å…³è”</li></ul><p><strong>é—®é¢˜3ï¼šå…±äº«å†…å­˜å’Œå†…å­˜æ˜ å°„çš„åŒºåˆ«</strong></p><ul><li>å…±äº«å†…å­˜å¯ä»¥ç›´æ¥åˆ›å»ºï¼Œå†…å­˜æ˜ å°„éœ€è¦ç£ç›˜æ–‡ä»¶(åŒ¿åæ˜ å°„é™¤å¤–)</li><li>å…±äº«å†…å­˜æ•ˆç‡æ›´é«˜</li><li>å†…å­˜ï¼š<ul><li>å…±äº«å†…å­˜ï¼šæ‰€æœ‰çš„è¿›ç¨‹æ“ä½œçš„æ˜¯åŒä¸€å—å…±äº«å†…å­˜<ul><li>å†…å­˜æ˜ å°„ï¼š(çˆ¶å­è¿›ç¨‹é™¤å¤–)æ¯ä¸ªè¿›ç¨‹åœ¨è‡ªå·±çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­æœ‰ä¸€ä¸ªç‹¬ç«‹çš„å†…å­˜</li></ul></li></ul></li><li>æ•°æ®å®‰å…¨<ul><li>è¿›ç¨‹çªç„¶é€€å‡ºï¼Œå…±äº«å†…å­˜è¿˜å­˜åœ¨ï¼Œå†…å­˜æ˜ å°„æ¶ˆå¤±äº†</li><li>è¿è¡Œè¿›ç¨‹çš„ç”µè„‘æ­»æœºäº†ï¼Œæ•°æ®å­˜å‚¨åœ¨å…±äº«å†…å­˜ä¸­å°±æ²¡æœ‰äº†ï¼Œå†…å­˜æ˜ å°„åŒºçš„æ•°æ®ä¹Ÿæ²¡æœ‰äº†ï¼Œä½†æ˜¯ä»–çš„æ•°æ®å·²ç»åŒæ­¥ç»™ç£ç›˜äº†</li></ul></li><li>ç”Ÿå‘½å‘¨æœŸ<ul><li>å†…å­˜æ˜ å°„åŒºï¼šè¿›ç¨‹é€€å‡ºï¼Œå†…å­˜æ˜ å°„åŒºé”€æ¯</li><li>å…±äº«å†…å­˜ï¼šè¿›ç¨‹é€€å‡ºï¼Œå…±äº«å†…å­˜è¿˜åœ¨ï¼Œæ ‡è®°åˆ é™¤(æ‰€æœ‰å…³è”çš„è¿›ç¨‹æ•°ä¸º0)ï¼Œæˆ–è€…å…³æœº<br>å¦‚æœè¿›ç¨‹é€€å‡ºï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å’Œå…±äº«å†…å­˜å–æ¶ˆå…³è”</li></ul></li></ul><h2 id="å®ˆæŠ¤è¿›ç¨‹"><a href="#å®ˆæŠ¤è¿›ç¨‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å®ˆæŠ¤è¿›ç¨‹"></a> å®ˆæŠ¤è¿›ç¨‹</h2><h3 id="ç»ˆç«¯"><a href="#ç»ˆç«¯" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç»ˆç«¯"></a> ç»ˆç«¯</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725111929961.png" alt="image-20230725111929961"></p><h3 id="è¿›ç¨‹ç»„"><a href="#è¿›ç¨‹ç»„" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è¿›ç¨‹ç»„"></a> è¿›ç¨‹ç»„</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725112626809.png" alt="image-20230725112626809"></p><h3 id="ä¼šè¯"><a href="#ä¼šè¯" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä¼šè¯"></a> ä¼šè¯</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725113205286.png" alt="image-20230725113205286"></p><h3 id="ç†è§£å…³ç³»ä¸¾ä¾‹"><a href="#ç†è§£å…³ç³»ä¸¾ä¾‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç†è§£å…³ç³»ä¸¾ä¾‹"></a> ç†è§£å…³ç³»ä¸¾ä¾‹</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725113517970.png" alt="image-20230725113517970"></p><h3 id="æ“ä½œå‡½æ•°"><a href="#æ“ä½œå‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ“ä½œå‡½æ•°"></a> æ“ä½œå‡½æ•°</h3><p>gidï¼šè¿›ç¨‹ç»„idï¼›sidï¼šä¼šè¯çš„id</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725113838738.png" alt="image-20230725113838738" style="zoom:67%"><h3 id="å®ˆæŠ¤è¿›ç¨‹daemonè¿›ç¨‹ç²¾çµè¿›ç¨‹"><a href="#å®ˆæŠ¤è¿›ç¨‹daemonè¿›ç¨‹ç²¾çµè¿›ç¨‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å®ˆæŠ¤è¿›ç¨‹daemonè¿›ç¨‹ç²¾çµè¿›ç¨‹"></a> å®ˆæŠ¤è¿›ç¨‹(Daemonè¿›ç¨‹ï¼Œç²¾çµè¿›ç¨‹)</h3><p><strong>åå°æœåŠ¡è¿›ç¨‹ï¼Œæ˜¯ä¸€ä¸ªç”Ÿå­˜æœŸè¾ƒé•¿çš„è¿›ç¨‹ï¼Œä¸€èˆ¬é‡‡ç”¨ä»¥dç»“å°¾çš„åå­—</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725114051864.png" alt="image-20230725114051864"></p><h4 id="åˆ›å»ºæ­¥éª¤"><a href="#åˆ›å»ºæ­¥éª¤" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#åˆ›å»ºæ­¥éª¤"></a> åˆ›å»ºæ­¥éª¤(!!!)</h4><p><strong>å¿…é¡»æœ‰çš„æ˜¯çš„æ˜¯å‰ä¸¤æ­¥å’Œæœ€åä¸€æ­¥</strong></p><p><strong>é¦–å…ˆä¸ºä»€ä¹ˆè¦ç”¨å­è¿›ç¨‹æ¥åˆ›å»ºä¼šè¯ï¼Œå› ä¸ºå¦‚æœæ˜¯çˆ¶è¿›ç¨‹åˆ›å»ºä¼šè¯çš„è¯ï¼Œä¸€æ—¦çˆ¶è¿›ç¨‹æ˜¯è¿™ä¸ªè¿›ç¨‹ç»„çš„é¦–è¿›ç¨‹ï¼Œè¿›ç¨‹ç»„å·å°±æ˜¯çˆ¶è¿›ç¨‹çš„idï¼Œç„¶ååˆ›å»ºä¼šè¯ä¹‹åæ–°ä¼šè¯ä¸­åˆ›å»ºå‡ºæ¥çš„è¿›ç¨‹ç»„å·ä¹Ÿç”¨çš„æ˜¯è¿™ä¸ªï¼Œä¸¤ä¸ªä¸åŒä¼šè¯ä¸­å­˜åœ¨åŒä¸€ä¸ªè¿›ç¨‹ç»„å·ï¼Œè¿™ä¸ªæ˜¾ç„¶æ˜¯ä¸å¯ä»¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨å­è¿›ç¨‹åˆ›å»ºï¼Œå°±é¿å…äº†è¿™ä¸ªé—®é¢˜ï¼›ç„¶åçˆ¶è¿›ç¨‹é€€å‡ºä¸€æ˜¯ä¸ºäº†ä¿è¯ä¸å‡ºç°åƒµå°¸è¿›ç¨‹(è¿™æ˜¯å­¤å„¿è¿›ç¨‹æ²¡æœ‰ä»€ä¹ˆå±é™©)ï¼Œè€Œæ˜¯é¿å…å­è¿›ç¨‹è¿è¡Œç€æ—¶å€™çˆ¶è¿›ç¨‹å®Œäº†ç„¶åè¾“å‡ºç»ˆç«¯æç¤ºç¬¦ï¼Œå°±æ˜¯å¦‚ä¸‹(çªç„¶å†’å‡ºæ¥å¾ˆè¯¡å¼‚)</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725150200682.png" alt="image-20230725150200682"></p><p><strong>ç¬¬äºŒï¼Œä¸ºä»€ä¹ˆè¦åˆ›å»ºä¸€ä¸ªæ–°ä¼šè¯ï¼Ÿå› ä¸ºå¦‚æœä¸æ˜¯æ–°åˆ›å»ºè€Œæ˜¯æŒªå…¥å…¶ä»–çš„ä¼šè¯æˆ–è€…å°±ç”¨è‡ªèº«çš„ä¼šè¯ï¼Œé‚£ä¹ˆå¯èƒ½è¿™ä¸ªä¼šè¯ç»‘å®šäº†æ§åˆ¶ç»ˆç«¯ï¼Œèƒ½å¤Ÿæ¥å—ä¿¡å·å¤„ç†ä¿¡å·è¿™äº›ï¼Œè¿™æ˜¾ç„¶ä¸å®ˆæŠ¤è¿›ç¨‹çš„åˆè¡·ä¸ç¬¦ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªæ–°ä¼šè¯ï¼Œæ–°ä¼šè¯é»˜è®¤æ˜¯ä¸ç»‘å®šæ§åˆ¶ç»ˆç«¯çš„ï¼Œä½†æ˜¯ä¸ä»£è¡¨æ²¡æœ‰ç»ˆç«¯ï¼Œè‡³å°‘æ–‡ä»¶æè¿°ç¬¦012ï¼Œæ ‡å‡†è¾“å…¥è¾“å‡ºé”™è¯¯æ˜¯æœ‰çš„ï¼Œè¨€ä¸‹ä¹‹æ„å°±æ˜¯å¯ä»¥å‘å±å¹•ä¸Šè¾“å‡ºæ•°æ®ï¼Œæ‰€ä»¥è¿™å°±æœ‰äº†ä¸‹é¢å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åé‡å®šå‘åˆ° dev/null çš„æ“ä½œï¼Œå½“ç„¶è¿™ä¸€æ­¥ä¹Ÿä¸æ˜¯å¿…é¡»çš„</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725114544913.png" alt="image-20230725114544913"></p><h5 id="ç¤ºä¾‹-3"><a href="#ç¤ºä¾‹-3" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¤ºä¾‹-3"></a> ç¤ºä¾‹</h5><p>å†™ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œç”¨æ¥æ¯ä¸¤ç§’è®°å½•ä¸€æ¬¡å½“å‰çš„æ—¶é—´å¹¶å†™åˆ°æ–‡æœ¬å½“ä¸­</p><p><strong>å°±ä¸¥æ ¼æŒ‰ç…§è¿™å‡ æ­¥æ¥ï¼Œåˆ›å»ºå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹åˆ›å»ºä¼šè¯ï¼Œè®¾ç½®umask(ä¸å¿…è¦)ï¼Œè®¾ç½®å·¥ä½œç›®å½•(ä¸å¿…è¦)ï¼Œå…³é—­ä»çˆ¶è¿›ç¨‹ç»§æ‰¿è€Œæ¥çš„æ–‡ä»¶æè¿°ç¬¦(ä¸å¿…è¦ï¼Œè¿™é‡Œæ²¡æœ‰)ï¼Œé‡å®šå‘æ–‡ä»¶æè¿°ç¬¦(ä¸å¿…è¦ï¼Œè¿™é‡Œæœ‰)ï¼Œæ ¸å¿ƒä¸šåŠ¡é€»è¾‘(è®¾ç½®å®šæ—¶å™¨ï¼Œæ•æ‰ä¿¡å·)</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å†™ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œæ¯éš”ä¸¤ç§’è·å–ç³»ç»Ÿæ—¶é—´ï¼Œå°†è¿™ä¸ªæ—¶é—´å†™åˆ°ç£ç›˜æ–‡ä»¶ä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> _deal(<span class="type">int</span> num) &#123;</span><br><span class="line">    <span class="comment">// è·å–ç³»ç»Ÿæ—¶é—´å†™å…¥ç£ç›˜æ–‡ä»¶</span></span><br><span class="line">    <span class="type">time_t</span> _time = <span class="built_in">time</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="comment">// å°†time()è·å¾—çš„è·ç¦»è®¡ç®—æœºå…ƒå¹´(1970-1-1 00:00:00)çš„ç§’æ•°è½¬åŒ–ä¸ºå½“å‰çš„æ—¶é—´</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">tm</span>* _localtime = <span class="built_in">localtime</span>(&amp;_time);</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* str = <span class="built_in">asctime</span>(_localtime);</span><br><span class="line">    <span class="comment">// å¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œå­˜åœ¨åˆ™è¿½åŠ </span></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">access</span>(<span class="string">&quot;time.txt&quot;</span>, F_OK);</span><br><span class="line">    <span class="type">int</span> fd = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret)</span><br><span class="line">        <span class="comment">// ä¸å­˜åœ¨</span></span><br><span class="line">        fd = <span class="built_in">open</span>(<span class="string">&quot;time.txt&quot;</span>, O_RDWR | O_CREAT, <span class="number">0664</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == ret)</span><br><span class="line">        <span class="comment">// å­˜åœ¨</span></span><br><span class="line">        fd = <span class="built_in">open</span>(<span class="string">&quot;time.txt&quot;</span>, O_RDWR | O_APPEND);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ret = <span class="built_in">write</span>(fd, str, <span class="built_in">strlen</span>(str));</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;write&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºå­è¿›ç¨‹ï¼Œé€€å‡ºçˆ¶è¿›ç¨‹</span></span><br><span class="line">    <span class="type">pid_t</span> pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == pid) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pid &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="comment">// çˆ¶è¿›ç¨‹</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == pid) &#123;</span><br><span class="line">        <span class="comment">// å­è¿›ç¨‹</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœå­˜åœ¨time.txtï¼Œå°†å…¶åˆ é™¤ï¼Œå‡†å¤‡å·¥ä½œ</span></span><br><span class="line">        <span class="type">int</span> ret = <span class="built_in">access</span>(<span class="string">&quot;time.txt&quot;</span>, F_OK);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> == ret)</span><br><span class="line">            <span class="built_in">unlink</span>(<span class="string">&quot;time.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åœ¨å­è¿›ç¨‹ä¸­é‡æ–°åˆ›å»ºä¸€ä¸ªä¼šè¯ï¼Œè„±ç¦»åŸæ¥çš„æ§åˆ¶ç»ˆç«¯</span></span><br><span class="line">        <span class="type">pid_t</span> sid = <span class="built_in">setsid</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">-1</span> == pid) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;setsid&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®umask</span></span><br><span class="line">        <span class="built_in">umask</span>(<span class="number">022</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ›´æ”¹å·¥ä½œç›®å½•</span></span><br><span class="line">        <span class="built_in">chdir</span>(<span class="string">&quot;/mnt/d/Code/Cpp/æ·±å…¥å­¦ä¹ /Linuxæ–¹å‘/ç‰›å®¢ç½‘Linuxç½‘ç»œè¯¾ç¨‹/ç¬¬2ç« -å¤šè¿›ç¨‹å¼€å‘/13&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…³é—­ï¼Œä»¥åŠé‡å®šå‘æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">        <span class="type">int</span> fd = <span class="built_in">open</span>(<span class="string">&quot;/dev/null&quot;</span>, O_RDWR);</span><br><span class="line">        <span class="built_in">dup2</span>(fd, STDIN_FILENO);</span><br><span class="line">        <span class="built_in">dup2</span>(fd, STDOUT_FILENO);</span><br><span class="line">        <span class="built_in">dup2</span>(fd, STDERR_FILENO);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ³¨å†Œä¿¡å·æ•æ‰å™¨</span></span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">sigaction</span> _act;</span><br><span class="line">        _act.sa_flags = <span class="number">0</span>;</span><br><span class="line">        _act.sa_handler = _deal;</span><br><span class="line">        <span class="built_in">sigemptyset</span>(&amp;_act.sa_mask);</span><br><span class="line">        <span class="built_in">sigaction</span>(SIGALRM, &amp;_act, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºå®šæ—¶å™¨</span></span><br><span class="line">        itimerval _new;</span><br><span class="line">        <span class="comment">// å»¶è¿Ÿæ—¶é—´</span></span><br><span class="line">        _new.it_interval.tv_sec = <span class="number">2</span>;</span><br><span class="line">        _new.it_interval.tv_usec = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// å‘¨æœŸæ—¶é—´</span></span><br><span class="line">        _new.it_value.tv_sec = <span class="number">2</span>;</span><br><span class="line">        _new.it_value.tv_usec = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        ret = <span class="built_in">setitimer</span>(ITIMER_REAL, &amp;_new, <span class="literal">nullptr</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;setitimer&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸è®©è¿›ç¨‹ç»“æŸï¼Œä¸ç„¶æ— æ³•è®°å½•</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">            <span class="built_in">sleep</span>(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ‰§è¡Œç»“æœï¼š</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725162229689.png" alt="image-20230725162229689" style="zoom:67%"><p>å¹¶ä¸”ä»æ–‡ä»¶å¤§å°ä¸æ–­å˜åŒ–å¯ä»¥çœ‹å‡ºæ˜¯å®æ—¶æ›´æ–°çš„</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725162327872.png" alt="image-20230725162327872"></p><p>å®ˆæŠ¤è¿›ç¨‹æ²¡æœ‰æ§åˆ¶ç»ˆç«¯ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•æ¥å—æ§åˆ¶ç»ˆç«¯å‘å‡ºçš„ä¿¡å·(ä¾‹å¦‚SIGINT( ctrl+c )å’ŒSIGQUIT( ctrl+\ ) )ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡kill -9 å¼ºåˆ¶æ€æ­»</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725162413359.png" alt="image-20230725162413359"></p><h1 id="ç¬¬ä¸‰ç« -linuxå¤šçº¿ç¨‹å¼€å‘"><a href="#ç¬¬ä¸‰ç« -linuxå¤šçº¿ç¨‹å¼€å‘" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¬¬ä¸‰ç« -linuxå¤šçº¿ç¨‹å¼€å‘"></a> ç¬¬ä¸‰ç«  Linuxå¤šçº¿ç¨‹å¼€å‘</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ¦‚è¿°"></a> æ¦‚è¿°</h2><h3 id="æ¦‚å¿µ-4"><a href="#æ¦‚å¿µ-4" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ¦‚å¿µ-4"></a> æ¦‚å¿µ</h3><p><strong>åŒä¸€ä¸ªç¨‹åºçš„æ‰€æœ‰çº¿ç¨‹å‡ä¼šæ‰§è¡Œç›¸åŒç¨‹åºï¼Œå¹¶ä¸”ä¼šå…±äº«åŒä¸€ä»½å…¨å±€å†…å­˜åŒºåŸŸ</strong></p><p><strong>è¿›ç¨‹æ˜¯èµ„æºæŒæœ‰çš„æœ€å°å•ä½ï¼Œçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿåˆ†é…å’Œè°ƒåº¦çš„æœ€å°å•ä½</strong></p><p><strong>çº¿ç¨‹æ˜¯è½»é‡çº§çš„è¿›ç¨‹(LWP)ï¼Œåœ¨Linuxä¸‹çº¿ç¨‹çš„æœ¬è´¨ä»æ˜¯è¿›ç¨‹</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725162732120.png" alt="image-20230725162732120"></p><p>æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹çš„LWPå·</p><p>ä¾‹å¦‚è¿™é‡Œæ‰“å¼€firefoxè¿›ç¨‹ï¼Œå®ƒçš„å†…éƒ¨æ˜¯å¤šçº¿ç¨‹å®ç°çš„</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725163508676.png" alt="image-20230725163508676"></p><p>æˆ‘ä»¬ç”¨å‘½ä»¤æŸ¥çœ‹ï¼Œå›¾ä¸­è¿›ç¨‹å·æ˜¯105266</p><figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -LF 105266</span><br></pre></td></tr></table></div></figure><p>ç»“æœï¼š</p><p>å¯ä»¥çœ‹å‡ºï¼Œfirefoxè¿›ç¨‹çš„è¿™ä¹ˆå¤šçº¿ç¨‹ï¼Œè™½ç„¶è¿›ç¨‹å·éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯çº¿ç¨‹å·æ˜¯ä¸ä¸€æ ·çš„</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725163632242.png" alt="image-20230725163632242"></p><h3 id="è¿›ç¨‹å’Œçº¿ç¨‹åŒºåˆ«"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹åŒºåˆ«" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è¿›ç¨‹å’Œçº¿ç¨‹åŒºåˆ«"></a> è¿›ç¨‹å’Œçº¿ç¨‹åŒºåˆ«</h3><p><strong>è¿›ç¨‹ä¹‹é—´çš„ä¿¡æ¯éš¾ä»¥å…±äº«ï¼Œæƒ³è¦å…±äº«éœ€è¦é‡‡å–è¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼ï¼›å¹¶ä¸”fork()ä»£ä»·æ¯”è¾ƒé«˜</strong></p><p><strong>çº¿ç¨‹ä¹‹é—´èƒ½å¤Ÿæ–¹ä¾¿ï¼Œå¿«é€Ÿçš„å…±äº«ä¿¡æ¯ï¼Œåªéœ€è¦å°†æ•°æ®å¤åˆ¶åˆ°å…±äº«(å…¨å±€æˆ–å †)å˜é‡ä¸­å³å¯</strong></p><p><strong>åˆ›å»ºçº¿ç¨‹çš„é€Ÿç‡æ¯”è¿›ç¨‹é€šå¸¸å¿«å¾ˆå¤šï¼Œ10å€ç”šè‡³æ›´å¤šï¼›çº¿ç¨‹ä¹‹é—´å…±äº«è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œæ— åºé‡‡å–å†™æ—¶å¤åˆ¶çš„æ–¹å¼å¤åˆ¶å†…å­˜ï¼Œä¹Ÿæ— é¡»å¤åˆ¶é¡µè¡¨</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725164029090.png" alt="image-20230725164029090"></p><p>æˆ‘ä»¬ç”»ä¸ªå›¾æ¥ç†è§£ä¸€ä¸‹</p><p><strong>è™½ç„¶çº¿ç¨‹æ˜¯å…±äº«è™šæ‹Ÿåœ°å€ç©ºé—´çš„ï¼Œä½†ä¸ä»£è¡¨ç©ºé—´ä¸­æ‰€æœ‰çš„åŒºåŸŸéƒ½æ˜¯å…±äº«çš„ï¼Œæ¯”å¦‚ä¸‹é¢çš„æ ˆç©ºé—´å’Œ.textä»£ç æ®µå°±ä¸å…±äº«</strong></p><p><strong>.textæ˜¯ä»£ç æ®µï¼Œè¿™ä¸ªçº¿ç¨‹æ˜¯ä¸å…±äº«çš„ï¼Œè€Œæ˜¯åˆ’åˆ†å‡ºè‡ªå·±çš„ä¸€å—åŒºåŸŸ</strong></p><p><strong>æ ˆç©ºé—´ä¹Ÿæ˜¯ä¸å…±äº«çš„ï¼Œå„ä¸ªçº¿ç¨‹å°†è¿™ä¸€å—æ ˆç©ºé—´åˆ’åˆ†å‡ºè‡ªå·±çš„ä¸€å—åŒºåŸŸ</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725203244279.png" alt="image-20230725203244279"></p><h3 id="çº¿ç¨‹çš„å…±äº«å’Œéå…±äº«èµ„æº"><a href="#çº¿ç¨‹çš„å…±äº«å’Œéå…±äº«èµ„æº" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#çº¿ç¨‹çš„å…±äº«å’Œéå…±äº«èµ„æº"></a> çº¿ç¨‹çš„å…±äº«å’Œéå…±äº«èµ„æº</h3><ul><li><strong>ç”¨æˆ·åŒºä¸­ï¼Œè™šæ‹Ÿåœ°å€ç©ºé—´é™¤äº†æ ˆå’Œä»£ç æ®µä¸å…±äº«ï¼Œå…¶ä»–å…±äº«ï¼›å‰©ä½™çš„éƒ½æ˜¯å†…æ ¸åŒºçš„æ•°æ®ï¼Œè¿™äº›æ˜¯å…±äº«çš„ï¼Œæ²¡æœ‰å¤åˆ¶æ“ä½œ</strong></li><li><strong>éå…±äº«èµ„æºï¼šçº¿ç¨‹IDï¼Œä¿¡å·æ©ç (é˜»å¡ä¿¡å·é›†)ï¼Œçº¿ç¨‹ç‰¹æœ‰çš„æ•°æ®ï¼Œerrnoå˜é‡ï¼Œå®æ—¶è°ƒåº¦ç­–ç•¥å’Œä¼˜å…ˆçº§ï¼›æ ˆï¼Œæœ¬åœ°å˜é‡å’Œå‡½æ•°è°ƒç”¨é“¾æ¥ä¿¡æ¯</strong></li></ul><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725201723897.png" alt="image-20230725201723897"></p><h2 id="çº¿ç¨‹æ“ä½œ"><a href="#çº¿ç¨‹æ“ä½œ" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#çº¿ç¨‹æ“ä½œ"></a> çº¿ç¨‹æ“ä½œ</h2><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230726174153972.png" alt="image-20230726174153972"></p><h3 id="åˆ›å»ºçº¿ç¨‹-pthead_create"><a href="#åˆ›å»ºçº¿ç¨‹-pthead_create" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#åˆ›å»ºçº¿ç¨‹-pthead_create"></a> åˆ›å»ºçº¿ç¨‹ pthead_create()</h3><p>æ³¨æ„è¿”å›å€¼ä¸è¿›ç¨‹é‚£ä¸€å¥—æœ‰åŒºåˆ«ï¼Œè¿˜æœ‰é”™è¯¯å·ä¹Ÿæœ‰åŒºåˆ«äº†</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//	   ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œmainå‡½æ•°æ‰€åœ¨çš„çº¿ç¨‹ç§°ä¸ºä¸»çº¿ç¨‹(mainçº¿ç¨‹)ï¼Œå…¶ä½™åˆ›å»ºçš„çº¿ç¨‹ç§°ä¸ºå­çº¿ç¨‹</span></span><br><span class="line"><span class="comment">//     ç¨‹åºä¸­é»˜è®¤åªæœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œfork()å‡½æ•°è°ƒç”¨ï¼Œå˜ä¸º2ä¸ªè¿›ç¨‹</span></span><br><span class="line"><span class="comment">//     ç¨‹åºä¸­é»˜è®¤åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œpthread_create()è°ƒç”¨ï¼Œå˜ä¸º2ä¸ªçº¿ç¨‹</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">pthread_create</span><span class="params">(<span class="type">pthread_t</span> *restrict thread,</span></span></span><br><span class="line"><span class="params"><span class="function">                     <span class="type">const</span> <span class="type">pthread_attr_t</span> *restrict attr,</span></span></span><br><span class="line"><span class="params"><span class="function">                     <span class="type">void</span> *(*start_routine)(<span class="type">void</span> *),</span></span></span><br><span class="line"><span class="params"><span class="function">                     <span class="type">void</span> *restrict arg)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šåˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">//     threadï¼šç±»å‹æ˜¯pthread_tæŒ‡é’ˆï¼Œä¼ å‡ºå‚æ•°ï¼Œçº¿ç¨‹åˆ›å»ºæˆåŠŸåï¼Œå­çº¿ç¨‹çš„çº¿ç¨‹IDè¢«å†™åˆ°åœ¨å˜é‡ä¸­</span></span><br><span class="line"><span class="comment">//     attrï¼šè®¾ç½®çº¿ç¨‹çš„å±æ€§ï¼Œä¸€èˆ¬ä½¿ç”¨é»˜è®¤å€¼ï¼Œä¼ é€’nullptr</span></span><br><span class="line"><span class="comment">//     start_routineï¼šå‡½æ•°æŒ‡é’ˆï¼Œè¿™ä¸ªå‡½æ•°æ˜¯å­çº¿ç¨‹éœ€è¦å¤„ç†çš„é€»è¾‘ä»£ç </span></span><br><span class="line"><span class="comment">//     argï¼šç»™ç¬¬ä¸‰ä¸ªå‚æ•°ä½¿ç”¨ï¼Œä¼ å‚</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼š</span></span><br><span class="line"><span class="comment">//     æˆåŠŸ 0</span></span><br><span class="line"><span class="comment">//     å¤±è´¥ è¿”å›ä¸€ä¸ªé”™è¯¯å·ï¼Œè¿™ä¸ªé”™è¯¯å·å’Œä¹‹å‰çš„errnoä¸å¤ªä¸€æ ·(å®ç°æ–¹å¼ä¸€æ ·ï¼Œä½†æ˜¯å«ä¹‰ä¸åŒ)</span></span><br><span class="line"><span class="comment">//         ä¸èƒ½é€šè¿‡perror()å»è·å–é”™è¯¯å·ä¿¡æ¯</span></span><br><span class="line"><span class="comment">//         å¦‚ä½•è·å–ï¼Ÿ char* strerror(int errnum);</span></span><br></pre></td></tr></table></div></figure><p>ä»£ç </p><p><strong>è¿™ä¸ªä»£ç åªéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå°±æ˜¯ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹æ‰§è¡Œçš„åŒºåŸŸæ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸»çº¿ç¨‹æ‰§è¡Œmainå‡½æ•°é‡Œé¢çš„å†…å®¹ï¼Œç„¶ååˆ›å»ºå‡ºäº†å­çº¿ç¨‹ï¼Œå­çº¿ç¨‹çš„ä»£ç æ®µå½“ä¸­æ‰§è¡Œcall_back()å›è°ƒå‡½æ•°é‡Œé¢çš„é€»è¾‘ï¼Œä»–çš„èŒƒå›´å°±å±€é™äºè¿™ä¸ªå›è°ƒå‡½æ•°ï¼Œå‚æ•°å¯ä»¥é€šè¿‡ä¸»çº¿ç¨‹ä¼ é€’ç»™ä»–ï¼Œè¿™å°±æ˜¯ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆçº¿ç¨‹ä¹‹é—´ä»£ç æ®µå’Œæ ˆç©ºé—´çš„å†…å®¹ä¸æ˜¯å…±äº«çš„ï¼Œå› ä¸ºè¿™æ ·è®¾è®¡ä¸‹æ¥å°±æ²¡æ³•å…±äº«äº†</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹æ‰§è¡Œçš„ä»£ç æ®µæ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°é‡Œé¢æ˜¯å­çº¿ç¨‹æ‰§è¡Œçš„ä»£ç é€»è¾‘</span></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">call_back</span><span class="params">(<span class="type">void</span>* args)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;child thread...\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;arg value : %d\n&quot;</span>, *(<span class="type">int</span>*)args);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// mainå‡½æ•°é‡Œé¢æ˜¯ä¸»çº¿ç¨‹æ‰§è¡Œçš„é€»è¾‘</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹</span></span><br><span class="line">    <span class="type">pthread_t</span> tid;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> num = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">pthread_create</span>(&amp;tid, <span class="literal">nullptr</span>, call_back, (<span class="type">void</span>*)&amp;num);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> != ret) &#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">char</span>* _error = <span class="built_in">strerror</span>(ret);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;error : %s\n&quot;</span>, _error);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, i);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">1</span>);  <span class="comment">// ä¿è¯å­çº¿ç¨‹ä¸‡ä¸€æ²¡æœ‰åˆ›å»ºå¥½ä¸»çº¿ç¨‹å°±æ‰§è¡Œå®Œäº†</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ‰§è¡Œç»“æœï¼š</p><p><strong>æ³¨æ„ç¼–è¯‘è¦é“¾æ¥ä¸ŠpthreadåŠ¨æ€åº“ï¼Œ<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="http://xn--libpthread-0m4pu20czs7cj6b.so">æ–‡ä»¶åæ˜¯libpthread.so</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>ï¼Œåº“åå­—æ˜¯pthreadï¼Œç”¨ -l å‚æ•°é“¾æ¥</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725212001708.png" alt="image-20230725212001708"></p><p>å½“ç„¶ï¼Œç”±äºä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹æ˜¯å¹¶å‘çš„å…³ç³»ï¼Œå¾ˆæœ‰å¯èƒ½æ‰§è¡Œç»“æœä¸ä¸€æ ·</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230725212124179.png" alt="image-20230725212124179"></p><h3 id="ç»ˆæ­¢çº¿ç¨‹-pthread_exit"><a href="#ç»ˆæ­¢çº¿ç¨‹-pthread_exit" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç»ˆæ­¢çº¿ç¨‹-pthread_exit"></a> ç»ˆæ­¢çº¿ç¨‹ pthread_exit()</h3><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">	<span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">pthread_exit</span><span class="params">(<span class="type">void</span> *retval)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šç»ˆæ­¢ä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨å“ªä¸ªçº¿ç¨‹ä¸­è°ƒç”¨ï¼Œå°±è¡¨ç¤ºç»ˆæ­¢å“ªä¸ªçº¿ç¨‹</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">//     retvalï¼šéœ€è¦ä¼ é€’ä¸€ä¸ªæŒ‡é’ˆï¼Œä½œä¸ºä¸€ä¸ªè¿”å›å€¼ï¼Œå¯ä»¥åœ¨pthread_join()ä¸­è·å–åˆ°</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">pthread_t</span> <span class="title">pthread_self</span><span class="params">(<span class="type">void</span>)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šè·å–å½“å‰çº¿ç¨‹çš„çº¿ç¨‹id(unsigned long int æ— ç¬¦å·é•¿æ•´å½¢)</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">pthread_equal</span><span class="params">(<span class="type">pthread_t</span> t<span class="number">1.</span><span class="type">pthread_t</span> t1)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šæ¯”è¾ƒä¸¤ä¸ªçº¿ç¨‹idæ˜¯å¦ç›¸ç­‰</span></span><br><span class="line"><span class="comment">//     ä¸åŒçš„æ“ä½œç³»ç»Ÿå¯¹äº pthread_t çš„å®ç°ä¸ä¸€æ ·ï¼Œæœ‰çš„æ˜¯æ— ç¬¦å·çš„é•¿æ•´å‹ï¼Œæœ‰çš„æ˜¯ç”¨ç»“æ„ä½“å»å®ç°çš„ï¼Œä¸èƒ½ç®€å•çš„ç”¨ == å·åˆ¤æ–­</span></span><br></pre></td></tr></table></div></figure><p>ä»£ç ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">call_back</span><span class="params">(<span class="type">void</span>* arg)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸ºäº†æµ‹è¯•pthread_exit()ä¼šä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹çš„æ­£å¸¸è¿è¡Œï¼Œè¿™é‡Œç¡ä¸‰ç§’ï¼Œè®©ä¸»çº¿ç¨‹è·‘å®Œ</span></span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">3</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;child thread id : %ld\n&quot;</span>, <span class="built_in">pthread_self</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™é‡Œä¸¤ä¸ªå¯¹ç­‰æ˜¯å› ä¸ºå­çº¿ç¨‹ç»“æŸå¹¶ä¸å†³å®šæ•´ä¸ªè¿›ç¨‹çš„ç»“æŸï¼Œä¸»çº¿ç¨‹ return 0 å°±ä»£è¡¨è¿›ç¨‹ç»“æŸé€€å‡ºï¼Œå­çº¿ç¨‹åˆ™ä¸ä¸€æ ·</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;  <span class="comment">// pthread_exit(nullptr)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹</span></span><br><span class="line">    <span class="type">pthread_t</span> tid;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">pthread_create</span>(&amp;tid, <span class="literal">nullptr</span>, call_back, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> != ret) &#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">char</span>* str = <span class="built_in">strerror</span>(ret);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;error : %s\n&quot;</span>, str);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸»çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, i);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;tid : %ld , parent thread id : %ld\n&quot;</span>, tid, <span class="built_in">pthread_self</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®©ä¸»çº¿ç¨‹é€€å‡ºï¼Œå½“ä¸»çº¿ç¨‹é€€å‡ºçš„æ—¶å€™ä¸ä¼šå½±å“å…¶ä»–æ­£å¸¸è¿è¡Œçš„çº¿ç¨‹</span></span><br><span class="line">    <span class="built_in">pthread_exit</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™ä¸€è¡Œä»£ç æ²¡æœ‰æ‰§è¡Œï¼Œè¯´æ˜ä¸»çº¿ç¨‹é€€å‡ºåæ‰§è¡Œreturn 0ç»“æŸæ‰æ•´ä¸ªè¿›ç¨‹ï¼›è€Œæ˜¯å½“æ‰€æœ‰çº¿ç¨‹è·‘å®Œè¿›ç¨‹æ‰ç»“æŸï¼Œå› æ­¤ä¸ä¼šå¯¹å…¶ä»–çš„çº¿ç¨‹äº§ç”Ÿå½±å“</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;main thread exit.\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p><strong>æ³¨æ„å¯¹pthread_exit()çš„ç†è§£ï¼š</strong></p><ul><li><strong>çº¿ç¨‹é€€å‡ºå’Œçº¿ç¨‹ç»“æŸçš„å«ä¹‰æ˜¯ä¸åŒçš„ï¼Œçº¿ç¨‹é€€å‡ºä¸ä¼šå½±å“å…¶ä»–çš„çº¿ç¨‹ï¼Œç‰¹åˆ«æ˜¯ä¸»çº¿ç¨‹ï¼Œçº¿ç¨‹ç»“æŸå¯¹äºä¸»çº¿ç¨‹è€Œè¨€å°±ä¼šå¯¼è‡´æ•´ä¸ªè¿›ç¨‹ç»“æŸäº†ï¼Œç¨‹åºç»“æŸï¼Œè€Œä¸»çº¿ç¨‹é€€å‡ºåˆ™ä¸ä¼š</strong></li><li><strong>ä¸»çº¿ç¨‹è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œæ„æ€æ˜¯ä¸»çº¿ç¨‹é€€å‡ºï¼Œä½†æ˜¯ä¸èµ°åé¢çš„ä»£ç ï¼Œæ¯”å¦‚å›¾ä¸­åé¢ä¸€å¥çš„æ‰“å°å°±ä¸èµ°ï¼Œä¹Ÿä¸ä¼š return 0ï¼Œå› ä¸ºåœ¨ä¸»çº¿ç¨‹ä¸­ return 0 å°±ä¼šå¯¼è‡´æ•´ä¸ªè¿›ç¨‹çš„ç»“æŸï¼Œæ‰€ä»¥è¿™æ—¶è¿›ç¨‹ä¸ä¼šç»“æŸï¼Œå­çº¿ç¨‹å¯ä»¥å°½æƒ…çš„è¿è¡Œï¼ŒçŸ¥é“å‡è¿è¡Œå®Œæ¯•ï¼Œç„¶åæ•´ä¸ªè¿›ç¨‹ç»“æŸ</strong></li><li><strong>å­çº¿ç¨‹çš„æ‰§è¡Œå‡½æ•°é€»è¾‘å½“ä¸­ï¼Œæœ€åè¿”å›ï¼Œä¾‹å¦‚ return nullptrï¼Œä¹Ÿç›¸å½“äºpthread_exit()ï¼Œå› ä¸ºå­çº¿ç¨‹é€€å‡ºä¸ä¼šå¯¹æ•´ä¸ªè¿›ç¨‹é€ æˆé€€å‡ºçš„å½±å“ï¼Œæ‰€ä»¥æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼›æ‰€ä»¥å­çº¿ç¨‹é€€å‡ºå’Œå­çº¿ç¨‹ç»“æŸåŸºæœ¬æ²¡æœ‰åŒºåˆ«</strong></li></ul><h3 id="è¿æ¥å·²ç»ˆæ­¢çš„çº¿ç¨‹-pthread_join"><a href="#è¿æ¥å·²ç»ˆæ­¢çš„çº¿ç¨‹-pthread_join" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è¿æ¥å·²ç»ˆæ­¢çš„çº¿ç¨‹-pthread_join"></a> è¿æ¥å·²ç»ˆæ­¢çš„çº¿ç¨‹ pthread_join()</h3><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">	<span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">pthread_join</span><span class="params">(<span class="type">pthread_t</span> thread, <span class="type">void</span> **retval)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šå’Œä¸€ä¸ªå·²ç»ç»ˆæ­¢çš„çº¿ç¨‹è¿›è¡Œè¿æ¥</span></span><br><span class="line"><span class="comment">//     è¯´ç™½äº†å°±æ˜¯å›æ”¶å­çº¿ç¨‹çš„èµ„æºï¼Œé˜²æ­¢äº§ç”Ÿåƒµå°¸çº¿ç¨‹</span></span><br><span class="line"><span class="comment">//     è¿™ä¸ªå‡½æ•°æ˜¯é˜»å¡å‡½æ•°ï¼Œè°ƒç”¨ä¸€æ¬¡åªèƒ½å›æ”¶ä¸€ä¸ªå­çº¿ç¨‹</span></span><br><span class="line"><span class="comment">//     ä¸€èˆ¬åœ¨ä¸»çº¿ç¨‹ä¸­å»ä½¿ç”¨(çˆ¶çº¿ç¨‹å›æ”¶å­çº¿ç¨‹çš„èµ„æº)</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">//     threadï¼šéœ€è¦å›æ”¶çš„å­çº¿ç¨‹id</span></span><br><span class="line"><span class="comment">//     retvalï¼šæ¥å—å­çº¿ç¨‹é€€å‡ºæ—¶çš„è¿”å›å€¼ï¼Œæ˜¯ä¸ªäºŒçº§æŒ‡é’ˆï¼›å¦‚æœä¸éœ€è¦åˆ™ä¼ é€’nullptr</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼š</span></span><br><span class="line"><span class="comment">//     æˆåŠŸ 0</span></span><br><span class="line"><span class="comment">//     å¤±è´¥ è¿”å›é”™è¯¯å·(ç”¨strerror())</span></span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> value = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">call_back</span><span class="params">(<span class="type">void</span>* arg)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸ºäº†æµ‹è¯•pthread_exit()ä¼šä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹çš„æ­£å¸¸è¿è¡Œï¼Œè¿™é‡Œç¡ä¸‰ç§’ï¼Œè®©ä¸»çº¿ç¨‹è·‘å®Œ</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;child thread id : %ld\n&quot;</span>, <span class="built_in">pthread_self</span>());</span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™é‡Œä¸¤ä¸ªå¯¹ç­‰æ˜¯å› ä¸ºå­çº¿ç¨‹ç»“æŸå¹¶ä¸å†³å®šæ•´ä¸ªè¿›ç¨‹çš„ç»“æŸï¼Œä¸»çº¿ç¨‹ return 0 å°±ä»£è¡¨è¿›ç¨‹ç»“æŸé€€å‡ºï¼Œå­çº¿ç¨‹åˆ™ä¸ä¸€æ ·</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œç»™ä¸€ä¸ªè¿”å›å€¼</span></span><br><span class="line">    <span class="comment">// int value = 10;               // å±€éƒ¨å˜é‡ï¼Œè¿™æ˜¯å­˜åœ¨äºè‡ªå·±çš„æ ˆç©ºé—´å½“ä¸­ï¼Œå­çº¿ç¨‹ç»“æŸä¹‹åå°±è¢«é‡Šæ”¾ï¼Œæ‰€ä»¥ä¸»çº¿ç¨‹æ— æ³•æ¥æ”¶åˆ°ï¼›ä¸€èˆ¬ç”¨å…¨å±€å˜é‡æˆ–è€…å †ç©ºé—´çš„æ•°æ®</span></span><br><span class="line">    <span class="built_in">pthread_exit</span>((<span class="type">void</span>*)&amp;value);  <span class="comment">// return (void*)&amp;value;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹</span></span><br><span class="line">    <span class="type">pthread_t</span> tid;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">pthread_create</span>(&amp;tid, <span class="literal">nullptr</span>, call_back, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> != ret) &#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">char</span>* str = <span class="built_in">strerror</span>(ret);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;error : %s\n&quot;</span>, str);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸»çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, i);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;tid : %ld , parent thread id : %ld\n&quot;</span>, tid, <span class="built_in">pthread_self</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸»çº¿ç¨‹è°ƒç”¨pthread_join()å»å›æ”¶å­çº¿ç¨‹èµ„æº</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œå¯ä»¥é€‰æ‹©æ¥å—å­çº¿ç¨‹æ‰§è¡Œçš„è¿”å›å€¼ä¹Ÿå¯ä»¥é€‰æ‹©ä¸è¦ï¼Œä¸è¦å°±ä¼ é€’nullptr</span></span><br><span class="line">    <span class="comment">// ä¸ºä»€ä¹ˆæ˜¯äºŒçº§æŒ‡é’ˆï¼Ÿè¿”å›å€¼æ˜¯ä¸€çº§æŒ‡é’ˆï¼Œæˆ‘è¦ä¼ é€’ä»–çš„æŒ‡é’ˆåšä¼ å‡ºå‚æ•°æ‰èƒ½æ¥å—åˆ°!!!</span></span><br><span class="line">    <span class="type">int</span>* thread_retval;</span><br><span class="line">    <span class="comment">// ret = pthread_join(tid, nullptr);</span></span><br><span class="line">    ret = <span class="built_in">pthread_join</span>(tid, (<span class="type">void</span>**)&amp;thread_retval);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> != ret) &#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">char</span>* str = <span class="built_in">strerror</span>(ret);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;error : %s\n&quot;</span>, str);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;exit data : %d\n&quot;</span>, *thread_retval);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;å›æ”¶å­çº¿ç¨‹èµ„æºæˆåŠŸ\n&quot;</span>);  <span class="comment">// è¿™ä¸€è¡Œä»£ç ä¼šåœ¨å›æ”¶å­çº¿ç¨‹ä¹‹åç»“æŸ</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”±äºå­çº¿ç¨‹å·²ç»ç»“æŸï¼Œä¸»çº¿ç¨‹å·²ç»å›æ”¶å®Œäº†æ‰€æœ‰çš„èµ„æºï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒä¸»çº¿ç¨‹ç»“æŸä¼šå¯¼è‡´è¿›ç¨‹ç»“æŸå­çº¿ç¨‹æ²¡è·‘å®Œçš„é—®é¢˜äº†</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥è¿™ä¸€è¡Œæœ‰æ— æ²¡æœ‰åŒºåˆ«ï¼Œæœ‰ä¸‹é¢ä¸€è¡Œæ‰§è¡Œä¸äº†ï¼Œæ²¡æœ‰ä¸‹é¢ä¸€è¡Œä¼šæ‰§è¡Œ</span></span><br><span class="line">    <span class="built_in">pthread_exit</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;main thread exit.\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ³¨æ„å‡ ç‚¹ï¼š</p><ul><li><p>pthread_join(pthread_t thread, void **retval)ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯éœ€è¦å›æ”¶çš„çº¿ç¨‹idï¼Œç¬¬äºŒä¸ªå‚æ•°å¯ä»¥é€‰æ‹©æ¥å—è¯¥å­çº¿ç¨‹çš„æ‰§è¡Œçš„å›è°ƒå‡½æ•°çš„è¿”å›å€¼ï¼Œæ³¨æ„ç±»å‹æ˜¯äºŒçº§æŒ‡é’ˆï¼Œä¸éœ€è¦æ¥å—åˆ™ä¼ é€’nullptr</p><p>é‚£ä¸ºä»€ä¹ˆè¦ä¼ é€’äºŒçº§æŒ‡é’ˆå‘¢ï¼Ÿå°±æ˜¯ä¼ å‡ºå‚æ•°çš„å«ä¹‰äº†ï¼Œå› ä¸ºå›è°ƒå‡½æ•°è¿”å›çš„æ˜¯void*ä¸€çº§æŒ‡é’ˆç±»å‹ï¼Œæˆ‘ä»¬è¦æƒ³é€šè¿‡ä¼ å…¥çš„å‚æ•°è®©ç³»ç»Ÿå¸®æˆ‘ä»¬ä¿®æ”¹ä¸èƒ½return by valueï¼Œåªèƒ½return by pointeræˆ–è€…return by referenceï¼Œè¿™æ ·æ‰èƒ½æ­£ç¡®ä¿®æ”¹ï¼Œæ‰€ä»¥éœ€è¦ä¼ å…¥çš„æ˜¯äºŒçº§æŒ‡é’ˆ</p></li><li><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230727111343535.png" alt="image-20230727111343535"></p></li></ul><p>call_back()å‡½æ•°é‡Œé¢çš„è¿”å›çš„å˜é‡ä¸èƒ½æ˜¯å±€éƒ¨å˜é‡ï¼Œä¹Ÿå°±æ˜¯æ”¾åœ¨æ ˆä¸Šé¢çš„ï¼Œå› ä¸ºçº¿ç¨‹ä¹‹é—´éå¸¸é‡è¦çš„ä¸¤ä¸ªä¸å…±äº«çš„ä¸œè¥¿å°±æ˜¯æ ˆç©ºé—´å’Œ.textä»£ç æ®µï¼Œæ ˆç©ºé—´é‡Œé¢çš„å˜é‡åœ¨å­çº¿ç¨‹ç»“æŸåå°±ä¼šé‡Šæ”¾æ‰ï¼Œæ‰€ä»¥å¦‚æœè¦ä¼ é€’çš„è¯æœ€å¥½é€‰æ‹©å…¨å±€å˜é‡ã€‚å †ç©ºé—´è™½ç„¶ä¹Ÿæ˜¯å…±äº«çš„ï¼Œä½†æ˜¯å¯èƒ½æœ‰é—®é¢˜(ä¸ç®¡æ˜¯å…¨å±€å †è¿˜æ˜¯å±€éƒ¨å †)ï¼Œè™½ç„¶ç©ºé—´æ˜¯å…¬ç”¨çš„ï¼Œä½†æ˜¯å¥½åƒå…¶ä»–çº¿ç¨‹ä¸€æ˜¯æ²¡æœ‰åŠæ³•free()è¿™ä¸ªæ•°æ®ï¼ŒäºŒæ˜¯æˆ‘æµ‹è¯•è¿‡å¥½åƒä¸è¡Œï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚æ‰€ä»¥å»ºè®®å°±ç”¨å…¨å±€å˜é‡</p><h3 id="çº¿ç¨‹çš„åˆ†ç¦»-pthread_detach"><a href="#çº¿ç¨‹çš„åˆ†ç¦»-pthread_detach" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#çº¿ç¨‹çš„åˆ†ç¦»-pthread_detach"></a> çº¿ç¨‹çš„åˆ†ç¦» pthread_detach()</h3><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">	<span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">pthread_detach</span><span class="params">(<span class="type">pthread_t</span> thread)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šåˆ†ç¦»ä¸€ä¸ªçº¿ç¨‹ï¼Œè¢«åˆ†ç¦»çš„çº¿ç¨‹åœ¨ç»ˆæ­¢çš„æ—¶å€™ä¼šè‡ªåŠ¨é‡Šæ”¾èµ„æºè¿”å›ç»™ç³»ç»Ÿ</span></span><br><span class="line"><span class="comment">//     - ä¸èƒ½å¤šæ¬¡åˆ†ç¦»ï¼Œä¼šäº§ç”Ÿä¸å¯é¢„æœŸçš„ç»“æœ</span></span><br><span class="line"><span class="comment">//     - ä¸èƒ½å»è¿æ¥(join)ä¸€ä¸ªå·²ç»åˆ†ç¦»çš„çº¿ç¨‹ï¼Œå¦‚æœæ“ä½œäº†ä¼šæŠ¥é”™(ä¼šè‡ªåŠ¨é‡Šæ”¾èµ„æº)</span></span><br><span class="line"><span class="comment">// å‚æ•°ï¼šéœ€è¦åˆ†ç¦»çš„çº¿ç¨‹id</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼š</span></span><br><span class="line"><span class="comment">//     æˆåŠŸ 0</span></span><br><span class="line"><span class="comment">//     å¤±è´¥ é”™è¯¯å·</span></span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">call_back</span><span class="params">(<span class="type">void</span>* arg)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;child thread id : %ld\n&quot;</span>, <span class="built_in">pthread_self</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line">    <span class="type">pthread_t</span> tid;</span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">pthread_create</span>(&amp;tid, <span class="literal">nullptr</span>, call_back, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> != ret) &#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">char</span>* errstr = <span class="built_in">strerror</span>(ret);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;error pthread_create : %s\n&quot;</span>, errstr);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¾“å‡ºä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹çš„id</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;tid : %ld , main thread id : %ld\n&quot;</span>, tid, <span class="built_in">pthread_self</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®å­çº¿ç¨‹åˆ†ç¦»ï¼Œå­çº¿ç¨‹åˆ†ç¦»åï¼Œç»“æŸæ—¶å€™å¯¹åº”çš„èµ„æºå°±ä¸éœ€è¦ä¸»çº¿ç¨‹æ‰‹åŠ¨å›æ”¶äº†</span></span><br><span class="line">    ret = <span class="built_in">pthread_detach</span>(tid);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> != ret) &#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">char</span>* errstr = <span class="built_in">strerror</span>(ret);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;error pthread_detach : %s\n&quot;</span>, errstr);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®åˆ†ç¦»åï¼Œå¯¹åˆ†ç¦»çš„å­çº¿ç¨‹è¿›è¡Œè¿æ¥ï¼Œæˆ‘åè¦æ‰‹åŠ¨é‡Šæ”¾ï¼Œç¨‹åºæ‰§è¡Œç»“æœå°±ä¼šæŠ¥é”™</span></span><br><span class="line">    <span class="comment">// ret = pthread_join(tid, nullptr);</span></span><br><span class="line">    <span class="comment">// if (0 != ret) &#123;</span></span><br><span class="line">    <span class="comment">//     const char* errstr = strerror(ret);</span></span><br><span class="line">    <span class="comment">//     printf(&quot;error pthread_join : %s\n&quot;, errstr);</span></span><br><span class="line">    <span class="comment">//     return -1;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€€å‡ºä¸»çº¿ç¨‹é˜²æ­¢ä¸»çº¿ç¨‹ç»“æŸå¯¼è‡´è¿›ç¨‹ç»“æŸå¯¼è‡´ç¨‹åºç»“æŸ</span></span><br><span class="line">    <span class="built_in">pthread_exit</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è®¾ç½®å­çº¿ç¨‹åˆ†ç¦»åå°±ä¸èƒ½å†å»è¿æ¥å­çº¿ç¨‹æ‰‹åŠ¨é‡Šæ”¾ä»–çš„èµ„æºäº†ï¼Œå› ä¸ºç³»ç»Ÿä¼šè‡ªåŠ¨å°†ä»–çš„èµ„æºç»™é‡Šæ”¾æ‰ï¼Œä¸ç”¨æˆ‘ä»¬æ“å¿ƒ</p><p>å¦‚æœå¼ºè¡ŒåŠ ä¸Šçš„è¯pthread_join()çš„è¿”å›å€¼å°±ä¼šæ˜¯ä¸ªé”™è¯¯å·äº†ï¼Œä½†æ˜¯Linuxæœ¬èº«å¹¶æœªå¯¹ä»–è¿›è¡Œå¤„ç†ï¼Œæ²¡æœ‰å‘å‡ºä¿¡å·è¯´é”™è¯¯ä»€ä¹ˆä»€ä¹ˆçš„ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬è‡ªå·±è¿›è¡Œä¸¥è°¨çš„åˆ¤æ–­äº†ï¼ŒåŠ ä¸Šçš„è¯retæ˜¯ä¸ªé”™è¯¯å·ï¼Œç„¶åå°±ä¼šè·å–åˆ°é”™è¯¯ä¿¡æ¯ï¼Œå¦‚ä¸‹ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230727114257371.png" alt="image-20230727114257371"></p><p>å› æ­¤ä¸èƒ½æ‰‹åŠ¨é‡Šæ”¾(è¿æ¥ join)å·²ç»åˆ†ç¦»çš„çº¿ç¨‹</p><h3 id="çº¿ç¨‹å–æ¶ˆ-pthread_cancel"><a href="#çº¿ç¨‹å–æ¶ˆ-pthread_cancel" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#çº¿ç¨‹å–æ¶ˆ-pthread_cancel"></a> çº¿ç¨‹å–æ¶ˆ pthread_cancel()</h3><p><strong>æ‰§è¡Œçº¿ç¨‹å–æ¶ˆåï¼Œå­è¿›ç¨‹ä¸æ˜¯ç«‹é©¬é€€å‡ºçš„ï¼Œè€Œæ˜¯æ‰§è¡Œåˆ°äº†æŸä¸ªå–æ¶ˆç‚¹ï¼Œçº¿ç¨‹æ‰ä¼šç»ˆæ­¢</strong></p><p><strong>å–æ¶ˆç‚¹å°±æ˜¯ç³»ç»Ÿè®¾ç½®å¥½çš„ä¸€äº›ç³»ç»Ÿè°ƒç”¨(æ¯”å¦‚printf()å°±æ˜¯ä¹‹ä¸€)ï¼Œå¯ä»¥ç²—ç•¥çš„ç†è§£ä¸ºä»ç”¨æˆ·åŒºåˆ°å†…æ ¸åŒºçš„åˆ‡æ¢</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">	<span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">pthread_cancel</span><span class="params">(<span class="type">pthread_t</span> thread)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šå–æ¶ˆçº¿ç¨‹ï¼Œè®©çº¿ç¨‹ç»ˆæ­¢ï¼›åº•å±‚çš„æ‰§è¡Œæ˜¯å‘é€ä¸€ä¸ªå–æ¶ˆçš„è¯·æ±‚ç»™çº¿ç¨‹(æœ‰å¯èƒ½æ˜¯ä¿¡å·)ï¼Œå–æ¶ˆ(ç»ˆæ­¢)çº¿ç¨‹æ˜¯è¦æ‰§è¡Œåˆ°æŸä¸ªæ¡ä»¶ç‚¹æ‰èƒ½ç»ˆæ­¢</span></span><br><span class="line"><span class="comment">// å–æ¶ˆæŸä¸ªçº¿ç¨‹å¯ä»¥ç»ˆæ­¢æŸä¸ªçº¿ç¨‹çš„è¿è¡Œï¼Œä½†æ˜¯å¹¶ä¸æ˜¯ç«‹é©¬ç»ˆæ­¢ï¼Œè€Œæ˜¯æ‰§è¡Œåˆ°äº†ä¸€ä¸ªå–æ¶ˆç‚¹ï¼Œçº¿ç¨‹æ‰ä¼šç»ˆæ­¢</span></span><br><span class="line"><span class="comment">// å–æ¶ˆç‚¹ï¼šç³»ç»Ÿè§„å®šå¥½çš„ä¸€äº›ç³»ç»Ÿè°ƒç”¨(æ¯”å¦‚å°±æœ‰printf())ï¼Œæˆ‘ä»¬å¯ä»¥ç²—ç•¥çš„ç†è§£ä¸ºä»ç”¨æˆ·åŒºåˆ°å†…æ ¸åŒºçš„åˆ‡æ¢ï¼Œè¿™ä¸ªä½ç½®ç§°ä¹‹ä¸ºå–æ¶ˆç‚¹</span></span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">call_back</span><span class="params">(<span class="type">void</span>* arg)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;child thread id : %ld\n&quot;</span>, <span class="built_in">pthread_self</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;child : %d\n&quot;</span>, i);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line">    <span class="type">pthread_t</span> tid;</span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">pthread_create</span>(&amp;tid, <span class="literal">nullptr</span>, call_back, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> != ret) &#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">char</span>* errstr = <span class="built_in">strerror</span>(ret);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;error pthread_create : %s\n&quot;</span>, errstr);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å–æ¶ˆçº¿ç¨‹</span></span><br><span class="line">    <span class="built_in">pthread_cancel</span>(tid);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, i);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¾“å‡ºä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹çš„id</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;tid : %ld , main thread id : %ld\n&quot;</span>, tid, <span class="built_in">pthread_self</span>());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">pthread_exit</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è¾“å‡ºçš„ç»“æœæ¯æ¬¡å¯èƒ½éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œå› ä¸ºä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹è¿è¡Œçš„é¡ºåºå¯èƒ½ä¸åŒï¼Œæ‰€ä»¥æ‰§è¡Œåˆ°çš„å–æ¶ˆç‚¹ä½ç½®ä¹Ÿå¯èƒ½ä¸åŒï¼Œæ‰€ä»¥å¾ˆå¯èƒ½è¾“å‡ºçš„ç»“æœæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ¯”å¦‚ä¸‹é¢ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230731101134205.png" alt="image-20230731101134205"></p><h2 id="çº¿ç¨‹å±æ€§"><a href="#çº¿ç¨‹å±æ€§" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#çº¿ç¨‹å±æ€§"></a> çº¿ç¨‹å±æ€§</h2><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230731101232100.png" alt="image-20230731101232100"></p><p>æ³¨æ„ï¼šçº¿ç¨‹çš„å±æ€§ä¸åªè¿™ä¸€ä¸ªï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„ï¼Œå¦‚ä¸‹ï¼Œéƒ½å¯ä»¥ç”±æˆ‘ä»¬è‡ªå·±å»è®¾ç½®ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230731103140397.png" alt="image-20230731103140397"></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">pthread_attr_init</span><span class="params">(<span class="type">pthread_attr_t</span> *attr)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šåˆå§‹åŒ–çº¿ç¨‹å±æ€§å˜é‡</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">pthread_attr_destroy</span><span class="params">(<span class="type">pthread_attr_t</span> *attr)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šé‡Šæ”¾çº¿ç¨‹å±æ€§èµ„æº</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">pthread_attr_setdetachstate</span><span class="params">(<span class="type">pthread_attr_t</span> *attr, <span class="type">int</span> detachstate)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šè·å–çº¿ç¨‹åˆ†ç¦»çš„çŠ¶æ€å±æ€§</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">pthread_attr_getdetachstate</span><span class="params">(<span class="type">const</span> <span class="type">pthread_attr_t</span> *attr, <span class="type">int</span> *detachstate)</span></span>;</span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šè®¾ç½®çº¿ç¨‹åˆ†ç¦»çš„çŠ¶æ€å±æ€§</span></span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">call_back</span><span class="params">(<span class="type">void</span>* arg)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;child thread id : %ld\n&quot;</span>, <span class="built_in">pthread_self</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å±æ€§å˜é‡</span></span><br><span class="line">    <span class="type">pthread_attr_t</span> attr;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–å±æ€§å˜é‡</span></span><br><span class="line">    <span class="built_in">pthread_attr_init</span>(&amp;attr);</span><br><span class="line">    <span class="comment">// è®¾ç½®å±æ€§</span></span><br><span class="line">    <span class="built_in">pthread_attr_setdetachstate</span>(&amp;attr, PTHREAD_CREATE_DETACHED);  <span class="comment">// è¡¨ç¤ºè®¾ç½®äº†çº¿ç¨‹åˆ†ç¦»</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–çº¿ç¨‹æ ˆçš„å¤§å°</span></span><br><span class="line">    <span class="type">size_t</span> _size;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">pthread_attr_getstacksize</span>(&amp;attr, &amp;_size);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;thread stack size : %ld\n&quot;</span>, _size);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line">    <span class="type">pthread_t</span> tid;</span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">pthread_create</span>(&amp;tid, &amp;attr, call_back, <span class="literal">nullptr</span>);  <span class="comment">// è¿™é‡Œç¬¬äºŒä¸ªå‚æ•°ï¼Œè¡¨ç¤ºçº¿ç¨‹å±æ€§å°±éœ€è¦ä¼ é€’è¿›æ¥äº†</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> != ret) &#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">char</span>* errstr = <span class="built_in">strerror</span>(ret);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;error pthread_create : %s\n&quot;</span>, errstr);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¾“å‡ºä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹çš„id</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;tid : %ld , main thread id : %ld\n&quot;</span>, tid, <span class="built_in">pthread_self</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡Šæ”¾çº¿ç¨‹å±æ€§èµ„æºï¼Œåˆå§‹åŒ–äº†å¿…è¦é‡Šæ”¾!!!</span></span><br><span class="line">    <span class="built_in">pthread_attr_destroy</span>(&amp;attr);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€€å‡ºä¸»çº¿ç¨‹é˜²æ­¢ä¸»çº¿ç¨‹ç»“æŸå¯¼è‡´è¿›ç¨‹ç»“æŸå¯¼è‡´ç¨‹åºç»“æŸ</span></span><br><span class="line">    <span class="built_in">pthread_exit</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>åœ¨ä»£ç ä¸­æ³¨æ„ä¸¤ç‚¹ï¼š</p><ul><li><strong>çº¿ç¨‹å±æ€§ç»“æ„ä½“åˆå§‹åŒ–(init)ä¹‹åå°±å¿…é¡»è¦é‡Šæ”¾(destroy)</strong></li><li><strong>ä¸€èˆ¬æ¥è¯´ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹çš„é‡Šæ”¾å¯ä»¥æœ‰ä¸¤ç§æ–¹æ³•æ¥å†™ï¼šä¸€æ˜¯ä¸»çº¿ç¨‹è°ƒç”¨pthread_join()æ‰‹åŠ¨é˜»å¡å›æ”¶å­çº¿ç¨‹èµ„æºï¼Œè¿™ä¸ªæ—¶å€™å°±ä¸ç”¨è€ƒè™‘å­çº¿ç¨‹ç»“æŸäº†ä¸»çº¿ç¨‹è¿˜æ²¡ç»“æŸæ²¡åŠæ³•å›æ”¶èµ„æºçš„é—®é¢˜ï¼Œå½“ç„¶æˆ‘ä»¬ä¸èƒ½è®©pthread_join()å‰é¢çš„é€»è¾‘æ‰§è¡Œå¤ªä¹…ï¼Œè¿™æ ·åƒµå°¸çº¿ç¨‹çš„å­˜åœ¨æ—¶é—´å¯èƒ½ä¼šå¤ªé•¿ï¼Œå’Œæ²¡æœ‰å¤„ç†å‡ ä¹æ˜¯ä¸€æ ·çš„ï¼›äºŒæ˜¯ä¸»çº¿ç¨‹å°†å­çº¿ç¨‹åˆ†ç¦»pthread_detach()ï¼Œè¿™æ ·ä¸»çº¿ç¨‹å°±ä¸ç”¨å»ç®¡å­çº¿ç¨‹çš„é‡Šæ”¾é—®é¢˜äº†ï¼Œä½†æ˜¯è¿™æ ·æœ€å¥½åœ¨æœ«å°¾åŠ ä¸Špthread_exit()è®©ä¸»çº¿ç¨‹é€€å‡ºï¼Œå¦åˆ™å¾ˆå¯èƒ½ä¸»çº¿ç¨‹æ‰§è¡Œå®Œäº†å¯¼è‡´è¿›ç¨‹ç»“æŸç„¶åå­çº¿ç¨‹è·‘ä¸å®Œï¼Œä¸»çº¿ç¨‹é€€å‡ºæ°å¥½å°±è§£å†³äº†è¿™ä¸ªé—®é¢˜</strong></li></ul><h2 id="çº¿ç¨‹åŒæ­¥"><a href="#çº¿ç¨‹åŒæ­¥" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#çº¿ç¨‹åŒæ­¥"></a> çº¿ç¨‹åŒæ­¥</h2><h3 id="ç¤ºä¾‹å¼•å…¥"><a href="#ç¤ºä¾‹å¼•å…¥" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¤ºä¾‹å¼•å…¥"></a> ç¤ºä¾‹å¼•å…¥</h3><p>å†™ä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œåˆ›å»ºä¸‰ä¸ªå­çº¿ç¨‹ï¼Œä¸‰ä¸ªå­çº¿ç¨‹çš„ä»»åŠ¡æ˜¯å…±åŒå”®å–100å¼ é—¨ç¥¨</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨å¤šçº¿ç¨‹å»å®ç°å–ç¥¨çš„æ¡ˆä¾‹</span></span><br><span class="line"><span class="comment">// æœ‰3ä¸ªçª—å£ï¼Œä¸€å…±100å¼ ç¥¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¨å±€å˜é‡ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰é—®é¢˜</span></span><br><span class="line"><span class="type">int</span> tickets = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">CALLBACK_sell</span><span class="params">(<span class="type">void</span>* arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (tickets &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">usleep</span>(<span class="number">8000</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;pthread tid %ld is selling ticket %d\n&quot;</span>, <span class="built_in">pthread_self</span>(), tickets);</span><br><span class="line">        --tickets;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºå­çº¿ç¨‹</span></span><br><span class="line">    <span class="type">pthread_t</span> tid1, tid2, tid3;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">pthread_create</span>(&amp;tid1, <span class="literal">nullptr</span>, CALLBACK_sell, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">pthread_create</span>(&amp;tid2, <span class="literal">nullptr</span>, CALLBACK_sell, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">pthread_create</span>(&amp;tid3, <span class="literal">nullptr</span>, CALLBACK_sell, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ†ç¦»çº¿ç¨‹</span></span><br><span class="line">    <span class="built_in">pthread_detach</span>(tid1);</span><br><span class="line">    <span class="built_in">pthread_detach</span>(tid2);</span><br><span class="line">    <span class="built_in">pthread_detach</span>(tid3);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸»çº¿ç¨‹é€€å‡º</span></span><br><span class="line">    <span class="built_in">pthread_exit</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>åœ¨ä»£ç å½“ä¸­æˆ‘ä½¿ç”¨äº†å…¨å±€å˜é‡ticketsï¼Œæ¥è®©ä¸‰ä¸ªçº¿ç¨‹è¿›è¡Œå…±äº«å¯¹ä»–è¿›è¡Œå¤„ç†ï¼Œä½†æ˜¯æƒ³æ³•æ˜¯å¾ˆç¾å¥½çš„ï¼Œç°å®å´ä¸ç¾å¥½</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230731143537103.png" alt="image-20230731143537103"></p><p>å›¾ä¸­æœ‰ä¸¤ä¸ªé—®é¢˜ï¼Œä¸€æ˜¯7å·ç¥¨ä¸‰ä¸ªçº¿ç¨‹å–äº†ä¸‰æ¬¡ï¼›äºŒæ˜¯çº¿ç¨‹å–äº†0å·å’Œ-1å·ç¥¨ï¼Œè¿™å¦‚æœå¯¹äºå®é™…çš„é—®é¢˜å°†ä¼šæ˜¯æ¯ç­æ€§çš„æ‰“å‡»</p><ul><li><strong>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸ºä»€ä¹ˆä¼šå–ä¸‰æ¬¡ï¼Ÿ</strong></li></ul><p><strong>è°æƒ³å¦‚ä¸‹æƒ…å½¢ï¼šä¸‰ä¸ªçº¿ç¨‹ABCï¼Œçº¿ç¨‹Aè¿™æ—¶å€™æŠ¢å åˆ°äº†CPUï¼Œç„¶åç¡çœ ï¼›åœ¨ç¡çœ çš„æ—¶å€™çº¿ç¨‹Bå’ŒCè¿›æ¥æŠ¢å äº†CPUï¼Œç„¶åç¡çœ ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™Bå…ˆæ‹¿åˆ°CPUæ‰“å°è¿™ä¸€å¥ï¼Œä½†æ˜¯è¿˜æ²¡æ¥å¾—åŠ --ticket ï¼Œå°±è¢«CæŠ¢å äº†ï¼ŒCä¹Ÿæ‰“å°åŒæ ·çš„ticketï¼Œç„¶åæ¥ä¸åŠâ€“åˆè¢«AæŠ¢å äº†ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™å°±ä¼šå‡ºç°ä¸‰ä¸ªçº¿ç¨‹å–åŒä¸€å¼ ç¥¨çš„æƒ…å†µ</strong></p><ul><li><strong>é‚£ä¹ˆç”¨ç±»ä¼¼çš„æ€è·¯æˆ‘ä»¬å»çœ‹ä¸ºä»€ä¹ˆä¼šå–å‡º0å’Œ-1</strong></li></ul><p><strong>å›¾æ ·çš„äº‹æƒ…ï¼Œä¸‰ä¸ªçº¿ç¨‹åŒæ—¶åœ¨ ticket == 1 çš„æ—¶å€™è¿›æ¥ç„¶åç¡çœ ï¼Œç„¶åAçº¿ç¨‹è¿›æ¥æ‰§è¡Œæ‰“å°å’Œ --ticket ä¸¤å¥ï¼Œè¿™ä¸ªæ—¶å€™ticketå˜æˆ0ï¼ŒBçº¿ç¨‹åŒæ ·æ‰§è¡Œè¿™ä¸¤å¥ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™æ‰“å°çš„ticketæ˜¯0ï¼ŒCçº¿ç¨‹åŒç†ï¼Œåªä¸è¿‡è¿™ä¸ªæ—¶å€™æ‰“å°çš„æ˜¯-1</strong></p><p><strong>æ€»ç»“ä¸€ä¸‹ï¼Œè¿™å°±æ˜¯æ²¡æœ‰åŠ è®¿é—®äº’æ–¥é”çš„åŸå› ï¼Œå¯¹å…±äº«æ•°æ®çš„å¤„ç†æ²¡æœ‰åŠ é”å¯¼è‡´å‡ ä¸ªçº¿ç¨‹åŒæ—¶å¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œè¿™æ ·æ•°æ®çš„æ›´æ–°æ—¶æœºå’Œè¯»å–æ—¶é—´ä¸€æ—¦ä¸æ°å½“ï¼Œå°±å¾ˆæœ‰å¯èƒ½å‡ºç°æ•°æ®ä¸åŒæ­¥çš„é—®é¢˜ï¼Œè¿™å¯¹äºè¦æ±‚ç²¾ç¡®çš„é¡¹ç›®æ˜¯æ¯ç­æ€§çš„æ‰“å‡»</strong></p><h3 id="æ¦‚è¿°-2"><a href="#æ¦‚è¿°-2" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ¦‚è¿°-2"></a> æ¦‚è¿°</h3><p><strong>ä¸´ç•ŒåŒºæ˜¯è®¿é—®ä¸€ä¸ªå…±äº«èµ„æºçš„ä»£ç ç‰‡æ®µï¼Œå¹¶ä¸”å¯¹è¯¥ä»£ç è¿›è¡ŒåŸå­æ“ä½œï¼ŒåŸå­æ“ä½œåœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¸èƒ½è¢«ä¸­æ–­ï¼Œå¿…é¡»è¦æ‰§è¡Œå®Œæ¯•æ‰èƒ½è¢«å…¶ä»–çº¿ç¨‹å ç”¨è®¿é—®ä¸´ç•ŒåŒºèµ„æº</strong></p><p>çº¿ç¨‹åŒæ­¥å°±æ˜¯è®©ä¸€ä¸ªçº¿ç¨‹åœ¨å†…å­˜è¿›è¡Œæ“ä½œçš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹éƒ½ä¸å…è®¸å¯¹è¿™ä¸ªå†…å­˜èµ„æºè¿›è¡Œè®¿é—®ï¼Œåªæœ‰è¯¥çº¿ç¨‹å®Œæˆæ“ä½œï¼Œå…¶ä»–çº¿ç¨‹æ‰èƒ½å¯¹è¯¥å†…å­˜åœ°å€è¿›è¡Œæ“ä½œï¼Œåœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å…¶ä»–çº¿ç¨‹ä½äºé˜»å¡ç­‰å¾…çŠ¶æ€</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230731154000837.png" alt="image-20230731154000837"></p><h3 id="äº’æ–¥é”"><a href="#äº’æ–¥é”" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#äº’æ–¥é”"></a> äº’æ–¥é”</h3><p>æ‰€ä»¥è®¿é—®å…±äº«èµ„æºçš„æ—¶å€™ï¼Œä¸ºäº†é¿å…çº¿ç¨‹æ›´æ–°å…±äº«å˜é‡çš„æ—¶å€™å‡ºç°é—®é¢˜ï¼Œéœ€è¦ä½¿ç”¨äº’æ–¥é”mutexæ¥å¯¹è®¿é—®è¿›è¡Œé™åˆ¶ï¼Œè®¿é—®çš„æ—¶å€™çº¿ç¨‹ç»™è¿™ä¸ªå…±äº«èµ„æºåŠ ä¸Šäº’æ–¥é”ï¼Œå…¶ä»–çº¿ç¨‹ä¸èƒ½è¯•å›¾åœ¨åŠ é”çš„æ—¶å€™å¯¹è¯¥èµ„æºè¿›è¡Œè®¿é—®æˆ–è€…å°è¯•è§£é”ï¼Œåªæœ‰æ‰€æœ‰è€…æ‰èƒ½ç»™äº’æ–¥é‡è§£é”</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230731161340736.png" alt="image-20230731161340736"></p><p>åŠ äº†äº’æ–¥é”ä¹‹åï¼Œç°åœ¨çš„è®¿é—®è¿‡ç¨‹å°±æ˜¯è¿™æ ·äº†ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230801145448245.png" alt="image-20230801145448245"></p><h4 id="ç›¸å…³å‡½æ•°-5"><a href="#ç›¸å…³å‡½æ•°-5" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç›¸å…³å‡½æ•°-5"></a> ç›¸å…³å‡½æ•°</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230801145628830.png" alt="image-20230801145628830"></p><h4 id="ç¤ºä¾‹ä¿®æ”¹"><a href="#ç¤ºä¾‹ä¿®æ”¹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¤ºä¾‹ä¿®æ”¹"></a> ç¤ºä¾‹ä¿®æ”¹(!!!)</h4><p>å›åˆ°ä¹‹å‰å“ªä¸ªå–ç¥¨çš„ä¾‹å­ï¼Œç°åœ¨æˆ‘åŠ ä¸Šäº’æ–¥é”ï¼Œå¦‚ä¸‹ï¼š</p><p>äº’æ–¥é‡å¿…é¡»æ˜¯å…¨å±€çš„ï¼Œå¦‚æœæ˜¯å±€éƒ¨çš„ï¼Œçº¿ç¨‹ä¹‹é—´æ²¡æœ‰åŠæ³•å…±äº«è¿™ä¸ªäº’æ–¥é‡ï¼Œåˆ™ä¼šå¯¼è‡´æœ‰é—®é¢˜</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¨å±€å˜é‡ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰é—®é¢˜</span></span><br><span class="line"><span class="type">int</span> tickets = <span class="number">100</span>;</span><br><span class="line"><span class="comment">// å…¨å±€äº’æ–¥é‡</span></span><br><span class="line"><span class="type">pthread_mutex_t</span> mutex;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">CALLBACK_sell</span><span class="params">(<span class="type">void</span>* arg)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åŠ é”</span></span><br><span class="line">    <span class="built_in">pthread_mutex_lock</span>(&amp;mutex);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸´ç•ŒåŒº</span></span><br><span class="line">    <span class="keyword">while</span> (tickets &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">usleep</span>(<span class="number">8000</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;pthread tid %ld is selling ticket %d\n&quot;</span>, <span class="built_in">pthread_self</span>(), tickets);</span><br><span class="line">        --tickets;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£é”</span></span><br><span class="line">    <span class="built_in">pthread_mutex_unlock</span>(&amp;mutex);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–äº’æ–¥é‡ï¼Œå¿…é¡»æ˜¯å…¨å±€çš„</span></span><br><span class="line">    <span class="built_in">pthread_mutex_init</span>(&amp;mutex, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºå­çº¿ç¨‹</span></span><br><span class="line">    <span class="type">pthread_t</span> tid1, tid2, tid3;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">pthread_create</span>(&amp;tid1, <span class="literal">nullptr</span>, CALLBACK_sell, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">pthread_create</span>(&amp;tid2, <span class="literal">nullptr</span>, CALLBACK_sell, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">pthread_create</span>(&amp;tid3, <span class="literal">nullptr</span>, CALLBACK_sell, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é˜»å¡ç­‰å¾…å›æ”¶çº¿ç¨‹</span></span><br><span class="line">    <span class="built_in">pthread_join</span>(tid1, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">pthread_join</span>(tid2, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">pthread_join</span>(tid3, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡Šæ”¾äº’æ–¥é‡èµ„æº</span></span><br><span class="line">    <span class="built_in">pthread_mutex_destroy</span>(&amp;mutex);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è¿™æ®µä»£ç å®é™…ä¸Šè¿˜æ˜¯æœ‰é—®é¢˜çš„ï¼Œæˆ‘ä»¬æ¥çœ‹è¾“å‡ºç»“æœï¼š</p><p>æˆ‘ä»¬å‘ç°æ‰€æœ‰çš„ç¥¨éƒ½æ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹å–å‡ºçš„ï¼Œæˆ‘ä»¬ä»ä»£ç ä¸­æŸ¥çœ‹æ˜¯ä¸ºä»€ä¹ˆ</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230802144136067.png" alt="image-20230802144136067"></p><p>æ¥çœ‹æˆ‘ä»¬è¿›è¡ŒåŠ é”çš„è¿™æ®µé€»è¾‘ï¼š</p><p>æˆ‘ä»¬å‘ç°å¦‚æœAçº¿ç¨‹ä¸Šäº†é”ï¼Œé‚£ä¹ˆä»–å°±è¿›å…¥äº†while()å¾ªç¯ï¼Œåœ¨è¿™ä¸ªwhile()å¾ªç¯ç»“æŸä¹‹å‰æ˜¯æ²¡æœ‰åŠæ³•è¢«å…¶ä»–çº¿ç¨‹åŠ é”è®¿é—®çš„ï¼Œæ‰€ä»¥å°±å¯¼è‡´äº†æ‰€æœ‰çš„ç¥¨éƒ½æ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹å»å–çš„ï¼Œè¿™æ˜¾ç„¶ä¸ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸ</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span>* <span class="title">CALLBACK_sell</span><span class="params">(<span class="type">void</span>* arg)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åŠ é”</span></span><br><span class="line">    <span class="built_in">pthread_mutex_lock</span>(&amp;mutex);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸´ç•ŒåŒº</span></span><br><span class="line">    <span class="keyword">while</span> (tickets &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">usleep</span>(<span class="number">8000</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;pthread tid %ld is selling ticket %d\n&quot;</span>, <span class="built_in">pthread_self</span>(), tickets);</span><br><span class="line">        --tickets;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£é”</span></span><br><span class="line">    <span class="built_in">pthread_mutex_unlock</span>(&amp;mutex);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå¾—åˆ°ä¸€ä¸ªå¯å‘ï¼Œå°±æ˜¯åŠ é”è¦åŠ åœ¨while()å¾ªç¯é‡Œé¢</p><p>æ‰€ä»¥æˆ‘ä»¬çš„ä»£ç è¿™ä¹ˆä¿®æ”¹ï¼š</p><p>åœ¨while(1)å¾ªç¯é‡Œé¢è¦å¼€å§‹è®¿é—®ä¸´ç•ŒåŒºçš„æ—¶å€™ï¼Œç„¶åè·³å‡ºå¾ªç¯çš„æ¡ä»¶æ˜¯å–å®Œäº†ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥åœ¨ä¸Šä¸€å¼ ç¥¨å–å®Œå‡†å¤‡è·³åˆ°ä¸‹ä¸€å¼ ç¥¨ä¸­é—´æ²¡æœ‰äº’æ–¥é”ä¿æŠ¤çš„å¾ªç¯è¿‡æ¸¡æœŸè¿›è¡ŒæŠ¢å  æˆ–è€… æ—¶é—´ç‰‡ç”¨å®Œè¿›è¡ŒæŠ¢å </p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span>* <span class="title">CALLBACK_sell</span><span class="params">(<span class="type">void</span>* arg)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸´ç•ŒåŒº</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// åŠ é”</span></span><br><span class="line">        <span class="built_in">pthread_mutex_lock</span>(&amp;mutex);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (tickets &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">usleep</span>(<span class="number">5000</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;pthread tid %ld is selling ticket %d\n&quot;</span>, <span class="built_in">pthread_self</span>(), tickets);</span><br><span class="line">            --tickets;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å–å®Œäº†</span></span><br><span class="line">            <span class="built_in">pthread_mutex_unlock</span>(&amp;mutex);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è§£é”</span></span><br><span class="line">        <span class="built_in">pthread_mutex_unlock</span>(&amp;mutex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>ä½†æ˜¯æˆ‘ä»¬çš„è¾“å‡ºç»“æœæ˜¯ï¼š</p><p>è¿˜æ˜¯åªæœ‰ä¸€ä¸ªäººåœ¨å–ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬è§‚å¯Ÿå‘ç°ï¼Œæˆ‘ä»¬å–å®Œç¥¨ç¡çœ äº†ä¸€æ®µæ—¶é—´ï¼Œè¿™æ®µæ—¶é—´è‚¯å®šæ˜¯æ¯”CPUçš„æ—¶é—´ç‰‡è¦å¤§çš„ï¼Œå¹¶ä¸”çº¿ç¨‹Aåœ¨ä¼‘çœ çš„è¿‡ç¨‹ä¸­è¿˜æ˜¯è¢«åŠ é”ä¿æŠ¤äº†çš„ï¼Œé™¤éè¿™æ®µæ—¶é—´å°äºæ—¶é—´ç‰‡ï¼Œç³»ç»Ÿæ‰ä¼šæŠŠCPUç»™ä»–ï¼Œä½†æ˜¯æ²¡æœ‰ï¼Œæ‰€ä»¥å¾€è¿”è€Œæ¥å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹åœ¨å–</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230802145837448.png" alt="image-20230802145837448"></p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠç¡çœ å»æ‰å†æ¥çœ‹</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span>* <span class="title">CALLBACK_sell</span><span class="params">(<span class="type">void</span>* arg)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸´ç•ŒåŒº</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// åŠ é”</span></span><br><span class="line">        <span class="built_in">pthread_mutex_lock</span>(&amp;mutex);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (tickets &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// usleep(5000);</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;pthread tid %ld is selling ticket %d\n&quot;</span>, <span class="built_in">pthread_self</span>(), tickets);</span><br><span class="line">            --tickets;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å–å®Œäº†</span></span><br><span class="line">            <span class="built_in">pthread_mutex_unlock</span>(&amp;mutex);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è§£é”</span></span><br><span class="line">        <span class="built_in">pthread_mutex_unlock</span>(&amp;mutex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ‰§è¡Œç»“æœä¸ºï¼š</p><p>å¯ä»¥çœ‹å‡ºçš„ç¡®çº¿ç¨‹æ˜¯äº¤æ›¿æ¥å–ç¥¨çš„ï¼Œåªä¸è¿‡æ—¶é—´ç‰‡å®Œäº†è¢«å…¶ä»–çº¿ç¨‹è¿›è¡ŒæŠ¢å ï¼Œç„¶åäº¤æ›¿å–ç¥¨</p><p>å¹¶ä¸”ç”±äºæˆ‘ä»¬çš„è®¾è®¡æ˜¯while(1)æ­»å¾ªç¯ï¼Œè·³å‡ºçš„ç‚¹æ˜¯ç¥¨å–å®Œäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„çº¿ç¨‹å¯ä»¥è¿›è¡Œç¬¬äºŒè½®çš„å–ç¥¨ï¼Œè€Œä¸æ˜¯å–äº†ä¸€è½®å°±ç»“æŸ</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230802150151733.png" alt="image-20230802150151733" style="zoom:67%"> <img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230802150219200.png" alt="image-20230802150219200" style="zoom:67%"><h3 id="æ­»é”"><a href="#æ­»é”" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ­»é”"></a> æ­»é”</h3><p>æ­»é”å¯èƒ½äº§ç”Ÿçš„å‡ ç§åœºæ™¯ï¼š</p><ul><li><strong>å¿˜è®°é‡Šæ”¾é”</strong></li><li><strong>é‡å¤åŠ é”</strong></li><li><strong>å¤šçº¿ç¨‹å¤šé”ï¼ŒæŠ¢å é”èµ„æº</strong></li></ul><p>æ­»é”äº§ç”Ÿçš„å››ä¸ªå¿…è¦æ¡ä»¶(ç¼ºä¸€ä¸å¯):</p><ul><li><strong>äº’æ–¥</strong></li><li><strong>éå‰¥å¤º</strong></li><li><strong>è¯·æ±‚å’Œä¿æŒ</strong></li><li><strong>ç¯è·¯ç­‰å¾…</strong></li></ul><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230803135330646.png" alt="image-20230803135330646"></p><p>æˆ‘ä»¬æ¥çœ‹æ­»é”äº§ç”Ÿçš„å‡ ç§æƒ…æ™¯ï¼š</p><ul><li><p>å¿˜è®°é‡Šæ”¾é”ï¼šå¾ˆæ˜¾ç„¶ï¼Œä¸€ä¸ªçº¿ç¨‹è®¿é—®ä¸´ç•ŒåŒºçš„æ—¶å€™åŠ ä¸Šé”ï¼Œè®¿é—®å®Œæ¯•èµ°çš„æ—¶å€™å¿˜äº†è§£é”ï¼Œè¿™æ ·å…¶ä»–çš„çº¿ç¨‹æ²¡åŠæ³•åŠ é”ï¼Œæ›´æ²¡åŠæ³•è®¿é—®äº†ï¼Œè‡ªå·±ç¬¬äºŒæ¬¡è¿‡æ¥æƒ³ç»§ç»­åŠ é”è®¿é—®ä¹Ÿæ˜¯ä¸å¯ä»¥çš„ï¼Œå› ä¸ºä¸Šä¸€æŠŠé”è¿˜æ²¡è§£å¼€</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span>* <span class="title">CALLBACK_sell</span><span class="params">(<span class="type">void</span>* arg)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸´ç•ŒåŒº</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// åŠ é”</span></span><br><span class="line">        <span class="built_in">pthread_mutex_lock</span>(&amp;mutex);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (tickets &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// usleep(5000);</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;pthread tid %ld is selling ticket %d\n&quot;</span>, <span class="built_in">pthread_self</span>(), tickets);</span><br><span class="line">            --tickets;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å–å®Œäº†</span></span><br><span class="line">            <span class="built_in">pthread_mutex_unlock</span>(&amp;mutex);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è§£é”</span></span><br><span class="line">        <span class="comment">// pthread_mutex_unlock(&amp;mutex);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230803143045431.png" alt="image-20230803143045431"></p></li><li><p>é‡å¤åŠ ç›¸åŒçš„é”ï¼šè®¾æƒ³ä¸€ä¸ªæˆ‘ä»¬å†™ä»£ç çš„æ—¶å€™åº”è¯¥ä¸ä¼šçŠ¯çš„é”™è¯¯ï¼Œå°±æ˜¯åœ¨æˆ‘è¦åŠ é”çš„æ—¶å€™ï¼Œæˆ‘åŠ äº†ä¸¤æ¬¡ï¼Œç¬¬ä¸€æŠŠé”èƒ½å¤ŸåŠ ä¸Šï¼Œä½†æ˜¯ç¬¬äºŒæŠŠæ˜¯åŠ ä¸ä¸Šçš„ï¼Œå› ä¸ºç¬¬ä¸€æŠŠé”è¿˜æ²¡åŠ å¼€ï¼Œæ‰€ä»¥è‡ªå·±æ²¡åŠæ³•è®¿é—®ï¼Œæ˜¾ç„¶å…¶ä»–çš„çº¿ç¨‹æ›´æ²¡åŠæ³•è®¿é—®äº†ï¼›ä½†æ˜¯æˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šçŠ¯è¿™ä¹ˆå‚»çš„é”™è¯¯ï¼Œæˆ‘ä»¬å¯èƒ½åŠ äº†é”ä¹‹åå»è°ƒç”¨å…¶ä»–çš„å‡½æ•°ï¼Œç„¶åå…¶ä»–çš„å‡½æ•°å½“ä¸­å­˜åœ¨åŠ é”ï¼Œè¿™æ ·æ˜¾ç„¶å°±å‡ºç°äº†ä¸Šé¢çš„æƒ…å†µï¼Œç„¶è€Œè¿™æ ·çš„è¯æˆ‘ä»¬ä¸æ˜“å¯Ÿè§‰</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span>* <span class="title">CALLBACK_sell</span><span class="params">(<span class="type">void</span>* arg)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸´ç•ŒåŒº</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// åŠ é”</span></span><br><span class="line">        <span class="comment">// è¿™é‡Œå¯¹åŒä¸€æŠŠé”åŠ äº†ä¸¤æ¬¡</span></span><br><span class="line">        <span class="built_in">pthread_mutex_lock</span>(&amp;mutex);</span><br><span class="line">        <span class="built_in">pthread_mutex_lock</span>(&amp;mutex);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (tickets &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// usleep(5000);</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;pthread tid %ld is selling ticket %d\n&quot;</span>, <span class="built_in">pthread_self</span>(), tickets);</span><br><span class="line">            --tickets;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å–å®Œäº†</span></span><br><span class="line">            <span class="built_in">pthread_mutex_unlock</span>(&amp;mutex);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è§£é”</span></span><br><span class="line">        <span class="built_in">pthread_mutex_unlock</span>(&amp;mutex);</span><br><span class="line">        <span class="built_in">pthread_mutex_unlock</span>(&amp;mutex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230803143334595.png" alt="image-20230803143334595"></p></li><li><p>å¤šçº¿ç¨‹å¤šé”ï¼ŒæŠ¢å é”èµ„æºï¼šçœ‹å›¾ä¸­ï¼Œçº¿ç¨‹Aå’Œçº¿ç¨‹Båˆ†åˆ«ç»™èµ„æº1å’Œèµ„æº2åŠ é”ï¼Œä½†æ˜¯çº¿ç¨‹çš„æ‰§è¡Œä¾èµ–äºè¿™ä¸¤ä¸ªèµ„æºçš„å…±åŒè®¿é—®ï¼Œæ‰€ä»¥è°éƒ½æ²¡åŠæ³•è¿›è¡Œï¼Œè¿™å°±å¯¼è‡´äº†ç¯è·¯ç­‰å¾…ï¼Œäº§ç”Ÿäº†æ­»é”</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š</p><p>å‡è®¾æˆ‘ä»¬è¿™é‡Œçš„ä»£ç ä¸ç¡1ç§’ï¼Œé‚£ä¹ˆçº¿ç¨‹ä¼šå…ˆåæ‰§è¡Œï¼Œå› ä¸ºçº¿ç¨‹æ‰§è¡Œçš„æ—¶é—´å¤ªçŸ­äº†ï¼Œå¯¼è‡´åœ¨æ—¶é—´ç‰‡å†…å°±å®Œæˆäº†ï¼Œè¿™æ ·å…¶ä»–çº¿ç¨‹æ²¡æœ‰æŠ¢å ç„¶åå»åŠ é”çš„è¿‡ç¨‹ï¼Œå› æ­¤è¿™ç§æƒ…å†µæ˜¯ä¸ä¼šäº§ç”Ÿæ­»é”çš„</p><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬æ­»å¾ªç¯çš„å»æ‰§è¡Œï¼Œå°±æœ‰å¯èƒ½äº§ç”Ÿæ­»é”ï¼Œæ­»å¾ªç¯æ‰§è¡Œï¼Œæ—¶é—´ç‰‡å®Œäº†æˆ‘ä»¬ä¹Ÿä¸çŸ¥é“çº¿ç¨‹æ‰§è¡Œåˆ°å“ªä¸€æ­¥ï¼Œç„¶åè¢«æŠ¢å äº†ä¸‡ä¸€åˆšå¥½ç»™ç¬¬ä¸€ä¸ªåŠ é”ï¼Œå¦å¤–ä¸€ä¸ªä¹Ÿç»™ç¬¬ä¸€ä¸ªåŠ é”ï¼Œè¿™ä¸å°±æ­»é”äº†å˜›</p><p>è¿™é‡Œæˆ‘åœ¨åŠ é”äº†ä¹‹åç¡1ç§’ï¼Œæˆ‘è®©ç¬¬äºŒä¸ªçº¿ç¨‹å»æŠ¢å åŠ é”ï¼Œè®©ä»–æˆä¸ºæ­»é”ï¼Œä»æ‰§è¡Œç»“æœæ¥çœ‹å¿…ç„¶æ˜¯æ­»é”</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">pthread_mutex_t</span> mutex1, mutex2;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">CALLBACK_A</span><span class="params">(<span class="type">void</span>* arg)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">pthread_mutex_lock</span>(&amp;mutex1);</span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">1</span>);  <span class="comment">// è¿™é‡Œç¡ä¸€ç§’ï¼Œè®©çº¿ç¨‹Bå¾—åˆ°æŠ¢å æƒ</span></span><br><span class="line">    <span class="built_in">pthread_mutex_lock</span>(&amp;mutex2);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;thread A , tid : %ld is working.\n&quot;</span>, <span class="built_in">pthread_self</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡Šæ”¾é”çš„æ—¶å€™æœ€å¥½åç€æ¥ï¼Œå› ä¸ºåŠ é”æ˜¯æœ‰é¡ºåºçš„</span></span><br><span class="line">    <span class="built_in">pthread_mutex_unlock</span>(&amp;mutex2);</span><br><span class="line">    <span class="built_in">pthread_mutex_unlock</span>(&amp;mutex1);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">CALLBACK_B</span><span class="params">(<span class="type">void</span>* arg)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">pthread_mutex_lock</span>(&amp;mutex2);</span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">1</span>);  <span class="comment">// è¿™é‡Œç¡ä¸€ç§’ï¼Œè®©çº¿ç¨‹Aå¾—åˆ°æŠ¢å æƒ</span></span><br><span class="line">    <span class="built_in">pthread_mutex_lock</span>(&amp;mutex1);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;thread B , tid : %ld is working.\n&quot;</span>, <span class="built_in">pthread_self</span>());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">pthread_mutex_unlock</span>(&amp;mutex1);</span><br><span class="line">    <span class="built_in">pthread_mutex_unlock</span>(&amp;mutex2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–äº’æ–¥ä¿¡å·é‡</span></span><br><span class="line">    <span class="built_in">pthread_mutex_init</span>(&amp;mutex1, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">pthread_mutex_init</span>(&amp;mutex2, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">pthread_t</span> tid1, tid2;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºå­çº¿ç¨‹</span></span><br><span class="line">    <span class="built_in">pthread_create</span>(&amp;tid1, <span class="literal">nullptr</span>, &amp;CALLBACK_A, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">pthread_create</span>(&amp;tid2, <span class="literal">nullptr</span>, &amp;CALLBACK_B, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å›æ”¶å­çº¿ç¨‹</span></span><br><span class="line">    <span class="built_in">pthread_join</span>(tid1, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">pthread_join</span>(tid2, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡Šæ”¾ä¿¡å·é‡</span></span><br><span class="line">    <span class="built_in">pthread_mutex_destroy</span>(&amp;mutex1);</span><br><span class="line">    <span class="built_in">pthread_mutex_destroy</span>(&amp;mutex2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230803151736722.png" alt="image-20230803151736722"></p></li></ul><h3 id="è¯»å†™é”"><a href="#è¯»å†™é”" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è¯»å†™é”"></a> è¯»å†™é”</h3><p>åœ¨å®é™…çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨è¯»å’Œå†™çš„ä¸¤ç§æƒ…å†µï¼Œæˆ‘ä»¬å‘ç°å¦‚æœè¯»å†™éƒ½æ˜¯ç‹¬å åŠ é”çš„è¯ï¼Œè¯»æ˜¯å¯ä»¥å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œçš„å‘€ï¼Œå› ä¸ºæ²¡æœ‰ä¿®æ”¹æ•°æ®çš„å¤§å°ï¼Œæ‰€ä»¥åŠ é”å°±é€ æˆäº†èµ„æºå’Œæ•ˆç‡ä¸Šçš„æµªè´¹ï¼›æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®©å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è¯»æ•°æ®ï¼Œç„¶åå†™æ•°æ®éœ€è¦åŠ äº’æ–¥é”ï¼Œåªèƒ½ä¸€ä¸ªçº¿ç¨‹å†™æ•°æ®ï¼Œå¹¶ä¸”åœ¨å†™çš„æ—¶å€™å…¶ä»–çº¿ç¨‹ä¸èƒ½è¯»æ•°æ®</p><p>ç‰¹ç‚¹ï¼š</p><ul><li><strong>å¦‚æœæœ‰çº¿ç¨‹åœ¨è¯»æ•°æ®ï¼Œå…¶ä»–çº¿ç¨‹åªå…è®¸è¯»æ•°æ®è€Œä¸å…è®¸å†™æ•°æ®</strong></li><li><strong>å¦‚æœæœ‰çº¿ç¨‹åœ¨å†™æ•°æ®ï¼Œå…¶ä»–çº¿ç¨‹éƒ½ä¸å…è®¸è¿›è¡Œè¯»å†™æ“ä½œ</strong></li><li><strong>å†™æ•°æ®æ˜¯ç‹¬å çš„ï¼Œä»–çš„ä¼˜å…ˆçº§æ›´é«˜</strong></li></ul><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230804134719753.png" alt="image-20230804134719753"></p><h4 id="ç›¸å…³å‡½æ•°-6"><a href="#ç›¸å…³å‡½æ•°-6" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç›¸å…³å‡½æ•°-6"></a> ç›¸å…³å‡½æ•°</h4><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230816104436489.png" alt="image-20230816104436489"></p><p>ç¤ºä¾‹ä»£ç ï¼š(8ä¸ªçº¿ç¨‹ï¼Œ3ä¸ªå†™çº¿ç¨‹ï¼Œ5ä¸ªè¯»çº¿ç¨‹)</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    è¯»å†™é”çš„ç±»å‹ pthread_rwlock_t</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    int pthread_rwlock_init(pthread_rwlock_t *restrict rwlock, const pthread_rwlockattr_t *restrict attr);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    int pthread_rwlock_destroy(pthread_rwlock_t *rwlock);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    int pthread_rwlock_rdlock(pthread_rwlock_t *rwlock);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    int pthread_rwlock_tryrdlock(pthread_rwlock_t *rwlock);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    int pthread_rwlock_wrlock(pthread_rwlock_t *rwlock);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    int pthread_rwlock_trywrlock(pthread_rwlock_t *rwlock);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    int pthread_rwlock_unlock(pthread_rwlock_t *rwlock);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰å…¨å±€å˜é‡</span></span><br><span class="line"><span class="type">int</span> num = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰è¯»å†™äº’æ–¥é‡</span></span><br><span class="line"><span class="type">pthread_rwlock_t</span> _rwlock;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">WRITE_CALLBACK</span><span class="params">(<span class="type">void</span>* arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">pthread_rwlock_wrlock</span>(&amp;_rwlock);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;++write, tid : %ld , num : %d\n&quot;</span>, <span class="built_in">pthread_self</span>(), ++num);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">pthread_rwlock_unlock</span>(&amp;_rwlock); <span class="comment">//è¿™è¡Œä»£ç è¦åœ¨usleepä¸Šé¢ï¼Œå› ä¸ºéœ€è¦ç¡çœ è®©å…¶ä»–çº¿ç¨‹è¿›è¡ŒæŠ¢å ï¼Œå¦‚æœåœ¨ä¸‹é¢å°±ä¸å¥½è¯´äº†</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">usleep</span>(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">READ_CALLBACK</span><span class="params">(<span class="type">void</span>* arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">pthread_rwlock_rdlock</span>(&amp;_rwlock);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;===read, tid : %ld , num : %d\n&quot;</span>, <span class="built_in">pthread_self</span>(), num);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">pthread_rwlock_unlock</span>(&amp;_rwlock);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">usleep</span>(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¡ˆä¾‹ï¼šåˆ›å»º8ä¸ªçº¿ç¨‹ï¼Œæ“ä½œåŒä¸€ä¸ªå…¨å±€å˜é‡</span></span><br><span class="line"><span class="comment">// 3ä¸ªçº¿ç¨‹ä¸å®šæ—¶çš„å†™ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œ5ä¸ªçº¿ç¨‹ä¸å®šæ—¶çš„è¯»è¿™ä¸ªå…¨å±€å˜é‡</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–è¯»å†™äº’æ–¥é‡</span></span><br><span class="line">    <span class="built_in">pthread_rwlock_init</span>(&amp;_rwlock, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»º3ä¸ªå†™çº¿ç¨‹ï¼Œ5ä¸ªè¯»çº¿ç¨‹</span></span><br><span class="line">    <span class="type">pthread_t</span> wr_tids[<span class="number">3</span>], rd_tids[<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++i)</span><br><span class="line">        <span class="built_in">pthread_create</span>(&amp;wr_tids[i], <span class="literal">nullptr</span>, WRITE_CALLBACK, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i)</span><br><span class="line">        <span class="built_in">pthread_create</span>(&amp;rd_tids[i], <span class="literal">nullptr</span>, READ_CALLBACK, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ†ç¦»çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++i)</span><br><span class="line">        <span class="built_in">pthread_detach</span>(wr_tids[i]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i)</span><br><span class="line">        <span class="built_in">pthread_detach</span>(rd_tids[i]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€€å‡ºä¸»çº¿ç¨‹</span></span><br><span class="line">    <span class="built_in">pthread_exit</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡Šæ”¾è¯»å†™äº’æ–¥é‡</span></span><br><span class="line">    <span class="built_in">pthread_rwlock_destroy</span>(&amp;_rwlock);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ‰§è¡Œç»“æœï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230816112647486.png" alt="image-20230816112647486"></p><h3 id="ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹"><a href="#ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹"></a> ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230816150325060.png" alt="image-20230816150325060"></p><p>æˆ‘ä»¬ç°åœ¨ç”¨ä¸€ä¸ªç®€é™‹çš„å®ç°æ¥æ¨¡æ‹Ÿè¿™ä¸ªè¿‡ç¨‹</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹(ç²—ç•¥çš„ç‰ˆæœ¬)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªé“¾è¡¨</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Node</span>* next;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰å¤´ç»“ç‚¹</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>* head = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">PRO_CALLBACK</span><span class="params">(<span class="type">void</span>*)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸æ–­ç”Ÿæˆæ–°èŠ‚ç‚¹ï¼Œæ’å…¥åˆ°é“¾è¡¨å½“ä¸­(å¤´æ’)</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">Node</span>* newNode = <span class="keyword">new</span> <span class="keyword">struct</span> Node;</span><br><span class="line">        newNode-&gt;next = head;</span><br><span class="line">        head = newNode;</span><br><span class="line"></span><br><span class="line">        newNode-&gt;val = <span class="built_in">rand</span>() % <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;add node , val : %d , tid : %ld\n&quot;</span>, newNode-&gt;val, <span class="built_in">pthread_self</span>());</span><br><span class="line"></span><br><span class="line">        <span class="built_in">usleep</span>(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">CUS_CALLBACK</span><span class="params">(<span class="type">void</span>*)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸æ–­ä»å¤´éƒ¨é‡Šæ”¾å¤´ç»“ç‚¹</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">Node</span>* tmp = head;</span><br><span class="line">        head = head-&gt;next;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;delete node , val : %d , tid : %ld\n&quot;</span>, tmp-&gt;val, <span class="built_in">pthread_self</span>());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">delete</span> tmp;</span><br><span class="line">        tmp = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">usleep</span>(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»º5ä¸ªç”Ÿäº§è€…çº¿ç¨‹ï¼Œå’Œ5ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹</span></span><br><span class="line">    <span class="type">pthread_t</span> ptids[<span class="number">5</span>], ctids[<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i) &#123;</span><br><span class="line">        <span class="built_in">pthread_create</span>(&amp;ptids[i], <span class="literal">nullptr</span>, PRO_CALLBACK, <span class="literal">nullptr</span>);</span><br><span class="line">        <span class="built_in">pthread_create</span>(&amp;ctids[i], <span class="literal">nullptr</span>, CUS_CALLBACK, <span class="literal">nullptr</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çº¿ç¨‹åˆ†ç¦»</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i) &#123;</span><br><span class="line">        <span class="built_in">pthread_detach</span>(ptids[i]);</span><br><span class="line">        <span class="built_in">pthread_detach</span>(ctids[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çº¿ç¨‹é€€å‡º</span></span><br><span class="line">    <span class="built_in">pthread_exit</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è¿™ä¸ªç¨‹åºæ²¡æœ‰å¯¹å¤šçº¿ç¨‹è¿›è¡Œæ•°æ®å¤„ç†çš„åŒæ­¥æ“ä½œï¼Œä¼šå¯¼è‡´ä¸€ç³»åˆ—é—®é¢˜ï¼Œæ¯”å¦‚é“¾è¡¨æ²¡æœ‰æ•°æ®å°±è¿›è¡Œé‡Šæ”¾ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´å†…å­˜çš„è®¿é—®é”™è¯¯ï¼Œä¹Ÿå°±æ˜¯ä¼šæŠ¥æ®µé”™è¯¯ï¼Œå¤šæ¬¡æ‰§è¡Œï¼Œæ¯æ¬¡æ‰§è¡Œçš„ç»“æœå¯èƒ½éƒ½æ˜¯ä¸ä¸€æ ·çš„</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817102529078.png" alt="image-20230817102529078"></p><h4 id="è‡ªå·±çš„æ€è·¯"><a href="#è‡ªå·±çš„æ€è·¯" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#è‡ªå·±çš„æ€è·¯"></a> è‡ªå·±çš„æ€è·¯</h4><p>æˆ‘ä»¬è‡ªå·±å…ˆå°è¯•ç€è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªæ˜¯æ•°æ®ä¸åŒæ­¥çš„é—®é¢˜ï¼Œä¸€ä¸ªæ˜¯éæ³•è®¿é—®å†…å­˜å¯¼è‡´æ®µé”™è¯¯çš„é—®é¢˜ï¼Œæˆ‘ä»¬çš„ä»£ç å¦‚ä¸‹ï¼š</p><ul><li><strong>æ•°æ®åŒæ­¥ï¼šç”±äºæˆ‘ä»¬åœ¨ç”Ÿäº§å’Œæ¶ˆè´¹çš„æ—¶å€™éƒ½æ˜¯å¤„ç†çš„æ˜¯å¤´ç»“ç‚¹ï¼Œè¿™ä¸€å—åŒºåŸŸå°±æ˜¯ä¸´ç•ŒåŒºï¼Œæˆ‘ä»¬å¯ä»¥ç»™è¿™ä¸ªåŒºåŸŸåŠ ä¸Šäº’æ–¥é”ï¼Œä¹Ÿå°±æ˜¯å®šä¹‰pthread_mutex_tç±»å‹äº’æ–¥é”æ¥å¤„ç†</strong></li><li><strong>æ®µé”™è¯¯ï¼Œè¿™ä¸ªé—®é¢˜çš„å‡ºç°åœ¨äºæˆ‘ä»¬åœ¨é“¾è¡¨ä¸ºç©ºçš„æ—¶å€™è¿›è¡Œäº†æ¶ˆè´¹è€…è¡Œä¸ºï¼Œç§»å‡ºæ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™ä¼šå¯¼è‡´å†…å­˜çš„éæ³•è®¿é—®ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åŠ ä¸Šä¸€ä¸ªæ¡ä»¶åˆ¤æ–­ï¼Œå½“æ²¡æœ‰æ•°æ®çš„æ—¶å€™å°±å¾ªç¯ç›´åˆ°æœ‰æ•°æ®</strong><br><strong>ä½†æ˜¯è¿™ä¹ˆåšçš„åå¤„å°±æ˜¯å¦‚æœæ¶ˆè´¹è€…çº¿ç¨‹ä¸€ç›´æ‹¿åˆ°CPUæ‰§è¡Œä¸€ç›´æ²¡æœ‰æ•°æ®ï¼Œé‚£å°±ä¸€ç›´ç©ºè½¬ç­‰å¾…ï¼Œä¼šæ¶ˆè€—æ€§èƒ½å’Œé™ä½æ•ˆç‡ï¼Œæˆ‘ä»¬å¸Œæœ›æ¶ˆè´¹è€…åœ¨æ²¡æœ‰æ•°æ®çš„æ—¶å€™èƒ½å¤Ÿé¢˜å‹ç”Ÿäº§è€…å»ç”Ÿäº§æ•°æ®ï¼Œè€Œç”Ÿäº§è€…ç›¸åçš„å¯ä»¥åœ¨æ»¡äº†çš„æ—¶å€™æé†’æ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ®ï¼Œå½“ç„¶æˆ‘ä»¬è¿™ä¸ªè®¾è®¡é“¾è¡¨å¯ä»¥æ— é™å»¶ç”³ï¼Œè¿™é‡Œä¸éœ€è¦è€ƒè™‘ï¼Œè¿™æ‰æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæ‰€ä»¥ä¸‹é¢å°±æœ‰æ¡ä»¶å˜é‡å’Œä¿¡å·é‡ä¸¤ç§æ“ä½œ</strong></li></ul><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹(ç²—ç•¥çš„ç‰ˆæœ¬)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºäº’æ–¥é‡æ¥è§£å†³æ•°æ®åŒæ­¥çš„é—®é¢˜</span></span><br><span class="line"><span class="type">pthread_mutex_t</span> mutex;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªé“¾è¡¨</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Node</span>* next;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰å¤´ç»“ç‚¹</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>* head = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">PRO_CALLBACK</span><span class="params">(<span class="type">void</span>*)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸æ–­ç”Ÿæˆæ–°èŠ‚ç‚¹ï¼Œæ’å…¥åˆ°é“¾è¡¨å½“ä¸­(å¤´æ’)</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">pthread_mutex_lock</span>(&amp;mutex);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">Node</span>* newNode = <span class="keyword">new</span> <span class="keyword">struct</span> Node;</span><br><span class="line">        newNode-&gt;next = head;</span><br><span class="line">        head = newNode;</span><br><span class="line"></span><br><span class="line">        newNode-&gt;val = <span class="built_in">rand</span>() % <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;add node , val : %d , tid : %ld\n&quot;</span>, newNode-&gt;val, <span class="built_in">pthread_self</span>());</span><br><span class="line"></span><br><span class="line">        <span class="built_in">pthread_mutex_unlock</span>(&amp;mutex);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">usleep</span>(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">CUS_CALLBACK</span><span class="params">(<span class="type">void</span>*)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸æ–­ä»å¤´éƒ¨é‡Šæ”¾å¤´ç»“ç‚¹</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">pthread_mutex_lock</span>(&amp;mutex);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">Node</span>* tmp = head;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿™é‡Œå¦‚æœæ²¡æœ‰æ•°æ®headå°±ä¸ºnullptrå°±ä¼šæŠ¥é”™è¿™ä¸€è¡Œï¼Œéæ³•è®¿é—®å†…å­˜</span></span><br><span class="line">        <span class="comment">// éœ€è¦è¿›è¡Œåˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            <span class="keyword">delete</span> tmp;</span><br><span class="line">            tmp = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">pthread_mutex_unlock</span>(&amp;mutex);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">usleep</span>(<span class="number">1000</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        head = head-&gt;next;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;delete node , val : %d , tid : %ld\n&quot;</span>, tmp-&gt;val, <span class="built_in">pthread_self</span>());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">delete</span> tmp;</span><br><span class="line">        tmp = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">pthread_mutex_unlock</span>(&amp;mutex);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">usleep</span>(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–äº’æ–¥é”</span></span><br><span class="line">    <span class="built_in">pthread_mutex_init</span>(&amp;mutex, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»º5ä¸ªç”Ÿäº§è€…çº¿ç¨‹ï¼Œå’Œ5ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹</span></span><br><span class="line">    <span class="type">pthread_t</span> ptids[<span class="number">5</span>], ctids[<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i) &#123;</span><br><span class="line">        <span class="built_in">pthread_create</span>(&amp;ptids[i], <span class="literal">nullptr</span>, PRO_CALLBACK, <span class="literal">nullptr</span>);</span><br><span class="line">        <span class="built_in">pthread_create</span>(&amp;ctids[i], <span class="literal">nullptr</span>, CUS_CALLBACK, <span class="literal">nullptr</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å›æ”¶çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i) &#123;</span><br><span class="line">        <span class="built_in">pthread_detach</span>(ptids[i]);</span><br><span class="line">        <span class="built_in">pthread_detach</span>(ctids[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨æ­»å¾ªç¯æ¥ä¿è¯ä¸»çº¿ç¨‹ä¸ä¼šç»“æŸï¼Œå¦‚æœç”¨ pthread_exit() ä¼šå¯¼è‡´äº’æ–¥é”é‡Šæ”¾çš„ä½ç½®é—®é¢˜</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡Šæ”¾äº’æ–¥é”</span></span><br><span class="line">    <span class="built_in">pthread_mutex_destroy</span>(&amp;mutex);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸»çº¿ç¨‹é€€å‡º(è¿™é‡Œå…¶å®æ²¡ä»€ä¹ˆç”¨äº†)</span></span><br><span class="line">    <span class="built_in">pthread_exit</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h4 id="æ¡ä»¶å˜é‡"><a href="#æ¡ä»¶å˜é‡" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ¡ä»¶å˜é‡"></a> æ¡ä»¶å˜é‡</h4><p><strong>æ¡ä»¶å˜é‡å¯ä»¥æœ‰ä¸¤ä¸ªè¡Œä¸ºï¼Œæ»¡è¶³æŸä¸ªæ¡ä»¶çº¿ç¨‹é˜»å¡ï¼Œæˆ–è€…æ»¡è¶³æ¡ä»¶çº¿ç¨‹è§£é™¤é˜»å¡</strong></p><p><strong>ä»–ä¸èƒ½ä¿è¯æ•°æ®æ··ä¹±çš„é—®é¢˜ï¼Œæ•°æ®æ··ä¹±éœ€è¦åŠ äº’æ–¥é”ï¼Œéœ€è¦ä½¿ç”¨ pthread_mutex_t ç±»å‹çš„äº’æ–¥é”è§£å†³</strong></p><p><strong>æˆ‘ä»¬å‘ç°é˜»å¡å’Œè§£é™¤é˜»å¡ï¼Œè¿˜è¦æ»¡è¶³æŸä¸ªæ¡ä»¶ï¼Œè¿™ä¸å°±æ˜¯æˆ‘æƒ³è¦çš„å˜›ï¼Ÿæ‰€ä»¥headä¸ºç©ºå°±é˜»å¡ï¼Œheadä¸ä¸ºç©ºå°±è§£é™¤é˜»å¡ï¼Œè¿™å°±æ˜¯åŸºæœ¬çš„æ€è·¯</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817104711611.png" alt="image-20230817104711611"></p><p>å°†æˆ‘ä»¬çš„ä»£ç è¿›è¡Œæ”¹è¿›ï¼š</p><p><strong>å…¶å®å°±æ”¹äº†ä¸¤ä¸ªåœ°æ–¹ï¼Œå°±æ˜¯ç”Ÿäº§è€…ç”Ÿäº§äº†ä¹‹åçš„åŠ¨ä½œå’Œæ¶ˆè´¹è€…æ²¡æœ‰æ•°æ®æ—¶å€™çš„å¤„ç†</strong></p><ul><li><strong>ç”Ÿäº§è€…ï¼šç”Ÿäº§è€…åœ¨ç”Ÿäº§äº†æ•°æ®ä¹‹åä¼šè°ƒç”¨æ¡ä»¶å˜é‡çš„ä¿¡å·å‡½æ•° pthread_cond_signal() å‡½æ•°æ¥æé†’æ¶ˆè´¹è€…æœ‰æ•°æ®äº†ï¼Œè‡³äºæ˜¯æ€ä¹ˆæé†’çš„å‘¢ï¼Ÿè¿™å°±ä¾èµ–äºæ¶ˆè´¹è€…é‡Œé¢çš„å‡½æ•° pthread_cond_wait()</strong></li><li><strong>æ¶ˆè´¹è€…ï¼šè°ƒç”¨é˜»å¡å‡½æ•° pthread_cond_wait() è¿›è¡Œé˜»å¡ç­‰å¾…(æ²¡æœ‰æ•°æ®çš„æ—¶å€™)ï¼Œç„¶åå½“æœ‰æ•°æ®çš„æ—¶å€™å°±è§£é™¤é˜»å¡</strong><br><strong>è¿™é‡Œä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆ pthread_cond_wait() å‡½æ•°ä¸­ä¼šéœ€è¦ä¼ å…¥mutexäº’æ–¥é”çš„ä¿¡æ¯å‘¢ï¼Ÿ</strong><br><strong>è‚¯å®šæ˜¯æ“ä½œäº†äº’æ–¥é”ï¼Œæˆ‘ä»¬æ¥çœ‹ï¼Œå‡è®¾ä¸æ“ä½œï¼Œé‚£ä¹ˆæˆ‘é˜»å¡ï¼Œç„¶åæˆ‘è¿˜æ‹¿ç€ä¸´ç•ŒåŒºçš„è®¿é—®äº’æ–¥é”ï¼Œé‚£ä¹ˆå°±å‡ºé—®é¢˜äº†ï¼Œå…¶ä»–çš„çº¿ç¨‹ä¸ç®¡æ˜¯æ¶ˆè´¹è€…è¿˜æ˜¯ç”Ÿäº§è€…éƒ½æ²¡æœ‰åŠæ³•æ‹¿åˆ°è¿™æŠŠé”ï¼Œé‚£ä¹ˆå°±è‚¯å®šä¼šå¯¼è‡´æ­»é”ï¼Œæ‰€ä»¥è‚¯å®šå¯¹è¿™ä¸ªé”è¿›è¡Œäº†å¤„ç†</strong><br><strong>å…¶å®ï¼Œå½“è°ƒç”¨é˜»å¡çš„æ—¶å€™ï¼Œä¼šé‡Šæ”¾æ‰è¿™æŠŠé”ï¼Œè®©å…¶ä»–çº¿ç¨‹è¿›è¡Œäº‰æŠ¢ï¼Œå½“ç”Ÿäº§è€…æ‹¿åˆ°é”ï¼Œç”Ÿäº§äº†æ•°æ®ï¼Œè°ƒç”¨pthread_cond_signal()å‡½æ•°å‘Šè¯‰æ¶ˆè´¹è€…å¯ä»¥è§£é™¤é˜»å¡äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±ä¼šè§£é™¤é˜»å¡å¹¶ä¸”é‡æ–°ç»™è¿™ä¸ªçº¿ç¨‹ä¸Šé”ï¼Œå› æ­¤è§£é™¤é˜»å¡çš„æ—¶å€™é”è¿˜åœ¨æˆ‘èº«ä¸Šï¼Œåˆšæ‰é˜»å¡çš„è¿‡ç¨‹ä¸­ä¸åœ¨äº†ï¼Œæ‰€ä»¥åé¢éœ€è¦è·Ÿä¸Šä¸€å¥é‡Šæ”¾è¿™ä¸ªé”ï¼Œå› ä¸ºæ ¹æ®æˆ‘ä»¬çš„é€»è¾‘ä¼šé‡æ–°å¾ªç¯æ‹¿é”ï¼Œæˆ‘ä»¬éœ€è¦é¿å…æ­»é”</strong></li></ul><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹(ç²—ç•¥çš„ç‰ˆæœ¬)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºäº’æ–¥é‡æ¥è§£å†³æ•°æ®åŒæ­¥çš„é—®é¢˜</span></span><br><span class="line"><span class="type">pthread_mutex_t</span> mutex;</span><br><span class="line"><span class="comment">// å®šä¹‰æ¡ä»¶å˜é‡</span></span><br><span class="line"><span class="type">pthread_cond_t</span> cond;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªé“¾è¡¨</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Node</span>* next;</span><br><span class="line">&#125;* head = <span class="literal">nullptr</span>;  <span class="comment">// å®šä¹‰å¤´ç»“ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">PRO_CALLBACK</span><span class="params">(<span class="type">void</span>* args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸æ–­ç”Ÿæˆæ–°èŠ‚ç‚¹ï¼Œæ’å…¥åˆ°é“¾è¡¨å½“ä¸­(å¤´æ’)</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">pthread_mutex_lock</span>(&amp;mutex);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">Node</span>* newNode = <span class="keyword">new</span> <span class="keyword">struct</span> Node;</span><br><span class="line">        newNode-&gt;next = head;</span><br><span class="line">        head = newNode;</span><br><span class="line"></span><br><span class="line">        newNode-&gt;val = <span class="built_in">rand</span>() % <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;add node , val : %d , tid : %ld\n&quot;</span>, newNode-&gt;val, <span class="built_in">pthread_self</span>());</span><br><span class="line"></span><br><span class="line">        <span class="built_in">pthread_mutex_unlock</span>(&amp;mutex);</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">pthread_cond_signal</span>(&amp;cond);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">usleep</span>(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">CUS_CALLBACK</span><span class="params">(<span class="type">void</span>* args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸æ–­ä»å¤´éƒ¨é‡Šæ”¾å¤´ç»“ç‚¹</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">pthread_mutex_lock</span>(&amp;mutex);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">Node</span>* tmp = head;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿™é‡Œå¦‚æœæ²¡æœ‰æ•°æ®headå°±ä¸ºnullptrå°±ä¼šæŠ¥é”™è¿™ä¸€è¡Œï¼Œéæ³•è®¿é—®å†…å­˜</span></span><br><span class="line">        <span class="comment">// éœ€è¦è¿›è¡Œåˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">if</span> (head != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            head = head-&gt;next;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;delete node , val : %d , tid : %ld\n&quot;</span>, tmp-&gt;val, <span class="built_in">pthread_self</span>());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">delete</span> tmp;</span><br><span class="line">            tmp = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">pthread_mutex_unlock</span>(&amp;mutex);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">usleep</span>(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// æ²¡æœ‰æ•°æ®ï¼Œéœ€è¦é˜»å¡ç­‰å¾…</span></span><br><span class="line">            <span class="comment">// å½“è¿™ä¸ªå‡½æ•°è°ƒç”¨é˜»å¡çš„æ—¶å€™ï¼Œä¼šè§£é”ï¼Œå½“ä¸é˜»å¡çš„æ—¶å€™ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œä¼šé‡æ–°åŠ é”</span></span><br><span class="line">            <span class="built_in">pthread_cond_wait</span>(&amp;cond, &amp;mutex);</span><br><span class="line">            <span class="comment">// å½“æœ‰æ•°æ®å”¤é†’ä¹‹åï¼Œæˆ‘ä»¬çš„ä»£ç é€»è¾‘æ˜¯é‡æ–°è¿›å…¥å¾ªç¯åŠ é”ï¼Œå› æ­¤å¿…é¡»æå‰é‡Šæ”¾é”</span></span><br><span class="line">            <span class="built_in">pthread_mutex_unlock</span>(&amp;mutex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–äº’æ–¥é”</span></span><br><span class="line">    <span class="built_in">pthread_mutex_init</span>(&amp;mutex, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æ¡ä»¶å˜é‡</span></span><br><span class="line">    <span class="built_in">pthread_cond_init</span>(&amp;cond, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»º5ä¸ªç”Ÿäº§è€…çº¿ç¨‹ï¼Œå’Œ5ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹</span></span><br><span class="line">    <span class="type">pthread_t</span> ptids[<span class="number">5</span>], ctids[<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i) &#123;</span><br><span class="line">        <span class="built_in">pthread_create</span>(&amp;ptids[i], <span class="literal">nullptr</span>, PRO_CALLBACK, <span class="literal">nullptr</span>);</span><br><span class="line">        <span class="built_in">pthread_create</span>(&amp;ctids[i], <span class="literal">nullptr</span>, CUS_CALLBACK, <span class="literal">nullptr</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å›æ”¶çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i) &#123;</span><br><span class="line">        <span class="built_in">pthread_detach</span>(ptids[i]);</span><br><span class="line">        <span class="built_in">pthread_detach</span>(ctids[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨æ­»å¾ªç¯æ¥ä¿è¯ä¸»çº¿ç¨‹ä¸ä¼šç»“æŸï¼Œå¦‚æœç”¨ pthread_exit() ä¼šå¯¼è‡´äº’æ–¥é”é‡Šæ”¾çš„ä½ç½®é—®é¢˜</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡Šæ”¾æ¡ä»¶å˜é‡</span></span><br><span class="line">    <span class="built_in">pthread_cond_destroy</span>(&amp;cond);</span><br><span class="line">    <span class="comment">// é‡Šæ”¾äº’æ–¥é”</span></span><br><span class="line">    <span class="built_in">pthread_mutex_destroy</span>(&amp;mutex);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸»çº¿ç¨‹é€€å‡º(è¿™é‡Œå…¶å®æ²¡ä»€ä¹ˆç”¨äº†)</span></span><br><span class="line">    <span class="built_in">pthread_exit</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h4 id="ä¿¡å·é‡"><a href="#ä¿¡å·é‡" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä¿¡å·é‡"></a> ä¿¡å·é‡</h4><p>çœ‹åˆ° sem_wait() å’Œ sem_post() å‡½æ•°å°±æƒ³åˆ°æ“ä½œç³»ç»Ÿä¸­å­¦åˆ°çš„PVé—®é¢˜äº†</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817114724983.png" alt="image-20230817114724983"></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;semaphore.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">sem_init</span><span class="params">(<span class="type">sem_t</span> *sem, <span class="type">int</span> pshared, <span class="type">unsigned</span> <span class="type">int</span> value)</span></span>;</span><br><span class="line"><span class="comment">//ä½œç”¨ï¼šåˆå§‹åŒ–ä¿¡å·é‡</span></span><br><span class="line"><span class="comment">//å‚æ•°ï¼š</span></span><br><span class="line">    <span class="comment">//semï¼šä¿¡å·é‡å˜é‡çš„åœ°å€</span></span><br><span class="line">    <span class="comment">//psharedï¼š0 ç”¨åœ¨çº¿ç¨‹ï¼› é0 ç”¨åœ¨è¿›ç¨‹</span></span><br><span class="line">    <span class="comment">//valueï¼šä¿¡å·é‡çš„å€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">sem_destroy</span><span class="params">(<span class="type">sem_t</span> *sem)</span></span>;</span><br><span class="line"><span class="comment">//ä½œç”¨ï¼šé‡Šæ”¾èµ„æº</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">sem_wait</span><span class="params">(<span class="type">sem_t</span> *sem)</span></span>;</span><br><span class="line"><span class="comment">//ä½œç”¨ï¼šå¯¹ä¿¡å·é‡åŠ é”ï¼Œè°ƒç”¨ä¸€æ¬¡ï¼Œå¯¹ä¿¡å·é‡çš„å€¼å‡1ï¼Œå¦‚æœå€¼ä¸º0ï¼Œå°±é˜»å¡</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">sem_trywait</span><span class="params">(<span class="type">sem_t</span> *sem)</span></span>;</span><br><span class="line"><span class="comment">//ä½œç”¨ï¼šå°è¯•wait</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">sem_timedwait</span><span class="params">(<span class="type">sem_t</span> *restrict sem, <span class="type">const</span> <span class="keyword">struct</span> timespec *restrict abs_timeout)</span></span>;</span><br><span class="line"><span class="comment">//ä½œç”¨ï¼šç­‰å¾…ä¸€æ®µæ—¶é—´</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">sem_post</span><span class="params">(<span class="type">sem_t</span> *sem)</span></span>;</span><br><span class="line"><span class="comment">//ä½œç”¨ï¼šè§£é”ä¸€ä¸ªä¿¡å·é‡ï¼Œè°ƒç”¨ä¸€æ¬¡ï¼Œå¯¹ä¿¡å·é‡çš„å€¼åŠ 1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">sem_getvalue</span><span class="params">(<span class="type">sem_t</span> *restrict sem, <span class="type">int</span> *restrict sval)</span></span>;</span><br><span class="line"><span class="comment">//ä½œç”¨ï¼šè·å–ä¿¡å·é‡çš„å€¼</span></span><br></pre></td></tr></table></div></figure><p>å®é™…ä»£ç ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;semaphore.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºäº’æ–¥é‡æ¥è§£å†³æ•°æ®åŒæ­¥çš„é—®é¢˜</span></span><br><span class="line"><span class="type">pthread_mutex_t</span> mutex;</span><br><span class="line"><span class="comment">// åˆ›å»ºä¸¤ä¸ªä¿¡å·é‡</span></span><br><span class="line"><span class="type">sem_t</span> psem, csem;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªé“¾è¡¨</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Node</span>* next;</span><br><span class="line">&#125;* head = <span class="literal">nullptr</span>;  <span class="comment">// å®šä¹‰å¤´ç»“ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">PRO_CALLBACK</span><span class="params">(<span class="type">void</span>* args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸æ–­ç”Ÿæˆæ–°èŠ‚ç‚¹ï¼Œæ’å…¥åˆ°é“¾è¡¨å½“ä¸­(å¤´æ’)</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">sem_wait</span>(&amp;psem);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">pthread_mutex_lock</span>(&amp;mutex);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">Node</span>* newNode = <span class="keyword">new</span> <span class="keyword">struct</span> Node;</span><br><span class="line">        newNode-&gt;next = head;</span><br><span class="line">        head = newNode;</span><br><span class="line"></span><br><span class="line">        newNode-&gt;val = <span class="built_in">rand</span>() % <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;add node , val : %d , tid : %ld\n&quot;</span>, newNode-&gt;val, <span class="built_in">pthread_self</span>());</span><br><span class="line"></span><br><span class="line">        <span class="built_in">pthread_mutex_unlock</span>(&amp;mutex);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">sem_post</span>(&amp;csem);  <span class="comment">// å°†æ¶ˆè´¹è€…çš„ä¿¡å·é‡åŠ 1è¡¨ç¤ºå¯ä»¥è¿›è¡Œæ¶ˆè´¹</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">usleep</span>(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">CUS_CALLBACK</span><span class="params">(<span class="type">void</span>* args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸æ–­ä»å¤´éƒ¨é‡Šæ”¾å¤´ç»“ç‚¹</span></span><br><span class="line">    <span class="comment">// è¿™å°±æ˜¯æ“ä½œç³»ç»Ÿå½“ä¸­å­¦çš„ç»å…¸çš„PVé—®é¢˜äº†ï¼Œå·©å›ºä¸€ä¸‹</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">sem_wait</span>(&amp;csem);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">pthread_mutex_lock</span>(&amp;mutex);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">Node</span>* tmp = head;</span><br><span class="line"></span><br><span class="line">        head = head-&gt;next;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;delete node , val : %d , tid : %ld\n&quot;</span>, tmp-&gt;val, <span class="built_in">pthread_self</span>());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">delete</span> tmp;</span><br><span class="line">        tmp = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">pthread_mutex_unlock</span>(&amp;mutex);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">sem_post</span>(&amp;psem);  <span class="comment">// å°†ç”Ÿäº§è€…çš„ä¿¡å·é‡åŠ 1è¡¨ç¤ºå¯ä»¥ç”Ÿäº§</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">usleep</span>(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–äº’æ–¥é”</span></span><br><span class="line">    <span class="built_in">pthread_mutex_init</span>(&amp;mutex, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–ä¿¡å·é‡</span></span><br><span class="line">    <span class="built_in">sem_init</span>(&amp;psem, <span class="number">0</span>, <span class="number">8</span>);</span><br><span class="line">    <span class="built_in">sem_init</span>(&amp;csem, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»º5ä¸ªç”Ÿäº§è€…çº¿ç¨‹ï¼Œå’Œ5ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹</span></span><br><span class="line">    <span class="type">pthread_t</span> ptids[<span class="number">5</span>],</span><br><span class="line">        ctids[<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i) &#123;</span><br><span class="line">        <span class="built_in">pthread_create</span>(&amp;ptids[i], <span class="literal">nullptr</span>, PRO_CALLBACK, <span class="literal">nullptr</span>);</span><br><span class="line">        <span class="built_in">pthread_create</span>(&amp;ctids[i], <span class="literal">nullptr</span>, CUS_CALLBACK, <span class="literal">nullptr</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å›æ”¶çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i) &#123;</span><br><span class="line">        <span class="built_in">pthread_detach</span>(ptids[i]);</span><br><span class="line">        <span class="built_in">pthread_detach</span>(ctids[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨æ­»å¾ªç¯æ¥ä¿è¯ä¸»çº¿ç¨‹ä¸ä¼šç»“æŸï¼Œå¦‚æœç”¨ pthread_exit() ä¼šå¯¼è‡´äº’æ–¥é”é‡Šæ”¾çš„ä½ç½®é—®é¢˜</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡Šæ”¾äº’æ–¥é”</span></span><br><span class="line">    <span class="built_in">pthread_mutex_destroy</span>(&amp;mutex);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸»çº¿ç¨‹é€€å‡º(è¿™é‡Œå…¶å®æ²¡ä»€ä¹ˆç”¨äº†)</span></span><br><span class="line">    <span class="built_in">pthread_exit</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h1 id="ç¬¬å››ç« -linuxç½‘ç»œç¼–ç¨‹"><a href="#ç¬¬å››ç« -linuxç½‘ç»œç¼–ç¨‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¬¬å››ç« -linuxç½‘ç»œç¼–ç¨‹"></a> ç¬¬å››ç«  Linuxç½‘ç»œç¼–ç¨‹</h1><h2 id="ç½‘ç»œç»“æ„æ¨¡å¼"><a href="#ç½‘ç»œç»“æ„æ¨¡å¼" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç½‘ç»œç»“æ„æ¨¡å¼"></a> ç½‘ç»œç»“æ„æ¨¡å¼</h2><h3 id="csç»“æ„"><a href="#csç»“æ„" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#csç»“æ„"></a> C/Sç»“æ„</h3><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç®€ä»‹"></a> ç®€ä»‹</h4><ul><li>æœåŠ¡å™¨ - å®¢æˆ·æœºï¼Œå³ Client - Serverï¼ˆC/Sï¼‰ç»“æ„ã€‚C/S ç»“æ„é€šå¸¸é‡‡å–ä¸¤å±‚ç»“æ„ã€‚æœåŠ¡å™¨è´Ÿè´£æ•°æ®çš„ ç®¡ç†ï¼Œå®¢æˆ·æœºè´Ÿè´£å®Œæˆä¸ç”¨æˆ·çš„äº¤äº’ä»»åŠ¡ã€‚å®¢æˆ·æœºæ˜¯å› ç‰¹ç½‘ä¸Šè®¿é—®åˆ«äººä¿¡æ¯çš„æœºå™¨ï¼ŒæœåŠ¡å™¨åˆ™æ˜¯æ ä¾›ä¿¡æ¯ä¾›äººè®¿é—®çš„è®¡ç®—æœºã€‚</li><li>å®¢æˆ·æœºé€šè¿‡å±€åŸŸç½‘ä¸æœåŠ¡å™¨ç›¸è¿ï¼Œæ¥å—ç”¨æˆ·çš„è¯·æ±‚ï¼Œå¹¶é€šè¿‡ç½‘ç»œå‘æœåŠ¡å™¨æå‡ºè¯·æ±‚ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œ æ“ä½œã€‚æœåŠ¡å™¨æ¥å—å®¢æˆ·æœºçš„è¯·æ±‚ï¼Œå°†æ•°æ®æäº¤ç»™å®¢æˆ·æœºï¼Œå®¢æˆ·æœºå°†æ•°æ®è¿›è¡Œè®¡ç®—å¹¶å°†ç»“æœå‘ˆç°ç»™ç”¨ æˆ·ã€‚æœåŠ¡å™¨è¿˜è¦æä¾›å®Œå–„å®‰å…¨ä¿æŠ¤åŠå¯¹æ•°æ®å®Œæ•´æ€§çš„å¤„ç†ç­‰æ“ä½œï¼Œå¹¶å…è®¸å¤šä¸ªå®¢æˆ·æœºåŒæ—¶è®¿é—®æœåŠ¡ å™¨ï¼Œè¿™å°±å¯¹æœåŠ¡å™¨çš„ç¡¬ä»¶å¤„ç†æ•°æ®èƒ½åŠ›æå‡ºäº†å¾ˆé«˜çš„è¦æ±‚ã€‚</li><li>åœ¨C/Sç»“æ„ä¸­ï¼Œåº”ç”¨ç¨‹åºåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šæœåŠ¡å™¨éƒ¨åˆ†å’Œå®¢æˆ·æœºéƒ¨åˆ†ã€‚æœåŠ¡å™¨éƒ¨åˆ†æ˜¯å¤šä¸ªç”¨æˆ·å…±äº«çš„ä¿¡ æ¯ä¸åŠŸèƒ½ï¼Œæ‰§è¡Œåå°æœåŠ¡ï¼Œå¦‚æ§åˆ¶å…±äº«æ•°æ®åº“çš„æ“ä½œç­‰ï¼›å®¢æˆ·æœºéƒ¨åˆ†ä¸ºç”¨æˆ·æ‰€ä¸“æœ‰ï¼Œè´Ÿè´£æ‰§è¡Œå‰å° åŠŸèƒ½ï¼Œåœ¨å‡ºé”™æç¤ºã€åœ¨çº¿å¸®åŠ©ç­‰æ–¹é¢éƒ½æœ‰å¼ºå¤§çš„åŠŸèƒ½ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å­ç¨‹åºé—´è‡ªç”±åˆ‡æ¢ã€‚</li></ul><h4 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä¼˜ç‚¹"></a> ä¼˜ç‚¹</h4><ol><li>èƒ½å……åˆ†å‘æŒ¥å®¢æˆ·ç«¯ PC çš„å¤„ç†èƒ½åŠ›ï¼Œå¾ˆå¤šå·¥ä½œå¯ä»¥åœ¨å®¢æˆ·ç«¯å¤„ç†åå†æäº¤ç»™æœåŠ¡å™¨ï¼Œæ‰€ä»¥ C/S ç»“æ„å®¢æˆ·ç«¯å“åº”é€Ÿåº¦å¿«ï¼›</li><li>æ“ä½œç•Œé¢æ¼‚äº®ã€å½¢å¼å¤šæ ·ï¼Œå¯ä»¥å……åˆ†æ»¡è¶³å®¢æˆ·è‡ªèº«çš„ä¸ªæ€§åŒ–è¦æ±‚ï¼›</li><li>C/S ç»“æ„çš„ç®¡ç†ä¿¡æ¯ç³»ç»Ÿå…·æœ‰è¾ƒå¼ºçš„äº‹åŠ¡å¤„ç†èƒ½åŠ›ï¼Œèƒ½å®ç°å¤æ‚çš„ä¸šåŠ¡æµç¨‹ï¼›</li><li>å®‰å…¨æ€§è¾ƒé«˜ï¼ŒC/S ä¸€èˆ¬é¢å‘ç›¸å¯¹å›ºå®šçš„ç”¨æˆ·ç¾¤ï¼Œç¨‹åºæ›´åŠ æ³¨é‡æµç¨‹ï¼Œå®ƒå¯ä»¥å¯¹æƒé™è¿›è¡Œå¤šå±‚æ¬¡æ ¡éªŒï¼Œæä¾›äº†æ›´å®‰å…¨çš„å­˜å–æ¨¡å¼ï¼Œå¯¹ä¿¡æ¯å®‰å…¨çš„æ§åˆ¶èƒ½åŠ›å¾ˆå¼ºï¼Œä¸€èˆ¬é«˜åº¦æœºå¯†çš„ä¿¡æ¯ç³»ç»Ÿé‡‡ç”¨ C/S ç»“æ„é€‚å®œã€‚</li></ol><h4 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¼ºç‚¹"></a> ç¼ºç‚¹</h4><ol><li>å®¢æˆ·ç«¯éœ€è¦å®‰è£…ä¸“ç”¨çš„å®¢æˆ·ç«¯è½¯ä»¶ã€‚é¦–å…ˆæ¶‰åŠåˆ°å®‰è£…çš„å·¥ä½œé‡ï¼Œå…¶æ¬¡ä»»ä½•ä¸€å°ç”µè„‘å‡ºé—®é¢˜ï¼Œå¦‚ç—… æ¯’ã€ç¡¬ä»¶æŸåï¼Œéƒ½éœ€è¦è¿›è¡Œå®‰è£…æˆ–ç»´æŠ¤ã€‚ç³»ç»Ÿè½¯ä»¶å‡çº§æ—¶ï¼Œæ¯ä¸€å°å®¢æˆ·æœºéœ€è¦é‡æ–°å®‰è£…ï¼Œå…¶ç»´æŠ¤å’Œ å‡çº§æˆæœ¬éå¸¸é«˜ï¼›</li><li>å¯¹å®¢æˆ·ç«¯çš„æ“ä½œç³»ç»Ÿä¸€èˆ¬ä¹Ÿä¼šæœ‰é™åˆ¶ï¼Œä¸èƒ½å¤Ÿè·¨å¹³å°ã€‚</li></ol><h3 id="bsç»“æ„"><a href="#bsç»“æ„" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#bsç»“æ„"></a> B/Sç»“æ„</h3><h4 id="ç®€ä»‹-2"><a href="#ç®€ä»‹-2" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç®€ä»‹-2"></a> ç®€ä»‹</h4><p>B/S ç»“æ„ï¼ˆBrowser/Serverï¼Œæµè§ˆå™¨/æœåŠ¡å™¨æ¨¡å¼ï¼‰ï¼Œæ˜¯ WEB å…´èµ·åçš„ä¸€ç§ç½‘ç»œç»“æ„æ¨¡å¼ï¼ŒWEB æµè§ˆå™¨æ˜¯å®¢æˆ·ç«¯æœ€ä¸»è¦çš„åº”ç”¨è½¯ä»¶ã€‚è¿™ç§æ¨¡å¼ç»Ÿä¸€äº†å®¢æˆ·ç«¯ï¼Œå°†ç³»ç»ŸåŠŸèƒ½å®ç°çš„æ ¸å¿ƒéƒ¨åˆ†é›†ä¸­åˆ°æœ åŠ¡å™¨ä¸Šï¼Œç®€åŒ–äº†ç³»ç»Ÿçš„å¼€å‘ã€ç»´æŠ¤å’Œä½¿ç”¨ã€‚å®¢æˆ·æœºä¸Šåªè¦å®‰è£…ä¸€ä¸ªæµè§ˆå™¨ï¼Œå¦‚ Firefox æˆ– Internet Explorerï¼ŒæœåŠ¡å™¨å®‰è£… SQL Serverã€Oracleã€MySQL ç­‰æ•°æ®åº“ã€‚æµè§ˆå™¨é€šè¿‡ Web Server åŒæ•°æ® åº“è¿›è¡Œæ•°æ®äº¤äº’ã€‚</p><h4 id="ä¼˜ç‚¹-2"><a href="#ä¼˜ç‚¹-2" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä¼˜ç‚¹-2"></a> ä¼˜ç‚¹</h4><p>B/S æ¶æ„æœ€å¤§çš„ä¼˜ç‚¹æ˜¯æ€»ä½“æ‹¥æœ‰æˆæœ¬ä½ã€ç»´æŠ¤æ–¹ä¾¿ã€ åˆ†å¸ƒæ€§å¼ºã€å¼€å‘ç®€å•ï¼Œå¯ä»¥ä¸ç”¨å®‰è£…ä»»ä½•ä¸“é—¨çš„è½¯ ä»¶å°±èƒ½å®ç°åœ¨ä»»ä½•åœ°æ–¹è¿›è¡Œæ“ä½œï¼Œå®¢æˆ·ç«¯é›¶ç»´æŠ¤ï¼Œç³»ç»Ÿçš„æ‰©å±•éå¸¸å®¹æ˜“ï¼Œåªè¦æœ‰ä¸€å°èƒ½ä¸Šç½‘çš„ç”µè„‘å°±èƒ½ ä½¿ç”¨ã€‚</p><h4 id="ç¼ºç‚¹-2"><a href="#ç¼ºç‚¹-2" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¼ºç‚¹-2"></a> ç¼ºç‚¹</h4><ol><li>é€šä¿¡å¼€é”€å¤§ã€ç³»ç»Ÿå’Œæ•°æ®çš„å®‰å…¨æ€§è¾ƒéš¾ä¿éšœ;</li><li>ä¸ªæ€§ç‰¹ç‚¹æ˜æ˜¾é™ä½ï¼Œæ— æ³•å®ç°å…·æœ‰ä¸ªæ€§åŒ–çš„åŠŸèƒ½è¦æ±‚ï¼›</li><li>åè®®ä¸€èˆ¬æ˜¯å›ºå®šçš„ï¼šhttp/https</li><li>å®¢æˆ·ç«¯æœåŠ¡å™¨ç«¯çš„äº¤äº’æ˜¯è¯·æ±‚-å“åº”æ¨¡å¼ï¼Œé€šå¸¸åŠ¨æ€åˆ·æ–°é¡µé¢ï¼Œå“åº”é€Ÿåº¦æ˜æ˜¾é™ä½ã€‚</li></ol><h2 id="macåœ°å€"><a href="#macåœ°å€" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#macåœ°å€"></a> MACåœ°å€</h2><p>ç½‘å¡æ˜¯ä¸€å—è¢«è®¾è®¡ç”¨æ¥å…è®¸è®¡ç®—æœºåœ¨è®¡ç®—æœºç½‘ç»œä¸Šè¿›è¡Œé€šè®¯çš„è®¡ç®—æœºç¡¬ä»¶ï¼Œåˆç§°ä¸ºç½‘ç»œé€‚é…å™¨æˆ–ç½‘ç»œæ¥å£å¡NICã€‚å…¶æ‹¥æœ‰ MAC åœ°å€ï¼Œå±äº OSI æ¨¡å‹çš„ç¬¬ 2 å±‚ï¼Œå®ƒä½¿å¾—ç”¨æˆ·å¯ä»¥é€šè¿‡ç”µç¼†æˆ–æ— çº¿ç›¸äº’ è¿æ¥ã€‚æ¯ä¸€ä¸ªç½‘å¡éƒ½æœ‰ä¸€ä¸ªè¢«ç§°ä¸º MAC åœ°å€çš„ç‹¬ä¸€æ— äºŒçš„ 48 ä½ä¸²è¡Œå·ã€‚ç½‘å¡çš„ä¸»è¦åŠŸèƒ½ï¼š1.æ•°æ®çš„å°è£…ä¸è§£å°è£…ã€2.é“¾è·¯ç®¡ç†ã€3.æ•°æ®ç¼–ç ä¸è¯‘ç ã€‚</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817154336052.png" alt="image-20230817154336052"></p><p>MAC åœ°å€ï¼ˆMedia Access Control Addressï¼‰ï¼Œç›´è¯‘ä¸ºåª’ä½“å­˜å–æ§åˆ¶ä½å€ï¼Œä¹Ÿç§°ä¸ºå±€åŸŸç½‘åœ°å€ã€ ä»¥å¤ªç½‘åœ°å€ã€ç‰©ç†åœ°å€æˆ–ç¡¬ä»¶åœ°å€ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨æ¥ç¡®è®¤ç½‘ç»œè®¾å¤‡ä½ç½®çš„ä½å€ï¼Œç”±ç½‘ç»œè®¾å¤‡åˆ¶é€ å•†ç”Ÿäº§æ—¶çƒ§å½•åœ¨ç½‘å¡ä¸­ã€‚åœ¨ OSI æ¨¡å‹ä¸­ï¼Œç¬¬ä¸‰å±‚ç½‘ç»œå±‚è´Ÿè´£ IP åœ°å€ï¼Œç¬¬äºŒå±‚æ•°æ®é“¾è·¯å±‚åˆ™è´Ÿè´£ MAC ä½å€ ã€‚MAC åœ°å€ç”¨äºåœ¨ç½‘ç»œä¸­å”¯ä¸€æ ‡è¯†ä¸€ä¸ªç½‘å¡ï¼Œä¸€å°è®¾å¤‡è‹¥æœ‰ä¸€æˆ–å¤šä¸ªç½‘å¡ï¼Œåˆ™æ¯ä¸ªç½‘å¡éƒ½éœ€ è¦å¹¶ä¼šæœ‰ä¸€ä¸ªå”¯ä¸€çš„ MAC åœ°å€ã€‚</p><p>MAC åœ°å€çš„é•¿åº¦ä¸º 48 ä½ï¼ˆ6ä¸ªå­—èŠ‚ï¼‰ï¼Œé€šå¸¸è¡¨ç¤ºä¸º 12 ä¸ª 16 è¿›åˆ¶æ•°ï¼Œå¦‚ï¼š00-16-EA-AE-3C-40 å°± æ˜¯ä¸€ä¸ªMAC åœ°å€ï¼Œ**å…¶ä¸­å‰ 3 ä¸ªå­—èŠ‚ï¼Œ16 è¿›åˆ¶æ•° 00-16-EA ä»£è¡¨ç½‘ç»œç¡¬ä»¶åˆ¶é€ å•†çš„ç¼–å·ï¼Œå®ƒç”± IEEEï¼ˆç”µæ°”ä¸ç”µå­å·¥ç¨‹å¸ˆåä¼šï¼‰åˆ†é…ï¼Œè€Œå 3 ä¸ªå­—èŠ‚ï¼Œ16è¿›åˆ¶æ•° AE-3C-40 ä»£è¡¨è¯¥åˆ¶é€ å•†æ‰€åˆ¶é€ çš„ æŸä¸ªç½‘ç»œäº§å“ï¼ˆå¦‚ç½‘å¡ï¼‰çš„ç³»åˆ—å·ã€‚**åªè¦ä¸æ›´æ”¹è‡ªå·±çš„ MAC åœ°å€ï¼ŒMAC åœ°å€åœ¨ä¸–ç•Œæ˜¯å”¯ä¸€çš„ã€‚ å½¢è±¡åœ°è¯´ï¼ŒMAC åœ°å€å°±å¦‚åŒèº«ä»½è¯ä¸Šçš„èº«ä»½è¯å·ç ï¼Œå…·æœ‰å”¯ä¸€æ€§ã€‚</p><h2 id="ipåœ°å€"><a href="#ipåœ°å€" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ipåœ°å€"></a> IPåœ°å€</h2><h3 id="ç®€ä»‹-3"><a href="#ç®€ä»‹-3" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç®€ä»‹-3"></a> ç®€ä»‹</h3><p>IP åè®®æ˜¯ä¸ºè®¡ç®—æœºç½‘ç»œç›¸äº’è¿æ¥è¿›è¡Œé€šä¿¡è€Œè®¾è®¡çš„åè®®ã€‚åœ¨å› ç‰¹ç½‘ä¸­ï¼Œå®ƒæ˜¯èƒ½ä½¿è¿æ¥åˆ°ç½‘ä¸Šçš„æ‰€æœ‰è®¡ç®—æœºç½‘ç»œå®ç°ç›¸äº’é€šä¿¡çš„ä¸€å¥—è§„åˆ™ï¼Œè§„å®šäº†è®¡ç®—æœºåœ¨å› ç‰¹ç½‘ä¸Šè¿›è¡Œé€šä¿¡æ—¶åº”å½“éµå®ˆçš„è§„åˆ™ã€‚ä»» ä½•å‚å®¶ç”Ÿäº§çš„è®¡ç®—æœºç³»ç»Ÿï¼Œåªè¦éµå®ˆ IP åè®®å°±å¯ä»¥ä¸å› ç‰¹ç½‘äº’è¿äº’é€šã€‚å„ä¸ªå‚å®¶ç”Ÿäº§çš„ç½‘ç»œç³»ç»Ÿ å’Œè®¾å¤‡ï¼Œå¦‚ä»¥å¤ªç½‘ã€åˆ†ç»„äº¤æ¢ç½‘ç­‰ï¼Œå®ƒä»¬ç›¸äº’ä¹‹é—´ä¸èƒ½äº’é€šï¼Œä¸èƒ½äº’é€šçš„ä¸»è¦åŸå› æ˜¯å› ä¸ºå®ƒä»¬æ‰€ä¼  é€æ•°æ®çš„åŸºæœ¬å•å…ƒï¼ˆæŠ€æœ¯ä¸Šç§°ä¹‹ä¸ºâ€œå¸§â€ï¼‰çš„æ ¼å¼ä¸åŒã€‚</p><p>IP åè®®å®é™…ä¸Šæ˜¯ä¸€å¥—ç”±è½¯ä»¶ç¨‹åºç»„æˆçš„åè®® è½¯ä»¶ï¼Œå®ƒæŠŠå„ç§ä¸åŒâ€œå¸§â€ç»Ÿä¸€è½¬æ¢æˆâ€œIP æ•°æ®æŠ¥â€æ ¼å¼ï¼Œè¿™ç§è½¬æ¢æ˜¯å› ç‰¹ç½‘çš„ä¸€ä¸ªæœ€é‡è¦çš„ç‰¹ç‚¹ï¼Œä½¿ æ‰€æœ‰å„ç§è®¡ç®—æœºéƒ½èƒ½åœ¨å› ç‰¹ç½‘ä¸Šå®ç°äº’é€šï¼Œå³å…·æœ‰â€œå¼€æ”¾æ€§â€çš„ç‰¹ç‚¹ã€‚æ­£æ˜¯å› ä¸ºæœ‰äº† IP åè®®ï¼Œå› ç‰¹ ç½‘æ‰å¾—ä»¥è¿…é€Ÿå‘å±•æˆä¸ºä¸–ç•Œä¸Šæœ€å¤§çš„ã€å¼€æ”¾çš„è®¡ç®—æœºé€šä¿¡ç½‘ç»œã€‚å› æ­¤ï¼ŒIP åè®®ä¹Ÿå¯ä»¥å«åšâ€œå› ç‰¹ç½‘ åè®®â€ã€‚</p><p>IP åœ°å€ï¼ˆInternet Protocol Addressï¼‰æ˜¯æŒ‡äº’è”ç½‘åè®®åœ°å€ï¼Œåˆè¯‘ä¸ºç½‘é™…åè®®åœ°å€ã€‚IP åœ°å€æ˜¯ IP åè®®æä¾›çš„ä¸€ç§ç»Ÿä¸€çš„åœ°å€æ ¼å¼ï¼Œå®ƒä¸ºäº’è”ç½‘ä¸Šçš„æ¯ä¸€ä¸ªç½‘ç»œå’Œæ¯ä¸€å°ä¸»æœºåˆ†é…ä¸€ä¸ªé€»è¾‘åœ°å€ï¼Œä»¥ æ­¤æ¥å±è”½ç‰©ç†åœ°å€çš„å·®å¼‚ã€‚ IP åœ°å€æ˜¯ä¸€ä¸ª 32 ä½çš„äºŒè¿›åˆ¶æ•°ï¼Œé€šå¸¸è¢«åˆ†å‰²ä¸º 4 ä¸ªâ€œ 8 ä½äºŒè¿›åˆ¶æ•°â€ï¼ˆä¹Ÿå°±æ˜¯ 4 ä¸ªå­—èŠ‚ï¼‰ã€‚IP åœ°å€ é€šå¸¸ç”¨â€œç‚¹åˆ†åè¿›åˆ¶â€è¡¨ç¤ºæˆï¼ˆa.b.c.dï¼‰çš„å½¢å¼ï¼Œå…¶ä¸­ï¼Œa,b,c,déƒ½æ˜¯ 0~255 ä¹‹é—´çš„åè¿›åˆ¶æ•´æ•°ã€‚ ä¾‹ï¼šç‚¹åˆ†åè¿›IPåœ°å€ï¼ˆ100.4.5.6ï¼‰ï¼Œå®é™…ä¸Šæ˜¯ 32 ä½äºŒè¿›åˆ¶æ•° ï¼ˆ01100100.00000100.00000101.00000110ï¼‰ã€‚</p><h3 id="ipåœ°å€ç¼–å€æ–¹å¼abcdeå’Œcidr"><a href="#ipåœ°å€ç¼–å€æ–¹å¼abcdeå’Œcidr" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ipåœ°å€ç¼–å€æ–¹å¼abcdeå’Œcidr"></a> IPåœ°å€ç¼–å€æ–¹å¼(ABCDEå’ŒCIDR)</h3><p>æœ€åˆè®¾è®¡äº’è”ç½‘ç»œæ—¶ï¼Œä¸ºäº†ä¾¿äºå¯»å€ä»¥åŠå±‚æ¬¡åŒ–æ„é€ ç½‘ç»œï¼Œæ¯ä¸ª IP åœ°å€åŒ…æ‹¬ä¸¤ä¸ªæ ‡è¯†ç ï¼ˆIDï¼‰ï¼Œå³ç½‘ç»œ ID å’Œä¸»æœº IDã€‚åŒä¸€ä¸ªç‰©ç†ç½‘ç»œä¸Šçš„æ‰€æœ‰ä¸»æœºéƒ½ä½¿ç”¨åŒä¸€ä¸ªç½‘ç»œ IDï¼Œç½‘ç»œä¸Šçš„ä¸€ä¸ªä¸»æœºï¼ˆåŒ…æ‹¬ç½‘ç»œä¸Šå·¥ ä½œç«™ï¼ŒæœåŠ¡å™¨å’Œè·¯ç”±å™¨ç­‰ï¼‰æœ‰ä¸€ä¸ªä¸»æœº ID ä¸å…¶å¯¹åº”ã€‚Internet å§”å‘˜ä¼šå®šä¹‰äº† 5 ç§ IP åœ°å€ç±»å‹ä»¥é€‚åˆä¸ åŒå®¹é‡çš„ç½‘ç»œï¼Œå³ A ç±»~ E ç±»ã€‚</p><p>å…¶ä¸­ Aã€Bã€C 3ç±»ï¼ˆå¦‚ä¸‹è¡¨æ ¼ï¼‰ç”± InternetNIC åœ¨å…¨çƒèŒƒå›´å†…ç»Ÿä¸€åˆ†é…ï¼ŒDã€E ç±»ä¸ºç‰¹æ®Šåœ°å€ã€‚</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817162026337.png" alt="image-20230817162026337"></p><h4 id="aç±»ipåœ°å€"><a href="#aç±»ipåœ°å€" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#aç±»ipåœ°å€"></a> Aç±»IPåœ°å€</h4><p>ä¸€ä¸ª A ç±» IP åœ°å€æ˜¯æŒ‡ï¼Œ åœ¨ IP åœ°å€çš„å››æ®µå·ç ä¸­ï¼Œç¬¬ä¸€æ®µå·ç ä¸ºç½‘ç»œå·ç ï¼Œå‰©ä¸‹çš„ä¸‰æ®µå·ç ä¸ºæœ¬åœ°è®¡ç®— æœºçš„å·ç ã€‚å¦‚æœç”¨äºŒè¿›åˆ¶è¡¨ç¤º IP åœ°å€çš„è¯ï¼ŒA ç±» IP åœ°å€å°±ç”± 1 å­—èŠ‚çš„ç½‘ç»œåœ°å€å’Œ 3 å­—èŠ‚ä¸»æœºåœ°å€ç»„ æˆï¼Œç½‘ç»œåœ°å€çš„æœ€é«˜ä½å¿…é¡»æ˜¯â€œ0â€ã€‚A ç±» IP åœ°å€ä¸­ç½‘ç»œçš„æ ‡è¯†é•¿åº¦ä¸º 8 ä½ï¼Œä¸»æœºæ ‡è¯†çš„é•¿åº¦ä¸º 24 ä½ï¼ŒA ç±»ç½‘ç»œåœ°å€æ•°é‡è¾ƒå°‘ï¼Œæœ‰ 126 ä¸ªç½‘ç»œï¼Œæ¯ä¸ªç½‘ç»œå¯ä»¥å®¹çº³ä¸»æœºæ•°è¾¾ 1600 å¤šä¸‡å°ã€‚</p><p>A ç±» IP åœ°å€ åœ°å€èŒƒå›´ 1.0.0.1 - 126.255.255.254ï¼ˆäºŒè¿›åˆ¶è¡¨ç¤ºä¸ºï¼š00000001 00000000 00000000 00000001 - 01111111 11111111 11111111 11111110ï¼‰ã€‚æœ€åä¸€ä¸ªæ˜¯å¹¿æ’­åœ°å€ã€‚</p><p>A ç±» IP åœ°å€çš„å­ç½‘æ©ç ä¸º 255.0.0.0ï¼Œæ¯ä¸ªç½‘ç»œæ”¯æŒçš„æœ€å¤§ä¸»æœºæ•°ä¸º 256 çš„ 3 æ¬¡æ–¹ - 2 = 16777214 å°</p><h4 id="bç±»ipåœ°å€"><a href="#bç±»ipåœ°å€" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#bç±»ipåœ°å€"></a> Bç±»IPåœ°å€</h4><p>ä¸€ä¸ª B ç±» IP åœ°å€æ˜¯æŒ‡ï¼Œåœ¨ IP åœ°å€çš„å››æ®µå·ç ä¸­ï¼Œå‰ä¸¤æ®µå·ç ä¸ºç½‘ç»œå·ç ã€‚å¦‚æœç”¨äºŒè¿›åˆ¶è¡¨ç¤º IP åœ°å€çš„ è¯ï¼ŒB ç±» IP åœ°å€å°±ç”± 2 å­—èŠ‚çš„ç½‘ç»œåœ°å€å’Œ 2 å­—èŠ‚ä¸»æœºåœ°å€ç»„æˆï¼Œç½‘ç»œåœ°å€çš„æœ€é«˜ä½å¿…é¡»æ˜¯â€œ10â€ã€‚B ç±» IP åœ°å€ä¸­ç½‘ç»œçš„æ ‡è¯†é•¿åº¦ä¸º 16 ä½ï¼Œä¸»æœºæ ‡è¯†çš„é•¿åº¦ä¸º 16 ä½ï¼ŒB ç±»ç½‘ç»œåœ°å€é€‚ç”¨äºä¸­ç­‰è§„æ¨¡çš„ç½‘ç»œï¼Œæœ‰ 16384 ä¸ªç½‘ç»œï¼Œæ¯ä¸ªç½‘ç»œæ‰€èƒ½å®¹çº³çš„è®¡ç®—æœºæ•°ä¸º 6 ä¸‡å¤šå°ã€‚</p><p>B ç±» IP åœ°å€åœ°å€èŒƒå›´ 128.0.0.1 - 191.255.255.254 ï¼ˆäºŒè¿›åˆ¶è¡¨ç¤ºä¸ºï¼š10000000 00000000 00000000 00000001 - 10111111 11111111 11111111 11111110ï¼‰ã€‚ æœ€åä¸€ä¸ªæ˜¯å¹¿æ’­åœ°å€ã€‚</p><p>B ç±» IP åœ°å€çš„å­ç½‘æ©ç ä¸º 255.255.0.0ï¼Œæ¯ä¸ªç½‘ç»œæ”¯æŒçš„æœ€å¤§ä¸»æœºæ•°ä¸º 256 çš„ 2 æ¬¡æ–¹ - 2 = 65534 å°ã€‚</p><h4 id="cç±»ipåœ°å€"><a href="#cç±»ipåœ°å€" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#cç±»ipåœ°å€"></a> Cç±»IPåœ°å€</h4><p>ä¸€ä¸ª C ç±» IP åœ°å€æ˜¯æŒ‡ï¼Œåœ¨ IP åœ°å€çš„å››æ®µå·ç ä¸­ï¼Œå‰ä¸‰æ®µå·ç ä¸ºç½‘ç»œå·ç ï¼Œå‰©ä¸‹çš„ä¸€æ®µå·ç ä¸ºæœ¬åœ°è®¡ç®— æœºçš„å·ç ã€‚å¦‚æœç”¨äºŒè¿›åˆ¶è¡¨ç¤º IP åœ°å€çš„è¯ï¼ŒC ç±» IP åœ°å€å°±ç”± 3 å­—èŠ‚çš„ç½‘ç»œåœ°å€å’Œ 1 å­—èŠ‚ä¸»æœºåœ°å€ç»„ æˆï¼Œç½‘ç»œåœ°å€çš„æœ€é«˜ä½å¿…é¡»æ˜¯â€œ110â€ã€‚C ç±» IP åœ°å€ä¸­ç½‘ç»œçš„æ ‡è¯†é•¿åº¦ä¸º 24 ä½ï¼Œä¸»æœºæ ‡è¯†çš„é•¿åº¦ä¸º 8 ä½ï¼Œ C ç±»ç½‘ç»œåœ°å€æ•°é‡è¾ƒå¤šï¼Œæœ‰ 209 ä¸‡ä½™ä¸ªç½‘ç»œã€‚é€‚ç”¨äºå°è§„æ¨¡çš„å±€åŸŸç½‘ç»œï¼Œæ¯ä¸ªç½‘ç»œæœ€å¤šåªèƒ½åŒ…å«254å° è®¡ç®—æœºã€‚</p><p>C ç±» IP åœ°å€èŒƒå›´ 192.0.0.1-223.255.255.254 ï¼ˆäºŒè¿›åˆ¶è¡¨ç¤ºä¸º: 11000000 00000000 00000000 00000001 - 11011111 11111111 11111111 11111110ï¼‰ã€‚</p><p>Cç±»IPåœ°å€çš„å­ç½‘æ©ç ä¸º 255.255.255.0ï¼Œæ¯ä¸ªç½‘ç»œæ”¯æŒçš„æœ€å¤§ä¸»æœºæ•°ä¸º 256 - 2 = 254 å°ã€‚</p><h4 id="dç±»ipåœ°å€"><a href="#dç±»ipåœ°å€" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#dç±»ipåœ°å€"></a> Dç±»IPåœ°å€</h4><p>D ç±» IP åœ°å€åœ¨å†å²ä¸Šè¢«å«åšå¤šæ’­åœ°å€ï¼ˆmulticast addressï¼‰ï¼Œå³ç»„æ’­åœ°å€ã€‚åœ¨ä»¥å¤ªç½‘ä¸­ï¼Œå¤šæ’­åœ°å€å‘½ åäº†ä¸€ç»„åº”è¯¥åœ¨è¿™ä¸ªç½‘ç»œä¸­åº”ç”¨æ¥æ”¶åˆ°ä¸€ä¸ªåˆ†ç»„çš„ç«™ç‚¹ã€‚å¤šæ’­åœ°å€çš„æœ€é«˜ä½å¿…é¡»æ˜¯ â€œ1110â€ï¼ŒèŒƒå›´ä» 224.0.0.0 - 239.255.255.255ã€‚</p><h4 id="ç‰¹æ®Šipåœ°å€"><a href="#ç‰¹æ®Šipåœ°å€" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç‰¹æ®Šipåœ°å€"></a> ç‰¹æ®ŠIPåœ°å€</h4><p>æ¯ä¸€ä¸ªå­—èŠ‚éƒ½ä¸º 0 çš„åœ°å€ï¼ˆ â€œ0.0.0.0â€ ï¼‰å¯¹åº”äºå½“å‰ä¸»æœºï¼›</p><p>IP åœ°å€ä¸­çš„æ¯ä¸€ä¸ªå­—èŠ‚éƒ½ä¸º 1 çš„ IP åœ°å€ï¼ˆ â€œ255.255.255.255â€ ï¼‰æ˜¯å½“å‰å­ç½‘çš„å¹¿æ’­åœ°å€ï¼›</p><p>IP åœ°å€ä¸­å‡¡æ˜¯ä»¥ â€œ11110â€ å¼€å¤´çš„ E ç±» IP åœ°å€éƒ½ä¿ç•™ç”¨äºå°†æ¥å’Œå®éªŒä½¿ç”¨ã€‚</p><p>IPåœ°å€ä¸­ä¸èƒ½ä»¥åè¿›åˆ¶ â€œ127â€ ä½œä¸ºå¼€å¤´ï¼Œè¯¥ç±»åœ°å€ä¸­æ•°å­— 127.0.0.1 åˆ° 127.255.255.255 ç”¨äºå›è·¯æµ‹ è¯•ï¼Œå¦‚ï¼š127.0.0.1å¯ä»¥ä»£è¡¨æœ¬æœºIPåœ°å€ã€‚</p><h4 id="å­ç½‘æ©ç "><a href="#å­ç½‘æ©ç " class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å­ç½‘æ©ç "></a> å­ç½‘æ©ç </h4><p>å­ç½‘æ©ç ï¼ˆsubnet maskï¼‰åˆå«ç½‘ç»œæ©ç ã€åœ°å€æ©ç ã€å­ç½‘ç»œé®ç½©ï¼Œå®ƒæ˜¯ä¸€ç§ç”¨æ¥æŒ‡æ˜ä¸€ä¸ª IP åœ° å€çš„å“ªäº›ä½æ ‡è¯†çš„æ˜¯ä¸»æœºæ‰€åœ¨çš„å­ç½‘ï¼Œä»¥åŠå“ªäº›ä½æ ‡è¯†çš„æ˜¯ä¸»æœºçš„ä½æ©ç ã€‚å­ç½‘æ©ç ä¸èƒ½å•ç‹¬å­˜ åœ¨ï¼Œå®ƒå¿…é¡»ç»“åˆ IP åœ°å€ä¸€èµ·ä½¿ç”¨ã€‚å­ç½‘æ©ç åªæœ‰ä¸€ä¸ªä½œç”¨ï¼Œå°±æ˜¯å°†æŸä¸ª IP åœ°å€åˆ’åˆ†æˆç½‘ç»œåœ°å€å’Œ ä¸»æœºåœ°å€ä¸¤éƒ¨åˆ†ã€‚</p><p>å­ç½‘æ©ç æ˜¯ä¸€ä¸ª 32 ä½åœ°å€ï¼Œç”¨äºå±è”½ IP åœ°å€çš„ä¸€éƒ¨åˆ†ä»¥åŒºåˆ«ç½‘ç»œæ ‡è¯†å’Œä¸»æœºæ ‡è¯†ï¼Œå¹¶è¯´æ˜è¯¥ IP åœ°å€æ˜¯åœ¨å±€åŸŸç½‘ä¸Šï¼Œè¿˜æ˜¯åœ¨å¹¿åŸŸç½‘ä¸Šã€‚</p><p>å­ç½‘æ©ç æ˜¯åœ¨ IPv4 åœ°å€èµ„æºç´§ç¼ºçš„èƒŒæ™¯ä¸‹ä¸ºäº†è§£å†³ lP åœ°å€åˆ†é…è€Œäº§ç”Ÿçš„è™šæ‹Ÿ lP æŠ€æœ¯ï¼Œé€šè¿‡å­ç½‘æ©ç å°† Aã€Bã€C ä¸‰ç±»åœ°å€åˆ’åˆ†ä¸ºè‹¥å¹²å­ç½‘ï¼Œä»è€Œæ˜¾è‘—æé«˜äº† IP åœ°å€çš„åˆ†é…æ•ˆç‡ï¼Œæœ‰æ•ˆè§£å†³äº† IP åœ°å€èµ„æºç´§å¼  çš„å±€é¢ã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨ä¼ä¸šå†…ç½‘ä¸­ä¸ºäº†æ›´å¥½åœ°ç®¡ç†ç½‘ç»œï¼Œç½‘ç®¡äººå‘˜ä¹Ÿåˆ©ç”¨å­ç½‘æ©ç çš„ä½œç”¨ï¼Œäººä¸ºåœ°å°†ä¸€ ä¸ªè¾ƒå¤§çš„ä¼ä¸šå†…éƒ¨ç½‘ç»œåˆ’åˆ†ä¸ºæ›´å¤šä¸ªå°è§„æ¨¡çš„å­ç½‘ï¼Œå†åˆ©ç”¨ä¸‰å±‚äº¤æ¢æœºçš„è·¯ç”±åŠŸèƒ½å®ç°å­ç½‘äº’è”ï¼Œä»è€Œ æœ‰æ•ˆè§£å†³äº†ç½‘ç»œå¹¿æ’­é£æš´å’Œç½‘ç»œç—…æ¯’ç­‰è¯¸å¤šç½‘ç»œç®¡ç†æ–¹é¢çš„é—®é¢˜ã€‚</p><p>åœ¨å¤§å¤šæ•°çš„ç½‘ç»œæ•™ç§‘ä¹¦ä¸­ï¼Œä¸€èˆ¬éƒ½å°†å­ç½‘æ©ç çš„ä½œç”¨æè¿°ä¸ºé€šè¿‡é€»è¾‘è¿ç®—ï¼Œå°† IP åœ°å€åˆ’åˆ†ä¸ºç½‘ç»œæ ‡è¯† (<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="http://Net.ID">Net.ID</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>) å’Œä¸»æœºæ ‡è¯†(<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="http://Host.ID">Host.ID</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>)ï¼Œåªæœ‰ç½‘ç»œæ ‡è¯†ç›¸åŒçš„ä¸¤å°ä¸»æœºåœ¨æ— è·¯ç”±çš„æƒ…å†µä¸‹æ‰èƒ½ç›¸äº’é€šä¿¡ã€‚</p><p>æ ¹æ® RFC950 å®šä¹‰ï¼Œå­ç½‘æ©ç æ˜¯ä¸€ä¸ª 32 ä½çš„ 2 è¿›åˆ¶æ•°ï¼Œ å…¶å¯¹åº”ç½‘ç»œåœ°å€çš„æ‰€æœ‰ä½éƒ½ç½®ä¸º 1ï¼Œå¯¹åº”äºä¸» æœºåœ°å€çš„æ‰€æœ‰ä½ç½®éƒ½ä¸º 0ã€‚å­ç½‘æ©ç å‘ŠçŸ¥è·¯ç”±å™¨ï¼Œåœ°å€çš„å“ªä¸€éƒ¨åˆ†æ˜¯ç½‘ç»œåœ°å€ï¼Œå“ªä¸€éƒ¨åˆ†æ˜¯ä¸»æœºåœ°å€ï¼Œ ä½¿è·¯ç”±å™¨æ­£ç¡®åˆ¤æ–­ä»»æ„ IP åœ°å€æ˜¯å¦æ˜¯æœ¬ç½‘æ®µçš„ï¼Œä»è€Œæ­£ç¡®åœ°è¿›è¡Œè·¯ç”±ã€‚ç½‘ç»œä¸Šï¼Œæ•°æ®ä»ä¸€ä¸ªåœ°æ–¹ä¼ åˆ°å¦ å¤–ä¸€ä¸ªåœ°æ–¹ï¼Œæ˜¯ä¾é  IP å¯»å€ã€‚ä»é€»è¾‘ä¸Šæ¥è®²ï¼Œæ˜¯ä¸¤æ­¥çš„ã€‚ç¬¬ä¸€æ­¥ï¼Œä» IP ä¸­æ‰¾åˆ°æ‰€å±çš„ç½‘ç»œï¼Œå¥½æ¯”æ˜¯å» æ‰¾è¿™ä¸ªäººæ˜¯å“ªä¸ªå°åŒºçš„ï¼›ç¬¬äºŒæ­¥ï¼Œå†ä» IP ä¸­æ‰¾åˆ°ä¸»æœºåœ¨è¿™ä¸ªç½‘ç»œä¸­çš„ä½ç½®ï¼Œå¥½æ¯”æ˜¯åœ¨å°åŒºé‡Œé¢æ‰¾åˆ°è¿™ä¸ª äººã€‚</p><p>å­ç½‘æ©ç çš„è®¾å®šå¿…é¡»éµå¾ªä¸€å®šçš„è§„åˆ™ã€‚ä¸äºŒè¿›åˆ¶ IP åœ°å€ç›¸åŒï¼Œå­ç½‘æ©ç ç”± 1 å’Œ 0 ç»„æˆï¼Œä¸” 1 å’Œ 0 åˆ†åˆ« è¿ç»­ã€‚å­ç½‘æ©ç çš„é•¿åº¦ä¹Ÿæ˜¯ 32 ä½ï¼Œå·¦è¾¹æ˜¯ç½‘ç»œä½ï¼Œç”¨äºŒè¿›åˆ¶æ•°å­— â€œ1â€ è¡¨ç¤ºï¼Œ1 çš„æ•°ç›®ç­‰äºç½‘ç»œä½çš„é•¿ åº¦ï¼›å³è¾¹æ˜¯ä¸»æœºä½ï¼Œç”¨äºŒè¿›åˆ¶æ•°å­— â€œ0â€ è¡¨ç¤ºï¼Œ0 çš„æ•°ç›®ç­‰äºä¸»æœºä½çš„é•¿åº¦ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†è®©æ©ç  ä¸ IP åœ°å€åšæŒ‰ä½ä¸è¿ç®—æ—¶ç”¨ 0 é®ä½åŸä¸»æœºæ•°ï¼Œè€Œä¸æ”¹å˜åŸç½‘ç»œæ®µæ•°å­—ï¼Œè€Œä¸”å¾ˆå®¹æ˜“é€šè¿‡ 0 çš„ä½æ•°ç¡®å®šå­ ç½‘çš„ä¸»æœºæ•°ï¼ˆ 2 çš„ä¸»æœºä½æ•°æ¬¡æ–¹ - 2ï¼Œå› ä¸ºä¸»æœºå·å…¨ä¸º 1 æ—¶è¡¨ç¤ºè¯¥ç½‘ç»œå¹¿æ’­åœ°å€ï¼Œå…¨ä¸º 0 æ—¶è¡¨ç¤ºè¯¥ç½‘ç»œ çš„ç½‘ç»œå·ï¼Œè¿™æ˜¯ä¸¤ä¸ªç‰¹æ®Šåœ°å€ï¼‰ã€‚é€šè¿‡å­ç½‘æ©ç ï¼Œæ‰èƒ½è¡¨æ˜ä¸€å°ä¸»æœºæ‰€åœ¨çš„å­ç½‘ä¸å…¶ä»–å­ç½‘çš„å…³ç³»ï¼Œä½¿ ç½‘ç»œæ­£å¸¸å·¥ä½œã€‚</p><h2 id="ç«¯å£"><a href="#ç«¯å£" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç«¯å£"></a> ç«¯å£</h2><h3 id="ç®€ä»‹-4"><a href="#ç®€ä»‹-4" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç®€ä»‹-4"></a> ç®€ä»‹</h3><p>â€œç«¯å£â€ æ˜¯è‹±æ–‡ port çš„æ„è¯‘ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯è®¾å¤‡ä¸å¤–ç•Œé€šè®¯äº¤æµçš„å‡ºå£ã€‚ç«¯å£å¯åˆ†ä¸ºè™šæ‹Ÿç«¯å£å’Œç‰©ç† ç«¯å£ï¼Œå…¶ä¸­è™šæ‹Ÿç«¯å£æŒ‡è®¡ç®—æœºå†…éƒ¨æˆ–äº¤æ¢æœºè·¯ç”±å™¨å†…çš„ç«¯å£ï¼Œä¸å¯è§ï¼Œæ˜¯ç‰¹æŒ‡TCP/IPåè®®ä¸­çš„ç«¯ å£ï¼Œæ˜¯é€»è¾‘æ„ä¹‰ä¸Šçš„ç«¯å£ã€‚ä¾‹å¦‚è®¡ç®—æœºä¸­çš„ 80 ç«¯å£ã€21 ç«¯å£ã€23 ç«¯å£ç­‰ã€‚ç‰©ç†ç«¯å£åˆç§°ä¸ºæ¥ å£ï¼Œæ˜¯å¯è§ç«¯å£ï¼Œè®¡ç®—æœºèƒŒæ¿çš„ RJ45 ç½‘å£ï¼Œäº¤æ¢æœºè·¯ç”±å™¨é›†çº¿å™¨ç­‰ RJ45 ç«¯å£ã€‚ç”µè¯ä½¿ç”¨ RJ11 æ’ å£ä¹Ÿå±äºç‰©ç†ç«¯å£çš„èŒƒç•´ã€‚</p><p>å¦‚æœæŠŠ IP åœ°å€æ¯”ä½œä¸€é—´æˆ¿å­ï¼Œç«¯å£å°±æ˜¯å‡ºå…¥è¿™é—´æˆ¿å­çš„é—¨ã€‚çœŸæ­£çš„æˆ¿å­åªæœ‰å‡ ä¸ªé—¨ï¼Œä½†æ˜¯ä¸€ä¸ª IP åœ°å€çš„ç«¯å£å¯ä»¥æœ‰ 65536ï¼ˆå³ï¼š2^16ï¼‰ä¸ªä¹‹å¤šï¼ç«¯å£æ˜¯é€šè¿‡ç«¯å£å·æ¥æ ‡è®°çš„ï¼Œç«¯å£å·åªæœ‰æ•´æ•°ï¼Œ èŒƒå›´æ˜¯ä» 0 åˆ°65535ï¼ˆ2^16-1ï¼‰ã€‚</p><h3 id="ç«¯å£ç±»å‹"><a href="#ç«¯å£ç±»å‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç«¯å£ç±»å‹"></a> ç«¯å£ç±»å‹</h3><ol><li>å‘¨çŸ¥ç«¯å£ï¼ˆWell Known Portsï¼‰ å‘¨çŸ¥ç«¯å£æ˜¯ä¼—æ‰€å‘¨çŸ¥çš„ç«¯å£å·ï¼Œä¹Ÿå«çŸ¥åç«¯å£ã€å…¬è®¤ç«¯å£æˆ–è€…å¸¸ç”¨ç«¯å£ï¼ŒèŒƒå›´ä» 0 åˆ° 1023ï¼Œå®ƒä»¬ç´§å¯† ç»‘å®šäºä¸€äº›ç‰¹å®šçš„æœåŠ¡ã€‚ä¾‹å¦‚ 80 ç«¯å£åˆ†é…ç»™ WWW æœåŠ¡ï¼Œ21 ç«¯å£åˆ†é…ç»™ FTP æœåŠ¡ï¼Œ23 ç«¯å£åˆ†é…ç»™ TelnetæœåŠ¡ç­‰ç­‰ã€‚æˆ‘ä»¬åœ¨ IE çš„åœ°å€æ é‡Œè¾“å…¥ä¸€ä¸ªç½‘å€çš„æ—¶å€™æ˜¯ä¸å¿…æŒ‡å®šç«¯å£å·çš„ï¼Œå› ä¸ºåœ¨é»˜è®¤æƒ…å†µä¸‹ WWW æœåŠ¡çš„ç«¯å£æ˜¯ â€œ80â€ã€‚ç½‘ç»œæœåŠ¡æ˜¯å¯ä»¥ä½¿ç”¨å…¶ä»–ç«¯å£å·çš„ï¼Œå¦‚æœä¸æ˜¯é»˜è®¤çš„ç«¯å£å·åˆ™åº”è¯¥åœ¨åœ°å€æ  ä¸ŠæŒ‡å®šç«¯å£å·ï¼Œæ–¹æ³•æ˜¯åœ¨åœ°å€åé¢åŠ ä¸Šå†’å·â€œ:â€ï¼ˆåŠè§’ï¼‰ï¼Œå†åŠ ä¸Šç«¯å£å·ã€‚æ¯”å¦‚ä½¿ç”¨ â€œ8080â€ ä½œä¸º WWW æœåŠ¡çš„ç«¯å£ï¼Œåˆ™éœ€è¦åœ¨åœ°å€æ é‡Œè¾“å…¥â€œç½‘å€:8080â€ã€‚ä½†æ˜¯æœ‰äº›ç³»ç»Ÿåè®®ä½¿ç”¨å›ºå®šçš„ç«¯å£å·ï¼Œå®ƒæ˜¯ä¸èƒ½è¢«æ”¹ å˜çš„ï¼Œæ¯”å¦‚ 139 ç«¯å£ä¸“é—¨ç”¨äº NetBIOS ä¸ TCP/IP ä¹‹é—´çš„é€šä¿¡ï¼Œä¸èƒ½æ‰‹åŠ¨æ”¹å˜ã€‚</li><li>æ³¨å†Œç«¯å£ï¼ˆRegistered Portsï¼‰ ç«¯å£å·ä» 1024 åˆ° 49151ï¼Œå®ƒä»¬æ¾æ•£åœ°ç»‘å®šäºä¸€äº›æœåŠ¡ï¼Œåˆ†é…ç»™ç”¨æˆ·è¿›ç¨‹æˆ–åº”ç”¨ç¨‹åºï¼Œè¿™äº›è¿›ç¨‹ä¸»è¦æ˜¯ ç”¨æˆ·é€‰æ‹©å®‰è£…çš„ä¸€äº›åº”ç”¨ç¨‹åºï¼Œè€Œä¸æ˜¯å·²ç»åˆ†é…å¥½äº†å…¬è®¤ç«¯å£çš„å¸¸ç”¨ç¨‹åºã€‚è¿™äº›ç«¯å£åœ¨æ²¡æœ‰è¢«æœåŠ¡å™¨èµ„ æºå ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥ç”¨ç”¨æˆ·ç«¯åŠ¨æ€é€‰ç”¨ä¸ºæºç«¯å£ã€‚</li><li>åŠ¨æ€ç«¯å£ / ç§æœ‰ç«¯å£ï¼ˆDynamic Ports / Private Portsï¼‰ åŠ¨æ€ç«¯å£çš„èŒƒå›´æ˜¯ä» 49152 åˆ° 65535ã€‚ä¹‹æ‰€ä»¥ç§°ä¸ºåŠ¨æ€ç«¯å£ï¼Œæ˜¯å› ä¸ºå®ƒä¸€èˆ¬ä¸å›ºå®šåˆ†é…æŸç§æœåŠ¡ï¼Œè€Œæ˜¯åŠ¨æ€åˆ†é…</li></ol><h2 id="ç½‘ç»œæ¨¡å‹"><a href="#ç½‘ç»œæ¨¡å‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç½‘ç»œæ¨¡å‹"></a> ç½‘ç»œæ¨¡å‹</h2><h3 id="osi-ä¸ƒå±‚å‚è€ƒæ¨¡å‹"><a href="#osi-ä¸ƒå±‚å‚è€ƒæ¨¡å‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#osi-ä¸ƒå±‚å‚è€ƒæ¨¡å‹"></a> OSI ä¸ƒå±‚å‚è€ƒæ¨¡å‹</h3><p>ä¸ƒå±‚æ¨¡å‹ï¼Œäº¦ç§° OSIï¼ˆOpen System Interconnectionï¼‰å‚è€ƒæ¨¡å‹ï¼Œå³å¼€æ”¾å¼ç³»ç»Ÿäº’è”ã€‚å‚è€ƒæ¨¡å‹ æ˜¯å›½é™…æ ‡å‡†åŒ–ç»„ç»‡ï¼ˆISOï¼‰åˆ¶å®šçš„ä¸€ä¸ªç”¨äºè®¡ç®—æœºæˆ–é€šä¿¡ç³»ç»Ÿé—´äº’è”çš„æ ‡å‡†ä½“ç³»ï¼Œä¸€èˆ¬ç§°ä¸º OSI å‚ è€ƒæ¨¡å‹æˆ–ä¸ƒå±‚æ¨¡å‹ã€‚</p><p>å®ƒæ˜¯ä¸€ä¸ªä¸ƒå±‚çš„ã€æŠ½è±¡çš„æ¨¡å‹ä½“ï¼Œä¸ä»…åŒ…æ‹¬ä¸€ç³»åˆ—æŠ½è±¡çš„æœ¯è¯­æˆ–æ¦‚å¿µï¼Œä¹ŸåŒ…æ‹¬å…·ä½“çš„åè®®ã€‚</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817164927457.png" alt="image-20230817164927457"></p><ol><li>ç‰©ç†å±‚ï¼šä¸»è¦å®šä¹‰ç‰©ç†è®¾å¤‡æ ‡å‡†ï¼Œå¦‚ç½‘çº¿çš„æ¥å£ç±»å‹ã€å…‰çº¤çš„æ¥å£ç±»å‹ã€å„ç§ä¼ è¾“ä»‹è´¨çš„ä¼ è¾“é€Ÿç‡ ç­‰ã€‚å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ä¼ è¾“æ¯”ç‰¹æµï¼ˆå°±æ˜¯ç”±1ã€0è½¬åŒ–ä¸ºç”µæµå¼ºå¼±æ¥è¿›è¡Œä¼ è¾“ï¼Œåˆ°è¾¾ç›®çš„åœ°åå†è½¬åŒ–ä¸º 1ã€0ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„æ•°æ¨¡è½¬æ¢ä¸æ¨¡æ•°è½¬æ¢ï¼‰ã€‚è¿™ä¸€å±‚çš„æ•°æ®å«åšæ¯”ç‰¹ã€‚</li><li>æ•°æ®é“¾è·¯å±‚ï¼šå»ºç«‹é€»è¾‘è¿æ¥ã€è¿›è¡Œç¡¬ä»¶åœ°å€å¯»å€ã€å·®é”™æ ¡éªŒç­‰åŠŸèƒ½ã€‚å®šä¹‰äº†å¦‚ä½•è®©æ ¼å¼åŒ–æ•°æ®ä»¥å¸§ ä¸ºå•ä½è¿›è¡Œä¼ è¾“ï¼Œä»¥åŠå¦‚ä½•è®©æ§åˆ¶å¯¹ç‰©ç†ä»‹è´¨çš„è®¿é—®ã€‚å°†æ¯”ç‰¹ç»„åˆæˆå­—èŠ‚è¿›è€Œç»„åˆæˆå¸§ï¼Œç”¨MACåœ° å€è®¿é—®ä»‹è´¨ã€‚</li><li>ç½‘ç»œå±‚ï¼šè¿›è¡Œé€»è¾‘åœ°å€å¯»å€ï¼Œåœ¨ä½äºä¸åŒåœ°ç†ä½ç½®çš„ç½‘ç»œä¸­çš„ä¸¤ä¸ªä¸»æœºç³»ç»Ÿä¹‹é—´æä¾›è¿æ¥å’Œè·¯å¾„é€‰ æ‹©ã€‚Internetçš„å‘å±•ä½¿å¾—ä»ä¸–ç•Œå„ç«™ç‚¹è®¿é—®ä¿¡æ¯çš„ç”¨æˆ·æ•°å¤§å¤§å¢åŠ ï¼Œè€Œç½‘ç»œå±‚æ­£æ˜¯ç®¡ç†è¿™ç§è¿æ¥çš„ å±‚ã€‚</li><li>ä¼ è¾“å±‚ï¼šå®šä¹‰äº†ä¸€äº›ä¼ è¾“æ•°æ®çš„åè®®å’Œç«¯å£å·ï¼ˆ WWW ç«¯å£ 80 ç­‰ï¼‰ï¼Œå¦‚ï¼šTCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼Œ ä¼ è¾“æ•ˆç‡ä½ï¼Œå¯é æ€§å¼ºï¼Œç”¨äºä¼ è¾“å¯é æ€§è¦æ±‚é«˜ï¼Œæ•°æ®é‡å¤§çš„æ•°æ®ï¼‰ï¼ŒUDPï¼ˆç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼Œä¸ TCP ç‰¹æ€§æ°æ°ç›¸åï¼Œç”¨äºä¼ è¾“å¯é æ€§è¦æ±‚ä¸é«˜ï¼Œæ•°æ®é‡å°çš„æ•°æ®ï¼Œå¦‚ QQ èŠå¤©æ•°æ®å°±æ˜¯é€šè¿‡è¿™ç§æ–¹ å¼ä¼ è¾“çš„ï¼‰ã€‚ ä¸»è¦æ˜¯å°†ä»ä¸‹å±‚æ¥æ”¶çš„æ•°æ®è¿›è¡Œåˆ†æ®µå’Œä¼ è¾“ï¼Œåˆ°è¾¾ç›®çš„åœ°å€åå†è¿›è¡Œé‡ç»„ã€‚å¸¸å¸¸æŠŠè¿™ ä¸€å±‚æ•°æ®å«åšæ®µã€‚</li><li>ä¼šè¯å±‚ï¼šé€šè¿‡ä¼ è¾“å±‚ï¼ˆç«¯å£å·ï¼šä¼ è¾“ç«¯å£ä¸æ¥æ”¶ç«¯å£ï¼‰å»ºç«‹æ•°æ®ä¼ è¾“çš„é€šè·¯ã€‚ä¸»è¦åœ¨ä½ çš„ç³»ç»Ÿä¹‹é—´å‘èµ·ä¼šè¯æˆ–è€…æ¥å—ä¼šè¯è¯·æ±‚ã€‚</li><li>è¡¨ç¤ºå±‚ï¼šæ•°æ®çš„è¡¨ç¤ºã€å®‰å…¨ã€å‹ç¼©ã€‚ä¸»è¦æ˜¯è¿›è¡Œå¯¹æ¥æ”¶çš„æ•°æ®è¿›è¡Œè§£é‡Šã€åŠ å¯†ä¸è§£å¯†ã€å‹ç¼©ä¸è§£å‹ç¼©ç­‰ï¼ˆä¹Ÿå°±æ˜¯æŠŠè®¡ç®—æœºèƒ½å¤Ÿè¯†åˆ«çš„ä¸œè¥¿è½¬æ¢æˆäººèƒ½å¤Ÿèƒ½è¯†åˆ«çš„ä¸œè¥¿ï¼ˆå¦‚å›¾ç‰‡ã€å£°éŸ³ç­‰ï¼‰ã€‚</li><li>åº”ç”¨å±‚ï¼šç½‘ç»œæœåŠ¡ä¸æœ€ç»ˆç”¨æˆ·çš„ä¸€ä¸ªæ¥å£ã€‚è¿™ä¸€å±‚ä¸ºç”¨æˆ·çš„åº”ç”¨ç¨‹åºï¼ˆä¾‹å¦‚ç”µå­é‚®ä»¶ã€æ–‡ä»¶ä¼ è¾“å’Œ ç»ˆç«¯ä»¿çœŸï¼‰æä¾›ç½‘ç»œæœåŠ¡ã€‚</li></ol><h3 id="tcpip-å››å±‚æ¨¡å‹"><a href="#tcpip-å››å±‚æ¨¡å‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#tcpip-å››å±‚æ¨¡å‹"></a> TCP/IP å››å±‚æ¨¡å‹</h3><h4 id="ç®€ä»‹-5"><a href="#ç®€ä»‹-5" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç®€ä»‹-5"></a> ç®€ä»‹</h4><p>ç°åœ¨ Internetï¼ˆå› ç‰¹ç½‘ï¼‰ä½¿ç”¨çš„ä¸»æµåè®®æ—æ˜¯ TCP/IP åè®®æ—ï¼Œå®ƒæ˜¯ä¸€ä¸ªåˆ†å±‚ã€å¤šåè®®çš„é€šä¿¡ä½“ ç³»ã€‚TCP/IPåè®®æ—æ˜¯ä¸€ä¸ªå››å±‚åè®®ç³»ç»Ÿï¼Œè‡ªåº•è€Œä¸Šåˆ†åˆ«æ˜¯æ•°æ®é“¾è·¯å±‚ã€ç½‘ç»œå±‚ã€ä¼ è¾“å±‚å’Œåº”ç”¨ å±‚ã€‚æ¯ä¸€å±‚å®Œæˆä¸åŒçš„åŠŸèƒ½ï¼Œä¸”é€šè¿‡è‹¥å¹²åè®®æ¥å®ç°ï¼Œä¸Šå±‚åè®®ä½¿ç”¨ä¸‹å±‚åè®®æä¾›çš„æœåŠ¡ã€‚</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817165030403.png" alt="image-20230817165030403"></p><p>TCP/IP åè®®åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‚è€ƒäº† OSI çš„ä½“ç³»ç»“æ„ã€‚OSI æ¨¡å‹å…±æœ‰ä¸ƒå±‚ï¼Œä»ä¸‹åˆ°ä¸Šåˆ†åˆ«æ˜¯ç‰©ç†å±‚ã€æ•°æ®é“¾è·¯å±‚ã€ç½‘ç»œå±‚ã€ä¼ è¾“å±‚ã€ä¼šè¯å±‚ã€è¡¨ç¤ºå±‚å’Œåº”ç”¨å±‚ã€‚ä½†æ˜¯è¿™æ˜¾ç„¶æ˜¯æœ‰äº›å¤æ‚çš„ï¼Œæ‰€ä»¥åœ¨ TCP/IP åè®®ä¸­ï¼Œ å®ƒä»¬è¢«ç®€åŒ–ä¸ºäº†å››ä¸ªå±‚æ¬¡ã€‚</p><p>ï¼ˆ1ï¼‰åº”ç”¨å±‚ã€è¡¨ç¤ºå±‚ã€ä¼šè¯å±‚ä¸‰ä¸ªå±‚æ¬¡æä¾›çš„æœåŠ¡ç›¸å·®ä¸æ˜¯å¾ˆå¤§ï¼Œæ‰€ä»¥åœ¨ TCP/IP åè®®ä¸­ï¼Œå®ƒä»¬è¢«åˆå¹¶ä¸ºåº”ç”¨å±‚ä¸€ä¸ªå±‚æ¬¡ã€‚</p><p>ï¼ˆ2ï¼‰ç”±äºä¼ è¾“å±‚å’Œç½‘ç»œå±‚åœ¨ç½‘ç»œåè®®ä¸­çš„åœ°ä½ååˆ†é‡è¦ï¼Œæ‰€ä»¥åœ¨ TCP/IP åè®®ä¸­å®ƒä»¬è¢«ä½œä¸ºç‹¬ç«‹çš„ä¸¤ä¸ªå±‚æ¬¡ã€‚</p><p>ï¼ˆ3ï¼‰å› ä¸ºæ•°æ®é“¾è·¯å±‚å’Œç‰©ç†å±‚çš„å†…å®¹ç›¸å·®ä¸å¤šï¼Œæ‰€ä»¥åœ¨ TCP/IP åè®®ä¸­å®ƒä»¬è¢«å½’å¹¶åœ¨ç½‘ç»œæ¥å£å±‚ä¸€ä¸ªå±‚ æ¬¡é‡Œã€‚åªæœ‰å››å±‚ä½“ç³»ç»“æ„çš„ TCP/IP åè®®ï¼Œä¸æœ‰ä¸ƒå±‚ä½“ç³»ç»“æ„çš„ OSI ç›¸æ¯”è¦ç®€å•äº†ä¸å°‘ï¼Œä¹Ÿæ­£æ˜¯è¿™æ ·ï¼Œ TCP/IP åè®®åœ¨å®é™…çš„åº”ç”¨ä¸­æ•ˆç‡æ›´é«˜ï¼Œæˆæœ¬æ›´ä½ã€‚</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817165057099.png" alt="image-20230817165057099"></p><h4 id="å››å±‚ä»‹ç»"><a href="#å››å±‚ä»‹ç»" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å››å±‚ä»‹ç»"></a> å››å±‚ä»‹ç»</h4><ol><li>åº”ç”¨å±‚ï¼šåº”ç”¨å±‚æ˜¯ TCP/IP åè®®çš„ç¬¬ä¸€å±‚ï¼Œæ˜¯ç›´æ¥ä¸ºåº”ç”¨è¿›ç¨‹æä¾›æœåŠ¡çš„ã€‚<br>ï¼ˆ1ï¼‰å¯¹ä¸åŒç§ç±»çš„åº”ç”¨ç¨‹åºå®ƒä»¬ä¼šæ ¹æ®è‡ªå·±çš„éœ€è¦æ¥ä½¿ç”¨åº”ç”¨å±‚çš„ä¸åŒåè®®ï¼Œé‚®ä»¶ä¼ è¾“åº”ç”¨ä½¿ç”¨ äº† SMTP åè®®ã€ä¸‡ç»´ç½‘åº”ç”¨ä½¿ç”¨äº† HTTP åè®®ã€è¿œç¨‹ç™»å½•æœåŠ¡åº”ç”¨ä½¿ç”¨äº†æœ‰ TELNET åè®®ã€‚<br>ï¼ˆ2ï¼‰åº”ç”¨å±‚è¿˜èƒ½åŠ å¯†ã€è§£å¯†ã€æ ¼å¼åŒ–æ•°æ®ã€‚<br>ï¼ˆ3ï¼‰åº”ç”¨å±‚å¯ä»¥å»ºç«‹æˆ–è§£é™¤ä¸å…¶ä»–èŠ‚ç‚¹çš„è”ç³»ï¼Œè¿™æ ·å¯ä»¥å……åˆ†èŠ‚çœç½‘ç»œèµ„æºã€‚</li><li>ä¼ è¾“å±‚ï¼šä½œä¸º TCP/IP åè®®çš„ç¬¬äºŒå±‚ï¼Œè¿è¾“å±‚åœ¨æ•´ä¸ª TCP/IP åè®®ä¸­èµ·åˆ°äº†ä¸­æµç ¥æŸ±çš„ä½œç”¨ã€‚ä¸”åœ¨è¿è¾“å±‚ä¸­ï¼Œ TCP å’Œ UDP ä¹ŸåŒæ ·èµ·åˆ°äº†ä¸­æµç ¥æŸ±çš„ä½œç”¨ã€‚ ä¹Ÿå¯ä»¥å«è¿è¾“å±‚(æˆ‘ä¸€èˆ¬å«è¿è¾“å±‚)</li><li>ç½‘ç»œå±‚ï¼šç½‘ç»œå±‚åœ¨ TCP/IP åè®®ä¸­çš„ä½äºç¬¬ä¸‰å±‚ã€‚åœ¨ TCP/IP åè®®ä¸­ç½‘ç»œå±‚å¯ä»¥è¿›è¡Œç½‘ç»œè¿æ¥çš„å»ºç«‹ å’Œç»ˆæ­¢ä»¥åŠ IP åœ°å€çš„å¯»æ‰¾ç­‰åŠŸèƒ½ã€‚</li><li>ç½‘ç»œæ¥å£å±‚ï¼šåœ¨ TCP/IP åè®®ä¸­ï¼Œç½‘ç»œæ¥å£å±‚ä½äºç¬¬å››å±‚ã€‚ç”±äºç½‘ç»œæ¥å£å±‚å…¼å¹¶äº†ç‰©ç†å±‚å’Œæ•°æ®é“¾è·¯å±‚æ‰€ä»¥ï¼Œç½‘ç»œæ¥å£å±‚æ—¢æ˜¯ä¼ è¾“æ•°æ®çš„ç‰©ç†åª’ä»‹ï¼Œä¹Ÿå¯ä»¥ä¸ºç½‘ç»œå±‚æä¾›ä¸€æ¡å‡†ç¡®æ— è¯¯çš„çº¿è·¯ã€‚</li></ol><h2 id="åè®®"><a href="#åè®®" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#åè®®"></a> åè®®</h2><h3 id="ç®€ä»‹-6"><a href="#ç®€ä»‹-6" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç®€ä»‹-6"></a> ç®€ä»‹</h3><p>åè®®ï¼Œç½‘ç»œåè®®çš„ç®€ç§°ï¼Œç½‘ç»œåè®®æ˜¯é€šä¿¡è®¡ç®—æœºåŒæ–¹å¿…é¡»å…±åŒéµä»çš„ä¸€ç»„çº¦å®šã€‚å¦‚æ€ä¹ˆæ ·å»ºç«‹è¿ æ¥ã€æ€ä¹ˆæ ·äº’ç›¸è¯†åˆ«ç­‰ã€‚åªæœ‰éµå®ˆè¿™ä¸ªçº¦å®šï¼Œè®¡ç®—æœºä¹‹é—´æ‰èƒ½ç›¸äº’é€šä¿¡äº¤æµã€‚å®ƒçš„ä¸‰è¦ç´ æ˜¯ï¼š<strong>è¯­æ³•ã€è¯­ä¹‰ã€æ—¶åº</strong>ã€‚</p><p>ä¸ºäº†ä½¿æ•°æ®åœ¨ç½‘ç»œä¸Šä»æºåˆ°è¾¾ç›®çš„ï¼Œç½‘ç»œé€šä¿¡çš„å‚ä¸æ–¹å¿…é¡»éµå¾ªç›¸åŒçš„è§„åˆ™ï¼Œè¿™å¥—è§„åˆ™ç§°ä¸ºåè®® ï¼ˆprotocolï¼‰ï¼Œå®ƒæœ€ç»ˆä½“ç°ä¸ºåœ¨ç½‘ç»œä¸Šä¼ è¾“çš„æ•°æ®åŒ…çš„æ ¼å¼ã€‚ åè®®å¾€å¾€åˆ†æˆå‡ ä¸ªå±‚æ¬¡è¿›è¡Œå®šä¹‰ï¼Œåˆ†å±‚å®šä¹‰æ˜¯ä¸ºäº†ä½¿æŸä¸€å±‚åè®®çš„æ”¹å˜ä¸å½±å“å…¶ä»–å±‚æ¬¡çš„åè®®ã€‚</p><h3 id="å¸¸è§åè®®"><a href="#å¸¸è§åè®®" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å¸¸è§åè®®"></a> å¸¸è§åè®®</h3><p>åº”ç”¨å±‚å¸¸è§çš„åè®®æœ‰ï¼šFTPåè®®ï¼ˆFile Transfer Protocol æ–‡ä»¶ä¼ è¾“åè®®ï¼‰ã€HTTPåè®®ï¼ˆHyper Text Transfer Protocol è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰ã€NFSï¼ˆNetwork File System ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼‰ã€‚</p><p>ä¼ è¾“å±‚å¸¸è§åè®®æœ‰ï¼šTCPåè®®ï¼ˆTransmission Control Protocol ä¼ è¾“æ§åˆ¶åè®®ï¼‰ã€UDPåè®®ï¼ˆUser Datagram Protocol ç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰ã€‚</p><p>ç½‘ç»œå±‚å¸¸è§åè®®æœ‰ï¼šIP åè®®ï¼ˆInternet Protocol å› ç‰¹ç½‘äº’è”åè®®ï¼‰ã€ICMP åè®®ï¼ˆInternet Control Message Protocol å› ç‰¹ç½‘æ§åˆ¶æŠ¥æ–‡åè®®ï¼‰ã€IGMP åè®®ï¼ˆInternet Group Management Protocol å› ç‰¹ ç½‘ç»„ç®¡ç†åè®®ï¼‰ã€‚</p><p>ç½‘ç»œæ¥å£å±‚å¸¸è§åè®®æœ‰ï¼šARPåè®®ï¼ˆAddress Resolution Protocol åœ°å€è§£æåè®®ï¼‰ã€RARPåè®® ï¼ˆReverse Address Resolution Protocol åå‘åœ°å€è§£æåè®®ï¼‰ã€‚</p><h3 id="udpåè®®"><a href="#udpåè®®" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#udpåè®®"></a> UDPåè®®</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817171145866.png" alt="image-20230817171145866"></p><h3 id="tcpåè®®"><a href="#tcpåè®®" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#tcpåè®®"></a> TCPåè®®</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817171159785.png" alt="image-20230817171159785"></p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/02/01/image-20230817171216720.png" alt="image-20230817171216720" style="zoom:125%"><h3 id="ipåè®®"><a href="#ipåè®®" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ipåè®®"></a> IPåè®®</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817171259144.png" alt="image-20230817171259144"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817171313342.png" alt="image-20230817171313342"></p><h3 id="ä»¥å¤ªç½‘å¸§åè®®"><a href="#ä»¥å¤ªç½‘å¸§åè®®" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä»¥å¤ªç½‘å¸§åè®®"></a> ä»¥å¤ªç½‘å¸§åè®®</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817171325127.png" alt="image-20230817171325127"></p><h3 id="arpåè®®"><a href="#arpåè®®" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#arpåè®®"></a> ARPåè®®</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817171331187.png" alt="image-20230817171331187"></p><p>ä¾‹å¦‚ï¼Œè¿™é‡Œå°±æ˜¯ä¸€ä¸ªarpè¯·æ±‚åŒ…</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817203353404.png" alt="image-20230817203353404"></p><p>å½“ç„¶ï¼Œéœ€è¦å‘é€å‡ºå»è¿˜è¦åŠ ä¸Šå¸§å¤´å¸§å°¾èƒ½å°è£…æˆä¸ºä¸€ä¸ªå®Œæ•´çš„å¸§</p><h3 id="å°è£…"><a href="#å°è£…" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å°è£…"></a> å°è£…</h3><p>ä¸Šå±‚åè®®æ˜¯å¦‚ä½•ä½¿ç”¨ä¸‹å±‚åè®®æä¾›çš„æœåŠ¡çš„å‘¢ï¼Ÿå…¶å®è¿™æ˜¯é€šè¿‡å°è£…ï¼ˆencapsulationï¼‰å®ç°çš„ã€‚åº”ç”¨ç¨‹åº æ•°æ®åœ¨å‘é€åˆ°ç‰©ç†ç½‘ç»œä¸Šä¹‹å‰ï¼Œå°†æ²¿ç€åè®®æ ˆä»ä¸Šå¾€ä¸‹ä¾æ¬¡ä¼ é€’ã€‚æ¯å±‚åè®®éƒ½å°†åœ¨ä¸Šå±‚æ•°æ®çš„åŸºç¡€ä¸ŠåŠ ä¸Šè‡ªå·±çš„å¤´éƒ¨ä¿¡æ¯ï¼ˆæœ‰æ—¶è¿˜åŒ…æ‹¬å°¾éƒ¨ä¿¡æ¯ï¼‰ï¼Œä»¥å®ç°è¯¥å±‚çš„åŠŸèƒ½ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±ç§°ä¸ºå°è£…ã€‚</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817171342456.png" alt="image-20230817171342456"></p><h3 id="åˆ†ç”¨"><a href="#åˆ†ç”¨" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#åˆ†ç”¨"></a> åˆ†ç”¨</h3><p>å½“å¸§åˆ°è¾¾ç›®çš„ä¸»æœºæ—¶ï¼Œå°†æ²¿ç€åè®®æ ˆè‡ªåº•å‘ä¸Šä¾æ¬¡ä¼ é€’ã€‚å„å±‚åè®®ä¾æ¬¡å¤„ç†å¸§ä¸­æœ¬å±‚è´Ÿè´£çš„å¤´éƒ¨æ•°æ®ï¼Œ ä»¥è·å–æ‰€éœ€çš„ä¿¡æ¯ï¼Œå¹¶æœ€ç»ˆå°†å¤„ç†åçš„å¸§äº¤ç»™ç›®æ ‡åº”ç”¨ç¨‹åºã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºåˆ†ç”¨ï¼ˆdemultiplexingï¼‰ã€‚ åˆ†ç”¨æ˜¯ä¾é å¤´éƒ¨ä¿¡æ¯ä¸­çš„ç±»å‹å­—æ®µå®ç°çš„ã€‚</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817171356559.png" alt="image-20230817171356559"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817171401748.png" alt="image-20230817171401748"></p><h2 id="ç½‘ç»œé€šä¿¡çš„è¿‡ç¨‹"><a href="#ç½‘ç»œé€šä¿¡çš„è¿‡ç¨‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç½‘ç»œé€šä¿¡çš„è¿‡ç¨‹"></a> ç½‘ç»œé€šä¿¡çš„è¿‡ç¨‹</h2><p>ç¤ºæ„å›¾</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817201604241.png" alt="image-20230817201604241"></p><h2 id="socketä»‹ç»"><a href="#socketä»‹ç»" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#socketä»‹ç»"></a> socketä»‹ç»</h2><p>æ‰€è°“ socketï¼ˆå¥—æ¥å­—ï¼‰ï¼Œå°±æ˜¯å¯¹ç½‘ç»œä¸­ä¸åŒä¸»æœºä¸Šçš„åº”ç”¨è¿›ç¨‹ä¹‹é—´è¿›è¡ŒåŒå‘é€šä¿¡çš„ç«¯ç‚¹çš„æŠ½è±¡ã€‚ ä¸€ä¸ªå¥—æ¥å­—å°±æ˜¯ç½‘ç»œä¸Šè¿›ç¨‹é€šä¿¡çš„ä¸€ç«¯ï¼Œæä¾›äº†åº”ç”¨å±‚è¿›ç¨‹åˆ©ç”¨ç½‘ç»œåè®®äº¤æ¢æ•°æ®çš„æœºåˆ¶ã€‚ä»æ‰€å¤„çš„åœ°ä½æ¥è®²ï¼Œå¥—æ¥å­—ä¸Šè”åº”ç”¨è¿›ç¨‹ï¼Œä¸‹è”ç½‘ç»œåè®®æ ˆï¼Œæ˜¯åº”ç”¨ç¨‹åºé€šè¿‡ç½‘ç»œåè®®è¿›è¡Œé€šä¿¡çš„æ¥å£ï¼Œ æ˜¯åº”ç”¨ç¨‹åºä¸ç½‘ç»œåè®®æ ¹è¿›è¡Œäº¤äº’çš„æ¥å£ã€‚</p><p>socket å¯ä»¥çœ‹æˆæ˜¯ä¸¤ä¸ªç½‘ç»œåº”ç”¨ç¨‹åºè¿›è¡Œé€šä¿¡æ—¶ï¼Œå„è‡ªé€šä¿¡è¿æ¥ä¸­çš„ç«¯ç‚¹ï¼Œè¿™æ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¦‚ å¿µã€‚å®ƒæ˜¯ç½‘ç»œç¯å¢ƒä¸­è¿›ç¨‹é—´é€šä¿¡çš„ APIï¼Œä¹Ÿæ˜¯å¯ä»¥è¢«å‘½åå’Œå¯»å€çš„é€šä¿¡ç«¯ç‚¹ï¼Œä½¿ç”¨ä¸­çš„æ¯ä¸€ä¸ªå¥—æ¥ å­—éƒ½æœ‰å…¶ç±»å‹å’Œä¸€ä¸ªä¸ä¹‹ç›¸è¿è¿›ç¨‹ã€‚é€šä¿¡æ—¶å…¶ä¸­ä¸€ä¸ªç½‘ç»œåº”ç”¨ç¨‹åºå°†è¦ä¼ è¾“çš„ä¸€æ®µä¿¡æ¯å†™å…¥å®ƒæ‰€åœ¨ä¸»æœºçš„ socket ä¸­ï¼Œè¯¥ socket é€šè¿‡ä¸ç½‘ç»œæ¥å£å¡ï¼ˆNICï¼‰ç›¸è¿çš„ä¼ è¾“ä»‹è´¨å°†è¿™æ®µä¿¡æ¯é€åˆ°å¦å¤–ä¸€å°ä¸»æœºçš„ socket ä¸­ï¼Œä½¿å¯¹æ–¹èƒ½å¤Ÿæ¥æ”¶åˆ°è¿™æ®µä¿¡æ¯ã€‚socket æ˜¯ç”± IP åœ°å€å’Œç«¯å£ç»“åˆçš„ï¼Œæä¾›å‘åº”ç”¨ å±‚è¿›ç¨‹ä¼ é€æ•°æ®åŒ…çš„æœºåˆ¶ã€‚</p><p><strong>socket æœ¬èº«æœ‰â€œæ’åº§â€çš„æ„æ€ï¼Œåœ¨ Linux ç¯å¢ƒä¸‹ï¼Œç”¨äºè¡¨ç¤ºè¿›ç¨‹é—´ç½‘ç»œé€šä¿¡çš„ç‰¹æ®Šæ–‡ä»¶ç±»å‹ã€‚æœ¬è´¨ä¸ºå†…æ ¸å€ŸåŠ©ç¼“å†²åŒºå½¢æˆçš„ä¼ªæ–‡ä»¶ã€‚æ—¢ç„¶æ˜¯æ–‡ä»¶ï¼Œé‚£ä¹ˆç†æ‰€å½“ç„¶çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦å¼•ç”¨å¥—æ¥å­—ã€‚ä¸ç®¡é“ç±»ä¼¼çš„ï¼Œä¹Ÿå­˜åœ¨è¯»å†™ç¼“å†²åŒºï¼Œå†™æ–¹å‘å†™çš„ç¼“å†²åŒºå†™å…¥æ•°æ®ï¼Œè¯»æ–¹æ¥æ”¶åˆ°æ•°æ®åœ¨è¯»ç¼“å†²åŒºä¸­ï¼Œè¿™å°±å½¢æˆäº†æ•°æ®çš„ä¼ é€’ï¼ŒLinux ç³»ç»Ÿå°†å…¶å°è£…æˆæ–‡ä»¶çš„ç›®çš„æ˜¯ä¸ºäº†ç»Ÿä¸€æ¥å£ï¼Œä½¿å¾—è¯»å†™å¥—æ¥å­—å’Œè¯»å†™æ–‡ä»¶çš„æ“ä½œä¸€è‡´ã€‚åŒºåˆ«æ˜¯ç®¡é“ä¸»è¦åº”ç”¨äºæœ¬åœ°è¿›ç¨‹é—´é€šä¿¡ï¼Œè€Œå¥—æ¥å­—å¤šåº”ç”¨äºç½‘ç»œè¿›ç¨‹é—´æ•°æ®çš„ä¼ é€’ã€‚</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230817210404237.png" alt="image-20230817210404237"></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¥—æ¥å­—é€šä¿¡åˆ†ä¸¤éƒ¨åˆ†ï¼š</span></span><br><span class="line">- æœåŠ¡å™¨ç«¯ï¼šè¢«åŠ¨æ¥å—è¿æ¥ï¼Œä¸€èˆ¬ä¸ä¼šä¸»åŠ¨å‘èµ·è¿æ¥</span><br><span class="line">- å®¢æˆ·ç«¯ï¼šä¸»åŠ¨å‘æœåŠ¡å™¨å‘èµ·è¿æ¥</span><br><span class="line">socketæ˜¯ä¸€å¥—é€šä¿¡çš„æ¥å£ï¼ŒLinux å’Œ Windows éƒ½æœ‰ï¼Œä½†æ˜¯æœ‰ä¸€äº›ç»†å¾®çš„å·®åˆ«</span><br></pre></td></tr></table></div></figure><h2 id="å­—èŠ‚åº"><a href="#å­—èŠ‚åº" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å­—èŠ‚åº"></a> å­—èŠ‚åº</h2><h3 id="ç®€ä»‹-7"><a href="#ç®€ä»‹-7" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç®€ä»‹-7"></a> ç®€ä»‹</h3><p>ç°ä»£ CPU çš„ç´¯åŠ å™¨ä¸€æ¬¡éƒ½èƒ½è£…è½½ï¼ˆè‡³å°‘ï¼‰4 å­—èŠ‚ï¼ˆè¿™é‡Œè€ƒè™‘ 32 ä½æœºï¼‰ï¼Œå³ä¸€ä¸ªæ•´æ•°ã€‚é‚£ä¹ˆè¿™ 4 å­—èŠ‚åœ¨å†…å­˜ä¸­æ’åˆ—çš„é¡ºåºå°†å½±å“å®ƒè¢«ç´¯åŠ å™¨è£…è½½æˆçš„æ•´æ•°çš„å€¼ï¼Œè¿™å°±æ˜¯å­—èŠ‚åºé—®é¢˜ã€‚åœ¨å„ç§è®¡ç®—æœº ä½“ç³»ç»“æ„ä¸­ï¼Œå¯¹äºå­—èŠ‚ã€å­—ç­‰çš„å­˜å‚¨æœºåˆ¶æœ‰æ‰€ä¸åŒï¼Œå› è€Œå¼•å‘äº†è®¡ç®—æœºé€šä¿¡é¢†åŸŸä¸­ä¸€ä¸ªå¾ˆé‡è¦çš„é—® é¢˜ï¼Œå³é€šä¿¡åŒæ–¹äº¤æµçš„ä¿¡æ¯å•å…ƒï¼ˆæ¯”ç‰¹ã€å­—èŠ‚ã€å­—ã€åŒå­—ç­‰ç­‰ï¼‰åº”è¯¥ä»¥ä»€ä¹ˆæ ·çš„é¡ºåºè¿›è¡Œä¼ é€ã€‚å¦‚ // å¥—æ¥å­—é€šä¿¡åˆ†ä¸¤éƒ¨åˆ†ï¼š - æœåŠ¡å™¨ç«¯ï¼šè¢«åŠ¨æ¥å—è¿æ¥ï¼Œä¸€èˆ¬ä¸ä¼šä¸»åŠ¨å‘èµ·è¿æ¥ - å®¢æˆ·ç«¯ï¼šä¸»åŠ¨å‘æœåŠ¡å™¨å‘èµ·è¿æ¥ socketæ˜¯ä¸€å¥—é€šä¿¡çš„æ¥å£ï¼ŒLinux å’Œ Windows éƒ½æœ‰ï¼Œä½†æ˜¯æœ‰ä¸€äº›ç»†å¾®çš„å·®åˆ«ã€‚ æœä¸è¾¾æˆä¸€è‡´çš„è§„åˆ™ï¼Œé€šä¿¡åŒæ–¹å°†æ— æ³•è¿›è¡Œæ­£ç¡®çš„ç¼–ç /è¯‘ç ä»è€Œå¯¼è‡´é€šä¿¡å¤±è´¥ã€‚</p><p><strong>å­—èŠ‚åºï¼Œé¡¾åæ€ä¹‰å­—èŠ‚çš„é¡ºåºï¼Œå°±æ˜¯å¤§äºä¸€ä¸ªå­—èŠ‚ç±»å‹çš„æ•°æ®åœ¨å†…å­˜ä¸­çš„å­˜æ”¾é¡ºåº(ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®å½“ç„¶å°±æ— éœ€è°ˆé¡ºåºçš„é—®é¢˜äº†)ã€‚</strong></p><p><strong>å­—èŠ‚åºåˆ†ä¸ºå¤§ç«¯å­—èŠ‚åºï¼ˆBig-Endianï¼‰ å’Œå°ç«¯å­—èŠ‚åºï¼ˆLittle-Endianï¼‰ã€‚å¤§ç«¯å­—èŠ‚åºæ˜¯æŒ‡ä¸€ä¸ªæ•´æ•°çš„é«˜ä½å­—èŠ‚å­˜å‚¨åœ¨å†…å­˜çš„ä½åœ°å€å¤„ï¼Œä½ä½å­—èŠ‚å­˜å‚¨åœ¨å†…å­˜çš„é«˜åœ°å€å¤„ï¼›å°ç«¯å­—èŠ‚åºåˆ™æ˜¯æŒ‡æ•´æ•°çš„é«˜ä½å­—èŠ‚å­˜å‚¨åœ¨å†…å­˜çš„é«˜åœ°å€å¤„ï¼Œè€Œä½ä½å­—èŠ‚åˆ™å­˜å‚¨åœ¨å†…å­˜çš„ä½åœ°å€å¤„ã€‚</strong></p><h3 id="å­—èŠ‚åºä¸¾ä¾‹"><a href="#å­—èŠ‚åºä¸¾ä¾‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å­—èŠ‚åºä¸¾ä¾‹"></a> å­—èŠ‚åºä¸¾ä¾‹</h3><p><strong>å°ç«¯å­—èŠ‚åºæ˜¯ä½ä½å­—èŠ‚å­˜å‚¨åœ¨å†…å­˜çš„ä½åœ°å€å¤„ï¼Œé«˜ä½å­—èŠ‚å­˜å‚¨åœ¨å†…å­˜çš„é«˜åœ°å€å¤„ï¼›å¤§ç«¯å­—èŠ‚åºåˆ™ç›¸å!!!</strong></p><p><strong>å›¾ä¸­çš„0x11å°±æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼Œå› ä¸ºä»–æ˜¯ç”¨16è¿›åˆ¶è¡¨ç¤ºçš„ï¼Œä¹Ÿå°±æ˜¯0x11å¯¹åº”çš„11æ˜¯8ä¸ªbitï¼Œç„¶åå°±æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼Œè¿™ä¸ªæ•°å°±æ˜¯è¿™ä¹ˆå­˜å‚¨ä¸‹æ¥çš„ï¼Œå› æ­¤å°±æœ‰äº†é«˜ä½å­—èŠ‚å’Œä½ä½å­—èŠ‚åœ¨å†…å­˜ä¸­çš„é¡ºåºé—®é¢˜</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230818092738767.png" alt="image-20230818092738767"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230818092744993.png" alt="image-20230818092744993"></p><p>å¥½ï¼Œæˆ‘ä»¬äº†è§£äº†è¿™äº›å°±å¯ä»¥å†™ä¸€ä¸ªæµ‹è¯•æ ·ä¾‹æ¥æŸ¥çœ‹æˆ‘ä»¬çš„ä¸»æœºæ˜¯å°ç«¯å­—èŠ‚åºè¿˜æ˜¯å¤§ç«¯å­—èŠ‚åº(è®°å¿†ï¼šå°ç«¯å­—èŠ‚åºå°±æ˜¯å†…å­˜é«˜ä½å¯¹åº”æ•°é‡Œé¢çš„é«˜ä½)</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å­—èŠ‚åºï¼šå­—èŠ‚åœ¨å†…å­˜ä¸­å­˜å‚¨çš„é¡ºåº</span></span><br><span class="line"><span class="comment">å°ç«¯å­—èŠ‚åºï¼šæ•°æ®çš„é«˜ä½å­—èŠ‚å­˜å‚¨åœ¨å†…å­˜çš„é«˜ä½åœ°å€ï¼Œä½ä½å­—èŠ‚å­˜å‚¨åœ¨å†…å­˜çš„ä½ä½åœ°å€</span></span><br><span class="line"><span class="comment">å¤§ç«¯å­—èŠ‚åºï¼šæ•°æ®çš„é«˜ä½å­—èŠ‚å­˜å‚¨åœ¨å†…å­˜çš„ä½ä½åœ°å€ï¼Œä½ä½å­—èŠ‚å­˜å‚¨åœ¨å†…å­˜çš„é«˜ä½åœ°å€(ä¸å‰é¢çš„ç›¸å)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡ä»£ç æ£€æµ‹å½“å‰ä¸»æœºçš„å­—èŠ‚åº</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è”åˆé‡Œé¢çš„æ•°æ®åœ°å€çš„èµ·å§‹ä½ç½®éƒ½æ˜¯ä»å¤´å¼€å§‹çš„ï¼Œå› æ­¤æŒ‡å‘çš„å†…å­˜å¾ˆå¤§æ¦‚ç‡æ˜¯æœ‰é‡å¤çš„</span></span><br><span class="line"><span class="keyword">union</span> <span class="title class_">Fuck</span> &#123;</span><br><span class="line">    <span class="type">short</span> value;                <span class="comment">// ä¸¤ä¸ªå­—èŠ‚</span></span><br><span class="line">    <span class="type">char</span> bytes[<span class="built_in">sizeof</span>(<span class="type">short</span>)];  <span class="comment">// ä¸¤ä¸ªå­—èŠ‚çš„æ•°ç»„ï¼Œå¯ä»¥æŸ¥çœ‹ä¸¤ä¸ªå­—èŠ‚åˆ†æˆä¸€åŠæ˜¯æ€ä¹ˆå­˜å‚¨çš„</span></span><br><span class="line">&#125; test;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    test.value = <span class="number">0x0102</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (test.bytes[<span class="number">0</span>] == <span class="number">1</span> &amp;&amp; test.bytes[<span class="number">1</span>] == <span class="number">2</span>)  <span class="comment">// æ•°æ®çš„é«˜ä½å¯¹åº”å­—èŠ‚å­˜å‚¨çš„ä½ä½ï¼Œåˆ™ä¸ºå¤§ç«¯å­—èŠ‚åº</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;å¤§ç«¯å­—èŠ‚åº\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;å°ç«¯å­—èŠ‚åº\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;a</span><br></pre></td></tr></table></div></figure><p>å½“ç„¶ï¼Œè¿™ä¸ªä»£ç ç®€åŒ–ä¸€ä¸‹ä¸€è¡Œå°±å¯ä»¥æå®š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cout &lt;&lt; (<span class="built_in">char</span>(<span class="number">0x0102</span>) == <span class="number">0x02</span> ? <span class="string">&quot;å°ç«¯å­—èŠ‚åº&quot;</span> : <span class="string">&quot;å¤§ç«¯å­—èŠ‚åº&quot;</span>) &lt;&lt; endl;  <span class="comment">// è¿™ä¹ˆå†™æ›´åŠ ç®€å•</span></span><br></pre></td></tr></table></div></figure><h3 id="å­—èŠ‚åºè½¬æ¢å‡½æ•°"><a href="#å­—èŠ‚åºè½¬æ¢å‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å­—èŠ‚åºè½¬æ¢å‡½æ•°"></a> å­—èŠ‚åºè½¬æ¢å‡½æ•°</h3><p><strong>å½“æ ¼å¼åŒ–çš„æ•°æ®åœ¨ä¸¤å°ä½¿ç”¨ä¸åŒå­—èŠ‚åºçš„ä¸»æœºä¹‹é—´ç›´æ¥ä¼ é€’æ—¶ï¼Œæ¥æ”¶ç«¯å¿…ç„¶é”™è¯¯çš„è§£é‡Šä¹‹ã€‚è§£å†³é—®é¢˜çš„æ–¹æ³•æ˜¯ï¼šå‘é€ç«¯æ€»æ˜¯æŠŠè¦å‘é€çš„æ•°æ®è½¬æ¢æˆå¤§ç«¯å­—èŠ‚åºæ•°æ®åå†å‘é€ï¼Œè€Œæ¥æ”¶ç«¯çŸ¥é“å¯¹æ–¹ä¼ é€è¿‡æ¥çš„æ•°æ®æ€»æ˜¯é‡‡ç”¨å¤§ç«¯å­—èŠ‚åºï¼Œæ‰€ä»¥æ¥æ”¶ç«¯å¯ä»¥æ ¹æ®è‡ªèº«é‡‡ç”¨çš„å­—èŠ‚åºå†³å®šæ˜¯å¦å¯¹æ¥æ”¶åˆ°çš„æ•°æ®è¿›è¡Œè½¬æ¢ï¼ˆå°ç«¯æœºè½¬æ¢ï¼Œå¤§ç«¯æœºä¸è½¬æ¢ï¼‰ã€‚</strong></p><p>å› æ­¤ï¼Œ<strong>åœ¨ç½‘ç»œä¸­ï¼Œæˆ‘ä»¬è§„å®šéƒ½ç”¨å¤§ç«¯å­—èŠ‚åºä¼ é€’æ•°æ®ï¼Œç§°ä¸ºç½‘ç»œå­—èŠ‚åº</strong></p><p><strong>ç½‘ç»œå­—èŠ‚é¡ºåº</strong>æ˜¯ TCP/IP ä¸­è§„å®šå¥½çš„ä¸€ç§æ•°æ®è¡¨ç¤ºæ ¼å¼ï¼Œå®ƒä¸å…·ä½“çš„ CPU ç±»å‹ã€æ“ä½œç³»ç»Ÿç­‰æ— å…³ï¼Œä»è€Œ å¯ä»¥ä¿è¯æ•°æ®åœ¨ä¸åŒä¸»æœºä¹‹é—´ä¼ è¾“æ—¶èƒ½å¤Ÿè¢«æ­£ç¡®è§£é‡Šï¼Œç½‘ç»œå­—èŠ‚é¡ºåºé‡‡ç”¨å¤§ç«¯æ’åºæ–¹å¼ã€‚</p><p>BSD Socketæä¾›äº†å°è£…å¥½çš„è½¬æ¢æ¥å£ï¼Œæ–¹ä¾¿ç¨‹åºå‘˜ä½¿ç”¨ã€‚åŒ…æ‹¬ä»ä¸»æœºå­—èŠ‚åºåˆ°ç½‘ç»œå­—èŠ‚åºçš„è½¬æ¢å‡½æ•°ï¼š htonsã€htonlï¼›ä»ç½‘ç»œå­—èŠ‚åºåˆ°ä¸»æœºå­—èŠ‚åºçš„è½¬æ¢å‡½æ•°ï¼šntohsã€ntohlã€‚</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">h - host ä¸»æœºï¼Œä¸»æœºå­—èŠ‚åº</span><br><span class="line">to - è½¬æ¢æˆä»€ä¹ˆ</span><br><span class="line">n - network ç½‘ç»œå­—èŠ‚åº</span><br><span class="line">s - <span class="type">short</span> <span class="type">unsigned</span> <span class="type">short</span></span><br><span class="line">l - <span class="type">long</span> <span class="type">unsigned</span> <span class="type">int</span></span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="comment">// è½¬æ¢ç«¯å£ ç«¯å£å· 0-65535ï¼Œå°±æ˜¯16ä½ï¼Œå› æ­¤æ˜¯ uint16_t</span></span><br><span class="line"><span class="function"><span class="type">uint16_t</span> <span class="title">htons</span><span class="params">(<span class="type">uint16_t</span> hostshort)</span></span>; <span class="comment">// ä¸»æœºå­—èŠ‚åº - ç½‘ç»œå­—èŠ‚åº</span></span><br><span class="line"><span class="function"><span class="type">uint16_t</span> <span class="title">ntohs</span><span class="params">(<span class="type">uint16_t</span> netshort)</span></span>; <span class="comment">// ä¸»æœºå­—èŠ‚åº - ç½‘ç»œå­—èŠ‚åº</span></span><br><span class="line"><span class="comment">// è½¬IP IPåœ°å€ï¼ŒIPV4æ˜¯32ä½ï¼Œå› æ­¤æ˜¯uint32_t</span></span><br><span class="line"><span class="function"><span class="type">uint32_t</span> <span class="title">htonl</span><span class="params">(<span class="type">uint32_t</span> hostlong)</span></span>; <span class="comment">// ä¸»æœºå­—èŠ‚åº - ç½‘ç»œå­—èŠ‚åº</span></span><br><span class="line"><span class="function"><span class="type">uint32_t</span> <span class="title">ntohl</span><span class="params">(<span class="type">uint32_t</span> netlong)</span></span>; <span class="comment">// ä¸»æœºå­—èŠ‚åº - ç½‘ç»œå­—èŠ‚åº</span></span><br></pre></td></tr></table></div></figure><p>æˆ‘ä»¬å†™ä¸€ä¸ªæµ‹è¯•æ¡ˆä¾‹æ¥æ¼”ç¤ºä¸€ä¸‹è¿™å‡ ä¸ªå‡½æ•°</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    ç½‘ç»œé€šä¿¡æ—¶ï¼Œéœ€è¦å°†ä¸»æœºå­—èŠ‚åºè½¬åŒ–ä¸ºç½‘ç»œå­—èŠ‚åº(å¤§ç«¯)</span></span><br><span class="line"><span class="comment">    å¦å¤–ä¸€ç«¯è·å–åˆ°æ•°æ®ä»¥åï¼Œæ ¹æ®æƒ…å†µå°†ç½‘ç»œå­—èŠ‚åºè½¬æ¢ä¸ºä¸»æœºå­—èŠ‚åº</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    #include &lt;arpa/inet.h&gt;</span></span><br><span class="line"><span class="comment">    // è½¬æ¢ç«¯å£ ç«¯å£å· 0-65535ï¼Œå°±æ˜¯16ä½ï¼Œå› æ­¤æ˜¯ uint16_t</span></span><br><span class="line"><span class="comment">    uint16_t htons(uint16_t hostshort); // ä¸»æœºå­—èŠ‚åº - ç½‘ç»œå­—èŠ‚åº</span></span><br><span class="line"><span class="comment">    uint16_t ntohs(uint16_t netshort); // ä¸»æœºå­—èŠ‚åº - ç½‘ç»œå­—èŠ‚åº</span></span><br><span class="line"><span class="comment">    // è½¬IP IPåœ°å€ï¼ŒIPV4æ˜¯32ä½ï¼Œå› æ­¤æ˜¯uint32_t</span></span><br><span class="line"><span class="comment">    uint32_t htonl(uint32_t hostlong); // ä¸»æœºå­—èŠ‚åº - ç½‘ç»œå­—èŠ‚åº</span></span><br><span class="line"><span class="comment">    uint32_t ntohl(uint32_t netlong); // ä¸»æœºå­—èŠ‚åº - ç½‘ç»œå­—èŠ‚åº</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// htons() è½¬æ¢ç«¯å£</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> a = <span class="number">0x0102</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;a : %x\n&quot;</span>, a);</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> b = <span class="built_in">htons</span>(a);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;b : %x\n&quot;</span>, b);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;----------------------------------------------\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// htonl() è½¬æ¢IP</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œç”¨charä¼šæŠ¥ narrowing conversion ç¼©çª„è½¬æ¢</span></span><br><span class="line">    <span class="comment">// è¿™æ˜¯c++11åœ¨ä½¿ç”¨åˆå§‹åŒ–åºåˆ—æ—¶å€™ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨åˆ¤æ–­ï¼Œå¦‚æœå‘ç”Ÿç¼©çª„è½¬æ¢å°±ä¼šæŠ¥é”™</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> buf[<span class="number">4</span>] = &#123;<span class="number">192</span>, <span class="number">168</span>, <span class="number">1</span>, <span class="number">100</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> num = *(<span class="type">int</span>*)buf;</span><br><span class="line">    <span class="type">int</span> ans = <span class="built_in">htonl</span>(num);</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span>* p = (<span class="type">unsigned</span> <span class="type">char</span>*)&amp;ans;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%u %u %u %u\n&quot;</span>, *p, *(p + <span class="number">1</span>), *(p + <span class="number">2</span>), *(p + <span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;----------------------------------------------\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ntohl()</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> buf1[<span class="number">4</span>] = &#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">168</span>, <span class="number">192</span>&#125;;</span><br><span class="line">    <span class="type">int</span> num1 = *(<span class="type">int</span>*)buf1;</span><br><span class="line">    <span class="type">int</span> ans1 = <span class="built_in">ntohl</span>(num1);</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span>* p1 = (<span class="type">unsigned</span> <span class="type">char</span>*)&amp;ans1;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%u %u %u %u\n&quot;</span>, *p1, *(p1 + <span class="number">1</span>), *(p1 + <span class="number">2</span>), *(p1 + <span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p><strong>æˆ‘ä»¬æ¥è§£é‡Šä¸€ä¸‹é‡Œé¢çš„ä¸€äº›ä¸œè¥¿ï¼Œå€¼å¾—æˆ‘ä»¬æ·±æ€</strong></p><p><strong>åœ¨c<ins>11å½“ä¸­æ–°å¢äº†ä¸€ä¸ª narrowing convertionsï¼Œå°±æ˜¯ç¼©çª„è½¬æ¢ï¼›ä»–çš„è§„å®šæ˜¯c</ins>11ä¹‹åå¼•å…¥äº†ä¸€ä¸ªæ–°ç‰¹æ€§å°±æ˜¯åˆ—è¡¨åˆå§‹åŒ–initializer_listï¼Œåœ¨ç”¨åˆå§‹åŒ–åˆ—è¡¨åˆå§‹åŒ–å€¼çš„æ—¶å€™ä¸å…è®¸å‘ç”Ÿç±»å‹çš„ç¼©çª„è½¬æ¢</strong></p><p><strong>æ¯”å¦‚ï¼š</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt; tmp &#123;<span class="number">1</span>,<span class="number">2.2</span>&#125;; </span><br><span class="line"><span class="comment">//è¿™é‡Œä¸å…è®¸å°†doubleç±»å‹çš„2.2è½¬åŒ–ä¸ºintç±»å‹ï¼Œåœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­ï¼Œå› ä¸ºdoubleç±»å‹çš„èŒƒå›´æ¯”intç±»å‹æ›´å®½(è¿™æ˜¯æ–°è§„å®šçš„)</span></span><br></pre></td></tr></table></div></figure><p><strong>ä½†æ˜¯</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> num = <span class="built_in">double</span>(<span class="number">2.2</span>);</span><br><span class="line"><span class="comment">//è¿™è¡Œä»£ç æ˜¾ç„¶æ˜¯åˆæ³•çš„ï¼Œæ²¡æœ‰ç”¨initializer_listï¼Œnumçš„å€¼æ˜¾ç„¶ä¸º2</span></span><br></pre></td></tr></table></div></figure><p><strong>æˆ‘ä»¬å†ä¸¾ä¸€ä¸ªä¾‹å­ï¼š</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">a</span><span class="params">(<span class="type">double</span>(<span class="number">2.2</span>))</span></span>;</span><br><span class="line"><span class="type">int</span> a&#123;<span class="built_in">double</span>(<span class="number">2.2</span>)&#125;;</span><br></pre></td></tr></table></div></figure><p><strong>ç±»ä¼¼çš„ä¸¤è¡Œä»£ç ï¼Œç¬¬ä¸€ä¸ªä½¿ç”¨çš„æ˜¯æ„é€ å‡½æ•°ï¼Œç¬¬äºŒä¸ªè°ƒç”¨çš„æ˜¯initializer_listï¼Œåœ¨c++11æ ‡å‡†ä¸‹ï¼Œç¬¬ä¸€ä¸ªæ˜¯å¯ä»¥é€šè¿‡ç¼–è¯‘çš„ï¼Œç¬¬äºŒä¼šæŠ¥é”™ï¼ŒåŸå› æ˜¯narrowing convertionsï¼Œç¼©çª„å˜æ¢</strong></p><p><strong>å¯¹åº”åˆ°æˆ‘ä»¬è¿™é‡Œï¼Œæˆ‘ä»¬çœ‹è¿™ä¸€è¡Œä»£ç ï¼š</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">char</span> buf[<span class="number">4</span>] = &#123;<span class="number">192</span>, <span class="number">168</span>, <span class="number">1</span>, <span class="number">100</span>&#125;;</span><br></pre></td></tr></table></div></figure><p><strong>ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¼šé€‰æ‹©unsigned char è€Œä¸æ˜¯ charï¼Ÿ</strong></p><p><strong>æˆ‘ä»¬çŸ¥é“ï¼Œcè¯­è¨€å†…ç½®çš„ç±»å‹éƒ½æ˜¯signedï¼Œå³æœ‰ç¬¦å·çš„ï¼Œæ‰€ä»¥ä»¥charä¸ºä¾‹ï¼Œæ˜¯1ä¸ªå­—èŠ‚ï¼Œè¡¨ç¤ºçš„èŒƒå›´ä¸º-128åˆ°127ï¼Œ8ä½æ•°ï¼Œç¬¬ä¸€ä½æ‹¿æ¥è¡¨ç¤ºç¬¦å·ï¼Œ1ä¸ºè´Ÿï¼Œ0ä¸ºæ­£ï¼Œç„¶å-128æ˜¯ç”¨æ¥è¡¨ç¤º-0ï¼Œå’Œ+0ç”¨äºåŒºåˆ†ï¼›ç„¶åæˆ‘ä»¬å›¾ä¸­ä¼ å…¥çš„æ˜¯192ï¼Œ168ï¼Œè¿™ä¸¤ä¸ªå¦‚æœè¦æƒ³è½¬åŒ–ä¸ºcharç±»å‹çš„è¯é‚£å°±æ˜¯è´Ÿæ•°ï¼Œä½†æ˜¯åœ¨initializer_listå½“ä¸­å°±ä¸å…è®¸è¿™æ ·çš„ç¼©çª„è½¬æ¢ï¼Œå°±æ˜¯æŠŠintç±»å‹è½¬åŒ–ä¸ºcharç±»å‹ï¼Œå› ä¸ºè¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹å‡º192å·²ç»è¶…è¿‡äº†-128åˆ°127çš„èŒƒå›´</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">char</span>(<span class="number">192</span>);</span><br></pre></td></tr></table></div></figure><p><strong>è™½ç„¶æˆ‘ä»¬è¿™ä¹ˆå†™æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå­˜å…¥çš„æ•°å­—åº”è¯¥æ˜¯-64ï¼Œä½†æ˜¯initializer_listä¸­ä¼šè¢«è®¤ä¸ºæ˜¯ç¼©çª„è½¬æ¢ï¼Œæ‰€ä»¥ä¸å…è®¸è¿™ä¹ˆåš</strong></p><p><strong>ä½†æ˜¯æˆ‘ä»¬å†æ¥çœ‹unsigned charï¼Œç”±äºç½‘ç»œå­—èŠ‚å½“ä¸­çš„ä¸ç®¡æ˜¯IPè¿˜æ˜¯portç«¯å£éƒ½æ˜¯æ— ç¬¦å·ï¼Œä¹Ÿå°±æ˜¯éè´Ÿçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€‰æ‹©unsignedï¼Œå…¶æ¬¡ï¼Œè¿™é‡Œçš„IPåœ°å€ï¼Œä¸€ä¸ªå­—èŠ‚çš„èŒƒå›´æ˜¯0-255ï¼Œè€Œunsigned charçš„è¡¨ç¤ºèŒƒå›´æ°å¥½å°±æ˜¯0-255ï¼Œä»–ä»¬æŠŠè´Ÿæ•°è¡¨ç¤ºä¸ºå¯¹åº”çš„è¡¥ç ï¼Œæ‰€ä»¥èŒƒå›´æ°å¥½å®Œç¾å¯¹åº”ï¼Œå½“ç„¶å¦‚æœæ•°åœ¨å¤§ä¸€ç‚¹å¯èƒ½ä¼šå‡ºé—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬å¯¹åº”çš„æ˜¯å®é™…çš„IPæƒ…å†µï¼Œæ‰€ä»¥å°±èƒ½åº”å¯¹äº†ï¼Œå› æ­¤è¿™é‡Œçš„ç±»å‹æˆ‘ä»¬é€‰æ‹©unsigned char</strong></p><p><strong>è€ŒCè¯­è¨€å¦‚æœæˆ‘ä»¬ç”¨charæˆ–è€…ä½ç‰ˆæœ¬çš„c++ï¼Œä¾‹å¦‚c<ins>98è¿™ç§ï¼Œå°±ä¸ä¼šæŠ¥é”™ï¼Œå› ä¸ºè¿™æ˜¯è¯­æ³•å®šä¹‰çš„å¯¹æ•°ç»„åˆå§‹åŒ–ï¼Œåªä¸è¿‡c</ins>11ä¹‹åå¼•å…¥äº†ä¸€ä¸ªæ›´åŠ å‰å®³çš„initializer_listè€Œå·²</strong></p><h2 id="socketåœ°å€"><a href="#socketåœ°å€" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#socketåœ°å€"></a> socketåœ°å€</h2><p><strong>ä¸»è¦æ˜¯ç”¨æ¥å°è£…IPå’Œç«¯å£å·portçš„ä¿¡æ¯</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// socketåœ°å€å…¶å®æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œå°è£…ç«¯å£å·å’ŒIPç­‰ä¿¡æ¯ã€‚åé¢çš„socketç›¸å…³çš„apiä¸­éœ€è¦ä½¿ç”¨åˆ°è¿™ä¸ªsocketåœ°å€ã€‚</span></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯ -&gt; æœåŠ¡å™¨ï¼ˆIP, Portï¼‰</span></span><br></pre></td></tr></table></div></figure><h3 id="é€šç”¨socketåœ°å€"><a href="#é€šç”¨socketåœ°å€" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#é€šç”¨socketåœ°å€"></a> é€šç”¨socketåœ°å€</h3><p>socket ç½‘ç»œç¼–ç¨‹æ¥å£ä¸­è¡¨ç¤º socket åœ°å€çš„æ˜¯ç»“æ„ä½“ sockaddrï¼Œè¿™ä¸ªåœ¨ä¸€èˆ¬æ˜¯é€šç”¨çš„ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/socket.h&gt;</span></span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr</span> &#123;</span><br><span class="line">    <span class="type">sa_family_t</span> sa_family;</span><br><span class="line">    <span class="type">char</span> sa_data[<span class="number">14</span>]; <span class="comment">//å­˜å‚¨æ•°æ®ï¼ŒåŒ…æ‹¬IPå’Œç«¯å£å·çš„ä¿¡æ¯</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">short</span> <span class="type">int</span> <span class="type">sa_family_t</span>;</span><br></pre></td></tr></table></div></figure><p><strong>è¿™ä¸ªç»“æ„ä½“dataéƒ¨åˆ†çš„é•¿åº¦æœ€å¤§æ˜¯14ä¸ªå­—èŠ‚ï¼Œç„¶åä¸‹é¢ä¼šçœ‹å‡ºå…¶ä»–ä¸¤ç§éƒ½å¯èƒ½ä¼šè¶…å‡º14ä¸ªå­—èŠ‚ï¼Œè€ŒIPv4å°±6ä¸ªå­—èŠ‚ï¼Œå¯ä»¥å­˜æ”¾ä¸‹ï¼Œå› æ­¤ç»å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯ç»™IPv4ä½¿ç”¨çš„</strong></p><p>**sa_family æˆå‘˜æ˜¯åœ°å€æ—ç±»å‹ï¼ˆsa_family_tï¼‰çš„å˜é‡ã€‚**åœ°å€æ—ç±»å‹é€šå¸¸ä¸åè®®æ—ç±»å‹å¯¹åº”ã€‚å¸¸è§çš„åè®®æ—ï¼ˆprotocol familyï¼Œä¹Ÿç§° domainï¼‰å’Œå¯¹åº”çš„åœ°å€æ—å…¥ä¸‹æ‰€ç¤ºï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230818115634758.png" alt="image-20230818115634758"></p><p>å® PF_ * å’Œ AF_ * éƒ½å®šä¹‰åœ¨ bits/socket.h å¤´æ–‡ä»¶ä¸­ï¼Œä¸”åè€…ä¸å‰è€…æœ‰å®Œå…¨ç›¸åŒçš„å€¼ï¼Œæ‰€ä»¥äºŒè€…é€šå¸¸æ··ç”¨ã€‚</p><p>sa_data æˆå‘˜ç”¨äºå­˜æ”¾ socket åœ°å€å€¼ã€‚ä½†æ˜¯ï¼Œä¸åŒçš„åè®®æ—çš„åœ°å€å€¼å…·æœ‰ä¸åŒçš„å«ä¹‰å’Œé•¿åº¦ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230818115654321.png" alt="image-20230818115654321"></p><p>ç”±ä¸Šè¡¨å¯çŸ¥ï¼Œ14 å­—èŠ‚çš„ sa_data æ ¹æœ¬æ— æ³•å®¹çº³å¤šæ•°åè®®æ—çš„åœ°å€å€¼ã€‚å› æ­¤ï¼ŒLinux å®šä¹‰äº†ä¸‹é¢è¿™ä¸ªæ–°çš„ é€šç”¨çš„ socket åœ°å€ç»“æ„ä½“ï¼Œè¿™ä¸ªç»“æ„ä½“ä¸ä»…æä¾›äº†è¶³å¤Ÿå¤§çš„ç©ºé—´ç”¨äºå­˜æ”¾åœ°å€å€¼ï¼Œè€Œä¸”æ˜¯å†…å­˜å¯¹é½çš„ã€‚</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/socket.h&gt;</span></span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr_storage</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">sa_family_t</span> sa_family;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> <span class="type">int</span> __ss_align;</span><br><span class="line">    <span class="type">char</span> __ss_padding[ <span class="number">128</span> - <span class="built_in">sizeof</span>(__ss_align) ]; <span class="comment">//å­˜å‚¨æ•°æ®</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">short</span> <span class="type">int</span> <span class="type">sa_family_t</span>;</span><br></pre></td></tr></table></div></figure><h3 id="ä¸“ç”¨socketåœ°å€"><a href="#ä¸“ç”¨socketåœ°å€" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä¸“ç”¨socketåœ°å€"></a> ä¸“ç”¨socketåœ°å€</h3><p>*<em>å¾ˆå¤šç½‘ç»œç¼–ç¨‹å‡½æ•°è¯ç”Ÿæ—©äº IPv4 åè®®ï¼Œé‚£æ—¶å€™éƒ½ä½¿ç”¨çš„æ˜¯ struct sockaddr ç»“æ„ä½“ï¼Œä¸ºäº†å‘å‰å…¼å®¹ï¼Œç° åœ¨sockaddr é€€åŒ–æˆäº†ï¼ˆvoid <em>ï¼‰çš„ä½œç”¨ï¼Œä¼ é€’ä¸€ä¸ªåœ°å€ç»™å‡½æ•°ï¼Œè‡³äºè¿™ä¸ªå‡½æ•°æ˜¯ sockaddr_in è¿˜æ˜¯ sockaddr_in6ï¼Œç”±åœ°å€æ—ç¡®å®šï¼Œç„¶åå‡½æ•°å†…éƒ¨å†å¼ºåˆ¶ç±»å‹è½¬åŒ–ä¸ºæ‰€éœ€çš„åœ°å€ç±»å‹ã€‚</em></em></p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230818115728450.png" alt="image-20230818115728450" style="zoom:80%"><p>UNIX æœ¬åœ°åŸŸåè®®æ—ä½¿ç”¨å¦‚ä¸‹ä¸“ç”¨çš„ socket åœ°å€ç»“æ„ä½“ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/un.h&gt;</span></span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr_un</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">sa_family_t</span> sin_family;</span><br><span class="line">	<span class="type">char</span> sun_path[<span class="number">108</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><p>TCP/IP åè®®æ—æœ‰ sockaddr_in å’Œ sockaddr_in6 ä¸¤ä¸ªä¸“ç”¨çš„ socket åœ°å€ç»“æ„ä½“ï¼Œå®ƒä»¬åˆ†åˆ«ç”¨äº IPv4 å’Œ IPv6ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr_in</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">sa_family_t</span> sin_family; <span class="comment">/* __SOCKADDR_COMMON(sin_) */</span></span><br><span class="line">    <span class="type">in_port_t</span> sin_port; <span class="comment">/* Port number. */</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">in_addr</span> sin_addr; <span class="comment">/* Internet address. */</span></span><br><span class="line">    <span class="comment">/* Pad to size of `struct sockaddr&#x27;. */</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> sin_zero[<span class="built_in">sizeof</span> (<span class="keyword">struct</span> sockaddr) - __SOCKADDR_COMMON_SIZE -</span><br><span class="line">    <span class="built_in">sizeof</span> (<span class="type">in_port_t</span>) - <span class="built_in">sizeof</span> (<span class="keyword">struct</span> in_addr)];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">in_addr</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">in_addr_t</span> s_addr;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr_in6</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">sa_family_t</span> sin6_family;</span><br><span class="line">    <span class="type">in_port_t</span> sin6_port; <span class="comment">/* Transport layer port # */</span></span><br><span class="line">    <span class="type">uint32_t</span> sin6_flowinfo; <span class="comment">/* IPv6 flow information */</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">in6_addr</span> sin6_addr; <span class="comment">/* IPv6 address */</span></span><br><span class="line">    <span class="type">uint32_t</span> sin6_scope_id; <span class="comment">/* IPv6 scope-id */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">short</span> <span class="type">uint16_t</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span> <span class="type">uint32_t</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">uint16_t</span> <span class="type">in_port_t</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">uint32_t</span> <span class="type">in_addr_t</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __SOCKADDR_COMMON_SIZE (sizeof (unsigned short int))</span></span><br></pre></td></tr></table></div></figure><p><strong>æ‰€æœ‰ä¸“ç”¨ socket åœ°å€ï¼ˆä»¥åŠ sockaddr_storageï¼‰ç±»å‹çš„å˜é‡åœ¨å®é™…ä½¿ç”¨æ—¶éƒ½éœ€è¦è½¬åŒ–ä¸ºé€šç”¨ socket åœ° å€ç±»å‹ sockaddrï¼ˆå¼ºåˆ¶è½¬åŒ–å³å¯ï¼‰ï¼Œå› ä¸ºæ‰€æœ‰ socket ç¼–ç¨‹æ¥å£ä½¿ç”¨çš„åœ°å€å‚æ•°ç±»å‹éƒ½æ˜¯ sockaddrã€‚éœ€è¦åšåˆ°å…¼å®¹</strong></p><h2 id="ipåœ°å€è½¬æ¢å­—ç¬¦ä¸²ip-æ•´æ•°-ä¸»æœº-ç½‘ç»œå­—èŠ‚åºçš„è½¬æ¢"><a href="#ipåœ°å€è½¬æ¢å­—ç¬¦ä¸²ip-æ•´æ•°-ä¸»æœº-ç½‘ç»œå­—èŠ‚åºçš„è½¬æ¢" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ipåœ°å€è½¬æ¢å­—ç¬¦ä¸²ip-æ•´æ•°-ä¸»æœº-ç½‘ç»œå­—èŠ‚åºçš„è½¬æ¢"></a> IPåœ°å€è½¬æ¢ï¼ˆå­—ç¬¦ä¸²ip-æ•´æ•° ï¼Œä¸»æœºã€ç½‘ç»œå­—èŠ‚åºçš„è½¬æ¢ï¼‰</h2><p>é€šå¸¸ï¼Œäººä»¬ä¹ æƒ¯ç”¨å¯è¯»æ€§å¥½çš„å­—ç¬¦ä¸²æ¥è¡¨ç¤º IP åœ°å€ï¼Œæ¯”å¦‚ç”¨ç‚¹åˆ†åè¿›åˆ¶å­—ç¬¦ä¸²è¡¨ç¤º IPv4 åœ°å€ï¼Œä»¥åŠç”¨ åå…­è¿›åˆ¶å­—ç¬¦ä¸²è¡¨ç¤º IPv6 åœ°å€ã€‚ä½†ç¼–ç¨‹ä¸­æˆ‘ä»¬éœ€è¦å…ˆæŠŠå®ƒä»¬è½¬åŒ–ä¸ºæ•´æ•°ï¼ˆäºŒè¿›åˆ¶æ•°ï¼‰æ–¹èƒ½ä½¿ç”¨ã€‚è€Œè®°å½• æ—¥å¿—æ—¶åˆ™ç›¸åï¼Œæˆ‘ä»¬è¦æŠŠæ•´æ•°è¡¨ç¤ºçš„ IP åœ°å€è½¬åŒ–ä¸ºå¯è¯»çš„å­—ç¬¦ä¸²ã€‚ä¸‹é¢ 3 ä¸ªå‡½æ•°å¯ç”¨äºç”¨ç‚¹åˆ†åè¿›åˆ¶å­— ç¬¦ä¸²è¡¨ç¤ºçš„ IPv4 åœ°å€å’Œç”¨ç½‘ç»œå­—èŠ‚åºæ•´æ•°è¡¨ç¤ºçš„ IPv4 åœ°å€ä¹‹é—´çš„è½¬æ¢ï¼š</p><p><strong>è¿™ä¸ªæ˜¯æ—§çš„å‡½æ•°ï¼Œåªèƒ½é€‚ç”¨äºIPv4åœ°å€ï¼Œå¯ä»¥ä½¿ç”¨ä½†æ˜¯ä¸å»ºè®®</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="comment">// è¿™ä¸ªæ•°å­—è½¬åŒ–è¿‡æ¥ä¹‹åæ˜¯ç½‘ç»œå­—èŠ‚åºï¼Œå°±æ˜¯å¤§ç«¯</span></span><br><span class="line"><span class="function"><span class="type">in_addr_t</span> <span class="title">inet_addr</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *cp)</span></span>; </span><br><span class="line"><span class="comment">// ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¼ å‡ºå‚æ•°ï¼Œä¿å­˜è½¬æ¢åçš„ç»“æœï¼Œè¿”å›å€¼ 1 æˆåŠŸï¼Œ0 å¤±è´¥ï¼Œå­—ç¬¦ä¸²éæ³•ï¼Œä¸è®¾ç½®é”™è¯¯å·</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">inet_aton</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *cp, <span class="keyword">struct</span> in_addr *inp)</span></span>; </span><br><span class="line"><span class="function"><span class="type">char</span> *<span class="title">inet_ntoa</span><span class="params">(<span class="keyword">struct</span> in_addr in)</span></span>;</span><br></pre></td></tr></table></div></figure><p><strong>ä¸‹é¢è¿™å¯¹æ›´æ–°çš„å‡½æ•°ä¹Ÿèƒ½å®Œæˆå‰é¢ 3 ä¸ªå‡½æ•°åŒæ ·çš„åŠŸèƒ½ï¼Œå¹¶ä¸”å®ƒä»¬åŒæ—¶é€‚ç”¨ IPv4 åœ°å€å’Œ IPv6 åœ°å€ï¼š(æ¨èä½¿ç”¨è¿™é‡Œçš„æ–°çš„api)</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="comment">// p:ç‚¹åˆ†åè¿›åˆ¶çš„IPå­—ç¬¦ä¸²ï¼Œn:è¡¨ç¤ºnetworkï¼Œç½‘ç»œå­—èŠ‚åºçš„æ•´æ•°</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">inet_pton</span><span class="params">(<span class="type">int</span> af, <span class="type">const</span> <span class="type">char</span> *src, <span class="type">void</span> *dst)</span></span>;</span><br><span class="line">    <span class="comment">// af:åœ°å€æ—ï¼š AF_INET AF_INET6</span></span><br><span class="line">    <span class="comment">// src:éœ€è¦è½¬æ¢çš„ç‚¹åˆ†åè¿›åˆ¶çš„IPå­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="comment">// dst:è½¬æ¢åçš„ç»“æœä¿å­˜åœ¨è¿™ä¸ªé‡Œé¢ï¼Œæ˜¯ä¸€ä¸ªä¼ å‡ºå‚æ•°</span></span><br><span class="line">    <span class="comment">// å°†ç½‘ç»œå­—èŠ‚åºçš„æ•´æ•°ï¼Œè½¬æ¢æˆç‚¹åˆ†åè¿›åˆ¶çš„IPåœ°å€å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="comment">// è¿”å›å€¼ï¼š1 æˆåŠŸ ï¼›å¤±è´¥ 0 æˆ–è€… -1ï¼Œ0è¡¨ç¤ºä¼ å…¥çš„ç‚¹åˆ†åˆ¶å­—ç¬¦ä¸²ä¸åˆç†invalidï¼Œä¸è®¾ç½®errnoï¼›-1è¡¨ç¤ºé”™è¯¯(æ¯”å¦‚åœ°å€æ—å†…å®¹ä¸åˆç†)ï¼Œå¹¶ä¸”è®¾ç½®errno</span></span><br><span class="line"><span class="function"><span class="type">const</span> <span class="type">char</span> *<span class="title">inet_ntop</span><span class="params">(<span class="type">int</span> af, <span class="type">const</span> <span class="type">void</span> *src, <span class="type">char</span> *dst, <span class="type">socklen_t</span> size)</span></span>;</span><br><span class="line">    <span class="comment">// af:åœ°å€æ—ï¼š AF_INET AF_INET6</span></span><br><span class="line">    <span class="comment">// src: è¦è½¬æ¢çš„ipçš„æ•´æ•°çš„åœ°å€</span></span><br><span class="line">    <span class="comment">// dst: è½¬æ¢æˆIPåœ°å€å­—ç¬¦ä¸²ä¿å­˜çš„åœ°æ–¹</span></span><br><span class="line">    <span class="comment">// sizeï¼šç¬¬ä¸‰ä¸ªå‚æ•°çš„å¤§å°ï¼ˆæ•°ç»„çš„å¤§å°ï¼‰</span></span><br><span class="line">    <span class="comment">// è¿”å›å€¼ï¼šè¿”å›è½¬æ¢åçš„æ•°æ®çš„åœ°å€ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œå’Œ dst æ˜¯ä¸€æ ·çš„</span></span><br></pre></td></tr></table></div></figure><p>æˆ‘ä»¬å†™ä»£ç æ¥å·©å›ºï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªIPå­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* buf = <span class="string">&quot;192.168.1.4&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">in_addr_t</span> num;</span><br><span class="line">    <span class="comment">// å…¶å®è¿™é‡Œç»™åŒ…è£…ä»–çš„ç»“æ„ä½“ in_addr ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºå‡½æ•°è¦æ±‚ä¼ å…¥çš„æ˜¯æŒ‡é’ˆï¼Œè¿˜æ˜¯ void* ï¼Œè„æ´»ç³»ç»ŸAPIå¸®æˆ‘ä»¬å¹²å®Œäº†éƒ½</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†ç‚¹åˆ†åè¿›åˆ¶çš„IPå­—ç¬¦ä¸²è½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºçš„æ•´æ•°</span></span><br><span class="line">    <span class="built_in">inet_pton</span>(AF_INET, buf, &amp;num);</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span>* p = (<span class="type">unsigned</span> <span class="type">char</span>*)&amp;num;</span><br><span class="line">    <span class="comment">// è½¬åŒ–ä¹‹åçš„ç»“æœåº”è¯¥æ˜¯æ•°å­—é«˜ä½192å­˜æ”¾åœ¨åœ°å€ä½ä½ï¼Œå°±æ˜¯å¤§ç«¯å­—èŠ‚åºï¼Œæ‰€ä»¥ç»“æœåº”è¯¥æ˜¯192.168.1.4</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%u %u %u %u\n&quot;</span>, *p, *(p + <span class="number">1</span>), *(p + <span class="number">2</span>), *(p + <span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†ç½‘ç»œå­—èŠ‚åºçš„IPæ•´æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²å½¢å¼</span></span><br><span class="line">    <span class="comment">// å­—ç¬¦ä¸²å½¢å¼çš„IPåœ°å€æœ€å¤šå¤šå°‘ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—èŠ‚ï¼Œç„¶åæ•°å­—æ¯ä¸ªæœ€å¤š3ä½ï¼Œ3ä¸ªç‚¹ï¼ŒåŠ èµ·æ¥å°±æ˜¯15ï¼Œç„¶å\0ç¬¦ï¼Œå®šä¹‰16å°±è¡Œ</span></span><br><span class="line">    <span class="type">char</span> ip_str[<span class="number">16</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* ans = <span class="built_in">inet_ntop</span>(AF_INET, &amp;num, ip_str, <span class="built_in">sizeof</span>(ip_str) - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;ans : %s\n&quot;</span>, ans);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;ip_str : %s\n&quot;</span>, ip_str);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ip_str == ans);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p><strong>æ³¨æ„å­—ç¬¦ä¸²å½¢å¼çš„IPåœ°å€å’Œæ•°å­—å½¢å¼çš„IPåœ°å€çš„å­—èŠ‚æ•°çš„åŒºåˆ«å’Œè®¡ç®—æ–¹æ³•ï¼Œæ³¨æ„ä¸è¦å¼„æ··äº†!!!</strong></p><h2 id="tcpé€šä¿¡æµç¨‹"><a href="#tcpé€šä¿¡æµç¨‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#tcpé€šä¿¡æµç¨‹"></a> TCPé€šä¿¡æµç¨‹</h2><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TCP å’Œ UDP -&gt; ä¼ è¾“å±‚çš„åè®®</span></span><br><span class="line">    UDP:ç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼Œé¢å‘æ— è¿æ¥ï¼Œå¯ä»¥å•æ’­ï¼Œå¤šæ’­ï¼Œå¹¿æ’­ï¼Œ é¢å‘æ•°æ®æŠ¥ï¼Œä¸å¯é </span><br><span class="line">    TCP:ä¼ è¾“æ§åˆ¶åè®®ï¼Œé¢å‘è¿æ¥çš„ï¼Œå¯é çš„ï¼ŒåŸºäºå­—èŠ‚æµï¼Œä»…æ”¯æŒå•æ’­ä¼ è¾“(ç«¯å¯¹ç«¯)</span><br><span class="line">    				      UDP 								TCP</span><br><span class="line">    æ˜¯å¦åˆ›å»ºè¿æ¥ 			 æ— è¿æ¥ 							é¢å‘è¿æ¥</span><br><span class="line">    æ˜¯å¦å¯é  			   ä¸å¯é  				  			  å¯é çš„</span><br><span class="line">    è¿æ¥çš„å¯¹è±¡ä¸ªæ•° 		 ä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€ã€å¤šå¯¹å¤š       æ”¯æŒä¸€å¯¹ä¸€</span><br><span class="line">    ä¼ è¾“çš„æ–¹å¼ 			  é¢å‘æ•°æ®æŠ¥ 					   é¢å‘å­—èŠ‚æµ</span><br><span class="line">    é¦–éƒ¨å¼€é”€ 		       <span class="number">8</span>ä¸ªå­—èŠ‚ 					     æœ€å°‘<span class="number">20</span>ä¸ªå­—èŠ‚</span><br><span class="line">    é€‚ç”¨åœºæ™¯ 		       å®æ—¶åº”ç”¨ï¼ˆè§†é¢‘ä¼šè®®ï¼Œç›´æ’­ï¼‰ 	  å¯é æ€§é«˜çš„åº”ç”¨ï¼ˆæ–‡ä»¶ä¼ è¾“ï¼‰</span><br></pre></td></tr></table></div></figure><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230818143501064.png" alt="image-20230818143501064"></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TCP é€šä¿¡çš„æµç¨‹</span></span><br><span class="line"><span class="comment">// æœåŠ¡å™¨ç«¯ ï¼ˆè¢«åŠ¨æ¥å—è¿æ¥çš„è§’è‰²ï¼‰</span></span><br><span class="line">    <span class="number">1.</span> åˆ›å»ºä¸€ä¸ªç”¨äºç›‘å¬çš„å¥—æ¥å­—</span><br><span class="line">        - ç›‘å¬ï¼šç›‘å¬æœ‰å®¢æˆ·ç«¯çš„è¿æ¥</span><br><span class="line">        - å¥—æ¥å­—ï¼šè¿™ä¸ªå¥—æ¥å­—å…¶å®å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">    <span class="number">2.</span> å°†è¿™ä¸ªç›‘å¬æ–‡ä»¶æè¿°ç¬¦å’Œæœ¬åœ°çš„IPå’Œç«¯å£ç»‘å®šï¼ˆIPå’Œç«¯å£å°±æ˜¯æœåŠ¡å™¨çš„åœ°å€ä¿¡æ¯ï¼‰</span><br><span class="line">    	- å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨çš„æ—¶å€™ä½¿ç”¨çš„å°±æ˜¯è¿™ä¸ªIPå’Œç«¯å£</span><br><span class="line">    <span class="number">3.</span> è®¾ç½®ç›‘å¬ï¼Œç›‘å¬çš„fdå¼€å§‹å·¥ä½œ</span><br><span class="line">    <span class="number">4.</span> é˜»å¡ç­‰å¾…ï¼Œå½“æœ‰å®¢æˆ·ç«¯å‘èµ·è¿æ¥ï¼Œè§£é™¤é˜»å¡ï¼Œæ¥å—å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªå’Œå®¢æˆ·ç«¯é€šä¿¡çš„å¥—æ¥å­—(fd)</span><br><span class="line">    <span class="number">5.</span> é€šä¿¡</span><br><span class="line">        - æ¥æ”¶æ•°æ®</span><br><span class="line">        - å‘é€æ•°æ®</span><br><span class="line">    <span class="number">6.</span> é€šä¿¡ç»“æŸï¼Œæ–­å¼€è¿æ¥</span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®¢æˆ·ç«¯</span></span><br><span class="line">    <span class="number">1.</span> åˆ›å»ºä¸€ä¸ªç”¨äºé€šä¿¡çš„å¥—æ¥å­—ï¼ˆfdï¼‰</span><br><span class="line">    <span class="number">2.</span> è¿æ¥æœåŠ¡å™¨ï¼Œéœ€è¦æŒ‡å®šè¿æ¥çš„æœåŠ¡å™¨çš„ IP å’Œ ç«¯å£</span><br><span class="line">    <span class="number">3.</span> è¿æ¥æˆåŠŸäº†ï¼Œå®¢æˆ·ç«¯å¯ä»¥ç›´æ¥å’ŒæœåŠ¡å™¨é€šä¿¡</span><br><span class="line">        - æ¥æ”¶æ•°æ®</span><br><span class="line">        - å‘é€æ•°æ®</span><br><span class="line">    <span class="number">4.</span> é€šä¿¡ç»“æŸï¼Œæ–­å¼€è¿æ¥</span><br></pre></td></tr></table></div></figure><h2 id="å¥—æ¥å­—å‡½æ•°"><a href="#å¥—æ¥å­—å‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å¥—æ¥å­—å‡½æ•°"></a> å¥—æ¥å­—å‡½æ•°</h2><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span> <span class="comment">// åŒ…å«äº†è¿™ä¸ªå¤´æ–‡ä»¶ï¼Œä¸Šé¢ä¸¤ä¸ªå°±å¯ä»¥çœç•¥</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">socket</span><span class="params">(<span class="type">int</span> domain, <span class="type">int</span> type, <span class="type">int</span> protocol)</span></span>;</span><br><span class="line">    - åŠŸèƒ½ï¼šåˆ›å»ºä¸€ä¸ªå¥—æ¥å­—</span><br><span class="line">    - å‚æ•°ï¼š</span><br><span class="line">    - domain: åè®®æ—</span><br><span class="line">        AF_INET : ipv4</span><br><span class="line">        AF_INET6 : ipv6</span><br><span class="line">        AF_UNIX, AF_LOCAL : æœ¬åœ°å¥—æ¥å­—é€šä¿¡ï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰</span><br><span class="line">	<span class="comment">// ç¬¬äºŒä¸ªå‚æ•°typeå’Œç¬¬ä¸‰ä¸ªå‚æ•°protocolä¸€ä¸ªæ˜¯åè®®ç±»å‹ï¼Œä¸€ä¸ªæ˜¯å…·ä½“çš„æŸä¸ªåè®®ï¼Œåˆ’åˆ†çš„è¿˜æ¯”è¾ƒç»†å’Œå‘¨åˆ°</span></span><br><span class="line">    - type: é€šä¿¡è¿‡ç¨‹ä¸­ä½¿ç”¨çš„åè®®ç±»å‹</span><br><span class="line">        SOCK_STREAM : æµå¼åè®®(ä¾‹å¦‚ï¼šå­—èŠ‚æµçš„TCPï¼Œå½“ç„¶ä¸ä¸€å®šåªæœ‰è¿™ä¸€ç§ï¼Œå¯ä»¥è¢«ç¬¬ä¸‰ä¸ªå‚æ•°å…·ä½“æŒ‡å®š)</span><br><span class="line">        SOCK_DGRAM : æŠ¥å¼åè®®(ä¾‹å¦‚ï¼šç”¨æˆ·æ•°æ®æŠ¥çš„UDPï¼Œå½“ç„¶ä¸ä¸€å®šåªæœ‰è¿™ä¸€ç§ï¼Œå¯ä»¥è¢«ç¬¬ä¸‰ä¸ªå‚æ•°å…·ä½“æŒ‡å®š)</span><br><span class="line">    - protocol : å…·ä½“çš„ä¸€ä¸ªåè®®ã€‚ä¸€èˆ¬å†™<span class="number">0</span>ï¼Œå¯ä»¥è¡¨ç¤ºé»˜è®¤çš„æˆ–è€…å½“åè®®ç±»å‹ä¸­åªæœ‰ä¸€ä¸ªå…·ä½“ç±»å‹çš„æ—¶å€™å°±æ˜¯ç”¨è¿™ä¸ªå…·ä½“çš„ç±»å‹</span><br><span class="line">        - SOCK_STREAM : æµå¼åè®®é»˜è®¤ä½¿ç”¨ TCP</span><br><span class="line">        - SOCK_DGRAM : æŠ¥å¼åè®®é»˜è®¤ä½¿ç”¨ UDP</span><br><span class="line">    - è¿”å›å€¼ï¼š</span><br><span class="line">        - æˆåŠŸï¼šè¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼Œæ“ä½œçš„åŒºåŸŸæ˜¯å†…æ ¸ç¼“å†²åŒºã€‚</span><br><span class="line">        - å¤±è´¥ï¼š<span class="number">-1</span>ï¼Œå¹¶ä¸”è®¾ç½®<span class="function">errno</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bind</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> <span class="keyword">struct</span> sockaddr *addr, <span class="type">socklen_t</span> addrlen)</span></span>; <span class="comment">// socketå‘½å</span></span><br><span class="line">    - åŠŸèƒ½ï¼šç»‘å®šï¼Œå°† fd å’Œ æœ¬åœ°çš„IP + ç«¯å£ port è¿›è¡Œç»‘å®š</span><br><span class="line">    - å‚æ•°ï¼š</span><br><span class="line">        - sockfd : é€šè¿‡socketå‡½æ•°å¾—åˆ°çš„æ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">        - addr : éœ€è¦ç»‘å®šçš„socketåœ°å€ï¼Œè¿™ä¸ªåœ°å€å°è£…äº†ipå’Œç«¯å£å·çš„ä¿¡æ¯</span><br><span class="line">        - addrlen : ç¬¬äºŒä¸ªå‚æ•°ç»“æ„ä½“å çš„å†…å­˜å¤§å°</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">listen</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">int</span> backlog)</span></span>; <span class="comment">// /proc/sys/net/core/somaxconn</span></span><br><span class="line">    - åŠŸèƒ½ï¼šç›‘å¬è¿™ä¸ªsocketä¸Šçš„è¿æ¥</span><br><span class="line">    - å‚æ•°ï¼š</span><br><span class="line">        - sockfd : é€šè¿‡<span class="built_in">socket</span>()å‡½æ•°å¾—åˆ°çš„æ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">        - backlog : è¿æ¥è¯·æ±‚ç­‰å¾…é˜Ÿåˆ—çš„é•¿åº¦ï¼Œè¡¨ç¤ºæœ€å¤šæœ‰å¤šå°‘ä¸ªè¿æ¥è¯·æ±‚æ’é˜Ÿï¼Œå¹¶ä¸æ˜¯æœåŠ¡ç«¯æœ€å¤šå¯ä»¥è¿æ¥é€šä¿¡çš„ä¸ªæ•°ï¼Œå› ä¸ºå‡ºé˜Ÿåˆ—ä¹‹åå°±å¯ä»¥è¿›è¡Œé€šä¿¡ï¼Œè¿™ä¸ªæ—¶å€™è¯·æ±‚é˜Ÿåˆ—å‡ä¸€æ¢å¤äº†</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">accept</span><span class="params">(<span class="type">int</span> sockfd, <span class="keyword">struct</span> sockaddr *addr, <span class="type">socklen_t</span> *addrlen)</span></span>;</span><br><span class="line">    - åŠŸèƒ½ï¼šæ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ï¼Œé»˜è®¤æ˜¯ä¸€ä¸ªé˜»å¡çš„å‡½æ•°ï¼Œé˜»å¡ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥</span><br><span class="line">    - å‚æ•°ï¼š</span><br><span class="line">        - sockfd : ç”¨äºç›‘å¬çš„æ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">        - addr : ä¼ å‡ºå‚æ•°ï¼Œè®°å½•äº†è¿æ¥æˆåŠŸåå®¢æˆ·ç«¯çš„åœ°å€ä¿¡æ¯ï¼ˆipï¼Œportï¼‰ï¼Œæ³¨æ„æ˜¯å®¢æˆ·ç«¯ï¼Œè¿™ä¸ªä¿¡æ¯æ˜¯ç³»ç»Ÿç»™æˆ‘çš„ï¼Œæˆ‘è·å¾—çš„</span><br><span class="line">        - addrlen : æŒ‡å®šç¬¬äºŒä¸ªå‚æ•°çš„å¯¹åº”çš„å†…å­˜å¤§å°</span><br><span class="line">    - è¿”å›å€¼ï¼š</span><br><span class="line">        - æˆåŠŸ ï¼šç”¨äºé€šä¿¡çš„æ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">        - <span class="number">-1</span> ï¼š å¤±è´¥ï¼Œè®¾ç½®<span class="function">errno</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">connect</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> <span class="keyword">struct</span> sockaddr *addr, <span class="type">socklen_t</span> addrlen)</span></span>;</span><br><span class="line">    - åŠŸèƒ½ï¼š å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨</span><br><span class="line">    - å‚æ•°ï¼š</span><br><span class="line">        - sockfd : ç”¨äºé€šä¿¡çš„æ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">        - addr : å®¢æˆ·ç«¯è¦è¿æ¥çš„æœåŠ¡å™¨çš„åœ°å€ä¿¡æ¯ï¼Œè¿™ä¸ªä¿¡æ¯æ˜¯æˆ‘ç»™çš„ï¼Œè¡¨ç¤ºæˆ‘è¦å’Œè°è¿›è¡Œè¿æ¥</span><br><span class="line">        - addrlen : ç¬¬äºŒä¸ªå‚æ•°çš„å†…å­˜å¤§å°</span><br><span class="line">    - è¿”å›å€¼ï¼šæˆåŠŸ <span class="number">0</span>ï¼Œ å¤±è´¥ <span class="number">-1</span>ï¼Œè®¾ç½®<span class="function">errno</span></span><br><span class="line"><span class="function"><span class="type">ssize_t</span> <span class="title">write</span><span class="params">(<span class="type">int</span> fd, <span class="type">const</span> <span class="type">void</span> *buf, <span class="type">size_t</span> count)</span></span>; <span class="comment">// å†™æ•°æ®</span></span><br><span class="line"><span class="function"><span class="type">ssize_t</span> <span class="title">read</span><span class="params">(<span class="type">int</span> fd, <span class="type">void</span> *buf, <span class="type">size_t</span> count)</span></span>; <span class="comment">// è¯»æ•°æ®</span></span><br></pre></td></tr></table></div></figure><h3 id="ç¤ºä¾‹-4"><a href="#ç¤ºä¾‹-4" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¤ºä¾‹-4"></a> ç¤ºä¾‹</h3><p>æˆ‘ä»¬å†™ä¸€ä¸ªä¾‹å­ï¼Œå°±æ˜¯å®¢æˆ·ç«¯å¯ä»¥ä»é”®ç›˜è¯»å…¥å­—ç¬¦ä¸²ï¼Œå‘é€ç»™æœåŠ¡ç«¯ï¼Œç„¶åæœåŠ¡ç«¯åŸå°ä¸åŠ¨çš„è¿”å›ç»™å®¢æˆ·ç«¯</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IPV4_STRING_MAX 16</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_SIZE 1024</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å›å°„æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯å‘é€ä»€ä¹ˆæœåŠ¡ç«¯å°±è¿”å›ä»€ä¹ˆ</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> <span class="type">const</span>* argv[])</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­å‘½ä»¤è¡Œå‚æ•°ä¸ªæ•°</span></span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;usage : %s  &lt;ip_address&gt;  &lt;port&gt;\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* server_ip = argv[<span class="number">1</span>];</span><br><span class="line">    <span class="type">const</span> <span class="type">short</span> server_port = <span class="built_in">atoi</span>(argv[<span class="number">2</span>]);  <span class="comment">// atoi()å‡½æ•°å¯ä»¥æŠŠåˆç†çš„å­—ç¬¦ä¸²è½¬åŒ–ä¸ºæ•´æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºsocket</span></span><br><span class="line">    <span class="type">int</span> listen_fd = <span class="built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == listen_fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;socket&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.ç»‘å®šIPå’Œç«¯å£å·</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> server_addr;</span><br><span class="line">    server_addr.sin_family = AF_INET;</span><br><span class="line">    server_addr.sin_port = <span class="built_in">htons</span>(server_port);  <span class="comment">// æ³¨æ„ä»ä¸»æœºå­—èŠ‚åºè½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åº</span></span><br><span class="line">    <span class="built_in">inet_pton</span>(AF_INET, server_ip, &amp;server_addr.sin_addr.s_addr);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">bind</span>(listen_fd, (<span class="keyword">struct</span> sockaddr*)&amp;server_addr, <span class="built_in">sizeof</span>(server_addr));</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;bind&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.å¼€å§‹ç›‘å¬</span></span><br><span class="line">    ret = <span class="built_in">listen</span>(listen_fd, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;listen&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.æ¥å—è¿æ¥è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> client_addr;</span><br><span class="line">    <span class="type">socklen_t</span> client_addr_len = <span class="built_in">sizeof</span>(client_addr);</span><br><span class="line">    <span class="type">int</span> connect_fd = <span class="built_in">accept</span>(listen_fd, (<span class="keyword">struct</span> sockaddr*)&amp;client_addr, &amp;client_addr_len);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == connect_fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;accept&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å°è¿æ¥çš„å®¢æˆ·ç«¯çš„ä¿¡æ¯</span></span><br><span class="line">    <span class="type">char</span> client_ip[IPV4_STRING_MAX] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">inet_ntop</span>(AF_INET, &amp;client_addr.sin_addr.s_addr, client_ip, <span class="built_in">sizeof</span>(client_ip));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;client has connected , ip : %s , port : %d\n&quot;</span>, client_ip, <span class="built_in">ntohs</span>(client_addr.sin_port));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.å¼€å§‹é€šä¿¡</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬çš„è¦æ±‚æ˜¯å®¢æˆ·ç«¯å‘é€ä»€ä¹ˆï¼ŒæœåŠ¡ç«¯éƒ½è¿”å›ç›¸åŒçš„å€¼</span></span><br><span class="line">    <span class="type">char</span> buf[MAX_SIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">        <span class="comment">// è¯»æ•°æ®</span></span><br><span class="line">        <span class="type">int</span> len = <span class="built_in">read</span>(connect_fd, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">-1</span> == len) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;read&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;recv data : %s&quot;</span>, buf);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == len) &#123;  <span class="comment">// å®¢æˆ·ç«¯æ–­å¼€è¿æ¥</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;client closed...\n&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å†™æ•°æ®</span></span><br><span class="line">        <span class="built_in">write</span>(connect_fd, buf, <span class="built_in">strlen</span>(buf));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6.å…³é—­è¿æ¥</span></span><br><span class="line">    <span class="built_in">close</span>(connect_fd);</span><br><span class="line">    <span class="built_in">close</span>(listen_fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// client.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_SIZE 1024</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> <span class="type">const</span>* argv[])</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­å‘½ä»¤è¡Œå‚æ•°ä¸ªæ•°</span></span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;usage : %s  &lt;ip_address&gt;  &lt;port&gt;\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* server_ip = argv[<span class="number">1</span>];</span><br><span class="line">    <span class="type">const</span> <span class="type">short</span> server_port = <span class="built_in">atoi</span>(argv[<span class="number">2</span>]);  <span class="comment">// atoi()å‡½æ•°å¯ä»¥æŠŠåˆç†çš„å­—ç¬¦ä¸²è½¬åŒ–ä¸ºæ•´æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºsocket</span></span><br><span class="line">    <span class="type">int</span> connect_fd = <span class="built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == connect_fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;socket&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.å»ºç«‹è¿æ¥</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> server_addr;</span><br><span class="line">    <span class="comment">// åœ°å€æ—</span></span><br><span class="line">    server_addr.sin_family = AF_INET;</span><br><span class="line">    <span class="comment">// ç«¯å£å·</span></span><br><span class="line">    server_addr.sin_port = <span class="built_in">htons</span>(server_port);</span><br><span class="line">    <span class="comment">// IPåœ°å€</span></span><br><span class="line">    <span class="built_in">inet_pton</span>(AF_INET, server_ip, &amp;server_addr.sin_addr.s_addr);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">connect</span>(connect_fd, (<span class="keyword">struct</span> sockaddr*)&amp;server_addr, <span class="built_in">sizeof</span>(server_addr));</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;connect&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¿æ¥æˆåŠŸï¼Œè¾“å‡ºä¿¡æ¯</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;connected successfully , waiting for communication.\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.å¼€å§‹é€šä¿¡</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬è¦æ±‚å®¢æˆ·ç«¯å¯ä»¥ä»é”®ç›˜å½•å…¥å€¼è¿›è¡Œé€šä¿¡</span></span><br><span class="line">    <span class="type">char</span> buf[MAX_SIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">        <span class="comment">// å†™æ•°æ®</span></span><br><span class="line">        <span class="built_in">fgets</span>(buf, <span class="built_in">sizeof</span>(buf), stdin);  </span><br><span class="line">        <span class="comment">// è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼ŒæœåŠ¡å™¨åœ¨é˜»å¡è¯»çš„æ—¶å€™æœåŠ¡ç«¯å¦‚æœå¼ºåˆ¶é€€å‡ºæ¯”å¦‚ ctrl + cï¼Œå°±ä¼šå‡ºé—®é¢˜ï¼Œè¿™æ ·å®¢æˆ·ç«¯ä¸ä¼šåœæ­¢ï¼Œå› ä¸ºä»–è¿˜åœ¨å†™çš„éƒ¨åˆ†é˜»å¡ï¼Œæ²¡æœ‰åœ¨è¯»çš„éƒ¨åˆ†ï¼Œä½†æ˜¯é—®é¢˜ä¸å¤§ï¼Œå› ä¸ºå®é™…å¼€å‘å½“ä¸­æˆ‘ä»¬ä¸ä¼šå¯¹æœåŠ¡å™¨åšè¿™æ ·çš„æ“ä½œ</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¢åŠ é€€å‡ºåŠŸèƒ½</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(buf, <span class="string">&quot;quit\n&quot;</span>) == <span class="number">0</span> || <span class="built_in">strcmp</span>(buf, <span class="string">&quot;QUIT\n&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;send : %s&quot;</span>, buf);</span><br><span class="line">        <span class="built_in">write</span>(connect_fd, buf, <span class="built_in">strlen</span>(buf));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¯»æ•°æ®</span></span><br><span class="line">        <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">        <span class="type">int</span> len = <span class="built_in">read</span>(connect_fd, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">-1</span> == len) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;len&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;recv : %s&quot;</span>, buf);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == len) &#123;</span><br><span class="line">            <span class="comment">// æœåŠ¡ç«¯å…³é—­äº†</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;server closed...\n&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.å…³é—­è¿æ¥</span></span><br><span class="line">    <span class="built_in">close</span>(connect_fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p><strong>å…¶ä¸­ä¸ºä»€ä¹ˆread()çš„ç»“æœä¸º0çš„æ—¶å€™å°±è¡¨ç¤ºå¯¹æ–¹å…³é—­äº†å‘¢ï¼Ÿ</strong></p><p><strong>é¦–å…ˆå¯¹æ–¹æ˜¯å†™ç«¯ï¼Œæˆ‘ä»¬æ˜¯è¯»ç«¯ï¼Œå¦‚æœå¯¹æ–¹å…³é—­çš„è¯ï¼Œread()ä¼šè¿”å›0è¡¨ç¤ºè¯»åˆ°æ–‡ä»¶æœ«å°¾ï¼Œä¹Ÿå°±æ˜¯è¡¨ç¤ºå¯¹æ–¹å…³é—­äº†ï¼Œå’Œç®¡é“çš„æ“ä½œéå¸¸ç±»ä¼¼</strong></p><p><strong>æ€»ç»“ï¼š</strong></p><ul><li><strong>è¯»ç®¡é“ï¼š</strong><ul><li><strong>ç®¡é“ä¸­æœ‰æ•°æ®ï¼Œè¯»å–ä¼šè¿”å›å®é™…è¯»åˆ°çš„å­—èŠ‚æ•°</strong></li><li><strong>ç®¡é“ä¸­æ— æ•°æ®ï¼š</strong><ul><li><strong>å†™ç«¯å…¨éƒ¨å…³é—­ï¼Œreadè¿”å›0(ç›¸å½“äºè¯»åˆ°æ–‡ä»¶çš„æœ«å°¾)</strong></li><li><strong>å†™ç«¯æ²¡æœ‰å®Œå…¨å…³é—­ï¼Œreadé˜»å¡ç­‰å¾…</strong></li></ul></li></ul></li><li><strong>å†™ç®¡é“ï¼š</strong><ul><li><strong>ç®¡é“è¯»ç«¯å…¨éƒ¨å…³é—­ï¼Œäº§ç”Ÿä¿¡å·SIGPIPEï¼Œè¿›ç¨‹å¼‚å¸¸ç»ˆæ­¢</strong></li><li><strong>ç®¡é“è¯»ç«¯æ²¡æœ‰å…¨éƒ¨å…³é—­ï¼š</strong><ul><li><strong>ç®¡é“å·²æ»¡ï¼Œwriteé˜»å¡</strong></li><li><strong>ç®¡é“æ²¡æœ‰æ»¡ï¼Œwriteå°†æ•°æ®å†™å…¥ï¼Œå¹¶è¿”å›å®é™…å†™å…¥çš„å­—èŠ‚æ•°</strong></li></ul></li></ul></li></ul><p>å½“ç„¶ä¸Šé¢çš„ä»£ç è¿˜æœ‰ç‚¹å°é—®é¢˜ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œåç»­ä¿®æ”¹</p><h2 id="tcpä¸‰æ¬¡æ¡æ‰‹"><a href="#tcpä¸‰æ¬¡æ¡æ‰‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#tcpä¸‰æ¬¡æ¡æ‰‹"></a> TCPä¸‰æ¬¡æ¡æ‰‹</h2><p>TCP æ˜¯ä¸€ç§é¢å‘è¿æ¥çš„å•æ’­åè®®ï¼Œåœ¨å‘é€æ•°æ®å‰ï¼Œé€šä¿¡åŒæ–¹å¿…é¡»åœ¨å½¼æ­¤é—´å»ºç«‹ä¸€æ¡è¿æ¥ã€‚æ‰€è°“çš„â€œè¿æ¥â€ï¼Œå…¶å®æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„å†…å­˜é‡Œä¿å­˜çš„ä¸€ä»½å…³äºå¯¹æ–¹çš„ä¿¡æ¯ï¼Œå¦‚ IP åœ°å€ã€ç«¯å£å·ç­‰ã€‚</p><p>TCP å¯ä»¥çœ‹æˆæ˜¯ä¸€ç§å­—èŠ‚æµï¼Œå®ƒä¼šå¤„ç† IP å±‚æˆ–ä»¥ä¸‹çš„å±‚çš„ä¸¢åŒ…ã€é‡å¤ä»¥åŠé”™è¯¯é—®é¢˜ã€‚åœ¨è¿æ¥çš„å»ºç«‹è¿‡ç¨‹ä¸­ï¼ŒåŒæ–¹éœ€è¦äº¤æ¢ä¸€äº›è¿æ¥çš„å‚æ•°ã€‚è¿™äº›å‚æ•°å¯ä»¥æ”¾åœ¨ TCP å¤´éƒ¨ã€‚</p><p>TCP æä¾›äº†ä¸€ç§å¯é ã€é¢å‘è¿æ¥ã€å­—èŠ‚æµã€ä¼ è¾“å±‚çš„æœåŠ¡ï¼Œé‡‡ç”¨ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹ä¸€ä¸ªè¿æ¥ã€‚é‡‡ç”¨å››æ¬¡æŒ¥æ‰‹æ¥å…³é—­ä¸€ä¸ªè¿æ¥ã€‚</p><p><strong>ä¸‰æ¬¡æ¡æ‰‹çš„ç›®çš„æ˜¯ä¿è¯äº†åŒæ–¹äº’ç›¸ä¹‹é—´å»ºç«‹äº†è¿æ¥ã€‚</strong></p><p><strong>ä¸‰æ¬¡æ¡æ‰‹å‘ç”Ÿåœ¨å®¢æˆ·ç«¯è¿æ¥çš„æ—¶å€™ï¼Œå½“è°ƒç”¨connect()çš„æ—¶å€™ï¼Œåº•å±‚ä¼šé€šè¿‡TCPåè®®è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ã€‚</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230818175354581.png" alt="image-20230818175354581"></p><ul><li>16 ä½ç«¯å£å·ï¼ˆport numberï¼‰ï¼šå‘ŠçŸ¥ä¸»æœºæŠ¥æ–‡æ®µæ˜¯æ¥è‡ªå“ªé‡Œï¼ˆæºç«¯å£ï¼‰ä»¥åŠä¼ ç»™å“ªä¸ªä¸Šå±‚åè®®æˆ– åº”ç”¨ç¨‹åºï¼ˆç›®çš„ç«¯å£ï¼‰çš„ã€‚è¿›è¡Œ TCP é€šä¿¡æ—¶ï¼Œå®¢æˆ·ç«¯é€šå¸¸ä½¿ç”¨ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©çš„ä¸´æ—¶ç«¯å£å·ã€‚</li><li>32 ä½åºå·ï¼ˆsequence numberï¼‰ï¼šä¸€æ¬¡ TCP é€šä¿¡ï¼ˆä» TCP è¿æ¥å»ºç«‹åˆ°æ–­å¼€ï¼‰è¿‡ç¨‹ä¸­æŸä¸€ä¸ªä¼ è¾“ æ–¹å‘ä¸Šçš„å­—èŠ‚æµçš„æ¯ä¸ªå­—èŠ‚çš„ç¼–å·ã€‚å‡è®¾ä¸»æœº A å’Œä¸»æœº B è¿›è¡Œ TCP é€šä¿¡ï¼ŒA å‘é€ç»™ B çš„ç¬¬ä¸€ä¸ª TCP æŠ¥æ–‡æ®µä¸­ï¼Œåºå·å€¼è¢«ç³»ç»Ÿåˆå§‹åŒ–ä¸ºæŸä¸ªéšæœºå€¼ ISNï¼ˆInitial Sequence Numberï¼Œåˆå§‹åºå· å€¼ï¼‰ã€‚é‚£ä¹ˆåœ¨è¯¥ä¼ è¾“æ–¹å‘ä¸Šï¼ˆä» A åˆ° Bï¼‰ï¼Œåç»­çš„ TCP æŠ¥æ–‡æ®µä¸­åºå·å€¼å°†è¢«ç³»ç»Ÿè®¾ç½®æˆ ISN åŠ ä¸Š è¯¥æŠ¥æ–‡æ®µæ‰€æºå¸¦æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚åœ¨æ•´ä¸ªå­—èŠ‚æµä¸­çš„åç§»ã€‚ä¾‹å¦‚ï¼ŒæŸä¸ª TCP æŠ¥æ–‡æ®µä¼ é€çš„æ•°æ®æ˜¯å­— èŠ‚æµä¸­çš„ç¬¬ 1025 ~ 2048 å­—èŠ‚ï¼Œé‚£ä¹ˆè¯¥æŠ¥æ–‡æ®µçš„åºå·å€¼å°±æ˜¯ ISN + 1025ã€‚å¦å¤–ä¸€ä¸ªä¼ è¾“æ–¹å‘ï¼ˆä» B åˆ° Aï¼‰çš„ TCP æŠ¥æ–‡æ®µçš„åºå·å€¼ä¹Ÿå…·æœ‰ç›¸åŒçš„å«ä¹‰ã€‚</li><li>32 ä½ç¡®è®¤å·ï¼ˆacknowledgement numberï¼‰ï¼šç”¨ä½œå¯¹å¦ä¸€æ–¹å‘é€æ¥çš„ TCP æŠ¥æ–‡æ®µçš„å“åº”ã€‚å…¶å€¼æ˜¯ æ”¶åˆ°çš„ TCP æŠ¥æ–‡æ®µçš„åºå·å€¼ + æ ‡å¿—ä½é•¿åº¦ï¼ˆSYNï¼ŒFINï¼‰ + æ•°æ®é•¿åº¦ ã€‚å‡è®¾ä¸»æœº A å’Œä¸»æœº B è¿›è¡Œ TCP é€šä¿¡ï¼Œé‚£ä¹ˆ A å‘é€å‡ºçš„ TCP æŠ¥æ–‡æ®µä¸ä»…æºå¸¦è‡ªå·±çš„åºå·ï¼Œè€Œä¸”åŒ…å«å¯¹ B å‘é€æ¥çš„ TCP æŠ¥æ–‡æ®µ çš„ç¡®è®¤å·ã€‚åä¹‹ï¼ŒB å‘é€å‡ºçš„ TCP æŠ¥æ–‡æ®µä¹ŸåŒæ ·æºå¸¦è‡ªå·±çš„åºå·å’Œå¯¹ A å‘é€æ¥çš„æŠ¥æ–‡æ®µçš„ç¡®è®¤åº å·ã€‚</li><li>4 ä½å¤´éƒ¨é•¿åº¦ï¼ˆhead lengthï¼‰ï¼šæ ‡è¯†è¯¥ TCP å¤´éƒ¨æœ‰å¤šå°‘ä¸ª 32 bit(4 å­—èŠ‚)ã€‚å› ä¸º 4 ä½æœ€å¤§èƒ½è¡¨ç¤º 15ï¼Œæ‰€ä»¥ TCP å¤´éƒ¨æœ€é•¿æ˜¯60 å­—èŠ‚ã€‚</li><li>6 ä½æ ‡å¿—ä½åŒ…å«å¦‚ä¸‹å‡ é¡¹ï¼š<ul><li>URG æ ‡å¿—ï¼Œè¡¨ç¤ºç´§æ€¥æŒ‡é’ˆï¼ˆurgent pointerï¼‰æ˜¯å¦æœ‰æ•ˆã€‚</li><li>ACK æ ‡å¿—ï¼Œè¡¨ç¤ºç¡®è®¤å·æ˜¯å¦æœ‰æ•ˆã€‚æˆ‘ä»¬ç§°æºå¸¦ ACK æ ‡å¿—çš„ TCP æŠ¥æ–‡æ®µä¸ºç¡®è®¤æŠ¥æ–‡æ®µã€‚ PSH æ ‡å¿—ï¼Œæç¤ºæ¥æ”¶ç«¯åº”ç”¨ç¨‹åºåº”è¯¥ç«‹å³ä» TCP æ¥æ”¶ç¼“å†²åŒºä¸­è¯»èµ°æ•°æ®ï¼Œä¸ºæ¥æ”¶åç»­æ•°æ®è…¾ å‡ºç©ºé—´ï¼ˆå¦‚æœåº”ç”¨ç¨‹åºä¸å°†æ¥æ”¶åˆ°çš„æ•°æ®è¯»èµ°ï¼Œå®ƒä»¬å°±ä¼šä¸€ç›´åœç•™åœ¨ TCP æ¥æ”¶ç¼“å†²åŒºä¸­ï¼‰ã€‚</li><li>RST æ ‡å¿—ï¼Œè¡¨ç¤ºè¦æ±‚å¯¹æ–¹é‡æ–°å»ºç«‹è¿æ¥ã€‚æˆ‘ä»¬ç§°æºå¸¦ RST æ ‡å¿—çš„ TCP æŠ¥æ–‡æ®µä¸ºå¤ä½æŠ¥æ–‡æ®µã€‚</li><li>SYN æ ‡å¿—ï¼Œè¡¨ç¤ºè¯·æ±‚å»ºç«‹ä¸€ä¸ªè¿æ¥ã€‚æˆ‘ä»¬ç§°æºå¸¦ SYN æ ‡å¿—çš„ TCP æŠ¥æ–‡æ®µä¸ºåŒæ­¥æŠ¥æ–‡æ®µã€‚</li><li>FIN æ ‡å¿—ï¼Œè¡¨ç¤ºé€šçŸ¥å¯¹æ–¹æœ¬ç«¯è¦å…³é—­è¿æ¥äº†ã€‚æˆ‘ä»¬ç§°æºå¸¦ FIN æ ‡å¿—çš„ TCP æŠ¥æ–‡æ®µä¸ºç»“æŸæŠ¥æ–‡ æ®µã€‚</li><li>16 ä½çª—å£å¤§å°ï¼ˆwindow sizeï¼‰ï¼šæ˜¯ TCP æµé‡æ§åˆ¶çš„ä¸€ä¸ªæ‰‹æ®µã€‚è¿™é‡Œè¯´çš„çª—å£ï¼ŒæŒ‡çš„æ˜¯æ¥æ”¶ é€šå‘Šçª—å£ï¼ˆReceiver Windowï¼ŒRWNDï¼‰ã€‚å®ƒå‘Šè¯‰å¯¹æ–¹æœ¬ç«¯çš„ TCP æ¥æ”¶ç¼“å†²åŒºè¿˜èƒ½å®¹çº³å¤šå°‘ å­—èŠ‚çš„æ•°æ®ï¼Œè¿™æ ·å¯¹æ–¹å°±å¯ä»¥æ§åˆ¶å‘é€æ•°æ®çš„é€Ÿåº¦ã€‚</li><li>16 ä½æ ¡éªŒå’Œï¼ˆTCP checksumï¼‰ï¼šç”±å‘é€ç«¯å¡«å……ï¼Œæ¥æ”¶ç«¯å¯¹ TCP æŠ¥æ–‡æ®µæ‰§è¡Œ CRC ç®—æ³•ä»¥æ ¡éªŒ TCP æŠ¥æ–‡æ®µåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦æŸåã€‚æ³¨æ„ï¼Œè¿™ä¸ªæ ¡éªŒä¸ä»…åŒ…æ‹¬ TCP å¤´éƒ¨ï¼Œä¹ŸåŒ…æ‹¬æ•°æ®éƒ¨åˆ†ã€‚ è¿™ä¹Ÿæ˜¯ TCP å¯é ä¼ è¾“çš„ä¸€ä¸ªé‡è¦ä¿éšœã€‚</li><li>16 ä½ç´§æ€¥æŒ‡é’ˆï¼ˆurgent pointerï¼‰ï¼šæ˜¯ä¸€ä¸ªæ­£çš„åç§»é‡ã€‚å®ƒå’Œåºå·å­—æ®µçš„å€¼ç›¸åŠ è¡¨ç¤ºæœ€åä¸€ ä¸ªç´§æ€¥æ•°æ®çš„ä¸‹ä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚å› æ­¤ï¼Œç¡®åˆ‡åœ°è¯´ï¼Œè¿™ä¸ªå­—æ®µæ˜¯ç´§æ€¥æŒ‡é’ˆç›¸å¯¹å½“å‰åºå·çš„åç§»ï¼Œä¸å¦¨ç§°ä¹‹ä¸ºç´§æ€¥åç§»ã€‚TCP çš„ç´§æ€¥æŒ‡é’ˆæ˜¯å‘é€ç«¯å‘æ¥æ”¶ç«¯å‘é€ç´§æ€¥æ•°æ®çš„æ–¹æ³•ã€‚</li></ul></li></ul><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230818175513668.png" alt="image-20230818175513668"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230819113154633.png" alt="image-20230819113154633"></p><h3 id="ç±»æ¯”"><a href="#ç±»æ¯”" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç±»æ¯”"></a> ç±»æ¯”</h3><p>æˆ‘ä»¬ç”¨ç”·å¥³æœ‹å‹çš„ä¾‹å­æ¥è¿›è¡Œä¸¾ä¾‹ï¼Œç”»å›¾å¦‚ä¸‹ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230819103736969.png" alt="image-20230819103736969"></p><p>ç”·ç”Ÿå‘å¥³ç”Ÿè¯´èƒ½ä¸èƒ½åšæˆ‘å¥³æœ‹å‹ï¼Œå¥³ç”Ÿè¯´å¯ä»¥ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™å¥³ç”Ÿä¸æ”¾å¿ƒï¼Œéœ€è¦é—®ç”·ç”Ÿèƒ½ä¸èƒ½åšè‡ªå·±çš„ç”·æœ‹å‹ï¼Œä¸ºäº†è¿›è¡Œç¡®è®¤ï¼›ç”·ç”Ÿå›å¤å¯ä»¥ï¼ŒåŒæ–¹éƒ½è¡¨ç¤ºæ„¿æ„åšç”·å¥³æœ‹å‹ï¼Œä¹Ÿå°±æ˜¯åŒæ–¹éƒ½è¦ç¡®è®¤å¯¹æ–¹å’Œè‡ªå·±èƒ½å¤Ÿå»ºç«‹è¿æ¥å¹¶ä¸”èƒ½å¤Ÿå‘é€æ¶ˆæ¯å’Œæ”¶åˆ°æ¶ˆæ¯ï¼Œè¿™æ‰èƒ½ä¿è¯æ•´ä¸ªTCPè¿æ¥çš„å¯é æ€§ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆTCPè¿æ¥éœ€è¦å»ºç«‹è¿æ¥</p><h3 id="ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹è€Œä¸æ˜¯ä¸¤æ¬¡æ¡æ‰‹"><a href="#ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹è€Œä¸æ˜¯ä¸¤æ¬¡æ¡æ‰‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹è€Œä¸æ˜¯ä¸¤æ¬¡æ¡æ‰‹"></a> ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹è€Œä¸æ˜¯ä¸¤æ¬¡æ¡æ‰‹ï¼Ÿ</h3><p><strong>ä¸ºäº†èƒ½å¤Ÿå»ºç«‹èµ·å¯é çš„è¿æ¥ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŒæ–¹éƒ½å¿…é¡»å„è‡ªç¡®è®¤ä¸€äº›ä¿¡æ¯æ‰èƒ½ä¿è¯æ•´ä¸ªè¿æ¥æ˜¯å¯é çš„ï¼Œå°±æ˜¯ç¡®è®¤åŒæ–¹éƒ½èƒ½æ¥å—å’Œå‘é€æ¶ˆæ¯ï¼Œå¥½ï¼Œæˆ‘ä»¬ä¸€æ¬¡ä¸€æ¬¡æ¥çœ‹</strong></p><ul><li><strong>ç¬¬ä¸€æ¬¡å®¢æˆ·ç«¯å‘é€SYN=1çš„è¯·æ±‚è¿æ¥æ¶ˆæ¯ï¼Œè¿™ä¸ªæ—¶å€™å®¢æˆ·ç«¯èƒ½å¤Ÿç¡®è®¤è‡ªå·±çš„å‘é€æ•°æ®æ²¡æœ‰é—®é¢˜ï¼›æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚è¿æ¥æ¶ˆæ¯ä¹‹åèƒ½å¤Ÿç¡®è®¤è‡ªå·±çš„æ¥æ”¶æ•°æ®æ²¡æœ‰é—®é¢˜ï¼Œå¹¶ä¸”è¿˜èƒ½å¤Ÿç¡®è®¤å®¢æˆ·ç«¯çš„å‘é€æ•°æ®æ²¡æœ‰é—®é¢˜</strong></li><li><strong>ç¬¬äºŒæ¬¡æœåŠ¡ç«¯å‘é€ACK=1 SYN=1çš„ç¡®è®¤ä¿¡æ¯ï¼ŒæœåŠ¡ç«¯èƒ½å¤Ÿç¡®è®¤è‡ªå·±çš„å‘é€æ•°æ®æ²¡æœ‰é—®é¢˜ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„æ¶ˆæ¯ä¹‹åèƒ½å¤Ÿç¡®è®¤æœåŠ¡ç«¯çš„å‘é€æ•°æ®æ²¡æœ‰é—®é¢˜ï¼Œå¹¶ä¸”ç”±äºè¿™æ¡æ¶ˆæ¯æ˜¯å› ä¸ºå®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼ŒæœåŠ¡ç«¯å›å¤çš„ï¼Œå› æ­¤å®¢æˆ·ç«¯è¿˜èƒ½ç¡®è®¤æœåŠ¡ç«¯çš„æ”¶åˆ°æ•°æ®æ²¡æœ‰é—®é¢˜ï¼Œè‡³æ­¤ï¼Œå®¢æˆ·ç«¯å·²ç»èƒ½å¤Ÿå®Œå…¨ç¡®è®¤è‡ªå·±å’ŒæœåŠ¡ç«¯æ”¶å‘æ•°æ®éƒ½æ²¡æœ‰é—®é¢˜äº†</strong></li><li><strong>ä½†æ˜¯æˆ‘ä»¬ç°åœ¨è§‚å¯ŸæœåŠ¡ç«¯ï¼Œä»–è¿˜æ²¡æœ‰åŠæ³•ç¡®è®¤å®¢æˆ·ç«¯æ¥æ”¶æ•°æ®æœ‰æ²¡æœ‰é—®é¢˜ï¼Œå› ä¸ºæœåŠ¡ç«¯è¿˜æ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯çš„å›å¤æŠ¥æ–‡ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Œå®¢æˆ·ç«¯é’ˆå¯¹ä¸Šä¸€æ¡ç¡®è®¤æŠ¥æ–‡åœ¨å‘é€ä¸€æ¡ç¡®è®¤æŠ¥æ–‡ï¼Œè¿™ä¸ªæ—¶å€™æœåŠ¡ç«¯æ‰èƒ½å®Œå…¨ç¡®è®¤æ‰€æœ‰éƒ½æ²¡é—®é¢˜ï¼Œæ¢å¥è¯è¯´ï¼Œè¿™ä¸ªè¿æ¥æ‰æ˜¯å¯é çš„!!!</strong></li></ul><h2 id="tcpæ»‘åŠ¨çª—å£"><a href="#tcpæ»‘åŠ¨çª—å£" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#tcpæ»‘åŠ¨çª—å£"></a> TCPæ»‘åŠ¨çª—å£</h2><p>æ»‘åŠ¨çª—å£ï¼ˆSliding windowï¼‰æ˜¯ä¸€ç§æµé‡æ§åˆ¶æŠ€æœ¯ã€‚æ—©æœŸçš„ç½‘ç»œé€šä¿¡ä¸­ï¼Œé€šä¿¡åŒæ–¹ä¸ä¼šè€ƒè™‘ç½‘ç»œçš„æ‹¥æŒ¤æƒ…å†µç›´æ¥å‘é€æ•°æ®ã€‚ç”±äºå¤§å®¶ä¸çŸ¥é“ç½‘ç»œæ‹¥å¡çŠ¶å†µï¼ŒåŒæ—¶å‘é€æ•°æ®ï¼Œå¯¼è‡´ä¸­é—´èŠ‚ç‚¹é˜»å¡æ‰åŒ…ï¼Œ è°ä¹Ÿå‘ä¸äº†æ•°æ®ï¼Œæ‰€ä»¥å°±æœ‰äº†æ»‘åŠ¨çª—å£æœºåˆ¶æ¥è§£å†³æ­¤é—®é¢˜ã€‚æ»‘åŠ¨çª—å£åè®®æ˜¯ç”¨æ¥æ”¹å–„ååé‡çš„ä¸€ç§ æŠ€æœ¯ï¼Œå³å®¹è®¸å‘é€æ–¹åœ¨æ¥æ”¶ä»»ä½•åº”ç­”ä¹‹å‰ä¼ é€é™„åŠ çš„åŒ…ã€‚æ¥æ”¶æ–¹å‘Šè¯‰å‘é€æ–¹åœ¨æŸä¸€æ—¶åˆ»èƒ½é€å¤šå°‘åŒ… ï¼ˆç§°çª—å£å°ºå¯¸ï¼‰ã€‚</p><p>TCP ä¸­é‡‡ç”¨æ»‘åŠ¨çª—å£æ¥è¿›è¡Œä¼ è¾“æ§åˆ¶ï¼Œæ»‘åŠ¨çª—å£çš„å¤§å°æ„å‘³ç€æ¥æ”¶æ–¹è¿˜æœ‰å¤šå¤§çš„ç¼“å†²åŒºå¯ä»¥ç”¨äº æ¥æ”¶æ•°æ®ã€‚å‘é€**æ–¹å¯ä»¥é€šè¿‡æ»‘åŠ¨çª—å£çš„å¤§å°æ¥ç¡®å®šåº”è¯¥å‘é€å¤šå°‘å­—èŠ‚çš„æ•°æ®ã€‚å½“æ»‘åŠ¨çª—å£ä¸º 0 æ—¶ï¼Œå‘é€æ–¹ä¸€èˆ¬ä¸èƒ½å†å‘é€æ•°æ®æŠ¥ã€‚</p><p>æ»‘åŠ¨çª—å£æ˜¯ TCP ä¸­å®ç°è¯¸å¦‚ ACK ç¡®è®¤ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶çš„æ‰¿è½½ç»“æ„ã€‚</p><p>çª—å£ç†è§£ä¸ºç¼“å†²åŒºçš„å¤§å°</p><p>æ»‘åŠ¨çª—å£çš„å¤§å°ä¼šéšç€å‘é€æ•°æ®å’Œæ¥æ”¶æ•°æ®è€Œå˜åŒ–</p><p>é€šä¿¡çš„åŒæ–¹éƒ½æœ‰å‘é€ç¼“å†²åŒºå’Œæ¥å—ç¼“å†²åŒº</p><ul><li>æœåŠ¡å™¨ï¼š<ul><li>å‘é€ç¼“å†²åŒº (å‘é€ç¼“å†²åŒºçš„çª—å£)</li><li>æ¥å—ç¼“å†²åŒº (æ¥å—ç¼“å†²åŒºçš„çª—å£)</li></ul></li><li>å®¢æˆ·ç«¯ï¼š<ul><li>å‘é€ç¼“å†²åŒº (å‘é€ç¼“å†²åŒºçš„çª—å£)</li><li>æ¥å—ç¼“å†²åŒº (æ¥å—ç¼“å†²åŒºçš„çª—å£)</li></ul></li></ul><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230818175617550.png" alt="image-20230818175617550"></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">å‘é€æ–¹çš„ç¼“å†²åŒºï¼š</span><br><span class="line">    ç™½è‰²æ ¼å­ï¼šç©ºé—²çš„ç©ºé—´</span><br><span class="line">    ç°è‰²æ ¼å­ï¼šæ•°æ®å·²ç»è¢«å‘é€å‡ºå»äº†ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è¢«æ¥å—</span><br><span class="line">   	ç´«è‰²æ ¼å­ï¼šè¿˜æ²¡æœ‰å‘é€å‡ºå»çš„æ•°æ®</span><br><span class="line">    </span><br><span class="line">æ¥å—æ–¹çš„ç¼“å†²åŒºï¼š</span><br><span class="line">    ç™½è‰²æ ¼å­ï¼šç©ºé—²çš„ç©ºé—´</span><br><span class="line">    ç´«è‰²æ ¼å­ï¼šå·²ç»æ¥æ”¶åˆ°çš„æ•°æ®</span><br></pre></td></tr></table></div></figure><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230818175628648.png" alt="image-20230818175628648"></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># mss : Maximum Segment Size(ä¸€æ¡æ•°æ®æœ€å¤§çš„æ•°æ®é‡)</span></span><br><span class="line"><span class="meta"># win : æ»‘åŠ¨çª—å£</span></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¿æ¥ï¼Œå®¢æˆ·ç«¯çš„æ»‘åŠ¨çª—å£æ˜¯<span class="number">4096</span>ï¼Œä¸€æ¬¡å‘é€çš„æœ€å¤§æ•°æ®é‡æ˜¯<span class="number">1460</span></span><br><span class="line"><span class="number">2.</span>æœåŠ¡å™¨æ¥å—è¿æ¥è¯·æ±‚ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯æœåŠ¡å™¨çš„çª—å£å¤§å°æ˜¯<span class="number">6144</span>ï¼Œä¸€æ¬¡å‘é€çš„æœ€å¤§æ•°æ®é‡æ˜¯<span class="number">1024</span></span><br><span class="line"><span class="number">3.</span>ç¬¬ä¸‰æ¬¡æ¡æ‰‹</span><br><span class="line"><span class="number">4.4</span><span class="number">-9</span> å®¢æˆ·ç«¯è¿ç»­ç»™æœåŠ¡å™¨å‘é€äº†<span class="number">6</span>kçš„æ•°æ®ï¼Œæ¯æ¬¡å‘é€<span class="number">1</span>k</span><br><span class="line"><span class="number">5.</span>ç¬¬<span class="number">10</span>æ¬¡ï¼ŒæœåŠ¡å™¨å‘Šè¯‰å®¢æˆ·ç«¯ï¼šå‘é€çš„<span class="number">6</span>kæ•°æ®å·²ç»æ¥æ”¶åˆ°ï¼Œå­˜å‚¨åœ¨ç¼“å†²åŒºä¸­ï¼Œç¼“å†²åŒºæ•°æ®å·²ç»å¤„ç†äº†<span class="number">2</span>kï¼Œçª—å£å¤§å°æ˜¯<span class="number">2</span>k</span><br><span class="line"><span class="number">6.</span>ç¬¬<span class="number">10</span>æ¬¡ï¼ŒæœåŠ¡å™¨å‘Šè¯‰å®¢æˆ·ç«¯ï¼šå‘é€çš„<span class="number">6</span>kæ•°æ®å·²ç»æ¥æ”¶åˆ°ï¼Œå­˜å‚¨åœ¨ç¼“å†²åŒºä¸­ï¼Œç¼“å†²åŒºæ•°æ®å·²ç»å¤„ç†äº†<span class="number">4</span>kï¼Œçª—å£å¤§å°æ˜¯<span class="number">4</span>k</span><br><span class="line"><span class="number">7.</span>ç¬¬<span class="number">12</span>æ¬¡ï¼Œå®¢æˆ·ç«¯ç»™æœåŠ¡å™¨å‘é€äº†<span class="number">1</span>kçš„æ•°æ®</span><br><span class="line"><span class="number">8.</span>ç¬¬<span class="number">13</span>æ¬¡ï¼Œå®¢æˆ·ç«¯ä¸»åŠ¨è¯·æ±‚å’ŒæœåŠ¡ç«¯æ–­å¼€è¿æ¥ï¼Œå¹¶ä¸”ç»™æœåŠ¡å™¨å‘é€<span class="number">1</span>kçš„æ•°æ®</span><br><span class="line"><span class="number">9.</span>ç¬¬<span class="number">14</span>æ¬¡ï¼ŒæœåŠ¡å™¨å›å¤ACK <span class="number">8194</span>ï¼ŒåŒæ„å®¢æˆ·ç«¯æ–­å¼€è¿æ¥çš„è¯·æ±‚ï¼Œå¹¶ä¸”å‘Šè¯‰å®¢æˆ·ç«¯å·²ç»æ¥æ”¶åˆ°åˆšæ‰çš„<span class="number">2</span>kçš„æ•°æ®ï¼Œå¹¶ä¸”æŒ‡å‡ºæ»‘åŠ¨çª—å£çš„å¤§å°</span><br><span class="line"><span class="number">10.</span>ç¬¬<span class="number">15</span>ï¼Œ<span class="number">16</span>æ¬¡ï¼Œé€šçŸ¥å®¢æˆ·ç«¯æ»‘åŠ¨çª—å£çš„å¤§å°</span><br><span class="line"><span class="number">11.</span>ç¬¬<span class="number">17</span>æ¬¡ï¼Œç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼ŒæœåŠ¡ç«¯ç»™å®¢æˆ·ç«¯å‘é€FINï¼Œè¯·æ±‚æ–­å¼€è¿æ¥</span><br><span class="line"><span class="number">12.</span>ç¬¬<span class="number">18</span>æ¬¡ï¼Œç¬¬å››æ¬¡æŒ¥æ‰‹ï¼Œå®¢æˆ·ç«¯åŒæ„äº†æœåŠ¡ç«¯çš„æ–­å¼€è¿æ¥è¯·æ±‚</span><br></pre></td></tr></table></div></figure><h2 id="tcpå››æ¬¡æŒ¥æ‰‹"><a href="#tcpå››æ¬¡æŒ¥æ‰‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#tcpå››æ¬¡æŒ¥æ‰‹"></a> TCPå››æ¬¡æŒ¥æ‰‹</h2><p><strong>å››æ¬¡æŒ¥æ‰‹å‘ç”Ÿåœ¨æ–­å¼€è¿æ¥çš„æ—¶å€™ï¼Œåœ¨ç¨‹åºä¸­å½“è°ƒç”¨close()ä¼šä½¿ç”¨TCPåè®®è¿›è¡Œ4æ¬¡æŒ¥æ‰‹ã€‚</strong></p><p><strong>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¯ä»¥ä¸»åŠ¨å‘èµ·æ–­å¼€è¿æ¥ï¼Œè°å…ˆè°ƒç”¨close()è°å°±å…ˆå‘èµ·</strong></p><p><strong>å› ä¸ºåœ¨TCPè¿æ¥çš„æ—¶å€™ï¼Œé‡‡ç”¨ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹çš„è¿æ¥æ˜¯åŒå‘çš„ï¼Œå› æ­¤åœ¨æ–­å¼€çš„æ—¶å€™ä¹Ÿéœ€è¦åŒå‘æ–­å¼€ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆéœ€è¦å››æ¬¡æŒ¥æ‰‹</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230818175657616.png" alt="image-20230818175657616"></p><h3 id="ç±»æ¯”-2"><a href="#ç±»æ¯”-2" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç±»æ¯”-2"></a> ç±»æ¯”</h3><p>è¿˜æ˜¯ç”¨ç”·å¥³çš„ä¾‹å­æ¥ä¸¾ä¾‹ï¼š</p><p><strong>å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘å‡ºæ–­å¼€è¿æ¥è¯·æ±‚FINï¼ŒæœåŠ¡ç«¯æ¥å—è¯·æ±‚ï¼Œå¹¶è¿”å›ç¡®è®¤ï¼Œè‡³æ­¤ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯æ–¹å‘çš„æ•°æ®ä¼ è¾“å°±æ–­å¼€äº†ï¼›ä½†æ˜¯æœåŠ¡ç«¯ä»å¯ä»¥å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼Œå½“å‘é€æ•°æ®å®Œæ¯•ä¹‹å(æˆ–è€…ä¸å‘)æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€æ–­å¼€è¿æ¥è¯·æ±‚FINï¼Œå®¢æˆ·ç«¯æ¥å—è¯·æ±‚ï¼Œç„¶åè¿”å›é’ˆå¯¹è¯¥è¯·æ±‚æŠ¥æ–‡çš„ç¡®è®¤ï¼Œè‡³æ­¤æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯æ–¹å‘çš„æ•°æ®ä¼ è¾“æ–­å¼€ï¼Œè¯¥TCPè¿æ¥å°±æ­¤å…³é—­</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230819150618612.png" alt="image-20230819150618612"></p><p>é‚£æˆ‘ä»¬æƒ³ä¸€ä¸‹ï¼Œç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥èƒ½ä¸èƒ½åˆèµ·æ¥å‘¢ï¼Ÿä¹Ÿå°±æ˜¯ï¼š</p><h3 id="ä¸ºä»€ä¹ˆè¦å››æ¬¡æŒ¥æ‰‹è€Œä¸æ˜¯ä¸‰æ¬¡æŒ¥æ‰‹"><a href="#ä¸ºä»€ä¹ˆè¦å››æ¬¡æŒ¥æ‰‹è€Œä¸æ˜¯ä¸‰æ¬¡æŒ¥æ‰‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä¸ºä»€ä¹ˆè¦å››æ¬¡æŒ¥æ‰‹è€Œä¸æ˜¯ä¸‰æ¬¡æŒ¥æ‰‹"></a> ä¸ºä»€ä¹ˆè¦å››æ¬¡æŒ¥æ‰‹è€Œä¸æ˜¯ä¸‰æ¬¡æŒ¥æ‰‹ï¼Ÿ</h3><p><strong>æˆ‘ä¸ªäººçš„ç†è§£æ˜¯ï¼Œé¦–å…ˆå‰ä¸¤æ­¥å’Œåä¸¤æ­¥çš„å·¥ä½œæ˜¯ä¸åŒçš„ï¼Œå‰ä¸¤æ­¥æ˜¯é’ˆå¯¹å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯é‡Šæ”¾è¿æ¥çš„(åœ¨è¿™é‡Œæ˜¯å®¢æˆ·ç«¯å…ˆé‡Šæ”¾è¿æ¥)ï¼Œåä¸¤æ­¥æ˜¯é’ˆå¯¹æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯é‡Šæ”¾è¿æ¥ï¼ŒåŠŸèƒ½ä¸åŒï¼Œé’ˆå¯¹ä¸åŒï¼›å…¶æ¬¡ï¼Œåœ¨ç¬¬ä¸‰æ­¥æœåŠ¡ç«¯å‘å‡ºé‡Šæ”¾è¿æ¥è¯·æ±‚ä¹‹å‰ï¼ŒæœåŠ¡ç«¯è¿˜å¯ä»¥ä½†å•æ–¹é¢çš„å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼Œè¿™æ—¶å®¢æˆ·ç«¯è™½ç„¶ä¸èƒ½å‘é€æ•°æ®ï¼Œä½†æ˜¯ä»å¯ä»¥æ¥å—æœåŠ¡ç«¯å‘é€çš„æ•°æ®ï¼ŒæœåŠ¡ç«¯å¾ˆå¯èƒ½è¿˜æœ‰æ²¡æœ‰å‘é€å®Œæ¯•çš„æ•°æ®æƒ³è¦å‘é€ï¼Œå› ä¸ºè¿™ä¸ªé‡Šæ”¾è¿æ¥çš„è¯·æ±‚æ˜¯å®¢æˆ·ç«¯æå‡ºçš„ï¼Œè¿™æ ·ä¸¤ä¸ªæ­¥éª¤å°±å¿…é¡»åˆ†å¼€äº†</strong></p><h2 id="tcpé€šä¿¡å¹¶å‘"><a href="#tcpé€šä¿¡å¹¶å‘" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#tcpé€šä¿¡å¹¶å‘"></a> TCPé€šä¿¡å¹¶å‘</h2><h3 id="å¤šè¿›ç¨‹å®ç°å¹¶å‘æœåŠ¡å™¨"><a href="#å¤šè¿›ç¨‹å®ç°å¹¶å‘æœåŠ¡å™¨" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å¤šè¿›ç¨‹å®ç°å¹¶å‘æœåŠ¡å™¨"></a> å¤šè¿›ç¨‹å®ç°å¹¶å‘æœåŠ¡å™¨</h3><p><strong>è¦å®ç°TCPé€šä¿¡æœåŠ¡å™¨å¹¶å‘çš„ä»»åŠ¡ï¼Œä½¿ç”¨å¤šçº¿ç¨‹æˆ–è€…å¤šè¿›ç¨‹è§£å†³</strong></p><p><strong>æ€è·¯ï¼š</strong></p><ul><li><strong>ä¸€ä¸ªçˆ¶è¿›ç¨‹ï¼Œå¤šä¸ªå­è¿›ç¨‹</strong></li><li><strong>çˆ¶è¿›ç¨‹è´Ÿè´£ç­‰å¾…å¹¶ä¸”æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥</strong></li><li><strong>å­è¿›ç¨‹è´Ÿè´£å®Œæˆé€šä¿¡ï¼Œæ¥å—ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼Œåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ç”¨äºé€šä¿¡</strong></li></ul><p>ä»¥ä¸‹æ˜¯ä»£ç ï¼š</p><p>å®Œæˆçš„åŠŸèƒ½æ˜¯ï¼ŒæœåŠ¡ç«¯å¯ä»¥æ¥å—å¤šä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ï¼Œç„¶åå®¢æˆ·ç«¯é”®å…¥æ•°æ®ï¼ŒæœåŠ¡ç«¯è¿”å›ç›¸åŒçš„æ•°æ®</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_IPV4_STRING 16</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXSIZE 1024</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Recycle_Callback</span><span class="params">(<span class="type">int</span> signum)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥ç”¨æ¥è·å–å­è¿›ç¨‹é€€å‡ºçš„çŠ¶æ€</span></span><br><span class="line">        <span class="type">int</span> ret = <span class="built_in">waitpid</span>(<span class="number">-1</span>, <span class="literal">nullptr</span>, WNOHANG);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">-1</span> == ret)</span><br><span class="line">            <span class="comment">//-1è¡¨ç¤ºå›æ”¶é”™è¯¯ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰å­è¿›ç¨‹äº†ï¼Œä¸ºäº†è¾¾åˆ°è¿™ä¸ªåˆ¤æ–­ï¼Œæˆ‘ä»¬ä½¿ç”¨éé˜»å¡çš„ï¼Œå› ä¸ºé˜»å¡çš„ä»–ä¼šé˜»å¡</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == ret)  <span class="comment">// 0åœ¨éé˜»å¡çš„æƒ…å†µä¸‹ä»£è¡¨è¿˜æœ‰å­è¿›ç¨‹æ´»ç€ï¼Œé‡å¼€å¾ªç¯æŠŠç»“æŸçš„å­è¿›ç¨‹å°½å¯èƒ½éƒ½å›æ”¶</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (ret &gt; <span class="number">0</span>)</span><br><span class="line">            <span class="comment">// å›æ”¶äº†æŸä¸ªå­è¿›ç¨‹</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;child process (pid %d) has be recycled.\n&quot;</span>, ret);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥å—å¤šä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ï¼Œè¿™ä¸ªç¨‹åºç”¨å¤šè¿›ç¨‹æ¥å¤„ç†</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> <span class="type">const</span>* argv[])</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºå‡ºæ¥å­è¿›ç¨‹çˆ¶è¿›ç¨‹éœ€è¦å¯¹å…¶è¿›è¡Œå›æ”¶çš„æ“ä½œï¼Œä½†æ˜¯wait()æˆ–è€…waitpid()æ— è®ºæ˜¯é˜»å¡è¿˜æ˜¯éé˜»å¡çš„æƒ…å†µéƒ½æ²¡åŠæ³•å®ç°æˆ‘ä»¬æƒ³è¦çš„æ“ä½œ</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥æƒ³åˆ°æ•æ‰ä¿¡å·SIGCHID</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sigaction</span> sig_child;</span><br><span class="line">    sig_child.sa_flags = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">sigemptyset</span>(&amp;sig_child.sa_mask);  <span class="comment">// ä¸é˜»å¡ä»»ä½•ä¸´æ—¶çš„ä¿¡å·</span></span><br><span class="line">    sig_child.sa_handler = Recycle_Callback;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">sigaction</span>(SIGCHLD, &amp;sig_child, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘½ä»¤è¡Œå‚æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;usage : %s  &lt;ip_address&gt;  &lt;port&gt;\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* server_ip = argv[<span class="number">1</span>];</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> server_port = <span class="built_in">atoi</span>(argv[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºsocketå¥—æ¥å­—</span></span><br><span class="line">    <span class="type">int</span> listen_fd = <span class="built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == listen_fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;socket&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.å°†å¥—æ¥å­—ç»‘å®šIPå’Œç«¯å£</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> server_addr;</span><br><span class="line">    <span class="comment">// åœ°å€æ—</span></span><br><span class="line">    server_addr.sin_family = AF_INET;</span><br><span class="line">    <span class="comment">// ç«¯å£ï¼Œæ³¨æ„è½¬æ¢å­—èŠ‚åº</span></span><br><span class="line">    server_addr.sin_port = <span class="built_in">htons</span>(server_port);</span><br><span class="line">    <span class="comment">// IP</span></span><br><span class="line">    <span class="built_in">inet_pton</span>(AF_INET, server_ip, &amp;server_addr.sin_addr.s_addr);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">bind</span>(listen_fd, (<span class="keyword">struct</span> sockaddr*)&amp;server_addr, <span class="built_in">sizeof</span>(server_addr));</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;bind&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.å¼€å§‹ç›‘å¬</span></span><br><span class="line">    ret = <span class="built_in">listen</span>(listen_fd, <span class="number">5</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;listen&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸æ–­å¾ªç¯ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// 4.æ¥å—è¯·æ±‚</span></span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> client_addr;</span><br><span class="line">        <span class="type">socklen_t</span> client_addr_len = <span class="built_in">sizeof</span>(client_addr);</span><br><span class="line">        <span class="type">int</span> connect_fd = <span class="built_in">accept</span>(listen_fd, (<span class="keyword">struct</span> sockaddr*)&amp;client_addr, &amp;client_addr_len);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">-1</span> == connect_fd) &#123;</span><br><span class="line">            <span class="keyword">if</span> (errno == EINTR)</span><br><span class="line">                <span class="comment">// è¯´æ˜äº§ç”Ÿäº†ä¿¡å·å‘ç”Ÿäº†è½¯ä¸­æ–­ï¼Œæ‰§è¡Œå›æ¥accept()å°±ä¸é˜»å¡äº†ï¼Œè¿™æ˜¯é¢„æ–™ä¹‹å†…çš„çŠ¶æ€ï¼Œæˆ‘ä»¬å¯¹å…¶è¿›è¡Œç»†å¾®å¤„ç†</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;accept&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.å¼€å§‹é€šä¿¡ï¼Œåœ¨å­è¿›ç¨‹ä¸­è¿›ç¨‹é€šä¿¡</span></span><br><span class="line">        <span class="type">pid_t</span> pid = fork();</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">-1</span> == pid) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> == pid) &#123;  <span class="comment">// å­è¿›ç¨‹</span></span><br><span class="line">            <span class="comment">//  è¾“å‡ºè¿æ¥çš„å®¢æˆ·ç«¯çš„IPå’Œç«¯å£</span></span><br><span class="line">            <span class="type">char</span> client_ip[MAX_IPV4_STRING] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">            <span class="built_in">inet_ntop</span>(AF_INET, &amp;client_addr.sin_addr.s_addr, client_ip, <span class="built_in">sizeof</span>(client_ip));</span><br><span class="line">            <span class="type">in_port_t</span> client_port = <span class="built_in">ntohs</span>(client_addr.sin_port);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;one client has connected , ip : %s , port : %d\n&quot;</span>, client_ip, client_port);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¤„ç†æ•°æ®ï¼Œæ¥å—å®¢æˆ·ç«¯çš„æ•°æ®å¹¶ä¸”ç›¸åŒè¿”å›</span></span><br><span class="line">            <span class="type">char</span> buf[MAXSIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">            <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">// è¯»</span></span><br><span class="line">                <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">                <span class="type">int</span> len = <span class="built_in">read</span>(connect_fd, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>);  <span class="comment">// è¿™é‡Œè€å¸ˆæåˆ°è¦æ³¨æ„\0ï¼Œæˆ‘è¿™ä¹ˆåšä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæˆ‘åœ¨è¯»çš„æ—¶å€™ç•™å‡º\0çš„ç©ºé—´ï¼Œå†™çš„æ—¶å€™æˆ‘å…¨éƒ¨å†™å…¥ï¼Œè¿™æ ·æˆ‘çš„bufæœ€åè‚¯å®šæ˜¯æœ‰\0çš„</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="number">-1</span> == len) &#123;</span><br><span class="line">                    <span class="built_in">perror</span>(<span class="string">&quot;read&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;recv client (ip : %s , port : %d) data : %s&quot;</span>, client_ip, client_port, buf);</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == pid) &#123;</span><br><span class="line">                    <span class="comment">// å†™ç«¯æ–­å¼€è¿æ¥ï¼Œå­è¿›ç¨‹ä»»åŠ¡ç»“æŸï¼Œé€€å‡º</span></span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;client (ip : %s , port : %d) has closed...\n&quot;</span>, client_ip, client_port);</span><br><span class="line">                    <span class="built_in">close</span>(connect_fd);</span><br><span class="line">                    <span class="keyword">goto</span> FINAL;  <span class="comment">// è·³è½¬åˆ°ç¨‹åºç»“æŸçš„ä½ç½®</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å†™</span></span><br><span class="line">                <span class="built_in">write</span>(connect_fd, buf, <span class="built_in">strlen</span>(buf));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid &gt; <span class="number">0</span>)  <span class="comment">// çˆ¶è¿›ç¨‹</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6.æ–­å¼€è¿æ¥</span></span><br><span class="line">FINAL:</span><br><span class="line">    <span class="built_in">close</span>(listen_fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p>ç›´æˆªå–äº†æœåŠ¡ç«¯çš„å›¾ç‰‡</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230819170952283.png" alt="image-20230819170952283"></p><p><strong>æœåŠ¡å™¨çš„ä»£ç æ¶‰åŠåˆ°ä¸¤ä¸ªé—®é¢˜ï¼š</strong></p><ul><li><p><strong>ä¸ºäº†é˜²æ­¢åƒµå°¸è¿›ç¨‹ï¼ŒæœåŠ¡ç«¯çš„çˆ¶è¿›ç¨‹å¿…é¡»å¯¹æ‰€æœ‰çš„å­è¿›ç¨‹è¿›è¡Œå›æ”¶ï¼Œé‚£ä¹ˆå¦‚ä½•æœ‰æ•ˆçš„å¯¹å­è¿›ç¨‹è¿›è¡Œå›æ”¶ï¼Ÿ</strong></p><p><strong>çˆ¶è¿›ç¨‹æ˜¯åœ¨ä¸æ–­çš„é˜»å¡ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œè°ƒç”¨accept()å‡½æ•°ï¼Œåœ¨è¿™é‡Œå¦‚æœå›æ”¶å­è¿›ç¨‹æ˜¯éå¸¸ä¸å¥½çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»“åˆå­è¿›ç¨‹ç»“æŸä¼šå‘å‡ºSIGCHIDä¿¡å·ï¼Œè¿™ä¸ªä¿¡å·é»˜è®¤è¢«çˆ¶è¿›ç¨‹å¿½ç•¥ï¼Œä½†æ˜¯æˆ‘ä»¬æ•æ‰è¿™ä¸ªä¿¡å·ï¼Œç„¶åå¼€å¯è½¯ä¸­æ–­ï¼Œå°±å¯ä»¥å¯¹å­è¿›ç¨‹è¿›è¡Œå›æ”¶äº†</strong></p><p><strong>æˆ‘ä»¬å¯ä»¥è°ƒç”¨waitpid()å‡½æ•°å¯¹æ‰€æœ‰çš„å­è¿›ç¨‹è¿›è¡Œå›æ”¶ï¼Œä½†æ˜¯ä¸€æ¬¡åªèƒ½å›æ”¶ä¸€ä¸ªæ‰€ä»¥éœ€è¦while(1)ï¼Œç„¶åç”±äºæˆ‘ä»¬éœ€è¦åˆ¤æ–­æ²¡æœ‰å­è¿›ç¨‹å¯ä»¥å›æ”¶çš„çŠ¶æ€ä»¥æ­¤æ¥è·³å‡ºä¸­æ–­ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨éé˜»å¡çš„waitpid()ï¼Œå½“æœåŠ¡ç«¯ç»“æŸçš„æ—¶å€™ï¼Œå¯¹åº”çš„å­è¿›ç¨‹ä¹Ÿç»“æŸï¼Œæˆ‘çš„éé˜»å¡çš„waitpid()å°±å°½å¯èƒ½çš„æŠŠå·²ç»ç»“æŸçš„å­è¿›ç¨‹ç»™å…¨éƒ¨å›æ”¶æ‰äº†ï¼Œé¿å…åƒµå°¸è¿›ç¨‹çš„å‡ºç°</strong></p></li><li><p><strong>é‚£ä¹ˆè¿™æ ·çš„è¯æˆ‘ä»¬æ‰§è¡Œå°±ä¼šå‡ºç°ç¬¬äºŒä¸ªé—®é¢˜ï¼Œå¦‚ä¸‹ï¼š</strong></p><p><strong>å½“æˆ‘ä¸€ä¸ªå­è¿›ç¨‹ç»“æŸçš„æ—¶å€™ï¼Œçˆ¶è¿›ç¨‹ä¸­æ–­å¤„ç†ä¹‹åï¼Œåº”è¯¥å›åˆ°åŸæ¥accept()çš„çŠ¶æ€ï¼Œä½†æ˜¯è¿™æ—¶accept()æŠ¥é”™äº†</strong></p><p><strong><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230819172037175.png" alt="image-20230819172037175"></strong></p><p><strong>æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ</strong></p><p><strong>å› ä¸ºaccpt()è¿™é‡Œè½¯ä¸­æ–­ç»“æŸä¹‹åï¼Œä¼šä»é˜»å¡ä¸­æ–­å˜æˆéé˜»å¡çš„ï¼Œç„¶åæ²¡æœ‰å®¢æˆ·ç«¯è¿æ¥ï¼Œå°±æŠ¥é”™äº†ï¼Œç¨‹åºç»“æŸï¼Œerrnoè¢«è®¾ç½®ä¸ºEINTR</strong></p><p><strong><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230819172505207.png" alt="image-20230819172505207"></strong></p><p><strong>æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åˆ¤æ–­ä¸€ä¸‹errnoçš„å€¼ç‰¹æ®Šå¤„ç†å°±å¥½äº†</strong></p></li></ul><p>å®¢æˆ·ç«¯ä»£ç åŸºæœ¬æ²¡å˜ï¼Œæ‰€ä»¥ä¸ç”¨æ·±ç©¶</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// client.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_SIZE 1024</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> <span class="type">const</span>* argv[])</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­å‘½ä»¤è¡Œå‚æ•°ä¸ªæ•°</span></span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;usage : %s  &lt;ip_address&gt;  &lt;port&gt;\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* server_ip = argv[<span class="number">1</span>];</span><br><span class="line">    <span class="type">const</span> <span class="type">short</span> server_port = <span class="built_in">atoi</span>(argv[<span class="number">2</span>]);  <span class="comment">// atoi()å‡½æ•°å¯ä»¥æŠŠåˆç†çš„å­—ç¬¦ä¸²è½¬åŒ–ä¸ºæ•´æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºsocket</span></span><br><span class="line">    <span class="type">int</span> connect_fd = <span class="built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == connect_fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;socket&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.å»ºç«‹è¿æ¥</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> server_addr;</span><br><span class="line">    <span class="comment">// åœ°å€æ—</span></span><br><span class="line">    server_addr.sin_family = AF_INET;</span><br><span class="line">    <span class="comment">// ç«¯å£å·</span></span><br><span class="line">    server_addr.sin_port = <span class="built_in">htons</span>(server_port);</span><br><span class="line">    <span class="comment">// IPåœ°å€</span></span><br><span class="line">    <span class="built_in">inet_pton</span>(AF_INET, server_ip, &amp;server_addr.sin_addr.s_addr);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">connect</span>(connect_fd, (<span class="keyword">struct</span> sockaddr*)&amp;server_addr, <span class="built_in">sizeof</span>(server_addr));</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;connect&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¿æ¥æˆåŠŸï¼Œè¾“å‡ºä¿¡æ¯</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;connected successfully , waiting for communication.\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.å¼€å§‹é€šä¿¡</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬è¦æ±‚å®¢æˆ·ç«¯å¯ä»¥ä»é”®ç›˜å½•å…¥å€¼è¿›è¡Œé€šä¿¡</span></span><br><span class="line">    <span class="type">char</span> buf[MAX_SIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">        <span class="comment">// å†™æ•°æ®</span></span><br><span class="line">        <span class="built_in">fgets</span>(buf, <span class="built_in">sizeof</span>(buf), stdin);  <span class="comment">// è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼ŒæœåŠ¡å™¨åœ¨é˜»å¡è¯»çš„æ—¶å€™æœåŠ¡ç«¯å¦‚æœå¼ºåˆ¶é€€å‡ºæ¯”å¦‚ ctrl + cï¼Œå°±ä¼šå‡ºé—®é¢˜ï¼Œè¿™æ ·å®¢æˆ·ç«¯ä¸ä¼šåœæ­¢ï¼Œå› ä¸ºä»–è¿˜åœ¨å†™çš„éƒ¨åˆ†é˜»å¡ï¼Œæ²¡æœ‰åœ¨è¯»çš„éƒ¨åˆ†ï¼Œä½†æ˜¯é—®é¢˜ä¸å¤§ï¼Œå› ä¸ºå®é™…å¼€å‘å½“ä¸­æˆ‘ä»¬ä¸ä¼šå¯¹æœåŠ¡å™¨åšè¿™æ ·çš„æ“ä½œ</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¢åŠ é€€å‡ºåŠŸèƒ½</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(buf, <span class="string">&quot;quit\n&quot;</span>) == <span class="number">0</span> || <span class="built_in">strcmp</span>(buf, <span class="string">&quot;QUIT\n&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;send : %s&quot;</span>, buf);</span><br><span class="line">        <span class="built_in">write</span>(connect_fd, buf, <span class="built_in">strlen</span>(buf));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¯»æ•°æ®</span></span><br><span class="line">        <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">        <span class="type">int</span> len = <span class="built_in">read</span>(connect_fd, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">-1</span> == len) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;len&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;recv : %s&quot;</span>, buf);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == len) &#123;</span><br><span class="line">            <span class="comment">// æœåŠ¡ç«¯å…³é—­äº†</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;server has closed...\n&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.å…³é—­è¿æ¥</span></span><br><span class="line">    <span class="built_in">close</span>(connect_fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="å¤šçº¿ç¨‹å®ç°å¹¶å‘æœåŠ¡å™¨"><a href="#å¤šçº¿ç¨‹å®ç°å¹¶å‘æœåŠ¡å™¨" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å¤šçº¿ç¨‹å®ç°å¹¶å‘æœåŠ¡å™¨"></a> å¤šçº¿ç¨‹å®ç°å¹¶å‘æœåŠ¡å™¨</h3><p>æœåŠ¡ç«¯çš„ä»£ç éœ€è¦æ³¨æ„ä¸€äº›ç»†èŠ‚ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXSIZE 1024</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_IPV4_STRING 16</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_INFO_SIZE 128</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å°è£…ä¸€ä¸ªç»“æ„ä½“æ¥ä¿å­˜éœ€è¦ä¼ ç»™å­çº¿ç¨‹çš„ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Pthread_Info</span> &#123;</span><br><span class="line">    <span class="type">int</span> _connect_fd;                  <span class="comment">// ç”¨äºé€šä¿¡çš„æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> _client_addr;  <span class="comment">// å®¢æˆ·ç«¯çš„socketåœ°å€ä¿¡æ¯</span></span><br><span class="line">&#125; p_infos[MAX_INFO_SIZE];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªè¿™ä¸ªæ•°ç»„çš„è®¡æ•°å™¨</span></span><br><span class="line"><span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çº¿ç¨‹å¤„ç†çš„å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">Communicate_Callback</span><span class="params">(<span class="type">void</span>* args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ¥å—å‚æ•°å¾—åˆ°é€šä¿¡ç”¨åˆ°çš„ä¿¡æ¯</span></span><br><span class="line">    <span class="type">int</span> connect_fd = ((Pthread_Info*)args)-&gt;_connect_fd;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> client_addr = ((Pthread_Info*)args)-&gt;_client_addr;</span><br><span class="line"></span><br><span class="line">    <span class="type">in_port_t</span> client_port = <span class="built_in">ntohs</span>(client_addr.sin_port);</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> client_ip[MAX_IPV4_STRING] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">inet_ntop</span>(AF_INET, &amp;client_addr.sin_addr.s_addr, client_ip, <span class="built_in">sizeof</span>(client_ip));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;one client has connected , ip : %s , port : %d\n&quot;</span>, client_ip, client_port);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼€å§‹é€šä¿¡</span></span><br><span class="line">    <span class="type">char</span> buf[MAXSIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// è¯»</span></span><br><span class="line">        <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">        <span class="type">int</span> len = <span class="built_in">read</span>(connect_fd, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">-1</span> == len) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;read&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">void</span>*)<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;recv client ( ip : %s , port : %d ) data : %s&quot;</span>, client_ip, client_port, buf);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == len) &#123;  <span class="comment">// å†™ç«¯å…³é—­ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯å…³é—­è¿æ¥ï¼Œæ‰ä¼šè¿”å›0</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;client ( ip : %s , port : %d ) has closed...\n&quot;</span>, client_ip, client_port);</span><br><span class="line">            <span class="built_in">close</span>(connect_fd);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;child thread has closed , tid : %ld\n&quot;</span>, <span class="built_in">pthread_self</span>());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// // é‡Šæ”¾å †ä¸Šçš„è¿™å—å†…å­˜</span></span><br><span class="line">            <span class="comment">// delete args;</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å†™</span></span><br><span class="line">        <span class="built_in">write</span>(connect_fd, buf, <span class="built_in">strlen</span>(buf));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// // é‡Šæ”¾å †ä¸Šçš„è¿™å—å†…å­˜</span></span><br><span class="line">    <span class="comment">// delete args;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨å¤šçº¿ç¨‹å®ç°æœåŠ¡å™¨å¹¶å‘</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> <span class="type">const</span>* argv[])</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æ•°æ®</span></span><br><span class="line">    <span class="type">int</span> size = <span class="built_in">sizeof</span>(p_infos) / <span class="built_in">sizeof</span>(p_infos[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; size; ++i) &#123;</span><br><span class="line">        <span class="comment">// å°†æ‰€æœ‰çš„éƒ½åˆå§‹åŒ–ä¸º0</span></span><br><span class="line">        <span class="built_in">bzero</span>(&amp;p_infos[i], <span class="built_in">sizeof</span>(p_infos[i]));</span><br><span class="line">        <span class="comment">// æ–‡ä»¶æè¿°ç¬¦åˆå§‹åŒ–ä¸º-1ï¼Œä¸èƒ½è®©ä»–å æ®æ­£åœ¨ä½¿ç”¨çš„</span></span><br><span class="line">        p_infos[i]._connect_fd = <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘½ä»¤è¡Œå‚æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;usage : %s  &lt;ip_address&gt;  &lt;port&gt;\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* server_ip = argv[<span class="number">1</span>];</span><br><span class="line">    <span class="type">const</span> <span class="type">unsigned</span> <span class="type">short</span> server_port = <span class="built_in">atoi</span>(argv[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºsocketå¥—æ¥å­—</span></span><br><span class="line">    <span class="type">int</span> listen_fd = <span class="built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == listen_fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;socket&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.ç»‘å®šIPå’Œç«¯å£</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> server_addr;</span><br><span class="line">    <span class="comment">// åœ°å€æ—</span></span><br><span class="line">    server_addr.sin_family = AF_INET;</span><br><span class="line">    <span class="comment">// ç«¯å£</span></span><br><span class="line">    server_addr.sin_port = <span class="built_in">htons</span>(server_port);</span><br><span class="line">    <span class="comment">// IP</span></span><br><span class="line">    <span class="built_in">inet_pton</span>(AF_INET, server_ip, &amp;server_addr.sin_addr.s_addr);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">bind</span>(listen_fd, (<span class="keyword">struct</span> sockaddr*)&amp;server_addr, <span class="built_in">sizeof</span>(server_addr));</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;bind&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.ç›‘å¬</span></span><br><span class="line">    ret = <span class="built_in">listen</span>(listen_fd, <span class="number">5</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;listen&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;server has initialized...\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.æ¥å—å®¢æˆ·ç«¯è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// æ€è·¯ï¼šä¸»çº¿ç¨‹ä¸æ–­æ¥å—å®¢æˆ·ç«¯è¯·æ±‚ï¼Œç„¶ååˆ›å»ºå­çº¿ç¨‹å’Œå®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡</span></span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> client_addr;</span><br><span class="line">        <span class="type">socklen_t</span> client_addr_len = <span class="built_in">sizeof</span>(client_addr);</span><br><span class="line">        <span class="type">int</span> connect_fd = <span class="built_in">accept</span>(listen_fd, (<span class="keyword">struct</span> sockaddr*)&amp;client_addr, &amp;client_addr_len);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">-1</span> == connect_fd) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;accept&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿™é‡Œæ˜¯å±€éƒ¨å˜é‡ï¼Œä¸ºäº†ä¿è¯å¾ªç¯ä¸€æ¬¡ä¸ä¼šè¢«é‡Šæ”¾ï¼Œæˆ‘ä»¬é€‰æ‹©å…¶ä»–çš„æ–¹å¼</span></span><br><span class="line">        <span class="comment">// æˆ‘ä»¬å¯ä»¥é€‰æ‹©ç”¨å †æ¥å­˜å‚¨ï¼Œä½†æ˜¯ä¸€æ˜¯å®¢æˆ·ç«¯æ•°é‡å¤šäº†æ²¡æœ‰åŠæ³•è¿›è¡Œé™åˆ¶ï¼Œè€Œæ˜¯è¿˜è¦å¤„ç†é‡Šæ”¾å¹¶ä¸”æ¶ˆè€—èµ„æºå¤§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¼€ä¸€ä¸ªå…¨å±€æ•°ç»„</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">Pthread_Info</span>&amp; p_info = p_infos[count++];  <span class="comment">// åˆ›å»ºæ•°ç»„æˆå‘˜çš„å¼•ç”¨åˆ«å</span></span><br><span class="line">        <span class="keyword">if</span> (count &gt;= MAX_INFO_SIZE) &#123;</span><br><span class="line">            <span class="comment">// è¶…å‡ºæœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°é‡</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;client oversize , closing...\n&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        p_info._connect_fd = connect_fd;</span><br><span class="line">        p_info._client_addr = client_addr;  <span class="comment">// è¿™ä¸ªç³»ç»Ÿç±»å®ç°äº†copy assignmentï¼Œå®ç°äº†æ·±æ‹·è´</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.å¼€å§‹é€šä¿¡</span></span><br><span class="line">        <span class="type">pthread_t</span> tid;</span><br><span class="line">        <span class="built_in">pthread_create</span>(&amp;tid, <span class="literal">nullptr</span>, Communicate_Callback, &amp;p_info);</span><br><span class="line">        <span class="comment">// å°†å­çº¿ç¨‹åˆ†ç¦»ï¼Œä¸ç”¨æ‰‹åŠ¨å›æ”¶</span></span><br><span class="line">        <span class="built_in">pthread_detach</span>(tid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6.å…³é—­è¿æ¥</span></span><br><span class="line">    <span class="built_in">close</span>(listen_fd);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€€å‡ºä¸»çº¿ç¨‹ï¼Œè¿™é‡Œå°±è¿™ä¹ˆå†™å§ï¼Œä¸»çº¿ç¨‹ä¸å¯èƒ½æ¯”å­çº¿ç¨‹æ—©ç»“æŸï¼Œå› ä¸ºä¸»çº¿ç¨‹è¦ç­‰å¾…</span></span><br><span class="line">    <span class="built_in">pthread_exit</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>å®¢æˆ·ç«¯çš„ä»£ç åŸºæœ¬æ²¡å˜ï¼Œå¯ä»¥ä¸ç”¨æ·±ç©¶</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// client.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXSIZE 1024</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> <span class="type">const</span>* argv[])</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å‘½ä»¤è¡Œ</span></span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;usage : %s  &lt;ip_address&gt;  &lt;port&gt;\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* server_ip = argv[<span class="number">1</span>];</span><br><span class="line">    <span class="type">const</span> <span class="type">unsigned</span> <span class="type">short</span> server_port = <span class="built_in">atoi</span>(argv[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºsocketå¥—æ¥å­—</span></span><br><span class="line">    <span class="type">int</span> connect_fd = <span class="built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == connect_fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;socket&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.å»ºç«‹è¿æ¥</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> server_addr;</span><br><span class="line">    <span class="comment">// åœ°å€æ—</span></span><br><span class="line">    server_addr.sin_family = AF_INET;</span><br><span class="line">    <span class="comment">// ç«¯å£</span></span><br><span class="line">    server_addr.sin_port = <span class="built_in">htons</span>(server_port);</span><br><span class="line">    <span class="comment">// IP</span></span><br><span class="line">    <span class="built_in">inet_pton</span>(AF_INET, server_ip, &amp;server_addr.sin_addr.s_addr);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">connect</span>(connect_fd, (<span class="keyword">struct</span> sockaddr*)&amp;server_addr, <span class="built_in">sizeof</span>(server_addr));</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;connect&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;connected successfully , waiting for communicating.\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> buf[MAXSIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="comment">// 3.å¼€å§‹é€šä¿¡</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// å†™</span></span><br><span class="line">        <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">        <span class="built_in">fgets</span>(buf, <span class="built_in">sizeof</span>(buf), stdin);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¢åŠ é€€å‡ºåŠŸèƒ½</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(buf, <span class="string">&quot;quit\n&quot;</span>) == <span class="number">0</span> || <span class="built_in">strcmp</span>(buf, <span class="string">&quot;QUIT\n&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">write</span>(connect_fd, buf, <span class="built_in">strlen</span>(buf));</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;send : %s&quot;</span>, buf);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¯»</span></span><br><span class="line">        <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">        <span class="type">int</span> len = <span class="built_in">read</span>(connect_fd, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">-1</span> == len) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;read&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;recv : %s&quot;</span>, buf);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == len) &#123;  <span class="comment">// è¯´æ˜å†™ç«¯å…³é—­ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å…³é—­</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;server has closed...\n&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.å…³é—­è¿æ¥</span></span><br><span class="line">    <span class="built_in">close</span>(connect_fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h2 id="tcpçŠ¶æ€è½¬æ¢"><a href="#tcpçŠ¶æ€è½¬æ¢" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#tcpçŠ¶æ€è½¬æ¢"></a> TCPçŠ¶æ€è½¬æ¢</h2><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230819153502987.png" alt="image-20230819153502987"></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230819153510357.png" alt="image-20230819153510357"></p><h3 id="2mslmaximum-segment-lifetime"><a href="#2mslmaximum-segment-lifetime" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#2mslmaximum-segment-lifetime"></a> 2MSLï¼ˆMaximum Segment Lifetimeï¼‰</h3><p><strong>ä¸»åŠ¨æ–­å¼€è¿æ¥çš„ä¸€æ–¹, æœ€åè¿›å‡ºå…¥ä¸€ä¸ª TIME_WAIT çŠ¶æ€, è¿™ä¸ªçŠ¶æ€ä¼šæŒç»­: 2msl</strong></p><ul><li>msl: å®˜æ–¹å»ºè®®: 2åˆ†é’Ÿ, å®é™…æ˜¯30s<br>å½“ TCP è¿æ¥ä¸»åŠ¨å…³é—­æ–¹æ¥æ”¶åˆ°è¢«åŠ¨å…³é—­æ–¹å‘é€çš„ FIN å’Œæœ€ç»ˆçš„ ACK åï¼Œè¿æ¥çš„ä¸»åŠ¨å…³é—­æ–¹ å¿…é¡»å¤„äºTIME_WAIT çŠ¶æ€å¹¶æŒç»­ 2MSL æ—¶é—´ã€‚<br><strong>è¿™æ ·å°±èƒ½å¤Ÿè®© TCP è¿æ¥çš„ä¸»åŠ¨å…³é—­æ–¹åœ¨å®ƒå‘é€çš„ ACK ä¸¢å¤±çš„æƒ…å†µä¸‹é‡æ–°å‘é€æœ€ç»ˆçš„ ACKã€‚ ä¸ºäº†è®©è¢«åŠ¨å…³é—­æ–¹ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹çš„FINåº”è¯¥è·å¾—çš„ç¬¬å››æ¬¡æŒ¥æ‰‹çš„ACKèƒ½å¤Ÿæ­£ç¡®åˆ°è¾¾ï¼Œå¦‚æœæœ€åä¸€æ¬¡ACKä¸¢å¤±äº†è¢«åŠ¨å…³é—­æ–¹ä¼šåŠæ—¶å†æ¬¡å‘é€ç¬¬ä¸‰æ¬¡çš„FINè®©ä¸»åŠ¨å…³é—­æ–¹å‘é€ACKæ¥ç¡®è®¤å…³é—­ï¼Œå¦åˆ™ç›´æ¥å…³é—­å°±æ²¡åŠæ³•è®©è¢«åŠ¨å…³é—­æ–¹ç¡®è®¤äº†ï¼Œä¹Ÿå°±æ˜¯å…³é—­çš„ä¸å®Œæ•´</strong><br>ä¸»åŠ¨å…³é—­æ–¹é‡æ–°å‘é€çš„æœ€ç»ˆ ACK å¹¶ä¸æ˜¯å› ä¸ºè¢«åŠ¨å…³é—­æ–¹é‡ä¼ äº† ACKï¼ˆå®ƒä»¬å¹¶ä¸æ¶ˆè€—åºåˆ—å·ï¼Œ è¢«åŠ¨å…³é—­æ–¹ä¹Ÿä¸ä¼šé‡ä¼ ï¼‰ï¼Œè€Œæ˜¯å› ä¸ºè¢«åŠ¨å…³é—­æ–¹é‡ä¼ äº†å®ƒçš„ FINã€‚äº‹å®ä¸Šï¼Œè¢«åŠ¨å…³é—­æ–¹æ€»æ˜¯ é‡ä¼  FIN ç›´åˆ°å®ƒæ”¶åˆ°ä¸€ä¸ªæœ€ç»ˆçš„ ACKã€‚</li></ul><h3 id="åŠå…³é—­"><a href="#åŠå…³é—­" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#åŠå…³é—­"></a> åŠå…³é—­</h3><p><strong>åœ¨å››æ¬¡æŒ¥æ‰‹å…³é—­çš„è¿‡ç¨‹ä¸­ä¸»åŠ¨æ–­å¼€è¿æ¥æ–¹æ”¶åˆ°äº†ä¸¤æ¬¡è¢«åŠ¨è¿æ¥æ–¹çš„æŠ¥æ–‡ï¼Œç¬¬ä¸€ä¸ªæ˜¯ç¬¬äºŒæ¬¡æŒ¥æ‰‹çš„ACKç¡®è®¤ï¼Œç¬¬äºŒä¸ªæ˜¯ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹çš„FINè¯·æ±‚ï¼Œä¸ºä»€ä¹ˆå«FIN_WAIT_1å’ŒFIN_WAIT_2ï¼Ÿå°±æ˜¯å› ä¸ºç¬¬ä¸€æ¬¡ä¸»åŠ¨æ–­å¼€è¿æ¥æ–¹å‘é€FINè¯·æ±‚åç­‰å¾…ACKç¡®è®¤ï¼Œç„¶åç¬¬äºŒæ¬¡å°±ä¸»åŠ¨ç­‰å¾…è¢«åŠ¨è¿æ¥æ–¹çš„FINè¯·æ±‚ï¼Œæœ€åå°±è¿›å…¥TIME_WAITçŠ¶æ€ï¼Œè¿™ä¹ˆè¯´äº†ç†è§£å¾—æ›´é€å½»ï¼Œå‚ç…§ä¸‹å›¾ç†è§£</strong></p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821093427390.png" alt="image-20230821093427390" style="zoom:80%"><p><strong>å½“ TCP é“¾æ¥ä¸­ A å‘ B å‘é€ FIN è¯·æ±‚å…³é—­ï¼Œå¦ä¸€ç«¯ B å›åº” ACK ä¹‹åï¼ˆA ç«¯è¿›å…¥ FIN_WAIT_2 çŠ¶æ€ï¼‰ï¼Œå¹¶æ²¡æœ‰ç«‹å³å‘é€ FIN ç»™ Aï¼ŒA æ–¹å¤„äºåŠè¿æ¥çŠ¶æ€ï¼ˆåŠå¼€å…³ï¼‰ï¼Œæ­¤æ—¶ A å¯ä»¥æ¥æ”¶ B å‘ é€çš„æ•°æ®ï¼Œä½†æ˜¯ A å·²ç»ä¸èƒ½å†å‘ B å‘é€æ•°æ®ã€‚</strong></p><h4 id="shutdown"><a href="#shutdown" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#shutdown"></a> shutdown()</h4><p>ä»ç¨‹åºçš„è§’åº¦ï¼Œå¯ä»¥ä½¿ç”¨ API æ¥æ§åˆ¶å®ç°åŠè¿æ¥çŠ¶æ€ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">shutdown</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">int</span> how)</span></span>;</span><br><span class="line">    sockfd: éœ€è¦å…³é—­çš„socketçš„æè¿°ç¬¦</span><br><span class="line">    how: å…è®¸ä¸ºshutdownæ“ä½œé€‰æ‹©ä»¥ä¸‹å‡ ç§æ–¹å¼:</span><br><span class="line">        <span class="built_in">SHUT_RD</span>(<span class="number">0</span>): å…³é—­sockfdä¸Šçš„è¯»åŠŸèƒ½ï¼Œæ­¤é€‰é¡¹å°†ä¸å…è®¸sockfdè¿›è¡Œè¯»æ“ä½œã€‚</span><br><span class="line">                    è¯¥å¥—æ¥å­—ä¸å†æ¥æ”¶æ•°æ®ï¼Œä»»ä½•å½“å‰åœ¨å¥—æ¥å­—æ¥å—ç¼“å†²åŒºçš„æ•°æ®å°†è¢«æ— å£°çš„ä¸¢å¼ƒæ‰ã€‚</span><br><span class="line">        <span class="built_in">SHUT_WR</span>(<span class="number">1</span>): å…³é—­sockfdçš„å†™åŠŸèƒ½ï¼Œæ­¤é€‰é¡¹å°†ä¸å…è®¸sockfdè¿›è¡Œå†™æ“ä½œã€‚è¿›ç¨‹ä¸èƒ½åœ¨å¯¹æ­¤å¥—æ¥å­—å‘</span><br><span class="line">                    å‡ºå†™æ“ä½œã€‚</span><br><span class="line">        <span class="built_in">SHUT_RDWR</span>(<span class="number">2</span>):å…³é—­sockfdçš„è¯»å†™åŠŸèƒ½ã€‚ç›¸å½“äºè°ƒç”¨shutdownä¸¤æ¬¡ï¼šé¦–å…ˆæ˜¯ä»¥SHUT_RD,ç„¶åä»¥</span><br><span class="line">                    SHUT_WRã€‚</span><br></pre></td></tr></table></div></figure><p><strong>ä½¿ç”¨ close ä¸­æ­¢ä¸€ä¸ªè¿æ¥ï¼Œä½†å®ƒåªæ˜¯å‡å°‘æè¿°ç¬¦çš„å¼•ç”¨è®¡æ•°ï¼Œå¹¶ä¸ç›´æ¥å…³é—­è¿æ¥ï¼Œåªæœ‰å½“æè¿°ç¬¦çš„å¼•ç”¨è®¡æ•°ä¸º 0 æ—¶æ‰å…³é—­è¿æ¥ã€‚</strong></p><p><strong>shutdown ä¸è€ƒè™‘æè¿°ç¬¦çš„å¼•ç”¨è®¡æ•°ï¼Œç›´æ¥å…³é—­æè¿°ç¬¦ã€‚ä¹Ÿå¯é€‰æ‹©ä¸­æ­¢ä¸€ä¸ªæ–¹å‘çš„è¿æ¥ï¼Œåªä¸­æ­¢è¯»æˆ–åªä¸­æ­¢å†™ã€‚</strong></p><p>æ³¨æ„:</p><ol><li><p><strong>å¦‚æœæœ‰å¤šä¸ªè¿›ç¨‹å…±äº«ä¸€ä¸ªå¥—æ¥å­—ï¼Œclose æ¯è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œè®¡æ•°å‡ 1 ï¼Œç›´åˆ°è®¡æ•°ä¸º 0 æ—¶ï¼Œä¹Ÿå°±æ˜¯æ‰€ç”¨è¿›ç¨‹éƒ½è°ƒç”¨äº† closeï¼Œå¥—æ¥å­—å°†è¢«é‡Šæ”¾ã€‚å½“ç„¶é‡åˆ°çˆ¶å­è¿›ç¨‹çš„æ—¶å€™æ³¨æ„ä¸€ä¸‹ä»–ä»¬å†…æ ¸åŒºæ˜¯å…±äº«çš„è¿˜æ˜¯ç‹¬ç«‹çš„ï¼Œä¸‹é¢ä¼šè°ˆåˆ°</strong></p></li><li><p><strong>åœ¨å¤šè¿›ç¨‹ä¸­å¦‚æœä¸€ä¸ªè¿›ç¨‹è°ƒç”¨äº† shutdown(sfd, SHUT_RDWR) åï¼Œå…¶å®ƒçš„è¿›ç¨‹å°†æ— æ³•è¿›è¡Œé€šä¿¡ï¼Œå› ä¸ºç›´æ¥å…³é—­ï¼Œä¸çœ‹å¼•ç”¨è®¡æ•°ã€‚ ä½†å¦‚æœä¸€ä¸ªè¿›ç¨‹ close(sfd) å°†ä¸ä¼šå½±å“åˆ°å…¶å®ƒè¿›ç¨‹ã€‚</strong></p></li><li><p><strong>å¼•ç”³ï¼šä¸ºä»€ä¹ˆå¤šè¿›ç¨‹ä¸­çš„æ–‡ä»¶æè¿°ç¬¦çš„å¼•ç”¨è®¡æ•°ä¸ä¸º1å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹æˆ‘ä»¬ä»£ç çš„é€»è¾‘ï¼š</strong></p><p><strong>æˆ‘ä»¬ç”¨çˆ¶è¿›ç¨‹æ¥å—è¿æ¥ï¼Œç„¶åç”¨å­è¿›ç¨‹è¿›è¡Œå¤„ç†ï¼›æ–‡ä»¶æè¿°ç¬¦æ˜¯å†…æ ¸åŒºçš„ï¼Œå› æ­¤çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹å°±å…±äº«äº†è¿™ä¸€ä»½æ–‡ä»¶æè¿°ç¬¦æ•°æ®äº†ï¼Œçˆ¶è¿›ç¨‹å½“ç„¶å¯ä»¥é€šè¿‡è¿™ä¸ªé€šä¿¡ï¼Œä½†æ˜¯é€»è¾‘æ²¡æœ‰è¿™ä¹ˆå¹²</strong><br><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822153655659.png" alt="image-20230822153655659"></p></li></ol><h4 id="å…³äºæ–‡ä»¶æè¿°ç¬¦çš„å¼•ç”¨è®¡æ•°file_description"><a href="#å…³äºæ–‡ä»¶æè¿°ç¬¦çš„å¼•ç”¨è®¡æ•°file_description" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å…³äºæ–‡ä»¶æè¿°ç¬¦çš„å¼•ç”¨è®¡æ•°file_description"></a> å…³äºæ–‡ä»¶æè¿°ç¬¦çš„å¼•ç”¨è®¡æ•°(file_description)</h4><p>æˆ‘ä»¬å…ˆä»çˆ¶å­è¿›ç¨‹çœ‹èµ·ï¼Œå°±æ˜¯çˆ¶å­è¿›ç¨‹å¯¹äºæ–‡ä»¶æè¿°ç¬¦ï¼Œä¸‹é¢æœ‰ä¸¤æ®µä»£ç ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// code1</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXSIZE 1024</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> fd = <span class="built_in">open</span>(<span class="string">&quot;a.txt&quot;</span>, O_RDONLY);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> buf[MAXSIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">pid_t</span> pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == pid) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">read</span>(fd, buf, <span class="number">1</span>);  <span class="comment">// æˆ‘ç»™bufä¸­è¯»è¿›å»1ä¸ªå­—èŠ‚å†…å®¹</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;buf = %s\n&quot;</span>, buf);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">3</span>);          <span class="comment">// ä¿è¯å­è¿›ç¨‹å¯ä»¥å…ˆè¯»æ–‡ä»¶</span></span><br><span class="line">        <span class="built_in">read</span>(fd, buf, <span class="number">2</span>);  <span class="comment">// çˆ¶è¿›ç¨‹ä¸­è¯»å–2ä¸ªå­—èŠ‚</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;buf = %s\n&quot;</span>, buf);</span><br><span class="line">        <span class="built_in">wait</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">close</span>(fd);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œç»“æœï¼š</span></span><br><span class="line"><span class="comment">// buf = h</span></span><br><span class="line"><span class="comment">// buf = el</span></span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// code2</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXSIZE 1024</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">pid_t</span> pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == pid) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> fd = <span class="built_in">open</span>(<span class="string">&quot;a.txt&quot;</span>, O_RDONLY);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> buf[MAXSIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">read</span>(fd, buf, <span class="number">1</span>);  <span class="comment">// æˆ‘ç»™bufä¸­è¯»è¿›å»1ä¸ªå­—èŠ‚å†…å®¹</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;buf = %s\n&quot;</span>, buf);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">3</span>);          <span class="comment">// ä¿è¯å­è¿›ç¨‹å¯ä»¥å…ˆè¯»æ–‡ä»¶</span></span><br><span class="line">        <span class="built_in">read</span>(fd, buf, <span class="number">2</span>);  <span class="comment">// çˆ¶è¿›ç¨‹ä¸­è¯»å–2ä¸ªå­—èŠ‚</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;buf = %s\n&quot;</span>, buf);</span><br><span class="line">        <span class="built_in">wait</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">close</span>(fd);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œç»“æœï¼š</span></span><br><span class="line"><span class="comment">// buff = h</span></span><br><span class="line"><span class="comment">// buff = he</span></span><br></pre></td></tr></table></div></figure><p><strong>æˆ‘ä»¬ä»”ç»†è§‚å¯Ÿè¿™ä¸¤ä¸ªä»£ç ï¼Œå‘ç°ç¬¬ä¸€ä¸ªä»£ç å…ˆopen()æ–‡ä»¶åœ¨fork()å­è¿›ç¨‹ï¼›ç¬¬äºŒä¸ªä»£ç å…ˆfork()å­è¿›ç¨‹åœ¨open()æ–‡ä»¶ï¼Œç¬¬ä¸€ä¸ªä»£ç çš„æ‰§è¡Œç»“æœå‘ç°çˆ¶å­è¿›ç¨‹çš„æ–‡ä»¶æŒ‡é’ˆå¥½åƒæ˜¯å…¬ç”¨çš„ï¼Œç¬¬äºŒä¸ªåˆ™æ˜¯ç‹¬ç«‹çš„ï¼Œé‚£ä¹ˆè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</strong></p><p><strong>åœ¨Linuxç³»ç»Ÿä¸­çˆ¶å­è¿›ç¨‹åœ¨å®é™…æ“ä½œçš„æ—¶å€™å…·æœ‰&quot;è¯»æ—¶å…±äº«ï¼Œå†™æ—¶æ‹·è´&quot;çš„æ€§è´¨ï¼Œè¿™ä¸ªæ˜¯é’ˆå¯¹ç”¨æˆ·åŒºçš„ï¼Œæˆ‘ä»¬é€šè¿‡open()å‡½æ•°æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦fdæ˜¯å±äºå†…æ ¸åŒºçš„ï¼Œå¹¶ä¸”å†…æ ¸åŒºè¿˜ä¸“é—¨è®¾æœ‰ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦è¡¨ç”¨æ¥å­˜æ”¾æ–‡ä»¶æè¿°ç¬¦ï¼Œæ¯”å¦‚ STDIN_FILENO 0 ï¼Œ STDOUT_FILENO 1 ï¼Œ STDERR_FILENO 2 ï¼Œç”±äºå…ˆæ‰“å¼€open()å†åˆ›å»ºå­è¿›ç¨‹fork()ï¼Œé‚£ä¹ˆä»–ä»¬å†…æ ¸åŒºçš„æ•°æ®æ˜¯å…±äº«çš„ï¼Œå› æ­¤æ–‡ä»¶æè¿°ç¬¦ä¹Ÿæ˜¯ç”¨çš„åŒä¸€ä¸ªï¼Œæ–‡ä»¶æè¿°ç¬¦çš„å¼•ç”¨è®¡æ•°ä¸º1ï¼Œè™½ç„¶close()çš„æœºåˆ¶æ˜¯å¼•ç”¨è®¡æ•°ä¸º0æ‰çœŸæ­£å…³é—­ï¼Œä½†æ˜¯è¿™é‡Œä¸º1ï¼Œå› æ­¤å…³é—­ä»»æ„ä¸€ä¸ªéƒ½ç›¸å½“äºå…³é—­äº†è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå› æ­¤ä»–ä»¬è¯»å–çš„æ–‡ä»¶æŒ‡é’ˆä¹Ÿæ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥å¼€å§‹è¯»çš„ä½ç½®ä¸ç›¸åŒï¼›ä½†æ˜¯ç¬¬äºŒä¸ªå…ˆåˆ›å»ºå­è¿›ç¨‹fork()å†æ‰“å¼€open()ï¼Œæ˜¾ç„¶è¿™ä¸¤ä¸ªçš„æ–‡ä»¶æè¿°ç¬¦æ˜¯ä¸åŒçš„ï¼Œè¿™å°±è·ŸåŒ¿åç®¡é“pipeé€šä¿¡çˆ¶å­è¿›ç¨‹éœ€è¦å…ˆåˆ›å»ºåŒ¿åç®¡é“pipeå†åˆ›å»ºå­è¿›ç¨‹fork()ä¸€ä¸ªé“ç†</strong></p><p><strong>æ€»ç»“ï¼š</strong></p><ul><li><strong>forkå‰è¿›è¡Œopenï¼Œå­è¿›ç¨‹æ— æ¡ä»¶ç»§æ‰¿çˆ¶è¿›ç¨‹çš„æ–‡ä»¶æè¿°ä¿¡æ¯ï¼Œå­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹æŒ‡å‘ä¸€æ ·æ–‡ä»¶æè¿°ä¿¡æ¯</strong></li><li><strong>forkåè¿›è¡Œopenï¼Œå­è¿›ç¨‹å¯ä»¥æœ‰è‡ªå·±çš„é€‰æ‹©å•Šï¼Œä¸ç”¨ç»§æ‰¿çˆ¶è¿›ç¨‹çš„æ‰€æœ‰ï¼Œæ¯”å¦‚æ–‡ä»¶æè¿°ä¿¡æ¯</strong></li></ul><h2 id="ç«¯å£å¤ç”¨å…³äºsockopt"><a href="#ç«¯å£å¤ç”¨å…³äºsockopt" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç«¯å£å¤ç”¨å…³äºsockopt"></a> ç«¯å£å¤ç”¨(å…³äºsockopt())</h2><p><strong>ç«¯å£å¤ç”¨æœ€å¸¸ç”¨çš„ç”¨é€”æ˜¯:</strong></p><ul><li><strong>é˜²æ­¢æœåŠ¡å™¨é‡å¯æ—¶ä¹‹å‰ç»‘å®šçš„ç«¯å£è¿˜æœªé‡Šæ”¾</strong></li><li><strong>ç¨‹åºçªç„¶é€€å‡ºè€Œç³»ç»Ÿæ²¡æœ‰é‡Šæ”¾ç«¯å£</strong></li></ul><p><strong>è¿™ä¸¤ä¸ªçš„æœ¬è´¨éƒ½æ˜¯å› ä¸ºæŸäº›åŸå› ä¸»åŠ¨è¿æ¥æ–¹ç¨‹åºé€€å‡ºäº†ä½†æ˜¯TCPçš„ä¿¡æ¯è¿˜åœ¨TIME_WAITçŠ¶æ€ï¼Œå¯èƒ½è¿™ä¸ªæ—¶å€™è¢«åŠ¨è¿æ¥æ–¹æ²¡åŠæ³•æ”¶åˆ°LAST ACKï¼Œè¿™å°±ä¼šå¯¼è‡´ä¸€ç›´å¤„åœ¨TIME_WAITçŠ¶æ€ï¼Œç„¶åTIME_WAITçš„æ—¶é—´2mssä¸€èˆ¬æ˜¯60sï¼Œå¾ˆé•¿ï¼Œå¾ˆçƒ¦ï¼Œè¿™å°±å¯¼è‡´ç«¯å£ä¸€ç›´è¢«å ç”¨è€Œæ²¡åŠæ³•åŠæ—¶è¿›è¡Œåç»­æ“ä½œ</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="comment">// è®¾ç½®å¥—æ¥å­—çš„å±æ€§(ä¸ä»…ä»…èƒ½å¤Ÿè®¾ç½®ç«¯å£å¤ç”¨)</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">setsockopt</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">int</span> level, <span class="type">int</span> optname, <span class="type">const</span> <span class="type">void</span> *optval, <span class="type">socklen_t</span> optlen)</span></span>;</span><br><span class="line">å‚æ•°ï¼š</span><br><span class="line">    - sockfdï¼šè¦æ“ä½œçš„å¥—æ¥å­—çš„æ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">    - levelï¼šçº§åˆ« <span class="built_in">SOL_SOCKET</span> (ç«¯å£å¤ç”¨çš„çº§åˆ«)</span><br><span class="line">    - optnameï¼šé€‰é¡¹çš„åç§°</span><br><span class="line">    	- SO_REUSEADDR</span><br><span class="line">    	- SO_REUSEPORT</span><br><span class="line">    - optvalï¼šå±æ€§çš„å€¼ï¼Œå¯ä»¥æ˜¯<span class="type">int</span>ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ç±»å‹ï¼Œæ‰€ä»¥ç”¨<span class="type">void</span>*æ¥å—ï¼Œè¿™é‡Œæ˜¯æ•´å‹</span><br><span class="line">    	- <span class="number">1</span>ï¼šå¯ä»¥å¤ç”¨</span><br><span class="line">    	- <span class="number">0</span>ï¼šä¸å¯ä»¥å¤ç”¨</span><br><span class="line">    - optlenï¼šä¸Šä¸€ä¸ªå±æ€§çš„é•¿åº¦</span><br><span class="line">è¿”å›å€¼ï¼š</span><br><span class="line">    æˆåŠŸ <span class="number">0</span></span><br><span class="line">    å¤±è´¥ <span class="number">-1</span>ï¼Œè®¾ç½®errno</span><br><span class="line"> </span><br><span class="line">ç«¯å£å¤ç”¨ï¼Œè®¾ç½®çš„æ—¶æœºæ˜¯æœåŠ¡å™¨ç»‘å®šç«¯å£ä¹‹å‰ï¼Œå…ˆè®¾ç½®å† <span class="built_in">bind</span>() ï¼Œå¦åˆ™å°±å¤±æ•ˆäº†</span><br></pre></td></tr></table></div></figure><p>å…³äºlevelå‚æ•°ï¼Œæœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬è¿™é‡Œé€‰æ‹© SOL_SOCKETï¼Œä»£è¡¨æ˜¯ç«¯å£å¤ç”¨çš„çº§åˆ«</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230820172341423.png" alt="image-20230820172341423" style="zoom:80%"><p>æŸ¥çœ‹ç½‘ç»œä¿¡æ¯ç›¸å…³çš„å‘½ä»¤</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">netstat</span><br><span class="line">å‚æ•°ï¼š</span><br><span class="line">	-a æ˜¾ç¤ºæ‰€æœ‰çš„socket</span><br><span class="line">	-p æ˜¾ç¤ºæ­£åœ¨ä½¿ç”¨socketçš„ç¨‹åºçš„åç§°</span><br><span class="line">	-n ç›´æ¥ä½¿ç”¨IPåœ°å€ï¼Œä¸é€šè¿‡åŸŸåæœåŠ¡å™¨</span><br></pre></td></tr></table></div></figure><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤ <strong>netstat -anp</strong> æ¥æŸ¥çœ‹ç›¸å…³çš„ä¿¡æ¯</p><h3 id="ç¤ºä¾‹-5"><a href="#ç¤ºä¾‹-5" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¤ºä¾‹-5"></a> ç¤ºä¾‹</h3><p>æˆ‘ä»¬ç°åœ¨æ¥çœ‹ä¸€æ®µä»£ç ï¼Œæ˜¯å…³äºTCPé€šä¿¡çš„ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_IPV4_STRING 16</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXSIZE 1024</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºsocket</span></span><br><span class="line">    <span class="type">int</span> listen_fd = <span class="built_in">socket</span>(PF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (listen_fd == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;socket&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> server_addr;</span><br><span class="line">    server_addr.sin_family = AF_INET;</span><br><span class="line">    server_addr.sin_addr.s_addr = INADDR_ANY;</span><br><span class="line">    server_addr.sin_port = <span class="built_in">htons</span>(<span class="number">9999</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®ç«¯å£å¤ç”¨(åœ¨ç»‘å®šä¹‹å‰)</span></span><br><span class="line">    <span class="type">int</span> optval = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">setsockopt</span>(listen_fd, SOL_SOCKET, SO_REUSEPORT, &amp;optval, <span class="built_in">sizeof</span>(optval));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»‘å®š</span></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">bind</span>(listen_fd, (<span class="keyword">struct</span> sockaddr *)&amp;server_addr, <span class="built_in">sizeof</span>(server_addr));</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;bind&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›‘å¬</span></span><br><span class="line">    ret = <span class="built_in">listen</span>(listen_fd, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;listen&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> client_addr;</span><br><span class="line">    <span class="type">socklen_t</span> client_len = <span class="built_in">sizeof</span>(client_addr);</span><br><span class="line">    <span class="type">int</span> connect_fd = <span class="built_in">accept</span>(listen_fd, (<span class="keyword">struct</span> sockaddr *)&amp;client_addr, &amp;client_len);</span><br><span class="line">    <span class="keyword">if</span> (connect_fd == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;accpet&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å®¢æˆ·ç«¯ä¿¡æ¯</span></span><br><span class="line">    <span class="type">char</span> client_ip[MAX_IPV4_STRING] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">inet_ntop</span>(AF_INET, &amp;client_addr.sin_addr.s_addr, client_ip, <span class="built_in">sizeof</span>(client_ip));</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> client_port = <span class="built_in">ntohs</span>(client_addr.sin_port);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¾“å‡ºå®¢æˆ·ç«¯çš„ä¿¡æ¯</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;client&#x27;s ip is %s, and port is %d\n&quot;</span>, client_ip, client_port);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¥æ”¶å®¢æˆ·ç«¯å‘æ¥çš„æ•°æ®</span></span><br><span class="line">    <span class="type">char</span> buf[MAXSIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">int</span> len = <span class="built_in">recv</span>(connect_fd, buf, <span class="built_in">sizeof</span>(buf), <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (len == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;recv&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == len) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;å®¢æˆ·ç«¯å·²ç»æ–­å¼€è¿æ¥...\n&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;read buf = %s&quot;</span>, buf);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°å†™è½¬å¤§å†™</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">            buf[i] = <span class="built_in">toupper</span>(buf[i]);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;after buf = %s&quot;</span>, buf);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¤§å†™å­—ç¬¦ä¸²å‘ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">        ret = <span class="built_in">send</span>(connect_fd, buf, <span class="built_in">strlen</span>(buf) + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;send&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">close</span>(connect_fd);</span><br><span class="line">    <span class="built_in">close</span>(listen_fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// client.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXSIZE 1024</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºsocket</span></span><br><span class="line">    <span class="type">int</span> connect_fd = <span class="built_in">socket</span>(PF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (connect_fd == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;socket&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> server_addr;</span><br><span class="line">    <span class="built_in">inet_pton</span>(AF_INET, <span class="string">&quot;127.0.0.1&quot;</span>, &amp;server_addr.sin_addr.s_addr);</span><br><span class="line">    server_addr.sin_family = AF_INET;</span><br><span class="line">    server_addr.sin_port = <span class="built_in">htons</span>(<span class="number">9999</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿æ¥æœåŠ¡å™¨</span></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">connect</span>(connect_fd, (<span class="keyword">struct</span> sockaddr *)&amp;server_addr, <span class="built_in">sizeof</span>(server_addr));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;connect&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">char</span> buf[MAXSIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="built_in">fgets</span>(buf, <span class="built_in">sizeof</span>(buf), stdin);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">write</span>(connect_fd, buf, <span class="built_in">strlen</span>(buf) + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¥æ”¶</span></span><br><span class="line">        <span class="type">int</span> len = <span class="built_in">read</span>(connect_fd, buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">        <span class="keyword">if</span> (len == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;read&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;read buf = %s&quot;</span>, buf);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;æœåŠ¡å™¨å·²ç»æ–­å¼€è¿æ¥...\n&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">close</span>(connect_fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h4 id="ç†è§£"><a href="#ç†è§£" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç†è§£"></a> ç†è§£</h4><p>æˆ‘ä»¬å…ˆæŠŠTCPé€šä¿¡çš„å›¾æ‹¿è¿‡æ¥</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230819153502987.png" alt="image-20230819153502987" style="zoom:67%"><p>è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯æœåŠ¡ç«¯å‘é€å­—ç¬¦ä¸²ï¼ŒæœåŠ¡ç«¯æ¥å—å¹¶ä¸”è¿”å›å¤§å†™åçš„ç‰ˆæœ¬ï¼Œä»£ç é€»è¾‘æˆ‘ä»¬ä¸è°ˆï¼Œå‰é¢æ—©å°±è°ˆè¿‡äº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹é‡Šæ”¾è¿æ¥æ—¶å€™ä¼šå‘ç”Ÿäº›ä»€ä¹ˆäº‹æƒ…</p><p>server.cppä»£ç å½“ä¸­æœ‰ä¸€ä¸ªæ³¨é‡Šçš„éƒ¨åˆ†ï¼Œè¿™ä¸ªéƒ¨åˆ†æ˜¯ç”¨æ¥è®¾ç½®ç«¯å£å¤ç”¨çš„ï¼Œæˆ‘ä»¬ç°åœ¨å…ˆä¸ç®¡</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> optval = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">setsockopt</span>(listen_fd, SOL_SOCKET, SO_REUSEPORT, &amp;optval, <span class="built_in">sizeof</span>(optval));</span><br></pre></td></tr></table></div></figure><p>åœ¨ä»£ç ä¸­æˆ‘ä»¬æŒ‡å®šæœåŠ¡ç«¯çš„ç«¯å£ä¸º9999ï¼ŒIPä¸ºä»»æ„IP(åªè¦èƒ½è¿æ¥)ï¼Œç„¶åç”¨ç½‘ç»œå‘½ä»¤æ¥æŸ¥çœ‹ä¸€ä¸‹çŠ¶æ€</p><p>é€šè¿‡ç®¡é“å’Œgrepå‘½ä»¤é€šä¿¡æ¥è¿‡æ»¤å‰©ä¸‹9999çš„ä¿¡æ¯</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -anp | grep 9999</span><br></pre></td></tr></table></div></figure><p>æˆ‘ä»¬æ¥çœ‹ä¸‹æ­£å¸¸çŠ¶æ€æ—¶å€™çš„è¾“å‡ºï¼š</p><p>æœåŠ¡ç«¯æœ‰ä¸¤æ¡ä¿¡æ¯ï¼Œä¸€æ¡æ˜¯ç”¨æ¥ç›‘å¬çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰å…³é—­ç›‘å¬å¥—æ¥å­—ï¼Œç†è®ºä¸Šå®ƒè¿˜å¯ä»¥ç»§ç»­accept()å®¢æˆ·ç«¯ï¼Œåªæ˜¯æˆ‘ä»¬ä»£ç é€»è¾‘æ²¡æœ‰å®ç°è¿™ä¸ªï¼›å¦ä¸€æ¡å’Œå®¢æˆ·ç«¯æ˜¯å·²ç»å»ºç«‹è¿æ¥ï¼›å®¢æˆ·ç«¯å°±æ˜¯å’ŒæœåŠ¡ç«¯å»ºç«‹è¿æ¥</p><p>æœåŠ¡ç«¯ä½¿ç”¨çš„ç«¯å£æ˜¯9999</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230820174841668.png" alt="image-20230820174841668"></p><p>ç°åœ¨æˆ‘ä»¬ä½¿ç”¨ ctrl + c å‘é€SIGINTä¿¡å·æ˜¯æœåŠ¡ç«¯å¼‚å¸¸ç»ˆæ­¢ï¼Œè¾“å‡ºï¼š</p><p>æ­¤æ—¶ï¼ŒæœåŠ¡ç«¯åˆ°å®¢æˆ·ç«¯çš„å•å‘è¿æ¥å°±å…³é—­äº†ï¼Œä½†æ˜¯å®¢æˆ·ç«¯è¿˜åœ¨ï¼ŒæœåŠ¡ç«¯å¤„äºFIN_WAIT2çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯å‘é€FINçš„å…³é—­è¿æ¥æŠ¥æ–‡ï¼›å®¢æˆ·ç«¯å¤„äºCLOSE_WAITçŠ¶æ€</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230820175148993.png" alt="image-20230820175148993"></p><p>å¥½ï¼Œç°åœ¨æˆ‘ä»¬ä¹Ÿç±»ä¼¼å¼ºåˆ¶å…³é—­å®¢æˆ·ç«¯ï¼Œè¾“å‡ºï¼š</p><p>æ­¤æ—¶æœåŠ¡ç«¯è¿›å…¥TIME_WAITçŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€æœåŠ¡ç«¯æ¥æ”¶åˆ°äº†FINæŠ¥æ–‡ç„¶åå‘é€é’ˆå¯¹è¯¥æŠ¥æ–‡çš„ACKæŠ¥æ–‡ï¼Œä¸ºäº†é¿å…æœ€åä¸€æ¬¡æŠ¥æ–‡ä¸¢å¤±ï¼Œæ‰€ä»¥ä¼šæœ‰è¿™ä¸ªé˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µçš„æŒç»­æ—¶é—´æ˜¯2MSLï¼Œåœ¨Linuxä¸Šå¤§æ¦‚æ˜¯60ç§’</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230820175507945.png" alt="image-20230820175507945"></p><p>å¦‚æœæˆ‘ä»¬åœ¨è¿™æ®µæ—¶é—´é‡å¼€æœåŠ¡å™¨ï¼Œå°±ä¼šè¿™æ ·ï¼Œè¡¨ç¤ºç«¯å£è¢«å ç”¨ï¼Œè¿™å°±æ˜¯TIME_WAITæƒ¹çš„ç¥¸</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230820175849220.png" alt="image-20230820175849220"></p><p>å› æ­¤ï¼Œsetsockapt()å°±æ˜¯å¯ä»¥è®¾ç½®è¿™ä¸ªå±æ€§ï¼Œä½¿å¾—ç«¯å£èƒ½å¤Ÿå¤ç”¨ï¼Œå°†é‚£è¡Œä»£ç æ¢å¤åï¼Œå°±å¯ä»¥æ­£å¸¸æ‰“å¼€æœåŠ¡å™¨ï¼Œå¹¶ä¸”ç½‘ç»œçŠ¶æ€æ˜¯è¿™æ ·çš„</p><p>å¯ä»¥çœ‹å‡ºï¼Œä¹‹å‰çš„TIME_WAITå’Œç°åœ¨çš„LISTENçŠ¶æ€å…±å­˜äº†ï¼Œè¿™å°±æ˜¯setsockapt()çš„ä½œç”¨ï¼Œå½“ç„¶ä»–ä¸åªå¯ä»¥è®¾ç½®ç«¯å£å¤ç”¨ï¼Œè¿˜æœ‰å…¶ä»–åŠŸèƒ½</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230820180107223.png" alt="image-20230820180107223"></p><h4 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ€è€ƒ"></a> æ€è€ƒ</h4><p>æˆ‘ç°åœ¨ä¸è®©å®¢æˆ·ç«¯å¼‚å¸¸é€€å‡ºï¼Œå½“æœåŠ¡ç«¯å¼‚å¸¸é€€å‡ºåï¼Œæˆ‘ä»¬ä»£ç çš„é€»è¾‘å¯ä»¥è®©å®¢æˆ·ç«¯é˜»å¡åœ¨è¾“å…¥çš„ä½ç½®ï¼Œæ‰€ä»¥è¿™æ—¶æˆ‘ä»¬è¾“å…¥ä»£ç ç„¶åå°±å¯ä»¥æ­£å¸¸é€€å‡ºç¨‹åºï¼Œä½†æ˜¯æ­£å¸¸é€€å‡ºç¨‹åºä¹‹åæˆ‘ä»¬å‘ç°TIME_WAITçŠ¶æ€ä¸å­˜åœ¨ï¼Œä¹Ÿå°±æ˜¯ç»“æŸäº†ï¼Œæ¢å¥è¯è¯´å®¢æˆ·ç«¯æ­£å¸¸æ”¶åˆ°äº†æœ€åä¸€æ¬¡ACKï¼Œè€Œæˆ‘ä»¬åˆšæ‰å¼‚å¸¸é€€å‡ºçš„æ—¶å€™å®¢æˆ·ç«¯æ²¡åŠæ³•æ”¶åˆ°æœ€åä¸€æ¬¡ACKï¼Œæ‰€ä»¥ç«¯å£è¢«å ç”¨ï¼Œéœ€è¦ç«¯å£å¤ç”¨ï¼Œè¿™ç‚¹è¦æ³¨æ„</p><p>ä½†æ˜¯å†æƒ³æƒ³ï¼ŒæœåŠ¡ç«¯ä¹Ÿæ˜¯å¼‚å¸¸é€€å‡ºçš„ï¼Œä»–æ€ä¹ˆæ”¶åˆ°äº†ç¬¬äºŒæ¬¡ACKå‘¢ï¼Ÿè¿™ä¸ªé—®é¢˜æˆ‘ä¸çŸ¥é“å‡†ç¡®çš„ç­”æ¡ˆï¼Œä½†æ˜¯æˆ‘æ¨æµ‹è™½ç„¶æœåŠ¡ç«¯ç»“æŸäº†ï¼Œä½†æ˜¯æœåŠ¡ç«¯çš„TCPä¿¡æ¯å°šæœªç»“æŸï¼Œå› ä¸ºæœåŠ¡ç«¯è¿˜è¦æ”¶åˆ°å®¢æˆ·ç«¯çš„ä¸»åŠ¨æ–­å¼€è¯·æ±‚ï¼Œè¿™é‡Œæ˜¯æœåŠ¡ç«¯å…ˆæ–­å¼€ï¼Œä½†æ˜¯è¢«æ–­å¼€æ–¹å®¢æˆ·ç«¯å¼‚å¸¸é€€å‡ºæ—¶å°±æ”¶ä¸åˆ°æœ€åä¸€æ¬¡ACKï¼Œæ‰€ä»¥ä¼šå¡åœ¨TIME_WAITçŠ¶æ€(ä¸æ˜¯å¾ˆç†è§£)</p><p><strong>é—®é¢˜çš„å…³é”®ç‚¹å°±åœ¨äºè¢«æ–­å¼€æ–¹æœ€åä¸€æ¬¡ACKåˆ°åº•èƒ½å¦å‡†ç¡®æ”¶åˆ°ï¼Œæˆ‘ä¸çŸ¥é“æ€ä¹ˆè§£é‡Šï¼Œä½†æ˜¯TIME_WAITä¼šå‘Šè¯‰æˆ‘ç­”æ¡ˆï¼Œè¿™å°±æ˜¯å†…æ ¸ç›¸å…³çš„ä¸œè¥¿äº†ï¼Œæˆ‘ç›®å‰çš„æ°´å¹³è¾¾ä¸åˆ°</strong></p><p>ä¸æ˜ç™½å…¶å®æ²¡å…³ç³»ï¼Œåªéœ€è¦çŸ¥é“TIME_WAITçŠ¶æ€ä¼šå¯¼è‡´ç«¯å£å ç”¨å°±å¯ä»¥äº†ï¼Œæˆ‘ä»¬è‡ªå·±å¯ä»¥ç”¨ç½‘ç»œå‘½ä»¤æŸ¥çœ‹ï¼Œç„¶åå†³å®šæ˜¯å¦éœ€è¦ç«¯å£å¤ç”¨</p><h2 id="ioå¤šè·¯å¤ç”¨ioå¤šè·¯è½¬æ¥"><a href="#ioå¤šè·¯å¤ç”¨ioå¤šè·¯è½¬æ¥" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ioå¤šè·¯å¤ç”¨ioå¤šè·¯è½¬æ¥"></a> I/Oå¤šè·¯å¤ç”¨(I/Oå¤šè·¯è½¬æ¥)</h2><h3 id="ioå«ä¹‰"><a href="#ioå«ä¹‰" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ioå«ä¹‰"></a> I/Oå«ä¹‰</h3><p><strong>I/Oå°±æ˜¯è‹±æ–‡å•è¯in outï¼Œä½†æ˜¯ä¸æ˜¯æŒ‡ä»é”®ç›˜è¯»å…¥æ•°æ®å«inæˆ–è€…è¾“å‡ºåˆ°ä¸­æ–­å±å¹•åˆ°outï¼Œå®ƒæŒ‡çš„æ˜¯æˆ‘ä»¬æ“ä½œæ–‡ä»¶æˆ–è€…ç®¡é“æˆ–è€…å¥—æ¥å­—ï¼Œä¾èµ–æ–‡ä»¶æè¿°ç¬¦ï¼Œå°†æ•°æ®å’Œå†…å­˜(æ¯”å¦‚ç¼“å†²åŒº)è¿›è¡Œé€šä¿¡ï¼Œå†™å…¥å†…å­˜å«inï¼Œä»å†…å­˜ä¸­è¯»å–å«outï¼›æ¯”å¦‚æˆ‘ä»¬çš„TCPé€šä¿¡çš„ä¾‹å­ï¼Œè¿æ¥å¥—æ¥å­—çš„å½¢å¼å°±æ˜¯æ–‡ä»¶æè¿°ç¬¦fdï¼Œç„¶åé€šè¿‡ä»–çš„è¯»å†™æ˜¯å…ˆå­˜åˆ°å†…å­˜ç¼“å†²åŒºçš„ï¼Œè¿™å°±æœ‰å¾ˆå¤šçš„I/Oè¿‡ç¨‹äº†</strong></p><p><strong>I/O å¤šè·¯å¤ç”¨ä½¿å¾—ç¨‹åºèƒ½åŒæ—¶ç›‘å¬å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œèƒ½å¤Ÿæé«˜ç¨‹åºçš„æ€§èƒ½ã€‚Linux ä¸‹å®ç° I/O å¤šè·¯å¤ç”¨çš„ç³»ç»Ÿè°ƒç”¨ä¸»è¦æœ‰ selectã€poll å’Œ epollã€‚</strong></p><h3 id="å‡ ç§å¸¸è§çš„ioæ¨¡å‹"><a href="#å‡ ç§å¸¸è§çš„ioæ¨¡å‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å‡ ç§å¸¸è§çš„ioæ¨¡å‹"></a> å‡ ç§å¸¸è§çš„I/Oæ¨¡å‹</h3><h4 id="é˜»å¡ç­‰å¾…"><a href="#é˜»å¡ç­‰å¾…" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#é˜»å¡ç­‰å¾…"></a> é˜»å¡ç­‰å¾…</h4><p>æ¯”å¦‚accept()å’Œwait()å°±æ˜¯é˜»å¡ç­‰å¾…çš„ä¾‹å­ï¼Œé˜»å¡ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥å’Œå­è¿›ç¨‹çš„ç»“æŸï¼Œä¼˜ç‚¹å°±æ˜¯é˜»å¡åœ¨é‚£é‡Œä¸åƒCPUçš„æ—¶é—´ç‰‡ï¼Œç¼ºç‚¹å°±æ˜¯åŒä¸€æ—¶åˆ»åªèƒ½å¤„ç†ä¸€ä¸ªæ“ä½œï¼Œæ•ˆç‡å¾ˆä½ï¼›æ‰€ä»¥æƒ³åˆ°ç”¨å¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹è§£å†³ï¼Œä½†æ˜¯ç¼ºç‚¹å°±æ˜¯æ¶ˆè€—èµ„æº</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821101046107.png" alt="image-20230821101046107"></p><h5 id="bioæ¨¡å‹"><a href="#bioæ¨¡å‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#bioæ¨¡å‹"></a> BIOæ¨¡å‹</h5><p>è¿™å°±æ˜¯é˜»å¡ç­‰å¾…çš„ä¾‹å­ï¼Œå°±æ˜¯å› ä¸ºread()æˆ–è€…recv()æ˜¯é˜»å¡çš„ï¼Œå½“æˆ‘ä¸»ç¨‹åºæ¥å—å®¢æˆ·ç«¯è¿æ¥ä¹‹åé˜»å¡ç­‰å¾…å®¢æˆ·ç«¯çš„æ•°æ®åˆ°è¾¾ï¼Œè¿™æ®µæ—¶é—´å†…ä¸»ç¨‹åºæ²¡æœ‰åŠæ³•æ¥å—å…¶ä»–å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©å¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹æ¥è§£å†³é—®é¢˜ï¼Œç¼ºç‚¹ä¹Ÿæ˜¾è€Œæ˜“è§å°±æ˜¯æ¶ˆè€—èµ„æºï¼Œä½†æ˜¯ç©¶å…¶æ ¹æœ¬åŸå› å°±æ˜¯é˜»å¡blockingçš„é—®é¢˜</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821101622911.png" alt="image-20230821101622911"></p><h4 id="éé˜»å¡å¿™è½®è¯¢"><a href="#éé˜»å¡å¿™è½®è¯¢" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#éé˜»å¡å¿™è½®è¯¢"></a> éé˜»å¡ï¼Œå¿™è½®è¯¢</h4><p>å› æ­¤æˆ‘ä»¬å¯ä»¥é€‰æ‹©å°±ä¸é˜»å¡äº†ï¼Œå¿™ç€è½®è¯¢æ¥è¯¢é—®ä»»åŠ¡çš„æƒ…å†µï¼Œä¼˜ç‚¹å°±æ˜¯æé«˜äº†ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ï¼Œä½†æ˜¯ç¼ºç‚¹å°±æ˜¯éœ€è¦åƒæ›´å¤šçš„CPUå’Œç³»ç»Ÿèµ„æº</p><p>è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨I/Oå¤šè·¯è½¬æ¥æŠ€æœ¯select/poll/epoll</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821102216612.png" alt="image-20230821102216612"></p><h5 id="nioæ¨¡å‹"><a href="#nioæ¨¡å‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#nioæ¨¡å‹"></a> NIOæ¨¡å‹</h5><p>è¿™é‡ŒæŠŠaccept()å’Œread()éƒ½è®¾ç½®æˆä¸ºéé˜»å¡çš„ï¼Œæ„å‘³ç€æˆ‘ç¨‹åºæ‰§è¡Œåˆ°è¿™é‡Œçš„æ—¶å€™æˆ‘ä¸é˜»å¡äº†ï¼Œä½†æ˜¯éœ€è¦åˆ¤æ–­æ˜¯å¦æœ‰å®¢æˆ·ç«¯è¿æ¥æˆ–è€…æœ‰æ•°æ®åˆ°è¾¾ï¼Œå¦‚æœæ²¡æœ‰å°±ç»§ç»­å¾ªç¯ç›´åˆ°æœ‰ï¼Œæœ‰å°±è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œä½†æ˜¯è¿™æ ·æ¶ˆè€—çš„CPUå’Œèµ„æºä»£ä»·éå¸¸å¤§</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821102411708.png" alt="image-20230821102411708"></p><h3 id="ioå¤šè·¯è½¬æ¥æŠ€æœ¯"><a href="#ioå¤šè·¯è½¬æ¥æŠ€æœ¯" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ioå¤šè·¯è½¬æ¥æŠ€æœ¯"></a> I/Oå¤šè·¯è½¬æ¥æŠ€æœ¯</h3><p><strong>åœ¨NIOæ¨¡å‹ä¸‹ï¼Œå‡è®¾æˆ‘ä»¬çš„ç”¨æˆ·éå¸¸å¤šï¼Œå› æ­¤æ¯æ¬¡æ‰§è¡Œåˆ°éé˜»å¡çš„ä½ç½®ï¼Œæ¯”å¦‚read()æˆ‘ä»¬éƒ½éœ€è¦åˆ¤æ–­æ‰€æœ‰çš„å®¢æˆ·æ˜¯å¦æœ‰æ•°æ®åˆ°è¾¾ï¼Œæˆ‘ä»¬çš„æœ¬æ„æ˜¯é€šè¿‡éé˜»å¡æ¥æé«˜ç¨‹åºçš„æ•ˆç‡ï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨æ¯æ¬¡åˆ°è¿™é‡Œéƒ½è¦è‡ªå·±è¯¢é—®æ‰€æœ‰çš„å®¢æˆ·æ•°æ®æ˜¯å¦åˆ°è¾¾ï¼Œè¿™ä¸å°±æ¶ˆè€—äº†CPUå’Œèµ„æºå˜›ï¼Œè¿èƒŒäº†æˆ‘ä»¬çš„åˆè¡·ï¼ŒI/Oå¤šè·¯è½¬æ¥æŠ€æœ¯å°±æ˜¯ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä»–çš„ç›®çš„æ˜¯å§”æ‰˜å†…æ ¸å¸®æˆ‘ä»¬è¯¢é—®æŸ¥çœ‹æœ‰å¤šå°‘å®¢æˆ·çš„æ•°æ®åˆ°è¾¾äº†ï¼Œç„¶åå‘Šè¯‰æˆ‘ä»¬ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦è°ƒç”¨ä¸€æ¬¡å°±å¯ä»¥çŸ¥é“å“ªäº›å®¢æˆ·æ•°æ®åˆ°è¾¾äº†ï¼Œå¤§å¤§æé«˜äº†æ•ˆç‡</strong></p><h4 id="ç®€å•ç†è§£"><a href="#ç®€å•ç†è§£" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç®€å•ç†è§£"></a> ç®€å•ç†è§£</h4><p>ç¬¬ä¸€ç§ select/poll</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821102813978.png" alt="image-20230821102813978"></p><p>ç¬¬äºŒç§ epoll</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821102923936.png" alt="image-20230821102923936"></p><h4 id="select"><a href="#select" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#select"></a> select</h4><p>ä¸»æ—¨æ€æƒ³ï¼š</p><ol><li><strong>é¦–å…ˆè¦æ„é€ ä¸€ä¸ªå…³äºæ–‡ä»¶æè¿°ç¬¦çš„åˆ—è¡¨ï¼Œå°†è¦ç›‘å¬çš„æ–‡ä»¶æè¿°ç¬¦æ·»åŠ åˆ°è¯¥åˆ—è¡¨ä¸­ã€‚</strong></li><li>**è°ƒç”¨ä¸€ä¸ªç³»ç»Ÿå‡½æ•°ï¼Œç›‘å¬è¯¥åˆ—è¡¨ä¸­çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç›´åˆ°è¿™äº›æè¿°ç¬¦ä¸­çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªè¿›è¡Œ I/O æ“ä½œæ—¶ï¼Œè¯¥å‡½æ•°æ‰è¿”å›ã€‚ **<br>**a.è¿™ä¸ªå‡½æ•°æ˜¯é˜»å¡çš„ **<br><strong>b.å‡½æ•°å¯¹æ–‡ä»¶æè¿°ç¬¦çš„æ£€æµ‹çš„æ“ä½œæ˜¯ç”±å†…æ ¸å®Œæˆçš„</strong></li><li><strong>åœ¨è¿”å›æ—¶ï¼Œå®ƒä¼šå‘Šè¯‰è¿›ç¨‹æœ‰å¤šå°‘ï¼ˆå“ªäº›ï¼‰æè¿°ç¬¦è¦è¿›è¡ŒI/Oæ“ä½œã€‚</strong></li></ol><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sizeof(fd_set) = 128(ä¸ªå­—èŠ‚) 1024(ä¸ªbitä½)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/select.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">select</span><span class="params">(<span class="type">int</span> nfds, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, <span class="keyword">struct</span> timeval *timeout)</span></span>;</span><br><span class="line">    - å‚æ•°ï¼š</span><br><span class="line">    	- nfds : å§”æ‰˜å†…æ ¸æ£€æµ‹çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦çš„å€¼ + <span class="number">1</span>ï¼Œä¼ è¿™ä¸ªå‚æ•°æ˜¯æ˜¯ä¸ºäº†æé«˜æ•ˆç‡ï¼Œæ²¡å¿…è¦éå†æœ€å¤§æ–‡ä»¶æè¿°ç¬¦ä¹‹åçš„ï¼Œ<span class="number">+1</span>æ˜¯åº•å±‚å®ç°çš„é€»è¾‘è§„å®šçš„è¦<span class="number">+1</span>ï¼Œæˆ‘çŒœæµ‹å¯èƒ½ç±»ä¼¼äº <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span> ; i &lt; nfds + <span class="number">1</span> ;++i)ï¼Œè¿™æ ·åˆšå¥½æœ€åä¸€ä¸ªèƒ½è¢«éå†åˆ°</span><br><span class="line">    	- readfds : è¦æ£€æµ‹çš„æ–‡ä»¶æè¿°ç¬¦çš„è¯»çš„é›†åˆï¼Œå§”æ‰˜å†…æ ¸æ£€æµ‹å“ªäº›æ–‡ä»¶æè¿°ç¬¦çš„è¯»çš„å±æ€§</span><br><span class="line">    			 - ä¸€èˆ¬æ£€æµ‹è¯»æ“ä½œ</span><br><span class="line">    			 - å¯¹åº”çš„æ˜¯å¯¹æ–¹å‘é€è¿‡æ¥çš„æ•°æ®ï¼Œå› ä¸ºè¯»æ˜¯è¢«åŠ¨çš„æ¥æ”¶æ•°æ®ï¼Œæ£€æµ‹çš„å°±æ˜¯è¯»ç¼“å†²åŒºæ˜¯å¦æœ‰æ•°æ®ï¼Œæœ‰çš„è¯å°±å¯ä»¥è¿›è¡Œè¯»å–</span><br><span class="line">    			 - æ˜¯ä¸€ä¸ªä¼ å…¥ä¼ å‡ºå‚æ•°</span><br><span class="line">    	- writefds : è¦æ£€æµ‹çš„æ–‡ä»¶æè¿°ç¬¦çš„å†™çš„é›†åˆï¼Œå§”æ‰˜å†…æ ¸æ£€æµ‹å“ªäº›æ–‡ä»¶æè¿°ç¬¦çš„å†™çš„å±æ€§</span><br><span class="line">            	  - ä¸€èˆ¬ä¸æ£€æµ‹å†™æ“ä½œ </span><br><span class="line">    			 - å§”æ‰˜å†…æ ¸æ£€æµ‹å†™ç¼“å†²åŒºæ˜¯ä¸æ˜¯è¿˜å¯ä»¥å†™æ•°æ®ï¼Œæ²¡æœ‰æ»¡å°±å¯ä»¥ç»§ç»­å‘å…¶ä¸­å†™å…¥æ•°æ®</span><br><span class="line">    	- exceptfds : æ£€æµ‹å‘ç”Ÿå¼‚å¸¸çš„æ–‡ä»¶æè¿°ç¬¦çš„é›†åˆ</span><br><span class="line">    	- timeout : è®¾ç½®çš„è¶…æ—¶æ—¶é—´</span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">timeval</span> &#123;</span><br><span class="line">            <span class="type">long</span> tv_sec; <span class="comment">/* seconds */</span></span><br><span class="line">            <span class="type">long</span> tv_usec; <span class="comment">/* microseconds */</span></span><br><span class="line">        &#125;;</span><br><span class="line">            - <span class="literal">NULL</span> : æ°¸ä¹…é˜»å¡ï¼Œç›´åˆ°æ£€æµ‹åˆ°äº†æ–‡ä»¶æè¿°ç¬¦æœ‰å˜åŒ–ï¼Œæ‰ä¼šå¾€ä¸‹æ‰§è¡Œå¹¶ä¸”è¿”å›</span><br><span class="line">            - tv_sec = <span class="number">0</span> tv_usec = <span class="number">0</span>ï¼Œ ä¸é˜»å¡</span><br><span class="line">            - tv_sec &gt; <span class="number">0</span> tv_usec &gt; <span class="number">0</span>ï¼Œ é˜»å¡å¯¹åº”çš„æ—¶é—´</span><br><span class="line">            - è¿”å›å€¼ :</span><br><span class="line">                  <span class="number">-1</span> : å¤±è´¥</span><br><span class="line">                  &gt;<span class="number">0</span>(n) : æ£€æµ‹çš„é›†åˆä¸­æœ‰nä¸ªæ–‡ä»¶æè¿°ç¬¦å‘ç”Ÿäº†å˜åŒ–</span><br><span class="line"><span class="comment">// å°†å‚æ•°æ–‡ä»¶æè¿°ç¬¦fdå¯¹åº”çš„æ ‡å¿—ä½è®¾ç½®ä¸º0</span></span><br><span class="line"><span class="type">void</span> <span class="built_in">FD_CLR</span>(<span class="type">int</span> fd, fd_set *set);</span><br><span class="line"><span class="comment">// åˆ¤æ–­fdå¯¹åº”çš„æ ‡å¿—ä½æ˜¯0è¿˜æ˜¯1ï¼Œ è¿”å›å€¼ ï¼š fdå¯¹åº”çš„æ ‡å¿—ä½çš„å€¼ï¼Œ0ï¼Œè¿”å›0ï¼Œ 1ï¼Œè¿”å›1</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">FD_ISSET</span><span class="params">(<span class="type">int</span> fd, fd_set *set)</span></span>;</span><br><span class="line"><span class="comment">// å°†å‚æ•°æ–‡ä»¶æè¿°ç¬¦fd å¯¹åº”çš„æ ‡å¿—ä½ï¼Œè®¾ç½®ä¸º1</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FD_SET</span><span class="params">(<span class="type">int</span> fd, fd_set *set)</span></span>;</span><br><span class="line"><span class="comment">// fd_setä¸€å…±æœ‰1024 bit, å…¨éƒ¨åˆå§‹åŒ–ä¸º0</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FD_ZERO</span><span class="params">(fd_set *set)</span></span>;</span><br></pre></td></tr></table></div></figure><p><strong>åœ¨æˆ‘ä»¬çš„ä¾‹å­å½“ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ£€æµ‹çš„æ˜¯æ–‡ä»¶æè¿°ç¬¦ä¸­è¯»çš„å±æ€§ï¼Œå› æ­¤æˆ‘ä»¬å°±å°† fd_set ç±»å‹ä¸­å¯¹åº”è¦æ£€æµ‹çš„æ–‡ä»¶æè¿°ç¬¦çš„å¯¹åº”çš„æ ‡å¿—ä½è®¾ä¸º1è¡¨ç¤ºæˆ‘è¦æ£€æµ‹ï¼Œç„¶åä¼ ç»™select()å‡½æ•°éå†ï¼Œå¦‚æœæ–‡ä»¶æè¿°ç¬¦ä¸º0åˆ™è¡¨ç¤ºä¸ç”¨æ£€æµ‹è·³è¿‡ï¼Œä¸º1åˆ™å§”æ‰˜å†…æ ¸å»å¸®æˆ‘ä»¬è¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœç¡®å®æœ‰æ•°æ®æ¥äº†å°±å°†è¯¥æ ‡å¿—ä½ä»ä¿æŒä¸º1ï¼Œæ²¡æœ‰åˆ™ä¿®æ”¹ä¸º0ï¼Œæœ€åæŠŠä¿®æ”¹ä¹‹åçš„ readfds è¿”å›ï¼Œå°±å¾—åˆ°äº†æœ‰æ•°æ®çš„é›†åˆï¼Œä½†æ˜¯select()çš„è¿”å›å€¼ä¸ä¼šå‘Šè¯‰æˆ‘ä»¬å“ªäº›å€¼å‘ç”Ÿäº†å˜åŒ–ï¼Œåªä¼šå‘Šè¯‰æˆ‘ä»¬æœ‰å‡ ä¸ªï¼Œnä¸ªè¿”å›nï¼Œè‡³äºæ˜¯é‚£äº›éœ€è¦æˆ‘ä»¬è‡ªå·±éå†</strong></p><h5 id="å·¥ä½œè¿‡ç¨‹åˆ†æ"><a href="#å·¥ä½œè¿‡ç¨‹åˆ†æ" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å·¥ä½œè¿‡ç¨‹åˆ†æ"></a> å·¥ä½œè¿‡ç¨‹åˆ†æ</h5><p><strong>åœ¨å‡½æ•°æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿå…ˆæŠŠç”¨æˆ·åŒºçš„è¿™ä»½æ–‡ä»¶æè¿°ç¬¦é›†åˆæ‹·è´ä¸€ä»½åˆ°å†…æ ¸å½“ä¸­ï¼Œç„¶ååœ¨å†…æ ¸å½“ä¸­æ£€æµ‹æ ‡å¿—ä½å¹¶ä¸”æ ¹æ®å®é™…æƒ…å†µ(æ¯”å¦‚è¿™é‡Œå°±æ˜¯å“ªäº›æ–‡ä»¶æè¿°ç¬¦çš„è¯»ç«¯æ•°æ®åˆ°è¾¾äº†)ç„¶åä¿®æ”¹æ ‡å¿—ä½ï¼Œ0å°±æ˜¯æ²¡æœ‰ï¼Œ1å°±æ˜¯æœ‰ï¼Œç„¶åä»å†…æ ¸æ€é‡æ–°æ‹·è´åˆ°ç”¨æˆ·æ€ï¼Œå·¥ä½œè¿‡ç¨‹å¤§è‡´å°±æ˜¯è¿™æ ·</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821132937309.png" alt="image-20230821132937309"></p><h5 id="ä»£ç "><a href="#ä»£ç " class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä»£ç "></a> ä»£ç </h5><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Client_Info.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _CLIENT_INFO_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _CLIENT_INFO_</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_IPV4_STRING 16</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Client_Info</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Client_Info</span>() &#123;</span><br><span class="line">        __init__();</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    Client_Info&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Client_Info&amp; _cli_info) &#123;</span><br><span class="line">        <span class="built_in">strcpy</span>(<span class="keyword">this</span>-&gt;client_ip, _cli_info.client_ip);</span><br><span class="line">        <span class="keyword">this</span>-&gt;client_port = _cli_info.client_port;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Client_Info</span>(<span class="type">const</span> <span class="type">char</span>* _ip, <span class="type">const</span> <span class="type">in_port_t</span>&amp; _port) &#123;</span><br><span class="line">        <span class="built_in">strcpy</span>(<span class="keyword">this</span>-&gt;client_ip, _ip);</span><br><span class="line">        <span class="keyword">this</span>-&gt;client_port = _port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Client_Info</span>(<span class="type">const</span> Client_Info&amp; _cli_info) &#123;</span><br><span class="line">        *<span class="keyword">this</span> = _cli_info;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">void</span> __init__() &#123;</span><br><span class="line">        <span class="built_in">bzero</span>(<span class="keyword">this</span>-&gt;client_ip, <span class="built_in">sizeof</span>(<span class="keyword">this</span>-&gt;client_ip));</span><br><span class="line">        <span class="keyword">this</span>-&gt;client_port = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">char</span> client_ip[MAX_IPV4_STRING];</span><br><span class="line">    <span class="type">in_port_t</span> client_port;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></div></figure><p>ä»¥ä¸‹æ˜¯æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Client_Info.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXSIZE 1024</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_CLIENT_SIZE 1024</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¨å±€å­˜æ”¾å®¢æˆ·ç«¯è¿æ¥çš„IPå’Œç«¯å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Client_Info</span> cli_infos[MAX_CLIENT_SIZE];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¨å±€å­˜æ”¾éœ€è¦æ£€æµ‹çš„æ–‡ä»¶æè¿°ç¬¦çš„æ•°ç»„</span></span><br><span class="line">fd_set read_set;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bigger</span><span class="params">(<span class="type">const</span> <span class="type">int</span>&amp; val1, <span class="type">const</span> <span class="type">int</span>&amp; val2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> val1 &gt; val2 ? val1 : val2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Communicate</span><span class="params">(<span class="type">const</span> <span class="type">int</span>&amp; _connect_fd)</span> </span>&#123;</span><br><span class="line">    <span class="type">char</span>* _client_ip = cli_infos[_connect_fd].client_ip;</span><br><span class="line">    <span class="type">in_port_t</span>&amp; _client_port = cli_infos[_connect_fd].client_port;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> buf[MAXSIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="comment">// è¯»</span></span><br><span class="line">    <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">    <span class="type">int</span> len = <span class="built_in">read</span>(_connect_fd, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == len) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;read&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;recv client (ip : %s , port : %d) : %s&quot;</span>, _client_ip, _client_port, buf);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == len) &#123;  <span class="comment">// å®¢æˆ·ç«¯å…³é—­</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;client ip : %s , port : %d has closed...\n&quot;</span>, _client_ip, _client_port);</span><br><span class="line">        <span class="comment">// è¿™é‡Œå…³é—­ä¹‹åéœ€è¦ç§»é™¤æ–‡ä»¶æè¿°ç¬¦é›†åˆä¸­çš„æ ‡å¿—ä½è¡¨ç¤ºæˆ‘ä¸éœ€è¦ç›‘å¬è¿™ä¸ªäº†</span></span><br><span class="line">        <span class="built_in">FD_CLR</span>(_connect_fd, &amp;read_set);</span><br><span class="line">        <span class="comment">// å…³é—­æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">        <span class="built_in">close</span>(_connect_fd);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å†™</span></span><br><span class="line">    <span class="built_in">write</span>(_connect_fd, buf, <span class="built_in">strlen</span>(buf));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºsocket</span></span><br><span class="line">    <span class="type">int</span> listen_fd = <span class="built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == listen_fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;socket&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®ä¸€ä¸‹ç«¯å£å¤ç”¨</span></span><br><span class="line">    <span class="type">int</span> _optval = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">setsockopt</span>(listen_fd, SOL_SOCKET, SO_REUSEPORT, &amp;_optval, <span class="built_in">sizeof</span>(_optval));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.ç»‘å®šIPå’Œç«¯å£</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> server_addr;</span><br><span class="line">    <span class="comment">// åœ°å€æ—</span></span><br><span class="line">    server_addr.sin_family = AF_INET;</span><br><span class="line">    <span class="comment">// IP</span></span><br><span class="line">    server_addr.sin_addr.s_addr = INADDR_ANY;</span><br><span class="line">    <span class="comment">// ç«¯å£</span></span><br><span class="line">    server_addr.sin_port = <span class="built_in">htons</span>(<span class="number">9999</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">bind</span>(listen_fd, (<span class="keyword">struct</span> sockaddr*)&amp;server_addr, <span class="built_in">sizeof</span>(server_addr));</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;bind&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;server has initialized.\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.å¼€å§‹ç›‘å¬</span></span><br><span class="line">    ret = <span class="built_in">listen</span>(listen_fd, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;listen&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨NIOæ¨¡å‹ï¼Œåˆ›å»ºfd_seté›†åˆï¼Œå­˜æ”¾çš„æ˜¯éœ€è¦æ£€æµ‹çš„æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">    <span class="comment">// å…¨å±€å®šä¹‰ read_set</span></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">    <span class="built_in">FD_ZERO</span>(&amp;read_set);</span><br><span class="line">    <span class="comment">// æ·»åŠ éœ€è¦æ£€æµ‹çš„æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">    <span class="built_in">FD_SET</span>(listen_fd, &amp;read_set);</span><br><span class="line">	<span class="comment">// å®šä¹‰æœ€å¤§çš„æ–‡ä»¶æè¿°ç¬¦åºå·(å‚æ•°é‡Œé¢è¦åŠ 1)</span></span><br><span class="line">    <span class="type">int</span> max_fd = listen_fd;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™ä¸ªåœ°æ–¹æˆ‘ä¸èƒ½æŠŠread_seté›†åˆæ‹¿è¿›å»è®©å†…æ ¸è¿›è¡Œæ‹·è´ä¿®æ”¹ç„¶åè¦†ç›–æˆ‘çš„è¿™ä¸ª</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬è®¾æƒ³è¿™æ ·ä¸€ç§æƒ…å†µï¼ŒABéƒ½æ£€æµ‹ï¼ŒAå‘æ•°æ®ï¼ŒBçš„è¢«ä¿®æ”¹ä¸º0ï¼Œä½†æ˜¯ä¸‹ä¸€æ¬¡æˆ‘è‚¯å®šè¿˜è¦æ£€æµ‹Bçš„å•Š</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        fd_set tmp_set = read_set;</span><br><span class="line">        <span class="comment">// è°ƒç”¨selectç³»ç»Ÿå‡½æ•°ï¼Œè®©å†…æ ¸å¸®å¿™æ£€æµ‹å“ªäº›æ–‡ä»¶æè¿°ç¬¦æœ‰æ•°æ®</span></span><br><span class="line">        <span class="comment">// è¿™é‡Œæ˜¯åœ¨æ£€æµ‹listen_fdï¼Œå› ä¸ºå¦‚æœæœ‰å®¢æˆ·ç«¯è¯·æ±‚è¿æ¥äº†ï¼Œé‚£ä¹ˆè¿™é‡Œlisten_fdè‚¯å®šä¼šæœ‰æ•°æ®è¿›æ¥</span></span><br><span class="line">        ret = <span class="built_in">select</span>(max_fd + <span class="number">1</span>, &amp;tmp_set, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;select&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == ret)</span><br><span class="line">            <span class="comment">// ä¸º0è¡¨ç¤ºè¶…æ—¶å¹¶ä¸”æ²¡æœ‰æ£€æµ‹åˆ°æœ‰æ”¹å˜çš„</span></span><br><span class="line">            <span class="keyword">continue</span>;  <span class="comment">// è¿™é‡Œæˆ‘ä»¬çš„è®¾ç½®å› ä¸ºæ˜¯é˜»å¡çš„ï¼Œæ‰€ä»¥ä¸ä¼šèµ°åˆ°è¿™é‡Œ</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (ret &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// è¯´æ˜æ£€æµ‹åˆ°äº†æœ‰æ–‡ä»¶æè¿°ç¬¦å¯¹åº”ç¼“å†²åŒºçš„æ•°æ®å‘ç”Ÿäº†æ”¹å˜</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">FD_ISSET</span>(listen_fd, &amp;tmp_set)) &#123;</span><br><span class="line">                <span class="comment">// è¡¨ç¤ºæœ‰æ–°çš„å®¢æˆ·ç«¯è¿æ¥è¿›æ¥äº†</span></span><br><span class="line">                <span class="keyword">struct</span> sockaddr_in client_addr;</span><br><span class="line">                <span class="type">socklen_t</span> client_addr_len = <span class="built_in">sizeof</span>(client_addr);</span><br><span class="line">                <span class="type">int</span> connect_fd = <span class="built_in">accept</span>(listen_fd, (<span class="keyword">struct</span> sockaddr*)&amp;client_addr, &amp;client_addr_len);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="number">-1</span> == connect_fd) &#123;</span><br><span class="line">                    <span class="built_in">perror</span>(<span class="string">&quot;accept&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// è·å–å®¢æˆ·ç«¯çš„ä¿¡æ¯</span></span><br><span class="line">                <span class="type">char</span> ip[MAX_IPV4_STRING] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">                <span class="built_in">inet_ntop</span>(AF_INET, &amp;client_addr.sin_addr.s_addr, ip, <span class="built_in">sizeof</span>(ip));</span><br><span class="line"></span><br><span class="line">                <span class="type">in_port_t</span> port = <span class="built_in">ntohs</span>(client_addr.sin_port);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// æ‰“å°ä¿¡æ¯</span></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;client ip : %s , port : %d has connected...\n&quot;</span>, ip, port);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å°†å®¢æˆ·ç«¯çš„ä¿¡æ¯ä¿å­˜åˆ°å…¨å±€æ•°ç»„ä¸­</span></span><br><span class="line">                cli_infos[connect_fd] = <span class="built_in">Client_Info</span>(ip, port);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å°†æ–°çš„æ–‡ä»¶æè¿°ç¬¦åŠ å…¥åˆ°é›†åˆä¸­ï¼Œè¿™æ ·select()å°±å¯ä»¥ç›‘å¬å®¢æˆ·ç«¯çš„æ•°æ®äº†</span></span><br><span class="line">                <span class="built_in">FD_SET</span>(connect_fd, &amp;read_set);</span><br><span class="line">                <span class="comment">// æ›´æ–°max_fd</span></span><br><span class="line">                max_fd = <span class="built_in">bigger</span>(connect_fd, max_fd);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// çœ‹å®Œç›‘å¬çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¿˜è¦çœ‹å…¶ä»–çš„æ–‡ä»¶æè¿°ç¬¦æ ‡è¯†ä½</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = listen_fd + <span class="number">1</span>; i &lt; max_fd + <span class="number">1</span>; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">FD_ISSET</span>(i, &amp;tmp_set))</span><br><span class="line">                    <span class="comment">// è¡¨ç¤ºæœ‰æ•°æ®åˆ°æ¥ï¼Œè¿›è¡Œé€šä¿¡ï¼ŒæœåŠ¡ç«¯åªå¤„ç†ä¸€æ¬¡ï¼Œç„¶ååˆé‡æ–°æ£€æµ‹æ˜¯å¦æœ‰æ•°æ®ï¼Œæœ‰æ•°æ®åˆ™åˆèµ°è¿™æ®µä»£ç </span></span><br><span class="line">                    <span class="comment">// å¹¶ä¸”å¦‚æœæœåŠ¡ç«¯é‡Œé¢å¤„ç†ç”¨å¾ªç¯å¤„ç†ï¼Œé‚£ä¹ˆè¿™ä¸ªå®¢æˆ·ç«¯ä¸€ç›´æŠ¢å è€…æœåŠ¡ç«¯ï¼Œå…¶ä»–æœåŠ¡ç«¯æ²¡åŠæ³•å‘é€æ•°æ®</span></span><br><span class="line">                    <span class="built_in">Communicate</span>(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.å…³é—­è¿æ¥</span></span><br><span class="line">    <span class="built_in">close</span>(listen_fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// client.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXSIZE 1024</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºå¥—æ¥å­—</span></span><br><span class="line">    <span class="type">int</span> connect_fd = <span class="built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == connect_fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;socket&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.å»ºç«‹è¿æ¥</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> server_addr;</span><br><span class="line">    <span class="comment">// åœ°å€æ—</span></span><br><span class="line">    server_addr.sin_family = AF_INET;</span><br><span class="line">    <span class="comment">// ç«¯å£</span></span><br><span class="line">    server_addr.sin_port = <span class="built_in">htons</span>(<span class="number">9999</span>);</span><br><span class="line">    <span class="comment">// IP</span></span><br><span class="line">    <span class="built_in">inet_pton</span>(AF_INET, <span class="string">&quot;127.0.0.2&quot;</span>, &amp;server_addr.sin_addr.s_addr);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">connect</span>(connect_fd, (<span class="keyword">struct</span> sockaddr*)&amp;server_addr, <span class="built_in">sizeof</span>(server_addr));</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;connect&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;connected successfully , waiting for communicating.\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> buf[MAXSIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="comment">// 3.å¼€å§‹é€šä¿¡</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// å†™</span></span><br><span class="line">        <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">        <span class="built_in">fgets</span>(buf, <span class="built_in">sizeof</span>(buf), stdin);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¢åŠ é€€å‡ºåŠŸèƒ½</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(buf, <span class="string">&quot;quit\n&quot;</span>) == <span class="number">0</span> || <span class="built_in">strcmp</span>(buf, <span class="string">&quot;QUIT\n&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">goto</span> END;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">write</span>(connect_fd, buf, <span class="built_in">strlen</span>(buf));</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;send : %s&quot;</span>, buf);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¯»</span></span><br><span class="line">        <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">        <span class="type">int</span> len = <span class="built_in">read</span>(connect_fd, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">-1</span> == len) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;read&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;recv : %s&quot;</span>, buf);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == len) &#123;  <span class="comment">// è¯´æ˜å†™ç«¯å…³é—­ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å…³é—­</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;server has closed...\n&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">END:</span><br><span class="line">    <span class="comment">// 4.å…³é—­è¿æ¥</span></span><br><span class="line">    <span class="built_in">close</span>(connect_fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h5 id="ä»£ç åˆ†æ"><a href="#ä»£ç åˆ†æ" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä»£ç åˆ†æ"></a> ä»£ç åˆ†æ</h5><p>å¥½ï¼Œç°åœ¨æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™æ®µä»£ç </p><p>é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ï¼ŒNIOæ¨¡å‹ï¼Œå°±æ˜¯ä¸é˜»å¡ï¼Œè€Œæ˜¯è½®è¯¢ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨whileå¾ªç¯æ¥å®ç°è¿™ä¸ªæœºåˆ¶ï¼Œç„¶ååœ¨select()åŸºç¡€ä¸Šæˆ‘ä»¬è¦ç¡®è®¤éœ€è¦æ£€æµ‹çš„æ–‡ä»¶æè¿°ç¬¦çš„è¯»çš„çŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬å®šä¹‰ fd_set read_set ï¼Œç”±äºç›‘å¬çš„listen_fdå½“æœ‰å®¢æˆ·ç«¯è¿æ¥çš„æ—¶å€™ä¹Ÿæ˜¯ç®—æœ‰æ•°æ®è¿›å…¥ï¼Œå¯¹åº”read_set[]çš„æ ‡å¿—ä½ä¼šæ”¹å˜ï¼Œæ‰€ä»¥å°†å…¶æ·»åŠ è¿›å»</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…ˆåˆå§‹åŒ–</span></span><br><span class="line"><span class="built_in">FD_ZERO</span>(&amp;read_set);</span><br><span class="line"><span class="comment">// æ·»åŠ éœ€è¦æ£€æµ‹çš„æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line"><span class="built_in">FD_SET</span>(listen_fd, &amp;read_set);</span><br></pre></td></tr></table></div></figure><p>ä¹‹åè¿›å…¥whileå¾ªç¯æˆ‘ä»¬æ£€æµ‹æ˜¯å¦æœ‰å˜åŒ–ï¼Œæœ‰å˜åŒ–åˆ™è¯´æ˜æœ‰æ–°å®¢æˆ·ç«¯è¿æ¥æˆ–è€…è¿æ¥ä¸Šçš„å®¢æˆ·ç«¯æœ‰æ•°æ®è¿›å…¥ï¼Œè¿™é‡Œæˆ‘ä»¬è®¾ç½®é˜»å¡ç­‰å¾…å˜åŒ–ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è®¾ç½®ä¸€ä¸ªç­‰å¾…çš„å‘¨æœŸæ—¶é—´</p><p>æ³¨æ„è¿”å›å€¼ ret ä»£è¡¨çš„æ˜¯æ£€æµ‹åˆ°å˜åŒ–çš„ä¸ªæ•°ï¼Œ-1è¡¨ç¤ºé”™è¯¯ï¼Œ0è¡¨ç¤ºæ²¡æœ‰ï¼Œå¯ä»¥é‡å¼€å¾ªç¯(ä½†æ˜¯æˆ‘ä»¬è¿™é‡Œä¸ä¼šï¼Œå› ä¸ºæˆ‘ä»¬é˜»å¡)ï¼›&gt;0åˆ™è¡¨ç¤ºæœ‰å˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œåç»­å¤„ç†</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ret = <span class="built_in">select</span>(max_fd + <span class="number">1</span>, &amp;tmp_set, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>);</span><br></pre></td></tr></table></div></figure><p>å¯èƒ½æ˜¯æ–°å®¢æˆ·ç«¯è¿æ¥æˆ–è€…å·²è¿æ¥çš„å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p><p><strong>æ–°å®¢æˆ·ç«¯è¿æ¥</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¡¨ç¤ºæœ‰æ–°çš„å®¢æˆ·ç«¯è¿æ¥è¿›æ¥äº†</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> client_addr;</span><br><span class="line"><span class="type">socklen_t</span> client_addr_len = <span class="built_in">sizeof</span>(client_addr);</span><br><span class="line"><span class="type">int</span> connect_fd = <span class="built_in">accept</span>(listen_fd, (<span class="keyword">struct</span> sockaddr*)&amp;client_addr, &amp;client_addr_len);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="number">-1</span> == connect_fd) &#123;</span><br><span class="line">    <span class="built_in">perror</span>(<span class="string">&quot;accept&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å®¢æˆ·ç«¯çš„ä¿¡æ¯</span></span><br><span class="line"><span class="type">char</span> ip[MAX_IPV4_STRING] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="built_in">inet_ntop</span>(AF_INET, &amp;client_addr.sin_addr.s_addr, ip, <span class="built_in">sizeof</span>(ip));</span><br><span class="line"></span><br><span class="line"><span class="type">in_port_t</span> port = <span class="built_in">ntohs</span>(client_addr.sin_port);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°ä¿¡æ¯</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;client ip : %s , port : %d has connected...\n&quot;</span>, ip, port);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†å®¢æˆ·ç«¯çš„ä¿¡æ¯ä¿å­˜åˆ°å…¨å±€æ•°ç»„ä¸­</span></span><br><span class="line">cli_infos[connect_fd] = <span class="built_in">Client_Info</span>(ip, port);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†æ–°çš„æ–‡ä»¶æè¿°ç¬¦åŠ å…¥åˆ°é›†åˆä¸­ï¼Œè¿™æ ·select()å°±å¯ä»¥ç›‘å¬å®¢æˆ·ç«¯çš„æ•°æ®äº†</span></span><br><span class="line"><span class="built_in">FD_SET</span>(connect_fd, &amp;read_set);</span><br><span class="line"><span class="comment">// æ›´æ–°max_fd</span></span><br><span class="line">max_fd = <span class="built_in">bigger</span>(connect_fd, max_fd);</span><br></pre></td></tr></table></div></figure><p>æˆ‘ä»¬ä¸çœ‹ä¸Šé¢æ‰“å°ä¿¡æ¯çš„éƒ¨åˆ†ï¼Œçœ‹æœ€åä¸¤å¥</p><ul><li>æˆ‘ä»¬å°†æ–°çš„connect_fdæ·»åŠ åˆ°read_setå½“ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥æ£€æµ‹äº†</li><li>æˆ‘ä»¬æ›´æ–°çš„max_fdï¼Œè¿™æ ·å¯ä»¥æé«˜æ•ˆç‡</li></ul><p><strong>å·²ç»è¿æ¥ä¸Šçš„å®¢æˆ·ç«¯æ”¶åˆ°æ•°æ®</strong></p><p>æˆ‘ä»¬å°±ä»listen_fdå¼€å§‹éå†ï¼Œå› ä¸ºlisten_fdæœ€å¼€å§‹åˆ›å»ºï¼Œåœ¨æ™®éæƒ…å†µä¸‹æ˜¯æœ€å°çš„ï¼Œéå†åˆ°max_fdä¸ºæ­¢</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// çœ‹å®Œç›‘å¬çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¿˜è¦çœ‹å…¶ä»–çš„æ–‡ä»¶æè¿°ç¬¦æ ‡è¯†ä½</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = listen_fd + <span class="number">1</span>; i &lt; max_fd + <span class="number">1</span>; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">FD_ISSET</span>(i, &amp;tmp_set))</span><br><span class="line">        <span class="comment">// è¡¨ç¤ºæœ‰æ•°æ®åˆ°æ¥ï¼Œè¿›è¡Œé€šä¿¡ï¼ŒæœåŠ¡ç«¯åªå¤„ç†ä¸€æ¬¡ï¼Œç„¶ååˆé‡æ–°æ£€æµ‹æ˜¯å¦æœ‰æ•°æ®ï¼Œæœ‰æ•°æ®åˆ™åˆèµ°è¿™æ®µä»£ç </span></span><br><span class="line">        <span class="comment">// å¹¶ä¸”å¦‚æœæœåŠ¡ç«¯é‡Œé¢å¤„ç†ç”¨å¾ªç¯å¤„ç†ï¼Œé‚£ä¹ˆè¿™ä¸ªå®¢æˆ·ç«¯ä¸€ç›´æŠ¢å è€…æœåŠ¡ç«¯ï¼Œå…¶ä»–æœåŠ¡ç«¯æ²¡åŠæ³•å‘é€æ•°æ®</span></span><br><span class="line">        <span class="built_in">Communicate</span>(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹é€šä¿¡å‡½æ•°</p><p>æˆ‘ä»¬æ³¨æ„åˆ°ä¸€ä¸ªç»†èŠ‚ï¼Œå°±æ˜¯æ²¡æœ‰ä½¿ç”¨whileå¾ªç¯ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å› ä¸ºå¦‚æœæœåŠ¡ç«¯é‡Œé¢å¤„ç†ç”¨å¾ªç¯å¤„ç†ï¼Œé‚£ä¹ˆè¿™ä¸ªå®¢æˆ·ç«¯ä¸€ç›´æŠ¢å è€…æœåŠ¡ç«¯ï¼Œå…¶ä»–æœåŠ¡ç«¯æ²¡åŠæ³•å‘é€æ•°æ®ï¼›</p><p>å¹¶ä¸”æˆ‘ä¸ç”¨å¾ªç¯å¤„ç†æˆ‘æŠŠæ•°æ®è¯»äº†å°±ç»“æŸå‡½æ•°ï¼Œç„¶ååˆé‡æ–°å¼€å§‹æ£€æµ‹ï¼Œä»£ç é‡Œç§»é™¤æ ‡å¿—ä½å¹¶ä¸”å…³é—­æ–‡ä»¶æè¿°ç¬¦æ˜¯åœ¨å†™ç«¯å…³é—­çš„æ—¶å€™ï¼Œè¿™æ—¶å€™ä¹Ÿæ˜¯åˆæƒ…åˆç†çš„</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Communicate</span><span class="params">(<span class="type">const</span> <span class="type">int</span>&amp; _connect_fd)</span> </span>&#123;</span><br><span class="line">    <span class="type">char</span>* _client_ip = cli_infos[_connect_fd].client_ip;</span><br><span class="line">    <span class="type">in_port_t</span>&amp; _client_port = cli_infos[_connect_fd].client_port;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> buf[MAXSIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="comment">// è¯»</span></span><br><span class="line">    <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">    <span class="type">int</span> len = <span class="built_in">read</span>(_connect_fd, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == len) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;read&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;recv client (ip : %s , port : %d) : %s&quot;</span>, _client_ip, _client_port, buf);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == len) &#123;  <span class="comment">// å®¢æˆ·ç«¯å…³é—­</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;client ip : %s , port : %d has closed...\n&quot;</span>, _client_ip, _client_port);</span><br><span class="line">        <span class="comment">// è¿™é‡Œå…³é—­ä¹‹åéœ€è¦ç§»é™¤æ–‡ä»¶æè¿°ç¬¦é›†åˆä¸­çš„æ ‡å¿—ä½è¡¨ç¤ºæˆ‘ä¸éœ€è¦ç›‘å¬è¿™ä¸ªäº†</span></span><br><span class="line">        <span class="built_in">FD_CLR</span>(_connect_fd, &amp;read_set);</span><br><span class="line">        <span class="comment">// å…³é—­æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">        <span class="built_in">close</span>(_connect_fd);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å†™</span></span><br><span class="line">    <span class="built_in">write</span>(_connect_fd, buf, <span class="built_in">strlen</span>(buf));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æˆ‘ä»¬çš„ä»£ç ä¸­è¿˜æœ‰ä¸€ä¸ªç»†èŠ‚</p><p>å°±æ˜¯åœ¨è¿™é‡Œä¸ºä»€ä¹ˆè¦ç”¨tmp_setï¼Œæœ‰çš„åœ°æ–¹æ˜¯read_setï¼Œæœ‰çš„åœ°æ–¹æ˜¯tmp_set</p><p>è¿™ä¸ªåœ°æ–¹æˆ‘ä¸èƒ½æŠŠread_seté›†åˆæ‹¿è¿›å»è®©å†…æ ¸è¿›è¡Œæ‹·è´ä¿®æ”¹ç„¶åè¦†ç›–æˆ‘çš„è¿™ä¸ªï¼›</p><p>æˆ‘ä»¬è®¾æƒ³è¿™æ ·ä¸€ç§æƒ…å†µï¼ŒABéƒ½æ£€æµ‹ï¼ŒAå‘æ•°æ®ï¼ŒBçš„è¢«ä¿®æ”¹ä¸º0ï¼Œä½†æ˜¯ä¸‹ä¸€æ¬¡æˆ‘è‚¯å®šè¿˜è¦æ£€æµ‹Bçš„å•Šï¼Œè¿™å°±å‡ºç°é—®é¢˜äº†</p><p>æ‰€ä»¥æˆ‘ä»¬æƒ³åˆ°çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨ä¸´æ—¶å˜é‡ï¼Œä½†æ˜¯åƒæ–°å®¢æˆ·ç«¯è¿æ¥ï¼Œå†™ç«¯å…³é—­çš„æ—¶å€™åˆ é™¤æ–‡ä»¶æè¿°ç¬¦çš„æ£€æµ‹è¿™äº›è¿˜æ˜¯è¦æ“ä½œread_setï¼Œä¹Ÿå¾ˆå¥½ç†è§£</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821162010058.png" alt="image-20230821162010058" style="zoom:80%"><h4 id="poll"><a href="#poll" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#poll"></a> poll</h4><p><strong>pollæŠ€æœ¯æ˜¯å¯¹selectæŠ€æœ¯è¿›è¡Œæ”¹è¿›ï¼Œæ‰€ä»¥selectæŠ€æœ¯è‚¯å®šå…·æœ‰ç¼ºç‚¹</strong></p><h5 id="selectæŠ€æœ¯çš„ç¼ºç‚¹"><a href="#selectæŠ€æœ¯çš„ç¼ºç‚¹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#selectæŠ€æœ¯çš„ç¼ºç‚¹"></a> selectæŠ€æœ¯çš„ç¼ºç‚¹</h5><p>å½“å®¢æˆ·ç«¯å¤šäº†çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯fdå¤šäº†çš„æ—¶å€™ï¼Œå°±ä¼šå‡ºç°å¦‚ä¸‹çš„ä¸€ç³»åˆ—é—®é¢˜</p><p><strong>å…¶ä¸­çš„ç¬¬å››æ¡å°±æ˜¯ä¸ä½¿ç”¨ä¸´æ—¶ tmp_set çš„é—®é¢˜ï¼Œread_setåº”è¯¥è¦ç»§ç»­æ£€æµ‹çš„éƒ¨åˆ†è¢«ç½®ä¸º0äº†ï¼Œå°±å› ä¸ºè¿™ä¸ªæ—¶å€™æ²¡æœ‰æ•°æ®è¿›æ¥ï¼Œæ‰€ä»¥è¨€ä¸‹ä¹‹æ„å°±æ˜¯ä¸èƒ½é‡ç”¨ï¼Œæ¯æ¬¡éƒ½éœ€è¦é‡ç½®</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821162714320.png" alt="image-20230821162714320"></p><h5 id="poll-2"><a href="#poll-2" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#poll-2"></a> poll()</h5><p><strong>ä½¿ç”¨æ—¶å¼•å¤´æ–‡ä»¶ &lt;poll.h&gt;</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;poll.h&gt;</span></span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">pollfd</span> &#123;</span><br><span class="line">    <span class="type">int</span> fd; <span class="comment">/* å§”æ‰˜å†…æ ¸æ£€æµ‹çš„æ–‡ä»¶æè¿°ç¬¦ */</span></span><br><span class="line">    <span class="type">short</span> events; <span class="comment">/* å§”æ‰˜å†…æ ¸æ£€æµ‹æ–‡ä»¶æè¿°ç¬¦çš„ä»€ä¹ˆäº‹ä»¶ */</span></span><br><span class="line">    <span class="type">short</span> revents; <span class="comment">/* æ–‡ä»¶æè¿°ç¬¦å®é™…å‘ç”Ÿçš„äº‹ä»¶ */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">pollfd</span> myfd;</span><br><span class="line">myfd.fd = <span class="number">5</span>;</span><br><span class="line">myfd.events = POLLIN | POLLOUT;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">poll</span><span class="params">(<span class="keyword">struct</span> pollfd *fds, <span class="type">nfds_t</span> nfds, <span class="type">int</span> timeout)</span></span>;</span><br><span class="line">    - å‚æ•°ï¼š</span><br><span class="line">        - fds : æ˜¯ä¸€ä¸ª<span class="keyword">struct</span> <span class="title class_">pollfd</span> ç»“æ„ä½“æ•°ç»„ï¼Œè¿™æ˜¯ä¸€ä¸ªéœ€è¦æ£€æµ‹çš„æ–‡ä»¶æè¿°ç¬¦çš„é›†åˆ</span><br><span class="line">        - nfds : è¿™ä¸ªæ˜¯ç¬¬ä¸€ä¸ªå‚æ•°æ•°ç»„ä¸­æœ€åä¸€ä¸ªæœ‰æ•ˆå…ƒç´ çš„ä¸‹æ ‡ + <span class="number">1</span></span><br><span class="line">        - timeout : é˜»å¡æ—¶é•¿</span><br><span class="line">            <span class="number">0</span> : ä¸é˜»å¡</span><br><span class="line">            <span class="number">-1</span> : é˜»å¡ï¼Œå½“æ£€æµ‹åˆ°éœ€è¦æ£€æµ‹çš„æ–‡ä»¶æè¿°ç¬¦æœ‰å˜åŒ–ï¼Œè§£é™¤é˜»å¡</span><br><span class="line">            &gt;<span class="number">0</span> : é˜»å¡çš„æ—¶é•¿ï¼Œå•ä½æ˜¯æ¯«ç§’</span><br><span class="line">    - è¿”å›å€¼ï¼š</span><br><span class="line">        <span class="number">-1</span> : å¤±è´¥</span><br><span class="line">        &gt;<span class="number">0</span>ï¼ˆnï¼‰ : æˆåŠŸ,nè¡¨ç¤ºæ£€æµ‹åˆ°é›†åˆä¸­æœ‰nä¸ªæ–‡ä»¶æè¿°ç¬¦å‘ç”Ÿå˜åŒ–</span><br></pre></td></tr></table></div></figure><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821095539250.png" alt="image-20230821095539250"></p><h5 id="ä»£ç -2"><a href="#ä»£ç -2" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä»£ç -2"></a> ä»£ç </h5><p>ä»£ç çš„æ¶æ„å’Œå‰é¢çš„å‡ ä¹æ²¡æœ‰åŒºåˆ«ï¼Œåªæœ‰server.cppè¿›è¡Œäº†ä¿®æ”¹ï¼Œè¿™é‡Œåªæ”¾å‡ºserver.cpp</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;poll.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Client_Info.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXSIZE 1024</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_CLIENT_SIZE 1024</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_POLLFD_SIZE 1025</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¨å±€å­˜æ”¾å®¢æˆ·ç«¯è¿æ¥çš„IPå’Œç«¯å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Client_Info</span> cli_infos[MAX_CLIENT_SIZE];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¨å±€å­˜æ”¾éœ€è¦æ£€æµ‹çš„æ–‡ä»¶æè¿°ç¬¦æ•°ç»„</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">pollfd</span> fds[MAX_POLLFD_SIZE];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bigger</span><span class="params">(<span class="type">const</span> <span class="type">int</span>&amp; val1, <span class="type">const</span> <span class="type">int</span>&amp; val2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> val1 &gt; val2 ? val1 : val2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Communicate</span><span class="params">(<span class="type">const</span> <span class="type">int</span>&amp; _index)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> _connect_fd = fds[_index].fd;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span>* _client_ip = cli_infos[_connect_fd].client_ip;</span><br><span class="line">    <span class="type">in_port_t</span>&amp; _client_port = cli_infos[_connect_fd].client_port;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> buf[MAXSIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="comment">// è¯»</span></span><br><span class="line">    <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">    <span class="type">int</span> len = <span class="built_in">read</span>(_connect_fd, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == len) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;read&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;recv client (ip : %s , port : %d) : %s&quot;</span>, _client_ip, _client_port, buf);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == len) &#123;  <span class="comment">// å®¢æˆ·ç«¯å…³é—­</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;client ip : %s , port : %d has closed...\n&quot;</span>, _client_ip, _client_port);</span><br><span class="line">        <span class="comment">// å…³é—­æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">        <span class="built_in">close</span>(_connect_fd);</span><br><span class="line">        <span class="comment">// å°†å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦ç½®ä¸º-1</span></span><br><span class="line">        fds[_index].fd = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å†™</span></span><br><span class="line">    <span class="built_in">write</span>(_connect_fd, buf, <span class="built_in">strlen</span>(buf));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºsocket</span></span><br><span class="line">    <span class="type">int</span> listen_fd = <span class="built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == listen_fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;socket&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®ä¸€ä¸‹ç«¯å£å¤ç”¨</span></span><br><span class="line">    <span class="type">int</span> _optval = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">setsockopt</span>(listen_fd, SOL_SOCKET, SO_REUSEPORT, &amp;_optval, <span class="built_in">sizeof</span>(_optval));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.ç»‘å®šIPå’Œç«¯å£</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> server_addr;</span><br><span class="line">    <span class="comment">// åœ°å€æ—</span></span><br><span class="line">    server_addr.sin_family = AF_INET;</span><br><span class="line">    <span class="comment">// IP</span></span><br><span class="line">    server_addr.sin_addr.s_addr = INADDR_ANY;</span><br><span class="line">    <span class="comment">// ç«¯å£</span></span><br><span class="line">    server_addr.sin_port = <span class="built_in">htons</span>(<span class="number">9999</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">bind</span>(listen_fd, (<span class="keyword">struct</span> sockaddr*)&amp;server_addr, <span class="built_in">sizeof</span>(server_addr));</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;bind&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;server has initialized.\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.å¼€å§‹ç›‘å¬</span></span><br><span class="line">    ret = <span class="built_in">listen</span>(listen_fd, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;listen&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨NIOæ¨¡å‹ï¼Œä½¿ç”¨pollè§£å†³é—®é¢˜</span></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æ£€æµ‹çš„æ–‡ä»¶æè¿°ç¬¦æ•°ç»„</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; MAX_POLLFD_SIZE; ++i) &#123;</span><br><span class="line">        fds[i].fd = <span class="number">-1</span>;</span><br><span class="line">        fds[i].events = POLLIN;  <span class="comment">// è¡¨ç¤ºä¸€ä¼šå„¿è¦å»æ£€æµ‹è¯»äº‹ä»¶</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åŠ å…¥ç›‘å¬çš„æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">    fds[<span class="number">0</span>].fd = listen_fd;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰æœ€å¤§çš„æ–‡ä»¶æè¿°ç¬¦çš„fds[]æ•°ç»„çš„ç´¢å¼•</span></span><br><span class="line">    <span class="type">int</span> nfds = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨poll()å‡½æ•°ï¼Œè¿™æ˜¯select()å‡½æ•°çš„æ”¹è¿›ç‰ˆæœ¬</span></span><br><span class="line">        ret = <span class="built_in">poll</span>(fds, nfds + <span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;select&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == ret)</span><br><span class="line">            <span class="comment">// ä¸º0è¡¨ç¤ºè¶…æ—¶å¹¶ä¸”æ²¡æœ‰æ£€æµ‹åˆ°æœ‰æ”¹å˜çš„</span></span><br><span class="line">            <span class="keyword">continue</span>;  <span class="comment">// è¿™é‡Œæˆ‘ä»¬çš„è®¾ç½®å› ä¸ºæ˜¯é˜»å¡çš„ï¼Œæ‰€ä»¥ä¸ä¼šèµ°åˆ°è¿™é‡Œ</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (ret &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// è¯´æ˜æ£€æµ‹åˆ°äº†æœ‰æ–‡ä»¶æè¿°ç¬¦å¯¹åº”ç¼“å†²åŒºçš„æ•°æ®å‘ç”Ÿäº†æ”¹å˜</span></span><br><span class="line">            <span class="keyword">if</span> (fds[<span class="number">0</span>].revents &amp; POLLIN == POLLIN) &#123;</span><br><span class="line">                <span class="comment">// è¡¨ç¤ºæœ‰æ–°çš„å®¢æˆ·ç«¯è¿æ¥è¿›æ¥äº†</span></span><br><span class="line">                <span class="keyword">struct</span> sockaddr_in client_addr;</span><br><span class="line">                <span class="type">socklen_t</span> client_addr_len = <span class="built_in">sizeof</span>(client_addr);</span><br><span class="line">                <span class="type">int</span> connect_fd = <span class="built_in">accept</span>(listen_fd, (<span class="keyword">struct</span> sockaddr*)&amp;client_addr, &amp;client_addr_len);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="number">-1</span> == connect_fd) &#123;</span><br><span class="line">                    <span class="built_in">perror</span>(<span class="string">&quot;accept&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// è·å–å®¢æˆ·ç«¯çš„ä¿¡æ¯</span></span><br><span class="line">                <span class="type">char</span> ip[MAX_IPV4_STRING] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">                <span class="built_in">inet_ntop</span>(AF_INET, &amp;client_addr.sin_addr.s_addr, ip, <span class="built_in">sizeof</span>(ip));</span><br><span class="line"></span><br><span class="line">                <span class="type">in_port_t</span> port = <span class="built_in">ntohs</span>(client_addr.sin_port);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// æ‰“å°ä¿¡æ¯</span></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;client ip : %s , port : %d has connected...\n&quot;</span>, ip, port);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å°†å®¢æˆ·ç«¯çš„ä¿¡æ¯ä¿å­˜åˆ°å…¨å±€æ•°ç»„ä¸­</span></span><br><span class="line">                cli_infos[connect_fd] = <span class="built_in">Client_Info</span>(ip, port);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å°†æ–°çš„æ–‡ä»¶æè¿°ç¬¦åŠ å…¥åˆ°äº‹ä»¶ä¸­ï¼Œæ³¨æ„æ–‡ä»¶æè¿°ç¬¦çš„ä¼˜å…ˆç”¨å°çš„æœºåˆ¶</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; MAX_POLLFD_SIZE; ++i)</span><br><span class="line">                    <span class="keyword">if</span> (fds[i].fd == <span class="number">-1</span>) &#123;</span><br><span class="line">                        fds[i].fd = connect_fd;</span><br><span class="line">                        fds[i].events = POLLIN;</span><br><span class="line">                        <span class="comment">// æ›´æ–°nfds</span></span><br><span class="line">                        nfds = <span class="built_in">bigger</span>(nfds, i);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// çœ‹å®Œç›‘å¬çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œçœ‹å…¶ä»–çš„æ–‡ä»¶æè¿°ç¬¦æ˜¯å¦æ”¶åˆ°æ•°æ®</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; nfds + <span class="number">1</span>; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (fds[i].revents &amp; POLLIN == POLLIN)</span><br><span class="line">                    <span class="built_in">Communicate</span>(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.å…³é—­è¿æ¥</span></span><br><span class="line">    <span class="built_in">close</span>(listen_fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h5 id="ä»£ç åˆ†æ-2"><a href="#ä»£ç åˆ†æ-2" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä»£ç åˆ†æ-2"></a> ä»£ç åˆ†æ</h5><p>é¦–å…ˆæˆ‘ä»¬è¦ç†è§£ç»“æ„ä½“ pollfd çš„å«ä¹‰</p><p><strong>è¿™æ˜¯ç”¨æ¥ä¿å­˜å§”æ‰˜å†…æ ¸æ£€æµ‹çš„æ–‡ä»¶æè¿°ç¬¦ï¼›å§”æ‰˜å†…æ ¸æ£€æµ‹çš„æ–‡ä»¶æè¿°ç¬¦çš„ä»€ä¹ˆäº‹ä»¶ï¼Œæ¯”å¦‚è¯»å†™ï¼Œç±»ä¼¼äºselectä¸­çš„read_setï¼›è¿˜æœ‰æ£€æµ‹è¿‡åå®é™…å‘ç”Ÿçš„äº‹ä»¶ï¼Œæ¯”å¦‚æ²¡æœ‰è¯»ï¼Œå°±ä¿®æ”¹ï¼Œç±»ä¼¼äºselectä¸­çš„ tmp_setï¼›çš„ä¸€ä¸ªç»“æ„ä½“</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">pollfd</span> &#123;</span><br><span class="line">    <span class="type">int</span> fd; <span class="comment">/* å§”æ‰˜å†…æ ¸æ£€æµ‹çš„æ–‡ä»¶æè¿°ç¬¦ */</span></span><br><span class="line">    <span class="type">short</span> events; <span class="comment">/* å§”æ‰˜å†…æ ¸æ£€æµ‹æ–‡ä»¶æè¿°ç¬¦çš„ä»€ä¹ˆäº‹ä»¶ */</span></span><br><span class="line">    <span class="type">short</span> revents; <span class="comment">/* æ–‡ä»¶æè¿°ç¬¦å®é™…å‘ç”Ÿçš„äº‹ä»¶ */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><p>å€¼å¾—æ³¨æ„çš„æ˜¯è¿™äº›äº‹ä»¶çš„ç±»å‹å’Œå­˜å‚¨æ–¹æ³•ï¼Œæ˜¯shortç±»å‹çš„ï¼Œæˆ‘ä»¬æ¥çœ‹å®ƒå¯ä»¥æè¿°å“ªäº›äº‹ä»¶</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821095539250.png" alt="image-20230821095539250"></p><p><strong>å…¶å®ä»–å’Œæ–‡ä»¶å±æ€§statå˜é‡é‡Œé¢st_mode(è¡¨ç¤ºæ–‡ä»¶ç±»å‹å’Œæƒé™)æ˜¯ä¸€ä¸ªé“ç†ï¼Œä¸€ä¸ªbitä½è¡¨ç¤ºä¸€ä¸ªæƒé™ï¼Œ1è¡¨ç¤ºæœ‰ï¼Œ0è¡¨ç¤ºæ²¡æœ‰ï¼Œå› æ­¤æ·»åŠ æƒé™åº”è¯¥ç”¨ æŒ‰ä½æˆ– | ï¼Œ è¿™é‡Œçš„äº‹ä»¶ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ï¼Œæˆ‘ä»¬ä¸€èˆ¬åˆ¤æ–­è¯»äº‹ä»¶å°±POLLINï¼Œå†™äº‹ä»¶å°±POLLOUT</strong></p><p><strong>ç¬¬ä¸‰ä¸ªå‚æ•°å°±æ˜¯ç»è¿‡æ£€æµ‹ä¹‹åçš„çŠ¶æ€ï¼Œå¯ä»¥ç”¨å®ƒæ¥åˆ¤æ–­æ˜¯å¦æœ‰æ£€æµ‹åˆ°è¯»ï¼›ç”±äºæˆ‘ä»¬è®¾ç½®çš„eventæ²¡æœ‰å˜åŒ–ï¼Œæ‰€ä»¥ç›¸å¯¹äºselect()è¿˜æ˜¯å¥½äº†å¾ˆå¤š</strong></p><p>*<em>å…¶æ¬¡ï¼Œæˆ‘ä»¬æŸ¥çœ‹poll()æ¥å£çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ï¼š struct pollfd <em>fdsï¼Œéœ€è¦ä¸€ä¸ªç»“æ„ä½“çš„æ•°ç»„ä¼ å…¥è¿›æ¥ï¼Œæ¯ä¸€ä¸ªå…ƒç´ å°±å°è£…äº†ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬ä»0å¼€å§‹ä¾æ¬¡è®°å½•ï¼Œå¦‚æœè¯¥å…ƒç´ çš„fdä¸º-1å°±è¡¨ç¤ºæ²¡æœ‰ä½¿ç”¨ï¼Œå¯ä»¥å­˜æ”¾æ–°çš„å…ƒç´ ï¼Œæ³¨æ„è¿™ä¸ªä¸‹æ ‡ï¼Œæˆ–è€…æˆ‘ä»¬ç§°ä»–ä¸ºç´¢å¼•ï¼Œç´¢å¼•çš„å€¼å’Œæ–‡ä»¶æè¿°ç¬¦çš„å€¼æ˜¯ä¸åŒçš„ï¼Œä¸ºäº†æé«˜æ•ˆç‡æˆ‘ä»¬è¿™ä¹ˆè®¾è®¡ï¼Œåœ¨ä»£ç ä¸­ä¸€å®šè¦æ³¨æ„ï¼Œå…¶ä»–çš„é€»è¾‘æ²¡ä»€ä¹ˆåŒºåˆ«</em></em></p><p>è¿˜æœ‰ä¸€ç‚¹ï¼Œæˆ‘ä»¬çœ‹å¦‚ä½•åˆ¤æ–­æœ€åçš„ revents æ£€æµ‹åˆ°è¯»ä¿¡æ¯</p><p>**è¿˜æ˜¯å‰é¢çš„æ€æƒ³ï¼Œæ¯ä¸€ä½å¯¹åº”ä¸€ä¸ªï¼Œè¯»å¯¹åº”ä¸€ä½ä¸º1ï¼Œå…¶ä»–ä¸º0ï¼›å½“ç„¶ä¸ºä»€ä¹ˆä¸æ˜¯ç›´æ¥ç›¸ç­‰å‘¢ï¼Ÿå¯èƒ½æˆ‘ä»¬è®¾ç½®äº†å…¶ä»–æ€§è´¨ä¹Ÿéœ€è¦æ£€æµ‹ï¼Œå†…æ ¸å¤„ç†åè¿˜æ˜¯æœ‰äº†å…¶ä»–çš„æ€§è´¨ä¸º1ï¼Œæˆ‘ä»¬æœ€å¥½ä¸è¦å†’é™©ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ç”¨ &amp; **</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (fds[i].revents &amp; POLLIN == POLLIN)</span><br><span class="line">    <span class="comment">//ä¸‹é¢çš„æ“ä½œ</span></span><br></pre></td></tr></table></div></figure><h4 id="epoll"><a href="#epoll" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#epoll"></a> epoll</h4><p><strong>epollå’Œå‰é¢ä¸¤ç§æŠ€æœ¯ä¸åŒï¼ŒepollæŠ€æœ¯ç›´æ¥åœ¨å†…æ ¸æ€å½“ä¸­è¿›è¡Œæ“ä½œï¼Œå®Œå…¨çœå»äº†ç”¨æˆ·æ€åˆ°å†…æ ¸æ€æ‹·è´çš„è¿‡ç¨‹ï¼Œå¹¶ä¸”ç”±å†…æ ¸é€šçŸ¥ç”¨æˆ·ï¼Œå®ç°äº†å†…æ ¸å’Œç”¨æˆ·çš„å¹¶å‘æ“ä½œï¼Œæé«˜äº†æ•ˆç‡ã€‚</strong></p><h5 id="å·¥ä½œè¿‡ç¨‹åˆ†æ-2"><a href="#å·¥ä½œè¿‡ç¨‹åˆ†æ-2" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å·¥ä½œè¿‡ç¨‹åˆ†æ-2"></a> å·¥ä½œè¿‡ç¨‹åˆ†æ</h5><p>selectæŠ€æœ¯å’ŒpollæŠ€æœ¯è™½ç„¶å®ç°æ–¹å¼æœ‰æ‰€ä¸åŒï¼ŒpollæŠ€æœ¯æ˜¯selectæŠ€æœ¯çš„æ”¹è¿›ï¼Œä½†æ˜¯ä»–ä»¬åœ¨å®é™…æ“ä½œçš„æ—¶å€™éƒ½æ˜¯å…ˆåœ¨ç”¨æˆ·åŒºç”Ÿæˆä¸€ä¸ªè¡¨ï¼Œselectå°±æ˜¯æ–‡ä»¶æè¿°ç¬¦è¡¨ï¼Œå¯¹åº”ä½ç½®ç½®ä¸º1ï¼Œä¸‹æ ‡è¡¨ç¤ºä¸ºæ–‡ä»¶æè¿°ç¬¦ï¼›pollæŠ€æœ¯æ˜¯ç”¨äº‹ä»¶è¡¨ç¤ºçš„ï¼Œå¹¶ä¸”å®šä¹‰äº†æˆ‘ä»¬æƒ³è¦çš„æ£€æµ‹äº‹ä»¶å’Œå®é™…å‘ç”Ÿçš„äº‹ä»¶ä¾›æˆ‘ä»¬æ¯”å¯¹ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³è¦æ£€æµ‹è¯»äº‹ä»¶ï¼Œä»–è¿”å›0åˆ™è¡¨ç¤ºæ²¡å‘ç”Ÿï¼Œä¸¤ä¸ªéƒ½å®šä¹‰å‡ºæ¥å°±å…å»äº†æˆ‘ä»¬ç”¨ä¸´æ—¶å˜é‡çš„éº»çƒ¦ï¼›å¥½ï¼Œè¿™ä¸¤ä¸ªéƒ½æ˜¯å…ˆåœ¨ç”¨æˆ·åŒºç„¶åæ‹·è´åˆ°å†…æ ¸åŒºç„¶åå†å›æ¥ï¼Œä¼—æ‰€å‘¨çŸ¥ï¼Œä»å†…æ ¸åŒºåˆ°ç”¨æˆ·åŒºçš„äºŒè€…åˆ‡æ¢è¦æ¶ˆè€—CPUèµ„æºï¼Œæ‰€ä»¥ä¸€æ—¦æ–‡ä»¶æè¿°ç¬¦å¤šäº†ï¼Œæ£€æµ‹çš„äº‹ä»¶å¤šäº†å°±ä¼šå½±å“æ€§èƒ½</p><p><strong>æ‰€ä»¥æ‰æœ‰äº†epollçš„æŠ€æœ¯ï¼Œè°ƒç”¨epollä¹‹åä¼šç›´æ¥åœ¨å†…æ ¸åŒºç”Ÿæˆæ£€æµ‹äº‹ä»¶çš„ä¸œè¥¿ï¼Œç³»ç»Ÿä¼šæä¾›ç»™æˆ‘ä»¬epollçš„ä¸€ç³»åˆ—APIæ¥å¸®åŠ©æˆ‘ä»¬æ“ä½œå†…æ ¸ä¸­çš„è¿™å—åŒºåŸŸï¼Œä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºå®šä¹‰ä¸º eventpoll ï¼Œé‡Œé¢æ¯”è¾ƒé‡è¦çš„å­˜ç€ rbr å’Œ rdlistï¼Œå‰è€…çš„æ•°æ®ç»“æ„æ˜¯çº¢é»‘æ ‘ï¼Œæ˜¯æˆ‘ä»¬æƒ³è¦æ£€æµ‹çš„äº‹ä»¶ä½“ï¼Œçº¢é»‘æ ‘ä½¿å¾—æŸ¥è¯¢å’Œéå†éå¸¸å¿«ï¼›åè€…çš„æ•°æ®ç»“æ„æ˜¯åŒé“¾è¡¨ï¼Œæ˜¯æ£€æµ‹äº‹ä»¶å‘ç”Ÿå˜åŒ–ï¼Œåœ¨ç½‘ç»œç¼–ç¨‹ä¸­å°±æ˜¯æœ‰è¯»çš„æ•°æ®è¿›æ¥æˆ–è€…æ–°å®¢æˆ·ç«¯è¿æ¥ï¼Œç”¨åŒé“¾è¡¨å¯ä»¥ç›´æ¥äº†å½“çš„éå†å‡ºæ¥</strong></p><p><strong>æ€»ç»“ä¸€ä¸‹ï¼ŒäºŒè€…çš„åŒºåˆ«ä¸€æ˜¯epollçœå»äº†ä»ç”¨æˆ·æ€åˆ°å†…æ ¸æ€ç›¸äº’çš„åˆ‡æ¢ï¼Œç›´æ¥åœ¨å†…æ ¸æ€æ“ä½œï¼Œæ•ˆç‡æ›´é«˜ï¼›äºŒæ˜¯epollä¸ä»…è¿”å›äº†æ£€æµ‹åˆ°äº†å¤šå°‘ä¸ªï¼Œè€Œä¸”è¿˜ç›´æ¥é€šè¿‡åŒé“¾è¡¨çš„å½¢å¼å‘Šè¯‰æˆ‘ä»¬å“ªå‡ ä¸ªè¿”å›äº†ï¼Œè€Œselectå’ŒpollæŠ€æœ¯å¹¶æœªåšåˆ°è¿™ä¸€ç‚¹ï¼ŒselectæŠ€æœ¯ä¿®æ”¹äº†æˆ‘ä»¬ä¼ ç»™ä»–çš„è¡¨ï¼Œè¿”å›å€¼æ˜¯æ£€æµ‹åˆ°äº†å¤šå°‘ä¸ªï¼Œä½†æ˜¯å“ªäº›å˜åŒ–äº†éœ€è¦æˆ‘ä»¬éå†è¿™ä¸ªä»¥æ–‡ä»¶æè¿°ç¬¦ä¸ºä¸‹æ ‡çš„è¡¨ï¼›pollæŠ€æœ¯ç»™æ¯ä¸ªéœ€è¦æ£€æµ‹çš„æ–‡ä»¶æè¿°ç¬¦å°è£…äº†ä¸€ä¸ªç»“æ„ä½“ï¼Œå¹¶ä¸”ä¿å­˜äº†éœ€è¦æ£€æµ‹çš„äº‹ä»¶å’Œå®é™…å‘ç”Ÿçš„äº‹ä»¶ï¼Œä½†æ˜¯ä»ç„¶éœ€è¦æˆ‘ä»¬å»éå†poll()å‚æ•°ä¸­çš„pollfdç»“æ„ä½“æ•°ç»„æ‰è¡Œï¼›ä½†æ˜¯epollå´å°†æ£€æµ‹åˆ°çš„äº‹ä»¶å°è£…åœ¨åŒé“¾è¡¨ rdlist ä¸­ï¼Œç”±æ­¤å¯è§è¿™å°±æ˜¯ä»–çš„ä¼˜åŠ¿</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230821194458779.png" alt="image-20230821194458779"></p><h5 id="epoll-2"><a href="#epoll-2" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#epoll-2"></a> epoll()</h5><p><strong>epollåˆ›å»ºåœ¨å†…æ ¸åŒºçš„ä¸œè¥¿æ“ä½œæ˜¯é€šè¿‡APIè¿”å›çš„æ–‡ä»¶æè¿°ç¬¦æ“ä½œçš„ï¼Œè¿™ä¹Ÿæ˜¯å’Œselectå’ŒpollæŠ€æœ¯ä¸åŒçš„åœ°æ–¹ï¼ŒselectæŠ€æœ¯ç”¨ fd_set å˜é‡(æœ¬è´¨æ˜¯ä¸ªæ•°ç»„)ï¼ŒpollæŠ€æœ¯ç”¨ pollfd ç»“æ„ä½“æ•°ç»„ï¼Œè¿™äº›ä¸œè¥¿åœ¨ä»£ç ä¸­éƒ½æ˜¯åœ¨ç”¨æˆ·åŒºçš„ï¼›è€Œepollç”¨æ–‡ä»¶æè¿°ç¬¦æ‰˜ç®¡ä¹Ÿä»£è¡¨å†…æ ¸åŒºçš„æ€§è´¨</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/epoll.h&gt;</span></span></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„epollå®ä¾‹ã€‚åœ¨å†…æ ¸ä¸­åˆ›å»ºäº†ä¸€ä¸ªæ•°æ®ï¼Œè¿™ä¸ªæ•°æ®ä¸­æœ‰ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„æ•°æ®ï¼Œä¸€ä¸ªæ˜¯éœ€è¦æ£€æµ‹çš„æ–‡ä»¶æè¿°ç¬¦çš„ä¿¡æ¯ï¼ˆçº¢é»‘æ ‘ï¼‰ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯å°±ç»ªåˆ—è¡¨ï¼Œå­˜æ”¾æ£€æµ‹åˆ°æ•°æ®å‘é€æ”¹å˜çš„æ–‡ä»¶æè¿°ç¬¦ä¿¡æ¯ï¼ˆåŒå‘é“¾è¡¨ï¼‰ã€‚</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">epoll_create</span><span class="params">(<span class="type">int</span> size)</span></span>;</span><br><span class="line">    - å‚æ•°ï¼š</span><br><span class="line">    	size : ç›®å‰æ²¡æœ‰æ„ä¹‰äº†ã€‚éšä¾¿å†™ä¸€ä¸ªæ•°ï¼Œå¿…é¡»å¤§äº<span class="number">0</span></span><br><span class="line">    - è¿”å›å€¼ï¼š</span><br><span class="line">        <span class="number">-1</span> : å¤±è´¥</span><br><span class="line">        &gt; <span class="number">0</span> : æ–‡ä»¶æè¿°ç¬¦ï¼Œæ“ä½œepollå®ä¾‹çš„</span><br><span class="line">            </span><br><span class="line"><span class="comment">// ç»“æ„ç±»å‹æ˜¯è”åˆunionï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ fd å‚æ•°å°±è¡Œäº†</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">union</span> <span class="title class_">epoll_data</span> &#123;</span><br><span class="line">    <span class="type">void</span> *ptr;</span><br><span class="line">    <span class="type">int</span> fd;</span><br><span class="line">    <span class="type">uint32_t</span> u32;</span><br><span class="line">    <span class="type">uint64_t</span> u64;</span><br><span class="line">&#125; <span class="type">epoll_data_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">epoll_event</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> events; <span class="comment">/* Epoll events */</span></span><br><span class="line">    <span class="type">epoll_data_t</span> data; <span class="comment">/* User data variable */</span></span><br><span class="line">&#125;;</span><br><span class="line">å¸¸è§çš„Epollæ£€æµ‹äº‹ä»¶eventsï¼š</span><br><span class="line">    - EPOLLIN</span><br><span class="line">    - EPOLLOUT</span><br><span class="line">    - EPOLLERR</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹epollå®ä¾‹è¿›è¡Œç®¡ç†ï¼šæ·»åŠ æ–‡ä»¶æè¿°ç¬¦ä¿¡æ¯ï¼Œåˆ é™¤ä¿¡æ¯ï¼Œä¿®æ”¹ä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">epoll_ctl</span><span class="params">(<span class="type">int</span> epfd, <span class="type">int</span> op, <span class="type">int</span> fd, <span class="keyword">struct</span> epoll_event *event)</span></span>;</span><br><span class="line">    - å‚æ•°ï¼š</span><br><span class="line">        - epfd : epollå®ä¾‹å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">        - op : è¦è¿›è¡Œä»€ä¹ˆæ“ä½œ</span><br><span class="line">            EPOLL_CTL_ADD: æ·»åŠ </span><br><span class="line">            EPOLL_CTL_MOD: ä¿®æ”¹</span><br><span class="line">            EPOLL_CTL_DEL: åˆ é™¤</span><br><span class="line">        - fd : è¦æ£€æµ‹çš„æ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">        - event : æ£€æµ‹æ–‡ä»¶æè¿°ç¬¦ä»€ä¹ˆäº‹æƒ…</span><br><span class="line">            </span><br><span class="line"><span class="comment">// æ£€æµ‹å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">epoll_wait</span><span class="params">(<span class="type">int</span> epfd, <span class="keyword">struct</span> epoll_event *events, <span class="type">int</span> maxevents, <span class="type">int</span> timeout)</span></span>;</span><br><span class="line">    - å‚æ•°ï¼š</span><br><span class="line">        - epfd : epollå®ä¾‹å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">        - events : ä¼ å‡ºå‚æ•°ï¼Œä¿å­˜äº†å‘é€äº†å˜åŒ–çš„æ–‡ä»¶æè¿°ç¬¦çš„ä¿¡æ¯ï¼Œæ˜¯ä¸€ä¸ªç»“æ„ä½“æ•°ç»„</span><br><span class="line">        - maxevents : ç¬¬äºŒä¸ªå‚æ•°ç»“æ„ä½“æ•°ç»„çš„å¤§å°</span><br><span class="line">        - timeout : é˜»å¡æ—¶é—´</span><br><span class="line">              <span class="number">0</span> : ä¸é˜»å¡</span><br><span class="line">              <span class="number">-1</span> : é˜»å¡ï¼Œç›´åˆ°æ£€æµ‹åˆ°fdæ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œè§£é™¤é˜»å¡</span><br><span class="line">              &gt; <span class="number">0</span> : é˜»å¡çš„æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰</span><br><span class="line">        - è¿”å›å€¼ï¼š</span><br><span class="line">            - æˆåŠŸï¼Œè¿”å›å‘é€å˜åŒ–çš„æ–‡ä»¶æè¿°ç¬¦çš„ä¸ªæ•° &gt; <span class="number">0</span></span><br><span class="line">            - å¤±è´¥ <span class="number">-1</span></span><br></pre></td></tr></table></div></figure><h5 id="ä»£ç å’Œåˆ†æ"><a href="#ä»£ç å’Œåˆ†æ" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä»£ç å’Œåˆ†æ"></a> ä»£ç å’Œåˆ†æ</h5><p>è¿˜æ˜¯åªæ”¾server.cpp</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/epoll.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Client_Info.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_CLIENT_SIZE 1024</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_BUF_SIZE 1024</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¨å±€å­˜æ”¾å®¢æˆ·ç«¯è¿æ¥çš„IPå’Œç«¯å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Client_Info</span> cli_infos[MAX_CLIENT_SIZE];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Communicate</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> epoll_event &amp;_ret_event, <span class="type">const</span> <span class="type">int</span> &amp;_epoll_fd)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> _connect_fd = _ret_event.data.fd;</span><br><span class="line">    <span class="comment">// è¯»</span></span><br><span class="line">    <span class="type">char</span> buf[MAX_BUF_SIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">int</span> len = <span class="built_in">read</span>(_connect_fd, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == len) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;read&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;client (ip : %s , port : %d) recv : %s&quot;</span>, cli_infos[_connect_fd].client_ip, cli_infos[_connect_fd].client_port, buf);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == len) &#123;</span><br><span class="line">        <span class="comment">// å†™ç«¯ï¼Œå®¢æˆ·ç«¯å…³é—­è¿æ¥</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;client (ip : %s , port : %d) has closed...\n&quot;</span>, cli_infos[_connect_fd].client_ip, cli_infos[_connect_fd].client_port);</span><br><span class="line">        <span class="comment">// ä»æ£€æµ‹äº‹ä»¶ä¸­åˆ é™¤ä»–</span></span><br><span class="line">        <span class="built_in">epoll_ctl</span>(_epoll_fd, EPOLL_CTL_DEL, _connect_fd, <span class="literal">nullptr</span>);</span><br><span class="line">        <span class="comment">// å…³é—­æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">        <span class="built_in">close</span>(_connect_fd);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å†™</span></span><br><span class="line">    <span class="built_in">write</span>(_connect_fd, buf, <span class="built_in">strlen</span>(buf));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºsocketå¥—æ¥å­—</span></span><br><span class="line">    <span class="type">int</span> listen_fd = <span class="built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == listen_fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;socket&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®ç«¯å£å¤ç”¨</span></span><br><span class="line">    <span class="type">int</span> _optval = <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">setsockopt</span>(listen_fd, SOL_SOCKET, SO_REUSEPORT, &amp;_optval, <span class="built_in">sizeof</span>(_optval));</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;setsockopt&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.ç»‘å®šIPå’Œç«¯å£</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> server_addr;</span><br><span class="line">    <span class="comment">// åœ°å€æ—</span></span><br><span class="line">    server_addr.sin_family = AF_INET;</span><br><span class="line">    <span class="comment">// IP</span></span><br><span class="line">    server_addr.sin_addr.s_addr = INADDR_ANY;</span><br><span class="line">    <span class="comment">// ç«¯å£</span></span><br><span class="line">    server_addr.sin_port = <span class="built_in">htons</span>(<span class="number">9999</span>);</span><br><span class="line"></span><br><span class="line">    ret = <span class="built_in">bind</span>(listen_fd, (<span class="keyword">struct</span> sockaddr *)&amp;server_addr, <span class="built_in">sizeof</span>(server_addr));</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;bind&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.ç›‘å¬ç«¯å£</span></span><br><span class="line">    ret = <span class="built_in">listen</span>(listen_fd, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;listen&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;server has initialized.\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.ç”¨epollæŠ€æœ¯å®ç°æ¥å—å®¢æˆ·ç«¯å’Œè¿›è¡Œé€šä¿¡</span></span><br><span class="line">    <span class="comment">// åˆ›å»ºepollç¤ºä¾‹</span></span><br><span class="line">    <span class="type">int</span> epoll_fd = <span class="built_in">epoll_create</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == epoll_fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;epoll_create&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†ç›‘å¬å¥—æ¥å­—æ·»åŠ è¿›å…¥æ£€æµ‹ä¸­</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">epoll_event</span> listen_event;</span><br><span class="line">    listen_event.events = EPOLLIN;     <span class="comment">// æ£€æµ‹è¯»</span></span><br><span class="line">    listen_event.data.fd = listen_fd;  <span class="comment">// æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">epoll_ctl</span>(epoll_fd, EPOLL_CTL_ADD, listen_fd, &amp;listen_event);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> _maxevents = MAX_CLIENT_SIZE;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼€å§‹æ£€æµ‹</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// è¿™ä¸ªç»“æ„ä½“æ•°ç»„å­˜æ”¾äº†æ£€æµ‹åˆ°çš„æ–‡ä»¶æè¿°ç¬¦çš„ä¿¡æ¯ï¼Œä¿å­˜åœ¨è¿™é‡Œé¢</span></span><br><span class="line">        <span class="comment">// å†…æ ¸ä¸­æ˜¯æŠŠåŒé“¾è¡¨ä¸­çš„æ•°æ®å†™å…¥åˆ°è¿™é‡Œ</span></span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">epoll_event</span> ret_events[_maxevents];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿”å›å€¼æ˜¯è¡¨ç¤ºæœ‰å¤šå°‘ä¸ªè¢«æ£€æµ‹åˆ°äº†ï¼›ç¬¬ä¸‰ä¸ªå‚æ•°å¯ä»¥ä¸€èˆ¬æ”¾æ•°ç»„çš„æœ€å¤§å®¹é‡</span></span><br><span class="line">        <span class="type">int</span> ret = <span class="built_in">epoll_wait</span>(epoll_fd, ret_events, _maxevents, <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;epoll_wait&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ£€æµ‹åˆ°äº†ï¼Œå¼€å§‹å¤„ç†</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; ret; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ret_events[i].events &amp;&amp; EPOLLIN == EPOLLIN) &#123;</span><br><span class="line">                <span class="keyword">if</span> (ret_events[i].data.fd == listen_fd) &#123;</span><br><span class="line">                    <span class="comment">// è¡¨ç¤ºæœ‰æ–°å®¢æˆ·ç«¯è¿æ¥</span></span><br><span class="line">                    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> client_addr;</span><br><span class="line">                    <span class="type">socklen_t</span> client_addr_len = <span class="built_in">sizeof</span>(client_addr);</span><br><span class="line"></span><br><span class="line">                    <span class="type">int</span> connect_fd = <span class="built_in">accept</span>(listen_fd, (<span class="keyword">struct</span> sockaddr *)&amp;client_addr, &amp;client_addr_len);</span><br><span class="line">                    <span class="keyword">if</span> (<span class="number">-1</span> == connect_fd) &#123;</span><br><span class="line">                        <span class="built_in">perror</span>(<span class="string">&quot;accept&quot;</span>);</span><br><span class="line">                        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// è®¾ç½®readéé˜»å¡</span></span><br><span class="line">                    <span class="type">int</span> flag = <span class="built_in">fcntl</span>(connect_fd, F_GETFL);</span><br><span class="line">                    flag |= O_NONBLOCK;</span><br><span class="line">                    <span class="built_in">fcntl</span>(connect_fd, F_SETFL, flag);</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// å°†å®¢æˆ·ç«¯ä¿¡æ¯å­˜å…¥ç»“æ„ä½“æ•°ç»„ï¼Œä¸‹æ ‡ç”¨connect_fdä»£æ›¿</span></span><br><span class="line">                    <span class="built_in">inet_ntop</span>(AF_INET, &amp;client_addr.sin_addr.s_addr, cli_infos[connect_fd].client_ip, <span class="built_in">sizeof</span>(cli_infos[connect_fd].client_ip));</span><br><span class="line">                    cli_infos[connect_fd].client_port = <span class="built_in">ntohs</span>(client_addr.sin_port);</span><br><span class="line"></span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;client (ip : %s , port : %d) has connected...\n&quot;</span>, cli_infos[connect_fd].client_ip, cli_infos[connect_fd].client_port);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// æ·»åŠ åˆ°æ£€æµ‹ä¸­</span></span><br><span class="line">                    <span class="keyword">struct</span> <span class="title class_">epoll_event</span> connect_event;</span><br><span class="line">                    connect_event.data.fd = connect_fd;</span><br><span class="line">                    connect_event.events = EPOLLIN;</span><br><span class="line"></span><br><span class="line">                    <span class="built_in">epoll_ctl</span>(epoll_fd, EPOLL_CTL_ADD, connect_fd, &amp;connect_event);</span><br><span class="line">                &#125; <span class="keyword">else</span>  <span class="comment">// å®¢æˆ·ç«¯æ¥æ”¶åˆ°æ•°æ®</span></span><br><span class="line">                    <span class="built_in">Communicate</span>(ret_events[i], epoll_fd);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.å…³é—­è¿æ¥</span></span><br><span class="line">    <span class="built_in">close</span>(epoll_fd);</span><br><span class="line">    <span class="built_in">close</span>(listen_fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è¿™æ®µä»£ç çš„æ€è·¯å’Œå‰é¢çš„åŸºæœ¬æ²¡æœ‰åŒºåˆ«ï¼Œå°±æ˜¯å…ˆåˆ›å»ºepoll_create()çš„ç¤ºä¾‹ï¼Œç”±äºå†…æ ¸åŒºçš„æ•°æ®ç”¨æ–‡ä»¶æè¿°ç¬¦æ“ä½œ</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> epoll_fd = <span class="built_in">epoll_create</span>(<span class="number">1</span>);</span><br></pre></td></tr></table></div></figure><p>ç„¶åå°†ç›‘å¬å¥—æ¥å­—åŠ å…¥åˆ°æ£€æµ‹å½“ä¸­</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†ç›‘å¬å¥—æ¥å­—æ·»åŠ è¿›å…¥æ£€æµ‹ä¸­</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">epoll_event</span> listen_event;</span><br><span class="line">listen_event.events = EPOLLIN;     <span class="comment">// æ£€æµ‹è¯»</span></span><br><span class="line">listen_event.data.fd = listen_fd;  <span class="comment">// æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">epoll_ctl</span>(epoll_fd, EPOLL_CTL_ADD, listen_fd, &amp;listen_event);</span><br></pre></td></tr></table></div></figure><p>ç„¶åä¸æ–­å¾ªç¯ï¼Œè°ƒç”¨epoll_wait()æ¥å£æ£€æµ‹å“ªäº›å‘ç”Ÿäº†å˜åŒ–</p><p>æˆ‘ä»¬æ¥é‡ç‚¹å…³æ³¨ä¸‹è¿™ä¸ªæ¥å£çš„å‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯epollç¤ºä¾‹çš„æ–‡ä»¶æè¿°ç¬¦epoll_fdï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¿å­˜æ£€æµ‹åˆ°å‘ç”Ÿå˜åŒ–çš„ç»“æ„ä½“æ•°ç»„ï¼Œç±»å‹æ˜¯epoll_eventï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è¿™ä¸ªç»“æ„ä½“æ•°ç»„çš„æœ€å¤§å®¹é‡ï¼Œå¯ä»¥è‡ªå·±è®¾å®šï¼Œå› ä¸ºä¸€èˆ¬æ”¾ä¸æ»¡ï¼Œä»–ä¹Ÿæ˜¯ä»å¤´å¼€å§‹æ”¾æ‰€ä»¥æˆ‘ä»¬ç»™ä½ ä¸€ä¸ªæœ€å¤§çš„å€¼ _maxevents å°±è¡Œï¼Œç¬¬å››ä¸ªå‚æ•°æ˜¯é˜»å¡æ—¶é—´ï¼Œè¿™é‡Œè®¾ç½®-1è¡¨ç¤ºé˜»å¡</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">// è¿™ä¸ªç»“æ„ä½“æ•°ç»„å­˜æ”¾äº†æ£€æµ‹åˆ°çš„æ–‡ä»¶æè¿°ç¬¦çš„ä¿¡æ¯ï¼Œä¿å­˜åœ¨è¿™é‡Œé¢</span></span><br><span class="line">    <span class="comment">// å†…æ ¸ä¸­æ˜¯æŠŠåŒé“¾è¡¨ä¸­çš„æ•°æ®å†™å…¥åˆ°è¿™é‡Œ</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">epoll_event</span> ret_events[_maxevents];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›å€¼æ˜¯è¡¨ç¤ºæœ‰å¤šå°‘ä¸ªè¢«æ£€æµ‹åˆ°äº†ï¼›ç¬¬ä¸‰ä¸ªå‚æ•°å¯ä»¥ä¸€èˆ¬æ”¾æ•°ç»„çš„æœ€å¤§å®¹é‡</span></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">epoll_wait</span>(epoll_fd, ret_events, _maxevents, <span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;epoll_wait&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//åç»­ä»£ç </span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>ä¹‹åå°±æ˜¯åˆ†æ–°å®¢æˆ·ç«¯è¿æ¥å’Œå·²è¿æ¥å®¢æˆ·ç«¯å‘é€æ•°æ®äº†</p><p>ä»0éå†åˆ°epoll_wait()æ¥å£çš„è¿”å›å€¼ï¼Œå› ä¸ºè¿”å›çš„æ˜¯æ£€æµ‹åˆ°çš„ä¸ªæ•°ï¼Œåˆšå¥½å‘Šè¯‰æˆ‘äº†æˆ‘å°±ç”¨</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; ret; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (ret_events[i].events &amp;&amp; EPOLLIN == EPOLLIN) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ret_events[i].data.fd == listen_fd) &#123;</span><br><span class="line">            <span class="comment">// è¡¨ç¤ºæœ‰æ–°å®¢æˆ·ç«¯è¿æ¥</span></span><br><span class="line">            <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> client_addr;</span><br><span class="line">            <span class="type">socklen_t</span> client_addr_len = <span class="built_in">sizeof</span>(client_addr);</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> connect_fd = <span class="built_in">accept</span>(listen_fd, (<span class="keyword">struct</span> sockaddr *)&amp;client_addr, &amp;client_addr_len);</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">-1</span> == connect_fd) &#123;</span><br><span class="line">                <span class="built_in">perror</span>(<span class="string">&quot;accept&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å°†å®¢æˆ·ç«¯ä¿¡æ¯å­˜å…¥ç»“æ„ä½“æ•°ç»„ï¼Œä¸‹æ ‡ç”¨connect_fdä»£æ›¿</span></span><br><span class="line">            <span class="built_in">inet_ntop</span>(AF_INET, &amp;client_addr.sin_addr.s_addr, cli_infos[connect_fd].client_ip, <span class="built_in">sizeof</span>(cli_infos[connect_fd].client_ip));</span><br><span class="line">            cli_infos[connect_fd].client_port = <span class="built_in">ntohs</span>(client_addr.sin_port);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;client (ip : %s , port : %d) has connected...\n&quot;</span>, cli_infos[connect_fd].client_ip, cli_infos[connect_fd].client_port);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ·»åŠ åˆ°æ£€æµ‹ä¸­</span></span><br><span class="line">            <span class="keyword">struct</span> <span class="title class_">epoll_event</span> connect_event;</span><br><span class="line">            connect_event.data.fd = connect_fd;</span><br><span class="line">            connect_event.events = EPOLLIN;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">epoll_ctl</span>(epoll_fd, EPOLL_CTL_ADD, connect_fd, &amp;connect_event);</span><br><span class="line">        &#125; <span class="keyword">else</span>  <span class="comment">// å®¢æˆ·ç«¯æ¥æ”¶åˆ°æ•°æ®</span></span><br><span class="line">            <span class="built_in">Communicate</span>(ret_events[i], epoll_fd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>communicate()æ¥å£å’Œä¹‹å‰çš„æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œå°±é’ˆå¯¹ä¿®æ”¹äº†ä¸€ç‚¹ï¼Œæ³¨æ„è¿˜æ˜¯ä¸æ˜¯å¾ªç¯ï¼Œå› ä¸ºå‡ºå»äº†æˆ‘ä»¬èµ°ä¸‹ä¸€æ¬¡æ£€æµ‹ä¹Ÿæ˜¯ä¸€æ ·çš„</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Communicate</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> epoll_event &amp;_ret_event, <span class="type">const</span> <span class="type">int</span> &amp;_epoll_fd)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> _connect_fd = _ret_event.data.fd;</span><br><span class="line">    <span class="comment">// è¯»</span></span><br><span class="line">    <span class="type">char</span> buf[MAX_BUF_SIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">int</span> len = <span class="built_in">read</span>(_connect_fd, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == len) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;read&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;client (ip : %s , port : %d) recv : %s&quot;</span>, cli_infos[_connect_fd].client_ip, cli_infos[_connect_fd].client_port, buf);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == len) &#123;</span><br><span class="line">        <span class="comment">// å†™ç«¯ï¼Œå®¢æˆ·ç«¯å…³é—­è¿æ¥</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;client (ip : %s , port : %d) has closed...\n&quot;</span>, cli_infos[_connect_fd].client_ip, cli_infos[_connect_fd].client_port);</span><br><span class="line">        <span class="comment">// ä»æ£€æµ‹äº‹ä»¶ä¸­åˆ é™¤ä»–</span></span><br><span class="line">        <span class="built_in">epoll_ctl</span>(_epoll_fd, EPOLL_CTL_DEL, _connect_fd, <span class="literal">nullptr</span>);</span><br><span class="line">        <span class="comment">// å…³é—­æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">        <span class="built_in">close</span>(_connect_fd);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å†™</span></span><br><span class="line">    <span class="built_in">write</span>(_connect_fd, buf, <span class="built_in">strlen</span>(buf));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h5 id="epoll-çš„å·¥ä½œæ¨¡å¼"><a href="#epoll-çš„å·¥ä½œæ¨¡å¼" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#epoll-çš„å·¥ä½œæ¨¡å¼"></a> Epoll çš„å·¥ä½œæ¨¡å¼</h5><ul><li><blockquote><p><strong>LT æ¨¡å¼ ï¼ˆæ°´å¹³è§¦å‘ï¼‰</strong><br>å‡è®¾å§”æ‰˜å†…æ ¸æ£€æµ‹è¯»äº‹ä»¶ -&gt; æ£€æµ‹fdçš„è¯»ç¼“å†²åŒº<br>è¯»ç¼“å†²åŒºæœ‰æ•°æ® - &gt; epollæ£€æµ‹åˆ°äº†ä¼šç»™ç”¨æˆ·é€šçŸ¥<br>a.ç”¨æˆ·ä¸è¯»æ•°æ®ï¼Œæ•°æ®ä¸€ç›´åœ¨ç¼“å†²åŒºï¼Œepoll ä¼šä¸€ç›´é€šçŸ¥<br>b.ç”¨æˆ·åªè¯»äº†ä¸€éƒ¨åˆ†æ•°æ®ï¼Œepollä¼šé€šçŸ¥<br>c.ç¼“å†²åŒºçš„æ•°æ®è¯»å®Œäº†ï¼Œä¸é€šçŸ¥</p><p>**LTï¼ˆlevel - triggeredï¼‰æ˜¯ç¼ºçœçš„å·¥ä½œæ–¹å¼ï¼Œå¹¶ä¸”åŒæ—¶æ”¯æŒ block å’Œ no-block socketã€‚**åœ¨è¿™ ç§åšæ³•ä¸­ï¼Œå†…æ ¸å‘Šè¯‰ä½ ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ˜¯å¦å°±ç»ªäº†ï¼Œç„¶åä½ å¯ä»¥å¯¹è¿™ä¸ªå°±ç»ªçš„ fd è¿›è¡Œ IO æ“ä½œã€‚<strong>å¦‚æœä½ ä¸ä½œä»»ä½•æ“ä½œï¼Œå†…æ ¸è¿˜æ˜¯ä¼šç»§ç»­é€šçŸ¥ä½ çš„ã€‚</strong></p></blockquote></li><li><blockquote><p><strong>ET æ¨¡å¼ï¼ˆè¾¹æ²¿è§¦å‘ï¼‰</strong><br>å‡è®¾å§”æ‰˜å†…æ ¸æ£€æµ‹è¯»äº‹ä»¶ -&gt; æ£€æµ‹fdçš„è¯»ç¼“å†²åŒº<br>è¯»ç¼“å†²åŒºæœ‰æ•°æ® - &gt; epollæ£€æµ‹åˆ°äº†ä¼šç»™ç”¨æˆ·é€šçŸ¥<br>a.ç”¨æˆ·ä¸è¯»æ•°æ®ï¼Œæ•°æ®ä¸€è‡´åœ¨ç¼“å†²åŒºä¸­ï¼Œepollä¸‹æ¬¡æ£€æµ‹çš„æ—¶å€™å°±ä¸é€šçŸ¥äº†<br>b.ç”¨æˆ·åªè¯»äº†ä¸€éƒ¨åˆ†æ•°æ®ï¼Œepollä¸é€šçŸ¥<br>c.ç¼“å†²åŒºçš„æ•°æ®è¯»å®Œäº†ï¼Œä¸é€šçŸ¥</p><p>**ETï¼ˆedge - triggeredï¼‰æ˜¯é«˜é€Ÿå·¥ä½œæ–¹å¼ï¼Œåªæ”¯æŒ no-block socketã€‚**åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå½“æè¿°ç¬¦ä»æœªå°±ç»ªå˜ä¸ºå°±ç»ªæ—¶ï¼Œå†…æ ¸é€šè¿‡epollå‘Šè¯‰ä½ ã€‚ç„¶åå®ƒä¼šå‡è®¾ä½ çŸ¥é“æ–‡ä»¶æè¿°ç¬¦å·²ç»å°±ç»ªï¼Œ å¹¶ä¸”ä¸ä¼šå†ä¸ºé‚£ä¸ªæ–‡ä»¶æè¿°ç¬¦å‘é€æ›´å¤šçš„å°±ç»ªé€šçŸ¥ï¼Œç›´åˆ°ä½ åšäº†æŸäº›æ“ä½œå¯¼è‡´é‚£ä¸ªæ–‡ä»¶æè¿° ç¬¦ä¸å†ä¸ºå°±ç»ªçŠ¶æ€äº†ã€‚<strong>ä½†æ˜¯è¯·æ³¨æ„ï¼Œå¦‚æœä¸€ç›´ä¸å¯¹è¿™ä¸ª fd ä½œ IO æ“ä½œï¼ˆä»è€Œå¯¼è‡´å®ƒå†æ¬¡å˜æˆ æœªå°±ç»ªï¼‰ï¼Œå†…æ ¸ä¸ä¼šå‘é€æ›´å¤šçš„é€šçŸ¥ï¼ˆonly onceï¼‰</strong>ã€‚ <strong>ET æ¨¡å¼åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘äº† epoll äº‹ä»¶è¢«é‡å¤è§¦å‘çš„æ¬¡æ•°ï¼Œå› æ­¤æ•ˆç‡è¦æ¯” LT æ¨¡å¼é«˜ã€‚epoll å·¥ä½œåœ¨ ET æ¨¡å¼çš„æ—¶å€™ï¼Œå¿…é¡»ä½¿ç”¨éé˜»å¡å¥—æ¥å£ï¼Œä»¥é¿å…ç”±äºä¸€ä¸ªæ–‡ä»¶å¥æŸ„çš„é˜»å¡è¯»/é˜»å¡å†™æ“ä½œæŠŠå¤„ç†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦çš„ä»»åŠ¡é¥¿æ­»ã€‚</strong></p></blockquote></li></ul><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">epoll_event</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> events; <span class="comment">/* Epoll events */</span></span><br><span class="line">    <span class="type">epoll_data_t</span> data; <span class="comment">/* User data variable */</span></span><br><span class="line">&#125;;</span><br><span class="line">å¸¸è§çš„Epollæ£€æµ‹äº‹ä»¶ï¼š</span><br><span class="line">    - EPOLLIN</span><br><span class="line">    - EPOLLOUT</span><br><span class="line">    - EPOLLERR</span><br><span class="line">    - EPOLLET <span class="comment">//è®¾ç½®è¾¹æ²¿è§¦å‘ï¼ŒEpollæŠ€æœ¯é»˜è®¤çš„æ˜¯æ°´å¹³è§¦å‘ï¼Œä¹Ÿå°±æ˜¯åœ¨è¯»å®Œä¹‹å‰ä¸€ç›´é€šçŸ¥</span></span><br></pre></td></tr></table></div></figure><h5 id="ltæ¨¡å¼æ°´å¹³è§¦å‘"><a href="#ltæ¨¡å¼æ°´å¹³è§¦å‘" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ltæ¨¡å¼æ°´å¹³è§¦å‘"></a> LTæ¨¡å¼(æ°´å¹³è§¦å‘)</h5><p><strong>LTæ¨¡å¼æ˜¯æ£€æµ‹åˆ°æœ‰æ•°æ®ï¼Œå¦‚æœæˆ‘ä»¬ç”¨æˆ·ä¸è¯»æˆ–è€…æ²¡æœ‰è¯»å®Œï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡ä»æ—§ä¼šé€šçŸ¥ï¼Œä¹Ÿå°±æ˜¯æ£€æµ‹åˆ°ï¼Œç›´åˆ°ç¼“å†²åŒºçš„æ•°æ®è¯»å®Œäº†ä¹‹åæ‰åœæ­¢é€šçŸ¥</strong></p><p>åœ¨è¿™é‡Œæˆ‘ä»¬æŠŠç¼“å†²åŒºçš„æ•°ç»„å¤§å°å¼„å°ç‚¹</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æˆ‘å°†ä¸€æ¬¡è¯»å–çš„å¤§å°å¼„å°ç‚¹</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_BUF_SIZE 5</span></span><br></pre></td></tr></table></div></figure><p>ç„¶åæ•…æ„å¤šå†™ç‚¹æ•°æ®æ¥çœ‹çœ‹è¾“å‡ºç»“æœï¼š</p><p>å®¢æˆ·ç«¯</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822113418607.png" alt="image-20230822113418607"></p><p>æœåŠ¡ç«¯</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822113459363.png" alt="image-20230822113459363"></p><p><strong>æˆ‘ä»¬æ˜æ˜¾å¯ä»¥çœ‹å‡ºï¼Œç¼“å†²åŒºè°ƒå°ä¹‹åï¼Œä¸€æ¬¡è¯»ä¸å®Œï¼Œç„¶åå¾ªç¯ä¹‹åä»ç„¶èƒ½å¤Ÿæ£€æµ‹å¾—åˆ°ï¼Œç›´åˆ°å°†å…¶å…¨éƒ¨è¯»å®Œ</strong></p><p>ä½†æ˜¯å®¢æˆ·ç«¯ä¸ºä»€ä¹ˆç¬¬äºŒæ¬¡æœ‰ä¸€éƒ¨åˆ†æ•°æ®ç•™åœ¨ç¼“å†²åŒºä¸­æ²¡è¾“å‡ºå‡ºæ¥æˆ‘å°±ä¸çŸ¥é“äº†(è¿™ä¸ªçœŸä¸çŸ¥é“)</p><h5 id="etæ¨¡å¼è¾¹æ²¿è§¦å‘"><a href="#etæ¨¡å¼è¾¹æ²¿è§¦å‘" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#etæ¨¡å¼è¾¹æ²¿è§¦å‘"></a> ETæ¨¡å¼(è¾¹æ²¿è§¦å‘)</h5><p><strong>LTæ¨¡å¼å¾ªç¯æ¯æ¬¡éƒ½ä¼šè¢«å†…æ ¸æé†’ï¼Œè¿™æ ·çš„é‡å¤æé†’å¯¹èµ„æºè¿˜æ˜¯æœ‰å¾ˆå¤šçš„æµªè´¹çš„ï¼Œæ‰€ä»¥ETæ¨¡å¼å‡è®¾æˆ‘ä»¬å·²ç»çŸ¥é“è¿™ä¸ªæé†’äº†ï¼Œå¹¶ä¸”æ”¾åœ¨å¿ƒä¸Šï¼Œé©¬ä¸Šå°±å»å¤„ç†å®ƒï¼Œæ‰€ä»¥åç»­å†…æ ¸ä¸ä¼šæé†’ï¼Œè¿™å°±æ˜¯åŒºåˆ«ï¼Œä¹Ÿæ˜¯æå‡æ•ˆç‡çš„å…³é”®ã€‚å› æ­¤å¦‚ä½•è¯»å–åˆ°æ­£ç¡®å®Œæ•´çš„æ•°æ®å°±æˆäº†æˆ‘ä»¬çš„å…³é”®</strong></p><p>é¦–å…ˆæˆ‘ä»¬ç»™é€šä¿¡çš„æ–‡ä»¶æè¿°ç¬¦ connect_fd è®¾ç½®ETå±æ€§ï¼Œä¹Ÿå°±æ˜¯åŠ ä¸Š EPOLLET å®</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ·»åŠ åˆ°æ£€æµ‹ä¸­</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">epoll_event</span> connect_event;</span><br><span class="line">connect_event.data.fd = connect_fd;</span><br><span class="line">connect_event.events = EPOLLIN | EPOLLET;  <span class="comment">// è®¾ç½®è¾¹æ²¿è§¦å‘ï¼Œç»“åˆéé˜»å¡çš„APIä½¿ç”¨!!!</span></span><br></pre></td></tr></table></div></figure><p>æˆ‘ä»¬çš„é€šä¿¡å‡½æ•°ä¿æŒä¸å˜ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰å¾ªç¯æ“ä½œï¼Œå¹¶ä¸”read()å‡½æ•°é˜»å¡ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p>å®¢æˆ·ç«¯</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822114219505.png" alt="image-20230822114219505"></p><p>æœåŠ¡ç«¯</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822114228554.png" alt="image-20230822114228554"></p><p>å¯ä»¥çœ‹å‡ºåªè¯»å–äº†ä¸€æ¬¡ï¼Œåç»­å°±æ²¡æœ‰ä¸‹æ–‡äº†ï¼Œåªæœ‰å½“æˆ‘ç¬¬äºŒæ¬¡æ‰‹åŠ¨è®©å®¢æˆ·ç«¯æ£€æµ‹ï¼Œæ¯”å¦‚è¿™é‡Œæˆ‘è¾“å…¥å­—ç¬¦ï¼ŒæœåŠ¡ç«¯æ‰ä¼šç»§ç»­æ”¶åˆ°æ•°æ®ï¼Œæ³¨æ„ä¸Šæ¬¡é€šä¿¡æ²¡è¯»å®Œï¼Œæ•°æ®è¿˜åœ¨ç¼“å†²åŒºä¸­ï¼Œæ˜¯æ¥ç€ç¼“å†²åŒºè¯»çš„ï¼Œå¦‚ä¸‹ï¼š</p><p>å®¢æˆ·ç«¯</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822114407108.png" alt="image-20230822114407108"></p><p>æœåŠ¡ç«¯</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822114413347.png" alt="image-20230822114413347"></p><p>å¥½ï¼Œæ—¢ç„¶æƒ³åˆ°äº†è¯»ä¸å®Œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦å¾ªç¯è¯»ï¼Œä½†æ˜¯å¾ªç¯è¯»å¦‚æœé…ä¸Šé˜»å¡çš„read()å‡½æ•°ï¼Œè¯»å®Œäº†å°±ä¼šé˜»å¡åœ¨é‚£é‡Œï¼Œç¨‹åºå°±å°¬ä½äº†ï¼Œå…¶ä»–å·¥ä½œæ²¡åŠæ³•åšï¼Œè¿™ä¹Ÿæ˜¯å‰é¢æåˆ°çš„éœ€è¦ä½¿ç”¨éé˜»å¡non-blockçš„APIï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬éœ€è¦è®¾ç½®read()ä¸ºéé˜»å¡</p><p>è®¾ç½®read()ä¸ºéé˜»å¡éœ€è¦ä¾èµ–äºä»–çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè€Œå…³äºæ–‡ä»¶æè¿°ç¬¦æœ‰fcntl()å‡½æ•°å¯ä»¥è·å–æˆ–è€…è®¾ç½®ä¿¡æ¯</p><p><strong>æ³¨æ„çœ‹åˆ°è¿™äº›ä»€ä¹ˆå±æ€§æˆ–è€…æ ‡å¿—ä½ä¸ºint shortè¿™ç§æ•°å­—ç±»å‹ï¼Œç¬¬ä¸€ååº”æƒ³åˆ°ç”¨äºŒè¿›åˆ¶01è¡¨ç¤ºï¼Œå› ä¸ºè¿™æ ·æœ€çœç©ºé—´</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®éé˜»å¡ï¼Œå¦åˆ™è¯»å®Œå°±é˜»å¡åœ¨è¿™é‡Œï¼Œreadéé˜»å¡é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ“ä½œ</span></span><br><span class="line"><span class="type">int</span> _flag = <span class="built_in">fcntl</span>(connect_fd, F_GETFL);</span><br><span class="line">_flag |= O_NONBLOCK;  <span class="comment">// ä¸èƒ½æŠŠåŸæ¥çš„å±æ€§è®¾ç½®æ²¡äº†æ‰€ä»¥å…ˆè·å¾—</span></span><br><span class="line"><span class="built_in">fcntl</span>(connect_fd, F_SETFL, _flag);</span><br></pre></td></tr></table></div></figure><p>ç´§æ¥ç€æˆ‘ä»¬ä¹Ÿéœ€è¦ä¿®æ”¹æˆ‘ä»¬çš„é€šä¿¡å‡½æ•°</p><p>å…¶ä»–åœ°æ–¹åŸºæœ¬æ²¡ä»€ä¹ˆå˜åŒ–ï¼Œè¦æ³¨æ„ä¸€ç‚¹ï¼š</p><p><strong>å½“æˆ‘ç¼“å†²åŒºçš„æ•°æ®è¯»å®Œäº†ï¼Œä½†æ˜¯å†™ç«¯æ²¡å…³é—­æ€ä¹ˆåŠï¼Ÿå› ä¸ºæˆ‘ä»¬çŸ¥é“å†™ç«¯å…³é—­äº†è¿”å›0ï¼Œé‚£è¿™é‡Œè¿”å›ä»€ä¹ˆå‘¢ï¼Ÿ</strong></p><p><strong>æˆ‘ä»¬æŸ¥çœ‹äº†manæ–‡æ¡£çŸ¥é“è¿”å›-1ï¼Œå¹¶ä¸”errnoä¼šè¢«è®¾ç½®ä¸ºEAGAINï¼Œè¿™å°±æ˜¯éé˜»å¡æƒ…å†µä¸‹read()å‡½æ•°æ•°æ®è¯»å®Œäº†çš„è¿”å›</strong></p><p><strong>å’Œä¹‹å‰accept()å‡½æ•°åœ¨è¢«è½¯ä¸­æ–­ï¼Œä¿¡å·å¤„ç†å›æ”¶å­è¿›ç¨‹ä¹‹åå˜æˆéé˜»å¡ï¼Œè¿”å›-1ï¼Œè®¾ç½®errnoä¸ºEINTRæœ‰ç‚¹ç±»ä¼¼</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Communicate</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> epoll_event &amp;_ret_event, <span class="type">const</span> <span class="type">int</span> &amp;_epoll_fd)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> _connect_fd = _ret_event.data.fd;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ETå·¥ä½œæ¨¡å¼ä¸ä¼šé€šçŸ¥ç¬¬äºŒæ¬¡ï¼Œåªæœ‰å†æ¬¡å˜åŒ–çš„æ—¶å€™æ‰ä¼šæ£€æµ‹åˆ°ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è°ƒç”¨éé˜»å¡çš„æ¥å£æŠŠæ•°æ®è¯»å®Œ</span></span><br><span class="line">    <span class="type">char</span> buf[MAX_BUF_SIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">int</span> len = <span class="built_in">read</span>(_connect_fd, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="number">-1</span> == len) &#123;</span><br><span class="line">            <span class="comment">// é‡Œé¢æœ‰ä¸€ç§æƒ…å†µå°±æ˜¯æˆ‘å†™ç«¯æ²¡æœ‰å…³é—­ä½†æ˜¯æˆ‘åœ¨éé˜»å¡çš„æƒ…å†µä¸‹å·²ç»æŠŠæ•°æ®è¯»å®Œäº†ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šäº§ç”ŸEAGAINçš„é”™è¯¯</span></span><br><span class="line">            <span class="keyword">if</span> (errno == EAGAIN) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;read data over.\n&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;read&quot;</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¯»åˆ°æ­£ç¡®æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> (len &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;client (ip : %s , port : %d) recv : %s\n&quot;</span>, cli_infos[_connect_fd].client_ip, cli_infos[_connect_fd].client_port, buf);</span><br><span class="line">            <span class="built_in">write</span>(_connect_fd, buf, <span class="built_in">strlen</span>(buf));</span><br><span class="line">            <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == len) &#123;</span><br><span class="line">            <span class="comment">// å†™ç«¯ï¼Œå®¢æˆ·ç«¯å…³é—­è¿æ¥</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;client (ip : %s , port : %d) has closed...\n&quot;</span>, cli_infos[_connect_fd].client_ip, cli_infos[_connect_fd].client_port);</span><br><span class="line">            <span class="comment">// ä»æ£€æµ‹äº‹ä»¶ä¸­åˆ é™¤ä»–</span></span><br><span class="line">            <span class="built_in">epoll_ctl</span>(_epoll_fd, EPOLL_CTL_DEL, _connect_fd, <span class="literal">nullptr</span>);</span><br><span class="line">            <span class="comment">// å…³é—­æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">            <span class="built_in">close</span>(_connect_fd);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æœ€ç»ˆæˆ‘ä»¬çš„ç¨‹åºè¿è¡Œç»“æœå°±æ˜¯è¿™æ ·ï¼š</p><p>å®¢æˆ·ç«¯</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822115230225.png" alt="image-20230822115230225"></p><p>æœåŠ¡ç«¯</p><p>å¯ä»¥çœ‹å‡ºæˆ‘åšçš„ç‰¹æ®Šåˆ¤æ–­ä¹Ÿè¢«æ‰“å°å‡ºæ¥äº†</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822115243021.png" alt="image-20230822115243021"></p><p>è¿™ä¸ªç¨‹åºåº”è¯¥è¿˜æœ‰å°bugï¼Œä½†æ˜¯å¤§ä½“é€»è¾‘æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œè¿™ä¸ªæˆ‘å°±å°šä¸çŸ¥é“äº†</p><h2 id="udp"><a href="#udp" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#udp"></a> UDP</h2><h3 id="udpé€šä¿¡"><a href="#udpé€šä¿¡" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#udpé€šä¿¡"></a> UDPé€šä¿¡</h3><p><strong>ç›¸æ¯”äºTCPï¼ŒUDPçš„é€šä¿¡å°±éå¸¸ç®€å•äº†ï¼ŒTCPçš„æœåŠ¡ç«¯éœ€è¦åˆ›å»ºç›‘å¬çš„å¥—æ¥å­—ç”¨äºç›‘å¬å»ºç«‹è¿æ¥ï¼Œå®¢æˆ·ç«¯éœ€è¦ä½¿ç”¨connect()å’ŒæœåŠ¡ç«¯å»ºç«‹è¿æ¥ï¼›è€ŒUDPåˆ›å»ºäº†ç”¨äºé€šä¿¡çš„æ–‡ä»¶æè¿°ç¬¦åç›´æ¥é€šä¿¡å³å¯ï¼Œæ³¨æ„æœåŠ¡ç«¯è¿˜æ˜¯è¦ç»‘å®šbind()IPå’Œç«¯å£</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822145319237.png" alt="image-20230822145319237"></p><p><strong>åœ¨UDPä¸­ç³»ç»Ÿä¸“é—¨ç»™æˆ‘ä»¬æä¾›äº†æ¥å£å« sendto() å’Œ recvfrom() ï¼›åŒæ ·çš„åœ¨TCPå½“ä¸­ï¼Œæˆ‘ä»¬ä¹‹å‰ä¸€ç›´ä½¿ç”¨çš„æ˜¯read()å’Œwrite()æ¥æ“ä½œé€šä¿¡çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ²¡é—®é¢˜ï¼Œä½†æ˜¯ç³»ç»Ÿå½“ç„¶ä¹Ÿæä¾›äº†ä¸“é—¨çš„APIï¼Œå« send() å’Œ recv()</strong></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">ssize_t</span> <span class="title">sendto</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> <span class="type">void</span> *buf, <span class="type">size_t</span> len, <span class="type">int</span> flags,</span></span></span><br><span class="line"><span class="params"><span class="function">               <span class="type">const</span> <span class="keyword">struct</span> sockaddr *dest_addr, <span class="type">socklen_t</span> addrlen)</span></span>;</span><br><span class="line">    - å‚æ•°ï¼š</span><br><span class="line">        - sockfd : é€šä¿¡çš„fd</span><br><span class="line">        - buf : è¦å‘é€çš„æ•°æ®</span><br><span class="line">        - len : å‘é€æ•°æ®çš„é•¿åº¦</span><br><span class="line">        - flags : <span class="number">0</span>ï¼Œæ ‡å¿—ï¼Œæ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œæˆ‘ä»¬è®¾ç½®ä¸º<span class="number">0</span>å°±å¯ä»¥äº†</span><br><span class="line">        - dest_addr : é€šä¿¡çš„å¦å¤–ä¸€ç«¯çš„åœ°å€ä¿¡æ¯ï¼Œéœ€è¦æŒ‡å®šï¼Œå› ä¸ºæ²¡æœ‰å»ºç«‹è¿æ¥ä¸ç»™ä¸çŸ¥é“ç»™è°å‘</span><br><span class="line">        - addrlen : åœ°å€çš„å†…å­˜å¤§å°</span><br><span class="line">            </span><br><span class="line"><span class="function"><span class="type">ssize_t</span> <span class="title">recvfrom</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">void</span> *buf, <span class="type">size_t</span> len, <span class="type">int</span> flags, </span></span></span><br><span class="line"><span class="params"><span class="function">                 <span class="keyword">struct</span> sockaddr *src_addr, <span class="type">socklen_t</span> *addrlen)</span></span>;</span><br><span class="line">    - å‚æ•°ï¼š</span><br><span class="line">        - sockfd : é€šä¿¡çš„fd</span><br><span class="line">        - buf : æ¥æ”¶æ•°æ®çš„æ•°ç»„</span><br><span class="line">        - len : æ•°ç»„çš„å¤§å°</span><br><span class="line">        - flags : <span class="number">0</span></span><br><span class="line">        - src_addr : ç”¨æ¥ä¿å­˜å¦å¤–ä¸€ç«¯çš„åœ°å€ä¿¡æ¯ï¼Œä¸éœ€è¦å¯ä»¥æŒ‡å®šä¸º<span class="literal">NULL</span></span><br><span class="line">        - addrlen : åœ°å€çš„å†…å­˜å¤§å°</span><br></pre></td></tr></table></div></figure><h4 id="ä»£ç -3"><a href="#ä»£ç -3" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä»£ç -3"></a> ä»£ç </h4><p>å¤§ä½“æ¡†æ¶æ²¡æœ‰å˜ï¼Œæ³¨æ„UDPä¸­æ²¡æœ‰å»ºç«‹è¿æ¥è¿™ä¸ªæ¦‚å¿µ</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_BUF_SIZE 1024</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_IPV4_STRING 16</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºé€šä¿¡çš„socketå¥—æ¥å­—</span></span><br><span class="line">    <span class="type">int</span> socket_fd = <span class="built_in">socket</span>(AF_INET, SOCK_DGRAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == socket_fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;socket&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.ç»‘å®šIPå’Œç«¯å£</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> server_addr;</span><br><span class="line">    <span class="comment">// åœ°å€æ—</span></span><br><span class="line">    server_addr.sin_family = AF_INET;</span><br><span class="line">    <span class="comment">// IP</span></span><br><span class="line">    server_addr.sin_addr.s_addr = INADDR_ANY;</span><br><span class="line">    <span class="comment">// ç«¯å£</span></span><br><span class="line">    server_addr.sin_port = <span class="built_in">htons</span>(<span class="number">9999</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">bind</span>(socket_fd, (<span class="keyword">struct</span> sockaddr*)&amp;server_addr, <span class="built_in">sizeof</span>(server_addr));</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == socket_fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;bind&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;server has initialized.\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> buf[MAX_BUF_SIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.å¼€å§‹é€šä¿¡</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> client_addr;</span><br><span class="line">        <span class="type">socklen_t</span> client_addr_len = <span class="built_in">sizeof</span>(client_addr);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¯»</span></span><br><span class="line">        <span class="type">int</span> len = <span class="built_in">recvfrom</span>(socket_fd, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>, <span class="number">0</span>, (<span class="keyword">struct</span> sockaddr*)&amp;client_addr, &amp;client_addr_len);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">-1</span> == len) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;recvfrom&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è·å¾—å®¢æˆ·ç«¯ä¿¡æ¯</span></span><br><span class="line">        <span class="type">char</span> client_ip[MAX_IPV4_STRING] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="built_in">inet_ntop</span>(AF_INET, &amp;client_addr.sin_addr.s_addr, client_ip, <span class="built_in">sizeof</span>(client_ip));</span><br><span class="line">        <span class="type">in_port_t</span> client_port = <span class="built_in">ntohs</span>(client_addr.sin_port);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// recvfromè¿”å›0æ˜¯å¯ä»¥æ¥å—çš„ï¼Œä¸åƒreadè¿”å›0è¡¨ç¤ºå¯¹ç«¯å…³é—­è¿æ¥ã€‚å› ä¸ºUDPæ˜¯æ— è¿æ¥çš„ï¼Œä¹Ÿå°±æ²¡æœ‰æ‰€è°“çš„å…³é—­ã€‚</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;recv client (ip : %s , port : %d) : %s&quot;</span>, client_ip, client_port, buf);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å†™</span></span><br><span class="line">        <span class="built_in">sendto</span>(socket_fd, buf, <span class="built_in">strlen</span>(buf), <span class="number">0</span>, (<span class="keyword">struct</span> sockaddr*)&amp;client_addr, client_addr_len);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.å…³é—­å¥—æ¥å­—</span></span><br><span class="line">    <span class="built_in">close</span>(socket_fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// client.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_BUF_SIZE 1024</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_IPV4_STRING 16</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºé€šä¿¡çš„socketå¥—æ¥å­—</span></span><br><span class="line">    <span class="type">int</span> socket_fd = <span class="built_in">socket</span>(AF_INET, SOCK_DGRAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == socket_fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;socket&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å­˜å‚¨æœåŠ¡ç«¯åœ°å€ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> server_addr;</span><br><span class="line">    <span class="comment">// åœ°å€æ—</span></span><br><span class="line">    server_addr.sin_family = AF_INET;</span><br><span class="line">    <span class="comment">// IP</span></span><br><span class="line">    <span class="built_in">inet_pton</span>(AF_INET, <span class="string">&quot;127.0.0.2&quot;</span>, &amp;server_addr.sin_addr.s_addr);</span><br><span class="line">    <span class="comment">// ç«¯å£</span></span><br><span class="line">    server_addr.sin_port = <span class="built_in">htons</span>(<span class="number">9999</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> buf[MAX_BUF_SIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> num = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.å¼€å§‹é€šä¿¡</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// å†™</span></span><br><span class="line">        <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">        <span class="built_in">sprintf</span>(buf, <span class="string">&quot;hello i am client , %d\n&quot;</span>, num++);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;send : %s&quot;</span>, buf);</span><br><span class="line">        <span class="built_in">sendto</span>(socket_fd, buf, <span class="built_in">strlen</span>(buf), <span class="number">0</span>, (<span class="keyword">struct</span> sockaddr*)&amp;server_addr, <span class="built_in">sizeof</span>(server_addr));</span><br><span class="line"></span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¯»</span></span><br><span class="line">        <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> len = <span class="built_in">recvfrom</span>(socket_fd, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>, <span class="number">0</span>, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">-1</span> == len) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;recvfrom&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// recvfromè¿”å›0æ˜¯å¯ä»¥æ¥å—çš„ï¼Œä¸åƒreadè¿”å›0è¡¨ç¤ºå¯¹ç«¯å…³é—­è¿æ¥ã€‚å› ä¸ºUDPæ˜¯æ— è¿æ¥çš„ï¼Œä¹Ÿå°±æ²¡æœ‰æ‰€è°“çš„å…³é—­ã€‚</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;recv : %s&quot;</span>, buf);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.å…³é—­å¥—æ¥å­—</span></span><br><span class="line">    <span class="built_in">close</span>(socket_fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h5 id="æ³¨æ„-3"><a href="#æ³¨æ„-3" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ³¨æ„-3"></a> æ³¨æ„</h5><ul><li><p><strong>recvfrom() å‡½æ•°çš„å‚æ•°ï¼Œåé¢ä¸¤é¡¹æ˜¯å¯ä»¥é€‰æ‹©æ¥å—å¯¹æ–¹çš„ä¿¡æ¯ï¼Œå¯ä»¥è·å¾—å¯¹æ–¹çš„socketåœ°å€ä¿¡æ¯ï¼Œä¸è¦å°±ä¼ nullptrå°±å¯ä»¥äº†</strong></p></li><li><p><strong>sendto() å‡½æ•°çš„å‚æ•°ï¼Œæœ€åä¸¤é¡¹ä¹Ÿæ˜¯å¯¹æ–¹çš„ä¿¡æ¯ï¼Œè¿™æ˜¯å¿…é¡»è¦ç»™çš„ï¼Œå› ä¸ºTCPæ²¡æœ‰å»ºç«‹è¿æ¥åŒäºé€šä¿¡çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰€ä»¥å¿…é¡»è¦ç»™å‡ºå¯¹æ–¹çš„ä¿¡æ¯æ‰å¯èƒ½æ­£ç¡®å‘åˆ°ï¼›ç”±æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥æ¨å‡ºæˆ‘ä»¬çš„è¿™ä¸ª sockfd å¯ä»¥å’Œå¾ˆå¤šå®¢æˆ·ç«¯è¿æ¥ï¼Œå› æ­¤UDPä¸ç”¨å¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹ä¹Ÿå¯ä»¥å®ç°ï¼Œç»“æœç±»ä¼¼å¦‚ä¸‹ï¼š</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822154224472.png" alt="image-20230822154224472"></p></li><li><p><strong>recvfrom è¿”å›0æ˜¯å¯ä»¥æ¥å—çš„ï¼Œä¸åƒreadè¿”å›0è¡¨ç¤ºå¯¹ç«¯å…³é—­è¿æ¥ã€‚å› ä¸ºUDPæ˜¯æ— è¿æ¥çš„ï¼Œä¹Ÿå°±æ²¡æœ‰æ‰€è°“çš„å…³é—­ã€‚æˆ‘ä»¬çš„ç¨‹åºåœ¨å¦ä¸€æ–¹æ–­å¼€ä¹‹åä¼šå¡ä½ï¼Œè¿™é‡Œæˆ‘å°šä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œåº”è¯¥æ˜¯recvfrom() å†…æ ¸é‡Œé¢çš„è®¾è®¡äº†ï¼›æˆ‘ä»¬æ€»ä¹‹çŸ¥é“ UDP æä¾›çš„ recvfrom() å‡½æ•°è¿”å›0æ˜¯åˆæ³•çš„</strong></p></li><li><p>å¦å¤–ï¼Œæˆ‘æƒ³è°ˆè°ˆå…³äºTCPå’ŒUDPåŒæ–¹çš„æ–‡ä»¶æè¿°ç¬¦ï¼ŒTCPé‡Œé¢å°±æ˜¯connect_fdï¼ŒUDPé‡Œé¢å°±æ˜¯socket_fd<br>æˆ‘ä»¬é€šè¿‡ç¨‹åºæŸ¥çœ‹æ˜¯å¦ç›¸åŒï¼Œé¦–å…ˆæ˜¯TCPï¼š</p><p>æœåŠ¡ç«¯<br><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822155038817.png" alt="image-20230822155038817"></p><p>å®¢æˆ·ç«¯<br><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822155057787.png" alt="image-20230822155057787"></p><p><strong>ä»–ä»¬æ˜¯ä¸ç›¸åŒçš„ï¼Œå¦‚ä½•ç†è§£ï¼Ÿ</strong><br><strong>è¿™æ˜¯ä¸¤ä¸ªè¿›ç¨‹ï¼ŒTCPçš„3å·æ–‡ä»¶æè¿°ç¬¦ç”¨åœ¨äº†ç›‘å¬ï¼Œ4å·ç”¨æ¥å’Œå®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡ï¼Œå®¢æˆ·ç«¯ä¹Ÿå…·æœ‰è‡ªå·±çš„æ–‡ä»¶æè¿°ç¬¦è¡¨ï¼Œç”¨çš„è‡ªç„¶å°±æ˜¯3å·æ–‡ä»¶æè¿°ç¬¦</strong></p><p>ç„¶åæ˜¯UDPï¼š</p><p>æœåŠ¡ç«¯<br><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822155443323.png" alt="image-20230822155443323"></p><p>å®¢æˆ·ç«¯<br><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822155501635.png" alt="image-20230822155501635"></p><p><strong>ä¸¤ä¸ªè¿›ç¨‹éƒ½åªå»ºç«‹äº†ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰€ä»¥å½“ç„¶å„è‡ªè¿›ç¨‹éƒ½ç”¨è‡ªå·±æœ€å°å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦å°±æ˜¯3å•Šï¼Œè¿™ä¸ªè·Ÿæ–‡ä»¶æè¿°ç¬¦å¼•ç”¨è®¡æ•°æ²¡å…³ç³»ï¼Œå‰ææ˜¯éœ€è¦æ˜¯åŒä¸€ä¸ªè¿›ç¨‹ï¼Œå¹¶ä¸”socketå¥—æ¥å­—æŒ‡å‘çš„ä¸œè¥¿è¿˜æ˜¯ä¸€æ ·çš„</strong></p></li></ul><h3 id="å¹¿æ’­å’Œç»„æ’­"><a href="#å¹¿æ’­å’Œç»„æ’­" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å¹¿æ’­å’Œç»„æ’­"></a> å¹¿æ’­å’Œç»„æ’­</h3><p><strong>å¹¿æ’­å’Œå¤šæ’­å°±æ˜¯å‘é€æ–¹å‘å¤šä¸ªæ¥æ”¶æ–¹çš„ä¸»æœºå‘é€æ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯ä¸€å¯¹å¤šï¼Œå¹¿æ’­æ˜¯ç»™æ‰€æœ‰çš„ä¸»æœºå‘é€æ¶ˆæ¯ï¼Œåªèƒ½ç”¨åœ¨å±€åŸŸç½‘ä¸­ï¼›å¤šæ’­æ˜¯ç»™ä¸€ä¸ªå¤šæ’­ç»„ä¸­çš„æ‰€æœ‰ä¸»æœºå‘é€æ¶ˆæ¯ï¼Œæ—¢å¯ä»¥ç”¨äºå¹¿åŸŸç½‘ï¼Œä¹Ÿå¯ä»¥ç”¨äºå±€åŸŸç½‘ï¼›ç”±äºéƒ½æ˜¯ä¸€å¯¹å¤šï¼Œæ‰€ä»¥TCPçš„ç«¯å¯¹ç«¯çš„å•æ’­åè®®æ˜æ˜¾ä¸é€‚ç”¨ï¼Œè€Œåªèƒ½ç”¨æ— è¿æ¥ä¸å¯é çš„UDPåè®®</strong></p><h4 id="å¹¿æ’­"><a href="#å¹¿æ’­" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å¹¿æ’­"></a> å¹¿æ’­</h4><p>å‘å­ç½‘ä¸­å¤šå°è®¡ç®—æœºå‘é€æ¶ˆæ¯ï¼Œå¹¶ä¸”å­ç½‘ä¸­æ‰€æœ‰çš„è®¡ç®—æœºéƒ½å¯ä»¥æ¥æ”¶åˆ°å‘é€æ–¹å‘é€çš„æ¶ˆæ¯ï¼Œæ¯ä¸ªå¹¿æ’­æ¶ˆæ¯éƒ½åŒ…å«ä¸€ä¸ªç‰¹æ®Šçš„IPåœ°å€ï¼Œè¿™ä¸ªIPä¸­å­ç½‘å†…ä¸»æœºæ ‡å¿—éƒ¨åˆ†çš„äºŒè¿›åˆ¶å…¨éƒ¨ä¸º1ã€‚</p><p>a.åªèƒ½åœ¨å±€åŸŸç½‘ä¸­ä½¿ç”¨ã€‚</p><p>b.å®¢æˆ·ç«¯éœ€è¦ç»‘å®šæœåŠ¡å™¨å¹¿æ’­ä½¿ç”¨çš„ç«¯å£ï¼Œæ‰å¯ä»¥æ¥æ”¶åˆ°å¹¿æ’­æ¶ˆæ¯ã€‚</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822160604851.png" alt="image-20230822160604851" style="zoom:67%"><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®å¹¿æ’­å±æ€§çš„å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">setsockopt</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">int</span> level, <span class="type">int</span> optname,<span class="type">const</span> <span class="type">void</span> *optval, <span class="type">socklen_t</span> optlen)</span></span>;</span><br><span class="line">    - sockfd : æ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">    - level : SOL_SOCKET</span><br><span class="line">    - optname : SO_BROADCAST</span><br><span class="line">    - optval : <span class="type">int</span>ç±»å‹çš„å€¼ï¼Œä¸º<span class="number">1</span>è¡¨ç¤ºå…è®¸å¹¿æ’­</span><br><span class="line">    - optlen : optvalçš„å¤§å°</span><br></pre></td></tr></table></div></figure><h5 id="ä»£ç æœ‰ä¸€å¤„ä¸æ˜ç™½"><a href="#ä»£ç æœ‰ä¸€å¤„ä¸æ˜ç™½" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä»£ç æœ‰ä¸€å¤„ä¸æ˜ç™½"></a> ä»£ç (æœ‰ä¸€å¤„ä¸æ˜ç™½)</h5><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_BUF_SIZE 1024</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_IPV4_STRING 16</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¹¿æ’­çš„IPåœ°å€</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* Broadcast_IP = <span class="string">&quot;127.255.255.255&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºé€šä¿¡çš„socketå¥—æ¥å­—</span></span><br><span class="line">    <span class="type">int</span> socket_fd = <span class="built_in">socket</span>(AF_INET, SOCK_DGRAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == socket_fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;socket&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼€å¯å¹¿æ’­è®¾ç½®</span></span><br><span class="line">    <span class="type">int</span> _optval = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">setsockopt</span>(socket_fd, SOL_SOCKET, SO_BROADCAST, &amp;_optval, <span class="built_in">sizeof</span>(_optval));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.ç»‘å®šIPå’Œç«¯å£ï¼Œå…¶å®åœ¨è¿™é‡Œæˆ‘ä»¬ä¸æ¥å—æ•°æ®ï¼Œå¸®ä¸ç»‘å®šå…¶å®æ— æ‰€è°“</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> server_addr;</span><br><span class="line">    <span class="comment">// åœ°å€æ—</span></span><br><span class="line">    server_addr.sin_family = AF_INET;</span><br><span class="line">    <span class="comment">// IP</span></span><br><span class="line">    <span class="built_in">inet_pton</span>(AF_INET, <span class="string">&quot;127.0.0.1&quot;</span>, &amp;server_addr.sin_addr.s_addr);</span><br><span class="line">    <span class="comment">// ç«¯å£</span></span><br><span class="line">    server_addr.sin_port = <span class="built_in">htons</span>(<span class="number">9999</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">bind</span>(socket_fd, (<span class="keyword">struct</span> sockaddr*)&amp;server_addr, <span class="built_in">sizeof</span>(server_addr));</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == socket_fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;bind&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;server has initialized.\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°è£…å¹¿æ’­å®¢æˆ·ç«¯çš„socketåœ°å€</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> All_Client_addr;</span><br><span class="line">    All_Client_addr.sin_family = AF_INET;</span><br><span class="line">    All_Client_addr.sin_port = <span class="built_in">htons</span>(<span class="number">10000</span>);</span><br><span class="line">    <span class="built_in">inet_pton</span>(AF_INET, Broadcast_IP, &amp;All_Client_addr.sin_addr.s_addr);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.å¼€å§‹é€šä¿¡</span></span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> num = <span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> buf[MAX_BUF_SIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// æœåŠ¡ç«¯å‘æ‰€æœ‰çš„å®¢æˆ·ç«¯å¹¿æ’­æ•°æ®</span></span><br><span class="line">        <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">        <span class="built_in">sprintf</span>(buf, <span class="string">&quot;hello , i am server , num = %d\n&quot;</span>, num++);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;send : %s&quot;</span>, buf);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">sendto</span>(socket_fd, buf, <span class="built_in">strlen</span>(buf), <span class="number">0</span>, (<span class="keyword">struct</span> sockaddr*)&amp;All_Client_addr, <span class="built_in">sizeof</span>(All_Client_addr));</span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.å…³é—­å¥—æ¥å­—</span></span><br><span class="line">    <span class="built_in">close</span>(socket_fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// client.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_BUF_SIZE 1024</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_IPV4_STRING 16</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºé€šä¿¡çš„socketå¥—æ¥å­—</span></span><br><span class="line">    <span class="type">int</span> socket_fd = <span class="built_in">socket</span>(AF_INET, SOCK_DGRAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == socket_fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;socket&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.ç»‘å®šç«¯å£ä¿¡æ¯ï¼Œè®©å‘é€æ–¹èƒ½å¤Ÿæ­£ç¡®æ‰¾åˆ°</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> client_addr;</span><br><span class="line">    <span class="comment">// åœ°å€æ—</span></span><br><span class="line">    client_addr.sin_family = AF_INET;</span><br><span class="line">    <span class="comment">// IP</span></span><br><span class="line">    <span class="comment">// inet_pton(AF_INET, &quot;127.0.0.2&quot;, &amp;client_addr.sin_addr.s_addr);  // è¿™è¡Œä»£ç ä¼šå‡ºé—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆ</span></span><br><span class="line">    client_addr.sin_addr.s_addr = INADDR_ANY;</span><br><span class="line">    <span class="comment">// ç«¯å£</span></span><br><span class="line">    client_addr.sin_port = <span class="built_in">htons</span>(<span class="number">10000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">bind</span>(socket_fd, (<span class="keyword">struct</span> sockaddr*)&amp;client_addr, <span class="built_in">sizeof</span>(client_addr));</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;bind&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> buf[MAX_BUF_SIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.å¼€å§‹é€šä¿¡</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// è¯»æ•°æ®</span></span><br><span class="line">        <span class="built_in">recvfrom</span>(socket_fd, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>, <span class="number">0</span>, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;recv : %s&quot;</span>, buf);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.å…³é—­å¥—æ¥å­—</span></span><br><span class="line">    <span class="built_in">close</span>(socket_fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æˆ‘ä»¬çš„ä»£ç éœ€è¦åšçš„åŠŸèƒ½æ˜¯æœåŠ¡ç«¯å¯åŠ¨åï¼Œå³å¯å¼€å§‹å‘å±€åŸŸç½‘å†…çš„æ‰€æœ‰ä¸»æœºå¹¿æ’­ä¿¡æ¯ï¼Œå½“æœ‰å®¢æˆ·ç«¯è¿æ¥è¿›æ¥çš„æ—¶å€™å¯ä»¥æ”¶åˆ°å®¢æˆ·ç«¯çš„ä¿¡æ¯</p><p><strong>æˆ‘ä»¬å…ˆæ¥è§£é‡Šbind()å‡½æ•°ï¼Œä¸ºä»€ä¹ˆè¿™é‡ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½ä½¿ç”¨äº†bind()ï¼Ÿ</strong></p><p><strong>bind()å‡½æ•°å¯ä»¥ç»™æˆ‘ä»¬socket()åˆ›å»ºå‡ºæ¥çš„æ–‡ä»¶æè¿°ç¬¦ç»‘å®šæˆ‘ä»¬è‡ªå·±è®¾å®šçš„IPå’Œç«¯å£ä¿¡æ¯ï¼Œæ¯”å¦‚è¿™é‡Œæˆ‘å°±ç»™æœåŠ¡ç«¯ç»‘å®šäº†&quot;127.0.0.1&quot;å’Œ9999çš„ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯ç»‘å®šäº†ä»»æ„IP(å±€åŸŸç½‘å†…)å’Œ10000ç«¯å£ï¼ŒIPæ˜¯æ¬¡è¦çš„ï¼Œbind()å‡½æ•°ç»‘å®šsocketçš„æ—¶å€™åº”è¯¥é¦–å…ˆè€ƒè™‘åˆ°ç»™ä¼˜å…ˆæ¥å—æ•°æ®çš„ä¸€æ–¹ç»‘å®šï¼Œæ¯”å¦‚è¿™é‡Œå°±æ˜¯å®¢æˆ·ç«¯ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæˆ‘å‘é€æ–¹ä¸€å®šéœ€è¦çŸ¥é“ä¸€ä¸ªå…·ä½“çš„ç«¯å£å·æˆ‘æ‰èƒ½å‘é€ï¼Œåœ¨UDPä¸­IPå€’ä¸ä¸€å®šå¿…é¡»ï¼Œå› ä¸ºæœ‰å¯èƒ½æ˜¯å¹¿æ’­æˆ–è€…ç»„æ’­ï¼Œè¿™å°±ä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„IPäº†ï¼Œä½†æ˜¯ç«¯å£å·æ˜¯æ ‡è¯†ä¸åŒä¸»æœºçš„è¿›ç¨‹çš„ï¼Œæ‰€ä»¥å‘é€æ–¹ä¸€å®šæ˜¯æ ¹æ®è¿™ä¸ªç«¯å£å·æ‰¾åˆ°ä½ å¯¹åº”çš„è¿›ç¨‹çš„ï¼Œç„¶åå¦‚æœæˆ‘å¾—å®¢æˆ·ç«¯ä¸ç»‘å®šï¼Œå°±ç”±ç³»ç»Ÿç»™æˆ‘è‡ªåŠ¨åˆ†é…ï¼Œé‚£å°±æ‰¾ä¸åˆ°äº†ï¼Œæ‰€ä»¥è¿™é‡Œå…¶å®æœåŠ¡ç«¯çš„ç»‘å®šå…¶å®æ²¡æœ‰å¿…è¦ï¼Œä½†æ˜¯ä¸ºäº†ä¹ æƒ¯æˆ‘è¿˜æ˜¯åŠ ä¸Šäº†ï¼›åœ¨TCPä¸­ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæˆ‘å®¢æˆ·ç«¯å…ˆå‘æœåŠ¡ç«¯å‘é€æ•°æ®ï¼Œåœ¨è¿™ä¹‹å‰éœ€è¦å»ºç«‹è¿æ¥ï¼Œæˆ‘ä¹Ÿæ˜¯é€šè¿‡äººä¸ºæŒ‡å®šçš„ç«¯å£è¿æ¥æœåŠ¡ç«¯ï¼Œæ‰€ä»¥æœåŠ¡ç«¯ç»‘å®šäº†ç«¯å£ï¼Œä¹Ÿå°±è°ƒç”¨äº†bind()</strong></p><p>ä½†æ˜¯è¿™é‡Œæˆ‘ä¸æ˜ç™½æˆ‘ç»™å®¢æˆ·ç«¯æŒ‡å®šIPä¸º 127.0.0.2 æ”¶ä¸åˆ°æœåŠ¡ç«¯å¹¿æ’­çš„æ¶ˆæ¯ï¼Œå¿…é¡»æ˜¯å±€åŸŸç½‘å†…çš„ä»»æ„IPï¼Œä¹Ÿå°±æ˜¯INADDR_ANYæ‰è¡Œï¼Œè¿™é‡Œæˆ‘ä¸æ˜ç™½</p><p>å¦å¤–è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯å¹¿æ’­çš„å‘é€æ–¹è¦ç»™socket()è®¾ç½®å¹¿æ’­å±æ€§ï¼Œå°±åƒè¿™æ ·</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼€å¯å¹¿æ’­è®¾ç½®</span></span><br><span class="line"><span class="type">int</span> _optval = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">setsockopt</span>(socket_fd, SOL_SOCKET, SO_BROADCAST, &amp;_optval, <span class="built_in">sizeof</span>(_optval));</span><br></pre></td></tr></table></div></figure><h4 id="ç»„æ’­å¤šæ’­"><a href="#ç»„æ’­å¤šæ’­" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç»„æ’­å¤šæ’­"></a> ç»„æ’­(å¤šæ’­)</h4><p><strong>å•æ’­åœ°å€æ ‡è¯†å•ä¸ª IP æ¥å£ï¼Œå¹¿æ’­åœ°å€æ ‡è¯†æŸä¸ªå­ç½‘çš„æ‰€æœ‰ IP æ¥å£ï¼Œå¤šæ’­åœ°å€æ ‡è¯†ä¸€ç»„ IP æ¥å£ã€‚ å•æ’­å’Œå¹¿æ’­æ˜¯å¯»å€æ–¹æ¡ˆçš„ä¸¤ä¸ªæç«¯ï¼ˆè¦ä¹ˆå•ä¸ªè¦ä¹ˆå…¨éƒ¨ï¼‰ï¼Œå¤šæ’­åˆ™æ„åœ¨ä¸¤è€…ä¹‹é—´æä¾›ä¸€ç§æŠ˜ä¸­æ–¹æ¡ˆã€‚å¤šæ’­æ•°æ®æŠ¥åªåº”è¯¥ç”±å¯¹å®ƒæ„Ÿå…´è¶£çš„æ¥å£æ¥æ”¶ï¼Œä¹Ÿå°±æ˜¯è¯´ç”±è¿è¡Œç›¸åº”å¤šæ’­ä¼šè¯åº”ç”¨ç³»ç»Ÿçš„ä¸»æœºä¸Šçš„æ¥å£æ¥æ”¶ã€‚å¦å¤–ï¼Œå¹¿æ’­ä¸€èˆ¬å±€é™äºå±€åŸŸç½‘å†…ä½¿ç”¨ï¼Œè€Œå¤šæ’­åˆ™æ—¢å¯ä»¥ç”¨äºå±€åŸŸç½‘ï¼Œä¹Ÿå¯ä»¥è·¨å¹¿åŸŸç½‘ä½¿ç”¨ã€‚</strong></p><p><strong>a.ç»„æ’­æ—¢å¯ä»¥ç”¨äºå±€åŸŸç½‘ï¼Œä¹Ÿå¯ä»¥ç”¨äºå¹¿åŸŸç½‘</strong></p><p><strong>b.å®¢æˆ·ç«¯éœ€è¦åŠ å…¥å¤šæ’­ç»„ï¼Œæ‰èƒ½æ¥æ”¶åˆ°å¤šæ’­çš„æ•°æ®</strong></p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822160649282.png" alt="image-20230822160649282" style="zoom:80%"><ul><li>ç»„æ’­åœ°å€</li></ul><p>IP å¤šæ’­é€šä¿¡å¿…é¡»ä¾èµ–äº IP å¤šæ’­åœ°å€ï¼Œåœ¨ IPv4 ä¸­å®ƒçš„èŒƒå›´ä» 224.0.0.0 åˆ° 239.255.255.255 ï¼Œ å¹¶è¢«åˆ’åˆ†ä¸ºå±€éƒ¨é“¾æ¥å¤šæ’­åœ°å€ã€é¢„ç•™å¤šæ’­åœ°å€å’Œç®¡ç†æƒé™å¤šæ’­åœ°å€ä¸‰ç±»:</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230822160933192.png" alt="image-20230822160933192"></p><ul><li><p>è®¾ç½®ç»„æ’­</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823114653916.png" alt="image-20230823114653916"></p></li></ul><p>å¤šæ’­çš„APIç”¨çš„æ¯”è¾ƒå°‘ï¼Œéœ€è¦ç”¨çš„æ—¶å€™æ¥æŸ¥è¯¢å°±å¯ä»¥äº†ï¼Œä½†æ˜¯è¦çŸ¥é“å·¥ä½œåŸç†</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">setsockopt</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">int</span> level, <span class="type">int</span> optname, <span class="type">const</span> <span class="type">void</span> *optval, <span class="type">socklen_t</span> optlen)</span></span>;</span><br><span class="line"><span class="comment">// æœåŠ¡å™¨è®¾ç½®å¤šæ’­çš„ä¿¡æ¯ï¼Œå¤–å‡ºæ¥å£</span></span><br><span class="line">    - level : IPPROTO_IP</span><br><span class="line">    - optname : IP_MULTICAST_IF</span><br><span class="line">    - optval : <span class="keyword">struct</span> <span class="title class_">in_addr</span></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯åŠ å…¥åˆ°å¤šæ’­ç»„ï¼š</span></span><br><span class="line">    - level : IPPROTO_IP</span><br><span class="line">    - optname : IP_ADD_MEMBERSHIP</span><br><span class="line">    - optval : <span class="keyword">struct</span> <span class="title class_">ip_mreq</span></span><br><span class="line">        </span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ip_mreq</span> &#123;</span><br><span class="line">    <span class="comment">/* IP multicast address of group. */</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">in_addr</span> imr_multiaddr; <span class="comment">// ç»„æ’­çš„IPåœ°å€</span></span><br><span class="line">    <span class="comment">/* Local IP address of interface. */</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">in_addr</span> imr_interface; <span class="comment">// æœ¬åœ°çš„IPåœ°å€</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">uint32_t</span> <span class="type">in_addr_t</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">in_addr</span> &#123;</span><br><span class="line">    <span class="type">in_addr_t</span> s_addr;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><h5 id="ä»£ç å’Œå‰é¢åŒæ ·çš„é—®é¢˜"><a href="#ä»£ç å’Œå‰é¢åŒæ ·çš„é—®é¢˜" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä»£ç å’Œå‰é¢åŒæ ·çš„é—®é¢˜"></a> ä»£ç (å’Œå‰é¢åŒæ ·çš„é—®é¢˜)</h5><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_BUF_SIZE 1024</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_IPV4_STRING 16</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤šæ’­çš„IPåœ°å€</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* Multicast_IP = <span class="string">&quot;239.0.0.10&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºé€šä¿¡çš„socketå¥—æ¥å­—</span></span><br><span class="line">    <span class="type">int</span> socket_fd = <span class="built_in">socket</span>(AF_INET, SOCK_DGRAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == socket_fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;socket&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®å¤šæ’­å±æ€§ï¼Œè®¾ç½®å¤–å‡ºæ¥å£</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">in_addr</span> _optval;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–å¤šæ’­åœ°å€</span></span><br><span class="line">    <span class="built_in">inet_pton</span>(AF_INET, Multicast_IP, &amp;_optval.s_addr);</span><br><span class="line">    <span class="built_in">setsockopt</span>(socket_fd, IPPROTO_IP, IP_MULTICAST_IF, &amp;_optval, <span class="built_in">sizeof</span>(_optval));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘é€æ–¹ï¼Œè¿™é‡Œæˆ‘å°±ä¸ç»‘å®šç«¯å£äº†</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;server has initialized.\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°è£…å¹¿æ’­å®¢æˆ·ç«¯çš„socketåœ°å€</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> All_Client_addr;</span><br><span class="line">    All_Client_addr.sin_family = AF_INET;</span><br><span class="line">    All_Client_addr.sin_port = <span class="built_in">htons</span>(<span class="number">10000</span>);</span><br><span class="line">    <span class="built_in">inet_pton</span>(AF_INET, Multicast_IP, &amp;All_Client_addr.sin_addr.s_addr);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.å¼€å§‹é€šä¿¡</span></span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> num = <span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> buf[MAX_BUF_SIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// æœåŠ¡ç«¯å‘æ‰€æœ‰çš„å®¢æˆ·ç«¯å¹¿æ’­æ•°æ®</span></span><br><span class="line">        <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">        <span class="built_in">sprintf</span>(buf, <span class="string">&quot;hello , i am server , num = %d\n&quot;</span>, num++);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;send : %s&quot;</span>, buf);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">sendto</span>(socket_fd, buf, <span class="built_in">strlen</span>(buf), <span class="number">0</span>, (<span class="keyword">struct</span> sockaddr*)&amp;All_Client_addr, <span class="built_in">sizeof</span>(All_Client_addr));</span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.å…³é—­å¥—æ¥å­—</span></span><br><span class="line">    <span class="built_in">close</span>(socket_fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// client.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_BUF_SIZE 1024</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_IPV4_STRING 16</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤šæ’­çš„IPåœ°å€</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* Multicast_IP = <span class="string">&quot;239.0.0.10&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºé€šä¿¡çš„socketå¥—æ¥å­—</span></span><br><span class="line">    <span class="type">int</span> socket_fd = <span class="built_in">socket</span>(AF_INET, SOCK_DGRAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == socket_fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;socket&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŠ å…¥å¤šæ’­ç»„</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">ip_mreq</span> _optval;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">    _optval.imr_interface.s_addr = INADDR_ANY;</span><br><span class="line">    <span class="built_in">inet_pton</span>(AF_INET, Multicast_IP, &amp;_optval.imr_multiaddr.s_addr);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">setsockopt</span>(socket_fd, IPPROTO_IP, IP_ADD_MEMBERSHIP, &amp;_optval, <span class="built_in">sizeof</span>(_optval));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.ç»‘å®šç«¯å£ä¿¡æ¯ï¼Œè®©å‘é€æ–¹èƒ½å¤Ÿæ­£ç¡®æ‰¾åˆ°</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> client_addr;</span><br><span class="line">    <span class="comment">// åœ°å€æ—</span></span><br><span class="line">    client_addr.sin_family = AF_INET;</span><br><span class="line">    <span class="comment">// IP</span></span><br><span class="line">    <span class="comment">// inet_pton(AF_INET, &quot;127.0.0.2&quot;, &amp;client_addr.sin_addr.s_addr);  // å’Œä¹‹å‰ä¸€æ ·çš„é—®é¢˜</span></span><br><span class="line">    client_addr.sin_addr.s_addr = INADDR_ANY;</span><br><span class="line">    <span class="comment">// ç«¯å£</span></span><br><span class="line">    client_addr.sin_port = <span class="built_in">htons</span>(<span class="number">10000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">bind</span>(socket_fd, (<span class="keyword">struct</span> sockaddr*)&amp;client_addr, <span class="built_in">sizeof</span>(client_addr));</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;bind&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> buf[MAX_BUF_SIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.å¼€å§‹é€šä¿¡</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// è¯»æ•°æ®</span></span><br><span class="line">        <span class="built_in">recvfrom</span>(socket_fd, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>, <span class="number">0</span>, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;recv : %s&quot;</span>, buf);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.å…³é—­å¥—æ¥å­—</span></span><br><span class="line">    <span class="built_in">close</span>(socket_fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>åŒæ ·çš„å®¢æˆ·ç«¯ä¹Ÿèƒ½æ”¶åˆ°æœåŠ¡ç«¯å‘é€è€Œæ¥çš„æ•°æ®</p><p>æˆ‘ä»¬åŒæ ·æ³¨æ„æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å¯¹äºè®¾ç½®å¤šæ’­å’ŒåŠ å…¥å¤šæ’­çš„è®¾ç½®æ–¹æ³•</p><p>æœåŠ¡ç«¯</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤šæ’­çš„IPåœ°å€</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* Multicast_IP = <span class="string">&quot;239.0.0.10&quot;</span>;    </span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®å¤šæ’­å±æ€§ï¼Œè®¾ç½®å¤–å‡ºæ¥å£</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">in_addr</span> _optval;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–å¤šæ’­åœ°å€</span></span><br><span class="line"><span class="built_in">inet_pton</span>(AF_INET, Multicast_IP, &amp;_optval.s_addr);</span><br><span class="line"><span class="built_in">setsockopt</span>(socket_fd, IPPROTO_IP, IP_MULTICAST_IF, &amp;_optval, <span class="built_in">sizeof</span>(_optval));</span><br></pre></td></tr></table></div></figure><p>å®¢æˆ·ç«¯</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤šæ’­çš„IPåœ°å€</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* Multicast_IP = <span class="string">&quot;239.0.0.10&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ å…¥å¤šæ’­ç»„</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ip_mreq</span> _optval;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">_optval.imr_interface.s_addr = INADDR_ANY;</span><br><span class="line"><span class="built_in">inet_pton</span>(AF_INET, Multicast_IP, &amp;_optval.imr_multiaddr.s_addr);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setsockopt</span>(socket_fd, IPPROTO_IP, IP_ADD_MEMBERSHIP, &amp;_optval, <span class="built_in">sizeof</span>(_optval));</span><br></pre></td></tr></table></div></figure><h2 id="æœ¬åœ°å¥—æ¥å­—"><a href="#æœ¬åœ°å¥—æ¥å­—" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æœ¬åœ°å¥—æ¥å­—"></a> æœ¬åœ°å¥—æ¥å­—</h2><p>æœ¬åœ°å¥—æ¥å­—çš„ä½œç”¨ï¼šæœ¬åœ°çš„è¿›ç¨‹é—´é€šä¿¡<br>æœ‰å…³ç³»çš„è¿›ç¨‹é—´çš„é€šä¿¡<br>æ²¡æœ‰å…³ç³»çš„è¿›ç¨‹é—´çš„é€šä¿¡</p><p><strong>ä¹‹å‰æˆ‘ä»¬å­¦è¿‡çš„æœ¬åœ°é—´è¿›ç¨‹ä¹‹é—´é€šä¿¡çš„æ–¹å¼æœ‰ï¼šç®¡é“(åŒ¿åç®¡é“pipeï¼Œæœ‰åç®¡é“fifo)ï¼›å†…å­˜æ˜ å°„ï¼›ä¿¡å·ï¼Œä¿¡å·é›†ï¼›å…±äº«å†…å­˜ã€‚è®°å¾—å»å¤ä¹ </strong></p><p>æœ¬åœ°å¥—æ¥å­—å®ç°æµç¨‹å’Œç½‘ç»œå¥—æ¥å­—ç±»ä¼¼ï¼Œä¸€èˆ¬å‘¢é‡‡ç”¨<strong>TCP</strong>çš„é€šä¿¡æµç¨‹ã€‚</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823123131126.png" alt="image-20230823123131126" style="zoom:80%"><h3 id="api"><a href="#api" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#api"></a> API</h3><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœ¬åœ°å¥—æ¥å­—é€šä¿¡çš„æµç¨‹ - tcp</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æœåŠ¡å™¨ç«¯</span></span><br><span class="line"><span class="number">1.</span> åˆ›å»ºç›‘å¬çš„å¥—æ¥å­—</span><br><span class="line">	<span class="type">int</span> lfd = <span class="built_in">socket</span>(AF_UNIX/AF_LOCAL, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line"><span class="number">2.</span> ç›‘å¬çš„å¥—æ¥å­—ç»‘å®šæœ¬åœ°çš„å¥—æ¥å­—æ–‡ä»¶ -&gt; serverç«¯</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">sockaddr_un</span> addr;</span><br><span class="line">	<span class="comment">// ç»‘å®šæˆåŠŸä¹‹åï¼ŒæŒ‡å®šçš„sun_pathä¸­çš„å¥—æ¥å­—æ–‡ä»¶ä¼šè‡ªåŠ¨ç”Ÿæˆã€‚addré‡Œé¢å­˜çš„å°±æ˜¯ä»–çš„è·¯å¾„</span></span><br><span class="line">	<span class="built_in">bind</span>(lfd, addr, len);</span><br><span class="line"><span class="number">3.</span> ç›‘å¬</span><br><span class="line">	<span class="built_in">listen</span>(lfd, <span class="number">100</span>);</span><br><span class="line"><span class="number">4.</span> ç­‰å¾…å¹¶æ¥å—è¿æ¥è¯·æ±‚</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">sockaddr_un</span> cliaddr; <span class="comment">// ç”¨çš„æ—¶å€™è®°å¾—å¼•å¤´æ–‡ä»¶ #include &lt;sys/un.h&gt;</span></span><br><span class="line">	<span class="type">int</span> cfd = <span class="built_in">accept</span>(lfd, &amp;cliaddr, len);</span><br><span class="line"><span class="number">5.</span> é€šä¿¡</span><br><span class="line">	æ¥æ”¶æ•°æ®ï¼šread/recv</span><br><span class="line">	å‘é€æ•°æ®ï¼šwrite/send</span><br><span class="line"><span class="number">6.</span> å…³é—­è¿æ¥</span><br><span class="line">	<span class="built_in">close</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯çš„æµç¨‹</span></span><br><span class="line"><span class="number">1.</span> åˆ›å»ºé€šä¿¡çš„å¥—æ¥å­—</span><br><span class="line">	<span class="type">int</span> fd = <span class="built_in">socket</span>(AF_UNIX/AF_LOCAL, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line"><span class="number">2.</span> ç›‘å¬çš„å¥—æ¥å­—ç»‘å®šæœ¬åœ°çš„å¥—æ¥å­—æ–‡ä»¶ -&gt; clientç«¯</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">sockaddr_un</span> addr;</span><br><span class="line">	<span class="comment">// ç»‘å®šæˆåŠŸä¹‹åï¼ŒæŒ‡å®šçš„sun_pathä¸­çš„å¥—æ¥å­—æ–‡ä»¶ä¼šè‡ªåŠ¨ç”Ÿæˆã€‚</span></span><br><span class="line">	<span class="built_in">bind</span>(lfd, addr, len);</span><br><span class="line"><span class="number">3.</span> è¿æ¥æœåŠ¡å™¨</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">sockaddr_un</span> serveraddr;</span><br><span class="line">	<span class="built_in">connect</span>(fd, &amp;serveraddr, <span class="built_in">sizeof</span>(serveraddr));</span><br><span class="line"><span class="number">4.</span> é€šä¿¡</span><br><span class="line">	æ¥æ”¶æ•°æ®ï¼šread/recv</span><br><span class="line">	å‘é€æ•°æ®ï¼šwrite/send</span><br><span class="line"><span class="number">5.</span> å…³é—­è¿æ¥</span><br><span class="line">	<span class="built_in">close</span>();</span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤´æ–‡ä»¶: sys/un.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UNIX_PATH_MAX 108</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr_un</span> &#123;</span><br><span class="line">	<span class="type">sa_family_t</span> sun_family; <span class="comment">// åœ°å€æ—åè®® af_local</span></span><br><span class="line">	<span class="type">char</span> sun_path[UNIX_PATH_MAX]; <span class="comment">// å¥—æ¥å­—æ–‡ä»¶çš„è·¯å¾„, è¿™æ˜¯ä¸€ä¸ªä¼ªæ–‡ä»¶, å¤§å°æ°¸è¿œ=0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h3 id="å·¥ä½œåŸç†-2"><a href="#å·¥ä½œåŸç†-2" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å·¥ä½œåŸç†-2"></a> å·¥ä½œåŸç†</h3><p><strong>æˆ‘ä»¬è§‚å¯Ÿä»–çš„æµç¨‹å›¾ä»¥åŠç»“åˆä¸Šé¢APIçš„æ³¨é‡Šï¼Œåœ¨æœ¬åœ°æ–‡ä»¶socketåœ°å€ä¸­ï¼Œç”±äºæ˜¯æœ¬åœ°çš„é€šä¿¡ï¼Œæˆ‘ä»¬ä¸ä½¿ç”¨IPV4åœ°å€æˆ–è€…IPV6åœ°å€ï¼Œä¹Ÿå°±æ˜¯sockaddr_inå’Œsockadd_in6ï¼Œæˆ‘ä»¬ä½¿ç”¨ sockaddr_un è¿™ä¸ªç»“æ„ä½“æ¥å°è£…æœ¬åœ°çš„ä¿¡æ¯ï¼Œè¿™ä¸ªç»“æ„ä½“ä¸€ä¸ªå‚æ•°æ˜¯åœ°å€æ—ï¼Œå¦ä¸€ä¸ªå‚æ•°å°±éå¸¸é‡è¦äº†ï¼Œå°±æ˜¯æŒ‡å®šæˆ‘ä»¬ç”¨äºé€šä¿¡çš„å¥—æ¥å­—æ–‡ä»¶çš„è·¯å¾„ï¼Œä¾‹å¦‚å›¾ä¸­å°±æ˜¯server.sockå’Œclient.sockï¼Œè¿™æ˜¯ä¸€ä¸ªä¼ªæ–‡ä»¶ï¼Œå¤§å°æ°¸è¿œéƒ½æ˜¯0ï¼Œæ˜¯ç”¨æ¥è¿›è¡Œæœ¬åœ°è¿›ç¨‹é—´é€šä¿¡çš„ï¼›è¿™ä¸ªæ–‡ä»¶ä¼šåœ¨ç£ç›˜ä¸­è¢«åˆ›å»ºå‡ºæ¥ï¼Œåœ¨é€šä¿¡çš„æ—¶å€™ï¼Œåœ¨å†…æ ¸ä¸­å¯¹åº”äº†ä¸€å—ç¼“å†²åŒºï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œå®¢æˆ·ç«¯Bå‘é€æ•°æ®ï¼Œå…ˆå°†æ•°æ®å†™é“ä»–çš„å†™ç¼“å†²åŒºï¼Œåœ¨å‘é€åˆ°æœåŠ¡ç«¯çš„è¯»ç¼“å†²åŒºï¼Œå› æ­¤è¯»å†™åŒæ–¹éƒ½å¿…é¡»æœ‰ä¸€ä¸ªè¿™ä¸ªå¥—æ¥å­—æ–‡ä»¶çš„è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯éƒ½éœ€è¦ç»‘å®šbind()ï¼Œè¿™å°±å’Œä¸€èˆ¬çš„TCPé€šä¿¡æœ‰åŒºåˆ«</strong></p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823124612140.png" alt="image-20230823124612140"></p><h3 id="ä»£ç -4"><a href="#ä»£ç -4" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä»£ç -4"></a> ä»£ç </h3><p>è¿™é‡Œæˆ‘ç¬¬ä¸€æ¬¡ä½¿ç”¨TCPç‰¹æœ‰çš„send()å’Œrecv()å‡½æ•°ï¼Œä»–ä»¬çš„è¿”å›å€¼å’Œä»€ä¹ˆæ—¶å€™è¿”å›æˆ‘ç°åœ¨è¿˜ä¸æ˜¯å¾ˆæ˜ç™½ï¼Œå’Œwrite()å’Œread()å¤§å·®ä¸å·®ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰åŒºåˆ«ï¼Œéœ€è¦åç»­å¯¹å†…æ ¸æºç çš„å­¦ä¹ æ‰èƒ½æ›´å¥½çš„ç†è§£</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/un.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_BUF_SIZE 1024</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºsocketæœ¬åœ°å¥—æ¥å­—</span></span><br><span class="line">    <span class="type">int</span> listen_fd = <span class="built_in">socket</span>(AF_LOCAL, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == listen_fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;socket&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.ç»‘å®šæœ¬åœ°å¥—æ¥å­—æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_un</span> server_addr;</span><br><span class="line">    <span class="comment">// åœ°å€æ—</span></span><br><span class="line">    server_addr.sun_family = AF_LOCAL;</span><br><span class="line">    <span class="comment">// å¥—æ¥å­—æ–‡ä»¶ç»‘å®šäº†ä¹‹åè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ç”¨äºé€šä¿¡</span></span><br><span class="line">    <span class="built_in">strcpy</span>(server_addr.sun_path, <span class="string">&quot;server.sock&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">bind</span>(listen_fd, (<span class="keyword">struct</span> sockaddr*)&amp;server_addr, <span class="built_in">sizeof</span>(server_addr));</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;bind&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.ç›‘å¬</span></span><br><span class="line">    ret = <span class="built_in">listen</span>(listen_fd, <span class="number">5</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;listen&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_un</span> client_addr;</span><br><span class="line">    <span class="type">socklen_t</span> client_addr_len = <span class="built_in">sizeof</span>(client_addr);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> connect_fd = <span class="built_in">accept</span>(listen_fd, (<span class="keyword">struct</span> sockaddr*)&amp;client_addr, &amp;client_addr_len);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == connect_fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;accept&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;client (socket filename : %s) has connected.\n&quot;</span>, client_addr.sun_path);</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> buf[MAX_BUF_SIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="comment">// 5.å¼€å§‹é€šä¿¡</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// è¯»</span></span><br><span class="line">        <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">        <span class="type">int</span> len = <span class="built_in">recv</span>(connect_fd, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">-1</span> == len) &#123;</span><br><span class="line">            <span class="keyword">if</span> (errno == ECONNRESET)  <span class="comment">// æŠ¥é”™å¤„ç†</span></span><br><span class="line">                <span class="keyword">goto</span> CLOSE;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;recv&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;recv : %s&quot;</span>, buf);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == len) &#123;</span><br><span class="line">        CLOSE:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;client (socket filename : %s) has closed...\n&quot;</span>, client_addr.sun_path);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å†™</span></span><br><span class="line">        <span class="built_in">send</span>(connect_fd, buf, <span class="built_in">strlen</span>(buf), <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6.å…³é—­è¿æ¥</span></span><br><span class="line">    <span class="built_in">close</span>(connect_fd);</span><br><span class="line">    <span class="built_in">close</span>(listen_fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// client.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/un.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_BUF_SIZE 1024</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºæœ¬åœ°socketå¥—æ¥å­—</span></span><br><span class="line">    <span class="type">int</span> connect_fd = <span class="built_in">socket</span>(AF_LOCAL, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == connect_fd) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;socket&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.ç»‘å®šæœ¬åœ°å¥—æ¥å­—æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_un</span> client_addr;</span><br><span class="line">    client_addr.sun_family = AF_LOCAL;</span><br><span class="line">    <span class="built_in">strcpy</span>(client_addr.sun_path, <span class="string">&quot;client.sock&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">bind</span>(connect_fd, (<span class="keyword">struct</span> sockaddr*)&amp;client_addr, <span class="built_in">sizeof</span>(client_addr));</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;bind&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.è¿æ¥å®¢æˆ·ç«¯</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_un</span> server_addr;</span><br><span class="line">    server_addr.sun_family = AF_LOCAL;</span><br><span class="line">    <span class="built_in">strcpy</span>(server_addr.sun_path, <span class="string">&quot;server.sock&quot;</span>);</span><br><span class="line"></span><br><span class="line">    ret = <span class="built_in">connect</span>(connect_fd, (<span class="keyword">struct</span> sockaddr*)&amp;server_addr, <span class="built_in">sizeof</span>(server_addr));</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == ret) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;connect&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> buf[MAX_BUF_SIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> num = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 4.å¼€å§‹é€šä¿¡</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// å†™</span></span><br><span class="line">        <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">        <span class="built_in">sprintf</span>(buf, <span class="string">&quot;hello , i am client , num : %d\n&quot;</span>, num++);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;send : %s&quot;</span>, buf);</span><br><span class="line">        <span class="built_in">send</span>(connect_fd, buf, <span class="built_in">strlen</span>(buf), <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¯»</span></span><br><span class="line">        <span class="built_in">bzero</span>(buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line">        <span class="type">int</span> len = <span class="built_in">recv</span>(connect_fd, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">-1</span> == len) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;recv&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;recv : %s&quot;</span>, buf);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == len) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;server has closed...\n&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><h4 id="ä»£ç åˆ†æç»†èŠ‚åœ°æ–¹ä¸æ˜¯å¾ˆæ˜ç™½"><a href="#ä»£ç åˆ†æç»†èŠ‚åœ°æ–¹ä¸æ˜¯å¾ˆæ˜ç™½" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä»£ç åˆ†æç»†èŠ‚åœ°æ–¹ä¸æ˜¯å¾ˆæ˜ç™½"></a> ä»£ç åˆ†æ(ç»†èŠ‚åœ°æ–¹ä¸æ˜¯å¾ˆæ˜ç™½)</h4><p>ä»£ç ä¸­æœ‰å¾ˆå¤šåœ°æ–¹å€¼å¾—æˆ‘ä»¬æ¨æ•²ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä»£ç çš„æ‰§è¡Œç»“æœï¼š</p><p>æ³¨æ„ï¼Œç”±äºæˆ‘ä»¬æ˜¯é€šè¿‡å¥—æ¥å­—æ–‡ä»¶å’Œå†…æ ¸ç¼“å†²åŒºè¿›è¡Œè”ç³»ï¼Œå› æ­¤ä¼šåˆ›å»ºå‡ºæ¥ä¸€ä¸ªå¥—æ¥å­—æ–‡ä»¶ï¼Œåªèƒ½ä½¿ç”¨Linuxçš„åŸç”Ÿç›®å½•ï¼</p><p>æœåŠ¡ç«¯</p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823151111152.png" alt="image-20230823151111152" style="zoom:80%"><p>å®¢æˆ·ç«¯</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823151122954.png" alt="image-20230823151122954"></p><p>å¯ä»¥çœ‹å‡ºèƒ½å¤Ÿæ­£å¸¸è·‘å‡ºæ¥ï¼Œå½“æˆ‘ä»¬ç»‘å®šbind()å¥—æ¥å­—æ–‡ä»¶ä¹‹åæˆ‘ä»¬æŸ¥çœ‹ç›®å½•ä¸‹å¤šå‡ºäº†ä¸¤ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶æ­£æ˜¯ç”¨æ¥ä¸å†…æ ¸ä¸­ç¼“å†²åŒºç›´æ¥è”ç³»å¹¶ä¸”ç”¨äºé€šä¿¡çš„ï¼›å¯ä»¥çœ‹å‡ºä»–ä»¬å¹¶æ²¡æœ‰å¤§å°ï¼Œæ˜¯ä¸€ä¸ªä¼ªæ–‡ä»¶</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823151222376.png" alt="image-20230823151222376"></p><p>ç°åœ¨æˆ‘å†æ¬¡è¿è¡ŒæœåŠ¡ç«¯æˆ–è€…å®¢æˆ·ç«¯ï¼Œå‘ç°å‡ºç°äº†è¿™æ ·çš„æƒ…å†µï¼š</p><p>æŠ¥é”™ï¼šbind Address already in useï¼›è¿™æ­£æ˜¯å› ä¸ºæˆ‘ä»¬åˆ›å»ºçš„å¥—æ¥å­—æ–‡ä»¶è¿˜åœ¨è¿™é‡Œæ²¡æœ‰è¢«é‡Šæ”¾(åˆ é™¤)å¯¼è‡´è¢«å æ®è€Œæ²¡æœ‰åŠæ³•bind()æˆåŠŸå¯¼è‡´çš„ï¼Œæˆ‘ä»¬å°†å…¶åˆ é™¤å³å¯</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823151351101.png" alt="image-20230823151351101"></p><p>æˆ‘ä»¬æŸ¥çœ‹ä»£ç ä¸­çš„è¿™ä¸€éƒ¨åˆ†ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.cpp</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5.å¼€å§‹é€šä¿¡</span></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">	...</span><br><span class="line">        </span><br><span class="line">    <span class="type">int</span> len = <span class="built_in">recv</span>(connect_fd, buf, <span class="built_in">sizeof</span>(buf) - <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == len) &#123;</span><br><span class="line">        <span class="keyword">if</span> (errno == ECONNRESET)  <span class="comment">// æŠ¥é”™å¤„ç†</span></span><br><span class="line">            <span class="keyword">goto</span> CLOSE;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;recv&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">0</span> == len) &#123;</span><br><span class="line">    CLOSE:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;client (socket filename : %s) has closed...\n&quot;</span>, client_addr.sun_path);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></div></figure><p>æˆ‘ä»¬å‘ç°è¿›è¡Œäº†ä¸€ä¸ªæŠ¥é”™çš„ç‰¹æ®Šå¤„ç†ï¼Œæˆ‘ä»¬è¯•ç€å°†å…¶åˆ é™¤å†æ¥è·‘ä»£ç ï¼Œè¿™æ¬¡æˆ‘ä»¬å¼ºåˆ¶åœæ‰å®¢æˆ·ç«¯ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p>å®¢æˆ·ç«¯</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823152331909.png" alt="image-20230823152331909"></p><p>æœåŠ¡ç«¯</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823152340686.png" alt="image-20230823152340686"></p><p>å¯ä»¥çœ‹å‡ºåœ¨è¯»æ•°æ®çš„æ—¶å€™æŠ¥é”™äº†ï¼Œé”™è¯¯ä¿¡æ¯æ˜¯ Connection rest by peerï¼Œæˆ‘ä¸çŸ¥é“å…·ä½“åŸå› ï¼Œä½†æ˜¯æˆ‘çŒœæµ‹å¤§è‡´åº”è¯¥æ˜¯å¼ºåˆ¶åœæ‰å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ç»“æŸåä¼šç»™æœåŠ¡ç«¯å‘é€ä¸€ä¸ªä¿¡å·ï¼Œç„¶åæœåŠ¡ç«¯è¿™ä¸ªæ—¶å€™ä¹Ÿåœ¨é˜»å¡è¯»ï¼Œæ”¶åˆ°è¿™ä¸ªä¿¡å·åå°±ä¸é˜»å¡äº†(å’Œä¹‹å‰é‚£ä¸ªè½¯ä¸­æ–­ç±»ä¼¼)ï¼Œç„¶åå‘ç”Ÿäº†é”™è¯¯ï¼Œä½†æ˜¯å…¶å®æ˜¯å®¢æˆ·ç«¯æ–­å¼€äº†è¿æ¥å¯¼è‡´çš„</p><p>ä¸Šç½‘æŸ¥è¯¢åæˆ‘ä»¬å‘ç°é”™è¯¯å·æ˜¯ ECONNRESET ï¼Œå› æ­¤ç‰¹æ®Šå¤„ç†å³å¯</p><p>è¿˜æ˜¯ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä¸åšå¤„ç†ï¼Œå½“æˆ‘è®©clientæ­£å¸¸çš„ç»“æŸï¼Œè¿™é‡Œæˆ‘è®©while()åŠ äº†ä¸ªæ¡ä»¶ï¼Œå‘ç°ä¸æŠ¥é”™äº†ï¼Œèµ°çš„æ˜¯ 0==len å†™ç«¯å…³é—­çš„è¿™é‡Œï¼Œå¹¶ä¸”è¯ä¹Ÿæ­£å¸¸æ‰“å°å‡ºæ¥äº†ï¼Œå¦‚ä¸‹ï¼š</p><p>å®¢æˆ·ç«¯</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823152830630.png" alt="image-20230823152830630"></p><p>æœåŠ¡ç«¯</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823152839250.png" alt="image-20230823152839250"></p><p>å› æ­¤è¿™ä¸ªrecv()å‡½æ•°ä»€ä¹ˆæ—¶å€™è¿”å›ï¼Œæˆ–è€…è¿”å›ä»€ä¹ˆå€¼ï¼Œç”šè‡³read()çš„è®¤çŸ¥éƒ½æœ‰å¯èƒ½åœ¨è¿™é‡Œå’Œæˆ‘çš„ä¸å®Œå…¨ä¸€æ ·ï¼Œç­‰å¾…åç»­çš„è¿›ä¸€æ­¥ç ”ç©¶å§</p><p>ç°åœ¨æˆ‘ä»¬åœ¨ä¸€åˆ‡ä»£ç æ­£ç¡®çš„æƒ…å†µä¸‹å¼ºåˆ¶åœæ‰æœåŠ¡ç«¯ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p>æœåŠ¡ç«¯</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823153112240.png" alt="image-20230823153112240"></p><p>å®¢æˆ·ç«¯</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823153119822.png" alt="image-20230823153119822"></p><p>æˆ‘ä»¬å‘ç°å®¢æˆ·ç«¯ç›´æ¥åœæ­¢è¿è¡Œäº†ï¼Œæ²¡æœ‰æŠ¥é”™ä¹Ÿæ²¡æœ‰æ­£å¸¸çš„è¾“å‡ºï¼Œè‚¯å®šæ˜¯å¼‚å¸¸é€€å‡ºï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ç¡®å®ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œå¯è§æ°´å¾ˆæ·±</p><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œå…¶å®çœŸæ­£çš„å¼€å‘èƒ½ç”¨å°±è¡Œï¼Œä½†æ˜¯ç°åœ¨åœ¨å­¦ä¹ çš„è¿‡ç¨‹è¿˜æ˜¯è¦å°½é‡è€ƒè™‘å®Œå…¨ï¼Œæ¯ä¸€æ­¥éƒ½å°½é‡å¼„æ˜ç™½</p><h1 id="ç¬¬äº”ç« -é¡¹ç›®å®æˆ˜å’Œæ€»ç»“"><a href="#ç¬¬äº”ç« -é¡¹ç›®å®æˆ˜å’Œæ€»ç»“" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç¬¬äº”ç« -é¡¹ç›®å®æˆ˜å’Œæ€»ç»“"></a> ç¬¬äº”ç«  é¡¹ç›®å®æˆ˜å’Œæ€»ç»“</h1><p>æˆ‘ä»¬çš„æœ€ç»ˆç›®æ ‡æ˜¯å®Œæˆä¸€ä¸ªwebæœåŠ¡å™¨é¡¹ç›®</p><h2 id="é˜»å¡éé˜»å¡-åŒæ­¥å¼‚æ­¥ç½‘ç»œio"><a href="#é˜»å¡éé˜»å¡-åŒæ­¥å¼‚æ­¥ç½‘ç»œio" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#é˜»å¡éé˜»å¡-åŒæ­¥å¼‚æ­¥ç½‘ç»œio"></a> é˜»å¡/éé˜»å¡ã€åŒæ­¥/å¼‚æ­¥(ç½‘ç»œIO)</h2><p><strong>å…¸å‹çš„ä¸€æ¬¡IOçš„ä¸¤ä¸ªé˜¶æ®µæ˜¯ä»€ä¹ˆï¼Ÿæ•°æ®å°±ç»ª å’Œ æ•°æ®è¯»å†™</strong></p><p>æ•°æ®å°±ç»ªï¼šæ ¹æ®ç³»ç»ŸIOæ“ä½œçš„å°±ç»ªçŠ¶æ€</p><ul><li>é˜»å¡</li><li>éé˜»å¡</li></ul><p>æ•°æ®è¯»å†™ï¼šæ ¹æ®åº”ç”¨ç¨‹åºå’Œå†…æ ¸çš„äº¤äº’æ–¹å¼</p><ul><li>åŒæ­¥</li><li>å¼‚æ­¥</li></ul><p>ç»“åˆè¿™å¼ å›¾ç†è§£ï¼š</p><ul><li><p><strong>æ•°æ®å°±ç»ªéƒ¨åˆ†ï¼Œæ¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦åœ¨è¿›è¡Œè¯»å†™æ“ä½œçš„æ—¶å€™åœ¨å†…æ ¸ä¸­éƒ½å¯¹åº”äº†ä¸€å—ç¼“å†²åŒºç”¨äºä¸´æ—¶å­˜æ”¾æ¥å—åˆ°æˆ–è€…å†™äº†è¦å‘å‡ºå»çš„æ•°æ®ï¼Œä¾‹å¦‚ï¼Œå½“æœ‰æ•°æ®è¿›æ¥è®©è¯»ç¼“å†²åŒºä¸ä¸ºç©ºçš„æ—¶å€™ï¼Œå°±æ˜¯æ•°æ®è¯»çš„å°±ç»ªçš„æ—¶å€™ï¼Œå‘ç”Ÿåœ¨æ“ä½œç³»ç»Ÿçš„å†…æ ¸éƒ¨åˆ†</strong></p><p><strong>æ•°æ®è¯»å†™éƒ¨åˆ†ï¼Œç”¨æˆ·ç¨‹åºéƒ¨åˆ†ï¼Œå°±æ˜¯ç”¨æˆ·å‘æ–‡ä»¶å†…å†™æˆ–è€…è¯»æ•°æ®ï¼Œä¹Ÿå°±æ˜¯å†™å…¥ç¼“å†²åŒºæˆ–è€…è¯»å…¥ç¼“å†²åŒºï¼Œç„¶åç¼“å†²åŒºå†åˆ°å†…å­˜æˆ–è€…é€šä¿¡å°±æ˜¯å¦ä¸€æ–¹çš„ç¼“å†²åŒº</strong></p></li><li><p><strong>åŒæ­¥ï¼šæˆ‘ä»¬ç”¨æˆ·è‡ªå·±å®šä¹‰ä¸€ä¸ªbuf[]æ¥å­˜æ”¾ç¼“å†²åŒºä¸­çš„æ•°æ®ï¼Œä»£ç åœ¨æ‰§è¡Œçš„æ—¶å€™ä¸€ç‚¹ç‚¹ä»sockfdå¯¹åº”çš„å†…æ ¸ç¼“å†²åŒºä¸­æ¬åˆ°æˆ‘ä»¬çš„buf[]å½“ä¸­ï¼Œæ¬ç§»å®Œæ¯•ä¹‹å‰ä»£ç ä¸ä¼šå‘ä¸‹æ‰§è¡Œï¼›è¿™ç§è¿‡ç¨‹æ˜¯æˆ‘ä»¬ç”¨æˆ·åº”ç”¨ç¨‹åºè‡ªå·±æ¬(å› ä¸ºæˆ‘ä»¬è¯»çš„æ—¶å€™åœåœ¨è¿™é‡Œäº†ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬æ²¡æœ‰åŠæ³•æ‰§è¡Œå…¶ä»–å·¥ä½œ)ï¼Œä¸æ˜¯æ“ä½œç³»ç»Ÿæ¬å®Œäº†é€šçŸ¥æˆ‘ä»¬</strong></p><p><strong>å¼‚æ­¥ï¼šæ“ä½œç³»ç»Ÿç»™æˆ‘ä»¬æ¬ï¼Œæ¬å®Œäº†é€šçŸ¥æˆ‘ä»¬ï¼Œæ¯”è¾ƒå¸¸è§çš„æ–¹å¼æ˜¯sigioä¿¡å·ï¼Œç›¸æ¯”åŒæ­¥æ•ˆç‡æ›´é«˜ï¼Œå› ä¸ºæ¬åŠ¨è¿‡ç¨‹ä¸­åº”ç”¨ç¨‹åºå¯ä»¥å¹²è‡ªå·±çš„å·¥ä½œï¼Œä½†æ˜¯è¦çœ‹ç³»ç»Ÿæœ‰æ²¡æœ‰æä¾›æ¥å£å¹¶ä¸”ä»£ç çš„ç¼–å†™ä¹Ÿä¸ç®€å•</strong></p></li></ul><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/02/01/%E9%98%BB%E5%A1%9E%E3%80%81%E9%9D%9E%E9%98%BB%E5%A1%9E%E3%80%81%E5%90%8C%E6%AD%A5%E3%80%81%E5%BC%82%E6%AD%A5.png" alt="é˜»å¡ã€éé˜»å¡ã€åŒæ­¥ã€å¼‚æ­¥"></p><p>é™ˆç¡•ï¼š<strong>åœ¨å¤„ç† IO çš„æ—¶å€™ï¼Œé˜»å¡å’Œéé˜»å¡éƒ½æ˜¯åŒæ­¥ IOï¼Œåªæœ‰ä½¿ç”¨äº†ç‰¹æ®Šçš„ API æ‰æ˜¯å¼‚æ­¥ IOã€‚</strong></p><p>æ³¨æ„ï¼šI/Oå¤šè·¯å¤ç”¨(å¤šè·¯è½¬æ¥)æŠ€æœ¯ï¼Œselect/poll/epoll ä¸‰ç§æŠ€æœ¯éƒ½æ˜¯åŒæ­¥æ“ä½œï¼›é¦–å…ˆå®ƒåªèƒ½å¸®æˆ‘ä»¬æ£€æµ‹åˆ°æœ‰å¤šå°‘ä¸ªå®¢æˆ·ç«¯æ˜¯æ•°æ®å°±ç»ªçš„ï¼Œæˆ–è€…å“ªå‡ ä¸ª(epoll)ï¼ŒçœŸæ­£çš„æ•°æ®è¯»å†™æ“ä½œè¿˜æ˜¯æˆ‘ä»¬è‡ªå·±è§£å†³ï¼Œå› æ­¤æ˜¯åŒæ­¥ï¼›ç¬¬äºŒï¼Œæ ¹æ®é™ˆç¡•è€å¸ˆè¯´çš„è¯ï¼Œä¸€èˆ¬æƒ…å†µæˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨åŒæ­¥çš„I/Oï¼Œå› ä¸ºå¼‚æ­¥I/Oä¼šå¯¼è‡´ä¸€äº›ä¸å¯é¢„æœŸçš„é—®é¢˜ï¼Œå¹¶ä¸”ç”¨çš„å¾ˆå°‘ï¼Œä¸€èˆ¬åªæœ‰ä½¿ç”¨ç‰¹æ®Šçš„APIæ‰æ˜¯å¼‚æ­¥I/O</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823155027679.png" alt="image-20230823155027679"></p><p><strong>ä¸€ä¸ªå…¸å‹çš„ç½‘ç»œIOæ¥å£è°ƒç”¨ï¼Œåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ˜¯â€œæ•°æ®å°±ç»ªâ€ å’Œâ€œæ•°æ®è¯»å†™â€ï¼Œæ•°æ®å°±ç»ªé˜¶æ®µåˆ†ä¸ºé˜»å¡å’Œéé˜»å¡ï¼Œè¡¨ç°å¾—ç»“æœå°±æ˜¯ï¼Œé˜»å¡å½“å‰çº¿ç¨‹æˆ–æ˜¯ç›´æ¥è¿”å›ã€‚</strong></p><p><strong>åŒæ­¥è¡¨ç¤ºAå‘Bè¯·æ±‚è°ƒç”¨ä¸€ä¸ªç½‘ç»œIOæ¥å£æ—¶ï¼ˆæˆ–è€…è°ƒç”¨æŸä¸ªä¸šåŠ¡é€»è¾‘APIæ¥å£æ—¶ï¼‰ï¼Œæ•°æ®çš„è¯»å†™éƒ½æ˜¯ç”±è¯·æ±‚æ–¹Aè‡ªå·±æ¥å®Œæˆçš„ï¼ˆä¸ç®¡æ˜¯é˜»å¡è¿˜æ˜¯éé˜»å¡ï¼‰ï¼›å¼‚æ­¥è¡¨ç¤ºAå‘Bè¯·æ±‚è°ƒç”¨ä¸€ä¸ªç½‘ç»œIOæ¥å£æ—¶ ï¼ˆæˆ–è€…è°ƒç”¨æŸä¸ªä¸šåŠ¡é€»è¾‘APIæ¥å£æ—¶ï¼‰ï¼Œå‘Bä¼ å…¥è¯·æ±‚çš„äº‹ä»¶ä»¥åŠäº‹ä»¶å‘ç”Ÿæ—¶é€šçŸ¥çš„æ–¹å¼ï¼ŒAå°±å¯ä»¥å¤„ç†å…¶å®ƒé€»è¾‘äº†ï¼Œå½“Bç›‘å¬åˆ°äº‹ä»¶å¤„ç†å®Œæˆåï¼Œä¼šç”¨äº‹å…ˆçº¦å®šå¥½çš„é€šçŸ¥æ–¹å¼ï¼Œé€šçŸ¥Aå¤„ç†ç»“æœã€‚</strong></p><p><strong>æˆ‘ä»¬ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨å¼‚æ­¥æ¥å£ï¼Ÿå¾ˆå¤§ä¸€ä¸ªåŸå› å°±æ˜¯å¼‚æ­¥æ¥å£ç³»ç»Ÿé€šçŸ¥ç”¨æˆ·å¤§éƒ¨åˆ†ä½¿ç”¨ä¿¡å·ï¼Œä½¿ç”¨ä¿¡å·äº§ç”Ÿè½¯ä¸­æ–­ä¹‹åï¼Œåœ¨å¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹å½“ä¸­å¯èƒ½ä¼šå‡ºç°ä¸€äº›éš¾ä»¥æƒ³åˆ°çš„é—®é¢˜ï¼Œä¸å¥½å¤„ç†ï¼Œè¿™ä¹ŸåŠ å¤§äº†ä»£ç çš„ç¼–å†™å¤æ‚ç¨‹åº¦</strong></p><ul><li>åŒæ­¥é˜»å¡</li><li>åŒæ­¥éé˜»å¡</li><li>å¼‚æ­¥é˜»å¡</li><li>å¼‚æ­¥éé˜»å¡ <strong>(å¼‚æ­¥åŸºæœ¬ä¸Šä¼´ç€éé˜»å¡ä½¿ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬åº”ç”¨ç¨‹åºäº¤ç»™æ“ä½œç³»ç»Ÿå¤„ç†ä¹‹åæˆ‘ä»¬å¯ä»¥ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæé«˜æ•ˆç‡)</strong></li></ul><h2 id="unixlinuxä¸Šçš„äº”ç§ioæ¨¡å‹"><a href="#unixlinuxä¸Šçš„äº”ç§ioæ¨¡å‹" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#unixlinuxä¸Šçš„äº”ç§ioæ¨¡å‹"></a> Unix/Linuxä¸Šçš„äº”ç§IOæ¨¡å‹</h2><h3 id="é˜»å¡-blocking"><a href="#é˜»å¡-blocking" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#é˜»å¡-blocking"></a> é˜»å¡ blocking</h3><p>è°ƒç”¨è€…è°ƒç”¨äº†æŸä¸ªå‡½æ•°ï¼Œç­‰å¾…è¿™ä¸ªå‡½æ•°è¿”å›ï¼ŒæœŸé—´ä»€ä¹ˆä¹Ÿä¸åšï¼Œä¸åœçš„å»æ£€æŸ¥è¿™ä¸ªå‡½æ•°æœ‰æ²¡æœ‰è¿”å›ï¼Œå¿…é¡»ç­‰è¿™ä¸ªå‡½æ•°è¿”å›æ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥åŠ¨ä½œã€‚</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823155137394.png" alt="image-20230823155137394"></p><h3 id="éé˜»å¡-non-blockingnio"><a href="#éé˜»å¡-non-blockingnio" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#éé˜»å¡-non-blockingnio"></a> éé˜»å¡ non-blockingï¼ˆNIOï¼‰</h3><p>éé˜»å¡ç­‰å¾…ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´å°±å»æ£€æµ‹IOäº‹ä»¶æ˜¯å¦å°±ç»ªã€‚æ²¡æœ‰å°±ç»ªå°±å¯ä»¥åšå…¶ä»–äº‹ã€‚éé˜»å¡I/Oæ‰§è¡Œç³»ç»Ÿè°ƒç”¨æ€»æ˜¯ç«‹å³è¿”å›**ï¼Œä¸ç®¡äº‹ä»¶æ˜¯å¦å·²ç»å‘ç”Ÿï¼Œè‹¥äº‹ä»¶æ²¡æœ‰å‘ç”Ÿï¼Œåˆ™è¿”å›-1ï¼Œæ­¤æ—¶å¯ä»¥æ ¹æ® errno åŒºåˆ†è¿™ä¸¤ç§æƒ…å†µï¼Œå¯¹äºacceptï¼Œrecv å’Œ sendï¼Œäº‹ä»¶æœªå‘ç”Ÿæ—¶ï¼Œerrno é€šå¸¸è¢«è®¾ç½®æˆ EAGAINã€‚**</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823155156625.png" alt="image-20230823155156625"></p><h3 id="ioå¤ç”¨io-multiplexing"><a href="#ioå¤ç”¨io-multiplexing" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ioå¤ç”¨io-multiplexing"></a> IOå¤ç”¨ï¼ˆIO multiplexingï¼‰</h3><p>Linux ç”¨ select/poll/epoll å‡½æ•°å®ç° IO å¤ç”¨æ¨¡å‹ï¼Œè¿™äº›å‡½æ•°ä¹Ÿä¼šä½¿è¿›ç¨‹é˜»å¡ï¼Œä½†æ˜¯å’Œé˜»å¡IOæ‰€ä¸åŒçš„æ˜¯ è¿™äº›å‡½æ•°å¯ä»¥åŒæ—¶é˜»å¡å¤šä¸ªIOæ“ä½œã€‚è€Œä¸”å¯ä»¥åŒæ—¶å¯¹å¤šä¸ªè¯»æ“ä½œã€å†™æ“ä½œçš„IOå‡½æ•°è¿›è¡Œæ£€æµ‹ã€‚ç›´åˆ°æœ‰æ•° æ®å¯è¯»æˆ–å¯å†™æ—¶ï¼Œæ‰çœŸæ­£è°ƒç”¨IOæ“ä½œå‡½æ•°ã€‚</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823155217650.png" alt="image-20230823155217650"></p><h3 id="ä¿¡å·é©±åŠ¨signal-driven"><a href="#ä¿¡å·é©±åŠ¨signal-driven" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä¿¡å·é©±åŠ¨signal-driven"></a> ä¿¡å·é©±åŠ¨ï¼ˆsignal-drivenï¼‰</h3><p>Linux ç”¨å¥—æ¥å£è¿›è¡Œä¿¡å·é©±åŠ¨ IOï¼Œå®‰è£…ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œè¿›ç¨‹ç»§ç»­è¿è¡Œå¹¶ä¸é˜»å¡ï¼Œå½“IOäº‹ä»¶å°±ç»ªï¼Œè¿›ç¨‹æ”¶åˆ° SIGIO ä¿¡å·ï¼Œç„¶åå¤„ç† IO äº‹ä»¶ã€‚</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823155237200.png" alt="image-20230823155237200"></p><p>å†…æ ¸åœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µæ˜¯å¼‚æ­¥ï¼Œåœ¨ç¬¬äºŒä¸ªé˜¶æ®µæ˜¯åŒæ­¥ï¼›ä¸éé˜»å¡IOçš„åŒºåˆ«åœ¨äºå®ƒæä¾›äº†æ¶ˆæ¯é€šçŸ¥æœºåˆ¶ï¼Œä¸éœ€è¦ç”¨æˆ·è¿›ç¨‹ä¸æ–­çš„è½®è¯¢æ£€æŸ¥ï¼Œå‡å°‘äº†ç³»ç»ŸAPIçš„è°ƒç”¨æ¬¡æ•°ï¼Œæé«˜äº†æ•ˆç‡ã€‚</p><h3 id="å¼‚æ­¥asynchronous"><a href="#å¼‚æ­¥asynchronous" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å¼‚æ­¥asynchronous"></a> å¼‚æ­¥ï¼ˆasynchronousï¼‰</h3><p>Linuxä¸­ï¼Œå¯ä»¥è°ƒç”¨ aio_read å‡½æ•°å‘Šè¯‰å†…æ ¸æè¿°å­—ç¼“å†²åŒºæŒ‡é’ˆå’Œç¼“å†²åŒºçš„å¤§å°ã€æ–‡ä»¶åç§»åŠé€šçŸ¥çš„æ–¹å¼ï¼Œç„¶åç«‹å³è¿”å›ï¼Œå½“å†…æ ¸å°†æ•°æ®æ‹·è´åˆ°ç¼“å†²åŒºåï¼Œå†é€šçŸ¥åº”ç”¨ç¨‹åº</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230823155255891.png" alt="image-20230823155255891"></p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Asynchronous I/O control block. */</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">aiocb</span> &#123;</span><br><span class="line">    <span class="type">int</span> aio_fildes; <span class="comment">/* File desriptor. */</span></span><br><span class="line">    <span class="type">int</span> aio_lio_opcode; <span class="comment">/* Operation to be performed. */</span></span><br><span class="line">    <span class="type">int</span> aio_reqprio; <span class="comment">/* Request priority offset. */</span></span><br><span class="line">    <span class="keyword">volatile</span> <span class="type">void</span> *aio_buf; <span class="comment">/* Location of buffer. */</span></span><br><span class="line">    <span class="type">size_t</span> aio_nbytes; <span class="comment">/* Length of transfer. */</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sigevent</span> aio_sigevent; <span class="comment">/* Signal number and value. */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* Internal members. */</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">aiocb</span> *__next_prio;</span><br><span class="line">    <span class="type">int</span> __abs_prio;</span><br><span class="line">    <span class="type">int</span> __policy;</span><br><span class="line">    <span class="type">int</span> __error_code;</span><br><span class="line">    <span class="type">__ssize_t</span> __return_value;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">#<span class="keyword">ifndef</span> __USE_FILE_OFFSET64</span></span><br><span class="line">        <span class="type">__off_t</span> aio_offset; <span class="comment">/* File offset. */</span></span><br><span class="line">        <span class="type">char</span> __pad[<span class="built_in">sizeof</span> (<span class="type">__off64_t</span>) - <span class="built_in">sizeof</span> (<span class="type">__off_t</span>)];</span><br><span class="line">    <span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">        <span class="type">__off64_t</span> aio_offset; <span class="comment">/* File offset. */</span></span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">        <span class="type">char</span> __glibc_reserved[<span class="number">32</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><h2 id="web-serverç½‘é¡µæœåŠ¡å™¨"><a href="#web-serverç½‘é¡µæœåŠ¡å™¨" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#web-serverç½‘é¡µæœåŠ¡å™¨"></a> Web Server(ç½‘é¡µæœåŠ¡å™¨)</h2><p>ä¸€ä¸ª Web Server å°±æ˜¯ä¸€ä¸ªæœåŠ¡å™¨è½¯ä»¶ï¼ˆç¨‹åºï¼‰ï¼Œæˆ–è€…æ˜¯è¿è¡Œè¿™ä¸ªæœåŠ¡å™¨è½¯ä»¶çš„ç¡¬ä»¶ï¼ˆè®¡ç®—æœºï¼‰ã€‚å…¶ä¸»è¦åŠŸèƒ½æ˜¯é€šè¿‡ HTTP åè®®ä¸å®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯æµè§ˆå™¨ï¼ˆBrowserï¼‰ï¼‰è¿›è¡Œé€šä¿¡ï¼Œæ¥æ¥æ”¶ï¼Œå­˜å‚¨ï¼Œå¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚ï¼Œå¹¶å¯¹å…¶è¯·æ±‚åšå‡º HTTP å“åº”ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯å…¶è¯·æ±‚çš„å†…å®¹ï¼ˆæ–‡ä»¶ã€ç½‘é¡µç­‰ï¼‰æˆ–è¿” å›ä¸€ä¸ª Error ä¿¡æ¯ã€‚</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230825104334383.png" alt="image-20230825104334383"></p><p>é€šå¸¸ç”¨æˆ·ä½¿ç”¨ Web æµè§ˆå™¨ä¸ç›¸åº”æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚åœ¨æµè§ˆå™¨ä¸­é”®å…¥â€œåŸŸåâ€æˆ–â€œIPåœ°å€:ç«¯å£å·â€ï¼Œæµè§ˆå™¨åˆ™ å…ˆå°†ä½ çš„åŸŸåè§£ææˆç›¸åº”çš„ IP åœ°å€æˆ–è€…ç›´æ¥æ ¹æ®ä½ çš„IPåœ°å€å‘å¯¹åº”çš„ Web æœåŠ¡å™¨å‘é€ä¸€ä¸ª HTTP è¯·æ±‚ã€‚è¿™ä¸€è¿‡ç¨‹é¦–å…ˆè¦é€šè¿‡ TCP åè®®çš„ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹ä¸ç›®æ ‡ Web æœåŠ¡å™¨çš„è¿æ¥ï¼Œç„¶å HTTP åè®®ç”Ÿæˆé’ˆ å¯¹ç›®æ ‡ Web æœåŠ¡å™¨çš„ HTTP è¯·æ±‚æŠ¥æ–‡ï¼Œé€šè¿‡ TCPã€IP ç­‰åè®®å‘é€åˆ°ç›®æ ‡ Web æœåŠ¡å™¨ä¸Šã€‚</p><h2 id="httpåè®®åº”ç”¨å±‚çš„åè®®"><a href="#httpåè®®åº”ç”¨å±‚çš„åè®®" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#httpåè®®åº”ç”¨å±‚çš„åè®®"></a> HTTPåè®®(åº”ç”¨å±‚çš„åè®®)</h2><h3 id="ç®€ä»‹-8"><a href="#ç®€ä»‹-8" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ç®€ä»‹-8"></a> ç®€ä»‹</h3><p>è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHypertext Transfer Protocolï¼ŒHTTPï¼‰æ˜¯ä¸€ä¸ªç®€å•çš„è¯·æ±‚ - å“åº”åè®®ï¼Œå®ƒé€šå¸¸è¿è¡Œåœ¨ TCP ä¹‹ä¸Šã€‚å®ƒæŒ‡å®šäº†å®¢æˆ·ç«¯å¯èƒ½å‘é€ç»™æœåŠ¡å™¨ä»€ä¹ˆæ ·çš„æ¶ˆæ¯ä»¥åŠå¾—åˆ°ä»€ä¹ˆæ ·çš„å“åº”ã€‚<strong>è¯·æ±‚å’Œå“åº”æ¶ˆæ¯çš„å¤´ä»¥ ASCII å½¢å¼ç»™å‡ºï¼›è€Œæ¶ˆæ¯å†…å®¹åˆ™å…·æœ‰ä¸€ä¸ªç±»ä¼¼ MIME çš„æ ¼å¼ã€‚HTTPæ˜¯ä¸‡ç»´ç½‘çš„æ•°æ®é€šä¿¡çš„åŸºç¡€ã€‚</strong></p><p>HTTPçš„å‘å±•æ˜¯ç”±è’‚å§†Â·ä¼¯çº³æ–¯-æäº1989å¹´åœ¨æ¬§æ´²æ ¸å­ç ”ç©¶ç»„ç»‡ï¼ˆCERNï¼‰æ‰€å‘èµ·ã€‚HTTPçš„æ ‡å‡†åˆ¶å®šç”±ä¸‡ ç»´ç½‘åä¼šï¼ˆWorld Wide Web Consortiumï¼ŒW3Cï¼‰å’Œäº’è”ç½‘å·¥ç¨‹ä»»åŠ¡ç»„ï¼ˆInternet Engineering Task Forceï¼ŒIETFï¼‰è¿›è¡Œåè°ƒï¼Œæœ€ç»ˆå‘å¸ƒäº†ä¸€ç³»åˆ—çš„RFCï¼Œå…¶ä¸­æœ€è‘—åçš„æ˜¯1999å¹´6æœˆå…¬å¸ƒçš„ RFC 2616ï¼Œå®š ä¹‰äº†HTTPåè®®ä¸­ç°ä»Šå¹¿æ³›ä½¿ç”¨çš„ä¸€ä¸ªç‰ˆæœ¬â€”â€”HTTP 1.1ã€‚</p><h3 id="æ¦‚è¿°-3"><a href="#æ¦‚è¿°-3" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ¦‚è¿°-3"></a> æ¦‚è¿°</h3><p>HTTP æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯ç»ˆç«¯ï¼ˆç”¨æˆ·ï¼‰å’ŒæœåŠ¡å™¨ç«¯ï¼ˆç½‘ç«™ï¼‰è¯·æ±‚å’Œåº”ç­”çš„æ ‡å‡†ï¼ˆTCPï¼‰ã€‚é€šè¿‡ä½¿ç”¨ç½‘é¡µæµè§ˆå™¨ã€ç½‘ç»œçˆ¬è™«æˆ–è€…å…¶å®ƒçš„å·¥å…·ï¼Œå®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªHTTPè¯·æ±‚åˆ°æœåŠ¡å™¨ä¸ŠæŒ‡å®šç«¯å£ï¼ˆé»˜è®¤ç«¯å£ä¸º80ï¼‰ã€‚æˆ‘ä»¬ ç§°è¿™ä¸ªå®¢æˆ·ç«¯ä¸ºç”¨æˆ·ä»£ç†ç¨‹åºï¼ˆuser agentï¼‰ã€‚åº”ç­”çš„æœåŠ¡å™¨ä¸Šå­˜å‚¨ç€ä¸€äº›èµ„æºï¼Œæ¯”å¦‚ HTML æ–‡ä»¶å’Œå›¾ åƒã€‚æˆ‘ä»¬ç§°è¿™ä¸ªåº”ç­”æœåŠ¡å™¨ä¸ºæºæœåŠ¡å™¨ï¼ˆorigin serverï¼‰ã€‚åœ¨ç”¨æˆ·ä»£ç†å’ŒæºæœåŠ¡å™¨ä¸­é—´å¯èƒ½å­˜åœ¨å¤šä¸ªâ€œä¸­ é—´å±‚â€ï¼Œæ¯”å¦‚ä»£ç†æœåŠ¡å™¨ã€ç½‘å…³æˆ–è€…éš§é“ï¼ˆtunnelï¼‰ã€‚</p><p>å°½ç®¡ TCP/IP åè®®æ˜¯äº’è”ç½‘ä¸Šæœ€æµè¡Œçš„åº”ç”¨ï¼ŒHTTP åè®®ä¸­ï¼Œå¹¶æ²¡æœ‰è§„å®šå¿…é¡»ä½¿ç”¨å®ƒæˆ–å®ƒæ”¯æŒçš„å±‚ã€‚äº‹å® ä¸Šï¼ŒHTTPå¯ä»¥åœ¨ä»»ä½•äº’è”ç½‘åè®®ä¸Šï¼Œæˆ–å…¶ä»–ç½‘ç»œä¸Šå®ç°ã€‚HTTP å‡å®šå…¶ä¸‹å±‚åè®®æä¾›å¯é çš„ä¼ è¾“ã€‚å› æ­¤ï¼Œä»»ä½•èƒ½å¤Ÿæä¾›è¿™ç§ä¿è¯çš„åè®®éƒ½å¯ä»¥è¢«å…¶ä½¿ç”¨ã€‚å› æ­¤ä¹Ÿå°±æ˜¯å…¶åœ¨ TCP/IP åè®®æ—ä½¿ç”¨ TCP ä½œä¸ºå…¶ä¼ è¾“å±‚ã€‚</p><p>é€šå¸¸ï¼Œç”±HTTPå®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ªåˆ°æœåŠ¡å™¨æŒ‡å®šç«¯å£ï¼ˆé»˜è®¤æ˜¯80ç«¯å£ï¼‰çš„ TCP è¿æ¥ã€‚HTTP æœåŠ¡å™¨åˆ™åœ¨é‚£ä¸ªç«¯å£ç›‘å¬å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚ä¸€æ—¦æ”¶åˆ°è¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¼šå‘å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªçŠ¶æ€ï¼Œæ¯” å¦‚&quot;HTTP/1.1 200 OK&quot;ï¼Œä»¥åŠè¿”å›çš„å†…å®¹ï¼Œå¦‚è¯·æ±‚çš„æ–‡ä»¶ã€é”™è¯¯æ¶ˆæ¯ã€æˆ–è€…å…¶å®ƒä¿¡æ¯ã€‚</p><h3 id="å·¥ä½œåŸç†-3"><a href="#å·¥ä½œåŸç†-3" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#å·¥ä½œåŸç†-3"></a> å·¥ä½œåŸç†</h3><p><strong>HTTP åè®®å®šä¹‰ Web å®¢æˆ·ç«¯å¦‚ä½•ä» Web æœåŠ¡å™¨è¯·æ±‚ Web é¡µé¢ï¼Œä»¥åŠæœåŠ¡å™¨å¦‚ä½•æŠŠ Web é¡µé¢ä¼ é€ç»™å®¢æˆ·ç«¯ã€‚HTTP åè®®é‡‡ç”¨äº†è¯·æ±‚/å“åº”æ¨¡å‹ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚æŠ¥æ–‡ï¼Œè¯·æ±‚æŠ¥æ–‡åŒ…å«è¯·æ±‚çš„æ–¹ æ³•ã€URLã€åè®®ç‰ˆæœ¬ã€è¯·æ±‚å¤´éƒ¨å’Œè¯·æ±‚æ•°æ®ã€‚æœåŠ¡å™¨ä»¥ä¸€ä¸ªçŠ¶æ€è¡Œä½œä¸ºå“åº”ï¼Œå“åº”çš„å†…å®¹åŒ…æ‹¬åè®®çš„ç‰ˆ æœ¬ã€æˆåŠŸæˆ–è€…é”™è¯¯ä»£ç ã€æœåŠ¡å™¨ä¿¡æ¯ã€å“åº”å¤´éƒ¨å’Œå“åº”æ•°æ®ã€‚</strong></p><p>ä»¥ä¸‹æ˜¯ HTTP è¯·æ±‚/å“åº”çš„æ­¥éª¤ï¼š</p><ol><li>å®¢æˆ·ç«¯è¿æ¥åˆ° Web æœåŠ¡å™¨ ä¸€ä¸ªHTTPå®¢æˆ·ç«¯ï¼Œé€šå¸¸æ˜¯æµè§ˆå™¨ï¼Œä¸ Web æœåŠ¡å™¨çš„ HTTP ç«¯å£ï¼ˆé»˜è®¤ä¸º 80 ï¼‰å»ºç«‹ä¸€ä¸ª TCP å¥—æ¥å­—è¿æ¥ã€‚ä¾‹å¦‚ï¼Œ<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="http://www.baidu.com">http://www.baidu.com</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>ã€‚ï¼ˆURLï¼‰</li><li>å‘é€ HTTP è¯·æ±‚ é€šè¿‡ TCP å¥—æ¥å­—ï¼Œå®¢æˆ·ç«¯å‘ Web æœåŠ¡å™¨å‘é€ä¸€ä¸ªæ–‡æœ¬çš„è¯·æ±‚æŠ¥æ–‡ï¼Œä¸€ä¸ªè¯·æ±‚æŠ¥æ–‡ç”±è¯·æ±‚è¡Œã€è¯·æ±‚å¤´éƒ¨ã€ç©ºè¡Œå’Œè¯·æ±‚æ•°æ® 4 éƒ¨åˆ†ç»„æˆã€‚</li><li>æœåŠ¡å™¨æ¥å—è¯·æ±‚å¹¶è¿”å› HTTP å“åº” Web æœåŠ¡å™¨è§£æè¯·æ±‚ï¼Œå®šä½è¯·æ±‚èµ„æºã€‚æœåŠ¡å™¨å°†èµ„æºå¤æœ¬å†™åˆ° TCP å¥—æ¥å­—ï¼Œç”±å®¢æˆ·ç«¯è¯»å–ã€‚ä¸€ä¸ª å“åº”ç”±çŠ¶æ€è¡Œã€å“åº”å¤´éƒ¨ã€ç©ºè¡Œå’Œå“åº”æ•°æ® 4 éƒ¨åˆ†ç»„æˆã€‚</li><li>é‡Šæ”¾è¿æ¥ TCP è¿æ¥ è‹¥ connection æ¨¡å¼ä¸º closeï¼Œåˆ™æœåŠ¡å™¨ä¸»åŠ¨å…³é—­ TCPè¿æ¥ï¼Œå®¢æˆ·ç«¯è¢«åŠ¨å…³é—­è¿æ¥ï¼Œé‡Šæ”¾ TCP è¿ æ¥ï¼›è‹¥connection æ¨¡å¼ä¸º keepaliveï¼Œåˆ™è¯¥è¿æ¥ä¼šä¿æŒä¸€æ®µæ—¶é—´ï¼Œåœ¨è¯¥æ—¶é—´å†…å¯ä»¥ç»§ç»­æ¥æ”¶è¯·æ±‚;</li><li>å®¢æˆ·ç«¯æµè§ˆå™¨è§£æ HTML å†…å®¹ å®¢æˆ·ç«¯æµè§ˆå™¨é¦–å…ˆè§£æçŠ¶æ€è¡Œï¼ŒæŸ¥çœ‹è¡¨æ˜è¯·æ±‚æ˜¯å¦æˆåŠŸçš„çŠ¶æ€ä»£ç ã€‚ç„¶åè§£ææ¯ä¸€ä¸ªå“åº”å¤´ï¼Œå“åº” å¤´å‘ŠçŸ¥ä»¥ä¸‹ä¸ºè‹¥å¹²å­—èŠ‚çš„ HTML æ–‡æ¡£å’Œæ–‡æ¡£çš„å­—ç¬¦é›†ã€‚å®¢æˆ·ç«¯æµè§ˆå™¨è¯»å–å“åº”æ•°æ® HTMLï¼Œæ ¹æ® HTML çš„è¯­æ³•å¯¹å…¶è¿›è¡Œæ ¼å¼åŒ–ï¼Œå¹¶åœ¨æµè§ˆå™¨çª—å£ä¸­æ˜¾ç¤ºã€‚</li></ol><p>ä¾‹å¦‚ï¼šåœ¨æµè§ˆå™¨åœ°å€æ é”®å…¥URLï¼ŒæŒ‰ä¸‹å›è½¦ä¹‹åä¼šç»å†ä»¥ä¸‹æµç¨‹ï¼š</p><ol><li>æµè§ˆå™¨å‘ DNS æœåŠ¡å™¨è¯·æ±‚è§£æè¯¥ URL ä¸­çš„åŸŸåæ‰€å¯¹åº”çš„ IP åœ°å€;</li><li>è§£æå‡º IP åœ°å€åï¼Œæ ¹æ®è¯¥ IP åœ°å€å’Œé»˜è®¤ç«¯å£ 80ï¼Œå’ŒæœåŠ¡å™¨å»ºç«‹ TCP è¿æ¥;</li><li>æµè§ˆå™¨å‘å‡ºè¯»å–æ–‡ä»¶ï¼ˆ URL ä¸­åŸŸååé¢éƒ¨åˆ†å¯¹åº”çš„æ–‡ä»¶ï¼‰çš„ HTTP è¯·æ±‚ï¼Œè¯¥è¯·æ±‚æŠ¥æ–‡ä½œä¸º TCP ä¸‰æ¬¡æ¡æ‰‹çš„ç¬¬ä¸‰ä¸ªæŠ¥æ–‡çš„æ•°æ®å‘é€ç»™æœåŠ¡å™¨;</li><li>æœåŠ¡å™¨å¯¹æµè§ˆå™¨è¯·æ±‚ä½œå‡ºå“åº”ï¼Œå¹¶æŠŠå¯¹åº”çš„ HTML æ–‡æœ¬å‘é€ç»™æµè§ˆå™¨;</li><li>é‡Šæ”¾ TCP è¿æ¥;</li><li>æµè§ˆå™¨å°†è¯¥ HTML æ–‡æœ¬å¹¶æ˜¾ç¤ºå†…å®¹ã€‚</li></ol><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230825104527500.png" alt="image-20230825104527500"></p><p>HTTP åè®®æ˜¯åŸºäº TCP/IP åè®®ä¹‹ä¸Šçš„åº”ç”¨å±‚åè®®ï¼ŒåŸºäº è¯·æ±‚-å“åº” çš„æ¨¡å¼ã€‚HTTP åè®®è§„å®šï¼Œè¯·æ±‚ä»å®¢ æˆ·ç«¯å‘å‡ºï¼Œæœ€åæœåŠ¡å™¨ç«¯å“åº”è¯¥è¯·æ±‚å¹¶è¿”å›ã€‚æ¢å¥è¯è¯´ï¼Œè‚¯å®šæ˜¯å…ˆä»å®¢æˆ·ç«¯å¼€å§‹å»ºç«‹é€šä¿¡çš„ï¼ŒæœåŠ¡å™¨ç«¯ åœ¨æ²¡æœ‰æ¥æ”¶åˆ°è¯·æ±‚ä¹‹å‰ä¸ä¼šå‘é€å“åº”ã€‚</p><h3 id="httpè¯·æ±‚æŠ¥æ–‡æ ¼å¼"><a href="#httpè¯·æ±‚æŠ¥æ–‡æ ¼å¼" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#httpè¯·æ±‚æŠ¥æ–‡æ ¼å¼"></a> HTTPè¯·æ±‚æŠ¥æ–‡æ ¼å¼</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230825104549067.png" alt="image-20230825104549067"></p><p>è¯·æ±‚å¤´ç¤ºä¾‹ï¼š</p><figure class="highlight http"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate, br</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>BAIDUID_BFESS=EDD638FDDEE39DA6726BEF39B766F772:FG=1; BIDUPSID=EDD638FDDEE39DA6726BEF39B766F772; PSTM=1692844550; BD_UPN=12314753; ZFY=k1Qc:BgGUBKTsi3GUtqJh0rkU8WABgG3nCPeWyqD:BLRs:C; BA_HECTOR=010g810l2ga525208lag0k0q1ieg58u1o; RT=&quot;z=1&amp;dm=baidu.com&amp;si=de024639-c7be-4913-b467-d3935e4a8d1b&amp;ss=llpzta3z&amp;sl=0&amp;tt=0&amp;bcn=https%3A%2F%2Ffclog.baidu.com%2Flog%2Fweirwood%3Ftype%3Dperf&amp;ul=vdy&amp;hd=vef&quot;</span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>www.baidu.com</span><br><span class="line"><span class="attribute">Sec-Fetch-Dest</span><span class="punctuation">: </span>document</span><br><span class="line"><span class="attribute">Sec-Fetch-Mode</span><span class="punctuation">: </span>navigate</span><br><span class="line"><span class="attribute">Sec-Fetch-Site</span><span class="punctuation">: </span>none</span><br><span class="line"><span class="attribute">Sec-Fetch-User</span><span class="punctuation">: </span>?1</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36 Edg/114.0.1823.37</span><br><span class="line"><span class="attribute">sec-ch-ua</span><span class="punctuation">: </span>&quot;Not.A/Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;114&quot;, &quot;Microsoft Edge&quot;;v=&quot;114&quot;</span><br><span class="line"><span class="attribute">sec-ch-ua-mobile</span><span class="punctuation">: </span>?0</span><br><span class="line"><span class="attribute">sec-ch-ua-platform</span><span class="punctuation">: </span>&quot;Windows&quot;</span><br></pre></td></tr></table></div></figure><h3 id="httpå“åº”æŠ¥æ–‡æ ¼å¼"><a href="#httpå“åº”æŠ¥æ–‡æ ¼å¼" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#httpå“åº”æŠ¥æ–‡æ ¼å¼"></a> HTTPå“åº”æŠ¥æ–‡æ ¼å¼</h3><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230825104624298.png" alt="image-20230825104624298"></p><p>å“åº”å¤´ç¤ºä¾‹ï¼š</p><figure class="highlight http"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"><span class="attribute">Content-Encoding</span><span class="punctuation">: </span>gzip</span><br><span class="line"><span class="attribute">Content-Security-Policy</span><span class="punctuation">: </span>frame-ancestors &#x27;self&#x27; https://chat.baidu.com http://mirror-chat.baidu.com https://fj-chat.baidu.com https://hba-chat.baidu.com https://hbe-chat.baidu.com https://njjs-chat.baidu.com https://nj-chat.baidu.com https://hna-chat.baidu.com https://hnb-chat.baidu.com http://debug.baidu-int.com;</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html; charset=utf-8</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Fri, 25 Aug 2023 03:37:36 GMT</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>BWS/1.1</span><br><span class="line"><span class="attribute">Traceid</span><span class="punctuation">: </span>1692934656033891585015847248764579371337</span><br><span class="line"><span class="attribute">X-Ua-Compatible</span><span class="punctuation">: </span>IE=Edge,chrome=1</span><br><span class="line"><span class="attribute">Transfer-Encoding</span><span class="punctuation">: </span>chunked</span><br><span class="line"></span><br><span class="line"><span class="language-jboss-cli"><span class="string">//</span> å“åº”æ­£æ–‡<span class="params">(å’Œå“åº”å¤´ä¹‹é—´æœ‰ä¸€ä¸ªç©ºè¡Œ)</span></span></span><br><span class="line"><span class="language-jboss-cli"><span class="string">...</span></span></span><br></pre></td></tr></table></div></figure><h3 id="httpè¯·æ±‚æ–¹æ³•"><a href="#httpè¯·æ±‚æ–¹æ³•" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#httpè¯·æ±‚æ–¹æ³•"></a> HTTPè¯·æ±‚æ–¹æ³•</h3><p>HTTP/1.1 åè®®ä¸­å…±å®šä¹‰äº†å…«ç§æ–¹æ³•ï¼ˆä¹Ÿå«â€œåŠ¨ä½œâ€ï¼‰æ¥ä»¥ä¸åŒæ–¹å¼æ“ä½œæŒ‡å®šçš„èµ„æºï¼š</p><ol><li><strong>GETï¼šå‘æŒ‡å®šçš„èµ„æºå‘å‡ºâ€œæ˜¾ç¤ºâ€è¯·æ±‚ã€‚ä½¿ç”¨ GET æ–¹æ³•åº”è¯¥åªç”¨åœ¨è¯»å–æ•°æ®ï¼Œè€Œä¸åº”å½“è¢«ç”¨äºäº§ç”Ÿâ€œå‰¯ä½œç”¨â€çš„æ“ä½œä¸­ï¼Œä¾‹å¦‚åœ¨ Web Application ä¸­ã€‚å…¶ä¸­ä¸€ä¸ªåŸå› æ˜¯ GET å¯èƒ½ä¼šè¢«ç½‘ç»œèœ˜è››(çˆ¬è™«)ç­‰éšæ„è®¿é—®ã€‚</strong></li><li>HEADï¼šä¸ GET æ–¹æ³•ä¸€æ ·ï¼Œéƒ½æ˜¯å‘æœåŠ¡å™¨å‘å‡ºæŒ‡å®šèµ„æºçš„è¯·æ±‚ã€‚åªä¸è¿‡æœåŠ¡å™¨å°†ä¸ä¼ å›èµ„æºçš„æœ¬æ–‡éƒ¨åˆ†ã€‚å®ƒçš„å¥½å¤„åœ¨äºï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥åœ¨ä¸å¿…ä¼ è¾“å…¨éƒ¨å†…å®¹çš„æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥è·å–å…¶ä¸­â€œå…³äºè¯¥ èµ„æºçš„ä¿¡æ¯â€ï¼ˆå…ƒä¿¡æ¯æˆ–ç§°å…ƒæ•°æ®ï¼‰ã€‚</li><li><strong>POSTï¼šå‘æŒ‡å®šèµ„æºæäº¤æ•°æ®ï¼Œè¯·æ±‚æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼ˆä¾‹å¦‚æäº¤è¡¨å•æˆ–è€…ä¸Šä¼ æ–‡ä»¶ï¼‰ã€‚æ•°æ®è¢«åŒ…å«åœ¨è¯·æ±‚æœ¬æ–‡ä¸­ã€‚è¿™ä¸ªè¯·æ±‚å¯èƒ½ä¼šåˆ›å»ºæ–°çš„èµ„æºæˆ–ä¿®æ”¹ç°æœ‰èµ„æºï¼Œæˆ–äºŒè€…çš†æœ‰ã€‚</strong></li><li>PUTï¼šå‘æŒ‡å®šèµ„æºä½ç½®ä¸Šä¼ å…¶æœ€æ–°å†…å®¹ã€‚</li><li>DELETEï¼šè¯·æ±‚æœåŠ¡å™¨åˆ é™¤ Request-URI æ‰€æ ‡è¯†çš„èµ„æºã€‚</li><li>TRACEï¼šå›æ˜¾æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚ï¼Œä¸»è¦ç”¨äºæµ‹è¯•æˆ–è¯Šæ–­ã€‚</li><li>OPTIONSï¼šè¿™ä¸ªæ–¹æ³•å¯ä½¿æœåŠ¡å™¨ä¼ å›è¯¥èµ„æºæ‰€æ”¯æŒçš„æ‰€æœ‰ HTTP è¯·æ±‚æ–¹æ³•ã€‚ç”¨â€™*'æ¥ä»£æ›¿èµ„æºåç§°ï¼Œ å‘ Web æœåŠ¡å™¨å‘é€ OPTIONS è¯·æ±‚ï¼Œå¯ä»¥æµ‹è¯•æœåŠ¡å™¨åŠŸèƒ½æ˜¯å¦æ­£å¸¸è¿ä½œã€‚</li><li>CONNECTï¼šHTTP/1.1 åè®®ä¸­é¢„ç•™ç»™èƒ½å¤Ÿå°†è¿æ¥æ”¹ä¸ºç®¡é“æ–¹å¼çš„ä»£ç†æœåŠ¡å™¨ã€‚é€šå¸¸ç”¨äºSSLåŠ å¯†æœ åŠ¡å™¨çš„é“¾æ¥ï¼ˆç»ç”±éåŠ å¯†çš„ HTTP ä»£ç†æœåŠ¡å™¨ï¼‰ã€‚</li></ol><h3 id="httpçŠ¶æ€ç "><a href="#httpçŠ¶æ€ç " class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#httpçŠ¶æ€ç "></a> HTTPçŠ¶æ€ç </h3><p>æ‰€æœ‰HTTPå“åº”çš„ç¬¬ä¸€è¡Œéƒ½æ˜¯çŠ¶æ€è¡Œï¼Œä¾æ¬¡æ˜¯å½“å‰HTTPç‰ˆæœ¬å·ï¼Œ3ä½æ•°å­—ç»„æˆçš„çŠ¶æ€ä»£ç ï¼Œä»¥åŠæè¿°çŠ¶æ€ çš„çŸ­è¯­ï¼Œå½¼æ­¤ç”±ç©ºæ ¼åˆ†éš”ã€‚</p><p><strong>çŠ¶æ€ä»£ç çš„ç¬¬ä¸€ä¸ªæ•°å­—ä»£è¡¨å½“å‰å“åº”çš„ç±»å‹ï¼š</strong></p><ul><li><strong>1xxæ¶ˆæ¯â€”â€”è¯·æ±‚å·²è¢«æœåŠ¡å™¨æ¥æ”¶ï¼Œç»§ç»­å¤„ç†</strong></li><li><strong>2xxæˆåŠŸâ€”â€”è¯·æ±‚å·²æˆåŠŸè¢«æœåŠ¡å™¨æ¥æ”¶ã€ç†è§£ã€å¹¶æ¥å—</strong></li><li><strong>3xxé‡å®šå‘â€”â€”éœ€è¦åç»­æ“ä½œæ‰èƒ½å®Œæˆè¿™ä¸€è¯·æ±‚</strong></li><li><strong>4xxè¯·æ±‚é”™è¯¯â€”â€”è¯·æ±‚å«æœ‰è¯æ³•é”™è¯¯æˆ–è€…æ— æ³•è¢«æ‰§è¡Œ</strong></li><li><strong>5xxæœåŠ¡å™¨é”™è¯¯â€”â€”æœåŠ¡å™¨åœ¨å¤„ç†æŸä¸ªæ­£ç¡®è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯</strong></li></ul><p>è™½ç„¶ RFC 2616 ä¸­å·²ç»æ¨èäº†æè¿°çŠ¶æ€çš„çŸ­è¯­ï¼Œä¾‹å¦‚&quot;200 OK&quot;ï¼Œâ€œ404 Not Foundâ€ï¼Œä½†æ˜¯WEBå¼€å‘è€…ä» ç„¶èƒ½å¤Ÿè‡ªè¡Œå†³å®šé‡‡ç”¨ä½•ç§çŸ­è¯­ï¼Œç”¨ä»¥æ˜¾ç¤ºæœ¬åœ°åŒ–çš„çŠ¶æ€æè¿°æˆ–è€…è‡ªå®šä¹‰ä¿¡æ¯ã€‚</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230825104759498.png" alt="image-20230825104759498"></p><p>æ›´å¤šçŠ¶æ€ç : <span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://baike.baidu.com/item/HTTP%E7%8A%B6%E6%80%81%E7%A0%81/5053660?r=aladdin">https://baike.baidu.com/item/HTTPçŠ¶æ€ç /5053660?r=aladdin</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><h2 id="æœåŠ¡å™¨ç¼–ç¨‹åŸºæœ¬æ¡†æ¶"><a href="#æœåŠ¡å™¨ç¼–ç¨‹åŸºæœ¬æ¡†æ¶" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æœåŠ¡å™¨ç¼–ç¨‹åŸºæœ¬æ¡†æ¶"></a> æœåŠ¡å™¨ç¼–ç¨‹åŸºæœ¬æ¡†æ¶</h2><p>è™½ç„¶æœåŠ¡å™¨ç¨‹åºç§ç±»ç¹å¤šï¼Œä½†å…¶åŸºæœ¬æ¡†æ¶éƒ½ä¸€æ ·ï¼Œä¸åŒä¹‹å¤„åœ¨äºé€»è¾‘å¤„ç†ã€‚</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230825114344227.png" alt="image-20230825114344227"></p><div class="table-container"><table><thead><tr><th>æ¨¡å—</th><th style="text-align:left">åŠŸèƒ½</th></tr></thead><tbody><tr><td>I/O å¤„ç†å•å…ƒ</td><td style="text-align:left">å¤„ç†å®¢æˆ·è¿æ¥ï¼Œè¯»å†™ç½‘ç»œæ•°æ®</td></tr><tr><td>é€»è¾‘å•å…ƒ</td><td style="text-align:left">ä¸šåŠ¡è¿›ç¨‹æˆ–çº¿ç¨‹</td></tr><tr><td>ç½‘ç»œå­˜å‚¨å•å…ƒ</td><td style="text-align:left">æ•°æ®åº“ã€æ–‡ä»¶æˆ–ç¼“å­˜</td></tr><tr><td>è¯·æ±‚é˜Ÿåˆ—</td><td style="text-align:left">å„å•å…ƒä¹‹é—´çš„é€šä¿¡æ–¹å¼</td></tr></tbody></table></div><p><strong>I/O å¤„ç†å•å…ƒæ˜¯æœåŠ¡å™¨ç®¡ç†å®¢æˆ·è¿æ¥çš„æ¨¡å—ã€‚å®ƒé€šå¸¸è¦å®Œæˆä»¥ä¸‹å·¥ä½œï¼šç­‰å¾…å¹¶æ¥å—æ–°çš„å®¢æˆ·è¿æ¥ï¼Œæ¥æ”¶å®¢æˆ·æ•°æ®ï¼Œå°†æœåŠ¡å™¨å“åº”æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ä½†æ˜¯æ•°æ®çš„æ”¶å‘ä¸ä¸€å®šåœ¨ I/O å¤„ç†å•å…ƒä¸­æ‰§è¡Œï¼Œä¹Ÿå¯èƒ½åœ¨ é€»è¾‘å•å…ƒä¸­æ‰§è¡Œï¼Œå…·ä½“åœ¨ä½•å¤„æ‰§è¡Œå–å†³äºäº‹ä»¶å¤„ç†æ¨¡å¼ã€‚</strong></p><p><strong>ä¸€ä¸ªé€»è¾‘å•å…ƒé€šå¸¸æ˜¯ä¸€ä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹ã€‚å®ƒåˆ†æå¹¶å¤„ç†å®¢æˆ·æ•°æ®ï¼Œç„¶åå°†ç»“æœä¼ é€’ç»™ I/O å¤„ç†å•å…ƒæˆ–è€…ç›´æ¥å‘é€ç»™å®¢æˆ·ç«¯ï¼ˆå…·ä½“ä½¿ç”¨å“ªç§æ–¹å¼å–å†³äºäº‹ä»¶å¤„ç†æ¨¡å¼ï¼‰ã€‚æœåŠ¡å™¨é€šå¸¸æ‹¥æœ‰å¤šä¸ªé€»è¾‘å•å…ƒï¼Œä»¥å®ç°å¯¹å¤šä¸ªå®¢æˆ·ä»»åŠ¡çš„å¹¶å‘å¤„ç†ã€‚</strong></p><p><strong>ç½‘ç»œå­˜å‚¨å•å…ƒå¯ä»¥æ˜¯æ•°æ®åº“ã€ç¼“å­˜å’Œæ–‡ä»¶ï¼Œä½†ä¸æ˜¯å¿…é¡»çš„ã€‚</strong></p><p><strong>è¯·æ±‚é˜Ÿåˆ—æ˜¯å„å•å…ƒä¹‹é—´çš„é€šä¿¡æ–¹å¼çš„æŠ½è±¡ã€‚I/O å¤„ç†å•å…ƒæ¥æ”¶åˆ°å®¢æˆ·è¯·æ±‚æ—¶ï¼Œéœ€è¦ä»¥æŸç§æ–¹å¼é€šçŸ¥ä¸€ä¸ª é€»è¾‘å•å…ƒæ¥å¤„ç†è¯¥è¯·æ±‚ã€‚åŒæ ·ï¼Œå¤šä¸ªé€»è¾‘å•å…ƒåŒæ—¶è®¿é—®ä¸€ä¸ªå­˜å‚¨å•å…ƒæ—¶ï¼Œä¹Ÿéœ€è¦é‡‡ç”¨æŸç§æœºåˆ¶æ¥åè°ƒå¤„ ç†ç«æ€æ¡ä»¶ã€‚è¯·æ±‚é˜Ÿåˆ—é€šå¸¸è¢«å®ç°ä¸ºæ± çš„ä¸€éƒ¨åˆ†ã€‚</strong></p><h2 id="ä¸¤ç§é«˜æ•ˆçš„äº‹ä»¶å¤„ç†æ¨¡å¼"><a href="#ä¸¤ç§é«˜æ•ˆçš„äº‹ä»¶å¤„ç†æ¨¡å¼" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#ä¸¤ç§é«˜æ•ˆçš„äº‹ä»¶å¤„ç†æ¨¡å¼"></a> ä¸¤ç§é«˜æ•ˆçš„äº‹ä»¶å¤„ç†æ¨¡å¼</h2><p><strong>æœåŠ¡å™¨ç¨‹åºé€šå¸¸éœ€è¦å¤„ç†ä¸‰ç±»äº‹ä»¶ï¼šI/O äº‹ä»¶ã€ä¿¡å·åŠå®šæ—¶äº‹ä»¶ã€‚æœ‰ä¸¤ç§é«˜æ•ˆçš„äº‹ä»¶å¤„ç†æ¨¡å¼ï¼šReactor å’Œ Proactorï¼ŒåŒæ­¥ I/O æ¨¡å‹é€šå¸¸ç”¨äºå®ç° Reactor æ¨¡å¼ï¼Œå¼‚æ­¥ I/O æ¨¡å‹é€šå¸¸ç”¨äºå®ç° Proactor æ¨¡å¼ã€‚</strong></p><h3 id="reactoræ¨¡å¼"><a href="#reactoræ¨¡å¼" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#reactoræ¨¡å¼"></a> Reactoræ¨¡å¼</h3><p><strong>è¦æ±‚ä¸»çº¿ç¨‹ï¼ˆI/Oå¤„ç†å•å…ƒï¼‰åªè´Ÿè´£ç›‘å¬æ–‡ä»¶æè¿°ç¬¦ä¸Šæ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼Œæœ‰çš„è¯å°±ç«‹å³å°†è¯¥äº‹ä»¶é€šçŸ¥å·¥ä½œ çº¿ç¨‹ï¼ˆé€»è¾‘å•å…ƒï¼‰ï¼Œå°† socket å¯è¯»å¯å†™äº‹ä»¶æ”¾å…¥è¯·æ±‚é˜Ÿåˆ—ï¼Œäº¤ç»™å·¥ä½œçº¿ç¨‹å¤„ç†ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¸»çº¿ç¨‹ä¸åšä»»ä½•å…¶ä»–å®è´¨æ€§çš„å·¥ä½œã€‚è¯»å†™æ•°æ®ï¼Œæ¥å—æ–°çš„è¿æ¥ï¼Œä»¥åŠå¤„ç†å®¢æˆ·è¯·æ±‚å‡åœ¨å·¥ä½œçº¿ç¨‹ä¸­å®Œæˆã€‚</strong></p><p>ä½¿ç”¨åŒæ­¥ I/Oï¼ˆä»¥ epoll_wait ä¸ºä¾‹ï¼‰å®ç°çš„ Reactor æ¨¡å¼çš„å·¥ä½œæµç¨‹æ˜¯ï¼š</p><ol><li>ä¸»çº¿ç¨‹å¾€ epoll å†…æ ¸äº‹ä»¶è¡¨ä¸­æ³¨å†Œ socket ä¸Šçš„è¯»å°±ç»ªäº‹ä»¶ã€‚</li><li>ä¸»çº¿ç¨‹è°ƒç”¨ epoll_wait ç­‰å¾… socket ä¸Šæœ‰æ•°æ®å¯è¯»ã€‚</li><li>å½“ socket ä¸Šæœ‰æ•°æ®å¯è¯»æ—¶ï¼Œ epoll_wait é€šçŸ¥ä¸»çº¿ç¨‹ã€‚ä¸»çº¿ç¨‹åˆ™å°† socket å¯è¯»äº‹ä»¶æ”¾å…¥è¯·æ±‚é˜Ÿåˆ—ã€‚</li><li>ç¡çœ åœ¨è¯·æ±‚é˜Ÿåˆ—ä¸Šçš„æŸä¸ªå·¥ä½œçº¿ç¨‹è¢«å”¤é†’ï¼Œå®ƒä» socket è¯»å–æ•°æ®ï¼Œå¹¶å¤„ç†å®¢æˆ·è¯·æ±‚ï¼Œç„¶åå¾€ epoll å†…æ ¸äº‹ä»¶è¡¨ä¸­æ³¨å†Œè¯¥ socket ä¸Šçš„å†™å°±ç»ªäº‹ä»¶ã€‚</li><li>å½“ä¸»çº¿ç¨‹è°ƒç”¨ epoll_wait ç­‰å¾… socket å¯å†™ã€‚</li><li>å½“ socket å¯å†™æ—¶ï¼Œepoll_wait é€šçŸ¥ä¸»çº¿ç¨‹ã€‚ä¸»çº¿ç¨‹å°† socket å¯å†™äº‹ä»¶æ”¾å…¥è¯·æ±‚é˜Ÿåˆ—ã€‚</li><li>ç¡çœ åœ¨è¯·æ±‚é˜Ÿåˆ—ä¸Šçš„æŸä¸ªå·¥ä½œçº¿ç¨‹è¢«å”¤é†’ï¼Œå®ƒå¾€ socket ä¸Šå†™å…¥æœåŠ¡å™¨å¤„ç†å®¢æˆ·è¯·æ±‚çš„ç»“æœã€‚</li></ol><p>Reactor æ¨¡å¼çš„å·¥ä½œæµç¨‹ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230825114619086.png" alt="image-20230825114619086"></p><h3 id="proactoræ¨¡å¼"><a href="#proactoræ¨¡å¼" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#proactoræ¨¡å¼"></a> Proactoræ¨¡å¼</h3><p><strong>Proactor æ¨¡å¼å°†æ‰€æœ‰ I/O æ“ä½œéƒ½äº¤ç»™ä¸»çº¿ç¨‹å’Œå†…æ ¸æ¥å¤„ç†ï¼ˆè¿›è¡Œè¯»ã€å†™ï¼‰ï¼Œå·¥ä½œçº¿ç¨‹ä»…ä»…è´Ÿè´£ä¸šåŠ¡é€»è¾‘ã€‚</strong></p><p>ä½¿ç”¨å¼‚æ­¥ I/O æ¨¡å‹ï¼ˆä»¥ aio_read å’Œ aio_write ä¸ºä¾‹ï¼‰å®ç°çš„ Proactor æ¨¡å¼çš„å·¥ä½œæµç¨‹æ˜¯ï¼š</p><ol><li>ä¸»çº¿ç¨‹è°ƒç”¨ aio_read å‡½æ•°å‘å†…æ ¸æ³¨å†Œ socket ä¸Šçš„è¯»å®Œæˆäº‹ä»¶ï¼Œå¹¶å‘Šè¯‰å†…æ ¸ç”¨æˆ·è¯»ç¼“å†²åŒºçš„ä½ç½®ï¼Œ ä»¥åŠè¯»æ“ä½œå®Œæˆæ—¶å¦‚ä½•é€šçŸ¥åº”ç”¨ç¨‹åºï¼ˆè¿™é‡Œä»¥ä¿¡å·ä¸ºä¾‹ï¼‰ã€‚</li><li>ä¸»çº¿ç¨‹ç»§ç»­å¤„ç†å…¶ä»–é€»è¾‘ã€‚</li><li>å½“ socket ä¸Šçš„æ•°æ®è¢«è¯»å…¥ç”¨æˆ·ç¼“å†²åŒºåï¼Œå†…æ ¸å°†å‘åº”ç”¨ç¨‹åºå‘é€ä¸€ä¸ªä¿¡å·ï¼Œä»¥é€šçŸ¥åº”ç”¨ç¨‹åºæ•°æ®å·²ç»å¯ç”¨ã€‚</li><li>åº”ç”¨ç¨‹åºé¢„å…ˆå®šä¹‰å¥½çš„ä¿¡å·å¤„ç†å‡½æ•°é€‰æ‹©ä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ¥å¤„ç†å®¢æˆ·è¯·æ±‚ã€‚å·¥ä½œçº¿ç¨‹å¤„ç†å®Œå®¢æˆ·è¯·æ±‚åï¼Œè°ƒç”¨ aio_write å‡½æ•°å‘å†…æ ¸æ³¨å†Œ socket ä¸Šçš„å†™å®Œæˆäº‹ä»¶ï¼Œå¹¶å‘Šè¯‰å†…æ ¸ç”¨æˆ·å†™ç¼“å†²åŒºçš„ä½ç½®ï¼Œä»¥åŠå†™æ“ä½œå®Œæˆæ—¶å¦‚ä½•é€šçŸ¥åº”ç”¨ç¨‹åºã€‚</li><li>ä¸»çº¿ç¨‹ç»§ç»­å¤„ç†å…¶ä»–é€»è¾‘ã€‚</li><li>å½“ç”¨æˆ·ç¼“å†²åŒºçš„æ•°æ®è¢«å†™å…¥ socket ä¹‹åï¼Œå†…æ ¸å°†å‘åº”ç”¨ç¨‹åºå‘é€ä¸€ä¸ªä¿¡å·ï¼Œä»¥é€šçŸ¥åº”ç”¨ç¨‹åºæ•°æ®å·²ç»å‘é€å®Œæ¯•ã€‚</li><li>åº”ç”¨ç¨‹åºé¢„å…ˆå®šä¹‰å¥½çš„ä¿¡å·å¤„ç†å‡½æ•°é€‰æ‹©ä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ¥åšå–„åå¤„ç†ï¼Œæ¯”å¦‚å†³å®šæ˜¯å¦å…³é—­ socketã€‚</li></ol><p>Proactor æ¨¡å¼çš„å·¥ä½œæµç¨‹ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230825114659772.png" alt="image-20230825114659772"></p><h3 id="æ¨¡æ‹Ÿ-proactor-æ¨¡å¼"><a href="#æ¨¡æ‹Ÿ-proactor-æ¨¡å¼" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æ¨¡æ‹Ÿ-proactor-æ¨¡å¼"></a> æ¨¡æ‹Ÿ Proactor æ¨¡å¼</h3><p><strong>ä½¿ç”¨åŒæ­¥ I/O æ–¹å¼æ¨¡æ‹Ÿå‡º Proactor æ¨¡å¼ã€‚åŸç†æ˜¯ï¼šä¸»çº¿ç¨‹æ‰§è¡Œæ•°æ®è¯»å†™æ“ä½œï¼Œè¯»å†™å®Œæˆä¹‹åï¼Œä¸»çº¿ç¨‹å‘å·¥ä½œçº¿ç¨‹é€šçŸ¥è¿™ä¸€â€å®Œæˆäº‹ä»¶â€œã€‚é‚£ä¹ˆä»å·¥ä½œçº¿ç¨‹çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒä»¬å°±ç›´æ¥è·å¾—äº†æ•°æ®è¯»å†™çš„ç»“æœï¼Œæ¥ä¸‹ æ¥è¦åšçš„åªæ˜¯å¯¹è¯»å†™çš„ç»“æœè¿›è¡Œé€»è¾‘å¤„ç†ã€‚</strong></p><p>ä½¿ç”¨åŒæ­¥ I/O æ¨¡å‹ï¼ˆä»¥ epoll_waitä¸ºä¾‹ï¼‰æ¨¡æ‹Ÿå‡ºçš„ Proactor æ¨¡å¼çš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><strong>ä¸»çº¿ç¨‹å¾€ epoll å†…æ ¸äº‹ä»¶è¡¨ä¸­æ³¨å†Œ socket ä¸Šçš„è¯»å°±ç»ªäº‹ä»¶ã€‚</strong></li><li><strong>ä¸»çº¿ç¨‹è°ƒç”¨ epoll_wait ç­‰å¾… socket ä¸Šæœ‰æ•°æ®å¯è¯»ã€‚</strong></li><li><strong>å½“ socket ä¸Šæœ‰æ•°æ®å¯è¯»æ—¶ï¼Œepoll_wait é€šçŸ¥ä¸»çº¿ç¨‹ã€‚ä¸»çº¿ç¨‹ä» socket å¾ªç¯è¯»å–æ•°æ®ï¼Œç›´åˆ°æ²¡æœ‰æ›´å¤šæ•°æ®å¯è¯»ï¼Œç„¶åå°†è¯»å–åˆ°çš„æ•°æ®å°è£…æˆä¸€ä¸ªè¯·æ±‚å¯¹è±¡å¹¶æ’å…¥è¯·æ±‚é˜Ÿåˆ—ã€‚(æ³¨æ„æ˜¯ä¸»çº¿ç¨‹è¯»äº†å°è£…å¥½äº¤ç»™çº¿ç¨‹æ± å»å¤„ç†)</strong></li><li><strong>ç¡çœ åœ¨è¯·æ±‚é˜Ÿåˆ—ä¸Šçš„æŸä¸ªå·¥ä½œçº¿ç¨‹è¢«å”¤é†’ï¼Œå®ƒè·å¾—è¯·æ±‚å¯¹è±¡å¹¶å¤„ç†å®¢æˆ·è¯·æ±‚ï¼Œç„¶åå¾€ epoll å†…æ ¸äº‹ ä»¶è¡¨ä¸­æ³¨å†Œ socket ä¸Šçš„å†™å°±ç»ªäº‹ä»¶ã€‚</strong></li><li><strong>ä¸»çº¿ç¨‹è°ƒç”¨ epoll_wait ç­‰å¾… socket å¯å†™ã€‚</strong></li><li><strong>å½“ socket å¯å†™æ—¶ï¼Œepoll_wait é€šçŸ¥ä¸»çº¿ç¨‹ã€‚ä¸»çº¿ç¨‹å¾€ socket ä¸Šå†™å…¥æœåŠ¡å™¨å¤„ç†å®¢æˆ·è¯·æ±‚çš„ç»“æœã€‚</strong></li></ol><p>åŒæ­¥ I/O æ¨¡æ‹Ÿ Proactor æ¨¡å¼çš„å·¥ä½œæµç¨‹ï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230825114740311.png" alt="image-20230825114740311"></p><h2 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#çº¿ç¨‹æ± "></a> çº¿ç¨‹æ± </h2><p><strong>æˆ‘ä»¬åœ¨ä¹‹å‰å†™å¤šçº¿ç¨‹çš„TCPé€šä¿¡çš„æ—¶å€™ï¼Œå¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚æ˜¯å®¢æˆ·ç«¯æ¥ä¸€ä¸ªæˆ‘æ¥å—ä¸€ä¸ªï¼Œç„¶ååˆ›å»ºå­çº¿ç¨‹å»å¤„ç†é€»è¾‘ï¼Œè¿™æ ·çš„æ–¹å¼æˆ‘ä»¬ä»”ç»†æƒ³ä¸€ä¸‹å¥½å˜›ï¼Ÿå…¶å®å¹¶ä¸å¥½ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬å‡è®¾æŸä¸€æ—¶åˆ»åŒæ—¶è¿›æ¥äº†å¾ˆå¤šä¸ªå®¢æˆ·ç«¯ï¼ŒæœåŠ¡å™¨åœ¨è¿™ä¸€ç¬é—´çš„å‹åŠ›æ˜¯å·¨å¤§çš„ï¼Œè€Œåå› ä¸ºå®¢æˆ·ç«¯çš„ä¸æ–­å¢å¤šï¼ŒæœåŠ¡å™¨çš„å‹åŠ›ä¹Ÿåœ¨ä¸æ–­çš„å¢å¤§ï¼Œå¹¶ä¸”ç”±äºæˆ‘ä»¬æ˜¯éœ€è¦ç”¨çš„æ—¶å€™åˆ›å»ºå­çº¿ç¨‹ï¼Œç”¨å®Œå°±æŠŠå­çº¿ç¨‹ç»™é”€æ¯æ‰ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¹Ÿæ˜¯éå¸¸æ¶ˆè€—ç³»ç»Ÿçš„èµ„æºå’Œæ—¶é—´çš„ï¼Œæ‰€ä»¥ä¸æ¨èä½¿ç”¨ã€‚æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œç”¨çº¿ç¨‹æ± è§£å†³è¿™äº›é—®é¢˜</strong></p><p>**çº¿ç¨‹æ± æ˜¯ç”±æœåŠ¡å™¨é¢„å…ˆåˆ›å»ºçš„ä¸€ç»„å­çº¿ç¨‹ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡åº”è¯¥å’Œ CPU æ•°é‡å·®ä¸å¤šã€‚çº¿ç¨‹æ± ä¸­çš„æ‰€æœ‰å­çº¿ç¨‹éƒ½è¿è¡Œç€ç›¸åŒçš„ä»£ç ã€‚å½“æœ‰æ–°çš„ä»»åŠ¡åˆ°æ¥æ—¶ï¼Œä¸»çº¿ç¨‹å°†é€šè¿‡æŸç§æ–¹å¼é€‰æ‹©çº¿ç¨‹æ± ä¸­çš„æŸä¸€ä¸ªå­çº¿ç¨‹æ¥ä¸ºä¹‹æœåŠ¡ã€‚ç›¸æ¯”ä¸åŠ¨æ€çš„åˆ›å»ºå­çº¿ç¨‹ï¼Œé€‰æ‹©ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å­çº¿ç¨‹çš„ä»£ä»·æ˜¾ç„¶è¦å°å¾—å¤šã€‚**è‡³äºä¸»çº¿ç¨‹é€‰æ‹©å“ªä¸ªå­çº¿ç¨‹æ¥ä¸ºæ–°ä»»åŠ¡æœåŠ¡ï¼Œåˆ™æœ‰å¤šç§æ–¹å¼ï¼š</p><ul><li>ä¸»çº¿ç¨‹ä½¿ç”¨æŸç§ç®—æ³•æ¥ä¸»åŠ¨é€‰æ‹©å­çº¿ç¨‹ã€‚æœ€ç®€å•ã€æœ€å¸¸ç”¨çš„ç®—æ³•æ˜¯éšæœºç®—æ³•å’Œ Round Robinï¼ˆè½®æµ é€‰å–ï¼‰ç®—æ³•ï¼Œä½†æ›´ä¼˜ç§€ã€æ›´æ™ºèƒ½çš„ç®—æ³•å°†ä½¿ä»»åŠ¡åœ¨å„ä¸ªå·¥ä½œçº¿ç¨‹ä¸­æ›´å‡åŒ€åœ°åˆ†é…ï¼Œä»è€Œå‡è½»æœåŠ¡å™¨çš„æ•´ä½“å‹åŠ›ã€‚</li><li><strong>ä¸»çº¿ç¨‹å’Œæ‰€æœ‰å­çº¿ç¨‹é€šè¿‡ä¸€ä¸ªå…±äº«çš„å·¥ä½œé˜Ÿåˆ—æ¥åŒæ­¥ï¼Œå­çº¿ç¨‹éƒ½ç¡çœ åœ¨è¯¥å·¥ä½œé˜Ÿåˆ—ä¸Šã€‚å½“æœ‰æ–°çš„ä»»åŠ¡åˆ°æ¥æ—¶ï¼Œä¸»çº¿ç¨‹å°†ä»»åŠ¡æ·»åŠ åˆ°å·¥ä½œé˜Ÿåˆ—ä¸­ã€‚è¿™å°†å”¤é†’æ­£åœ¨ç­‰å¾…ä»»åŠ¡çš„å­çº¿ç¨‹ï¼Œä¸è¿‡åªæœ‰ä¸€ä¸ªå­çº¿ç¨‹å°†è·å¾—æ–°ä»»åŠ¡çš„â€æ¥ç®¡æƒâ€œï¼Œå®ƒå¯ä»¥ä»å·¥ä½œé˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡å¹¶æ‰§è¡Œä¹‹ï¼Œè€Œå…¶ä»–å­çº¿ç¨‹å°†ç»§ç»­ç¡çœ åœ¨å·¥ä½œé˜Ÿåˆ—ä¸Šã€‚</strong></li></ul><p>çº¿ç¨‹æ± çš„ä¸€èˆ¬æ¨¡å‹ä¸ºï¼š</p><p><img class="lazyload lazyload-gif" src="/images/loading.svg" data-src="https://cdn.davidingplus.cn/images/2025/01/31/image-20230825145330177.png" alt="image-20230825145330177"></p><p>çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡æœ€ç›´æ¥çš„é™åˆ¶å› ç´ æ˜¯ä¸­å¤®å¤„ç†å™¨(CPU)çš„å¤„ç†å™¨(processors/cores)çš„æ•°é‡ N ï¼šå¦‚æœä½ çš„CPUæ˜¯4-coresçš„ï¼Œå¯¹äºCPUå¯†é›†å‹çš„ä»»åŠ¡(å¦‚è§†é¢‘å‰ªè¾‘ç­‰æ¶ˆè€—CPUè®¡ç®—èµ„æºçš„ä»»åŠ¡)æ¥ è¯´ï¼Œé‚£çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡æœ€å¥½ä¹Ÿè®¾ç½®ä¸º4ï¼ˆæˆ–è€…+1é˜²æ­¢å…¶ä»–å› ç´ é€ æˆçš„çº¿ç¨‹é˜»å¡ï¼‰ï¼›å¯¹äºIOå¯†é›† å‹çš„ä»»åŠ¡ï¼Œä¸€èˆ¬è¦å¤šäºCPUçš„æ ¸æ•°ï¼Œå› ä¸ºçº¿ç¨‹é—´ç«äº‰çš„ä¸æ˜¯CPUçš„è®¡ç®—èµ„æºè€Œæ˜¯IOï¼ŒIOçš„å¤„ç†ä¸€ èˆ¬è¾ƒæ…¢ï¼Œå¤šäºcoresæ•°çš„çº¿ç¨‹å°†ä¸ºCPUäº‰å–æ›´å¤šçš„ä»»åŠ¡ï¼Œä¸è‡³åœ¨çº¿ç¨‹å¤„ç†IOçš„è¿‡ç¨‹é€ æˆCPUç©ºé—²å¯¼ è‡´èµ„æºæµªè´¹ã€‚</p><ul><li>ç©ºé—´æ¢æ—¶é—´ï¼Œæµªè´¹æœåŠ¡å™¨çš„ç¡¬ä»¶èµ„æºï¼Œæ¢å–è¿è¡Œæ•ˆç‡ã€‚</li><li>æ± æ˜¯ä¸€ç»„èµ„æºçš„é›†åˆï¼Œè¿™ç»„èµ„æºåœ¨æœåŠ¡å™¨å¯åŠ¨ä¹‹åˆå°±è¢«å®Œå…¨åˆ›å»ºå¥½å¹¶åˆå§‹åŒ–ï¼Œè¿™ç§°ä¸ºé™æ€èµ„æºã€‚</li><li>å½“æœåŠ¡å™¨è¿›å…¥æ­£å¼è¿è¡Œé˜¶æ®µï¼Œå¼€å§‹å¤„ç†å®¢æˆ·è¯·æ±‚çš„æ—¶å€™ï¼Œå¦‚æœå®ƒéœ€è¦ç›¸å…³çš„èµ„æºï¼Œå¯ä»¥ç›´æ¥ä»æ± ä¸­è·å–ï¼Œæ— éœ€åŠ¨æ€åˆ†é…ã€‚</li><li>å½“æœåŠ¡å™¨å¤„ç†å®Œä¸€ä¸ªå®¢æˆ·è¿æ¥åï¼Œå¯ä»¥æŠŠç›¸å…³çš„èµ„æºæ”¾å›æ± ä¸­ï¼Œæ— éœ€æ‰§è¡Œç³»ç»Ÿè°ƒç”¨é‡Šæ”¾èµ„æºã€‚</li></ul><h2 id="æœ‰é™çŠ¶æ€æœº"><a href="#æœ‰é™çŠ¶æ€æœº" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æœ‰é™çŠ¶æ€æœº"></a> æœ‰é™çŠ¶æ€æœº</h2><p>é€»è¾‘å•å…ƒå†…éƒ¨çš„ä¸€ç§é«˜æ•ˆç¼–ç¨‹æ–¹æ³•ï¼šæœ‰é™çŠ¶æ€æœºï¼ˆfinite state machineï¼‰ã€‚</p><p>æœ‰çš„åº”ç”¨å±‚åè®®å¤´éƒ¨åŒ…å«æ•°æ®åŒ…ç±»å‹å­—æ®µï¼Œæ¯ç§ç±»å‹å¯ä»¥æ˜ å°„ä¸ºé€»è¾‘å•å…ƒçš„ä¸€ç§æ‰§è¡ŒçŠ¶æ€ï¼ŒæœåŠ¡å™¨å¯ä»¥ æ ¹æ®å®ƒæ¥ç¼–å†™ç›¸åº”çš„å¤„ç†é€»è¾‘ã€‚å¦‚ä¸‹æ˜¯ä¸€ç§çŠ¶æ€ç‹¬ç«‹çš„æœ‰é™çŠ¶æ€æœºï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">STATE_MACHINE</span>( Package _pack ) &#123;</span><br><span class="line">    PackageType _type = _pack.<span class="built_in">GetType</span>();</span><br><span class="line">    <span class="keyword">switch</span>( _type ) &#123;</span><br><span class="line">        <span class="keyword">case</span> type_A:</span><br><span class="line">            <span class="built_in">process_package_A</span>( _pack );</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> type_B:</span><br><span class="line">            <span class="built_in">process_package_B</span>( _pack );</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æœ‰é™çŠ¶æ€æœºï¼Œåªä¸è¿‡è¯¥çŠ¶æ€æœºçš„æ¯ä¸ªçŠ¶æ€éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå³çŠ¶æ€ä¹‹é—´æ²¡æœ‰ç›¸äº’è½¬ç§»ã€‚ çŠ¶æ€ä¹‹é—´çš„è½¬ç§»æ˜¯éœ€è¦çŠ¶æ€æœºå†…éƒ¨é©±åŠ¨ï¼Œå¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">STATE_MACHINE</span>() &#123;</span><br><span class="line">	State cur_State = type_A;</span><br><span class="line">    <span class="keyword">while</span>( cur_State != type_C ) &#123;</span><br><span class="line">        Package _pack = <span class="built_in">getNewPackage</span>();</span><br><span class="line">        <span class="keyword">switch</span>( cur_State ) &#123;</span><br><span class="line">        <span class="keyword">case</span> type_A:</span><br><span class="line">            <span class="built_in">process_package_state_A</span>( _pack );</span><br><span class="line">            cur_State = type_B;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> type_B:</span><br><span class="line">            <span class="built_in">process_package_state_B</span>( _pack );</span><br><span class="line">            cur_State = type_C;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è¯¥çŠ¶æ€æœºåŒ…å«ä¸‰ç§çŠ¶æ€ï¼štype_Aã€type_B å’Œ type_Cï¼Œå…¶ä¸­ type_A æ˜¯çŠ¶æ€æœºçš„å¼€å§‹çŠ¶æ€ï¼Œtype_C æ˜¯çŠ¶ æ€æœºçš„ç»“æŸçŠ¶æ€ã€‚çŠ¶æ€æœºçš„å½“å‰çŠ¶æ€è®°å½•åœ¨ cur_State å˜é‡ä¸­ã€‚åœ¨ä¸€è¶Ÿå¾ªç¯è¿‡ç¨‹ä¸­ï¼ŒçŠ¶æ€æœºå…ˆé€šè¿‡ getNewPackage æ–¹æ³•è·å¾—ä¸€ä¸ªæ–°çš„æ•°æ®åŒ…ï¼Œç„¶åæ ¹æ® cur_State å˜é‡çš„å€¼åˆ¤æ–­å¦‚ä½•å¤„ç†è¯¥æ•°æ®åŒ…ã€‚æ•°æ® åŒ…å¤„ç†å®Œä¹‹åï¼ŒçŠ¶æ€æœºé€šè¿‡ç»™ cur_State å˜é‡ä¼ é€’ç›®æ ‡çŠ¶æ€å€¼æ¥å®ç°çŠ¶æ€è½¬ç§»ã€‚é‚£ä¹ˆå½“çŠ¶æ€æœºè¿›å…¥ä¸‹ä¸€ è¶Ÿå¾ªç¯æ—¶ï¼Œå®ƒå°†æ‰§è¡Œæ–°çš„çŠ¶æ€å¯¹åº”çš„é€»è¾‘ã€‚</p><h2 id="epolloneshotäº‹ä»¶"><a href="#epolloneshotäº‹ä»¶" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#epolloneshotäº‹ä»¶"></a> EPOLLONESHOTäº‹ä»¶</h2><p>æˆ‘ä»¬å³ä½¿å¯ä»¥ä½¿ç”¨ ET æ¨¡å¼ï¼Œä¸€ä¸ªsocket ä¸Šçš„æŸä¸ªäº‹ä»¶è¿˜æ˜¯å¯èƒ½è¢«è§¦å‘å¤šæ¬¡ï¼Œå› ä¸ºå¯èƒ½è¿™ä¸ªsocketä¸Šæ²¡è¯»å®Œå°±æœ‰æ–°æ•°æ®è¿›æ¥äº†ï¼Œè¿™åœ¨å¹¶å‘ç¨‹åºä¸­å°±ä¼šå¼•èµ·ä¸€ä¸ªé—®é¢˜ã€‚æ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹åœ¨è¯»å–å®ŒæŸä¸ª socket ä¸Šçš„æ•°æ®åå¼€å§‹å¤„ç†è¿™äº›æ•°æ®ï¼Œè€Œåœ¨æ•°æ®çš„å¤„ç†è¿‡ç¨‹ä¸­è¯¥ socket ä¸Šåˆæœ‰æ–°æ•°æ®å¯è¯»ï¼ˆEPOLLIN å†æ¬¡è¢«è§¦å‘ï¼‰ï¼Œæ­¤æ—¶å¦å¤–ä¸€ä¸ªçº¿ç¨‹è¢«å”¤é†’æ¥è¯»å–è¿™äº›æ–°çš„æ•°æ®ã€‚äºæ˜¯å°±å‡ºç°äº†ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ª socket çš„å±€é¢ã€‚ä¸€ä¸ªsocketè¿æ¥åœ¨ä»»ä¸€æ—¶åˆ»éƒ½åªè¢«ä¸€ä¸ªçº¿ç¨‹å¤„ç†ï¼Œå¯ä»¥ä½¿ç”¨ epoll çš„ EPOLLONESHOT äº‹ä»¶å®ç°ã€‚</p><p>**å¯¹äºæ³¨å†Œäº† EPOLLONESHOT äº‹ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ“ä½œç³»ç»Ÿæœ€å¤šè§¦å‘å…¶ä¸Šæ³¨å†Œçš„ä¸€ä¸ªå¯è¯»ã€å¯å†™æˆ–è€…å¼‚å¸¸äº‹ä»¶ï¼Œä¸”åªè§¦å‘ä¸€æ¬¡(åŠ å…¥äº†è¿™ä¸ªäº‹ä»¶ä¹‹åå³ä½¿æ˜¯LTå·¥ä½œæ¨¡å¼ä¹Ÿåªèƒ½è§¦å‘ä¸€æ¬¡)ï¼Œé™¤éæˆ‘ä»¬ä½¿ç”¨ epoll_ctl å‡½æ•°é‡ç½®è¯¥æ–‡ä»¶æè¿°ç¬¦ä¸Šæ³¨å†Œçš„ EPOLLONESHOT äº‹ä»¶ã€‚**è¿™æ ·ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹åœ¨å¤„ç†æŸä¸ª socket æ—¶ï¼Œå…¶ä»–çº¿ç¨‹æ˜¯ä¸å¯èƒ½æœ‰æœºä¼šæ“ä½œè¯¥ socket çš„ã€‚ä½†åè¿‡æ¥æ€è€ƒï¼Œæ³¨å†Œäº† EPOLLONESHOT äº‹ä»¶çš„ socket ä¸€æ—¦è¢«æŸä¸ªçº¿ç¨‹å¤„ç†å®Œæ¯•ï¼Œ è¯¥çº¿ç¨‹å°±åº”è¯¥ç«‹å³é‡ç½®è¿™ä¸ª socket ä¸Šçš„ EPOLLONESHOT äº‹ä»¶ï¼Œä»¥ç¡®ä¿è¿™ä¸ª socket ä¸‹ä¸€æ¬¡å¯è¯»æ—¶ï¼Œå…¶ EPOLLIN äº‹ä»¶èƒ½è¢«è§¦å‘ï¼Œè¿›è€Œè®©å…¶ä»–å·¥ä½œçº¿ç¨‹æœ‰æœºä¼šç»§ç»­å¤„ç†è¿™ä¸ª socketã€‚</p><h2 id="æœåŠ¡å™¨å‹åŠ›æµ‹è¯•"><a href="#æœåŠ¡å™¨å‹åŠ›æµ‹è¯•" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#æœåŠ¡å™¨å‹åŠ›æµ‹è¯•"></a> æœåŠ¡å™¨å‹åŠ›æµ‹è¯•</h2><p>Webbench æ˜¯ Linux ä¸Šä¸€æ¬¾çŸ¥åçš„ã€ä¼˜ç§€çš„ web æ€§èƒ½å‹åŠ›æµ‹è¯•å·¥å…·ã€‚å®ƒæ˜¯ç”±Lionbridgeå…¬å¸å¼€å‘ã€‚</p><ul><li>æµ‹è¯•å¤„åœ¨ç›¸åŒç¡¬ä»¶ä¸Šï¼Œä¸åŒæœåŠ¡çš„æ€§èƒ½ä»¥åŠä¸åŒç¡¬ä»¶ä¸ŠåŒä¸€ä¸ªæœåŠ¡çš„è¿è¡ŒçŠ¶å†µã€‚</li><li>å±•ç¤ºæœåŠ¡å™¨çš„ä¸¤é¡¹å†…å®¹ï¼šæ¯ç§’é’Ÿå“åº”è¯·æ±‚æ•°å’Œæ¯ç§’é’Ÿä¼ è¾“æ•°æ®é‡ã€‚</li></ul><p>åŸºæœ¬åŸç†ï¼šWebbench é¦–å…ˆ fork å‡ºå¤šä¸ªå­è¿›ç¨‹ï¼Œæ¯ä¸ªå­è¿›ç¨‹éƒ½å¾ªç¯åš web è®¿é—®æµ‹è¯•ã€‚å­è¿›ç¨‹æŠŠè®¿é—®çš„ç»“æœé€šè¿‡ pipe å‘Šè¯‰çˆ¶è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹åšæœ€ç»ˆçš„ç»Ÿè®¡ç»“æœã€‚</p><p>æµ‹è¯•ç¤ºä¾‹</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">webbench -c 1000 -t 30 http://192.168.110.129:10000/index.html</span><br><span class="line">    å‚æ•°ï¼š</span><br><span class="line">        -c è¡¨ç¤ºå®¢æˆ·ç«¯æ•°</span><br><span class="line">        -t è¡¨ç¤ºæ—¶é—´</span><br></pre></td></tr></table></div></figure><h2 id="é¡¹ç›®æ€»ä½“æµç¨‹å®ç°ä»¥åŠä»£ç "><a href="#é¡¹ç›®æ€»ä½“æµç¨‹å®ç°ä»¥åŠä»£ç " class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#é¡¹ç›®æ€»ä½“æµç¨‹å®ç°ä»¥åŠä»£ç "></a> é¡¹ç›®æ€»ä½“æµç¨‹å®ç°ä»¥åŠä»£ç </h2><p>è¿™ä¸ªé¡¹ç›®ç›®å‰æ˜¯å†™çš„å·®ä¸å¤šäº†ï¼Œä½†æ˜¯è¿˜æœ‰bugï¼Œå“åº”æŠ¥æ–‡å›å†™å‡ºäº†äº›é—®é¢˜ï¼Œæˆ‘è¿˜æ²¡æ¥å¾—åŠä¿®ï¼Œå¤ªéš¾äº†ï¼</p><p>TODO</p><h3 id="é“¾æ¥å’Œæ„å»º"><a href="#é“¾æ¥å’Œæ„å»º" class="heading-link"><i class="fas fa-link"></i></a><a class="markdownIt-Anchor" href="#é“¾æ¥å’Œæ„å»º"></a> é“¾æ¥å’Œæ„å»º</h3><p>é¡¹ç›®æ–‡ä»¶æ”¾åœ¨githubä¸Šï¼Œé“¾æ¥ï¼š<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://github.com/DavidingPlus/Linux_Projects/tree/web-server">https://github.com/DavidingPlus/Linux_Projects/tree/web-server</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>ä½¿ç”¨cmakeç¼–è¯‘é¡¹ç›®éœ€è¦åœ¨æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ªbuildç›®å½•ï¼Œç„¶åè¿›å…¥buildç›®å½•ï¼Œä¹‹åå¦‚ä¸‹æ“ä½œè¿›è¡Œç¼–è¯‘ï¼Œæˆ‘è®¾ç½®äº†é¡¹ç›®ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„åœ¨ build ç›®å½•ä¸‹ï¼Œåç§°ä¸ºapp</p><figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cmake ..</span><br><span class="line">make</span><br><span class="line">./app</span><br></pre></td></tr></table></div></figure></div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ æœ¬æ–‡ç»“æŸï¼Œæ„Ÿè°¢æ‚¨çš„é˜…è¯» ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">æœ¬æ–‡ä½œè€…: </span><span class="copyright-author__value"><a href="https://blog.davidingplus.cn">DavidingPlus</a></span></div><div class="copyright-link"><span class="copyright-link__name">æœ¬æ–‡é“¾æ¥: </span><span class="copyright-link__value"><a href="https://blog.davidingplus.cn/posts/ff333d31.html">https://blog.davidingplus.cn/posts/ff333d31.html</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">ç‰ˆæƒå£°æ˜: </span><span class="copyright-notice__value">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</span></div></div><div class="post-reward reward"><div class="reward-button">å¤§çˆ·ï¼Œèµä¸ªé“œæ¿å‘—~~~</div><div class="reward-qrcode"><span class="reward-qrcode-alipay"><img class="reward-qrcode-alipay__img" src="/images/reward/alipay.webp"><div class="reward-qrcode-alipay__text">æ”¯ä»˜å®</div></span><span class="reward-qrcode-wechat"><img class="reward-qrcode-wechat__img" src="/images/reward/wechat-pay.webp"><div class="reward-qrcode-wechat__text">å¾®ä¿¡</div></span></div></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/posts/4966c01c.html"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">æ™ºèƒ½æ§åˆ¶ æœŸæœ«å¤ä¹ </span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/posts/2abc6e08.html"><span class="paginator-prev__text">ä¾¯æ·è€å¸ˆ C++ è¯¾ç¨‹</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div><div class="comments" id="comments"><div id="utterances-container"></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">æ–‡ç« ç›®å½•</span><span class="sidebar-nav-ov">ç«™ç‚¹æ¦‚è§ˆ</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF"><span class="toc-number">1.</span> <span class="toc-text">å­¦ä¹ è·¯çº¿</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0-linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8"><span class="toc-number">2.</span> <span class="toc-text">ç¬¬ä¸€ç«  Linuxç³»ç»Ÿç¼–ç¨‹å…¥é—¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#gcc"><span class="toc-number">2.1.</span> <span class="toc-text">GCC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFgcc"><span class="toc-number">2.1.1.</span> <span class="toc-text">ä»€ä¹ˆæ˜¯GCC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gcc%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">2.1.2.</span> <span class="toc-text">GCCå·¥ä½œæµç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%8F%82%E6%95%B0%E9%80%89%E9%A1%B9"><span class="toc-number">2.1.3.</span> <span class="toc-text">å¸¸ç”¨å‚æ•°é€‰é¡¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gcc%E5%92%8Cg%E5%8C%BA%E5%88%AB"><span class="toc-number">2.1.4.</span> <span class="toc-text">gccå’Œg++åŒºåˆ«</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%BA%93"><span class="toc-number">2.2.</span> <span class="toc-text">é™æ€åº“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99"><span class="toc-number">2.2.1.</span> <span class="toc-text">å‘½åè§„åˆ™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%B6%E4%BD%9C"><span class="toc-number">2.2.2.</span> <span class="toc-text">åˆ¶ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">2.2.3.</span> <span class="toc-text">ä½¿ç”¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E5%BA%93"><span class="toc-number">2.3.</span> <span class="toc-text">åŠ¨æ€åº“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99-2"><span class="toc-number">2.3.1.</span> <span class="toc-text">å‘½åè§„åˆ™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%B6%E4%BD%9C-2"><span class="toc-number">2.3.2.</span> <span class="toc-text">åˆ¶ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-2"><span class="toc-number">2.3.3.</span> <span class="toc-text">ä½¿ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E5%A4%B1%E8%B4%A5%E5%8F%8A%E5%85%B6%E8%A7%A3%E5%86%B3"><span class="toc-number">2.3.4.</span> <span class="toc-text">åŠ è½½å¤±è´¥åŠå…¶è§£å†³</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3"><span class="toc-number">2.3.4.1.</span> <span class="toc-text">å¦‚ä½•è§£å†³</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#dt_rpath%E6%AE%B5%E6%97%A0%E6%B3%95%E4%BF%AE%E6%94%B9"><span class="toc-number">2.3.4.1.1.</span> <span class="toc-text">DT_RPATHæ®µæ— æ³•ä¿®æ”¹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E5%9C%A8%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-ld_library_path-%E4%B8%AD%E8%BF%9B%E8%A1%8C%E6%B7%BB%E5%8A%A0"><span class="toc-number">2.3.4.1.2.</span> <span class="toc-text">é€šè¿‡åœ¨ç¯å¢ƒå˜é‡ LD_LIBRARY_PATH ä¸­è¿›è¡Œæ·»åŠ </span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9-etcldsocathe-%E6%96%87%E4%BB%B6%E5%88%97%E8%A1%A8"><span class="toc-number">2.3.4.1.3.</span> <span class="toc-text">ä¿®æ”¹ &#x2F;etc&#x2F;ld.so.cathe æ–‡ä»¶åˆ—è¡¨</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B0%86%E5%8A%A8%E6%80%81%E5%BA%93%E6%96%87%E4%BB%B6%E6%94%BE%E5%88%B0-lib-%E6%88%96%E8%80%85-usrlib-%E7%9B%AE%E5%BD%95%E4%B8%8B"><span class="toc-number">2.3.4.1.4.</span> <span class="toc-text">å°†åŠ¨æ€åº“æ–‡ä»¶æ”¾åˆ° &#x2F;lib æˆ–è€… &#x2F;usr&#x2F;lib ç›®å½•ä¸‹</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%BA%93%E5%92%8C%E5%8A%A8%E6%80%81%E5%BA%93%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-number">2.4.</span> <span class="toc-text">é™æ€åº“å’ŒåŠ¨æ€åº“çš„å¯¹æ¯”</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E7%BC%96%E8%AF%91%E6%88%90%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F%E7%9A%84%E8%BF%87%E7%A8%8B"><span class="toc-number">2.4.1.</span> <span class="toc-text">ç¨‹åºç¼–è¯‘æˆå¯æ‰§è¡Œç¨‹åºçš„è¿‡ç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%BA%93%E5%88%B6%E4%BD%9C%E8%BF%87%E7%A8%8B"><span class="toc-number">2.4.2.</span> <span class="toc-text">é™æ€åº“åˆ¶ä½œè¿‡ç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E5%BA%93%E5%88%B6%E4%BD%9C%E8%BF%87%E7%A8%8B"><span class="toc-number">2.4.3.</span> <span class="toc-text">åŠ¨æ€åº“åˆ¶ä½œè¿‡ç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%BA%93%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">2.4.4.</span> <span class="toc-text">é™æ€åº“çš„ä¼˜ç¼ºç‚¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E5%BA%93%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">2.4.5.</span> <span class="toc-text">åŠ¨æ€åº“çš„ä¼˜ç¼ºç‚¹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#makefile"><span class="toc-number">2.5.</span> <span class="toc-text">makefile</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFmakefile"><span class="toc-number">2.5.1.</span> <span class="toc-text">ä»€ä¹ˆæ˜¯makefile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99-3"><span class="toc-number">2.5.2.</span> <span class="toc-text">å‘½åè§„åˆ™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%A1%88%E4%BE%8B"><span class="toc-number">2.5.3.</span> <span class="toc-text">ç®€å•æ¡ˆä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">2.5.4.</span> <span class="toc-text">å·¥ä½œåŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E9%87%8F"><span class="toc-number">2.5.5.</span> <span class="toc-text">å˜é‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D"><span class="toc-number">2.5.6.</span> <span class="toc-text">æ¨¡å¼åŒ¹é…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-number">2.5.7.</span> <span class="toc-text">å‡½æ•°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gdb%E8%B0%83%E8%AF%95"><span class="toc-number">2.6.</span> <span class="toc-text">GDBè°ƒè¯•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFgdb"><span class="toc-number">2.6.1.</span> <span class="toc-text">ä»€ä¹ˆæ˜¯GDB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">2.6.2.</span> <span class="toc-text">å‡†å¤‡å·¥ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gdb%E5%91%BD%E4%BB%A4"><span class="toc-number">2.6.3.</span> <span class="toc-text">GDBå‘½ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B-list"><span class="toc-number">2.6.3.1.</span> <span class="toc-text">æŸ¥çœ‹ list</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%AD%E7%82%B9%E6%93%8D%E4%BD%9C-break"><span class="toc-number">2.6.3.2.</span> <span class="toc-text">æ–­ç‚¹æ“ä½œ break</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%91%BD%E4%BB%A4"><span class="toc-number">2.6.3.3.</span> <span class="toc-text">è°ƒè¯•å‘½ä»¤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6io"><span class="toc-number">2.7.</span> <span class="toc-text">æ–‡ä»¶IO</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E5%87%86c%E5%BA%93io%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.1.</span> <span class="toc-text">æ ‡å‡†Cåº“IOå‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4"><span class="toc-number">2.7.2.</span> <span class="toc-text">è™šæ‹Ÿåœ°å€ç©ºé—´</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="toc-number">2.7.3.</span> <span class="toc-text">æ–‡ä»¶æè¿°ç¬¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#linux%E7%B3%BB%E7%BB%9Fio%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.4.</span> <span class="toc-text">Linuxç³»ç»ŸIOå‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#open%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.5.</span> <span class="toc-text">openå‡½æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#open%E5%87%BD%E6%95%B0%E6%89%93%E5%BC%80%E6%96%87%E4%BB%B6"><span class="toc-number">2.7.5.1.</span> <span class="toc-text">openå‡½æ•°æ‰“å¼€æ–‡ä»¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#open%E5%87%BD%E6%95%B0%E5%88%9B%E5%BB%BA%E6%96%B0%E6%96%87%E4%BB%B6"><span class="toc-number">2.7.5.2.</span> <span class="toc-text">openå‡½æ•°åˆ›å»ºæ–°æ–‡ä»¶</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#readwrite%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.6.</span> <span class="toc-text">read,writeå‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lseek%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.7.</span> <span class="toc-text">lseekå‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#statlstat%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.8.</span> <span class="toc-text">stat,lstatå‡½æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#stat%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-number">2.7.8.1.</span> <span class="toc-text">statç»“æ„ä½“(!!!)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8C%BA%E5%88%AB"><span class="toc-number">2.7.8.2.</span> <span class="toc-text">åŒºåˆ«</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%8B%9F%E5%AE%9E%E7%8E%B0ls-l-%E5%91%BD%E4%BB%A4"><span class="toc-number">2.7.9.</span> <span class="toc-text">æ¨¡æ‹Ÿå®ç°ls -l å‘½ä»¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%B1%9E%E6%80%A7%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.10.</span> <span class="toc-text">æ–‡ä»¶å±æ€§æ“ä½œå‡½æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#access%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.10.1.</span> <span class="toc-text">accesså‡½æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#chmod%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.10.2.</span> <span class="toc-text">chmodå‡½æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#chown%E5%87%BD%E6%95%B0%E4%BA%86%E8%A7%A3"><span class="toc-number">2.7.10.3.</span> <span class="toc-text">chownå‡½æ•°(äº†è§£)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#truncate%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.10.4.</span> <span class="toc-text">truncateå‡½æ•°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.11.</span> <span class="toc-text">æ–‡ä»¶ç›®å½•æ“ä½œå‡½æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mkdir%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.11.1.</span> <span class="toc-text">mkdirå‡½æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rmdir%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.11.2.</span> <span class="toc-text">rmdirå‡½æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rename%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.11.3.</span> <span class="toc-text">renameå‡½æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#chdir%E5%87%BD%E6%95%B0%E5%92%8Cgetcwd%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.11.4.</span> <span class="toc-text">chdirå‡½æ•°å’Œgetcwdå‡½æ•°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.12.</span> <span class="toc-text">æ–‡ä»¶ç›®å½•éå†å‡½æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#opendir%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.12.1.</span> <span class="toc-text">opendirå‡½æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#readdir%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.12.2.</span> <span class="toc-text">readdirå‡½æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dirent%E7%BB%93%E6%9E%84%E4%BD%93%E5%92%8Cd_type"><span class="toc-number">2.7.12.3.</span> <span class="toc-text">direntç»“æ„ä½“å’Œd_type(!!!)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dupdup2%E5%87%BD%E6%95%B0%E4%B8%8E%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E7%9B%B8%E5%85%B3"><span class="toc-number">2.7.13.</span> <span class="toc-text">dup,dup2å‡½æ•°(ä¸æ–‡ä»¶æè¿°ç¬¦ç›¸å…³)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#dup"><span class="toc-number">2.7.13.1.</span> <span class="toc-text">dup()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dup2"><span class="toc-number">2.7.13.2.</span> <span class="toc-text">dup2()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fcntl"><span class="toc-number">2.7.14.</span> <span class="toc-text">fcntl()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4%E5%87%BD%E6%95%B0"><span class="toc-number">2.7.15.</span> <span class="toc-text">æ–‡ä»¶åˆ é™¤å‡½æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#unlink%E5%92%8Cremove"><span class="toc-number">2.7.15.1.</span> <span class="toc-text">unlink()å’Œremove()</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0-linux%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%BC%80%E5%8F%91"><span class="toc-number">3.</span> <span class="toc-text">ç¬¬äºŒç«  Linuxå¤šè¿›ç¨‹å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5"><span class="toc-number">3.1.</span> <span class="toc-text">ä¸€äº›æ¦‚å¿µ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%92%8C%E8%BF%9B%E7%A8%8B"><span class="toc-number">3.1.1.</span> <span class="toc-text">ç¨‹åºå’Œè¿›ç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E9%81%93%E5%A4%9A%E9%81%93%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1"><span class="toc-number">3.1.2.</span> <span class="toc-text">å•é“ï¼Œå¤šé“ç¨‹åºè®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E7%89%87"><span class="toc-number">3.1.3.</span> <span class="toc-text">æ—¶é—´ç‰‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B6%E8%A1%8C%E5%92%8C%E5%B9%B6%E5%8F%91"><span class="toc-number">3.1.4.</span> <span class="toc-text">å¹¶è¡Œå’Œå¹¶å‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E6%8E%A7%E5%88%B6%E5%9D%97pcb"><span class="toc-number">3.1.5.</span> <span class="toc-text">è¿›ç¨‹æ§åˆ¶å—PCB</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81"><span class="toc-number">3.2.</span> <span class="toc-text">è¿›ç¨‹çŠ¶æ€</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E8%BD%AC%E5%8C%96%E5%9B%BE"><span class="toc-number">3.2.1.</span> <span class="toc-text">çŠ¶æ€è½¬åŒ–å›¾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="toc-number">3.2.2.</span> <span class="toc-text">è¿›ç¨‹ç›¸å…³å‘½ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ps-aux"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">ps aux</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ps-ajx"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">ps ajx</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#top"><span class="toc-number">3.2.2.3.</span> <span class="toc-text">top</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kill"><span class="toc-number">3.2.2.4.</span> <span class="toc-text">kill</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#aout-%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C%E7%A8%8B%E5%BA%8F"><span class="toc-number">3.2.2.5.</span> <span class="toc-text">.&#x2F;a.out &amp; åå°è¿è¡Œç¨‹åº</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%BF%9B%E7%A8%8B"><span class="toc-number">3.3.</span> <span class="toc-text">åˆ›å»ºè¿›ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E5%8F%B7%E5%92%8C%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0"><span class="toc-number">3.3.1.</span> <span class="toc-text">è¿›ç¨‹å·å’Œç›¸å…³å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E5%88%9B%E5%BB%BA"><span class="toc-number">3.3.2.</span> <span class="toc-text">è¿›ç¨‹åˆ›å»º</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#fork"><span class="toc-number">3.3.2.1.</span> <span class="toc-text">fork()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%B6%E5%AD%90%E8%BF%9B%E7%A8%8B%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4"><span class="toc-number">3.3.3.</span> <span class="toc-text">çˆ¶å­è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BB%E6%97%B6%E6%8B%B7%E8%B4%9D%E5%86%99%E6%97%B6%E5%85%B1%E4%BA%AB"><span class="toc-number">3.3.3.1.</span> <span class="toc-text">è¯»æ—¶æ‹·è´ï¼Œå†™æ—¶å…±äº«</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E7%88%B6%E5%AD%90%E8%BF%9B%E7%A8%8B%E5%85%B3%E7%B3%BB"><span class="toc-number">3.3.4.</span> <span class="toc-text">æ€»ç»“ï¼šçˆ¶å­è¿›ç¨‹å…³ç³»</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gdb%E5%A4%9A%E8%BF%9B%E7%A8%8B%E8%B0%83%E8%AF%95"><span class="toc-number">3.4.</span> <span class="toc-text">GDBå¤šè¿›ç¨‹è°ƒè¯•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%B0%83%E8%AF%95%E5%AD%90%E8%BF%9B%E7%A8%8B"><span class="toc-number">3.4.1.</span> <span class="toc-text">è®¾ç½®è°ƒè¯•å­è¿›ç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%B0%83%E8%AF%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.4.2.</span> <span class="toc-text">è®¾ç½®è°ƒè¯•æ¨¡å¼</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#exec%E5%87%BD%E6%95%B0%E6%97%8F"><span class="toc-number">3.5.</span> <span class="toc-text">execå‡½æ•°æ—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E6%97%8F%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.5.1.</span> <span class="toc-text">å‡½æ•°æ—ä»‹ç»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E6%97%8F%E9%99%84%E5%9B%BE"><span class="toc-number">3.5.2.</span> <span class="toc-text">å‡½æ•°æ—(é™„å›¾)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#execl"><span class="toc-number">3.5.2.1.</span> <span class="toc-text">execl()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#execlp"><span class="toc-number">3.5.2.2.</span> <span class="toc-text">execlp()</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E6%8E%A7%E5%88%B6"><span class="toc-number">3.6.</span> <span class="toc-text">è¿›ç¨‹æ§åˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E9%80%80%E5%87%BA"><span class="toc-number">3.6.1.</span> <span class="toc-text">è¿›ç¨‹é€€å‡º</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%B7%E6%96%B0%E7%BC%93%E5%86%B2%E5%8C%BA%E9%97%AE%E9%A2%98%E9%87%8D%E8%A6%81"><span class="toc-number">3.6.1.1.</span> <span class="toc-text">åˆ·æ–°ç¼“å†²åŒºé—®é¢˜(é‡è¦)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%98%E5%BC%8F"><span class="toc-number">3.6.1.1.1.</span> <span class="toc-text">å˜å¼</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%A4%E5%84%BF%E8%BF%9B%E7%A8%8B"><span class="toc-number">3.6.2.</span> <span class="toc-text">å­¤å„¿è¿›ç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B"><span class="toc-number">3.6.3.</span> <span class="toc-text">åƒµå°¸è¿›ç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E5%9B%9E%E6%94%B6"><span class="toc-number">3.6.4.</span> <span class="toc-text">è¿›ç¨‹å›æ”¶</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#wait"><span class="toc-number">3.6.4.1.</span> <span class="toc-text">wait()</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%80%E5%87%BA%E4%BF%A1%E6%81%AF%E5%AE%8F%E5%87%BD%E6%95%B0status%E7%9B%B8%E5%85%B3"><span class="toc-number">3.6.4.1.1.</span> <span class="toc-text">é€€å‡ºä¿¡æ¯å®å‡½æ•°(statusç›¸å…³)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#waitpid"><span class="toc-number">3.6.4.2.</span> <span class="toc-text">waitpid()</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1-ipc"><span class="toc-number">3.7.</span> <span class="toc-text">è¿›ç¨‹é—´é€šä¿¡ IPC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">3.7.1.</span> <span class="toc-text">æ¦‚å¿µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%A1%E9%81%93"><span class="toc-number">3.7.2.</span> <span class="toc-text">ç®¡é“</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%82%A3%E4%B9%88%E5%9C%A8fork%E4%B9%8B%E5%89%8D%E8%BF%98%E6%98%AFfork%E4%B9%8B%E5%90%8E%E5%BB%BA%E7%AB%8B%E7%AE%A1%E9%81%93%E5%91%A2"><span class="toc-number">3.7.2.1.</span> <span class="toc-text">é‚£ä¹ˆåœ¨forkä¹‹å‰è¿˜æ˜¯forkä¹‹åå»ºç«‹ç®¡é“å‘¢ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8C%BF%E5%90%8D%E7%AE%A1%E9%81%93pipe"><span class="toc-number">3.7.2.2.</span> <span class="toc-text">åŒ¿åç®¡é“(pipe)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#pipe"><span class="toc-number">3.7.2.2.1.</span> <span class="toc-text">pipe()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#fpathconf"><span class="toc-number">3.7.2.2.2.</span> <span class="toc-text">fpathconf()</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8C%BF%E5%90%8D%E7%AE%A1%E9%81%93%E9%80%9A%E4%BF%A1%E6%A1%88%E4%BE%8B"><span class="toc-number">3.7.2.3.</span> <span class="toc-text">åŒ¿åç®¡é“é€šä¿¡æ¡ˆä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F"><span class="toc-number">3.7.2.3.1.</span> <span class="toc-text">æ³¨æ„</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-number">3.7.2.3.2.</span> <span class="toc-text">æ¡ˆä¾‹(!!!)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%A1%E9%81%93%E7%9A%84%E8%AF%BB%E5%86%99%E7%89%B9%E7%82%B9"><span class="toc-number">3.7.2.4.</span> <span class="toc-text">ç®¡é“çš„è¯»å†™ç‰¹ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%AE%A1%E9%81%93%E9%9D%9E%E9%98%BB%E5%A1%9Efcntl"><span class="toc-number">3.7.2.5.</span> <span class="toc-text">è®¾ç½®ç®¡é“éé˜»å¡(fcntl)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%89%E5%90%8D%E7%AE%A1%E9%81%93fifo"><span class="toc-number">3.7.2.6.</span> <span class="toc-text">æœ‰åç®¡é“(FIFO)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#mkinfo"><span class="toc-number">3.7.2.6.1.</span> <span class="toc-text">mkinfo()</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%89%E5%90%8D%E7%AE%A1%E9%81%93%E9%80%9A%E4%BF%A1%E6%A1%88%E4%BE%8B"><span class="toc-number">3.7.2.7.</span> <span class="toc-text">æœ‰åç®¡é“é€šä¿¡æ¡ˆä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF"><span class="toc-number">3.7.2.7.1.</span> <span class="toc-text">æ€è·¯</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E6%98%A0%E5%B0%84"><span class="toc-number">3.7.3.</span> <span class="toc-text">å†…å­˜æ˜ å°„</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0"><span class="toc-number">3.7.3.1.</span> <span class="toc-text">ç›¸å…³å‡½æ•°(!!!)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%80%83%E9%97%AE%E9%A2%98"><span class="toc-number">3.7.3.2.</span> <span class="toc-text">æ€è€ƒé—®é¢˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">3.7.3.3.</span> <span class="toc-text">ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8C%BF%E5%90%8D%E6%98%A0%E5%B0%84"><span class="toc-number">3.7.3.4.</span> <span class="toc-text">åŒ¿åæ˜ å°„</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E5%8F%B7"><span class="toc-number">3.7.4.</span> <span class="toc-text">ä¿¡å·</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5-2"><span class="toc-number">3.7.4.1.</span> <span class="toc-text">æ¦‚å¿µ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84"><span class="toc-number">3.7.4.2.</span> <span class="toc-text">ç›®çš„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#linux%E4%BF%A1%E5%8F%B7%E5%88%97%E8%A1%A8"><span class="toc-number">3.7.4.3.</span> <span class="toc-text">Linuxä¿¡å·åˆ—è¡¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%A1%E5%8F%B7%E7%9A%845%E7%A7%8D%E9%BB%98%E8%AE%A4%E5%A4%84%E7%90%86%E5%8A%A8%E4%BD%9C"><span class="toc-number">3.7.4.4.</span> <span class="toc-text">ä¿¡å·çš„5ç§é»˜è®¤å¤„ç†åŠ¨ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%B9%B6%E4%B8%94%E4%BD%BF%E7%94%A8core%E6%96%87%E4%BB%B6"><span class="toc-number">3.7.4.4.1.</span> <span class="toc-text">æŸ¥çœ‹å¹¶ä¸”ä½¿ç”¨Coreæ–‡ä»¶</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0-2"><span class="toc-number">3.7.4.5.</span> <span class="toc-text">ç›¸å…³å‡½æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#killraiseabort"><span class="toc-number">3.7.4.5.1.</span> <span class="toc-text">kill(),raise(),abort()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#alarm"><span class="toc-number">3.7.4.5.2.</span> <span class="toc-text">alarm()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#settimer"><span class="toc-number">3.7.4.5.3.</span> <span class="toc-text">settimer()</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%A1%E5%8F%B7%E6%8D%95%E6%8D%89%E5%87%BD%E6%95%B0"><span class="toc-number">3.7.4.6.</span> <span class="toc-text">ä¿¡å·æ•æ‰å‡½æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#signal"><span class="toc-number">3.7.4.6.1.</span> <span class="toc-text">signal()</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%A1%E5%8F%B7%E9%9B%86"><span class="toc-number">3.7.4.7.</span> <span class="toc-text">ä¿¡å·é›†</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0-3"><span class="toc-number">3.7.4.7.1.</span> <span class="toc-text">ç›¸å…³å‡½æ•°</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%AD%E4%BF%A1%E5%8F%B7%E6%8D%95%E6%8D%89%E5%87%BD%E6%95%B0sigaction"><span class="toc-number">3.7.4.8.</span> <span class="toc-text">(ç»­ä¿¡å·æ•æ‰å‡½æ•°)sigaction()</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E4%BA%8C%E8%80%85"><span class="toc-number">3.7.4.8.1.</span> <span class="toc-text">æ¯”è¾ƒäºŒè€…</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9B%B4%E5%A5%BD%E7%90%86%E8%A7%A3%E4%BF%A1%E5%8F%B7%E6%8D%95%E6%8D%89"><span class="toc-number">3.7.4.8.2.</span> <span class="toc-text">æ›´å¥½ç†è§£ä¿¡å·æ•æ‰</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sigchld%E4%BF%A1%E5%8F%B7"><span class="toc-number">3.7.4.9.</span> <span class="toc-text">SIGCHLDä¿¡å·</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E6%95%88%E7%8E%87%E6%9C%80%E9%AB%98"><span class="toc-number">3.7.5.</span> <span class="toc-text">å…±äº«å†…å­˜(æ•ˆç‡æœ€é«˜)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5-3"><span class="toc-number">3.7.5.1.</span> <span class="toc-text">æ¦‚å¿µ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4"><span class="toc-number">3.7.5.2.</span> <span class="toc-text">ä½¿ç”¨æ­¥éª¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0-4"><span class="toc-number">3.7.5.3.</span> <span class="toc-text">ç›¸å…³å‡½æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-2"><span class="toc-number">3.7.5.4.</span> <span class="toc-text">ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4"><span class="toc-number">3.7.5.5.</span> <span class="toc-text">å…±äº«å†…å­˜æ“ä½œå‘½ä»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F-2"><span class="toc-number">3.7.5.6.</span> <span class="toc-text">æ³¨æ„</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B"><span class="toc-number">3.8.</span> <span class="toc-text">å®ˆæŠ¤è¿›ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%88%E7%AB%AF"><span class="toc-number">3.8.1.</span> <span class="toc-text">ç»ˆç«¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E7%BB%84"><span class="toc-number">3.8.2.</span> <span class="toc-text">è¿›ç¨‹ç»„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%9A%E8%AF%9D"><span class="toc-number">3.8.3.</span> <span class="toc-text">ä¼šè¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%90%86%E8%A7%A3%E5%85%B3%E7%B3%BB%E4%B8%BE%E4%BE%8B"><span class="toc-number">3.8.4.</span> <span class="toc-text">ç†è§£å…³ç³»ä¸¾ä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0"><span class="toc-number">3.8.5.</span> <span class="toc-text">æ“ä½œå‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8Bdaemon%E8%BF%9B%E7%A8%8B%E7%B2%BE%E7%81%B5%E8%BF%9B%E7%A8%8B"><span class="toc-number">3.8.6.</span> <span class="toc-text">å®ˆæŠ¤è¿›ç¨‹(Daemonè¿›ç¨‹ï¼Œç²¾çµè¿›ç¨‹)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%AD%A5%E9%AA%A4"><span class="toc-number">3.8.6.1.</span> <span class="toc-text">åˆ›å»ºæ­¥éª¤(!!!)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-3"><span class="toc-number">3.8.6.1.1.</span> <span class="toc-text">ç¤ºä¾‹</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0-linux%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%BC%80%E5%8F%91"><span class="toc-number">4.</span> <span class="toc-text">ç¬¬ä¸‰ç«  Linuxå¤šçº¿ç¨‹å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">4.1.</span> <span class="toc-text">æ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5-4"><span class="toc-number">4.1.1.</span> <span class="toc-text">æ¦‚å¿µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E5%8C%BA%E5%88%AB"><span class="toc-number">4.1.2.</span> <span class="toc-text">è¿›ç¨‹å’Œçº¿ç¨‹åŒºåˆ«</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%85%B1%E4%BA%AB%E5%92%8C%E9%9D%9E%E5%85%B1%E4%BA%AB%E8%B5%84%E6%BA%90"><span class="toc-number">4.1.3.</span> <span class="toc-text">çº¿ç¨‹çš„å…±äº«å’Œéå…±äº«èµ„æº</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%93%8D%E4%BD%9C"><span class="toc-number">4.2.</span> <span class="toc-text">çº¿ç¨‹æ“ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B-pthead_create"><span class="toc-number">4.2.1.</span> <span class="toc-text">åˆ›å»ºçº¿ç¨‹ pthead_create()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%88%E6%AD%A2%E7%BA%BF%E7%A8%8B-pthread_exit"><span class="toc-number">4.2.2.</span> <span class="toc-text">ç»ˆæ­¢çº¿ç¨‹ pthread_exit()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E5%B7%B2%E7%BB%88%E6%AD%A2%E7%9A%84%E7%BA%BF%E7%A8%8B-pthread_join"><span class="toc-number">4.2.3.</span> <span class="toc-text">è¿æ¥å·²ç»ˆæ­¢çš„çº¿ç¨‹ pthread_join()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%88%86%E7%A6%BB-pthread_detach"><span class="toc-number">4.2.4.</span> <span class="toc-text">çº¿ç¨‹çš„åˆ†ç¦» pthread_detach()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E5%8F%96%E6%B6%88-pthread_cancel"><span class="toc-number">4.2.5.</span> <span class="toc-text">çº¿ç¨‹å–æ¶ˆ pthread_cancel()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E5%B1%9E%E6%80%A7"><span class="toc-number">4.3.</span> <span class="toc-text">çº¿ç¨‹å±æ€§</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5"><span class="toc-number">4.4.</span> <span class="toc-text">çº¿ç¨‹åŒæ­¥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E5%BC%95%E5%85%A5"><span class="toc-number">4.4.1.</span> <span class="toc-text">ç¤ºä¾‹å¼•å…¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-2"><span class="toc-number">4.4.2.</span> <span class="toc-text">æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%92%E6%96%A5%E9%94%81"><span class="toc-number">4.4.3.</span> <span class="toc-text">äº’æ–¥é”</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0-5"><span class="toc-number">4.4.3.1.</span> <span class="toc-text">ç›¸å…³å‡½æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BF%AE%E6%94%B9"><span class="toc-number">4.4.3.2.</span> <span class="toc-text">ç¤ºä¾‹ä¿®æ”¹(!!!)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%BB%E9%94%81"><span class="toc-number">4.4.4.</span> <span class="toc-text">æ­»é”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%86%99%E9%94%81"><span class="toc-number">4.4.5.</span> <span class="toc-text">è¯»å†™é”</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0-6"><span class="toc-number">4.4.5.1.</span> <span class="toc-text">ç›¸å…³å‡½æ•°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85%E6%A8%A1%E5%9E%8B"><span class="toc-number">4.4.6.</span> <span class="toc-text">ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%B7%B1%E7%9A%84%E6%80%9D%E8%B7%AF"><span class="toc-number">4.4.6.1.</span> <span class="toc-text">è‡ªå·±çš„æ€è·¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E5%8F%98%E9%87%8F"><span class="toc-number">4.4.6.2.</span> <span class="toc-text">æ¡ä»¶å˜é‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%A1%E5%8F%B7%E9%87%8F"><span class="toc-number">4.4.6.3.</span> <span class="toc-text">ä¿¡å·é‡</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-linux%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B"><span class="toc-number">5.</span> <span class="toc-text">ç¬¬å››ç«  Linuxç½‘ç»œç¼–ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.1.</span> <span class="toc-text">ç½‘ç»œç»“æ„æ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cs%E7%BB%93%E6%9E%84"><span class="toc-number">5.1.1.</span> <span class="toc-text">C&#x2F;Sç»“æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">5.1.1.1.</span> <span class="toc-text">ç®€ä»‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E7%82%B9"><span class="toc-number">5.1.1.2.</span> <span class="toc-text">ä¼˜ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9"><span class="toc-number">5.1.1.3.</span> <span class="toc-text">ç¼ºç‚¹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bs%E7%BB%93%E6%9E%84"><span class="toc-number">5.1.2.</span> <span class="toc-text">B&#x2F;Sç»“æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B-2"><span class="toc-number">5.1.2.1.</span> <span class="toc-text">ç®€ä»‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E7%82%B9-2"><span class="toc-number">5.1.2.2.</span> <span class="toc-text">ä¼˜ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9-2"><span class="toc-number">5.1.2.3.</span> <span class="toc-text">ç¼ºç‚¹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mac%E5%9C%B0%E5%9D%80"><span class="toc-number">5.2.</span> <span class="toc-text">MACåœ°å€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ip%E5%9C%B0%E5%9D%80"><span class="toc-number">5.3.</span> <span class="toc-text">IPåœ°å€</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B-3"><span class="toc-number">5.3.1.</span> <span class="toc-text">ç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ip%E5%9C%B0%E5%9D%80%E7%BC%96%E5%9D%80%E6%96%B9%E5%BC%8Fabcde%E5%92%8Ccidr"><span class="toc-number">5.3.2.</span> <span class="toc-text">IPåœ°å€ç¼–å€æ–¹å¼(ABCDEå’ŒCIDR)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a%E7%B1%BBip%E5%9C%B0%E5%9D%80"><span class="toc-number">5.3.2.1.</span> <span class="toc-text">Aç±»IPåœ°å€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b%E7%B1%BBip%E5%9C%B0%E5%9D%80"><span class="toc-number">5.3.2.2.</span> <span class="toc-text">Bç±»IPåœ°å€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c%E7%B1%BBip%E5%9C%B0%E5%9D%80"><span class="toc-number">5.3.2.3.</span> <span class="toc-text">Cç±»IPåœ°å€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#d%E7%B1%BBip%E5%9C%B0%E5%9D%80"><span class="toc-number">5.3.2.4.</span> <span class="toc-text">Dç±»IPåœ°å€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E6%AE%8Aip%E5%9C%B0%E5%9D%80"><span class="toc-number">5.3.2.5.</span> <span class="toc-text">ç‰¹æ®ŠIPåœ°å€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81"><span class="toc-number">5.3.2.6.</span> <span class="toc-text">å­ç½‘æ©ç </span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3"><span class="toc-number">5.4.</span> <span class="toc-text">ç«¯å£</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B-4"><span class="toc-number">5.4.1.</span> <span class="toc-text">ç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.4.2.</span> <span class="toc-text">ç«¯å£ç±»å‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B"><span class="toc-number">5.5.</span> <span class="toc-text">ç½‘ç»œæ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#osi-%E4%B8%83%E5%B1%82%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B"><span class="toc-number">5.5.1.</span> <span class="toc-text">OSI ä¸ƒå±‚å‚è€ƒæ¨¡å‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tcpip-%E5%9B%9B%E5%B1%82%E6%A8%A1%E5%9E%8B"><span class="toc-number">5.5.2.</span> <span class="toc-text">TCP&#x2F;IP å››å±‚æ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B-5"><span class="toc-number">5.5.2.1.</span> <span class="toc-text">ç®€ä»‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9B%E5%B1%82%E4%BB%8B%E7%BB%8D"><span class="toc-number">5.5.2.2.</span> <span class="toc-text">å››å±‚ä»‹ç»</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%8F%E8%AE%AE"><span class="toc-number">5.6.</span> <span class="toc-text">åè®®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B-6"><span class="toc-number">5.6.1.</span> <span class="toc-text">ç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E5%8D%8F%E8%AE%AE"><span class="toc-number">5.6.2.</span> <span class="toc-text">å¸¸è§åè®®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#udp%E5%8D%8F%E8%AE%AE"><span class="toc-number">5.6.3.</span> <span class="toc-text">UDPåè®®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tcp%E5%8D%8F%E8%AE%AE"><span class="toc-number">5.6.4.</span> <span class="toc-text">TCPåè®®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ip%E5%8D%8F%E8%AE%AE"><span class="toc-number">5.6.5.</span> <span class="toc-text">IPåè®®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E7%BD%91%E5%B8%A7%E5%8D%8F%E8%AE%AE"><span class="toc-number">5.6.6.</span> <span class="toc-text">ä»¥å¤ªç½‘å¸§åè®®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#arp%E5%8D%8F%E8%AE%AE"><span class="toc-number">5.6.7.</span> <span class="toc-text">ARPåè®®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85"><span class="toc-number">5.6.8.</span> <span class="toc-text">å°è£…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%94%A8"><span class="toc-number">5.6.9.</span> <span class="toc-text">åˆ†ç”¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E7%9A%84%E8%BF%87%E7%A8%8B"><span class="toc-number">5.7.</span> <span class="toc-text">ç½‘ç»œé€šä¿¡çš„è¿‡ç¨‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#socket%E4%BB%8B%E7%BB%8D"><span class="toc-number">5.8.</span> <span class="toc-text">socketä»‹ç»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E8%8A%82%E5%BA%8F"><span class="toc-number">5.9.</span> <span class="toc-text">å­—èŠ‚åº</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B-7"><span class="toc-number">5.9.1.</span> <span class="toc-text">ç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E8%8A%82%E5%BA%8F%E4%B8%BE%E4%BE%8B"><span class="toc-number">5.9.2.</span> <span class="toc-text">å­—èŠ‚åºä¸¾ä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E8%8A%82%E5%BA%8F%E8%BD%AC%E6%8D%A2%E5%87%BD%E6%95%B0"><span class="toc-number">5.9.3.</span> <span class="toc-text">å­—èŠ‚åºè½¬æ¢å‡½æ•°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#socket%E5%9C%B0%E5%9D%80"><span class="toc-number">5.10.</span> <span class="toc-text">socketåœ°å€</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E7%94%A8socket%E5%9C%B0%E5%9D%80"><span class="toc-number">5.10.1.</span> <span class="toc-text">é€šç”¨socketåœ°å€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%93%E7%94%A8socket%E5%9C%B0%E5%9D%80"><span class="toc-number">5.10.2.</span> <span class="toc-text">ä¸“ç”¨socketåœ°å€</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ip%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2%E5%AD%97%E7%AC%A6%E4%B8%B2ip-%E6%95%B4%E6%95%B0-%E4%B8%BB%E6%9C%BA-%E7%BD%91%E7%BB%9C%E5%AD%97%E8%8A%82%E5%BA%8F%E7%9A%84%E8%BD%AC%E6%8D%A2"><span class="toc-number">5.11.</span> <span class="toc-text">IPåœ°å€è½¬æ¢ï¼ˆå­—ç¬¦ä¸²ip-æ•´æ•° ï¼Œä¸»æœºã€ç½‘ç»œå­—èŠ‚åºçš„è½¬æ¢ï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tcp%E9%80%9A%E4%BF%A1%E6%B5%81%E7%A8%8B"><span class="toc-number">5.12.</span> <span class="toc-text">TCPé€šä¿¡æµç¨‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A5%97%E6%8E%A5%E5%AD%97%E5%87%BD%E6%95%B0"><span class="toc-number">5.13.</span> <span class="toc-text">å¥—æ¥å­—å‡½æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-4"><span class="toc-number">5.13.1.</span> <span class="toc-text">ç¤ºä¾‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B"><span class="toc-number">5.14.</span> <span class="toc-text">TCPä¸‰æ¬¡æ¡æ‰‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E6%AF%94"><span class="toc-number">5.14.1.</span> <span class="toc-text">ç±»æ¯”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E8%80%8C%E4%B8%8D%E6%98%AF%E4%B8%A4%E6%AC%A1%E6%8F%A1%E6%89%8B"><span class="toc-number">5.14.2.</span> <span class="toc-text">ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹è€Œä¸æ˜¯ä¸¤æ¬¡æ¡æ‰‹ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tcp%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3"><span class="toc-number">5.15.</span> <span class="toc-text">TCPæ»‘åŠ¨çª—å£</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tcp%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B"><span class="toc-number">5.16.</span> <span class="toc-text">TCPå››æ¬¡æŒ¥æ‰‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E6%AF%94-2"><span class="toc-number">5.16.1.</span> <span class="toc-text">ç±»æ¯”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B%E8%80%8C%E4%B8%8D%E6%98%AF%E4%B8%89%E6%AC%A1%E6%8C%A5%E6%89%8B"><span class="toc-number">5.16.2.</span> <span class="toc-text">ä¸ºä»€ä¹ˆè¦å››æ¬¡æŒ¥æ‰‹è€Œä¸æ˜¯ä¸‰æ¬¡æŒ¥æ‰‹ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tcp%E9%80%9A%E4%BF%A1%E5%B9%B6%E5%8F%91"><span class="toc-number">5.17.</span> <span class="toc-text">TCPé€šä¿¡å¹¶å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%AE%9E%E7%8E%B0%E5%B9%B6%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">5.17.1.</span> <span class="toc-text">å¤šè¿›ç¨‹å®ç°å¹¶å‘æœåŠ¡å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%AE%9E%E7%8E%B0%E5%B9%B6%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">5.17.2.</span> <span class="toc-text">å¤šçº¿ç¨‹å®ç°å¹¶å‘æœåŠ¡å™¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tcp%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2"><span class="toc-number">5.18.</span> <span class="toc-text">TCPçŠ¶æ€è½¬æ¢</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2mslmaximum-segment-lifetime"><span class="toc-number">5.18.1.</span> <span class="toc-text">2MSLï¼ˆMaximum Segment Lifetimeï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%8A%E5%85%B3%E9%97%AD"><span class="toc-number">5.18.2.</span> <span class="toc-text">åŠå…³é—­</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#shutdown"><span class="toc-number">5.18.2.1.</span> <span class="toc-text">shutdown()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E7%9A%84%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0file_description"><span class="toc-number">5.18.2.2.</span> <span class="toc-text">å…³äºæ–‡ä»¶æè¿°ç¬¦çš„å¼•ç”¨è®¡æ•°(file_description)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E5%A4%8D%E7%94%A8%E5%85%B3%E4%BA%8Esockopt"><span class="toc-number">5.19.</span> <span class="toc-text">ç«¯å£å¤ç”¨(å…³äºsockopt())</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-5"><span class="toc-number">5.19.1.</span> <span class="toc-text">ç¤ºä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%90%86%E8%A7%A3"><span class="toc-number">5.19.1.1.</span> <span class="toc-text">ç†è§£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%80%83"><span class="toc-number">5.19.1.2.</span> <span class="toc-text">æ€è€ƒ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#io%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8io%E5%A4%9A%E8%B7%AF%E8%BD%AC%E6%8E%A5"><span class="toc-number">5.20.</span> <span class="toc-text">I&#x2F;Oå¤šè·¯å¤ç”¨(I&#x2F;Oå¤šè·¯è½¬æ¥)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#io%E5%90%AB%E4%B9%89"><span class="toc-number">5.20.1.</span> <span class="toc-text">I&#x2F;Oå«ä¹‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%A0%E7%A7%8D%E5%B8%B8%E8%A7%81%E7%9A%84io%E6%A8%A1%E5%9E%8B"><span class="toc-number">5.20.2.</span> <span class="toc-text">å‡ ç§å¸¸è§çš„I&#x2F;Oæ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%BB%E5%A1%9E%E7%AD%89%E5%BE%85"><span class="toc-number">5.20.2.1.</span> <span class="toc-text">é˜»å¡ç­‰å¾…</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#bio%E6%A8%A1%E5%9E%8B"><span class="toc-number">5.20.2.1.1.</span> <span class="toc-text">BIOæ¨¡å‹</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%9E%E9%98%BB%E5%A1%9E%E5%BF%99%E8%BD%AE%E8%AF%A2"><span class="toc-number">5.20.2.2.</span> <span class="toc-text">éé˜»å¡ï¼Œå¿™è½®è¯¢</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#nio%E6%A8%A1%E5%9E%8B"><span class="toc-number">5.20.2.2.1.</span> <span class="toc-text">NIOæ¨¡å‹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#io%E5%A4%9A%E8%B7%AF%E8%BD%AC%E6%8E%A5%E6%8A%80%E6%9C%AF"><span class="toc-number">5.20.3.</span> <span class="toc-text">I&#x2F;Oå¤šè·¯è½¬æ¥æŠ€æœ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3"><span class="toc-number">5.20.3.1.</span> <span class="toc-text">ç®€å•ç†è§£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#select"><span class="toc-number">5.20.3.2.</span> <span class="toc-text">select</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90"><span class="toc-number">5.20.3.2.1.</span> <span class="toc-text">å·¥ä½œè¿‡ç¨‹åˆ†æ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-number">5.20.3.2.2.</span> <span class="toc-text">ä»£ç </span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">5.20.3.2.3.</span> <span class="toc-text">ä»£ç åˆ†æ</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#poll"><span class="toc-number">5.20.3.3.</span> <span class="toc-text">poll</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#select%E6%8A%80%E6%9C%AF%E7%9A%84%E7%BC%BA%E7%82%B9"><span class="toc-number">5.20.3.3.1.</span> <span class="toc-text">selectæŠ€æœ¯çš„ç¼ºç‚¹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#poll-2"><span class="toc-number">5.20.3.3.2.</span> <span class="toc-text">poll()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81-2"><span class="toc-number">5.20.3.3.3.</span> <span class="toc-text">ä»£ç </span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-2"><span class="toc-number">5.20.3.3.4.</span> <span class="toc-text">ä»£ç åˆ†æ</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#epoll"><span class="toc-number">5.20.3.4.</span> <span class="toc-text">epoll</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90-2"><span class="toc-number">5.20.3.4.1.</span> <span class="toc-text">å·¥ä½œè¿‡ç¨‹åˆ†æ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#epoll-2"><span class="toc-number">5.20.3.4.2.</span> <span class="toc-text">epoll()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%92%8C%E5%88%86%E6%9E%90"><span class="toc-number">5.20.3.4.3.</span> <span class="toc-text">ä»£ç å’Œåˆ†æ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#epoll-%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.20.3.4.4.</span> <span class="toc-text">Epoll çš„å·¥ä½œæ¨¡å¼</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#lt%E6%A8%A1%E5%BC%8F%E6%B0%B4%E5%B9%B3%E8%A7%A6%E5%8F%91"><span class="toc-number">5.20.3.4.5.</span> <span class="toc-text">LTæ¨¡å¼(æ°´å¹³è§¦å‘)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#et%E6%A8%A1%E5%BC%8F%E8%BE%B9%E6%B2%BF%E8%A7%A6%E5%8F%91"><span class="toc-number">5.20.3.4.6.</span> <span class="toc-text">ETæ¨¡å¼(è¾¹æ²¿è§¦å‘)</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#udp"><span class="toc-number">5.21.</span> <span class="toc-text">UDP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#udp%E9%80%9A%E4%BF%A1"><span class="toc-number">5.21.1.</span> <span class="toc-text">UDPé€šä¿¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81-3"><span class="toc-number">5.21.1.1.</span> <span class="toc-text">ä»£ç </span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F-3"><span class="toc-number">5.21.1.1.1.</span> <span class="toc-text">æ³¨æ„</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%BF%E6%92%AD%E5%92%8C%E7%BB%84%E6%92%AD"><span class="toc-number">5.21.2.</span> <span class="toc-text">å¹¿æ’­å’Œç»„æ’­</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B9%BF%E6%92%AD"><span class="toc-number">5.21.2.1.</span> <span class="toc-text">å¹¿æ’­</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%9C%89%E4%B8%80%E5%A4%84%E4%B8%8D%E6%98%8E%E7%99%BD"><span class="toc-number">5.21.2.1.1.</span> <span class="toc-text">ä»£ç (æœ‰ä¸€å¤„ä¸æ˜ç™½)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%84%E6%92%AD%E5%A4%9A%E6%92%AD"><span class="toc-number">5.21.2.2.</span> <span class="toc-text">ç»„æ’­(å¤šæ’­)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%92%8C%E5%89%8D%E9%9D%A2%E5%90%8C%E6%A0%B7%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">5.21.2.2.1.</span> <span class="toc-text">ä»£ç (å’Œå‰é¢åŒæ ·çš„é—®é¢˜)</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E5%A5%97%E6%8E%A5%E5%AD%97"><span class="toc-number">5.22.</span> <span class="toc-text">æœ¬åœ°å¥—æ¥å­—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#api"><span class="toc-number">5.22.1.</span> <span class="toc-text">API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-2"><span class="toc-number">5.22.2.</span> <span class="toc-text">å·¥ä½œåŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81-4"><span class="toc-number">5.22.3.</span> <span class="toc-text">ä»£ç </span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E7%BB%86%E8%8A%82%E5%9C%B0%E6%96%B9%E4%B8%8D%E6%98%AF%E5%BE%88%E6%98%8E%E7%99%BD"><span class="toc-number">5.22.3.1.</span> <span class="toc-text">ä»£ç åˆ†æ(ç»†èŠ‚åœ°æ–¹ä¸æ˜¯å¾ˆæ˜ç™½)</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E5%92%8C%E6%80%BB%E7%BB%93"><span class="toc-number">6.</span> <span class="toc-text">ç¬¬äº”ç«  é¡¹ç›®å®æˆ˜å’Œæ€»ç»“</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%BB%E5%A1%9E%E9%9D%9E%E9%98%BB%E5%A1%9E-%E5%90%8C%E6%AD%A5%E5%BC%82%E6%AD%A5%E7%BD%91%E7%BB%9Cio"><span class="toc-number">6.1.</span> <span class="toc-text">é˜»å¡&#x2F;éé˜»å¡ã€åŒæ­¥&#x2F;å¼‚æ­¥(ç½‘ç»œIO)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#unixlinux%E4%B8%8A%E7%9A%84%E4%BA%94%E7%A7%8Dio%E6%A8%A1%E5%9E%8B"><span class="toc-number">6.2.</span> <span class="toc-text">Unix&#x2F;Linuxä¸Šçš„äº”ç§IOæ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BB%E5%A1%9E-blocking"><span class="toc-number">6.2.1.</span> <span class="toc-text">é˜»å¡ blocking</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E9%98%BB%E5%A1%9E-non-blockingnio"><span class="toc-number">6.2.2.</span> <span class="toc-text">éé˜»å¡ non-blockingï¼ˆNIOï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#io%E5%A4%8D%E7%94%A8io-multiplexing"><span class="toc-number">6.2.3.</span> <span class="toc-text">IOå¤ç”¨ï¼ˆIO multiplexingï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E5%8F%B7%E9%A9%B1%E5%8A%A8signal-driven"><span class="toc-number">6.2.4.</span> <span class="toc-text">ä¿¡å·é©±åŠ¨ï¼ˆsignal-drivenï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5asynchronous"><span class="toc-number">6.2.5.</span> <span class="toc-text">å¼‚æ­¥ï¼ˆasynchronousï¼‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-server%E7%BD%91%E9%A1%B5%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">6.3.</span> <span class="toc-text">Web Server(ç½‘é¡µæœåŠ¡å™¨)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#http%E5%8D%8F%E8%AE%AE%E5%BA%94%E7%94%A8%E5%B1%82%E7%9A%84%E5%8D%8F%E8%AE%AE"><span class="toc-number">6.4.</span> <span class="toc-text">HTTPåè®®(åº”ç”¨å±‚çš„åè®®)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B-8"><span class="toc-number">6.4.1.</span> <span class="toc-text">ç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-3"><span class="toc-number">6.4.2.</span> <span class="toc-text">æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-3"><span class="toc-number">6.4.3.</span> <span class="toc-text">å·¥ä½œåŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http%E8%AF%B7%E6%B1%82%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F"><span class="toc-number">6.4.4.</span> <span class="toc-text">HTTPè¯·æ±‚æŠ¥æ–‡æ ¼å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http%E5%93%8D%E5%BA%94%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F"><span class="toc-number">6.4.5.</span> <span class="toc-text">HTTPå“åº”æŠ¥æ–‡æ ¼å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http%E8%AF%B7%E6%B1%82%E6%96%B9%E6%B3%95"><span class="toc-number">6.4.6.</span> <span class="toc-text">HTTPè¯·æ±‚æ–¹æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-number">6.4.7.</span> <span class="toc-text">HTTPçŠ¶æ€ç </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B%E5%9F%BA%E6%9C%AC%E6%A1%86%E6%9E%B6"><span class="toc-number">6.5.</span> <span class="toc-text">æœåŠ¡å™¨ç¼–ç¨‹åŸºæœ¬æ¡†æ¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%A4%E7%A7%8D%E9%AB%98%E6%95%88%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.6.</span> <span class="toc-text">ä¸¤ç§é«˜æ•ˆçš„äº‹ä»¶å¤„ç†æ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#reactor%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.6.1.</span> <span class="toc-text">Reactoræ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#proactor%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.6.2.</span> <span class="toc-text">Proactoræ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%8B%9F-proactor-%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.6.3.</span> <span class="toc-text">æ¨¡æ‹Ÿ Proactor æ¨¡å¼</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span class="toc-number">6.7.</span> <span class="toc-text">çº¿ç¨‹æ± </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA"><span class="toc-number">6.8.</span> <span class="toc-text">æœ‰é™çŠ¶æ€æœº</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#epolloneshot%E4%BA%8B%E4%BB%B6"><span class="toc-number">6.9.</span> <span class="toc-text">EPOLLONESHOTäº‹ä»¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95"><span class="toc-number">6.10.</span> <span class="toc-text">æœåŠ¡å™¨å‹åŠ›æµ‹è¯•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%80%BB%E4%BD%93%E6%B5%81%E7%A8%8B%E5%AE%9E%E7%8E%B0%E4%BB%A5%E5%8F%8A%E4%BB%A3%E7%A0%81"><span class="toc-number">6.11.</span> <span class="toc-text">é¡¹ç›®æ€»ä½“æµç¨‹å®ç°ä»¥åŠä»£ç </span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%93%BE%E6%8E%A5%E5%92%8C%E6%9E%84%E5%BB%BA"><span class="toc-number">6.11.1.</span> <span class="toc-text">é“¾æ¥å’Œæ„å»º</span></a></li></ol></li></ol></li></ol></section><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/assets/android-chrome-512x512.webp" alt="avatar"></div><p class="sidebar-ov-author__text">Self-discipline is key in life.</p></div><div class="sidebar-ov-social"><a class="sidebar-ov-social-item" href="https://github.com/DavidingPlus" target="_blank" rel="noopener" data-popover="GitHub" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-github"></i></span></a><a class="sidebar-ov-social-item" href="/qq/" target="_blank" rel="noopener" data-popover="QQ" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-qq"></i></span></a><a class="sidebar-ov-social-item" href="/wechat/" target="_blank" rel="noopener" data-popover="å¾®ä¿¡" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-weixin"></i></span></a><a class="sidebar-ov-social-item" href="mailto:davidingplus@qq.com" target="_blank" rel="noopener" data-popover="davidingplus@qq.com" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fas fa-envelope"></i></span></a></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">38</div><div class="sidebar-ov-state-item__name">å½’æ¡£</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">21</div><div class="sidebar-ov-state-item__name">åˆ†ç±»</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="çŸ¥è¯†å…±äº«è®¸å¯åè®®" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">æ‚¨å·²é˜…è¯»äº† </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright Â© 2023~2025</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>DavidingPlus</span><span class="footer__devider">|</span><span>èœ€ ICP å¤‡ 2024088070 å·</span></div><div><span>ç”± <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> å¼ºåŠ›é©±åŠ¨</span><span> v7.2.0</span><span class="footer__devider">|</span><span>ä¸»é¢˜ - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.8.6</span></div><div class="busuanzi"><span class="busuanzi-siteuv"><span class="busuanzi-siteuv__icon"><i class="fas fa-user"></i></span><span class="busuanzi-siteuv__info">è®¿é—®äººæ•°</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_uv"></span></span><span class="busuanzi-sitepv"><span class="busuanzi-siteuv__icon"><i class="fas fa-eye"></i></span><span class="busuanzi-siteuv__info">æµè§ˆæ€»é‡</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_pv"></span></span></div><div><span id="timeDate">è½½å…¥å¤©æ•°...</span><span id="times">è½½å…¥æ—¶åˆ†ç§’...</span><script>var now=new Date;function createtime(){var n=new Date("09/18/2023 00:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="å°ç ´ç«™å·²ç»å®‰å…¨è¿è¡Œ "+dnum+" å¤© ",document.getElementById("times").innerHTML=hnum+" å°æ—¶ "+mnum+" åˆ† "+snum+" ç§’å•¦ï¼"}setInterval("createtime()",250)</script></div><script type="text/javascript" id="maid-script" mermaidoptioins="{&quot;theme&quot;:&quot;default&quot;}" src="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/js/mermaid.min.js"></script><script>if(window.mermaid){var options=JSON.parse(document.getElementById("maid-script").getAttribute("mermaidoptioins"));mermaid.initialize(options)}</script></div></footer><div class="loading-animation" id="loading-animation"><div class="loading-animation__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-thumbs-up"></i></span></div><div class="back2bottom" id="back2bottom"><span class="back2bottom__icon"><i class="fas fa-rocket"></i></span></div></div><div class="search-mask"></div><div class="search-popup"><span class="search-close"></span><div class="search-input"><input placeholder="æœç´¢æ–‡ç« ï¼ˆæ”¯æŒå¤šå…³é”®è¯ï¼Œè¯·ç”¨ç©ºæ ¼åˆ†éš”ï¼‰"><div class="search-btns">ä½¿ç”¨æœç´¢ï¼š<span class="search-btns-item search-btns-item--bing"><i></i>å¿…åº”</span><span class="search-btns-item search-btns-item--baidu"><i></i>ç™¾åº¦</span></div></div><div class="search-results"></div></div><script src="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/js/jquery.js"></script><script src="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/js/velocity.js"></script><script src="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/js/velocity-ui.js"></script><script src="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/js/canvas-nest.js" color="255,255,255" opacity="1" count="99" zindex="-1"></script><script src="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/js/fancybox.js"></script><script src="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/js/masonry.js"></script><script src="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/js/lazyload.js"></script><script>function initSearch(){var e=!0,t="search.json";t?/json$/i.test(t)&&(e=!1):t="search.xml";var n="/"+t;$.ajax({url:n,dataType:e?"xml":"json",async:!0,success:function(t){var n=e?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,o=$(".search-input input"),i=$(".search-results"),c=100,r=1,a=function(){var e=o.val().toLowerCase().trim(),t=e.split(/[\s]+/),a=[];t.length>1&&t.push(e),e.length>0&&n.forEach(function(e){var n=!1,o=e.title&&e.title.trim()||"[ æ–‡ç« æ— æ ‡é¢˜ ]",i=o&&o.toLowerCase(),s=e.content&&e.content.replace(/<[^>]+>/g,""),l=s&&s.toLowerCase(),u=e.url&&decodeURI(e.url).replace(/\/{2,}/g,"/"),h=[],d=[];t.forEach(function(e){function t(e,t,n,o){if(!e||!t)return[];var i=0,c=-1,r=[];for(n||(e=e.toLowerCase(),t=t.toLowerCase());-1!==(c=t.indexOf(e,i));){var a=!1;h.forEach(function(t){t.index===c&&t.word.length<e.length&&(t.word=e,a=!0)}),i=c+e.length,!a&&r.push({index:c,word:e,weight:o})}return r}h=h.concat(t(e,i,!1,c)),d=d.concat(t(e,l,!1,r))});var f=h.length,p=d.length;if((f>0||p>0)&&(n=!0),n){function w(e,t,n,o){if(e&&t&&t.length){var i="",c=n,r=o;return t.forEach(function(t){if(!(t.index<c)){var n=t.index+t.word.length;i+=e.slice(c,t.index),i+="<b>"+e.slice(t.index,n)+"</b>",c=n}}),i+=e.slice(c,r)}}[h,d].forEach(function(e){e.sort(function(e,t){return e.index-t.index})});var v,g={},x=h.length*c+d.length*r,y=w(o,h,0,o.length)||o;if(d.length>0){var S=d[0].index;v=w(s,d,S>20?S-20:0,S+180)}else v=s.slice(0,200);g.title=y,g.content=v,g.url=u,g.weight=x,a.push(g)}});var s="";a.length?(a.sort(function(e,t){return t.weight-e.weight}),s+="<ul>",a.forEach(function(e){s+='<li><a class="search-results-title" href="'+e.url+'">',s+=e.title,s+='</a><div class="search-results-content">',s+=e.content,s+="</div></li>"}),s+="</ul>"):s+='<div class="search-results-none"><i class="far fa-meh"></i></div>',i.html(s)};o.on("input",a),o.on("keyup",function(e){e.keyCode===Stun.utils.codeToKeyCode("Enter")&&a()})}})}function closeSearch(){$("body").css({overflow:"auto"}),$(".search-popup").css({display:"none"}),$(".search-mask").css({display:"none"})}function safeOpenUrl(e){var t=window.open();t.opener=null,t.location=e}function extSearch(e){var t=window.location.host,n=$(".search-input input").val().toLowerCase().trim();n?safeOpenUrl({google:"https://www.google.com/search?q=",bing:"https://cn.bing.com/search?q=",baidu:"https://www.baidu.com/s?ie=UTF-8&wd="}[e]+n+" site:"+t):Stun.utils.popAlert("warning","è¯·è¾“å…¥å­—ç¬¦")}window.addEventListener("DOMContentLoaded",function(){Stun.utils.pjaxReloadLocalSearch=function(){$(".header-nav-search").on("click",function(e){e.stopPropagation(),$("body").css("overflow","hidden"),$(".search-popup").velocity("stop").velocity("transition.expandIn",{duration:300,complete:function(){$(".search-popup input").focus()}}),$(".search-mask").velocity("stop").velocity("transition.fadeIn",{duration:300}),initSearch()}),$(".search-mask, .search-close").on("click",function(){closeSearch()}),$(document).on("keydown",function(e){e.keyCode===Stun.utils.codeToKeyCode("Escape")&&closeSearch()})},Stun.utils.pjaxReloadLocalSearch()},!1);var assistSearchList=window.CONFIG.assistSearch;Array.isArray(assistSearchList)&&assistSearchList.forEach(function(e){document.querySelector(".search-btns-item--"+e).addEventListener("click",function(){extSearch(e)},!1)})</script><script src="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/js/pjax.js"></script><script>window.addEventListener("DOMContentLoaded",function(){new Pjax({selectors:["head title","#main",".pjax-reload",".header-banner"],history:!0,scrollTo:!1,scrollRestoration:!1,cacheBust:!1,debug:!1,currentUrlFullReload:!1,timeout:0});document.addEventListener("pjax:send",function(){$(".header-nav-menu").removeClass("show"),CONFIG.pjax&&CONFIG.pjax.avoidBanner&&$("html").velocity("scroll",{duration:500,offset:$("#header").height(),easing:"easeInOutCubic"}),$(".loading-animation").addClass("loading")},!1),window.addEventListener("pjax:complete",function(){if($(".loading-animation").removeClass("loading"),$("link[rel=prefetch], script[data-pjax-rm]").each(function(){$(this).remove()}),$("script[data-pjax], #pjax-reload script").each(function(){$(this).parent().append($(this).remove())}),Stun.utils.pjaxReloadBoot&&Stun.utils.pjaxReloadBoot(),Stun.utils.pjaxReloadScroll&&Stun.utils.pjaxReloadScroll(),Stun.utils.pjaxReloadSidebar&&Stun.utils.pjaxReloadSidebar(),"undefined"!=typeof mermaid){const e=Array.from(document.querySelectorAll(".mermaid")).filter(e=>!e.dataset.processed);mermaid.init(void 0,e)}},!1)},!1)</script><div id="pjax-reload"><link href="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/css/katex.min.css" rel="stylesheet" type="text/css"><link href="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/css/copy-tex.css" rel="stylesheet" type="text/css"><script src="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/js/copy-tex.min.js"></script><script src="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/js/quicklink.js"></script><script>function initQuicklink(){quicklink({timeout:"10000",priority:!0,ignores:[i=>i.includes("#"),i=>"https://blog.davidingplus.cn/posts/ff333d31.html"===i,/\/api\/?/,i=>i.includes(".xml"),i=>i.includes(".zip"),(i,t)=>t.hasAttribute("nofollow"),(i,t)=>t.hasAttribute("noprefetch")]})}initQuicklink()</script><script src="//cdn.davidingplus.cn/files/hexo-theme-stun-third-party/js/busuanzi.js" async></script></div><script src="/js/utils.js?v=2.8.6"></script><script src="/js/stun-boot.js?v=2.8.6"></script><script src="/js/scroll.js?v=2.8.6"></script><script src="/js/header.js?v=2.8.6"></script><script src="/js/sidebar.js?v=2.8.6"></script><script type="application/json" src="/search.json"></script><script data-pjax="">function loadUtterances(){var t=document,e=t.createElement("script"),s=t.getElementById("utterances-container"),r=Stun.utils.getNightMode()?"photon-dark":"github-light";s&&(e.src="https://utteranc.es/client.js",e.setAttribute("repo","DavidingPlus/blog-comments"),e.setAttribute("issue-term","title"),e.setAttribute("label","utterances"),e.setAttribute("theme",r),e.setAttribute("crossorigin","anonymous"),e.setAttribute("async",""),e.setAttribute("data-pjax-rm",""),s.append(e))}loadUtterances()</script><script async src="/js/cursor/text.js"></script><script src="/js/activate-power-mode.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!0,document.body.addEventListener("input",POWERMODE)</script><script>var titleTime,OriginTitile=document.title;document.addEventListener("visibilitychange",function(){document.hidden?(document.title="ğŸ¤¡å¿«å›æ¥,ç²—å¤§äº‹äº†~~"+OriginTitile,clearTimeout(titleTime)):(document.title="ğŸ˜šæ¬¢è¿å›æ¥!~"+OriginTitile,titleTime=setTimeout(function(){document.title=OriginTitile},2e3))})</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/wanko.model.json"},display:{position:"left",width:160,height:290},mobile:{show:!0},log:!1})</script></body></html>